"use strict";!function(){var s,d={themeColorForText:"zmThmClr",dropDownConnector:"zmAMddOnB",link:"zmLink",filterBtn:"zmFCBub",closeIcon:"msi-close",iconElem:"zmAMItem",separatorIcon:"zmSDot",greyedText:"zmGreyClr"},e="msi-uncheck",i="msi-check",n="msi-partcheck",t="msi-filter",o="msi-attsearch",a="msi-viewArchived",l="msi-dataSort",r="msi-create",c="msi-folder",m="msi-label",u="msi-trash",f="msi-spam",v="msi-notspam",h="msi-archive",p="msi-unarchive",g="msi-stop",z="msi-prev",I="msi-next",w="msi-cliqColor",b="msi-close",C={selectedCount:"jsSelCount",unreadLink:"jsUnreadLink",viewInfo:"jsViewInfo",savedSearch:"zm_savesearch",spamFilterSeparator:"zm_spam_separator",savedSearchSeparator:"zm_saveSearch_separator"},S="checkBox",O="filter",y="attachmentFilter",M="archiveFilter",N="sort",U="newTemplate",D="move",F="sendNow",E="tag",V="trash",B="spam",W="notSpam",j="archive",H="unArchive",R="stopSchedule",P="moreAction",Z="conversation",q="noConversation",G="customize",J="listingView",x="previous",T="next",A="close",L="chatlet",K="zm_Container",Q="zm_srch1",X="zm_tab",k=zmText.get("mailTopBar"),Y=function(n){var e=n.iconElem,t=n.menusList,i=n.align,o=void 0===i?"pleft":i,a=n.onClick,l=n.onHide,r={divId:n.containerId||"",par:e||"",list:t,align:o,clk:function(e,t,i){a(e,t,i,n)},onHide:l};zmUtil.isChildWindow()?n.dropDownMenu=zmWindow.showMenu(r):n.dropDownMenu=zmsuite.showMenu(r)},ee=function(e,t){var n,o={divId:"folderComp",parentDOM:$.e(e),direction:t,displayAs:"dropdown",hltPar:!0,offsets:{left:0,top:-1},excludeList:[zmail.folId.dId,zmail.folId.teId,zmail.folId.oId],excludeChild:!0,viewDOM:$.e(zmsuite.getCenterOuter().$el).find(".SCmc"),onSelect:function(e){zmail.MailAction.Initializer.doActions("move","drop",{action:"move",folId:e})},onCreate:function(e,t){var i=t.parentId;zmAppLoader.load("zmFolder").then(function(){zmfolAction.isValidName(e,void 0,{opType:"new"})&&(zmfolAction.sendNewFolderReq(e,{reqDoneClbk:function(e,t){e&&o.onSelect(t)}},i),n.hide())})}};return(n=zmUtil.createFLComp("sub-folder",o)).show(),n},te=function(e,t){var i,n={divId:"labelComp",direction:t,parentDOM:$.e(e),viewDOM:$.e(zmsuite.getCenterOuter().$el).find(".SCmc"),hltPar:!0,displayAs:"dropdown",labelState:{selectedMails:!0},offsets:{left:0,top:-1},onStateChange:function(e,t){zmail.MailAction.Initializer.applyActions("label","click",{lA:t?"add":"delete",lId:e,disp:zmail.labInfo[e].dispName})},onCreate:function(e,t){zmlab.isValidName(e)&&zmlab.labelCreate(e,"",{reqDoneClbk:function(e,t){e&&(n.onStateChange(t,!0,function(){}),i.hide())},color:t})}};return(i=zmUtil.createFLComp("label",n)).show(),i},ie=zmText.get("mailTopBar").dropdown.sort,ne=[ie.latestOnTop,ie.oldestOnTop,ie.largestOnTop,ie.smallestOnTop],oe=function(e,t,i,n){zmList.changeListingSortOrder(e.value,n.fId),n.dropDownMenu.remove()},ae=function(e){var i,n;e.menusList=(i=e.higtlightMenuIndex,n=[],ne.forEach(function(e,t){n.push({txt:e,data:{action:"sort",value:t},className:t===i?d.themeColorForText:""})}),n.splice(2,0,{sep:!0}),n),e.onClick=oe,Y(e)},le=zmText.get("mailTopBar").dropdown.flagged,re=[le.info,le.important,le.followup],se=function(e){var t=e.showViewAllOpt,i=void 0!==t&&t,n=e.action,o=e.focusCurrView,a=void 0===o||o,l=[],r=a&&zmInit.getListingDetObj();return re.forEach(function(e,t){l.push({txt:e,data:{optionIndex:t+1,action:n},className:a&&r.flag&&r.flag-1===t?d.themeColorForText:""})}),i&&l.push({txt:le.viewAll,data:{action:"view_flag"},className:"-1"===r.flag?d.themeColorForText:""}),"markFlag"===n&&l.push({txt:le.clearflag,data:{optionIndex:0,action:n}}),l},de=function(e,t,i,n){"markFlag"!==e.action?"view_flag"===e.action?zmList.updateListingView(e):zmList.updateListingView({action:"listview",view:"flag",viewId:e.optionIndex}):zmList.bindAction({action:"flag",fVal:e.optionIndex},t)},ce=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{divId:e.containerId||"zm_dropflag",list:se(e),align:e.alignment||"cleft",clk:de}},me=function(e,t,i){zmList.updateListingView({action:"listview",view:"label",viewId:e.labId})},ue=function(){var t,i,n,e,o,a,l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{divId:l.containerId||"zm_dropLabel",list:(n=zmail.labInfo,e=Object.keys(n),o=[],a=[],e.forEach(function(e){t=n[e],(i=t.se)?o[i-1]={txt:t.dispName,data:{labId:e}}:a.push({txt:t.dispName,data:{labId:e}})}),o=(o=o.filter(function(e){return e})).concat(a)),align:l.alignment||"cleft",clk:me}},fe=zmText.get("mailTopBar").dropdown.views,ve={viewAll:function(e,t){var i;return"view_all"!==t.view&&t.view||t.attach||t.label||t.flag||(i=d.themeColorForText),{txt:fe.viewAll,data:{action:"view_all"},className:i}},unread:function(e,t){return e===zmail.folId.teId||e===zmail.folId.sId?"":{txt:fe.unread,data:{action:"view_unread"},className:"unread"===t.view?d.themeColorForText:""}},flag:function(e,t){return e===zmail.folId.teId?"":{dom:zdom("fragment",null,fe.flagged,zdom("i",{className:"msi-rarrow"})),data:{action:"view_flag"},className:t.flag?d.themeColorForText:"",child:function(){return ce({alignment:"cleft",containerId:"zm_dropflag"})}}},tag:function(e,i){return zmUtil.isSharedFolder(e)||$.isEmptyObject(zmail.labInfo)?"":{dom:zdom("fragment",null,fe.tags,zdom("i",{className:"msi-rarrow"})),data:{action:"view_label"},className:i.label?d.themeColorForText:"",child:function(){var e=ue(),t=e.list;return i.label&&"-1"!==i.label&&t.forEach(function(e){e.data.labId===i.label&&(e.className=d.themeColorForText)}),e}}}},he=function(e,t,i,n){zmList.updateListingView(e)},pe=zmText.get("mailTopBar").dropdown.attachments,ge=[{txt:pe.attachViewer,data:{action:"view_attach",isAttachOnly:!0}},{txt:pe.emailsWithAttach,data:{action:"view_attach"}}],ze=function(e,t,i){e.isAttachOnly?zmsuite.isMaxLimitReached()||zmList.loadAttachviewer():zmList.updateListingView(e)},Ie=function(){return e=(zmInit.getListingDetObj()||{}).fId,_zm.isOfflineSyncActive()||zmUtil.isSharedFolder(e)||!zmUtil.isZohoAccount(zmail.accId)?ge.slice(1):ge;var e},we=k.dropdown.selection,be=function(e,t,i,n){zmList.unchkAll(),n.dropDownMenu.remove(),"select_none"!==e.menuType&&zmList.selectEmails({action:e.menuType})},Ce=function(e){var t,i,n,o,a,l,r=(i=zmInit.getListingDetObj().fId,n=zmTab&&"zm_srch1"===zmTab.currentTab,o=[zmail.folId.teId,zmail.folId.dId,zmail.folId.oId],a={selAll:function(){return{txt:we.all,data:{menuType:"select_all"}}},none:function(){return{txt:we.none,data:{menuType:"select_none"}}},unread:function(){if(n||-1===o.indexOf(i)&&i!==zmail.folId.sId)return{txt:we.unread,data:{menuType:"select_unread"}}},read:function(){if(n||-1===o.indexOf(i))return{txt:we.read,data:{menuType:"select_read"}}},flag:function(){if(n||-1===o.indexOf(i))return{txt:we.flagged,data:{menuType:"select_flag"}}},tag:function(){if(n||-1===o.indexOf(i)&&!$.isEmptyObject(zmail.labInfo))return{txt:we.tags,data:{menuType:"select_label"}}},attachment:function(){if(n||-1===o.indexOf(i))return{txt:we.attachments,data:{menuType:"select_attach"}}}},l=[],Object.keys(a).forEach(function(e){(t=a[e]())&&l.push(t)}),l);Y({iconElem:e,menusList:r,onClick:be})},xe=k.dropdown.density,Te=[xe.classic,xe.compact,xe.superCompact],Ae=function(e,t,i,n){n.dropDownMenu.remove(),ZMail.lView.applyDisplayDensity(e.value)},Le=function(e){var i,n;e.menusList=(i=e.higtlightMenuIndex,n=[],["msi-classic","msi-compact","msi-superCompact"].forEach(function(e,t){n.push({dom:zdom("fragment",null,zdom("i",{className:e}),Te[t]),data:{value:String(t)},className:i===t?"zmThmClr":""})}),n),e.onClick=Ae,e.align="pright",Y(e)},ke=function(e,t,i,n){zmList.bindAction(e,t,n.menuClickHanlder)},Se=(s=function(e,t){for(var i=e.length,n=0;n<i;n++)if(zmUtil.getMailObj(e[n],"S")?t.unread=!0:t.read=!0,t.unread&&t.read)return},function(e,t){var i,n,o,a={read:!1,unread:!1},l=zmInit.getListingDetObj(),r=zmsuite.getCenter()[0].getNodes()[2].$el;if(e.length&&s(e,a),a.unread&&a.read)return a;for(n=t.length,o=0;o<n;o++)if((i=zmUtil.getMailObj(t[o])).TS?(a.unread=!0,a.read||(e=zmList.getMailSummaryList(l,i.T)).length&&s(e,a)):(a.read=!0,!a.unread&&r.find("#thd"+i.M).is(":visible")&&(e=zmList.getMailSummaryList(l,i.T)).length&&s(e,a)),a.unread&&a.read)return a;return a}),Oe=function(){var l=k.dropdown.moreAction,e=[{txt:l.markfolderread,data:{action:"folread"}},{txt:l.sweep,data:{action:"sweep"}},{txt:l.conversationOn,data:{action:"conversationOn"}},{txt:l.conversationOff,data:{action:"conversationOff"}}],r=[{txt:l.markasread,data:{action:"read",from:"dropdown"}},{txt:l.markasunread,data:{action:"unread",from:"dropdown"}},{dom:zdom("fragment",null,l.flagas,zdom("i",{className:"msi-rarrow"})),data:{action:"flaglist",from:"dropdown"},child:function(){return zmUtil.isChildWindow()?zmWindow.getFlagMenu():ce({alignment:"cleft",containerId:"zm_dropflag",action:"markFlag",focusCurrView:!1})},align:"cleft"},{txt:l.markspam,data:{action:"spam",from:"dropdown"}},{txt:l.marknotspam,data:{action:"notspam",from:"dropdown"}},{txt:l.forwardasinline,data:{action:"fwdi",from:"dropdown"}},{txt:l.forwardasattachment,data:{action:"FwdAttach"}},{txt:l.forwardmultipleemail,data:{action:"FwdAttach"}},{data:{action:"recall",mId:""}}],t=[],i=zmUtil.isChildWindow()?"window":zmTab.currentTab,s=i===K,d=i===Q,c=zmUtil.getSelectedMails(),m=c[1].length+c[0].length,u={};zmUtil.isChildWindow()?u=$.q("#zmWindowWrapper").data("detail"):s?u=zmInit.getListingDetObj():d?u=zmSearchUtil.getSearchViewDetails():i.indexOf("zm_tab")||(u=zmsuite.getCenterOuter().$el.data("data-detail"));return i!==K&&i!==Q||(t=function(){try{var e=k.menus.labels,t=ZMail.topbar.get().monitor.hiddenElements;if(!t.length)return[];var i,n,o,a=[],l={move:{dom:zdom("fragment",null,e.move,zdom("i",{className:"msi-rarrow"})),data:{action:"moveTo"},customList:{remove:function(){i&&i.hide()},show:function(e){i=ee(e,"cleft")}}},tag:{dom:zdom("fragment",null,e.addtag,zdom("i",{className:"msi-rarrow"})),data:{action:"tagAs"},customList:{remove:function(){n&&n.hide()},show:function(e){n=te(e,"cleft")}}},trash:{txt:e.delete,data:{action:"delete"}},spam:{txt:e.markspam,data:{action:"spam"}},notSpam:{txt:e.marknotspam,data:{action:"notspam"}},archive:{txt:e.archive,data:{action:"archive"}},unArchive:{txt:e.unarchive,data:{action:"unarchive"}}};return t.forEach(function(e){e instanceof $||(e=$.e(e)),o=e.attr("data-action"),l[o]&&a.push(l[o])}),a}catch(e){return zmUtil.debugLog(e),[]}}()),(t=(t=t.concat(function(){r=r.slice();var n,e=!c[1].length&&1===c[0].length&&c[0][0];e&&(n=zmUtil.getMailObj(e,"FD")||u.fId);var t=n===zmail.folId.dId||n===zmail.folId.teId||n===zmail.folId.oId,i={},o=[],a=zmUtil.isChildWindow();return i.readOptions=function(){var e,t=[];if(n===zmail.folId.sId)return[];if(s||d)e=Se(c[0],c[1]);else{e={read:!0,unread:!0};var i=c[0][0];-1===i.indexOf("t")&&(zmUtil.getMailObj(i,"S")?e.read=!1:e.unread=!1)}return e&&e.read&&t.push(r[0]),e&&e.unread&&t.push(r[1]),t},i.markflag=function(){return n===zmail.folId.spId?[]:[r[2]]},i.fwdAsInline=function(){if(a)return[r[5]];var e=zmUtil.getCheckedMailCount();return 1===e||!e&&m?[r[5]]:[]},i.fwdAsMultiple=function(){return zmUtil.isChildWindow()?[]:1===m?[r[6]]:1<m?[r[7]]:[]},i.recall=function(){if(!a&&1===m&&n===zmail.folId.sId){var e=c[0][0],t=Object.assign({},r[8]);if(zmList.haveMailRecallSupport(e)){if(t.data.mId=e,ZMail.utils.isRecallDisabled()){var i=zdom("fragment",null,zdom("span",null," ",l.recall," "),zdom("div",{className:"zmUpgradeTxt"},zdom("i",{className:"msi-fav"}),l.rcUpgrade));t.dom=i,t.className="zmUpgrade nohr",t.data.action="upgrade"}else t.txt=l.recall;return[t]}}return[]},!m||t?[]:(Object.keys(i).forEach(function(e,t){o=o.concat(i[e]())}),o)}())).concat(function(){if(e=e.slice(),zmUtil.isChildWindow())return[];var t={},i=[];return t.markFolRead=function(){return s&&u.fId&&!zmUtil.isSharedFolder(u.fId)&&zmail.folCount[u.fId]&&parseInt(zmail.folCount[u.fId].c)?[e[0]]:[]},t.conversationsOn=function(){if(s&&zmUtil.hasFolSpecConversation(u.fId)&&0===zmUtil.getMLConversionValue())return[e[2]]},t.conversationsOff=function(){if(s&&zmUtil.hasFolSpecConversation(u.fId)&&2===zmUtil.getMLConversionValue())return[e[3]]},t.scrub=function(){return s&&u.fId!==zmail.folId.tId&&m&&!zmUtil.isSharedFolder(u.fId)?[e[1]]:[]},Object.keys(t).forEach(function(e){i=i.concat(t[e]())}),i}())).length||t.push(r[0]),t},ye=function(e,t,i,n){n.dropDownMenu.remove(),zmUtil.isChildWindow()?zmWindow.bindAction(e,t):zmList.bindAction(e,t)},Me=k.dropdown.conversation,Ne=function(e,t,i,n){n.dropDownMenu.remove(),zmList.bindAction(e,t)},Ue=function(e){var t;e.menusList=(t=e.highlightMenuIndex,[{dom:zdom("fragment",null,zdom("i",{className:"msi-conversation"}),Me.conversationOn),data:{action:"conversationOn"},className:2===t?"zmThmClr":""},{dom:zdom("fragment",null,zdom("i",{className:"msi-thread"}),Me.conversationOff),data:{action:"conversationOff"},className:0===t?"zmThmClr":""}]),e.onClick=Ne,e.align="pright",Y(e)},De=function(e){return zmsuite.getCenter(e)[0].getNodes()[1].left.ref.collection},Fe=function(e){return"preview"===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"center")?zmUtil.isChildWindow()?zmWindow.elemObj.header.headerArr.ref.collection:zmsuite.getCenter(e)[1].headerObj.headerArr.ref.collection:zmsuite.getCenter(e)[0].getNodes()[1].right.ref.collection},Ee={checkBox:function(e){var t=$.e(e.target).find("i");t.hasClass(i)||t.hasClass(n)?zmList.unchkAll():zmList.chkAll()},mailSelection:function(e){var t=e.target||e.srcElement;t=$.e(t).closest("."+d.iconElem),Ce(t)}};Ee.views=function(e){var t,i,n,o,a,l,r=$.e(e.target||e.srcElement).closest("li"),s=zmInit.getListingDetObj().fId;s?(n=(t={iconElem:r,folId:s}).folId,o=t.iconElem,a=[],l=zmInit.getListingDetObj(),Object.keys(ve).forEach(function(e){(i=ve[e](n,l))&&(a=a.concat(i))}),Y({iconElem:o,menusList:a,onClick:he})):function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=se(e);Y({menusList:t,onClick:de,iconElem:e.iconElem})}({iconElem:r,folId:s,showViewAllOpt:!0})},Ee.attachment=function(e){var t,i,n,o;t=$.e(e.target||e.srcElement).closest("li"),i=Ie(),n=zmInit.getListingDetObj(),o=i.length-1,"1"===n.attach?i[o].className=d.themeColorForText:i[o].className="",Y({iconElem:t,menusList:i,onClick:ze})},Ee.archivedFilter=function(e){zmList.updateListingView({action:"view_archive"})},Ee.sort=function(e){var t=zmUtil.getFolId(),i=zmfolAction.getSortProperties(t,"type"),n=$.e(e.target||e.srcElement).closest("li");ae({higtlightMenuIndex:i,iconElem:n,fId:t})},Ee.template=function(){zmAppLoader.load("Template").then(function(){zmComponent.createTemplate()})},Ee.noConversationView=function(e){var t=$.e(e.target||e.srcElement).closest("li"),i=zmUtil.getMLConversionValue();Ue({iconElem:t,highlightMenuIndex:i})},Ee.conversationView=function(e){var t=$.e(e.target||e.srcElement).closest("li"),i=zmUtil.getMLConversionValue();Ue({iconElem:t,highlightMenuIndex:i})},Ee.displayDensity=function(e){var t=$.e(e.target||e.srcElement).closest("li"),i=Number(zmAdHocSettings.getListingDisplayDensity());Le({iconElem:t,higtlightMenuIndex:i})},Ee.customization=function(e){var t;t={iconElem:$.e(e.target||e.srcElement).closest("li")},zmAppLoader.load("showHideList").then(function(){var e=(new zmail.mailShowHideList.list).getDropDownConfigList();t.menuClickHanlder=e.clk,Object.assign(t,{menusList:e.list,onClick:ke,align:"pright"}),Y(t)})},Ee.move=function(e){var t=$.e(e.srcElement||e.target).closest("li");zmUtil.isChildWindow()?zmWindow.loadMoveToComponent(t):ee(t)},Ee.tag=function(e){var t=$.e(e.srcElement||e.target).closest("li");zmUtil.isChildWindow()?zmWindow.loadTagComponent(t):te(t)},Ee.delete=function(){zmUtil.isChildWindow()?zmWindow.doActions("delete"):zmList.bindAction({action:"delete"})},Ee.spam=function(){zmUtil.isChildWindow()?zmWindow.doActions("spam"):zmList.bindAction({action:"spam"})},Ee.notSpam=function(){zmUtil.isChildWindow()?zmWindow.doActions("notspam"):zmList.bindAction({action:"notspam"})},Ee.archive=function(){zmUtil.isChildWindow()?zmWindow.doActions("archive"):zmList.bindAction({action:"archive"})},Ee.unArchive=function(){zmUtil.isChildWindow()?zmWindow.doActions("unarchive"):zmList.bindAction({action:"unarchive"})},Ee.outboxSend=function(){zmList.sendOutbox()},Ee.stopSchedule=function(){var e=zmText.get("mail").listing.common.movetoDraft.OutboxtoDraft;zmsDialog.confirm(e,{onOk:function(){return zmList.movetoDraftfromOutbox()}})},Ee.moreAction=function(e){var t,i,n=$.e(e.target||e.srcElement).closest("li");(zmUtil.isChildWindow()||-1!==zmTab.currentTab.indexOf("zm_tab"))&&(t="pright"),(i={iconElem:n,align:t}).menusList=Oe(),i.onClick=ye,Y(i)},Ee[x]=function(){zmUtil.isChildWindow()?zmWindow.bindEventsActionIcons("",z):zmPreviewTemplate.loadPrevMail()},Ee[T]=function(){zmUtil.isChildWindow()?zmWindow.bindEventsActionIcons("",I):zmPreviewTemplate.loadNextMail()},Ee[A]=function(){zmUtil.isChildWindow()&&window.close()};var Ve=function(){var I,w=zmail.folId,c=function(e,t){t.set("visible",!1),!e||e!==K&&e!==Q||ZMail.topbar.get(e).checkAndRemoveElementInHideArray(t.$el)},b={};b[S]=function(e){e.fId;var t=e.lIconCollection.get(S);I?t.set("visible",!1):t.set("visible",!0)},b[N]=function(e){var t=e.lIconCollection,i=e.fId,n=e.isSearchView,o=e.toHide,a=t.get(N),l=zmUtil.getMLConversionValue(i);o||n||0!==l||i===w.dId||i===w.oId||i===w.teId?a.set("visible",!1):a.set("visible",!0)},b[O]=function(e){var t=e.lIconCollection,i=e.fId,n=e.isSearchView,o=e.listView,a=e.toHide,l=e.tabId,r=t.get(O);(a||n||!o.fId||i===w.dId||i===w.oId||zmUtil.isSharedFolder(i)&&92===zmail.shrTree[0][i].RT)&&!o.flag?c(l,r):r.set("visible",!0)},b[M]=function(e){var t=e.lIconCollection,i=e.listView,n=void 0===i?{}:i,o=e.isSearchView,a=e.toHide,l=e.tabId,r=t.get(M),s=n.fId;!a&&!o&&"archive"!==n.view&&s&&(!zmfolAction.isExcludeFolder("archive",s)&&zmfolAction.getModel(s,"IA")||zmUtil.isSharedFolder(s))?r.set("visible",!0):c(l,r)},b[y]=function(e){var t=e.toHide,i=e.lIconCollection,n=e.fId,o=e.isSearchView,a=e.listView,l=e.tabId,r=i.get(y);t||o||!a.fId||n===w.dId||n===w.oId||n===w.teId?c(l,r):r.set("visible",!0)},b[U]=function(e){var t=e.lIconCollection,i=e.fId,n=e.isSearchView,o=e.toHide,a=e.tabId,l=t.get(U);o||i!==w.teId||n||I?c(a,l):l.set("visible",!0)};var C={move:function(e){var t=e.toHide,i=void 0!==t&&t,n=e.fId,o=e.lIconCollection,a=e.tabId,l=o.get(D);i||n===w.spId||n===w.dId||zmUtil.isSharedFolder(n)||n===w.teId||n===w.oId||I?c(a,l):l.set("visible",!0)},label:function(e){var t=e.toHide,i=void 0!==t&&t,n=e.fId,o=e.lIconCollection,a=e.tabId,l=o.get(E);i||n===w.spId||n===w.dId||zmUtil.isSharedFolder(n)||n===w.oId||I?c(a,l):l.set("visible",!0)},trash:function(e){var t=e.toHide,i=e.fId,n=e.lIconCollection,o=e.tabId,a=n.get(V);t||zmUtil.isSharedFolder(i)||I?c(o,a):a.set("visible",!0)},spam:function(e){var t=e.toHide,i=e.fId,n=e.isArchive,o=e.lIconCollection,a=e.tabId,l=o.get(B);i===w.spId||t||n||zmUtil.isSharedFolder(i)||I||i===w.sId||i===w.oId||i===w.teId||i===w.dId?c(a,l):l.set("visible",!0)},notSpam:function(e){var t=e.toHide,i=e.fId,n=e.lIconCollection,o=e.tabId,a=n.get(W);t||i!==w.spId||I?c(o,a):a.set("visible",!0)}};C[j]=function(e){var t=e.toHide,i=e.fId,n=e.lIconCollection,o=e.isArchive,a=e.tabId,l=n.get(j);o||t||zmUtil.isSharedFolder(i)||I||i===w.spId||i===w.teId||i===w.dId||i===w.tId||i===w.oId?c(a,l):l.set("visible",!0)},C[H]=function(e){var t=e.toHide,i=e.fId,n=e.isArchive,o=e.lIconCollection,a=e.tabId,l=o.get(H);!n||t||zmUtil.isSharedFolder(i)||I?c(a,l):l.set("visible",!0)},C.stopSchedule=function(e){var t=e.toHide,i=e.fId,n=e.isSearchView,o=e.lIconCollection,a=e.iconContainer,l=e.tabId;if("preview"!==a){var r=o.get(R);t||i!==w.oId||n||I?c(l,r):r.set("visible",!0)}},C[F]=function(e){var t=e.toHide,i=e.fId,n=e.lIconCollection,o=e.iconContainer,a=e.tabId;if("preview"!==o){var l=n.get(F);t||i!==w.oId||I?c(a,l):l.set("visible",!0)}};var x={};x[P]=function(e){var t=e.toHide,i=e.type,n=e.isSearchView,o=e.isViewTagLay,a=e.fId,l=e.lIconCollection,r=void 0===l?De():l,s=e.tabId,d=r.get(P);t||I||"listing"===i&&(n||o||!zmUtil.isFolderId(a)||a===w.sId||a===w.dId||a===w.oId||a===w.teId||a===w.tId||zmail.folCount[a]&&!Number(zmail.folCount[a].c)&&a===w.spId)||"functional"===i&&(a===w.oId||a===w.teId||a===w.dId)?c(s,d):d.set("visible",!0)};var T={};T[Z]=function(e){var t=e.isSearchView,i=e.fId,n=e.rIconCollection.get(Z);!t&&zmUtil.hasFolSpecConversation(i)&&2===zmfolAction.getFolCV(i)?n.set("visible",!0):n.set("visible",!1)},T[q]=function(e){var t=e.isSearchView,i=e.fId,n=e.rIconCollection.get(q);!t&&zmUtil.hasFolSpecConversation(i)&&0===zmfolAction.getFolCV(i)?n.set("visible",!0):n.set("visible",!1)},T[G]=function(e){e.rIconCollection.get(G).set("visible",!0)},T[J]=function(e){e.rIconCollection.get(J).set("visible",!0)};var A={set:function(e,t){this[e]=t},get:function(e){return this[e]},flush:function(e){delete this[e]}};$.subscribe("mailsuite/appClosed",function(e,t){var i=t.appID;i.indexOf(X)&&i!==K&&i!==Q||A.flush(i)});var L=function(e){if(!zmUtil.isChildWindow()){var t=ZMail.topbar.get(e);t.isMonitoringEnabled&&t.forceArrange()}},k=function(t,i){Object.keys(t).forEach(function(e){t[e](i)})};return{renovate:function(e){w=zmail.folId;var t=zmUtil.isChildWindow(),i=e.msgId,n=e.tabId,o=void 0===n?!t&&zmTab.currentTab:n,a=e.type,l=e.toHide,r=void 0!==l&&l,s=e.isSearchView,d=void 0!==s&&s,c=e.fId,m=e.view;if("zmStreamsApp"!==o&&(zmUtil.isChildWindow()||!o.indexOf(X)?e.iconContainer="preview":e.iconContainer="center",e.rIconCollection=Fe(o,e.iconContainer),"center"===e.iconContainer?e.lIconCollection=De(o):e.lIconCollection=e.rIconCollection,e.rIconCollection.length&&e.lIconCollection.length)){var u,f,v,h,p=t&&{}||d&&{fId:zmSearchUtil.getSearchedFolders()[0]}||m||zmInit.getListingDetObj()||{};if(c=e.fId=i&&zmList.getMailObj(i).FD||c||p.fId||void 0,e.isArchive=(f=(u={tabId:o,msgId:i,listView:p}).tabId,v=u.msgId,h=u.listView,!!(f===K&&Object.keys(h).length&&"archive"===h.view||v&&zmUtil.getMailObj(v,"AR"))),e.listView=p,e.isViewTagLay=!t&&o===K&&("zmlviewH"===zmail.mailLeft.selLayerId||"zmllabelH"===zmail.mailLeft.selLayerId)||!1,a&&(d||t||e.isViewTagLay||c&&Object.keys(p).length)||(e.listView={fId:c}),I=ZMail.utils.isROMode(c),"functional"!==a||r)if("functional"===a&&r){if(!e.isForceHide&&zmPrev.prevDetails(e.tabId).msgId||zmList.getSelectedRowCount())return void L(e.tabId);k(C,e),e.toHide=!1,e.type="listing",x[P](e),o===K&&k(b,e),A.set(e.tabId,{})}else"listing"===a&&(k(b,e),k(x,e),k(T,e));else{if(I)return void((o&&!o.indexOf(X)||t)&&(e.toHide=!0,k(C,e)));var g={fId:c,isArchive:e.isArchive,isSearchView:d},z=A.get(o)||{};_.isEqual(z,g)||(k(C,e),k(x,e),A.set(o,g),e.toHide=!0,o===K&&k(b,e))}L(e.tabId)}},renovateIcon:function(e){var t=e.icon,i=e.type,n=e.fId,o=x[t]||b[t]||C[t]||T[t];o&&o({type:i,fId:n})}}}(),Be=k.menus.labels,We=[{type:"icon",id:S,iconClass:e,callback:Ee.checkBox,moreAction:{iconClass:"msi-barrow",callback:Ee.mailSelection},visible:!1},{useAdhoc:!0,id:O,iconClass:t,tooltip:Be.views,text:Be.views,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.views,visible:!1},{useAdhoc:!0,id:M,iconClass:a,tooltip:Be.archiveFilter,text:Be.archiveFilter,callback:Ee.archivedFilter,visible:!1,noOfColorIcon:1},{useAdhoc:!0,id:y,iconClass:o,tooltip:Be.attachFilter,text:Be.attachFilter,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.attachment,visible:!1},{useAdhoc:!0,id:N,iconClass:l,tooltip:Be.sortBy,text:Be.sortBy,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.sort,visible:!1},{type:"iconText",id:U,text:Be.newTemplate,iconClass:r,tooltip:Be.newTemplate,callback:Ee.template,visible:!1,haveThemeColor:!0}],_e=[{useAdhoc:!0,id:D,iconClass:c,text:Be.move,tooltip:Be.move,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.move,visible:!1},{useAdhoc:!0,id:E,iconClass:m,tooltip:Be.addtag,text:Be.addtag,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.tag,visible:!1},{useAdhoc:!0,id:V,iconClass:u,tooltip:Be.delete,text:Be.delete,callback:Ee.delete,visible:!1,haveSeparator:!0},{useAdhoc:!0,id:B,iconClass:f,tooltip:Be.markspam,text:Be.markspam,callback:Ee.spam,visible:!1},{useAdhoc:!0,id:W,iconClass:v,tooltip:Be.marknotspam,text:Be.marknotspam,callback:Ee.notSpam,visible:!1},{useAdhoc:!0,id:j,iconClass:h,tooltip:Be.archive,text:Be.archive,callback:Ee.archive,visible:!1,haveSeparator:!0},{useAdhoc:!0,id:H,iconClass:p,tooltip:Be.unarchive,text:Be.unarchive,callback:Ee.unArchive,visible:!1}],je=[{type:"iconText",id:F,iconClass:"msi-send",text:Be.sendnow,tooltip:Be.sendnow,callback:Ee.outboxSend,haveThemeColor:!0,visible:!1},{type:"iconText",id:R,iconClass:g,tooltip:Be.stopSchedule,text:Be.stopSchedule,callback:Ee.stopSchedule,visible:!1,dangerIcon:!0}],$e=[{type:"icon",id:P,iconClass:"msi-action",tooltip:Be.moreact,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.moreAction,visible:!1,haveSeparator:!0}],He=[{type:"icon",id:q,iconClass:"msi-thread",tooltip:Be.convSettings,visible:!1,callback:Ee.noConversationView},{type:"icon",id:Z,iconClass:"msi-conversation",tooltip:Be.convSettings,visible:!1,callback:Ee.conversationView},{type:"icon",id:J,iconClass:"msi-classic",tooltip:Be.chgview,visible:!1,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.displayDensity},{type:"icon",id:G,iconClass:"msi-customList",tooltip:Be.showHideField,visible:!1,dropDown:{selectorClassName:d.dropDownConnector},callback:Ee.customization}],Re=[{type:"icon",id:x,iconClass:z,tooltip:Be.prev,visible:!0,callback:Ee[x]},{type:"icon",id:T,iconClass:I,tooltip:Be.next,visible:!0,callback:Ee[T]},{type:"icon",id:A,iconClass:b,tooltip:Be.close,visible:!0,callback:Ee[A]}],Pe=zdom("span",{className:d.separatorIcon}),Ze=function(e){var t=e.count,i=void 0===t?0:t,n=e.isLink,o=void 0===n||n,a=e.folderInfoText,l=void 0===a?{}:a;if(i){var r,s=[C.viewInfo];return o?s.push(d.link,C.unreadLink):s.push(d.greyedText),s=s.join(" "),r=1===i?l.singleMsg||i+" "+k.titleBar.unreadEmail:l.multipleMsgs||i+" "+k.titleBar.unreadEmails,zdom("span",{className:s},r)}},qe=function(e){var t,i=[d.greyedText,C.selectedCount].join(" ");return t=zmInit.listingBand.isBulkActionSet?k.titleBar.selectedAll:1===e?e+" "+k.titleBar.selectedEmail:e+" "+k.titleBar.selectedEmails,zdom("span",{className:i},t)},Ge=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=[C.viewInfo],n="";return t&&(n=zdom("i",{className:d.closeIcon}),i=[d.filterBtn,C.viewInfo],e=zdom("span",{className:"zmFCBubValue"},e)),i=i.join(" "),zdom("span",{className:i},e,n)},Je=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:K;return zmsuite.getCenter(e)[0].getNodes()[1].titleBar.$el},Ke=function(e){if("zmStreamTree"!==zmail.mailLeft.selLayerId){var t=Je();if("notification"!==e||!t.find("."+C.selectedCount).is(":visible")){var i,n=zmail.mailLeft.selId,o=zmail.mailLeft.getSelectedRowObj()[n],a=o.FN||o.dispName||o.name,l=zmInit.getListingDetObj();i=zdom("fragment",null,zdom("strong",null," ",a," "));var r=function(e){var t,i=e.selId,n=e.viewDetails,o=zmUtil.isSharedFolder(i),a=zmText.get("mail").listing,l={"-1":a.headertitle.flagmsg,1:a.headertitle.infoflagmsg,2:a.headertitle.impflagmsg,3:a.headertitle.followupmsg},r=zmail.folCount[i],s=r&&r.c;if("zm_unread"===i)t=Ze({count:zmInit.getUnreadViewCount(),isLink:!1});else if("zm_flag"===i){var d="-1"!==n.flag;t=Ge(l[n.flag],d)}else if(r||o)if(n.flag)t=Ge(l[n.flag]);else if(n.label)if("-1"===n.label)t=Ge(a.headertitle.alltagged);else{var c=zmText.applyArgs(a.headertitle.filteredtag,{tagname:zmUtil.findTagName(n.label)});t=Ge(c)}else if("1"===n.attach)t=Ge(a.headertitle.attachview);else if("archive"===n.view)t=Ge(a.headertitle.archiveview);else if("unread"===n.view){var m;m=i===zmail.folId.sId||o?a.headertitle.unreadEmails:parseInt(s)?1===s?a.headertitle.singleunread:zmText.applyArgs(a.headertitle.multipleunread,{n:s}):a.headertitle.noUnreadEmails,t=Ge(m)}else if("date"===n.sortBy&&n.sortOrder)t=Ge(a.headertitle.oldestOnTop);else if("size"===n.sortBy){var u=n.sortOrder?a.headertitle.smallestOnTop:a.headertitle.largestOnTop;t=Ge(u)}else if(0<s&&!zmInit.excludedFolders("headerBand").includes(i)){var f={},v=!1;i===zmail.folId.oId?(f.singleMsg=a.headertitle.singleunreadOutbox,f.multipleMsgs=zmText.applyArgs(a.headertitle.multipleunreadOutbox,{n:s})):i===zmail.folId.sId?(f.singleMsg=a.headertitle.sUndeliveredCount,f.multipleMsgs=zmText.applyArgs(a.headertitle.mUndeliveredCount,{n:s})):v=!0,t=Ze({count:parseInt(s),folderInfoText:f,isLink:v})}return t}({selId:n,viewDetails:l});r&&(i.appendChild(Pe),i.appendChild(r)),t.appendDOM(i,{clear:!0});var s=t.find("."+C.unreadLink);s.length&&n!==zmail.folId.oId&&n!==zmail.folId.sId&&s.off("click").on("click",function(){zmList.showMailListing({folId:n,view:"unread"})}),t.off("click").on("click","."+d.filterBtn,function(){("date"===l.sortBy&&l.sortOrder||"size"===l.sortBy)&&zmList.updateSortProperties(0,n),zmList.showMailListing({folId:n})})}}},Qe=zmail.Core.Namespaces.create("ZMail.topbar");Qe.icons={getLeftElem:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:K;return zmsuite.getCenter(e)[0].getNodes()[1].menuBar.$el},getRightElem:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:K;return"preview"===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"center")?zmUtil.isChildWindow()?zmWindow.elemObj.header.headerArr.ref.$el:zmsuite.getCenter()[1].getNodes()[0].headerArr.ref.$el:zmsuite.getCenter(e)[0].getNodes()[1].right.ref.$el},renovate:Ve.renovate,renovateIcon:Ve.renovateIcon,model:{get:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"all",i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n={};return"mails"===t||"functional"===t?n=_e.concat($e,(e=i?Re.slice(0,2):[],zmUtil.isChildWindow()&&e.push(Re[2]),e)):(n.left="all"===t||"search"===t?We.concat(je):We,n.left=n.left.concat(_e),n.left=n.left.concat($e),n.right=He,n)}},getIconElem:function(e){var t,i=e.tabId,n=void 0===i?K:i,o=e.iconName,a=e.type;return t="left"===(void 0===a?"left":a)?De(n):Fe(n),$.e(t.get(o).$el)},initResizeHandler:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:K,t=ZMail.topbar.get(e),i=t.$el,n=i.closest(".SCm"),o=i.find("#jsAppNameIcons").children().eq(0),a=i.find(".msi-action").closest("li");t.initMonitor({container:n,groupToMonitor:o,moreIcon:a,padding:{additionalPadding:20},iconContainer:zmsuite.getCenter(e)[0].getNodes()[2].$el,minIconWidth:30})},chatletMenuConfig:function(e){var t=e.count;t&&-1!==t||(t="");var i=zmText.get("mailsuite"),n=zmText.applyArgs(i.tooltips.chatlet,{entity:i.entity[1]}),o={useAdhoc:!0,id:L,visible:!0,noOfColorIcon:2,iconClass:w,text:k.menus.labels.chatlet,tooltip:n,callback:function(e){var t=$.e(e.target||e.srcElement).closest("li")[0];zmUtil.createContexualChat("",t)}};return o.customDOM=zdom("span",{className:"zmBadge roundBadge bgBadge thmBadge"},t),t&&(o.dropDown={selectorClassName:"zmAMddOnB"}),o},chatletTemplate:function(e){var t=e.count,i=void 0===t?0:t,n=zdom("i",{className:"msi-cliqColor"},zdom("i",{className:"path1"}),zdom("i",{className:"path2"}));return 0<i&&(n=zdom("fragment",null,zdom("span",{className:"zm_mct zmThmBG"},i),n)),n},updateAttribute:function(e){var t=e.iconName,i=e.tabId,n=e.key,o=e.value,a=e.container,l=void 0===a?"preview":a,r=("preview"===l||"right"===l?Fe(i,l):De(i)).get(t);r&&r.set(n,o)}},Qe.header={renovate:Ke,getElem:Je,updateSelectionInfo:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:zmTab.currentTab,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:zmUtil.getCheckedMailCount(),a=Je(e),t={};t[K]=function(){var e=a.find("."+C.viewInfo);if(0===o)Ke();else{e.length?e.remove():a.appendDOM(Pe);var t=a.find("."+C.selectedCount);t.length&&t.remove();var i=qe(o);a.appendDOM(i)}},t[Q]=function(){a.find("."+C.selectedCount).remove();var e=a.find("."+C.savedSearch),t=a.find(".zmToggleBBtn"),i=a.find("."+C.spamFilterSeparator);if(0===o)e.show(),t.show(),i.show();else{e.hide(),t.hide(),i.hide();var n=qe(o);a.appendDOM(n)}},t[e]&&t[e]()},searchHeaderTemplate:function(){return zdom("fragment",null,zdom("strong",null," ",k.searchTitleBar.title," "),zdom("span",{className:"zmSDot "+C.savedSearchSeparator}),zdom("span",{className:d.link+" "+C.savedSearch,"data-data-event":"savesearch"},k.searchTitleBar.saveSearch),zdom("span",{className:"zmSDot "+C.spamFilterSeparator}),zdom("div",{className:"zmToggleBBtn smallBtn zmHideD zmDisabled"},zdom("span",{className:"zmTBBtxt zmLink","data-data-event":"spamToggle"},k.searchTitleBar.includeSpamTrash),zdom("span",{className:"zmTBBWra","data-data-event":"spamToggle"},zdom("span",{className:"zmTBBswitch","data-data-event":"spamToggle"}))))}},Qe.getElem=function(e){return zmsuite.getCenter(e)[0].getNodes()[1].$el},Qe.get=function(e){return zmsuite.getCenter(e)[0].getNodes()[1]}}(),window.__rollupModule=void 0;