"use strict";!function(){var o=zmail.Utils.DOM,r="default",h="custom",i="moreFilters",s="lessFilters",u=function(e){return e},a=function(e,t){t.str?e.text(t.str):t.$el&&o.mount(t.$el,e)},c={LIST_CLASS:"js-dropmenu",LIST_ITEM_CLASS:"js-dropmenuitem",LIST_WRAPPER_CLASS:"js-wrapper",SCROLL_CLASS:"zmDDScroll",MORE_FILTERS_CLASS:"js-more-filters",LESS_FILTERS_CLASS:"js-less-filters",ZOHO_ONE_SEARCH_CLASS:"js-zone-dropmenuitem",default:function(e,t){var n=o.element(zdom("li",{className:c.LIST_ITEM_CLASS,"data-menuid":t}));return a(n,e),n},header:function(e,t){var n=o.element(zdom("li",{className:"nohr dd_label"}));return a(n,e),n},custom:function(e,t){return o.addClass(e,c.LIST_ITEM_CLASS),o.setData(e,"menuid",t),e},separator:function(){return o.element(zdom("li",{className:"SC_lne"}))},moreFilters:function(e,t){var n=o.element(zdom("font",{className:"SC_thm cursorPointer"})),i=o.element(zdom("li",{className:c.LIST_ITEM_CLASS+" "+c.MORE_FILTERS_CLASS,"data-menuid":t}));return a(n,e),a(i,{$el:n}),i},lessFilters:function(e,t){var n=o.element(zdom("font",{className:"SC_thm cursorPointer"})),i=o.element(zdom("li",{className:c.LIST_ITEM_CLASS+" "+c.LESS_FILTERS_CLASS,"data-menuid":t}));return a(n,e),a(i,{$el:n}),i},zohoOneSearch:function(e,t){var n=o.element(document.createDocumentFragment()),i=o.element(zdom("li",{className:c.LIST_ITEM_CLASS+" "+c.ZOHO_ONE_SEARCH_CLASS,"data-menuid":t}));return a(n,{$el:o.element(zdom("li",{className:"SC_lne "+c.ZOHO_ONE_SEARCH_CLASS}))}),a(i,e),a(n,{$el:i}),n},bubble:function(e,t){var n="zmSearchBub zmSBC "+c.LIST_ITEM_CLASS,i=o.element(zdom("div",{className:n,"data-menuid":t}));return e.selected&&i.addClass("sel"),i.text(e.name),e.iconClass&&o.mountAtStart(zdom("i",{className:e.iconClass}),i),i},bubbles:function(e,n){var t=o.element(zdom("li",{className:"nohr"},zdom("div",{className:"zmSAS"}))),i=t.find(".zmSAS");return e.bubbles.forEach(function(e,t){o.mount(c.bubble(e,n+"."+t),i)}),t},listItems:function(){var n,i,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=t.template||u,a=t.$parent||o.element(document.createDocumentFragment()),l=t.baseIndex||0;return e.forEach(function(e,t){e=s(e),_.isString(e)?(n=r,e={str:e}):e.str||e.templateType||e.$el?(n=e.templateType||r,e.$el="zohoOneSearch"===e.templateType?o.element(e):""):(e=o.element(e),n=e.hasClass(c.LIST_ITEM_CLASS)?h:(e={$el:e},r)),i=c[n],o.mount(i(e,l+t),a)}),a},list:function(e,t){var n=o.element(zdom("div",{className:"SC_dd shw zmSearchDD js-list-container"},zdom("div",{className:c.LIST_WRAPPER_CLASS+" "+c.SCROLL_CLASS},zdom("ul",{className:c.LIST_CLASS}))));return t=t||{},n.find("."+c.LIST_WRAPPER_CLASS).addClass(t.wrapperClass||""),t.$parent=n.find("."+c.LIST_CLASS),t.$parent.addClass(t.ulClass||""),t.baseIndex=0,c.listItems(e,t),n}},e=function(){},l=zmail.Utils.DOM,n=zmail.Traverser,d=zmail.Paginator,m=$.Deferred,v=$.publish,f="ZMAIL_MOUSE_DOWN_EVENT",p=9,S=38,g=40,E=13,C=27,t=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(babelHelpers.classCallCheck(this,t),!(this instanceof t))return new t(e);this.init(e),this.handleSelection=_.debounce(this.handleSelection.bind(this),300,!0)}return babelHelpers.createClass(t,[{key:"getDefaults",value:function(){return{__eventFlag:!1,__active:!0,___callingInstance:void 0,selectionClass:"sel",wrapperClass:"",ulClass:"",bindEventsForElement:!0,forElementDebounceTime:0,hideOnRemove:!1,removeOnSelect:!0,removeOnMouseDown:!0,removeOnEscape:!0,$for:void 0,$parent:l.element(document.body),$left:void 0,$top:void 0,$right:void 0,$bottom:void 0,list:void 0,nextPageList:void 0,doPaginate:!0,paginator:void 0,pageSize:10,paginateThreshold:30,paginateScrollPercentage:80,selectionStartIndex:-1,autoComplete:!0,onKeyEvent:e,__bindable:["handleClickEvent","handleKeyEvent","handleMouseDownEvent","handleInputAndChangeEvent","handlePagination","template"],onShow:e,onHide:e,onSelect:e,onRemove:e,onMouseDown:e}}},{key:"bindFunctions",value:function(){return this.__bindable.reduce(function(e,t){return e[t]=e[t].bind(e),e},this)}},{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,this.getDefaults(),e),this.traverser=this.traverser||new n({skip:this.skip,startIndex:this.selectionStartIndex}),this.bindFunctions().bindEvents$For().setPaginator(),e.stopInitPagination||this.paginate()}},{key:"skip",value:function(e,t){var n=e&&e.templateType;return"separator"===n||"header"===n}},{key:"show",value:function(){return this.hasElement()&&this.__active&&(this.hasPage()?(this.bindEvents().$el.show(),this.$for&&this.$for.focus(),this.onShow()):this.hide()),this}},{key:"hide",value:function(){return this.hasElement()&&(this.traverser.resetIndex(),this.paginator.resetPage(),this.unbindEvents().$el.hide(),this.onHide()),this}},{key:"reset",value:function(){return this.traverser.reset(),this.paginator.reset(),this}},{key:"remove",value:function(){return this.hideOnRemove?this.hide():this.reset().unbindEvents$For().unbindEvents().removeDOM().onRemove(),this}},{key:"removeDOM",value:function(){return this.hasElement()&&this.$el.remove(),this}},{key:"removePreviousListElements",value:function(){return l.unmount(l.selector("div.js-list-container"),!0),this}},{key:"paginate",value:function(e,t){var i=this;return this.__active?(zmail.Search.ViewInstance.___activeList=this).paginator.next(e,t).then(function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};i.list=i.list||[],t?(i.list=e,i.nextPageList=void 0):(i.nextPageList=e,i.baseIndex=i.list.length,i.list=i.list.concat(e)),i.traverser.set({list:i.list}),i.render(n)},function(){i.hide()}):m().reject().promise()}},{key:"render",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.paginator.isFirstPage()?(this.hasElement()&&this.unbindEvents().$el.remove(),this.removePreviousListElements().compileTemplate(e).setPosition().mount().setHeight().setWidth().show().select()):(this.compileTemplate(e),this.isAppendedToParent()||this.mount(),this.show()),this}},{key:"bindMouseEvents",value:function(){var t=this;this.hasElement()&&this.$el.find("li").off("mouseenter").on("mouseenter",function(){l.element(this).on("mousemove",function(){var e=l.element(this).prevAll().length;t.traverser.index=e,l.element(this).parent().children().removeClass(t.selectionClass),l.addClass(this,t.selectionClass)})}).off("mouseleave").on("mouseleave",function(){l.removeClass(this,t.selectionClass),t.traverser.resetIndex()})}},{key:"compileTemplate",value:function(){return this.paginator.isFirstPage()?this.$el=c.list(this.list,{template:this.template,ulClass:this.ulClass,wrapperClass:this.wrapperClass}):(this.$el=this.$el||this.getListContainer(),c.listItems(this.nextPageList,{$parent:this.getListElement(),baseIndex:this.baseIndex,template:this.template}),this.bindMouseEvents()),this}},{key:"setPosition",value:function(){return this.$el.css(_.result(this,"position")),this}},{key:"mount",value:function(){return l.mount(this.$el,this.$parent),this}},{key:"isAppendedToParent",value:function(){return $.e(this.$parent).has(this.$el).length}},{key:"isZohoOneSearchContext",value:function(){return this.$el.find(".js-zone-dropmenuitem").eq(0)[0]}},{key:"getChildHeight",value:function(){var n=this.getListElement().children(),i=0;return n.each(function(e,t){l.hasClass(t,"SC_lne")?i+=l.element(n[e-1]||n[e+1]||t).outerHeight():i+=l.element(t).outerHeight()}),i}},{key:"getAverageChildHeight",value:function(){return this.getChildHeight()/this.getListElement().children().length}},{key:"setHeight",value:function(){if(this.hasElement()){var e=0;if(this.isZohoOneSearchContext())e=this.getChildHeight();else{var t=this.getAverageChildHeight();e=t*this.paginator.getPageSize(),this.paginator.hasMoreToFetch&&(e-=t)}this.getListWrapperElement().css({"max-height":e})}return this}},{key:"setWidth",value:function(){return this.hasElement()&&this.maxWidth&&this.$el.css({"max-width":this.maxWidth}),this}},{key:"setPaginator",value:function(){return this.paginator instanceof d||(this.paginator=d({provider:this.list||[],pageSize:this.pageSize,threshold:this.paginateThreshold})),this}},{key:"position",value:function(){var e={top:0,left:0};return this.$left?e.left=this.$left.offset().left:this.$right&&(e.left=this.$right.offset().left+this.$right.outerWidth()),this.$top?e.top=this.$top.offset().top+this.$top.outerHeight():this.$bottom&&(e.top=this.$bottom.offset().top),e}},{key:"hasElement",value:function(){return void 0!==this.$el}},{key:"isVisible",value:function(){return this.hasElement()&&this.$el.is(":visible")}},{key:"hasPage",value:function(){return this.list&&this.list.length}},{key:"getListWrapperElement",value:function(){return this.$el.find("."+c.LIST_WRAPPER_CLASS)}},{key:"getListElement",value:function(){return this.$el.find("."+c.LIST_CLASS)}},{key:"getListContainer",value:function(){return this.$el||l.selector("div.js-list-container")}},{key:"getSelectedIndex",value:function(){return this.traverser.index}},{key:"scrollIntoView",value:function(e){return e&&e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded(!1):e&&e.scrollIntoView&&e.scrollIntoView(!1),this}},{key:"selectMenuItem",value:function(){var e="[data-menuid="+this.selectedMenu+"]",t=this.$el.find(e);return t.addClass(this.selectionClass),this.scrollIntoView(t[0]),this}},{key:"unselectMenuItem",value:function(){return this.$el.find("."+this.selectionClass).removeClass(this.selectionClass),this}},{key:"select",value:function(){return this.selectedMenu=this.getSelectedIndex(),this.unselectMenuItem().selectMenuItem(),this}},{key:"getSelected",value:function(){var e,t=this.list;if(!_.isEmpty(t)){var n=String(this.selectedMenu).split(".");if(1===n.length){if(e=t[this.selectedMenu],_.isString(e)){var i=zmail.Search.SearchWatcher.getCurrentContext(),s={name:e},a=i.classMap&&i.classMap[e];s.description=this.$el.find("li[data-menuid='"+this.selectedMenu+"']").find(".greyText").eq(0).text(),a&&"function"==typeof a.getDefaultValue&&(s.value=a.getDefaultValue()),s.value&&s.description!==a.description&&(e=s)}}else 2===n.length&&(e=t[n[0]].bubbles[n[1]])}return e}},{key:"isSelected",value:function(){return this.isVisible()&&void 0!==this.getSelected()}},{key:"handleSelection",value:function(e){var t=this.getSelected(),n=zmail.Search.ViewInstance.SearchBox;if(t&&t.__isZohoOneSearch)_zm&&"function"==typeof _zm.openZohoOneSearch&&(_zm.openZohoOneSearch(e),v("mailsuite/searchClose"));else{if(t&&t.templateType===i)return this.remove(),n.select({showFilters:"more"}),this;if(t&&t.templateType===s)return this.remove(),n.select({showFilters:"less"}),this;this.onSelect(t)}return t&&t.__keepAutofill||(this.removeOnSelect?this.remove():this.hide()),this}},{key:"handleClickEvent",value:function(e){if(zmUtil&&"function"==typeof zmUtil.hideMenu&&zmUtil.hideMenu(!0),l.element(l.element(e.target).closest("."+c.ZOHO_ONE_SEARCH_CLASS),!0))_zm.openZohoOneSearch(e),v("mailsuite/searchClose");else{var t=l.element(e.target).closest("."+c.LIST_ITEM_CLASS).data("menuid");this.selectedMenu=t,this.handleSelection(e)}e.stopPropagation(),e.stopImmediatePropagation()}},{key:"handleMouseDown",value:function(e){e.stopImmediatePropagation()}},{key:"isClickedOnScrollBar",value:function(e){var t=this.$el,n=l.element(l.selector("ul",this.$el)),i=t.offset().left,s=n.outerWidth()+i,a=t.outerWidth(!0)+i;return s<=e&&e<=a}},{key:"ignoreMouseDownEvent",value:function(e){return!1}},{key:"handleMouseDownEvent",value:function(e,t){this.ignoreMouseDownEvent(t)||this.isClickedOnScrollBar(t.clientX)||(this.removeOnMouseDown?this.remove():this.hide(),this.onMouseDown())}},{key:"onEscape",value:function(){zmail.Search.ViewInstance.SearchBoxContainer.collapseSearch({blur:!0})}},{key:"handleKeyEvent",value:function(e){var t=e.keyCode;if(t===S||t===g){var n=t===g?1:-1;this.traverser.traverse(n),this.select(),this.isVisible()&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}else if(t===E)this.selectedMenu=this.getSelectedIndex(),this.handleSelection(e),e.preventDefault();else if(t===p&&!e.shiftKey&&this.isVisible())this.selectedMenu=this.getSelectedIndex(),0<=this.selectedMenu&&(this.handleSelection(e),e.preventDefault());else if(t===C)this.removeOnEscape?this.remove():this.hide(),this.onEscape();else{if((this.opts||{}).isContextFilter)zmail.Search.Utils.ShortcutUtil.handleIfShortcut(e);this.onKeyEvent(e)}}},{key:"isActiveElement",value:function(){var e=document.activeElement,t=this.$for&&this.$for[0];return void 0!==e&&e===t}},{key:"handleInputAndChangeEvent",value:function(e){if(this.bindEventsForElement&&this.isActiveElement()){var t=l.element(e.target),n=(t.val()||t.text()||"").trim();this.paginate(n)}}},{key:"handlePagination",value:function(e){if(this.doPaginate){var t=this.getListWrapperElement(),n=Math.round(100*(t[0].scrollTop+t.height())/t[0].scrollHeight);this.paginator.hasMoreToFetch&&this.paginateScrollPercentage<=n?this.paginate(this.paginator.query):(e.preventDefault(),e.stopPropagation())}}},{key:"bindEvents$For",value:function(){return this.bindEventsForElement&&this.$for&&(0<this.forElementDebounceTime&&(this.handleInputAndChangeEvent=_.debounce(this.handleInputAndChangeEvent,this.forElementDebounceTime)),this.$for.on("change input",this.handleInputAndChangeEvent)),this}},{key:"unbindEvents$For",value:function(){return this.bindEventsForElement&&this.$for&&this.$for.off("change input",this.handleInputAndChangeEvent),this}},{key:"bindEvents",value:function(){return this.__eventFlag||(this.__eventFlag=!0,this.hasElement()&&(this.getListWrapperElement().on("scroll",this.handlePagination),this.$el.on("click","."+c.LIST_ITEM_CLASS,this.handleClickEvent),this.$el.on("mousedown",this.handleMouseDown),$.subscribe(f,this.handleMouseDownEvent)),this.bindMouseEvents(),this.$parent&&this.$parent.off("keydown").on("keydown",this.handleKeyEvent)),this}},{key:"unbindEvents",value:function(){return this.__eventFlag&&(this.__eventFlag=!1,this.hasElement()&&(this.getListWrapperElement().off("scroll",this.handlePagination),this.$el.off("click","."+c.LIST_ITEM_CLASS,this.handleClickEvent),this.$el.off("mousedown",this.handleMouseDown),this.$el.find("li").off("mouseenter").off("mouseleave"),$.unsubscribe(f,this.handleMouseDownEvent)),this.$parent&&this.$parent.off("keydown",this.handleKeyEvent)),this}},{key:"bind",value:function(){return this.__active||(this.__active=!0,this.bindEvents$For()),this}},{key:"unbind",value:function(){return this.__active&&(this.__active=!1,this.hide().unbindEvents$For()),this}},{key:"text",value:function(e){return e}},{key:"dom",value:function(e){}},{key:"template",value:function(e){return this.dom(e,this.paginator)||this.text(e,this.paginator)}},{key:"change",value:function(e,t){return this.paginate(e,t)}}]),t}();zmail.Core.Namespaces.create("zmail.SearchComponents").ListView=t}(),window.__rollupModule=void 0;