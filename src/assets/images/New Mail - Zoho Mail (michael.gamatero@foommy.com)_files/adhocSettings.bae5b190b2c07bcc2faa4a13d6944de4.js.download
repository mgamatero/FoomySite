"use strict";define([],function(e){var t=e("zmail.Core.Namespaces").create("zmAdHocSettings"),a={STRING:"STRING",JSON:"JSON"},n={siteTour:{default:"unvisited",values:["visited","unvisited","v1","v2","whatsnew","TOT"]},appTour:{dataType:a.JSON,structure:{mail:{default:"unvisited",values:["v1","v2","unvisited"]},compose:{default:"unvisited",values:["v1","v2","unvisited"]},notes:{default:"unvisited",values:["v1","v2","unvisited"]},task:{default:"unvisited",values:["v1","v2","unvisited"]},calendar:{default:"unvisited",values:["v1","v2","unvisited"]},streams:{default:"unvisited",values:["v1","v2","unvisited"]},attachmentViewer:{default:"unvisited",values:["v1","v2","unvisited"]},setting:{default:"unvisited",values:["v1","v2","unvisited"]}},templateName:"AppTour"},theme:{default:"theme1",values:["theme1","theme2","theme3","theme4","theme5","theme6","theme7","theme8","theme9","theme10","theme11"]},leftOrder:{default:"zmStreamTree,zmlTreeH,zmlSTreeH,zmllabelH,zmlviewH,zmlSSrchTreeH",values:""},appOrder:{default:"mail,cal,task,notes,contacts,links",values:""},lastUsedUI:{default:"unknown",values:["unknown","biz","zm","zm_only","tot","tot_only"]},font:{default:"Lato",values:["Lato","PT Sans","Arial","Lato 2"]},uiState:{dataType:a.JSON,templateName:zmail.showFeature?"UIState":null,structure:null},lPageType:{default:"none",values:""},composeType:{default:"1",values:["1","2"]},streamsListType:{default:"default",values:["default","grid","list"]},whatsNewSeen:{dataType:a.STRING},totUI:{default:"false",values:["true","false"]},suppressedMessagesState:{dataType:a.JSON,structure:{conversationAction:{default:"on",values:["on","off"]},mailShareTip:{default:"on",values:["on","off"]},conversationShareWarning:{default:"on",values:["on","off"]}},templateName:"SuppressedMessagesState"},leftLayerState:{dataType:a.JSON},mailViewSettings:{dataType:a.JSON,structure:{headerState:{default:"c",values:["e","c"]}},templateName:"MailViewSettings"},helperBlockVisibility:{default:"1",values:["0","1"]},conversationActionType:{default:"1",values:["1","2"]},markConversationRead:{default:"0",values:["0","1"]},bizBannerMsg:{default:"no_msg",values:""},accountsLhsOrder:{default:"-no_acc-",values:""},whatsNewVersion:{dataType:a.JSON},allAppsLeftOrder:{dataType:a.JSON},listingDisplayDensity:{default:"0",values:["0","1","2"]},mailSoundNotifier:{default:"0",values:["0","1","2","3","4","5"]},streamSoundNotifier:{default:"0",values:["0","1","2","3","4","5"]},projectInteg:{dataType:a.JSON},nightMode:{default:"0",values:["0","1"]},streamsGroupMgmt:{default:"0",values:["0","1"]},streamsGroupImg:{default:"1",values:["0","1"]},streamsAppMsg:{default:"0",values:["0","1"]},commentBoxView:{default:"0",values:["on","off"]},notes:{dataType:a.JSON,templateName:"Notes",structure:null},bookMarks:{dataType:a.JSON,templateName:"BookMarks",structure:null},attachComp:{dataType:a.JSON,templateName:"AttachComp",structure:null},calServiceName:{default:"zcal",values:["zcal","zcrm"]},onBoardingPage:{dataType:a.STRING},hotKeysOnboarding:{default:"0",values:["0","1","2"]},hugeAttOnBoarding:{default:"0",values:["0","1"]},grammarSpellcheck:{default:"0",values:["0","1"]},workdriveInteg:{default:"0",values:["0","1"]},timeZoneChangeDetect:{default:"0",values:["0","1"]},undoSendMsg:{default:"0",values:["0","1"]},smimeViewState:{default:"0",values:["0","1"]},reminderOnBoarding:{default:"0",values:["0","1"]},offlineOnboarding:{default:"0",values:["0","1"]},crmTempOnboard:{default:"0",values:["0","1"]},dragNDropInfo:{dataType:a.STRING},mailDuplicateCheck:{default:"0",values:["1","0"]},previousTheme:{dataType:a.STRING},customFontFamilyList:{dataType:a.STRING},templateView:{dataType:a.STRING},contactsSuggestionType:{default:"0",values:["0","1"]},showCCOption:{default:"0",values:["0","1"]},reminderWarningState:{default:"0",values:["0","1"]},bookmarksAddonMsg:{default:"0",values:["0","1"]},offline:{default:"0",values:["0","1"]},readerViewSettings:{dataType:a.JSON,structure:{nightMode:{default:"0",values:["0","1"]},fontFamily:{default:"0"},fontSize:{default:"14"},lineSpacing:{default:"1.5"}},templateName:"readerViewSettings"},customizeMailListing:{dataType:a.JSON,structure:{envelope:{default:"0",values:["0","1"]},flag:{default:"0",values:["0","1"]},label:{default:"0",values:["0","1"]},attachment:{default:"0",values:["0","1"]},date:{default:"0",values:["0","1"]},size:{default:"0",values:["0","1"]},delete:{default:"0",values:["0","1"]},summary:{default:"0",values:["0","1"]},commentcount:{default:"0",values:["0","1"]},thread:{default:"0",values:["0","1"]}},templateName:"customizeMailListing"},securedownload:{default:"0",values:["0","1"]},mailPreviewSize:{default:"63",values:""},lhsResize:{default:"200",values:""},lhsAppBarView:{default:"true",values:["true","false"]},totUIVersion:{default:"TOT",values:""},uiStats:{dataType:a.JSON},rhsOnBoarding:{default:"true",values:["true","false"]},archivePostDialog:{default:"0",values:["0","1"]},rhsIntegWhatsNew:{default:"0",values:""},offlineSyncing:{default:"0",values:["0","1"]},eWidgetState:{dataType:a.JSON},labelpreference:{default:"iconText",values:["icon","iconText"]},marketplaceOnBoarding:{default:"true",values:["true","false"]}};return t.initData=n,t.dataTypes=a,t.exclusivityTypes={USER:"USER",ACCOUNT:"ACCOUNT"},t}),define([],function(r){var i,u,s,l,a,S,m,h,y,N,e,o,c,f,d,n,v,p,t,T,g,O,b,I,J=r("zmAdHocSettings"),w=r("zmail.Utils.DOM"),V=$.Deferred();return i=zmail.conPath+"/settings.do",u=function(e){return"object"===babelHelpers.typeof(e)?Object.keys(e):[]},s=function(e){var u={},s=[];return function e(t){for(var a in t)if(-1!==a.indexOf("."))window.console.log("The JSON object key '"+a+"' cannot contain the character '.' !");else{if(s.push(a),t[a]&&t[a].constructor===Object)e(t[a]);else{var n=t[a];n&&n.constructor instanceof Array&&(n=JSON.stringify(n)),u[s.join(".")]=n}s.pop()}}(e=e||{}),u},l=function(e){var t={};for(var a in e){var n=a.split("."),u=n.length||0,s=e[a];if(1===u)t[a]=s;else if(1<u){for(var r,i=n[u-1],l=t,o=0;o<u-1;o++)l[r=n[o]]=l[r]||{},l=l[r];l[i]=s}}return t},J.ajax=function(e,t,a,n){var u=r("zmAjq"),s={u:i,p:e=e||{},fn:t=t||function(){},efn:a=a||function(){},ep:n=n||{},t:"post"};e.hasOwnProperty("setSessionId")&&(s.setSessionId=e.setSessionId,delete e.setSessionId),u.XHR(s)},J.hasSameStructure=function(e,t){var a=[];if(e&&t&&e.constructor===Object&&t.constructor===Object){if(u(e).length!==u(t).length)return!1;for(var n in e)e.hasOwnProperty(n)&&(t.hasOwnProperty(n)&&babelHelpers.typeof(e[n])===babelHelpers.typeof(t[n])||a.push(n))}return 0===a.length},J.flattenJSON=s,J.unflattenJSON=l,J.mergeJSON=function(e,t){e=e||{},t=t||{};var a={};for(var n in e=s(e),t=s(t),e)a[n]=e[n];for(var u in t)a[u]=t[u];return a=l(a)},J.objectKeys=u,a={},J.subscribe=function(e,t){"function"==typeof t&&w.element(a).on(e,t)},J.unsubscribe=function(e,t){"function"==typeof t&&w.element(a).off(e,t)},J.publish=function(e,t){setTimeout(function(){w.element(a).trigger(e,t)},0)},function(){var a={},f=J.dataTypes||{},d=J.exclusivityTypes||{};function s(e,t){this.name=e,this.type=f.STRING,this.exclusivity=d.USER,this.default="",this.currentValue="",this.validValues="",this.wrapper=!1,this.parent=null,this.templateName="",t&&this.initFromConfig(t)}s.prototype={initFromConfig:function(e){var t=this;if(e=e||{},t.wrapper=e.isWrapper||!1,t.parent=e.parent||null,e.dataType){if(!(e.dataType in f))throw new Error("data type of setting is not valid !");t.type=e.dataType}else if(e.structure){if(e.structure.constructor!==Object)throw new Error("'structure' property should be an 'Object' !");t.type=f.JSON}else if(void 0!==e.default){if(e.default.constructor!==String)throw new Error("'default' property should be a 'String' !");t.type=f.STRING}else t.type=f.STRING;if(e.exclusiveTo){if(!(e.exclusiveTo in d))throw new Error("exclusivity type of setting is not valid !");t.exclusivity=e.exclusiveTo}else t.exclusivity=t.parent&&t.parent.exclusivity||d.USER;if(t.type!==f.JSON||null!==t.parent&&!0!==t.parent.wrapper||!1!==t.wrapper||(t.templateName=e.templateName||""),t.type===f.STRING&&(t.default=e.default||"",t.currentValue=t.default,t.validValues=e.values||null),e.hasOwnProperty("sync")?t.sync=e.sync:t.sync=!0,t.type===f.JSON){for(var a in t.checkStructure=null!==e.structure,e.structure){var n=e.structure[a];n.parent=t;var u=new s(a,n);t.children=t.children||{},t.children[a]=u}t.default=t.toJSON()[t.name],t.currentValue=t.default}},toJSON:function(e){var t=this,a=(e=e||{}).fromParent||!1,n=e.exclusiveTo&&[e.exclusiveTo]||[d.USER,d.ACCOUNT];if(t.type===f.JSON&&t.templateName&&t.checkStructure){var u={};for(var s in t.children){e.fromParent=!0;var r=t.children[s];if(r.type===f.JSON||-1!==n.indexOf(r.exclusivity)){var i=r.toJSON(e);(i&&J.objectKeys(i).length||r.type===f.STRING)&&(u[r.name]=i)}}if(!t.wrapper&&null===t.parent){var l={};l[t.name]=u,u=l}return u}if(t.type===f.JSON){var o={};return o[t.name]={},-1!==n.indexOf(t.exclusivity)&&(o[t.name]=t.currentValue||{}),o}if(t.type===f.STRING){if(a)return t.currentValue;var c={};return c[t.name]=t.currentValue,c}},setJSON:function(e){var t=this;if(e)if(e.constructor===Object&&t.templateName&&t.checkStructure){for(var a in e)t.children[a]&&t.children[a].setJSON(e[a]);t.currentValue=t.toJSON()[t.name]}else e.constructor===Object?t.currentValue=JSON.parse(JSON.stringify(e)):t.currentValue=e}};!function(){var e,t;for(e in J.initData)t=new s(e,J.initData[e]),a[e]=t}(),J.settings=a}(),S=J.settings||{},m=J.dataTypes||{},h=J.hasSameStructure,y=function(e,t){var a=S[e];if(a)return a.type===m.JSON?(t?a.toJSON({exclusiveTo:t}):a.toJSON())[e]||{}:a.type===m.STRING?a.currentValue:void 0},N=function(e){var t=S[e];return t.type===m.JSON?$.extend({},t.default):t.type===m.STRING?t.default:void 0},J.getAll=function(){var e={};for(var t in S)e[t]=y(t);return e},J.get=y,J.set=function(e,t,a){var n=S[e],u=!1,s=!(a=a||{}).hasOwnProperty("notify")||a.notify,r=!a.hasOwnProperty("throttle")||a.throttle,i=!a.hasOwnProperty("sync")||a.sync;if(!n)return!1;var l,o,c,f,d,v=y(e);if(n.type===m.JSON){if("object"!==babelHelpers.typeof(t))try{t=JSON.parse(t)}catch(e){}u=function(e,t,a){a=a||{};var n=S[e];if(t=t||{},!a.initialize&&n.templateName&&n.checkStructure&&!h(N(e),t))return!1;if(!n.templateName||!n.checkStructure)return n.setJSON(t),!0;var u=y(e);n.setJSON(t);var s=y(e);u=J.flattenJSON(u),s=J.flattenJSON(s);var r=!1;for(var i in u)u[i]!==s[i]&&(r=!0);return r}(e,t,{initialize:a.initialize})}else n.type===m.STRING&&(o=e,c=t,a.initialize,f=S[o],d=f.validValues||[],(c=c||"").constructor===String&&(c=c.trim()),u=!(d.length&&-1===d.indexOf(c)||f.currentValue===c||(f.currentValue=c,0)));if(l=y(e),u){var p={name:e,oldValue:v,value:l,throttleSave:r};s&&J.publish("settingschanged",p),i&&J.publish("internal/settingschanged",p)}return u},J.getDefault=N,J.getValidValues=function(e){var t=S[e];return t.validValues?t.type===m.STRING?$.extend([],t.validValues):void 0:t.type===m.JSON&&t.children?t.children:""},e=function(e,t){J.publish("settingschanged/"+t.name,t)},J.subscribe("settingschanged",e),o=J.dataTypes||{},c=J.exclusivityTypes||{},f={},d="",n=J.subscribe,v=function(e,t){var a={mode:"set",name:e.name,value:e.currentValue};e.exclusivity===c.ACCOUNT&&(a.accountID=zmail.accId);a.setSessionId=!0,J.ajax(a,void 0,function(){J.set(e.name,t.oldValue,{sync:!1,notify:!1,throttle:!1})})},p=function(e,t){var a=e.toJSON({exclusiveTo:c.USER})[e.name],n=e.toJSON({exclusiveTo:c.ACCOUNT})[e.name],u=0<J.objectKeys(a).length,s=0<J.objectKeys(n).length,r={name:e.name,ignoreTemplate:!1,template:e.templateName||"no_template"};e.templateName||(r.ignoreTemplate=!0),s&&(r.accountID=zmail.accId),u&&s?(r.userValue=JSON.stringify(a),r.accountValue=JSON.stringify(n),r.mode="setFullJSON"):(r.value=JSON.stringify(u?a:n),r.mode="setJSON");r.setSessionId=!0,J.ajax(r,void 0,function(){J.set(e.name,t.oldValue,{sync:!1,notify:!1,throttle:!1})})},t=function a(e,t){var n,u=t.name,s=J.settings[u];s&&(s.sync&&(s.type===o.JSON?n=p:s.type===o.STRING&&(n=v),t.throttleSave&&(f[u]||(f[u]=r("_").throttle(function(e,t){t.throttleSave=!1,a(null,t)},5e3)),n=f[u]),n(s,t)))},T=function(e,t){d="PENDING";var a=J.mergeJSON(e,t);for(var n in a)J.set(n,a[n],{sync:!1,notify:!0,initialize:!0});J.publish("settingsloaded",{success:!0}),d="SUCCESS",V.resolve()},J.subscribe=function(e,t){e&&"function"==typeof t&&("settingsloaded"===e&&("SUCCESS"===d?t(null,{success:!0}):"FAIL"===d&&t(null,{success:!1})),n(e,t))},J.fetch=function(){var e={mode:"getall",accountID:zmail.accId};J.ajax(e,function(e){var t=(e=e||{}).user||{},a=e.account||{};T(t,a),d="SUCCESS"},function(){J.publish("settingsloaded",{success:!1}),d="FAIL"}),d="PENDING"},J.fetchFromObject=T,J.subscribe("internal/settingschanged",t),window.zmAdHocSettings=(O=["get{{SETTING}}","set{{SETTING}}","get{{SETTING}}Default","get{{SETTING}}ValidValues","subscribe{{SETTING}}Change","unsubscribe{{SETTING}}Change"],b=/\{\{SETTING\}\}/,I=function(){var a,n,e=function(e){var t=e.replace(b,n);g[t]=function(e,a){switch(e){case"get{{SETTING}}":return function(e){var t=(e=e||{}).exclusivity;return J.get(a,t)};case"set{{SETTING}}":return function(e,t){return J.set(a,e,t)};case"get{{SETTING}}Default":return function(){return J.getDefault(a)};case"get{{SETTING}}ValidValues":return function(){return J.getValidValues(a)};case"subscribe{{SETTING}}Change":return function(e){J.subscribe("settingschanged/"+a,e)};case"unsubscribe{{SETTING}}Change":return function(e){J.unsubscribe("settingschanged/"+a,e)}}}(e,a)};for(var t in J.settings)n=(a=t).charAt(0).toUpperCase()+a.substr(1),O.forEach(e)},(g={}).dataLoadedDef=V,g.SETTING_DATA_TYPES=$.extend({},J.dataTypes),g.SETTING_EXCLUSIVE_TYPES=$.extend({},J.exclusivityTypes),g.subscribe=J.subscribe,g.unsubscribe=J.unsubscribe,I(),g.fetch=J.fetch,g.fetchFromObject=J.fetchFromObject,g.getAll=J.getAll,g),window.zmAdHocSettings});