"use strict";!function(){var e,t,a,i=zmail.Core.Namespaces.get("zmail.DataLayer").DSModel,n=zmText.get("zm-settings-app-integrationsettings-apps-model"),r=new(function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getDefaults",value:function(){var e={currentTab:1,tabs:[{text:n.page.apps,value:1}],selectedIcon:1,showIcons:!0,showFilter:!1,icons:[{name:"msi-gridview",value:1,tooltip:n.classicView},{name:"msi-thumbview",value:2,tooltip:n.compactView}]};return(zmail.isInternalOrgUser||zmail.isdevPlatformenabled)&&(e.tabs.push({text:n.page.marketplace,value:3}),e.tabs.push({text:n.page.apps,value:4}),e.tabs.push({text:n.page.devSpace,value:2})),e.tabs.push({text:n.page.channels,value:5}),e}},{key:"updateTabs",value:function(){var e=this.get("tabs");e.push({text:n.page.devSpace,value:2}),this.set("tabs",e)}}]),t}(i)),p={DROPBOX_ZOHOGADGETS:"1",ZOHODOCS:"2",DRE:"3",GDRIVE_ZOHOGADGETS:"4",ONEDRIVE_ZOHOGADGETS:"5",BOX_ZOHOGADGETS:"6",CLEARBIT:"7",FULLCONTACT:"8",EVERNOTE:"9",TWITTER:"10",ZENDESK:"11",INCOMINGWEBHOOKS:"12",ASANA:"13",OUTGOINGWEBHOOKS:"14",SERVICES:"15",TRELLO:"18",MAILMERGE:"1014",ZOHODESK:"1001",ZOHOCRM:"1002",SUPPORT:"1003",CHATLET:"1005",ZOHOPROJECTS:"1006",ZOHOBOOKS:"1009",ZOHOINVOICE:"1007",ZOHOSUBSCRIPTION:"1010",ZOHOINVENTORY:"1011",ZOHOVAULT:"1012",ZOHOEXPENSE:"1013",ZOHORECRUIT:"1008",ZOHOTEAMDRIVE:"1016",ZOHONOTEBOOK:"1017",ZOHOASSIST:"1019",HUBSPOT:"16",WECHAT:"19",PEOPLE:"1004",ZOHOSIGN:"1020",SLACK:"23"},s="Dropbox",o="Google Drive",l="OneDrive",c="Box",u="Clearbit",g="FullContact",h="Zendesk",d="Asana",m="Trello",f="HubSpot",y="WeChat",b="Slack",v=new(function(){function e(){babelHelpers.classCallCheck(this,e),this.apps={}}return babelHelpers.createClass(e,[{key:"add",value:function(e,t){this.apps[e]||(this.apps[e]=t)}},{key:"get",value:function(e){return this.apps[e]}},{key:"getType",value:function(e){for(var t in this.apps)if(this.apps.hasOwnProperty(t)&&this.apps[t].hashUrl===e)return t}}]),e}()),O=zmail.Core.Namespaces.create("zmail.Settings.MailSuite.Settings.Integration"),A=zmText.get("zm-settings-app-integrationsettings-apps-model",e,t,a),C="zm-settings-integration-clouduploader";v.add(p.CHATLET,{desc:A.chatletDesc,defaultValue:!0,isOpenable:!1,notAnExtension:!0,hashUrl:"cliq",helpUrl:"cliq-integration.html",displayName:zmText.applyArgs(A.chatlet,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/cliq.png"}),v.add(p.ZOHOCRM,{desc:A.crmDesc,defaultValue:!0,isOpenable:!1,hashUrl:"crm",helpUrl:"zohomail-zohocrm-integration.html",displayName:zmText.applyArgs(A.crm,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/crm.png"}),v.add(p.ZOHOPROJECTS,{desc:A.projectDesc,defaultValue:!0,isOpenable:!0,helpUrl:"zohomail-projects-integration.html#projects",displayName:zmText.applyArgs(A.projects,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/projects.png",hashUrl:"Projects",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-projects").then(function(){void 0!==zmail.projectsInteg.portalsList?e.resolve():O.Projects.getPortalsList().done(function(){e.resolve()})}),e.promise()}}),v.add(p.ZOHODESK,{desc:A.deskDesc,isOpenable:!0,helpUrl:"zohomail-helpdesk-integration.html#desk",displayName:zmText.applyArgs(A.desk,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/desk.png",hashUrl:"Desk",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-desk").then(function(){O.Desk.getPortals().then(function(){e.resolve()})}),e.promise()}}),v.add(p.ASANA,{desc:A.asanaDesc,isOpenable:!0,helpUrl:"zohomail-projects-integration.html#asana",displayName:d,imgSrc:"settings/integration/asana.png",hashUrl:"Asana",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-asana").then(function(){O.Asana.getConfig().then(function(){e.resolve()})}),e.promise()}}),v.add(p.ZENDESK,{desc:A.zendeskDesc,isOpenable:!0,helpUrl:"zohomail-helpdesk-integration.html#zendesk",displayName:h,imgSrc:"settings/integration/zendesk.png",hashUrl:"Zendesk",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-zendesk").then(function(){O.Zendesk.getConfig().then(function(){e.resolve()})}),e.promise()}}),v.add(p.CLEARBIT,{desc:A.clearbitDesc,isOpenable:!0,helpUrl:"zohomail-contacts-integration.html#clearbit",displayName:u,imgSrc:"settings/integration/clearbit.png",hashUrl:"Clearbit",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-senderprofile").then(function(){O.SenderProfile.getConfig(p.CLEARBIT).then(function(){e.resolve()})}),e.promise()}}),v.add(p.FULLCONTACT,{desc:A.fullcontactDesc,isOpenable:!0,helpUrl:"zohomail-contacts-integration.html#fullcontact",displayName:g,imgSrc:"settings/integration/fullcontact.png",hashUrl:"FullContact",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-senderprofile").then(function(){O.SenderProfile.getConfig(p.FULLCONTACT).then(function(){e.resolve()})}),e.promise()}}),_zm.isCloudServiceIntegEnabled&&(v.add(p.DROPBOX_ZOHOGADGETS,{desc:A.uploaderDesc.dropbox,isOpenable:!0,defaultValue:!0,imgSrc:"settings/integration/dropbox.png",init:function(){var e=$.Deferred();return zmAppLoader.load(C).then(function(){O.CloudUploader.getAuthDetails(p.DROPBOX_ZOHOGADGETS).done(function(){e.resolve()})}),e.promise()},displayName:s,hashUrl:"Dropbox"}),v.add(p.GDRIVE_ZOHOGADGETS,{desc:A.uploaderDesc.gdrive,isOpenable:!0,defaultValue:!0,init:function(){var e=$.Deferred();return zmAppLoader.load(C).then(function(){O.CloudUploader.getAuthDetails(p.GDRIVE_ZOHOGADGETS).done(function(){e.resolve()})}),e.promise()},hashUrl:"Gdrive",displayName:o,imgSrc:"settings/integration/drive.png"}),v.add(p.ONEDRIVE_ZOHOGADGETS,{desc:A.uploaderDesc.onedrive,isOpenable:!0,defaultValue:!0,init:function(){var e=$.Deferred();return zmAppLoader.load(C).then(function(){O.CloudUploader.getAuthDetails(p.ONEDRIVE_ZOHOGADGETS).done(function(){e.resolve()})}),e.promise()},displayName:l,hashUrl:"Onedrive",imgSrc:"settings/integration/onedrive.png"}),v.add(p.BOX_ZOHOGADGETS,{desc:A.uploaderDesc.box,isOpenable:!0,defaultValue:!0,init:function(){var e=$.Deferred();return zmAppLoader.load(C).then(function(){O.CloudUploader.getAuthDetails(p.BOX_ZOHOGADGETS).done(function(){e.resolve()})}),e.promise()},displayName:c,hashUrl:"Box",imgSrc:"settings/integration/box.png"})),v.add(p.ZOHOVAULT,{desc:A.vaultDesc,defaultValue:!0,isOpenable:!1,hashUrl:"vault",helpUrl:"zohomail-vault-integration.html",displayName:zmText.applyArgs(A.vault,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/vault.png"}),v.add(p.ZOHOBOOKS,{desc:A.booksDesc,defaultValue:!0,isOpenable:!1,hashUrl:"books",helpUrl:"zohomail-finance-plus-integration.html#books",displayName:zmText.applyArgs(A.books,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/books.png"}),v.add(p.ZOHOINVOICE,{desc:A.invoiceDesc,defaultValue:!0,isOpenable:!1,hashUrl:"invoice",helpUrl:"zohomail-finance-plus-integration.html#invoice",displayName:zmText.applyArgs(A.invoice,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/invoice.png"}),v.add(p.ZOHOINVENTORY,{desc:A.inventoryDesc,defaultValue:!0,isOpenable:!1,hashUrl:"inventory",helpUrl:"zohomail-finance-plus-integration.html#inventory",displayName:zmText.applyArgs(A.inventory,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/inventory.png"}),v.add(p.ZOHOSUBSCRIPTION,{desc:A.subscriptionDesc,defaultValue:!0,isOpenable:!1,hashUrl:"subscriptions",helpUrl:"zohomail-finance-plus-integration.html#subscriptions",displayName:zmText.applyArgs(A.subscription,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/subscription.png"}),v.add(p.ZOHOEXPENSE,{desc:A.expenseDesc,defaultValue:!0,isOpenable:!1,hashUrl:"expense",helpUrl:"zohomail-finance-plus-integration.html#expense",displayName:zmText.applyArgs(A.expense,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/expense.png"}),v.add(p.ZOHOTEAMDRIVE,{desc:A.workdriveDesc,defaultValue:!0,isOpenable:!1,hashUrl:"workdrive",helpUrl:"zohomail-workdrive-integration.html",displayName:zmText.applyArgs(A.workdrive,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/teamdrive.png"}),v.add(p.ZOHONOTEBOOK,{desc:A.notebookDesc,defaultValue:!0,isOpenable:!1,hashUrl:"notebook",helpUrl:"zohomail-notebook-integration.html",displayName:zmText.applyArgs(A.notebook,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/notebook.png"}),v.add(p.TWITTER,{desc:A.twitterDesc,isOpenable:!0,displayName:A.twitter,imgSrc:"settings/integration/twitter.png",hashUrl:"Twitter",init:function(){return zmAppLoader.load("zm-settings-integration-twitter")}}),v.add(p.WECHAT,{desc:A.wechatDesc,isOpenable:!0,displayName:y,imgSrc:"settings/integration/wechat.png",hashUrl:"WeChat",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-wechat").then(function(){O.Wechat.getConfiguredWebhook().then(function(){e.resolve()})}),e.promise()}}),_zm.isStreamsEnabled()&&v.add(p.INCOMINGWEBHOOKS,{isOpenable:!0,hide:!0,displayName:A.incomingWebhooks,imgSrc:"settings/integration/webhooks.png",hashUrl:"IncomingWebhooks",helpUrl:"help/dev-platform/webhook.html#alink2",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-incomingwebhooks").then(function(){window.hasOwnProperty("ZMStore")&&O.Apps.Collection.get(p.INCOMINGWEBHOOKS).hasUserPermission()?ZMStore.getInstance("IncomingWebhookCollection").fetchList().then(function(){e.resolve()}):e.resolve()}),e.promise()}}),v.add(p.ZOHORECRUIT,{desc:A.recruitDesc,defaultValue:!0,isOpenable:!1,hashUrl:"recruit",helpUrl:"zohomail-recruit-integration.html",displayName:zmText.applyArgs(A.recruit,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/recruit.png"}),v.add(p.ZOHOASSIST,{desc:A.assistDesc,defaultValue:!0,isOpenable:!1,hashUrl:"assist",helpUrl:"zohomail-helpdesk-integration.html#Assist",displayName:zmText.applyArgs(A.assist,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/assist.png"}),v.add(p.HUBSPOT,{desc:A.hubspotDesc,isOpenable:!0,hashUrl:"hubspot",displayName:f,helpUrl:"zohomail-zohocrm-integration.html#hubspot",imgSrc:"settings/integration/hubspot.png",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-hubspot").then(function(){O.Hubspot.getConfig().then(function(){e.resolve()})}),e.promise()}}),v.add(p.OUTGOINGWEBHOOKS,{isOpenable:!0,displayName:A.outgoingWebhooks,hide:!0,imgSrc:"settings/integration/webhooks.png",hashUrl:"OutgoingWebhooks",helpUrl:"help/dev-platform/webhook.html#alink4",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-outgoingwebhooks").then(function(){window.hasOwnProperty("ZMStore")&&O.Apps.Collection.get(p.OUTGOINGWEBHOOKS).hasUserPermission()?ZMStore.getInstance("OutgoingWebhookCollection").fetchList().then(function(){e.resolve()}):e.resolve()}),e.promise()}}),v.add(p.TRELLO,{desc:A.trelloDesc,isOpenable:!0,hashUrl:"trello",displayName:m,helpUrl:"zohomail-projects-integration.html#trello",imgSrc:"settings/integration/trello.png",init:function(){var e=$.Deferred();return zmAppLoader.load("zm-settings-integration-trello").then(function(){O.Trello.getConfig().then(function(){e.resolve()})}),e.promise()}}),v.add(p.MAILMERGE,{desc:A.mailMergeDesc,isOpenable:!1,defaultValue:!0,hashUrl:"Mailmerge",displayName:"Mail Merge",imgSrc:"settings/integration/mailmerge.png"}),zmail.isPeopleIntegEnabled&&v.add(p.PEOPLE,{desc:A.peopleDesc,isOpenable:!1,defaultValue:!0,hashUrl:"people",displayName:zmText.applyArgs(A.people,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/people.png"}),v.add(p.ZOHOSIGN,{desc:A.signDesc,isOpenable:!1,defaultValue:!0,hashUrl:"sign",helpUrl:"zohomail-sign-extension.html#sign",displayName:zmText.applyArgs(A.sign,{companyName:zmail.globalI18N.companyName}),imgSrc:"settings/integration/sign.png"}),v.add(p.SLACK,{desc:A.slackDesc,isOpenable:!0,helpUrl:"slack-extension.html",displayName:b,imgSrc:"settings/integration/slack.svg",hashUrl:"slack",init:function(){return new Promise(function(e,t){zmAppLoader.load("zm-settings-integration-slack").then(function(){O.Slack.getConfig().then(function(){e()})})})}});var T,S,E=zmail.Core.Namespaces.get("zmail.DataLayer"),N=E.DSModel,k=E.DSCollection,I=E.Adapter,z=E.Utils,H=I.HTTPAdapter,D=zmText.get("zm-settings-app-integrationsettings-apps-model"),U={},L=function(e,t){var a=_zm.getProperty(zmail.Settings,"Apps.Filter.Models.metaInfo");a&&(a[e]=t)},P=function(e){var t,a=e.get(p.CHATLET),i=e.get(p.ZOHOCRM),n=e.get(p.DROPBOX_ZOHOGADGETS),r=e.get(p.ONEDRIVE_ZOHOGADGETS),s=e.get(p.BOX_ZOHOGADGETS),o=e.get(p.GDRIVE_ZOHOGADGETS),l=e.get(p.ZOHOTEAMDRIVE);a&&a.on("change",function(){t=a.getStatus(),zmail.IntegrationStatus.CHAT=t,$.publish("integration/chatStatusChange",t)}),i&&i.on("change",function(){t=i.getStatus(),zmail.IntegrationStatus.CRM=t,$.publish("integration/CRMStatusChange",t)}),n&&n.on("change",function(){t=n.getStatus(),zmail.IntegrationStatus.dropBox=t,L("dropbox",t),$.publish("integration/dropBoxStatusChange",t)}),r&&r.on("change",function(){t=r.getStatus(),zmail.IntegrationStatus.oneDrive=t,L("onedrive",t),$.publish("integration/oneDriveStatusChange",t)}),s&&s.on("change",function(){t=s.getStatus(),zmail.IntegrationStatus.box=t,L("box",t),$.publish("integration/boxStatusChange",t)}),o&&o.on("change",function(){t=o.getStatus(),zmail.IntegrationStatus.gDrive=t,L("gdrive",t),$.publish("integration/gDriveStatusChange",t)}),l&&l.on("change",function(){t=l.getStatus(),zmail.IntegrationStatus.workdrive=t,L("workDrive",t)})},_=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getDefaults",value:function(){return{ostatus:!0}}},{key:"getIdAttribute",value:function(){return"appType"}},{key:"toggleStatus",value:function(t){var a,i=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.bool=t,(a=this.get("integList"))?(a[0].status=t?1:2,this.set("integList",a,{silent:!0}),this.trigger("change",this)):this.set("integList",[{integId:"dummy",status:t?1:2}]),e.setSessionId=!0,this.triggerAction("CHANGE_STATUS",e).then(function(e){return i.afterStatusChange(e.resp.data),e},function(e){a[0].status=t?2:1,i.trigger("change",i),e&&_zm.getProperty(e,"err.respObj.data")&&_zm.succErrMsg("e",e.err.respObj.data)})}},{key:"afterStatusChange",value:function(e,t){var a=$.extend({},this.get("integList")[0]);a.integId=e.integId,a.status=e.status,e.appType=String(e.appType),e.integList=[a],this.set(e,{silent:!0}),this.trigger("change",this);var i=v.get(e.appType);if(i&&!t){var n=this.getStatus()?D.enabled:D.disabled;_zm.succErrMsg("s",zmText.applyArgs(n,{App:i.displayName}))}}},{key:"getStatus",value:function(){var e=this.attributes,t=v.get(e.appType),a=!0;return t&&(a="defaultValue"in t&&t.defaultValue),e.integList&&1===e.integList.length&&(a=2!==e.integList[0].status),a&&this.hasUserPermission()}},{key:"hasUserPermission",value:function(){return this.get("ostatus")&&this.get("allowedForPlan")}},{key:"isConfigured",value:function(){return!$.isEmptyObject(this.attributes.integList)&&this.attributes.integList[0].integId}},{key:"isUserDisabled",value:function(){var e=this.attributes;return!(!e.integList||1!==e.integList.length)&&2===e.integList[0].status}},{key:"toggleNewStatus",value:function(){var e=this;this.triggerAction("toggleNew").then(function(){e.set({new:!1})},function(){e.set({new:!1})})}},{key:"toggleFavorite",value:function(){var i=this;return this.triggerAction("toggleFavorite").then(function(e){i.set({favorite:!i.get("favorite")});var t=v.get(i.get("appType"));if(t){var a=i.get("favorite")?D.markedFav:D.removedFav;_zm.succErrMsg("s",zmText.applyArgs(a,{App:t.displayName}))}})}}]),t}(N),R=function(e){function a(e){var t;return babelHelpers.classCallCheck(this,a),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this,e))).categoryFilter=[],t.isZohoIntegration="-1",t.status="ALL",t}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"getBaseModelClass",value:function(){return _}},{key:"getIntegrations",value:function(){var i=[];return this.models.forEach(function(e){var t=e.attributes,a=v.get(t.appType);a&&!a.hide&&i.push(e)}),i}},{key:"getIntegAppConfig",value:function(e){return"number"==typeof e&&(e=String(e)),this.get(e)}},{key:"fetchList",value:function(){var t=this;return zmUtil.getIntegStatus().then(function(e){return t.afterFetchList(e)},function(e){return t.trigger("fetched"),e})}},{key:"filterByStatus",value:function(e){return this.status=e,this.filter()}},{key:"resetStatusFilter",value:function(){return this.status="ALL",this.filter()}},{key:"filterByType",value:function(e){return this.isZohoIntegration=e,this.filter()}},{key:"resetTypesFilter",value:function(){return this.isZohoIntegration="-1",this.filter()}},{key:"filterByCategory",value:function(e){return this.categoryFilter.includes(e)?z.removeFromArray(this.categoryFilter,e):this.categoryFilter.push(e),this.filter()}},{key:"isAllCategoriesFiltered",value:function(){return[0,this.getCategories().length].includes(this.categoryFilter.length)}},{key:"filterAllCategories",value:function(){return this.isAllCategoriesFiltered()?this.categoryFilter=[1]:this.categoryFilter=[],this.filter()}},{key:"filter",value:function(){var i=this;return this.trigger("categoryFilter"),this.reset(),this.isLoaded=!1,this.triggerAction("filter",{type:"GET"}).then(function(e){i.isLoaded=!0;var t=e.resp,a=i.parseList(t);i.set(a),i.trigger("filterEnd")})}},{key:"reFetchList",value:function(){var t=this;return this.isLoaded=!1,this.trigger("refetchStart"),this.triggerAction("fetchAll",{type:"GET"}).then(function(e){t.afterFetchList(e.resp,!0),t.trigger("refetchEnd")})}},{key:"getCategories",value:function(){return S}},{key:"getCategoriesMap",value:function(){return U}},{key:"parseList",value:function(e){return e.data.map(function(e){return e.appType=String(e.appType),e.appType===p.CHATLET&&(e.ostatus=T()&&e.ostatus),e})}},{key:"afterFetchList",value:function(e,t){var a,i=this;return i.isLoaded||(i.isLoaded=!0,S=i.Categories=e.Categories,i.CategoriesMap={},i.Categories.forEach(function(e){var t=e.categoryId;U[t]=i.CategoriesMap[t]=D.categoriesMap[t]}),a=this.parseList(e),i.set(a),t||(i.trigger("fetched"),P(this))),e}}]),a}(k),V={adapters:[{id:"http-adapter",type:"default",classObj:function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getUrl",value:function(){return"/integPlatform/integAction.do"}},{key:"serialize",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=null;return a=a||{},"fetchAll"===e?i={mode:"AVAILABILITY",action:"GET_INTEG_CONFIGS"}:"CHANGE_STATUS"===e?(i={appType:t.get("appType"),action:"CHANGE_STATUS",status:a.bool?"1":"2"},a.integId?i.integId=a.integId:t.get("integList")&&t.get("integList")[0]&&"dummy"!==t.get("integList")[0].integId&&(i.integId=t.get("integList")[0].integId)):"toggleNew"===e?i={appType:t.get("appType"),action:"MARK_AS_SEEN"}:"filter"===e?(i={action:"MULTI_FILTER_INTEG",isZohoIntegration:t.isZohoIntegration,status:t.status},0<t.categoryFilter.length&&(i.categoryId=JSON.stringify(t.categoryFilter))):"toggleFavorite"===e&&(i={action:"FAVORITES",operation:t.get("favorite")?"remove":"add",integServiceId:t.get("appType")}),i}},{key:"normalize",value:function(e,t,a){return t}}]),t}(H)}],default:"http-adapter"},M=ZMStore.createInstance("IntegAppsCollection",R,{adapterConfig:V}),Z=ZMStore.createInstance("IntegAppsViewCollection",R,{adapterConfig:V}),G=!1;Z.on("change",function(e){if(!G){if(G=!0,e instanceof _){var t=M.get(e.get("appType"));t&&t.set($.extend(!0,{},e.attributes))}G=!1}}),M.on("change",function(e){if(!G){if(G=!0,e instanceof _){var t=Z.get(e.get("appType"));t&&t.set($.extend(!0,{},e.attributes))}G=!1}}),zmComponent.notifier&&zmComponent.notifier.addHandler("integration",function(e,t){var a=_zm.getProperty(t,"data.act"),i=_zm.getProperty(t,"data.Integresponse.data");if(a&&i&&"INTEGRATION_SETTINGS_CHANGE"===a){var n=String(i.appType),r=M.get(n);r&&r.afterStatusChange(i,!0),(r=Z.get(n))&&r.afterStatusChange(i,!0)}});var x={ACTIVE:1,INACTIVE:0,CLOSED:2,NONE:-1};T=function(){return-1!==[x.ACTIVE,x.NONE].indexOf(zmail.chatAdminPref)};zmModules.getCommonUtilsModule().then(function(){M.fetchList()});var w,F=zmail.Core.Namespaces.get("zmail.DataLayer"),B=F.DSModel,K=F.DSCollection,W=F.Adapter.HTTPAdapter,j=zmText.get("zm-settings-app-integrationsettings-apps-model"),Y=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getIdAttribute",value:function(){return"appId"}},{key:"toggleFavorite",value:function(){var a=this;return this.triggerAction("toggleFavorite").then(function(e){a.set({favorite:!a.get("favorite")});var t=a.get("favorite")?j.markedFav:j.removedFav;_zm.succErrMsg("s",zmText.applyArgs(t,{App:a.get("appName")}))})}}]),t}(B),X=function(e){function a(e){var t;return babelHelpers.classCallCheck(this,a),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this,e))).categoryFilter=[],t.isZohoIntegration="-1",t.status="ALL",t}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"getBaseModelClass",value:function(){return Y}},{key:"fetchList",value:function(){var t=this;return zmUtil.fetchMarketplaceApps().then(function(e){t.afterFetchList(e),t.trigger("fetched")},function(e){return e})}},{key:"fetchAppDetail",value:function(e,t,a){return zmUtil.fetchAppDetail(e,t,a)}},{key:"parseList",value:function(e){return e.data.map(function(e){return"string"==typeof e.manifest&&(e.manifest=JSON.parse(e.manifest)),e})}},{key:"afterFetchList",value:function(e){var t;return this.isLoaded=!0,t=this.parseList(e),this.set(t),e}}]),a}(K),J={adapters:[{id:"http-adapter",type:"default",classObj:function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getUrl",value:function(){return"/integPlatform/integAction.do"}},{key:"serialize",value:function(e,t){var a=null;return"toggleFavorite"===e&&(a={action:"FAVORITES",operation:t.get("favorite")?"remove":"add",appId:t.get("appId")}),a}},{key:"normalize",value:function(e,t,a){return t}}]),t}(W)}],default:"http-adapter"},q=ZMStore.createInstance("MarketplaceAppsCollection",X,{adapterConfig:J}),Q=zmail.Core.Namespaces.get("zmail.DataLayer"),ee=Q.DSModel,te=Q.Utils,ae=Q.DSCollection,ie=Q.Adapter.HTTPAdapter,ne=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getDefaults",value:function(){return{serviceName:"",displayName:"",consumerKey:"",consumerSecret:"",requestTokenUrl:"",authorizationUrl:"",accessTokenUrl:"",authParams:[{name:"",label:""}],isAuthParamsNeeded:!1,isConfidentialClient:!1,signatureMethod:"HMAC-SHA1",extraParams:[],scopes:"",token_type:"Bearer",serviceType:2,authenticationType:1}}},{key:"clone",value:function(){return new t({attrs:te.extend(!0,{},this.attributes),collection:this._collection})}},{key:"isAuthTypeBasic",value:function(){return 0===this.attributes.authenticationType}},{key:"isAuthTypeAPIKey",value:function(){return 1===this.attributes.authenticationType}},{key:"isAuthTypeOAUTH1",value:function(){return 2===this.attributes.authenticationType}},{key:"isAuthTypeOAUTH2",value:function(){return 3===this.attributes.authenticationType}},{key:"triggerModelAction",value:function(e){var a=this;return this.triggerAction(e).then(function(e){var t=e.resp.data;a.set(t),w.unshift(a)})}},{key:"addAPIKeyConnection",value:function(e){var t=e?"ADD_BASIC_API_KEY":"ADD_SERVICE_APIKEY";return this.triggerModelAction(t)}},{key:"addOAUTH1Connection",value:function(){return this.triggerModelAction("ADD_SERVICE_OAUTHV1")}},{key:"addOAUTH2Connection",value:function(){return this.triggerModelAction("ADD_SERVICE_OAUTHV2")}},{key:"updateAPIKeyConnection",value:function(){return this.triggerAction("UPDATE_SERVICE_APIKEY")}},{key:"updateOAUTH1Connection",value:function(){return this.triggerAction("UPDATE_SERVICE_OAUTHV1")}},{key:"updateOAUTH2Connection",value:function(){return this.triggerAction("UPDATE_SERVICE_OAUTHV2")}},{key:"delete",value:function(){var e=this;return this.triggerAction("DELETE_SERVICE").then(function(){w.remove(e.attributes.serviceId)})}},{key:"rovokeAuthentication",value:function(){return this.triggerAction("REMOVE_CONNECTION")}},{key:"getIdAttribute",value:function(){return"serviceId"}}],[{key:"getNewModel",value:function(){return new t({collection:w})}}]),t}(ee),re=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getBaseModelClass",value:function(){return ne}},{key:"fetchList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this;return this.fetchPromise||(e.type="GET",this.fetchPromise=this.fetchAll(e).then(function(){t.trigger("fetchAll")})),this.fetchPromise}}]),t}(ae),se={adapters:[{id:"http-adapter",type:"default",classObj:function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getUrl",value:function(){return"/integPlatform/connectors.do"}},{key:"serialize",value:function(e,t){var a,i={};if("fetchAll"===e)i={action:"GET_SERVICE_BY_TYPE",serviceType:2,sortBy:"NEWEST"};else if("ADD_SERVICE_APIKEY"===e||"UPDATE_SERVICE_APIKEY"===e||"ADD_BASIC_API_KEY"===e)a=t.attributes,i={action:e,data:JSON.stringify({serviceName:a.serviceName,displayName:a.displayName,serviceType:2,authDetails:{token_type:a.tokenType}})};else if("ADD_SERVICE_OAUTHV1"===e||"UPDATE_SERVICE_OAUTHV1"===e){var n=(a=t.attributes).authParams;$.isArray(n)&&n[0]&&delete n[0].mandatory;var r={consumerSecret:a.consumerSecret,consumerKey:a.consumerKey,requestTokenUrl:a.requestTokenUrl,authorizationUrl:a.authorizationUrl,accessTokenUrl:a.accessTokenUrl,signatureMethod:a.signatureMethod,extraParams:a.extraParams};a.isAuthParamsNeeded&&(r.authParams=n),a.tokenType&&(r.token_type=a.tokenType),i={action:e,data:JSON.stringify({serviceName:a.serviceName,displayName:a.displayName,serviceType:2,authDetails:r})}}else if("ADD_SERVICE_OAUTHV2"===e||"UPDATE_SERVICE_OAUTHV2"===e){var s=(a=t.attributes).authParams;$.isArray(s)&&s[0]&&delete s[0].mandatory;var o={clientId:a.clientId,clientSecret:a.clientSecret,refreshTokenUrl:a.refreshTokenUrl,authorizationUrl:a.authorizationUrl,accessTokenUrl:a.accessTokenUrl,scopes:a.scopes.split(","),isConfidentialClient:a.isConfidentialClient};a.isAuthParamsNeeded&&(o.authParams=s),a.tokenType&&(o.token_type=a.tokenType),i={action:e,data:JSON.stringify({serviceName:a.serviceName,displayName:a.displayName,serviceType:2,authDetails:o})}}else i={serviceName:(a=t.attributes).serviceName,action:e,uid:a.uid};return i}},{key:"normalize",value:function(e,t,a){if("fetchAll"===e)return t.data.map(function(e){if(e.authDetails){var t=e.authDetails;delete e.authDetails,e.tokenType=e.token_type,Array.isArray(t.scopes)&&(t.scopes=t.scopes.join()),e.authParams&&(e.isAuthParamsNeeded=!0),$.extend(e,t)}return e});if(("REMOVE_CONNECTION"!==e||"DELETE_SERVICE"!==e)&&t.data.authDetails){t.data.serviceType=2;var i=t.data.authDetails;delete t.data.authDetails,t.data.tokenType=t.data.token_type,Array.isArray(i.scopes)&&(i.scopes=i.scopes.join()),$.extend(t.data,i)}return t}}]),t}(ie)}],default:"http-adapter"};w=ZMStore.createInstance("IntegConnectorsCollection",re,{adapterConfig:se});var oe=zmail.Core.Namespaces.get("zmail.DataLayer"),le=oe.DSModel,pe=oe.DSCollection,ce=oe.Adapter.HTTPAdapter,ue=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getIdAttribute",value:function(){return"appId"}}]),t}(le),ge=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getBaseModelClass",value:function(){return ue}},{key:"fetchList",value:function(){var t=this;return zmUtil.getMyApps().then(function(e){t.afterFetchList(e),t.trigger("fetched")},function(e){return t.trigger("fetched"),e})}},{key:"fetchAppDetail",value:function(e,t,a){return zmUtil.fetchAppDetail(e,t,a)}},{key:"parseList",value:function(e){return e.data.appsList.map(function(e){return"string"==typeof e.manifest&&(e.manifest=JSON.parse(e.manifest)),e})}},{key:"afterFetchList",value:function(e){var t;return this.isLoaded=!0,t=this.parseList(e),this.set(t),e}}]),t}(pe),he={adapters:[{id:"http-adapter",type:"default",classObj:function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getUrl",value:function(){return"/integPlatform/integAction.do"}},{key:"serialize",value:function(e,t){var a=null;return"toggleFavorite"===e&&(a={action:"FAVORITES",operation:t.get("favorite")?"remove":"add",appId:t.get("appId")}),a}},{key:"normalize",value:function(e,t,a){return t}}]),t}(ce)}],default:"http-adapter"},de=ZMStore.createInstance("MyAppsCollection",ge,{adapterConfig:he}),me=zmail.Core.Namespaces.create("zmail.Settings.MailSuite.Settings.Integration");me.Constants=p,me.Apps=me.Apps||{},me.Apps.ConfigManager=v,me.Apps.Collection=M,me.Apps.ViewCollection=Z,me.Apps.initializeOnChangePublizers=P,me.Apps.getChatPreference=function(){var t=$.Deferred();return M.fetchList().then(function(){var e=T();t.resolve({value:e&&M.get(p.CHATLET).getStatus(),isDisabledByAdmin:!e})}),t.promise()},me.Apps.getCRMPreference=function(){var e=$.Deferred();return M.fetchList().then(function(){e.resolve({value:M.get(p.ZOHOCRM).getStatus()})}),e.promise()},me.Apps.Tabs=r,me.Apps.MarketplaceCollection=q,me.Apps.MyAppsCollection=de,me.Connectors=me.Connectors||{},me.Connectors.Model=ne,me.Connectors.Collection=w,zmail.isPrivilegedUser||M.on("fetched",function(){(M.has(12)||M.has(14))&&r.updateTabs()})}(),window.__rollupModule=void 0;