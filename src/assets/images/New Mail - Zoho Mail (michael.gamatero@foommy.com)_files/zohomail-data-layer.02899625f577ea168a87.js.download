(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{"7sa5":function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var i=n("GIU9");n.d(t,"d",function(){return i.b});var r=i.a.DSCollection,a=i.a.DSModel;i.a.Utils;t.c=i.a},GIU9:function(e,t,n){"use strict";n.d(t,"a",function(){return z}),n.d(t,"b",function(){return E});var i=n("Xuck"),r=n("p50D"),a=n("ayoX"),o=function(e,t){for(var n in t)void 0===e[n]&&(e[n]=t[n]);return e},s=function(e){return e?Object(r.a)(!0,{},e):e},l=function(e){return"object"!==babelHelpers.typeof(e)||Array.isArray(e)?0:Object.keys(e).length},u={deleted:{isDirty:!0,isDeleted:!0},loading:{isLoading:!0},loaded:{mode:"created",isLoaded:!0},created:{isDirty:!0,inFlight:!1,isNew:!0},updated:{isDirty:!0,inFlight:!1}},c="loaded",h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,e),this._initDefaults(),this.initProperties(t)}return babelHelpers.createClass(e,[{key:"_getDefaultStateObj",value:function(){return{isLoading:!1,isLoaded:!1,isDirty:!1,inFlight:!1,isSaving:!1,isDeleted:!1,isNew:!1,isValid:!0,isChanging:!1}}},{key:"_transitiontoState",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=u[e];e===c&&t.mode&&(t=u[t.mode]),Object(r.a)(this.stateObj,t)}},{key:"_initDefaults",value:function(){this.currentState=c,this.stateObj=this._getDefaultStateObj(),this._transitiontoState(c)}},{key:"initProperties",value:function(e){e.idAttrPresent&&(this.stateObj.isNew=!1)}},{key:"transitionTo",value:function(){this.updateIsNew()}},{key:"isDirty",get:function(){return this.stateObj.isDirty},set:function(e){this.stateObj.isDirty=e}},{key:"isChanging",get:function(){return this.stateObj.isChanging},set:function(e){this.stateObj.isChanging=e}},{key:"isNew",get:function(){return this.currentState===c&&this.stateObj.isNew},set:function(e){this.currentState===c&&(this.stateObj.isNew=Boolean(e))}},{key:"isDeleted",get:function(){return this.stateObj.isDeleted},set:function(e){this.stateObj.isDeleted=e}},{key:"isInvalid",get:function(){return this.stateObj.isInvalid},set:function(e){this.stateObj.isInvalid=e}},{key:"inFlight",get:function(){return this.stateObj.inFlight},set:function(e){this.stateObj.inFlight=e}}]),e}(),d=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;babelHelpers.classCallCheck(this,t),e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));var r=babelHelpers.assertThisInitialized(e),a=n.attrs||void 0;return e._collection=n.collection||null,e._store=n.store||null,e.modelName=i,r.relations={},r._initialize(),r._initializeAttributes(a,n),r.initialize&&r.initialize(),e}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"_initialize",value:function(){var e=this.attrsConfig();this.attributes={},this.idAttribute=this.getIdAttribute(),this._attrsConfig=s(e),this._stateManager=new h}},{key:"_initializeAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getDefaults();this._prevCommited={},"object"===babelHelpers.typeof(n)&&o(e,n),t.parse&&(e=this.parse(e,t.parseData)),this.set(e)}},{key:"toJSON",value:function(){return s(this.attributes)}},{key:"attrsConfig",value:function(){return{}}},{key:"get",value:function(e){return this.attributes[e]}},{key:"set",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this,a={},o={},l=i.isChanging;"object"===babelHelpers.typeof(e)?(a=e,n=t||{}):a[e]=t;var u=n.silent;l||(i.changed={},o=s(i.attributes),i._prevChangedAttr=o),i.isChanging=!0;var c=i.changed;if(!i.validate(a,n).isValid)return!1;var h=[],d=i.attributes;for(var f in a){var v=a[f];Object(r.i)(d[f],v)||(h.push(f),c[f]=v,d[f]=v)}return u||h.forEach(function(e){i.trigger("change:".concat(e),i,d[e])}),i.idAttribute in a&&a[i.idAttribute]&&(i.id=a[i.idAttribute],i.isNew=!1,i.isDirty=!1),l?i:(!u&&h.length>0&&i.trigger("change",i,n),i.isChanging=!1,i)}},{key:"getStoreRef",value:function(){var e;if(this._collection&&this._collection._store)e=this._collection._store;else{if(!this._store)throw Error("Not yet registered with any store, cant save");e=this._store}return e}},{key:"getIdAttribute",value:function(){return"id"}},{key:"getStoreKey",value:function(){var e;return this._collection&&this._collection._storeKey?e=this._collection._storeKey:this._storeKey&&(e=this._storeKey),e}},{key:"hasChanged",value:function(){return!Object(r.h)(this.changed)}},{key:"changedAttributes",value:function(e){if(!e)return!!this.hasChanged()&&s(this.changed);var t,n={},i=this.attributes;for(var a in e)t=e[a],Object(r.i)(i[a],t)||(n[a]=t);return!!l(n)&&n}},{key:"save",value:function(e,t){var n,i,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=this,u={},c=o.setImmediate;if("object"===babelHelpers.typeof(e)?(u=e,o=s(t)||{}):e?u[e]=t:u=null,o=Object(r.a)({parse:!0,validate:!0},o),u)if(c){if(!l.set(u,o))return!1}else if(!l.validate(u,o).isValid)return!1;return o.method?n=o.method:l.isNew?n="create":(n="update",l.hasChanged()&&(o.changedAttributes=l.changedAttributes())),i=l.getStoreRef(),l.inFlight=!0,a=Object(r.a)({},l.attributes,u),o.attrs=s(u),i._sync(n,l,o).then(function(e){var t=e.resp,n=o.parse?l.parse(t):t;if((u&&!c&&(n=Object(r.a)({},a,n)),n)&&!l.set(n,o))return!1;return l._prevCommitted=s(l.attributes),l.trigger("sync",n),e}).then(function(e){return l.inFlight=!1,e},function(e){throw l.inFlight=!1,e})}},{key:"fetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,n=e.parse,i=void 0===n||n;return t.triggerAction("read",e).then(function(n){var r=n.resp;return i&&(r=t.parse(r)),t.set(r),t.trigger("sync",t,r,e),n})}},{key:"delete",value:function(){return this}},{key:"parse",value:function(e){return e}},{key:"getDirtyAttributes",value:function(){}},{key:"rollbackChanges",value:function(){}},{key:"isLoading",value:function(){return this.state.isLoading}},{key:"isLoaded",value:function(){return this.state.isLoaded}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,n=e.success;return e.success=function(i){n&&n.call(e.context,t,i,e),t.isNew||t.trigger("sync",t,i,e)},t.isNew?Promise.resolve():t.getStoreRef()._sync("delete",this,e).then(function(n){return t.trigger("destroy",t,t._collection,e),n})}},{key:"validate",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{isValid:!0}}},{key:"triggerAction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getStoreRef()._sync(e,this,t)}},{key:"getDefaults",value:function(){return{}}},{key:"reset",value:function(){this.attributes={},this.set(Object(r.a)({},this.getDefaults()))}},{key:"normalize",value:function(e){return e}},{key:"isDirty",get:function(){return this._stateManager.isDirty},set:function(e){this._stateManager.isDirty=Boolean(e)}},{key:"isChanging",get:function(){return this._stateManager.isChanging},set:function(e){this._stateManager.isChanging=Boolean(e)}},{key:"isInvalid",get:function(){return this._stateManager.isInvalid},set:function(e){this._stateManager.isInvalid=e}},{key:"inFlight",get:function(){return this._stateManager.inFlight},set:function(e){this._stateManager.inFlight=e}},{key:"isNew",get:function(){return this._stateManager.isNew},set:function(e){this._stateManager.isNew=Boolean(e)}}],[{key:"cloneAndParseAttr",value:function(e,n){var i;return(i=new t).idAttribute=e.idAttribute,n=e.parse(n),n=Object(r.a)({},e.attributes,n),i.set(n),i}}]),t}(i.a);Object(r.a)(d.prototype,{currentState:null}),d.extend=r.a;var f=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,e),this.errorMsg=t.errorMsg,this.opts=t},v=function(e){return zmAjq.XHR({u:(t=e).url,t:t.type||"POST",efn:t.error,fn:t.success,p:t.data,ep:t.extraParamObj,h:!!t.header||"",noStringify:!!t.noStringify||"",setSessionId:t.setSessionId,isXHRNeeded:t.isXHRNeeded,ajaxProps:t.ajaxProps});var t},g=function(e){return Number(""===e.trim()?NaN:String(e))},p=function(e,t){var n=0;return e.map(function(e,i,r){return{value:e,index:n++,criteria:t(e,i,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index}).map(function(e){return e.value})},y=function(e,t){for(var n,i=t.split("."),r=e,a=i.length,o=0;o<a;o++)if(r=n=r[i[o]],void 0===n)return n;return n},b=function(){function e(t){babelHelpers.classCallCheck(this,e),this.collection=t,this.commands=[],this.condition="OR",this.useCase=!1}return babelHelpers.createClass(e,[{key:"useCase",value:function(){return this.useCase=!0,this}},{key:"and",value:function(){return this.condition="AND",this}},{key:"or",value:function(){return this.condition="OR",this}},{key:"select",value:function(){var e,t,n=[];for(e=0,t=this.collection.length;e<t;e++){var i=this.collection.models[e];this.evaluate(i.attributes)&&n.push(i)}return n}},{key:"evaluate",value:function(e){var t,n,i,r=this.commands.length;if(0===r)return!0;var a=this.commands[0];for(n=this.evaluateCommand(e,a),t=1;t<r;t++)if(a=this.commands[t],i=this.evaluateCommand(e,a),"OR"===a.condition)n=n||i;else if("AND"===a.condition&&!(n=n&&i))return!1;return n}},{key:"evaluateCommand",value:function(e,t){var n=y(e,t.attrName),i=t.operator,a=t.value;if(void 0!==n){if(!this.useCase&&Object(r.r)(n)&&(n=n.toLowerCase(),a=a.toLowerCase()),"is"===i)return n===a;if("isNot"===i)return n!==a;if("startsWith"===i)return n.startsWith(a);if("endsWith"===i)return n.endsWith(a);if("contains"===i)return-1!==n.indexOf(a);if("doesNotContain"===i)return-1===n.indexOf(a);throw new Error("Invalid where Operator")}return!1}},{key:"count",value:function(){return this.select().length}},{key:"where",value:function(e,t,n){return this.commands.push({attrName:e,operator:t,value:n,condition:this.condition}),this.condition="OR",this}}]),e}(),k=function(){return Math.floor(Date.now()/Math.random())},m={find:function(e){return this.models.find(e,this)},where:function(e,t){var n=t?"find":"filter";return this.models[n](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)}};["indexOf","lastIndexOf","every","some","forEach","map","filter","reduce","reduceRight"].forEach(function(e){m[e]=function(){var t;return(t=this.models)[e].apply(t,arguments)}}),m.each=m.forEach;var _=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,t),e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));var i=babelHelpers.assertThisInitialized(e);return i._store=n.store||null,i._storeKey=n.storeKey||null,i._initModels(n),i._initialize(n),e}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"_initModels",value:function(e){e.model?this._model=e.model:(this._model=this.getBaseModelClass(),this._model.prototype instanceof d||(this._model=d))}},{key:"removeStoreReference",value:function(){delete this._store,delete this._storeKey}},{key:"_initialize",value:function(e){this.models=[],this._modelMap={},this.comparator=e.comparator,this._metaInfo=e.metaInfo||{},this._instanceCache=e.instanceCache}},{key:"getBaseModelClass",value:function(){return d}},{key:"_flushValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.models=[],this._modelMap={},e.flushMetaInfo&&(this._metaInfo=e.metaInfo||{}),this._isLoaded=!1}},{key:"_createModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._isModelInstance(e))return e._collection||(e._collection=this),t.store=this._store,e;t.store=this._store,t.collection=this,t.attrs=e;var n=new this._model(t);return!n.isInvalid&&n}},{key:"_isModelInstance",value:function(e){return e instanceof this._model}},{key:"_getModelIdAttribute",value:function(){return this._model.prototype.getIdAttribute()}},{key:"get",value:function(e){var t,n;if(e)return"string"==typeof e?t=this._modelMap[e]:(n=this._getModelIdAttribute(),(t=this._modelMap[e[n]])||(t=e.uuid&&this._modelMap[e.uuid])),t}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.sendImmediate,i=this._createModel(e,t);if(!i)return!1;n&&this.add(i,t);var r=this;return i.save(null,t).then(function(e){return n||r.add(i,e.opts),e},function(e){throw n||r.remove(i,e.opts),e})}},{key:"query",value:function(){return new b(this)}},{key:"fetchAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,n=t._store;return void 0===e.parse&&(e.parse=!0),t.isLoaded=!1,n._sync("fetchAll",t,e).then(function(e){var n,i=e.resp;return Array.isArray(i)||"object"!==babelHelpers.typeof(i)||(n=i.meta,i=i.data),t.set(i,e.opts),n&&t.setMetaInfo(n),t.isLoaded=!0,e},function(e){throw window.console.error("fetch all failed"),e}).catch(function(){window.console.log("error during set")})}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.set(e,t)}},{key:"destroy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,i=n._store;Object(r.d)(e)||(e=[e]);var a,o=1===e.length,s=t.wait;return s||(a=this.remove(e,t)),o?a[0].destroy(t).then(function(e,t){s&&n.remove(e,t)}):i.deleteMultiple(a,t).then(function(e,t){s&&a.forEach(function(e){n.remove(e,t)})}),a}},{key:"remove",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[];Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++){var a;if(a=(t=e[r])instanceof this._model?t:this.get(t)){var o,s=this.models.indexOf(a);if(-1!==s)this.models.splice(s,1),null!==(o=a.isNew?a.uuid:a.id)&&delete this._modelMap[o],n.silent||(n.index=s,a.trigger("remove",a,this,n)),i.push(a),this._removeModelReference(a)}}return i}},{key:"pluck",value:function(e){return this.models.map(function(t){return t.get(e)})}},{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.at(this.length-1);return this.remove(t,e),t}},{key:"push",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.add(e,Object(r.a)({at:this.length},t))}},{key:"shift",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.at(0);return this.remove(t,e),t}},{key:"unshift",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.add(e,Object(r.a)({at:0},t))}},{key:"updateModels",value:function(e,t,n){var i,a,o,l=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c={},h=u.setImmediate;if(!this._store)throw Error("Not yet registered with any store, cant save");if(a=this._store,Object(r.d)(e)||(e=[e]),Object(r.o)(t)?(c=t,u=s(n)||{}):t?c[t]=n:c=null,u=Object(r.a)({parse:!0,validate:!0},u),c)if(h)e.forEach(function(e){if(!l._modelMap[e].set(c,u))return!1});else if(!this.validate(c,u).isValid)return!1;return i=u.method?u.method:"updateModels",this.inFlight=!0,o=Object(r.a)({},c),u.attrs=s(c),u.idArr=e,a._sync(i,this,u).then(function(t){var n=t.resp,i=u.parse?l.parse(n,u):n;return c&&!h&&(i=Object(r.a)({},o,i)),i&&e.forEach(function(e){if(!l._modelMap[e].set(i,u))return!1}),l._prevCommitted=s(c),l.trigger("updateModels",i),t}).then(function(e){return l.inFlight=!1,e},function(e){throw l.inFlight=!1,e})}},{key:"set",value:function(e){var t,n,i,a,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=[];Object(r.d)(e)||(e=[e]);var u=s.at;u>this.length&&(u=this.length),u<0&&(u+=this.length+1),n=e.length;var c=!1,h=null,d=this.comparator&&void 0===u&&!1!==s.sort;for("string"==typeof this.comparator&&(h=this.comparator),t=0;t<n;t++)if(a=e[t],i=this.get(a)){var f=a;this._isModelInstance(a)&&(f=a.attributes),s.parse&&(f=i.parse(f,s)),i.set(f,s),h&&!c&&d&&(c=i.hasChanged(h))}else a=this._createModel(a,s),l.push(a);if(l.length&&(void 0===u&&(u=this.length),d&&!c&&(c=!0),this._pushToCollection(u,l)),c&&this.sort({silent:!0}),!s.silent)for(o=l.length,t=0;t<o;t++)l[t].trigger("add",l[t],this,s);return this}},{key:"sort",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.comparator)throw new f("Cannot sort. No comparator found");return"string"==typeof this.comparator?this._sortBy(this.comparator):"function"==typeof this.comparator&&this.models.sort(this.comparator.bind(this)),e.silent||this.trigger("sort",this,e),this}},{key:"reset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=t?s(t):{};for(var n=0;n<this.length;n++)this._removeModelReference(this.models[n],t);return this._flushValues(t),e&&(e=this.add(e,Object(r.a)({silent:!0},t))),t.silent||this.trigger("reset",this,t),e}},{key:"_sortBy",value:function(e){var t;return t="function"===e?e:function(t){return t.get(e)},this.models=p(this.models,t.bind(this)),this}},{key:"at",value:function(e){return this.models[e]}},{key:"triggerAction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._store._sync(e,this,t)}},{key:"_pushToCollection",value:function(e,t){var n=this;t.forEach(function(t,i){var r;if(t.isNew){for(r=k();n._modelMap[r];)r=k();t.uuid=r}else r=t.id;n._modelMap[r]=t,n.models.splice(e+i,0,t),n._addModelReference(t)})}},{key:"getStoreKey",value:function(){return this._storeKey}},{key:"_addModelReference",value:function(e){e.on("all",this.onModelEvent,this)}},{key:"_removeModelReference",value:function(e,t){e._collection===this&&delete e._collection,e.off("all",this.onModelEvent,this)}},{key:"toJSON",value:function(){return this.map(function(e){return e.toJSON()})}},{key:"getModelId",value:function(e){return e[this.getBaseModelClass().prototype.getIdAttribute()]}},{key:"getMetaInfo",value:function(e){return e?"string"==typeof e?this._metaInfo[e]:void 0:this._metaInfo}},{key:"setMetaInfo",value:function(e,t){var n=this._metaInfo;"object"===babelHelpers.typeof(e)?Object(r.a)(n,e):"string"==typeof e&&(n[e]=t)}},{key:"onModelEvent",value:function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1];if(t&&("destroy"===e&&this.remove(t),"change"===e)){var n=this.getModelId(t._prevChangedAttr),i=t.id;n!==i&&(null!==n&&delete this._modelMap[n],null!==i&&(this._modelMap[i]=t))}this.trigger.apply(this,arguments)}},{key:"has",value:function(e){return this._modelMap.hasOwnProperty(e)}},{key:"isLoaded",get:function(){return Boolean(this._isLoaded)},set:function(e){this._isLoaded=Boolean(e)}},{key:"length",get:function(){return this.models.length}}]),t}(i.a);Object(r.a)(_.prototype,m);var C=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"fetchRecord",value:function(){return!1}},{key:"findRecord",value:function(){return!1}},{key:"createRecord",value:function(){return!1}},{key:"updateRecord",value:function(){return!1}},{key:"deleteRecord",value:function(){return!1}},{key:"findAll",value:function(){return!1}},{key:"query",value:function(){return!1}},{key:"serialize",value:function(){}},{key:"normalize",value:function(){}},{key:"sync",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}}]),e}(),A=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,t),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,n))).initialize(),e}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"initialize",value:function(){this.REQUEST_METHOD=s(this.getDefaultRequestMethods()),this.ERROR_CODES=this.getErrorCodes()}},{key:"getDefaultRequestMethods",value:function(){return{create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"}}},{key:"getErrorCodes",value:function(){return{UNKNOWN:0,CONNECTIVITY:"1",CAPTCHA:"2",OTHERS:"3"}}},{key:"getAjaxMethod",value:function(){return v}},{key:"findRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("read",e,t)}},{key:"createRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("create",e,t)}},{key:"updateRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("update",e,t)}},{key:"deleteRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("delete",e,t)}},{key:"deleteRecords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("delete",e,t)}},{key:"findAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.type="GET",this.sync("fetchAll",e,t)}},{key:"getUrl",value:function(){throw new Error("No url configured")}},{key:"getHeaders",value:function(){return{}}},{key:"serialize",value:function(e,t,n){return n}},{key:"normalize",value:function(e,t,n){return t}},{key:"onNetFailure",value:function(e,t,n){}},{key:"sync",value:function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this;return new Promise(function(a,o){var s={};s.type=i.type||r.REQUEST_METHOD[e]||"POST",s.url=i.url||r.getUrl(e,i),s.data=r.serialize(e,n,i),s.success=function(t){i.resp=t;var s=r.normalize(e,t,i);s.error?o({resp:t,opts:i,model:n}):a({resp:s,opts:i,model:n})},s.error=function(){var a={},s=arguments.length<=1?void 0:arguments[1],l=arguments.length<=3?void 0:arguments[3],u=arguments.length<=4?void 0:arguments[4],c=r.ERROR_CODES;if(u instanceof Array&&u[1]instanceof Object&&u[1].captcha&&(l=c.CAPTCHA),void 0!==l&&(l===c.CONNECTIVITY?(r.onNetFailure(e,n,i),a.errCode=c.CONNECTIVITY):l===c.OTHERS?(a.errCode=c.OTHERS,a.respObj=u[1]):l===c.CAPTCHA&&(a.errCode=c.CAPTCHA)),!i.hideErrorMsg&&l===c.OTHERS){var h="";"string"==typeof s?h=s:"object"===babelHelpers.typeof(s)&&s.msg&&"string"==typeof s.msg&&(h=s.msg),t.succErrMsg("e",h)}o({resp:s,opts:i,model:n,err:a})},s.setSessionId=Boolean(i.setSessionId),s.isXHRNeeded=i.isXHRNeeded,s.ajaxProps=i.ajaxProps,r.getAjaxMethod()(s)})}}]),t}(C),O=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,t),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,n))).initialize(),e}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"initialize",value:function(){this.ERROR_CODES=this.getErrorCodes()}},{key:"getErrorCodes",value:function(){return{UNKNOWN:0,CONNECTIVITY:"1",CAPTCHA:"2",OTHERS:"3"}}},{key:"findRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("read",e,t)}},{key:"createRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("create",e,t)}},{key:"updateRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("update",e,t)}},{key:"deleteRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("delete",e,t)}},{key:"deleteRecords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("delete",e,t)}},{key:"findAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.type="GET",this.sync("fetchAll",e,t)}},{key:"serialize",value:function(e,t,n){return n}},{key:"normalize",value:function(e,t,n){return t}},{key:"onNetFailure",value:function(e,t,n){}},{key:"getMethodMap",value:function(){return{fetchAll:"fetchAllRecord"}}},{key:"sync",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this,o=r.getMethodMap();return o[e]?new Promise(function(s,l){return r[o[e]](t,i).then(function(r){i.resp=r;try{var a=n.normalize(e,r,i);s({resp:a,opts:i,model:t})}catch(e){l({resp:r,opts:i,model:t})}}).catch(function(e){e instanceof a.a&&e.response.json().then(function(n){l({resp:n,error:e,opts:i,model:t})})})}):Promise.reject()}},{key:"fetch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t=Object(r.a)(this.serialize?this.serialize():{},t),Object(a.g)(e,t,n)}}]),t}(C),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,e);this._store=t.store,this.adapters={},this._initialize(t)}return babelHelpers.createClass(e,[{key:"_initialize",value:function(e){var t=this;t.adapterConfig=e.adapterConfig;var n,i,r=t.adapterConfig.adapters||[];e.offlineEnabled&&(t.isOfflineEnabled=!0),0===r.length&&(r=[{classObj:t._store.getDefaultAdapter(),id:"default",type:"default"}]),r.forEach(function(e,r){var a=new e.classObj;t.adapters[e.id]=a,0===r&&(n=a),"offline"===e.type&&(i=a),"default"===e.type&&(n=a)}),t.defaultAdapter=n,t.offlineAdapter=i}},{key:"getDefaultAdapterInstance",value:function(){return this.defaultAdapter}},{key:"getOfflineAdapter",value:function(){return this.offlineAdapter}},{key:"getAdapter",value:function(e){return this.adapters[e]||void 0}}]),e}(),M=d,R=_,j={read:"findRecord",delete:"deleteRecord",update:"updateRecord",create:"createRecord"},N="Invalid id. No instances registered with that name",S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,e);this._initialize(t),this._initEvents()}return babelHelpers.createClass(e,[{key:"_initialize",value:function(e){this._collectionKeyMap={},this._instanceCache={},this._modelKeyMap={},void 0===navigator.onLine||navigator.onLine||(this._offlineStatus="offline")}},{key:"updateOfflineEvents",value:function(e){this._offlineStatus=e}},{key:"isOffline",value:function(){return"offline"===this._offlineStatus}},{key:"_initEvents",value:function(){var e=this;window.addEventListener("offline",function(){e.updateOfflineEvents("offline")}),window.addEventListener("online",function(){e.updateOfflineEvents("online")})}},{key:"defineModel",value:function(e,t){return M.extend({})}},{key:"createModelInstance",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t&&t.prototype instanceof M)||this.hasModel(e))return!1}},{key:"_registerAdapters",value:function(e,t){}},{key:"deleteInstance",value:function(e){var t=this.getInstance(e);t&&(t.removeStoreReference(),delete this._instanceCache[e],delete this._collectionKeyMap[e])}},{key:"createInstance",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(t&&t.prototype instanceof R)||this.hasCollection(e))return!1;i.store=this,i.storeKey=e;var r=new w(i);return i._instanceCache=r,n=new t(i),this._instanceCache[e]=r,this._collectionKeyMap[e]=n,n}},{key:"registerModel",value:function(e,t){return this._createCollection(t)}},{key:"hasModel",value:function(e){return this._modelKeyMap[e]}},{key:"getInstance",value:function(e){return this._collectionKeyMap[e]}},{key:"hasCollection",value:function(e){return this._collectionKeyMap[e]}},{key:"createRecord",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getInstance(e).create(t,n)}},{key:"deleteRecord",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getInstance(e).destroy(t,n)}},{key:"deleteRecords",value:function(e,t){return this.getInstance(e).remove(t)}},{key:"updateRecord",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getInstance(e).update(t,n)}},{key:"peekRecord",value:function(e,t){var n=this.getInstance(e);if(!n)throw new f(N);return n.get(t)}},{key:"findRecord",value:function(e,t){if(!this.getInstance(e))throw new f(N)}},{key:"fetchAll",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=this.getInstance(e);if(!t)throw new f(N);return t.fetchAll()}},{key:"_deleteRecords",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=t.getStoreKey();return this._instanceCache[n].getDefaultAdapterInstance()._deleteRecords()}},{key:"_localSync",value:function(e,t,n,i){var r,a=t.getStoreKey(),o=this._instanceCache[a].getOfflineAdapter();if(o)if("read"===e||"fetchAll"===e)if(t instanceof R)for(var s=t,l=s.getBaseModelClass().prototype.getIdAttribute(),u=0,c=i.length;u<c;u++){var h=i[u];r=(r=s.get(h[l]))?M.cloneAndParseAttr(r,h):new s._model(h,n),n.attrs=h,o.updateRecord(r,n)}else r=M.cloneAndParseAttr(t,i),n.attrs=i,o.updateRecord(r,n);else"create"===e?(r=M.cloneAndParseAttr(t,i),o.createRecord(r,n)):"update"===e?o.updateRecord(t,n):"delete"===e&&o.deleteRecord(t,i)}},{key:"_sync",value:function(e,t,n){var i,r=this;t instanceof R&&(n.isCollectionAction=!0);var a,o,s=t.getStoreKey(),l=r._instanceCache[s],u=n.adapterId;if(u)o=l.getAdapter(u);else{var c=l.getDefaultAdapterInstance();o=c,(a=r.isOffline())&&(o=l.getOfflineAdapter(),n.isOffline=!0),o||(o=c)}if(o instanceof O)return this._restAPISync(o,e,t,n);var h,d,f=j[e];return f?h=o[f]:(d=!0,h=o.sync),i=d?h.call(o,e,t,n):h.call(o,t,n),a||!l.isOfflineEnabled||u||setTimeout(function(){i.then(function(i){var a=i.resp;r._localSync(e,t,n,a),window.console.log("local Sync called")})}),i}},{key:"_restAPISync",value:function(e,t,n,i){var r,a,o=j[t];return o?r=e[o]:(a=!0,r=e.sync),a?r.call(e,t,n,i):r.call(e,n,i)}},{key:"getDefaultAdapter",value:function(){return A}},{key:"registerCleanUpAction",value:function(e,t){var n=this._instanceCache[e];n&&"function"==typeof t&&(n.cleanUpAction=t)}},{key:"performDBCleanUp",value:function(e){var t=this._instanceCache,n=[];if(e){if(!t[e])throw new f(N);n=[e]}else n=Object.keys(t);for(var i=n.length,r=0;r<i;r++){var a=t[n[r]];a.isOfflineEnabled&&a.cleanUpAction&&a.cleanUpAction()}}}]),e}(),H=function(e,t,n){return idb.open(e,t,n)},I=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getDBName",value:function(){return null}},{key:"getDBVersion",value:function(){return 0}},{key:"onUpgradeNeeded",value:function(e){window.console.log(e.oldVersion)}},{key:"createRecord",value:function(e,t){var n=this.getDatabaseName(),i=this.getDBVersion(),r=this.onUpgradeNeeded,a=this.serialize("create",e,t),o=a.key,s=a.val,l=a.objStoreName;return new Promise(function(e,t){H(n,i,r).then(function(n){var i=n.transaction(l,"readwrite");i.objectStore(l).put(s,o),i.complete.then(function(){e(s),n.close()},function(){window.console.log("transaction failure"),t(),n.close()})})})}},{key:"updateRecord",value:function(e,t){var n=this.getDatabaseName(),i=this.getDBVersion(),r=this.onUpgradeNeeded,a=this.serialize("update",e,t),o=a.key,s=a.val,l=a.objStoreName;return new Promise(function(e,t){H(n,i,r).then(function(n){var i=n.transaction(l,"readwrite");i.objectStore(l).put(s,o),i.complete.then(function(){e(s),n.close()},function(){window.console.log("transaction failure"),t(),n.close()})})})}},{key:"updateAttributes",value:function(e,t,n){var i=this.getDatabaseName(),r=this.getDBVersion(),a=this.onUpgradeNeeded,o=this.serialize("updateAttributes",t,n).objStoreName;return new Promise(function(n,s){H(i,r,a).then(function(i){var r=i.transaction(o,"readwrite");r.complete.then(function(){n(),i.close()},function(){s(),i.close()});var a=r.objectStore(o);a.get(e).then(function(e){e&&(t.forEach(function(t){e[t.key]=t.val}),a.put(e))})})})}},{key:"updateAttrs",value:function(e,t){var n=this.getDatabaseName(),i=this.getDBVersion(),r=this.onUpgradeNeeded,a=this.serialize("updateAttrs",e,t),o=a.key,s=a.attributes,l=a.objStoreName;return new Promise(function(e,t){H(n,i,r).then(function(n){var i=n.transaction(l,"readwrite");i.complete.then(function(){e(),n.close()},function(){t(),n.close()});var r=i.objectStore(l);r.get(o).then(function(e){e&&(s.forEach(function(t){e[t.key]=t.val}),r.put(e,o))})})})}},{key:"fetchAllRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,i=n.getDatabaseName(),r=n.getDBVersion(),a=n.onUpgradeNeeded,o=n.serialize("fetchAll",e,t).objStoreName;return new Promise(function(s,l){H(i,r,a).then(function(i){i.transaction(o).objectStore(o).getAll().then(function(r){t.resp=r;var a=n.normalize("fetchAll",r,t);s({resp:a,opts:t,model:e}),i.close()},function(){l({resp:null,opts:t,model:e}),i.close()})})})}},{key:"findRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,i=n.getDatabaseName(),r=n.getDBVersion(),a=n.onUpgradeNeeded,o=n.serialize("read",e,t),s=o.key,l=o.objStoreName,u=o.indexName;return new Promise(function(o,c){H(i,r,a).then(function(i){var r,a=i.transaction(l,"readonly").objectStore(l);u?r=a.index(u).get(s):r=a.get(s);r.then(function(r){t.resp=r;var a=n.normalize("read",r,t);o({resp:a,opts:t,model:e}),i.close()},function(){window.console.log("transaction failure"),c({resp:null,opts:t,model:e}),i.close()})})})}},{key:"deleteRecord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,i=n.getDatabaseName(),r=n.getDBVersion(),a=n.onUpgradeNeeded,o=n.serialize("delete",e,t),s=o.key,l=o.objStoreName;return new Promise(function(o,u){H(i,r,a).then(function(i){i.transaction(l,"readwrite").objectStore(l).delete(s).then(function(r){t.resp=r;var a=n.normalize("delete",r,t);o({resp:a,opts:t,model:e}),i.close()},function(){window.console.log("transaction failure"),u({resp:null,opts:t,model:e}),i.close()})})})}},{key:"serialize",value:function(e,t,n){return n}},{key:"normalize",value:function(e,t,n){return t}},{key:"getMethodMap",value:function(){return{fetchAll:"fetchAllRecord"}}},{key:"sync",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getMethodMap();return i[e]?this[i[e]](t,n):Promise.reject()}}]),t}(C),D=function(e){function t(e){var n;return babelHelpers.classCallCheck(this,t),n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this)),window.console.log(e),n}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"findRecord",value:function(){}},{key:"createRecord",value:function(){}},{key:"serialize",value:function(e,t){return t}},{key:"normalize",value:function(e,t){}},{key:"sync",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}}]),t}(C),E={ZMFetchError:a.a,getCookie:a.c,initializeFetch:a.d,zmFetchJSON:a.g,zmFetch:a.f,addHeaderHandler:a.b,registerCaptchaHandler:a.e},z={Adapter:{HTTPAdapter:A,IndexedDBAdapter:I,LocalStorageAdapter:D,RESTAdapter:O},Core:{Events:i.a},DSCollection:_,DSModel:d,DataStore:S,Utils:{fetchUtils:E,isBoolean:r.e,isNumber:r.n,isString:r.r,isFunction:r.k,isArray:r.d,isDate:r.g,isRegExp:r.p,isObject:r.o,isArguments:r.c,isError:r.j,isSymbol:r.s,isMap:r.m,isWeakMap:r.u,isSet:r.q,isWeakSet:r.v,getType:r.b,isEmpty:r.h,isDOMNode:r.f,isUpperCase:r.t,isLowerCase:r.l,isWindow:r.w,isEqual:r.i,extendProperties:r.a,copyDefaults:o,applyMixin:function(e,t){var n,i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.keys(t),a=r.length;for(i=0;i<a;i++)e[n=r[i]]=t[n]},clone:s,size:l,sortBy:p,getAjaxMethod:v,noop:function(){},hasValue:function(e){return Boolean(e)},parseDate:function(e,t,n){for(var i={},r=e.split(n),a=t.split(n),o=0;o<r.length;o++)i[a[o]]=g(r[o]);return i},isStringProperNumber:function(e){return/^\d+$/.test(e)},convertStringToNumber:g,getProperty:y,removeFromArray:function(e,t){var n=e.indexOf(t);-1!==n&&(e=e.splice(n,1))},extend:r.a,getNextUUID:k}}}}]);