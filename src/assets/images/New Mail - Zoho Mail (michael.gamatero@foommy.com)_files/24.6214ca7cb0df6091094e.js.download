(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{aYLw:function(e,t,n){"use strict";n.d(t,"b",function(){return q}),n.d(t,"c",function(){return J}),n.d(t,"a",function(){return P});var i=n("EVdn"),o=n.n(i),s=n("q1tI"),c=n.n(s),a=n("i8i4"),l=n.n(a),r=n("D0BC"),d=n.n(r),h=n("3WF5"),f=n.n(h),p=n("J2m7"),u=n.n(p),y=n("uwyq"),g=n("Kz78"),b=n("NHRd"),k=n("83P7"),m=n("pucZ"),I=n("92Lq"),N=n("UK2x"),v=n("/Qv1"),S=n("vr4s"),w=n("3HKr"),H=n("8lxu"),C=n("m8qQ"),z=n("EkmJ"),O=n("YV/N"),j=".zmStickyNotes",E=function(){var e=o.a.q(j);e.length&&(l.a.unmountComponentAtNode(e[0]),e.remove())},A=function(){Object(I.f)().then(function(){if(v.f.getInstance("stickynote")&&v.f.getInstance("stickynote").findWhere({type:"new"})){var e=v.f.getInstance("stickynote").findWhere({type:"new"});H.a.trigger("openStickyNote",{namespaceId:e.get("namespaceId"),id:e.get("id")})}else Object(k.a)({namespaceId:zmail.zuid,cat:m.b[zmail.zuid],showStickyNote:!0,color:d()(0,3),desc:"",title:"",ownerZUID:zmail.zuid,id:String((new Date).getTime()),height:40,type:"new"},"new")})},L=function(e){function t(){var e,n;babelHelpers.classCallCheck(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return n=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(s))),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"state",{popout:v.f.getInstance("stickynote")&&v.f.getInstance("stickynote").where({showStickyNote:!1}).length>0}),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"handleStickyChange",function(){n.setState({popout:v.f.getInstance("stickynote")&&v.f.getInstance("stickynote").where({showStickyNote:!1}).length>0})}),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"handlePopIn",function(){v.f.getInstance("stickynote").forEach(function(e){e.showNote(!1,{silent:!0})}),o.a.publish("stickyNoteMod")}),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"handlePopOut",function(e){v.f.getInstance("stickynote").forEach(function(e){e.showNote(!0,{silent:!0})}),o.a.publish("stickyNoteMod")}),n}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"componentDidMount",value:function(){Object(S.hideMenu)(),this.handleStickyChange(),v.f.getInstance("stickynote").on("change:showStickyNote",this.handleStickyChange)}},{key:"componentWillUnmount",value:function(){v.f.getInstance("stickynote").off("change:showStickyNote",this.handleStickyChange)}},{key:"handleAddClick",value:function(){E(),A()}},{key:"render",value:function(){var e=this.state.popout;return c.a.createElement("div",{className:"zmStickyNotesHdr"},c.a.createElement("h3",null,Object(O.b)("89404e351b633a827e28ab1937ee2b4c")),c.a.createElement("div",{className:"zmAMB"},c.a.createElement(y.b,null,e&&c.a.createElement(y.a,{small:!0,iconClass:"msi-popout",tooltip:Object(O.b)("f78ab71679b791108d0bf53b0649935b"),onClickHandler:this.handlePopOut}),!e&&c.a.createElement(y.a,{small:!0,iconClass:"msi-popin",tooltip:Object(O.b)("f96b0af26df86b39bbd7e385e3e5780d"),onClickHandler:this.handlePopIn}),c.a.createElement(y.a,{small:!0,iconClass:"msi-add",tooltip:Object(O.b)("f39d8c6515e0282df141dda72e473e3e"),onClickHandler:this.handleAddClick}))))}}]),t}(c.a.Component),T=function(e){function t(e){var n;return babelHelpers.classCallCheck(this,t),n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e)),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"getComponent",function(e){n.stickyListEl=e,null!==e&&n.stickyListEl.handleStickyListSelection("initial")}),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"shortcutFunc",function(e){["downArrow","upArrow"].includes(e)?(o.a.q(j).find(".zmNLSlct").removeClass("zmNLSlct"),n.stickyListEl.handleStickyListSelection(e)):"enter"===e&&n.stickyListEl.handleStickyListSelection(e)}),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"handleOpenClick",function(e){o.a.q(j).find(".zmNLSlct").removeClass("zmNLSlct"),n.stickyListEl.handleStickyListSelection("click",e)}),babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"hideComponent",function(){n.unMounted||E()}),n.stickyNoteCollectionList=Object(z.b)(v.f.getInstance("stickynote").toJSON(),{mode:"stickyNote",type:"stickynotelist",deletePreviousInstance:!0}),n}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"componentDidMount",value:function(){H.a.on("openStickyNote",this.handleOpenClick),Object(w.d)(this.shortcutFunc),o.a.publish("/mail/menuCreated",{menuHandler:this.hideComponent});var e=o.a.q("#sNoteTab").find(".msi-stickyNote").offset();o.a.q(j).css({bottom:"".concat(o.a.q("body").height()-e.top,"px")})}},{key:"componentWillUnmount",value:function(){this.unMounted=!0,Object(w.b)(),H.a.off("openStickyNote",this.handleOpenClick),zmModules.getRHSModule().then(function(e){(0,e.rhs)().rhsBar.getApp("StickyNotes").unSelect()})}},{key:"render",value:function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(L,null),c.a.createElement(b.b,{ref:this.getComponent,noteList:this.stickyNoteCollectionList}))}}]),t}(c.a.Component),P=function(){var e;v.f.getInstance("stickynote")&&v.f.getInstance("stickynote").length?(e=o.a.q(j)).length?E():(o.a.q("body").appendDOM(Object(g.A)()),(e=o.a.q(j)).mousedown(function(e){e.stopPropagation()}),l.a.render(c.a.createElement(T,null),e[0])):A()},q=function e(){if(!Object(N.j)()){v.f.getInstance("stickynote")&&v.f.getInstance("stickynote").reset();var t=zmAdHocSettings.getNotes();if(t&&t.stickyNotes&&t.stickyNotes.length){var n,i,o=f()(t.stickyNotes,"entityId"),s=f()(t.stickyNotes,"groupId"),c={id:o.join(","),groupId:s.join(",")};if(!o.length&&!s.length)return n=zmAdHocSettings.getNotes(),i=n.listingType||"",zmAdHocSettings.setNotes({stickyNotes:[],listingType:i}),void e();Object(N.f)(c).then(function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(0===o[0]||o[1]&&0===o[1].length)return n=zmAdHocSettings.getNotes(),i=n.listingType||"",zmAdHocSettings.setNotes({stickyNotes:[],listingType:i}),void e();o[1]=o[1]||[],Object(I.f)().then(function(){o[1].forEach(function(e){var n=u()(t.stickyNotes,{entityId:e.id});e.showStickyNote="open"===n.state,e.left=n.left,e.top=n.top,e.height=n.height,e.width=n.width,Object(N.h)({top:e.top,left:e.left},{height:e.height,width:e.width})||(e.left=void 0,e.top=void 0),Object(k.a)(e,"restore")})})})}}},M=function(e){var t=f()(e,"entityId"),n=f()(e,"groupId"),i={id:t.join(","),groupId:n.join(",")};(t.length||n.length)&&Object(N.f)(i).then(function(t){Object(I.f)().then(function(){t[1].forEach(function(t){var n=u()(e,{entityId:t.id});t.showStickyNote="open"===n.state,t.left=n.left,t.top=n.top,t.height=n.height,t.width=n.width,Object(N.h)({top:t.top,left:t.left},{height:t.height,width:t.width})||(t.left=void 0,t.top=void 0),Object(k.a)(t,"restore")})})})};function J(){var e;o.a.subscribe("stickyNoteMod",function(){var e=v.f.getInstance("stickynote").toJSON().filter(function(e){return"new"!==e.type}).map(function(e){var t={entityId:e.id,groupId:e.namespaceId};t.state=!0===e.showStickyNote?"open":"minimize";var n=e.top,i=e.left,o=e.width,s=e.height;return t.top=parseInt(n),t.left=parseInt(i),t.width=parseInt(o),t.height=parseInt(s),t}),t=zmAdHocSettings.getNotes().listingType;zmAdHocSettings.setNotes({stickyNotes:e,listingType:t})});var t=function(e){Object(N.f)(e).then(function(e){e[1].forEach(function(e){o.a.publish("stickyNotes/EditNotified",[e])})})};o.a.subscribe("notes/Notification",function(n,i){v.f.getInstance("stickynote")&&v.f.getInstance("stickynote").where({id:i.eid}).length&&(e="string"==typeof i.group||i.group instanceof String?o.a.parseJSON(i.group).id:i.group.id,t({id:i.eid,groupId:e}))}),o.a.subscribe("zmailReconnect",function(e,n){if(v.f.getInstance("stickynote")&&v.f.getInstance("stickynote").length){Object(C.a)("Reconnect called. Updating sticky notes");var i=v.f.getInstance("stickynote").pluck("id"),o=v.f.getInstance("stickynote").pluck("namespaceId");n={id:i.join(","),groupId:o.join(",")},t(n)}}),o.a.subscribe("notes/wshandler",function(e,t){if(v.f.getInstance("stickynote")){for(var n=zmAdHocSettings.getNotes(),i=0;i<n.stickyNotes.length;i++){var o=n.stickyNotes[i],s=v.f.getInstance("stickynote").findWhere({id:o.entityId});if(s){var c="open"===o.state,a=o.top,l=o.left,r=o.height,d=o.width;Object(N.h)({top:a,left:l},{height:r,width:d})||(n.stickyNotes[i]=void 0),s.set({left:l,top:a,type:"restore",width:d,height:r,showStickyNote:c}),s.set("mod","true"),n.stickyNotes[i].added=!0}else n.stickyNotes[i].added=!1}var h=[];v.f.getInstance("stickynote").each(function(e,t,n){"true"===e.get("mod")?delete e.attributes.mod:h.push(e)}),h.length&&(v.f.getInstance("stickynote").remove(h,{silent:!0}),v.f.getInstance("stickynote").trigger("remove"));var f=n.stickyNotes.filter(function(e){return!1===e.added});M(f)}else q()}),o.a.subscribe("/note/delete",function(e,t,n,i){if(!i){var o=zmAdHocSettings.getNotes().listingType||"",s=Object(N.d)();s=s.filter(function(e){var i=e.entityId,o=e.groupId;return i!==t||o!==n}),zmAdHocSettings.setNotes({stickyNotes:s,listingType:o})}})}}}]);