"use strict";!function(){var t,d=zmNCenter.Common.Constants.COMMON_CONSTANTS,n=(Object.freeze({STREAM_MODULE_NAME:"streamsApp",STREAM_TAB_NAME:"zm_stream"}),Object.freeze({POPOUT_ID:"zm-notification-list",POPOUT_ELEMENT_ID:"zmncpreview"})),i=Object.freeze({WORKSPACE_NAME:"zmncenter"}),r=Object.freeze({0:"FEMALE",1:"MALE",2:"COMMON"}),e=Object.freeze({RANGE:20}),s=zmNCenter.Common.Constants.URLS,o={ADD_POST:"30",GROUP_MEMBER:["50","51"],SHARED_FOLDER:["52","53","54","60","74"],REMOVE_SELF_FOR:["23","31","49"],MEMBER_ROLE_CHANGE:["109","150"],CLEAR_COUNT:"114",INVITE_USER:"29",ADD_COMMENT:"31",TASK_USER:["64"],NOTIFICATION_REMINDER:["42","59"],DISMISS:"175",DELETE_POST:["32"],DELETE_COMMENT:["34"],DISMISS_ALL:"176",ADD_TWEET:["112"],SUPPRESS_NOTIFICATION:["118","162"],MARK_READ:["170"],DELETE_ENTITY:["32","48"],MODIFY_ENTITY:["35","34"],TASK_ASSIGN:["58"],UPDATE_EVENT_STATUS:["55","56","57"],TASK_MENTION:["321"],TWITTER_CONFIG:["171","173","174"],ACCEPT_OR_DENY:["29","137"],ACCESS_REQUEST:["117"],ARCHIVE_STREAMS:["134","135"]},l={4:"MAIL_TYPE",23:"LIKE",24:"UNLIKE",25:"POST_MENTION",26:"UNLIKE_COMMENT",27:"UNSHARED",29:"INVITE",30:"ADD_POST",31:"ADD_COMMENT",32:"DELETE_POST",34:"DELETE_COMMENT",35:"DELETE_PRIVATE_COMMENT",36:"ADD_PRIVATE_COMMENT",37:"CHANGE_ENTITY",38:"COMMENT_MENTION",39:"BULK_UPDATE",40:"BULK_DELETE",41:"ADD_TASK",42:"REMINDER_TASK",43:"ADD_SHARE_COMMENT",44:"POST_GROUP_MENTION",45:"COMMENT_GROUP_MENTION",46:"ADD_EVENT",47:"UPDATE_EVENT",48:"DELETE_EVENT",49:"LIKE_COMMENT",50:"ADD_GROUP_MEMBER",51:"REMOVE_GROUP_MEMBER",52:"RESOURCE_SHARE",53:"SHAREPERM_CHANGE",54:"SHAREPERM_REMOVAL",55:"UPDATE_EVENT_STATUS_YES",56:"UPDATE_EVENT_STATUS_NO",57:"UPDATE_EVENT_STATUS_MAYBE",58:"TASK_ASSIGN",59:"MAIL_REMINDER","59/A":"ARBITRARY_REMINDER","59/S":"STREAMS_REMINDER",60:"ACCEPT_SHARE",61:"MAIL_SHARE",62:"ADD_ATTACHMENT",63:"CHANGE_TASK_DUE_DATE",64:"CHANGE_TASK_ASSIGNEE",65:"CHANGE_TASK_STATUS",66:"CHANGE_TASK_PRIORITY",67:"CHANGE_TASK_CATEGORY",68:"CHANGE_TASK_TITLE",69:"CHANGE_TASK_DESCRIPTION",70:"REMOVE_ATTACHMENT",71:"DRAFT_SHARE",72:"DRAFT_SHAREUPDATE",73:"DRAFT_MAILMENTION",74:"SHARE_UNSUBSCRIBE",75:"STREAM_GROUP_ENABLE",76:"STREAM_GROUP_DISABLE",77:"MAIL_STREAMS_ENABLE",78:"MAIL_STREAMS_DISABLE",79:"ADD_LINK",80:"CHANGE_LINK_CATEGORY",81:"CHANGE_LINK_TITLE",82:"CHANGE_LINK_DESCRIPTION",83:"CHANGE_LINK_URL",84:"MARK_LINK_FAV",85:"CALENDAR_REMINDER",86:"CALENDAR_REMINDER_MAILID_CHANGE",87:"CALENDAR_SHARING",88:"CALENDAR_UNSUBSCRIBE",89:"BIZ_SUB_ONLINE_RENEW_DUE_FEWDAY",90:"BIZ_SUB_ONLINE_RENEW_TDY",91:"BIZ_SUB_ONLINE_RENEW_OVERDUE",92:"BIZ_SUB_ONLINE_RENEW_OVERDUE_TDY",93:"BIZ_SUB_OFFLINE_RENEW_DUE_FEWDAY",94:"BIZ_SUB_OFFLINE_RENEW_TDY",95:"BIZ_SUB_OFFLINE_RENEW_OVERDUE",96:"BIZ_SUB_OFFLINE_RENEW_OVERDUE_TDY",97:"BIZ_SUB_PURCHASE_MORE",98:"BIZ_SUB_PURCHASE",99:"DOMAIN_NOT_VERIFIED",100:"DOMAINS_NOT_VERIFIED",101:"MAIL_HOSTING_NIL",102:"MX_NOT_POINTED_TO_ZOHO",103:"REG_DOMAIN_AUTO_RENEW",104:"REG_DOMAIN_MANUAL_RENEW",105:"ADD_SUBTASK",106:"EDIT_LINK",107:"LOCK_INVITES",108:"UNLOCK_INVITES",109:"GROUP_MEMBER_ROLE_CHANGE",110:"DOMAIN_SPF_MISSING",111:"DOMAIN_DKIM_MISSING",112:"ADD_TWEET",113:"INVITE_PERMISSION_REQUEST",117:"ACCESS_REQUEST",134:"ARCHIVE_STREAMS","134/1":"EMAIL_ARCHIVE_STREAMS","134/2":"NOTES_ARCHIVE_STREAMS","134/3":"TASK_ARCHIVE_STREAMS","134/4":"EVENT_ARCHIVE_STREAMS","134/6":"STATUS_ARCHIVE_STREAMS","134/10":"BOOKMARK_ARCHIVE_STREAMS","134/13":"TWITTER_ARCHIVE_STREAMS",135:"UNARCHIVE_STREAMS","135/1":"EMAIL_UNARCHIVE_STREAMS","135/2":"NOTES_UNARCHIVE_STREAMS","135/3":"TASK_UNARCHIVE_STREAMS","135/4":"EVENT_UNARCHIVE_STREAMS","135/6":"STATUS_UNARCHIVE_STREAMS","135/10":"BOOKMARK_UNARCHIVE_STREAMS","135/13":"TWITTER_UNARCHIVE_STREAMS",150:"ADD_GROUP_MODERATOR",161:"MAIL_SHARE_UPDATE",171:"NEW_TWITTER_CONFIGURATION",173:"ENABLED_TWITTER_CONFIGURATION",174:"DISABLED_TWITTER_CONFIGURATION",175:"DISMISS",301:"TASK_PICKUP",303:"TASK_COMPLETE",304:"TASK_REOPEN",305:"TASK_SET_REPEAT",306:"TASK_CHANGE_REPEAT",307:"TASK_SET_PRIORITY_HIGH",308:"TASK_SET_PRIORITY_MEDIUM",309:"TASK_SET_PRIORITY_LOW",310:"TASK_SET_DUE_DATE",311:"REMOVE_ASSIGNEE",312:"TASK_DUE_DATE_CLEAR",313:"CUSTOM_STATUS",314:"TASK_ARCHIVE",315:"TASK_UNARCHIVE",317:"TASK_OVERDUE",318:"TASK_COPY",319:"TASK_MOVE",321:"TASK_MENTION"},x=function(e){return-1<o.GROUP_MEMBER.indexOf(e)},W=function(e){return-1<o.SHARED_FOLDER.indexOf(e)},a=function(e){return-1<o.REMOVE_SELF_FOR.indexOf(e)},j=function(e){return-1<o.MEMBER_ROLE_CHANGE.indexOf(e)},F=function(e){return o.INVITE_USER===e},G=function(e){return o.ADD_COMMENT===e},q=function(e){return-1<o.TASK_USER.indexOf(e)},E=function(e){return-1<o.NOTIFICATION_REMINDER.indexOf(e)},c=function(e){return e===o.CLEAR_COUNT},m=function(e){return o.DISMISS===e},u=function(e){return-1<o.ADD_TWEET.indexOf(e)},p=function(e){return-1<o.MARK_READ.indexOf(e)},f=function(e){return-1<o.DELETE_POST.indexOf(e)},v=function(e){return-1<o.DELETE_COMMENT.indexOf(e)},Y=function(e){return-1<o.TWITTER_CONFIG.indexOf(e)},h=function(e){return-1<o.ACCESS_REQUEST.indexOf(e)},N=function(e){return-1<o.ACCEPT_OR_DENY.indexOf(e)},Z=function(e){return-1<o.UPDATE_EVENT_STATUS.indexOf(e)},y=function(e){return"85"===e},g=function(e){return-1<o.SUPPRESS_NOTIFICATION.indexOf(e)},b=function(e){return"59"===String(e)},O=function(e){return o.DISMISS_ALL===e},J=function(e,t){return-1<o.NOTIFICATION_REMINDER.indexOf(e)&&"0"===String(t)},Q=function(e,t,n){return-1<o.NOTIFICATION_REMINDER.indexOf(e)&&("0"===n||0===Number(n))&&-1<["1","2","3","4","6","10"].indexOf(String(t))},C=function(e){return-1<["52","53"].indexOf(e)},X=function(e){return-1<o.ARCHIVE_STREAMS.indexOf(e)},T=["ctime","ctimestr","owner","sysevent","isMail","isDeleted","ntype","unread","nid","memberzuid","group","ownerName","memberrole","folder","shId","shgroups","etype","eid","isWms","rid"],I=["folder","group","shgroups","shgroup","nBy","members"],A=function(e){for(var t in e)if(e.hasOwnProperty(t))return t},S=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:",";return Array.isArray(e)?e:"string"==typeof e?e.split(t):"object"===babelHelpers.typeof(e)?Object.keys(e):[]},z=function(s){for(var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"push",a=[],e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return function(){for(var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"push",i=[],e=arguments.length,t=new Array(1<e?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return[].concat(t).reduce(function(e,t){return Array.isArray(t)?i=i.concat(babelHelpers.toConsumableArray(t)):i[n](t),e},{}),i}.apply(void 0,[void 0].concat(t)).reduce(function(e,t,n){var i="function"==typeof s?s(t):s;return e[i]||(e[i]=!0,a[o](t)),e},{}),a},R=function(e){return zmComponent.loadingBand({container:e,type:d.PAGINATION})},D=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};zmNCenter.Common.Utils.UtilMethods.ajaxRequest(e)},M=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if((e=I.reduce(function(e,t){return i=t,(n=e).hasOwnProperty(i)&&"string"==typeof n[i]&&(n[i]=$.parseJSON(n[i])),n;var n,i},e)).nIdKeys){var t=e.nIdKeys;t=(t=(t=t.replace("[","")).replace("]","")).split(","),e.nIdKeys=t}return e},k={keys:[],values:[],hasNext:!0},P={itemIndex:0},H=e.RANGE,U=function(){function s(){babelHelpers.classCallCheck(this,s)}return babelHelpers.createClass(s,null,[{key:"get",value:function(e){for(var t=0<e?e:0,n=[],i=k.keys.length,s=0;s<i;++s)n.push(k.values[k.keys[t+s]]);return n}},{key:"getEntity",value:function(e){return e&&k.values[e]}},{key:"update",value:function(e,t){if(e&&-1<k.keys.indexOf(e)&&t){var n=k.values[e];for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return k.values[e]=n}}},{key:"remove",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).nid,t=k.keys.indexOf(e);0<=t&&(k.keys.splice(t,1),delete k.values[e],P.itemIndex=0<P.itemIndex?P.itemIndex-1:P.itemIndex)}},{key:"put",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0,n=e.nid;return k.keys.indexOf(n)<0?(k.keys.splice(t,0,n),k.values[n]=e,++P.itemIndex,e):s.merge(e)}},{key:"hasNid",value:function(e){return e&&k.values[e]}},{key:"replace",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.nid,n=k.keys.indexOf(t);return k.values[t]=e,k.keys.splice(n,1),--P.itemIndex,k.keys.splice(P.itemIndex,0,t),++P.itemIndex,e}},{key:"merge",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.nid;e=k.values[n];var i=k.keys.indexOf(n);return t.isWms?(e=function e(n,i){var t={};return t.nBy=z(A,void 0,i.nBy||[],n.nBy||[]),t.nby=z(function(e){return e},void 0,S(i.nby),S(n.nby)),t.commentuuid=z(function(e){return e},void 0,S(i.commentuuid),S(n.commentuuid)),t.summary=z(function(e){return e},void 0,S(i.summary),S(n.summary)),t.ncount=t.nby.length,t.members=z(A,void 0,S(i.members),S(n.members)).reduce(function(e,t){return e[t]=(i.members||{})[t]||(n.members||{})[t],e},{}),T.forEach(function(e){t[e]=i[e]||n[e]}),W(i.ntype)&&(e.hideAcceptButton=!1,e.folder=i.folder,e.shId=i.shId),t}(e,t),k.values[n]=e,0<i&&(k.keys.splice(i,1),k.keys.splice(0,0,n)),e):s.replace(t)}},{key:"appendData",value:function(e){var t=e.length;for(var n in k.hasNext=H<t,e){var i=e[n];s.put(i,P.itemIndex)}}},{key:"prependData",value:function(e){return s.put(e,0)}},{key:"hasData",value:function(e){return k.keys.length>(e?H:1)}},{key:"hasNext",value:function(){return k.hasNext}},{key:"reset",value:function(){k.keys=[],k.values={},k.hasNext=!0,P.itemIndex=0}},{key:"getLastItem",value:function(){return(k.values[k.keys[P.itemIndex-1]]||{}).nid}},{key:"getLastItemIndex",value:function(){return P.itemIndex}},{key:"getObjectsOfEid",value:function(e){for(var t={},n=0;n<k.keys.length;++n){var i=k.keys[n],s=k.values[i];s.eid===e&&(t[i]=s)}return t}},{key:"getObjectsOfCommentUUID",value:function(e){for(var t,n,i={},s=0;s<k.keys.length;++s){var o=k.keys[s];void 0,n=(t=e+"_").length,t===o.substring(0,n)&&(i[o]=k.values[o])}return i}},{key:"getKeys",value:function(){return k.keys}},{key:"getValues",value:function(){return k.values}}]),s}(),L=!1,B=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"initiated",value:function(e){L=!0,t=R(e)}},{key:"completed",value:function(e){L=!1,t(),$.q(e).find(".SC_sld").remove()}},{key:"inProgress",value:function(){return L}}]),e}(),w=e.RANGE,V=function(){function o(){babelHelpers.classCallCheck(this,o)}return babelHelpers.createClass(o,null,[{key:"getData",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.callback,n=e.initialLoad;if(n){if(U.hasData(n))return t(U.get(0),e),!1;U.hasNext()||U.reset()}else if(!n&&!U.hasNext()||B.inProgress())return!1;B.initiated(e.listInstance.$listWrapper[0]);var i=U.getLastItemIndex(),s={mode:"groupedlist",range:w,isPrev:!1,entityType:"-1",startIndex:i};n&&0<i&&(e.addPrev=!0),D({param:s,callback:{fn:o.updateCache,args:[t,e]},onerror:B.completed,onnetfailure:B.completed})}},{key:"parseResponse",value:function(e){var t=[];return Array.isArray(e)&&(t=e),t}},{key:"updateCache",value:function(e,t){var n=o.parseResponse(e),i=t[0],s=t[1];U.appendData(n),s.addPrev&&(n=U.get(0)||[]),i(n,s),B.completed(s.listInstance.$listWrapper[0])}},{key:"getCount",value:function(e){zmail.hasOwnProperty("ncount")?e(0):D({param:{mode:"count"},callback:{fn:function(e,t){U.count=e.count,t(U.count)},args:e}})}},{key:"hasNext",value:function(){return U.hasNext()}},{key:"hasNid",value:function(e){return U.hasNid(e)}},{key:"put",value:function(e){return U.prependData(e)}},{key:"update",value:function(e,t){return U.update(e,t)}},{key:"getEntity",value:function(e){return U.getEntity(e)}},{key:"remove",value:function(e){return U.remove(e)}},{key:"resetCache",value:function(){return U.reset()}},{key:"getObjectsOfEid",value:function(e){return U.getObjectsOfEid(e)}},{key:"getObjectsOfCommentUUID",value:function(e){return U.getObjectsOfCommentUUID(e)}},{key:"getCache",value:function(){return U.getValues()}}]),o}(),K=zmText.get("notificationCenter"),ee=Object.freeze({MOUSE:{MOUSEUP:"mouseup",MOUSEDOWN:"mousedown",CLICK:"click"},TAB_SWITCH:"/apps/tabSwitched",REMOVE_PREVIEW:{TAB:"/ncenter/removePreview/tab",POPOUT:"/ncenter/removePreview/popout"},NEW_NOTIFICATION:{TAB:"/ncenter/newNotification/tab",POPOUT:"/ncenter/newNotification/popout"},REMOVE_NOTIFICATION:{TAB:"/ncenter/removeNotification/tab",POPOUT:"/ncenter/removeNotification/popout"},REMOVE_UNREAD:{TAB:"/ncenter/removeUnread/tab",POPOUT:"/ncenter/removeUnread/popout"},DELETE_COMMENT:{TAB:"/ncenter/deleteComment/tab",POPOUT:"/ncenter/deleteComment/popout"},DISMISSALL:{SHOW:"/ncenter/dismissAll/show",HIDE:"/ncenter/dismissAll/hide"},PICKER_CLOSE_EVENT:"/ncenter/snooze/picker/close",STOP_EVENTS:"/ncenter/stopEvents",TOPBAR_CLOSE_EVENT:"zmTopBar/popover/close",TOPBAR_OPEN_EVENT:"zmTopBar/popover/open",HIDE_MENU_EVENT:"/mail/menuCreated",CLOSE_POPOUT_PREVIEW:"/ncenter/closePreview",RECONNECT:"zmailReconnect",TAB_CLOSE:"/ncenter/internal/tabClose",OFFLINE:"/network/offline",ONLINE:"/network/online",POPOUT_CLOSE:"/ncenter/popout/close",CLOSE_POPOUT_PREVIEW_FROM_STREAMS:"/streams/closePopOut",EDITORCLICK:"/editor/click",OPEN_NOTIFICATION:"/zmcenter/popout/open",WORKSPACE_POST_SWITCH:"/apps/tabSwitched"}),te=Object.freeze({mode:"clearAll"}),ne=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"dismissAllNotifications",value:function(){var n=zmText.get("notificationCenter"),e=function(e,t){e&&(_zm.succErrMsg("s",n.dismissAllNotifications.success),$.publish(ee.RECONNECT),$.publish(ee.DISMISSALL.HIDE))},t=function(){_zm.succErrMsg("e",n.dismissAllNotifications.failure)};Dialog.confirm(n.dismissAllNotifications.confirmMsg,function(){D({param:te,callback:{fn:e,args:[]},onerror:t})},function(){},{okButtonName:n.dismissAllNotifications.button.yes,cancelButtonName:n.dismissAllNotifications.button.no})}}]),e}(),ie=Object.freeze({STREAMS:["25","29","38","44","45"],MAIL:["59"],TASK:["42"],NOTES:[]}),se="msi-comment",oe="msi-mention",ae=Object.freeze({STREAM_ICON_HIGHLIGHT:"SC_newActivity",TAB_ICON:"msi-notification",CLOSE_ICON:"msi-close",UNREAD:"notiUnread",ENTITY_ICON:{0:"msi-reminder",1:"msi-mail",2:"msi-notes",3:"msi-task",4:"msi-calendar",6:"msi-status",8:"msi-folder",9:"msi-mail",10:"msi-links",13:"msi-twitter"},ACTION_ICON:{31:se,36:se,43:se,25:oe,38:oe,44:oe,45:oe,23:"msi-love",49:"msi-love",29:"msi-invitee",50:"msi-addgroup"},LIST:{NAV_CLASS:"notiSel",SELECTION:"notiSel",KEYBOARD_SELECTION_CLASS:"js-noti-sel"}}),re=zmText.get("notificationCenter"),le=function(a,e,t,n){var i,s,o=a.group.id,r=a.eid,l=a.etype,c=a.group.isGroup?"viewGroupEntity":"viewSelfData",m=a.shId||"",d=a.ntype;s=function(e,t,n){var i=2;e&&(i=3);var s={msgId:a.eid,type:"lt",opentype:i,tId:a.tid,tabId:"zmncenter",subject:a.summary[0],src:"zmncenter",isReminder:!0},o={prevElem:e,viewDetails:{view:"notification"}};a.commentuuid&&(s.commentuuid=a.commentuuid),zmList.getMailData(s,o)},Q(d,l,a.owner)||J(d,l)||"59"!==String(d)?(i=function(e,t,n){var i={gid:o,pid:r,etype:l,actionType:c,fixedComment:t,allComments:!0,elm:e,shId:m,ntype:d,group:a.group,markRead:!0,opentype:n};a.commentuuid&&(i.commentuuid=a.commentuuid),zmStreamsApp.events.openPost(i)},zmUtil.requireStreamsApp().then(function(){i(e,t,n)})):s(e)},ce=function(e,t){ZCL_streamEve.streamEveNotificationPreview(e,t)},me=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=e.previewElm,i=e.fixedComment,s=e.openType;y(t.ntype)?ce(t,n):le(t,n,i,s)},de=function(){var e,t,n,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=1<arguments.length?arguments[1]:void 0;zmNCenter&&zmNCenter.counter&&s&&zmNCenter.counter.decrement(),!(Q(i.ntype,i.etype,i.owner)||J(i.ntype,i.etype))&&b(i.ntype)?(n=i,zmList.getMailData({msgId:n.eid,tId:n.tid||n.eid,opentype:2,type:"lt",isRemainder:!0,src:"external"})):(t={gid:(e=i).group.id,pid:e.eid,etype:e.etype,actionType:e.group.isGroup?"viewGroupEntity":"viewSelfData",allComments:!0,shId:e.shId||"",ntype:e.ntype,group:e.group,markRead:!0},e.commentuuid&&(t.commentuuid=e.commentuuid),zmUtil.loadStreamsInTab(t))},ue=function(){var e,t,n,i,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=s.name,a=s.iconSet;if(!zmsuite.isWorkspaceAvailable(o)){zmsuite.setWorkSpace(s.appConfig),n=(t=zmsuite.getCenter(o)[1]).getNodes()[0],_zm.addClass(n.$el.children(".SC_phd")[0],"SC_Sph"),n.push({text:"",rIcons:[[{tooltip:re.common.close,iconClass:ae.CLOSE_ICON,data:"close"}]]}),n.setListener("click",function(e){"close"===e&&s.closePreview&&(s.closePreview(t),$.publish("/zmncenter/tab/removeSelection"))}),zmsuite.renderWorkSpace();var r=(e=zmsuite.getCenter(o)[0].getNodes())[1];if(a&&zmIconConstructor.removeIconSet({containerID:a.id}),a=zmIconConstructor.createIcon({iconList:[{id:"tab_noti_dismissall",type:"text",haveSeparator:!1,haveThemeColor:!0,text:re.common.dismissAll,callback:s.dismissAllHandler}]}),r.$el.find(".zmAHBlk").appendDOM(zdom("div",{className:"zmAHRow jsAppHaed"},zdom("strong",null,s.appConfig.appname))),a&&a.$el)r.$el.find(".zmAMB").appendDOM(a.$el)}return zmsuite.showWorkSpace(o),(i=(e=zmsuite.getCenter(o))[0].getNodes()[2].$el).clearHTML(),i.appendDOM(zdom("div",{className:"zmNotiListWra inTab js-tab"})),{centerObj:e,dismissBtn:void 0,iconSet:a,listArea:i.children()[0],previewCard:e[1]}},pe=zmText.get("notificationCenter"),fe=function(e){return pe.entity[e]},ve=function(e,t,n,i){var s=pe.notificationTypes,o=[l[e],n?"FOLLOWER":"OWNER",i?"PLURAL":r[t]],a=o.join("/");return s.hasOwnProperty(a)||(o.pop(),o.push("COMMON"),a=o.join("/")),s[a]||a},he=function(i){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=!1,n=(e.nBy||[]).filter(function(e,t,n){return void 0!==e[i]})[0]||{},s={g:2,zid:"",nn:"",photo:"",eid:"",fn:""};if((u(e.ntype)||Y(e.ntype))&&(n[i]=function(e){try{if("object"!==babelHelpers.typeof(e))return e=JSON.parse(e),!0}catch(e){return!1}return!1}(n[i])?$.parseJSON(n[i]):function(t){var n=t||"";if("object"===babelHelpers.typeof(t))return t;try{return t="string"==typeof t&&$.parseJSON(t)}catch(e){return zmUtil.debugLog(e),zmUtil.debugLog(t),{oName:n,displayName:(t="string"==typeof t&&t.split("@"))[0],screenName:t[1]}}}(n[i]),n[i]=n[i]||{},n.fn=n[i].displayName||n[i].oName||n[i].screenName||"",s.screenName=n.screenName||n[i].screenName,s.photo=n[i].imageUrl||s.photo,t=!0),n[i]&&(s.zid=i,s.fn=n.fn||("string"==typeof n[i]?n[i]:"")),s.photo=s.photo||zmResource.get("image","SC-Photo.png"),s.isDummyObj=!0,!t){var o=zmail.ContactBook.get({zuid:i,promise:!1,type:"org"});0<o.length&&((s=o[0].attrs).avatar=o[0].avatar&&o[0].avatar())}return s},Ee=function(e){return zmComponent.dateTimeUtil.relativeTime(e,"mm dd at hr:min",zmail.userOptions.isRailTime)},Ne=function(e){var t=zmail.userDateFormat.toLowerCase()+" hr:min";return zmComponent.dateTimeUtil.format(new Date(Number(e)),t,zmail.userOptions.isRailTime)},ye=zmText.get("notificationCenter"),ge=function(){var e,t,n,i,s,o,a,r,l,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},m=c.summary,d=c.ctime,u=c.eventData||(Array.isArray(m)?m[0]:m);return c.eventData="string"==typeof u?$.parseJSON(u):u,(u=c.eventData).remTime=(e="0"===String(u.remType)?"start":"end",t=u.remTime,o=ye.eventNotification.timeRemaining,s={unit:"millis",value:n=t,state:e},(i=n/1e3)<60?s.unit="seconds":(i/=60)<60?s.unit="minutes":(i/=60)<24?s.unit="hours":(i/=24,s.unit="days"),s.value=i,r=(a=s).unit,l=a.value,zmText.applyArgs(o[r][e],{value:l})),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t="zmNotiList js-noti-list-item"+(e.unread?" notiUnread":""),n=e.eventData.title,i=e.eventData.remTime,s=e.eventData.stDate,o=e.ctime,a=zmText.get("notificationCenter").common.close,r=Ee(o),l=Ne(o);return zdom("div",{className:t},zdom("div",{className:"zmNotiListData"},zdom("div",{className:"zmNotiImg"},zdom("i",{className:"msi-reminder zmThmClr"})),zdom("div",{className:"zmNotiDtl"},zdom("div",{className:"zmNotiSub"},zdom("strong",null,i)," @ "+s),zdom("h3",null,n),zdom("div",{className:"zmNotiBtmInfo js-bottom-info"},zdom("div",{className:"zmNotiBtmLeft"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"zmnTimer","data-zmn-timer":o,"data-tooltip":l},r),zdom("span",{className:"zmSDot"})))),zdom("div",{className:"zmNotiAction js-close-btn"},zdom("i",{className:"msi-close","data-tooltip":a,"data-tooltip-pos":"left"}))))}({eventData:u,ctime:d,unread:c.unread&&c.isWms})},be=zmText.get("notificationCenter"),Oe={MARGIN:{"margin-left":"auto"}},Ce=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100;return e.length>t?e.substring(0,t):e},Te=function(e){return zdom("strong",null,e)},Ie=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return document.createTextNode(e)},Ae=function(e,o){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];o=o instanceof Array?o[0]:o,o=!e&&o&&0<o.trim().length?o:"",o=Ce(o);var r=[],t=a?"":$.e(document.createDocumentFragment()),n=zmSmiley.replaceText(o);if(n.length){var l=0;n.forEach(function(e,t,n){var i,s=o.substring(l,e.from);r.push(a?s:Ie(s)),r.push(a?e.text:(i=e.text,zdom("font",{className:i}))),l=e.to}),l<o.length&&r.push(a?o.substring(l,100-l):Ie(o.substring(l,100-l)))}else r.push(a?o:Ie(o));return o&&(r.splice(0,0,a?" : ":Ie(" : ")),r.push(a?"...":Ie("..."))),r.forEach(function(e){a?t.concat(e):t.appendDOM(e)}),t},Se=function(e,t){var n=Ie(" "+be.common.and+" "),i=e?Ie(t+" "+be.common.others):Te(t);return zdom("zmfrag",null,n,i)},_e=3,ze={companyName:"{{companyName}}",productName:"{{productName}}",groupName:"{{groupName}}",entityName:"{{entityName}}",entityValue:"{{entityValue}}",entityAccess:"{{entityAccess}}",userName:"{{userName}}",tagName:"{{tagName}}",preposition:"{{preposition}}",pronoun:"{{pronoun}}",wallName:"{{wallName}}",handleName:"{{handleName}}",taskName:"{{taskName}}",memberRole:"{{memberRole}}"},Re=function(e,t,n){return e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),t.replace(new RegExp(e,"gi"),n)},De=function(e,t,n){return void 0!==n?e.replace(t,n):e},Me=function(e){var t,n,i,s,o,a,r,l,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},m=2<arguments.length?arguments[2]:void 0;return t=e,n=zmail.globalI18N.companyName||d.companyName,i=zmail.globalI18N.productName||d.systemName,t=Re(ze.companyName,t,n),e=t=Re(ze.productName,t,i),c.preposition=c.preposition?c.preposition+" ":"",e=function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return n.memberName&&(n.userName=n.memberName),["entityName","entityAccess","entityValue","userName","memberRole","wallName","preposition"].reduce(function(e,t){return De(e,ze[t],n[t])},e)}(e,c),m?De(e,ze.groupName,c.groupName):(s=e,o=c.groupName,a=$.e(document.createDocumentFragment()),r=ze.groupName,-1<(l=s.indexOf(r))?(a.appendDOM(Ie(s.substring(0,l))),a.appendDOM(Te(o)),a.appendDOM(Ie(s.substring(l+r.length)))):a.appendDOM(Ie(s)),a)},ke=function(e,t){return 0!==e||e!==t-1},Pe=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0,s=n.pronoun,o=n.memberName,a=n.entityName,r=(t=e.split(" ")||[]).length;return t=t.map(function(e,t){var n=ke(t,r);return e===ze.pronoun?i?s+(n?" ":""):Ie(s+(n?" ":"")):e===ze.userName?i?o+(n?" ":""):Ie(o+(n?" ":"")):e===ze.entityName?i?a+(n?" ":""):Ie(a+(n?" ":"")):i?e+(n?" ":""):Ie(e+(n?" ":""))}),i?t.join(" "):t},He=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0,s=n.entityName,o=n.entityValue,a=n.entityAccess,r=n.preposition?n.preposition+" ":"",l=(t=e.split(" ")||[]).length;return e=e.replace(ze.preposition,r),t=t.map(function(e,t){var n=ke(t,l);return e===ze.entityName?i?s+(n?" ":""):Ie(s+(n?" ":"")):e===ze.entityValue?i?o+(n?" ":""):Ie(o+(n?" ":"")):e===ze.entityAccess?i?a+(n?" ":""):Ie(a+(n?" ":"")):i?e+(n?" ":""):Ie(e+(n?" ":""))}),i?t.join(" "):t},Ue=zmText.get("notificationCenter"),Le=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return E(t.ntype)?Ue.common.You:e},Be=function(n){return n.filter(function(e,t){return n.indexOf(e)===t})},$e=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.map(function(e){return he(e,t)})},we=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length?arguments[1]:void 0,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=$.e(document.createDocumentFragment());return e.slice(0,t).forEach(function(e,t){0<t&&o.appendDOM(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:", ";return Ie(e)}());var n=Le(e.fn,s),i=Te(n);o.appendDOM(i)}),o},Ve=function(){var e,t,n,i,s,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=o.nby,l=o.ncount,c=[],m=_e;if($.extend(a,{ntype:o.ntype,nBy:o.nBy}),i=l-m,t=(n=m<(e=(s=$e(Be(r="string"==typeof r?[r]:r),a)).length)&&m<l&&0<i)?m:e,c.push(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length?arguments[1]:void 0,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o="";return e.slice(0,t).forEach(function(e,t){0<t&&(o+=", ");var n=e.fn.split(/\s+/),i=Le(n[0],s);o+=i}),o}(s,t,a)),n){var d=Se(n,i);c.push(d.text())}return{txt:c,recent:s[0]}},Ke=zmText.get("notificationCenter"),xe=function(e){var t,n,i,s,o,a=$.e(document.createDocumentFragment()),r=e.etype,l=Ke.common.few_seconds_ago,c=e.ctime,m=e.ntype,d=e.owner,u=String(d)===String(zmail.zuid),p=e.unread,f=e.shgroups,v=f&&Array.isArray(f)&&f[0]||e.shgroup||e.group,h=v&&v.isGroup,E=(s=m,o=r,ae.ACTION_ICON[s]||ae.ENTITY_ICON[o]),N={ntype:m,nBy:e.nBy},y=function(){var e,t,n,i,s,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=o.nby,l=o.ncount,c=$.e(document.createDocumentFragment()),m=_e;if($.extend(a,{ntype:o.ntype,nBy:o.nBy}),i=l-m,t=(n=m<(e=(s=$e(Be(r="string"==typeof r?[r]:r),a)).length)&&m<l&&0<i)?m:e,c.appendDOM(we(s,t,a)),n){var d=Se(n,i);c.appendDOM(d)}return{recent:s[0],$user:c}}(e),g=y.recent.g,b=y.recent.photo,O=y.recent.avatar,C=1<e.ncount,T=G(m),I=J(m,r),A=Q(m,r,d),S=W(m),_=X(m),z=S?e.folder:void 0,R=j(m),D=x(m),M=F(m),k=Y(m),P=q(m),H={entityName:fe(r),groupName:h?v.name:v.name+Ke.phrases.someoneHome,preposition:h?"":Ke.common.your,wallName:h?v.name:Ke.common.streams};I?m+="/A":A?m+="/S":_&&(m+="/"+r),i=ve(m,g,!u,C);var U=T?d:e.memberzuid,L=U===zmail.zuid;if(D||R||M||P||T){H.memberName=L?Ke.common.you:he(U,N).fn,H.memberName=H.memberName||e.ownerName;var B=Object.keys(e.members||{});!T&&B.length&&(H.memberName=B[0]===zmail.zuid?Ke.common.you:e.members[B[0]],2<=B.length&&(H.memberName+=", "+(B[1]===zmail.zuid?Ke.common.you:e.members[B[1]])),3<=B.length&&(H.memberName+=" "+Ke.common.and+" "+(B.length-2)+" "+Ke.common.others))}if(S&&z){var w=z.role;H.entityAccess=Ke.acceptShare[w]||w,H.entityValue=z.fName}if(k&&(H.handleName=y.recent.fn),Z(m)&&(H.groupName=v.name,U===zmail.zuid?H.groupName=Ke.phrases.selfHome:h||(H.groupName+=Ke.phrases.someoneHome)),R&&(H.memberRole=e.memberrole||"moderator"),e.ctime&&(l=Ee(e.ctime),n=Ne(e.ctime)),a=y.$user,t=Ae(C,e.summary),a.appendDOM(Ie(" ")),M){var V=he(e.owner,e),K="string"==typeof e.nby?e.nby:e.nby[0];if(e.owner===K)switch(V.g){case 0:H.pronoun=Ke.pronoun.her;break;case 1:H.pronoun=Ke.pronoun.his;break;case 2:H.pronoun=(V.fn||e.ownerName)+Ke.pronoun.apos}else H.pronoun=(V.fn||e.ownerName)+Ke.pronoun.apos;a.appendDOM(Pe(i,H))}else S?a.appendDOM(He(i,H)):a.appendDOM(Me(i,H));return a.appendDOM(t),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t="zmNotiList js-noti-list-item"+(e.unread?" notiUnread":""),n=e.ctime,i=e.$text,s=e.timestamp,o=e.photoUrl,a=e.avatar,r=be.common.close,l=e.absoluteTimeStamp,c=e.actionIcon;return zdom("div",{className:t},zdom("div",{className:"zmNotiListData"},zdom("div",{className:"zmNotiImg"},a||zdom("img",{src:o})),zdom("div",{className:"zmNotiDtl"},zdom("div",{className:"zmNotiSub","data-framedText":!0},i),zdom("div",{className:"zmNotiBtmInfo js-bottom-info"},zdom("div",{className:"zmNotiBtmLeft"},zdom("i",{className:c}),zdom("span",{className:"zmnTimer js-zmnTimer","data-zmn-timer":n,"data-tooltip":l},s),zdom("span",{className:"zmSDot js-dot"}),zdom("i",{"data-id":"openInTab","data-tooltip":be.common.openInTab,className:"msi-openInTab"})))),zdom("div",{className:"zmNotiAction js-close-btn","data-tooltip":be.common.close},zdom("i",{className:"msi-close","data-tooltip":r,"data-tooltip-pos":"left"}))))}({photoUrl:b,avatar:$.e(O)[0],$text:a[0],actionIcon:E,timestamp:l,absoluteTimeStamp:n,ctime:c,unread:e.isWms&&p,openInTab:Ke.common.openInTab})},We=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"getUI",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return y(e.ntype)?ge(e):xe(e)}},{key:"getText",value:function(){return function(e){var t,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=[],o=e.etype,a=e.ntype,r=e.owner,l=String(r)===String(zmail.zuid),c=e.shgroups,m=c&&Array.isArray(c)&&c[0]||e.shgroup||e.group,d=m&&m.isGroup,u=Ve(e),p=1<u.count,f=J(a,o),v=Q(a,o,e.owner),h=W(a),E=h?e.folder:void 0,N=j(a),y=x(a),g=F(a),b=G(a),O=q(a),C=u.recent.g,T=u.recent.photo,I=ve(a,C,!l,p),A={entityName:fe(o),groupName:d?m.name:m.name+Ke.phrases.someoneHome,preposition:d?"":Ke.common.your,wallName:d?m.name:Ke.common.streams};if(f?I=ve(a+"/A",C,!l,p):v&&(I=ve(a+"/S",C,!l,p)),y||N||g||b||O){var S=(n=b?e.owner:e.memberzuid)===zmail.zuid;A.memberName=S?Ke.common.you:he(n).fn}if(h&&(A.entityAccess=E.role,A.entityValue=E.fName),N&&(A.memberRole=e.memberRole||"moderator"),t=Ae(p,e.summary,!0),Array.isArray(t)&&(t=t.join("")),s.push(u.txt),s.push(" "),g){var _=he(e.owner,e),z=_.fn.split(/\s+/)[0]||e.ownerName,R="string"==typeof e.nby?e.nby:e.nby[0];if(e.owner===R)switch(_.g){case 0:A.pronoun=Ke.pronoun.her;break;case 1:A.pronoun=Ke.pronoun.his;break;case 2:A.pronoun=z+Ke.pronoun.apos}else A.pronoun=z+Ke.pronoun.apos;s.push(Pe(I,A,!0))}else h?s.push(He(I,A,!0)):s.push(Me(I,A,!0));return s.push(t),{tagName:e.nid,msg:s.join(""),imgUrl:T,callback:i.callback}}(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}}]),e}(),je=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"show",value:function(){var e,t,n,i,s,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a={title:"",msg:"",imgUrl:"",callback:void 0};if(e=o.ntype,t=ie.STREAMS,n=ie.TASK,i=ie.NOTES,s=ie.MAIL,-1<t.indexOf(e)||-1<s.indexOf(e)||-1<n.indexOf(e)||-1<i.indexOf(e)){a=We.getText(o,{callback:function(){de(o,!0)}});var r=zmail.Settings.MailSuite.Apps.GeneralSettings;r&&r.getStreamSounds&&(a.onShowCallback=function(){return r.getStreamSounds()}),_zm.pushDesktopNotification(a)}}}]),e}();zmNCenter.DesktopNotifier=je;zmail.conPath,zmail.conPath;var Fe=function(){},Ge=(zmText.get("notificationCenter"),$.publish),qe=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").replace("[","").replace("]","").split(",")},Ye=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.ntype;return!!l.hasOwnProperty(t)&&(function(e,t){if(a(t)&&-1<e.nby.indexOf(zmail.zuid)){e.nby="string"==typeof e.nby?e.nby.split(","):e.nby;var n=e.nby.indexOf(zmail.zuid);-1<n&&e.nby.splice(n,1)}}(e,t),0<e.nby.length)},Ze=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return y(e.ntype)||!(e.isDeleted||"true"===String(_zm.getProperty(e,"sysevent"))||Y(e.ntype))},Je=function(e,t,n,i){D({u:s.NOTIFICATION_URL,param:{mode:"clear",entityType:e.etype,notificationType:e.ntype,entityId:e.eid,nid:e.nid},callback:{fn:i,args:n}})},Qe=function(e,t){Ge(ee.REMOVE_PREVIEW.TAB,t),Ge(ee.REMOVE_PREVIEW.POPOUT,t)},Xe=function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Fe,a=4<arguments.length?arguments[4]:void 0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:Fe;$.e(e).slideUp(200,"linear",function(){if($.e(this).remove(),a){var e=$.e(a.listWrapper).children().last();e.length&&(t=e[0],n=(t=$.e(t)).offset().top,i=n+t.outerHeight(),s=$.e(window).scrollTop(),n<s+$.e(window).innerHeight()&&s<i)&&r(a)}var t,n,i,s;o()}),Ge(ee.REMOVE_NOTIFICATION.TAB,t),Ge(ee.REMOVE_NOTIFICATION.POPOUT,t),n||Qe(0,t)},et=function(e,t){var n=$.q(e.target);zmNCenter.States.isPickerVisible&&Ge(ee.PICKER_CLOSE_EVENT),n.closest("#zm-notification-list").length?Ge(ee.REMOVE_PREVIEW.POPOUT,t):(Ge(ee.REMOVE_PREVIEW.TAB,t),Ge(ee.POPOUT_CLOSE,t))},tt=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.commentuuid&&!Array.isArray(e.commentuuid)&&(e.commentuuid=qe(e.commentuuid)),e}(e)).commentuuid||[],n={};for(var i in t.forEach(function(e){var t=V.getObjectsOfCommentUUID(e);$.extend(n,t)}),n)if(n.hasOwnProperty(i)){var s=n[i];Ge(ee.REMOVE_NOTIFICATION.TAB,s),Ge(ee.REMOVE_NOTIFICATION.POPOUT,s),Qe(0,s)}},nt=function(e){return e&&e.stopPropagation()},it=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0,n=$.e(t).find('[data-id="openInTab"]').eq(0);return Ze(e)?function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e.off("mousedown mouseup click").on("mouseup click",nt).on("mousedown",function(e){nt(e),de(t),et(e,{closePreviewCard:!0})})}(n,e):(n.remove(),$.e(t).find(".js-dot").remove()),t},st=!1,ot=_.noop||function(){},at={time:500},rt=function(n,e,i,s,o,t){t&&t.stopPropagation(),st||(st=!1,Je(i,0,[e,i],function(e,t){st=!1,e&&function(e,t,n,i,s){var o,a=$.e(e),r=ae.LIST.SELECTION,l=ae.LIST.KEYBOARD_SELECTION_CLASS,c=a.hasClass(r);if(c){var m=n.$listWrapper.children();(o=m.last().is(a)?m.last():a.length?a.next():m.first()).length&&(s=!o.hasClass("js-noti-no-preview"))}Xe(e,t,s,function(){o&&o.length&&(zmUtil.scrollIntoView(o[0],at),c&&(o.addClass(l).addClass(r),o.trigger("click"))),a.removeClass(l).removeClass(r)},n,i)}(n,i,s,o,void 0)}))},lt=function(t,n,i){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ot,o=$.e(n).find(".js-close-btn");return o.on("mousedown",function(e){rt(n,o,t,i,s,e)}),o.on("mouseup click",function(e){return e.stopPropagation()}),n},ct=function(e){return Array.isArray(e.nby)?e.nby:e.nby.split(",")},mt=function(e,t,n,i){it(e,t),lt(e,t,n,i)},dt=function(e){e="object"===babelHelpers.typeof(e)?e[Object.keys(e)[0]]:e,_zm.succErrMsg("e",String(e))},ut=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=t[0],i=t[1],s=t[2];n.hideAcceptButton=!0,e&&Xe(i&&i[0]?i[0]:i,n,void 0,void 0,s.listinstance,s.paginate)},pt=function(e,t,n,i){D({u:zmail.conPath+"/post.do",param:{mode:"accessRequest",groupId:e.groupId,entityId:e.entityId,entityType:e.entityType,actionType:e.actionType,requesterId:e.requesterId},callback:{fn:t,args:i},onerror:n})},ft=function(e,t){var n=ct(e);return n=n.filter(function(e){return t!==e}),e.selectedMembers=e.selectedMembers||{},t&&delete e.selectedMembers[t],e.nby=Array.isArray(e.nby)?n:n.split(","),e.nby=e.nby.filter(function(e){return e!==String(t)}),e.nBy=e.nBy.filter(function(e){return String(e.id)!==String(t)}),e},vt=function(e){return e&&e.stopPropagation()},ht=zmText.get("notificationCenter"),Et=_.noop=_.noop||function(){},Nt=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).trigger=e.trigger.bind(babelHelpers.assertThisInitialized(e)),e.on=e.on.bind(babelHelpers.assertThisInitialized(e)),e.off=e.off.bind(babelHelpers.assertThisInitialized(e)),e.stopEvents=e.stopEvents.bind(babelHelpers.assertThisInitialized(e)),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"trigger",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.publish(e,t),this}},{key:"on",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Et;return this._subscribeHandler(e,t),this}},{key:"off",value:function(e,t){return this._unsubscribeHandler(e,t),this}},{key:"stopEvents",value:function(e,t){return e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),t&&e.preventDefault(),this}},{key:"destroyEvents",value:function(){return this._silenceObject(),this}}]),n}(zmail.Framework.Utils.PUBSUB),yt=ae.LIST.SELECTION,gt=function(e){$.e(e).find("."+yt).removeClass(yt)},bt=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"getActionButton",value:function(e){return zdom("div",{className:"zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn thmBdrBtn"},e))}}]),e}(),Ot=zmText.get("notificationCenter"),Ct={READ_ONLY:"11",READ_WRITE:"12",READ_WRITE_DELEGATE:"13"},Tt=function(e,t){var n=bt.getActionButton((Ot.label.gotoFolder||"").replace("{{folderName}}",_zm.getProperty(t.folder||{},"fName")));$.e(n).on("mouseup click",function(e){return e.stopPropagation()}),_zm.bind(n,"mousedown",function(e){e&&(e.stopPropagation(),et(e,{closePreviewCard:!0})),zmApp.showApp("m"),$.publish("/mail/listMails",{fId:t.eid,sharedFolderData:{rId:t.eid,rName:t.folder.fName,owner:t.owner,shareId:t.shId,rType:91,pShId:t.pShId,role:Ct[t.folder.role]}})}),e.find(".js-bottom-info").appendDOM(n)},It=function(){function s(){babelHelpers.classCallCheck(this,s)}return babelHelpers.createClass(s,null,[{key:"getKey",value:function(e){return _zm.getProperty(e,"folder.confirmationkey")}},{key:"req",value:function(e,t,n,i,s){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:function(){};D({u:zmail.conPath+"/confirm.do",param:{mode:"sharedFolder",key:n,ownerZuid:t,shId:e},callback:{fn:i,args:s},onerror:o,onnetfailure:o})}},{key:"confirmAction",value:function(o,a,r,e){if(e&&(e.stopPropagation(),et(e,{closePreviewCard:!0})),!r.__confirmationInitiated){r.__confirmationInitiated=!0;var t=r.shId,n=r.owner,i=s.getKey(r);s.req(t,n,i,function(e,t){if(r.__confirmationInitiated=!1,e){e="string"==typeof e?$.parseJSON(e):e;var n=t[1],i=e.pShId,s={};r.pShId=i,s.data={action:"USER_ADD",owner:n.nBy[0].id,rId:n.eid,shareId:n.shId,rName:n.folder.fName,pShId:i,rType:91},"READ_ONLY"===n.folder.role?s.data.role=Ct.READ_ONLY:"READ_WRITE"===n.folder.role?s.data.role=Ct.READ_WRITE:s.data.role=Ct.READ_WRITE_DELEGATE,zmAppLoader.load("sharefolder").then(function(){_zm.remove(o[0]),zmail.accId===zmail.defAccId&&(zmshare.shNotify(null,s),$.publish("/mail/listMails",{fId:r.eid,pShId:i}),Tt(a,r)),r.hideAcceptButton=!0})}},[o,r],function(){r.__confirmationInitiated=!1})}}},{key:"init",value:function(e,t){if(W(e.ntype)){var n,i=s.getKey(e);e.__confirmationInitiated=e.__confirmationInitiated||!1,i&&!e.hideAcceptButton?((n=$.e(bt.getActionButton(Ot.label.accept))).on("mousedown",s.confirmAction.bind(s,n,t,e)),n.on("mouseup click",function(e){return e.stopPropagation()}),t.find(".js-bottom-info").appendDOM(n)):C(e.ntype)&&Tt(t,e)}return t}}]),s}(),At=zmText.get("notificationCenter"),St=function(){function d(){babelHelpers.classCallCheck(this,d)}return babelHelpers.createClass(d,null,[{key:"getSpanElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return zdom("span",{className:t},e)}},{key:"lineBreak",value:function(){return zdom("br",null)}},{key:"getSnoozeDropDown",value:function(){return zdom("div",{className:"zmLst"})}},{key:"getSnoozeDismissButton",value:function(e){return zdom("div",{className:"zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn bdrBtn","data-val":"Snooze"},e.snooze,zdom("i",{className:"msi-barrow"})),zdom("div",{className:"zmBtn smallBtn bdrBtn","data-val":"Dismiss"},e.dismiss))}},{key:"getSnoozeCompleteButton",value:function(e){return zdom("div",{className:"zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn thmBdrBtn","data-val":"Snooze"},zdom("span",{className:"zmBtnText"},e.snooze),zdom("i",{className:"msi-barrow"})),e.complete?zdom("div",{className:"zmBtn smallBtn thmBdrBtn js-complete-btn","data-val":"Complete"},e.complete):void 0)}},{key:"getSnoozeText",value:function(e){return zdom("div",{className:"zmNotiSub"},zdom("strong",null,At.common.reminder+": "),e)}},{key:"getReminderDOM",value:function(e){var t=e.ctime,n=e.summary,i=e.entityType,s=e.isArbitaryReminder,o=At.common.close,a=At.common.openInTab,r=ae.ENTITY_ICON[i],l=Ee(t),c=Ne(t),m="zmNotiList js-noti-list-item"+(e.unread?" notiUnread":"");return zdom("div",{className:m},zdom("div",{className:"zmNotiListData"},zdom("div",{className:"zmNotiImg zmNotiAvtr zmNotiTraAvtr"},zdom("i",{className:"msi-reminder zmThmClr"})),zdom("div",{className:"zmNotiDtl js-rem-summary"},d.getSnoozeText(n),zdom("div",{className:"zmNotiBtmInfo js-bottom-info"},zdom("div",{className:"zmNotiBtmLeft"},zdom("i",{className:r}),zdom("span",{className:"zmnTimer","data-zmn-timer":t,"data-tooltip":c},l),zdom("span",{className:"zmSDot"}),s?zdom("i",{className:"msi-openInTab","data-id":"openInTab","data-tooltip":a}):void 0))),zdom("div",{className:"zmNotiAction js-close-btn"},zdom("i",{className:"msi-close","data-tooltip":o,"data-tooltip-pos":"left"}))))}}]),d}(),_t=zmText.get("notificationCenter"),zt=function(){},Rt="js-more",Dt="js-less",Mt=function(){function h(){babelHelpers.classCallCheck(this,h)}return babelHelpers.createClass(h,null,[{key:"getTrimmedSummary",value:function(t){var n=this,e=t.summary&&Array.isArray(t.summary)?t.summary[0]:t.summary,i=Ce(e),s=i.length!==e.length,o=$.e(document.createDocumentFragment());return i+=s?"... ":"",o.appendDOM(St.getSpanElement(i)),s&&(t.trimSummary=i,o.appendDOM(St.lineBreak()).appendDOM(St.getSpanElement(_t.common.more+"...","zmLink js-re-link "+Rt)),o.find(".js-re-link").on("mousedown",function(e){(function(e,t){e.stopPropagation();var n,i,s=e.target;i=s.classList.contains(Rt)?(s.classList.replace(Rt,Dt),n=t.summary+" ",_t.common.less+"..."):(s.classList.replace(Dt,Rt),n=t.trimSummary,_t.common.more+"..."),s.innerText=i,s.previousElementSibling.previousElementSibling.innerText=n}).apply(n,[e,t])})),o[0]}},{key:"snoozeBtnAction",value:function(e,t,n,i,s,o){o&&(o.stopPropagation(),et(o,{closePreviewCard:!0})),e.hasClass("shwInfo")?e.removeClass("shwInfo"):e.addClass("shwInfo"),e.find("[data-val='Snooze']").find("i").toggleClass("msi-barrow msi-tarrow"),$.e(t).slideToggle(),$.publish(ee.PICKER_CLOSE_EVENT)}},{key:"dismissNotifcation",value:function(n,i,e,s,o){Je(n,0,e,function(e,t){e&&Xe(i,n,void 0,void 0,s,o)})}},{key:"completeAction",value:function(n,i,s,o,a,e){e&&(e.stopPropagation(),et(e,{closePreviewCard:!0})),function(e,t,n,i){var s={mode:"complete",rid:e.rid||e.eid,mc:!0};if(Q(e.ntype,e.etype,e.owner)){var o=e.shgroups&&Array.isArray(e.shgroups)&&e.shgroups[0]||e.shgroup||e.group;s.eid=e.eid,s.gid=o.id}D({u:zmail.conPath+"/rem.do",param:s,callback:{fn:i,args:n}})}(s,0,[i,s],function(e,t){e&&h.dismissNotifcation(s,n,[i,s],o,a)})}},{key:"init",value:function(t,n,e,i){var s,o,a,r,l,c,m,d,u=this,p=4<arguments.length&&void 0!==arguments[4]?arguments[4]:zt,f=J(t.ntype,t.etype),v=Q(t.ntype,t.etype,t.owner);E(t.ntype)&&(c=function(){return"42"===t.ntype?{entityId:t.eid,groupId:t.group&&t.group.id}:f?{reminderId:t.rid||t.eid}:v?{reminderId:t.rid||t.eid,entityId:t.eid,groupId:t.group&&t.group.id}:{mymId:t.eid}},m=function(e){return f?"arbitraryReminder":"42"===e?"taskReminder":v?"streamsReminder":"mailReminder"},s=$.e(St.getSnoozeCompleteButton({snooze:_t.label.snooze,complete:f||v?_t.label.complete:void 0}))[0],a=$.e(s).find('[data-val="Complete"]').eq(0),o=$.e(s).find('[data-val="Snooze"]').eq(0),(f||v)&&(n=$.e(St.getReminderDOM({isArbitraryReminder:f,entityType:t.etype,ctime:t.ctime,summary:h.getTrimmedSummary(t),unread:t.unread&&t.isWms})),a[0]&&(a.on("mousedown",function(e){h.completeAction.apply(u,[n,a[0],t,i,p,e])}),a.on("click mouseup",function(e){return e&&e.stopPropagation()}))),r=zmUtil.createSnoozeComponent($.extend({},{type:m(t.ntype),arrowPosition:"popout"===e?"left":"right",onPickerVisibilityChange:function(e){zmNCenter.States.isPickerVisible=e},callback:function(){l.destroyPicker(),Xe(n,t)},onError:function(){},ui:{type:"notification_inline"}},c())).then(function(e){l=(r=e).component,(d=$.e(r.$el)).css("display","none"),$.e(r.$el).hide(),$.unsubscribe(ee.PICKER_CLOSE_EVENT,l.destroyPicker),$.subscribe(ee.PICKER_CLOSE_EVENT,l.destroyPicker),o.on("mousedown",function(e){h.snoozeBtnAction.apply(u,[n,d[0],l,o[0],t,e])}),o.on("click mouseup",function(e){return e&&e.stopPropagation()}),n.find(".js-bottom-info").appendDOM(s),n.appendDOM(d)}));return n}}]),h}(),kt=zmText.get("notificationCenter"),Pt={height:0,maxHeight:{"max-height":"424.2px"},top:{top:"40px"},block:{display:"block"},none:{display:"none"}},Ht=new zmail.Framework.Utils.PUBSUB,Ut=function(e,t,n){var i,s=he(t,{nBy:e.nBy,ntype:e.ntype});switch(n){case"popup":i=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=kt.label.accept,n=e.name,i=e.id,s=$.e(e.avatar)[0],o=e.imgUrl,a=kt.label.deny;return zdom("div",{className:"zmReqRw js-list-item","data-id":i},zdom("div",{className:"zmReqIcon"},zdom("i",{className:"msi-uncheck js-select"})),zdom("div",{className:"zmReqCont"},zdom("div",{className:"zmCB noHvr js-image"},s||zdom("div",{className:"SC_avtr"},zdom("img",{src:o})),zdom("span",{className:"zmCBName"},n))),zdom("div",{className:"zmReqBtnGrp zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn thmBgBtn js-btn-accept","data-val":"accept"},t),zdom("div",{className:"zmBtn smallBtn greyBgBtn js-btn-deny","data-val":"deny"},a)))}({name:s.fn,avatar:s.avatar,imgUrl:s.photo,id:t});break;case"inline":i=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.imgUrl,n=e.id,i=$.e(e.avatar)[0],s=kt.label.accept,o=kt.label.deny,a=e.name;return zdom("div",{className:"zmReqRw js-list-item js-inline","data-id":n},zdom("div",{className:"zmReqCont"},zdom("div",{className:"zmCB noHvr"},i||zdom("div",{className:"SC_avtr"},zdom("img",{src:t})),zdom("span",{className:"zmCBName"},a))),zdom("div",{className:"zmReqBtn"},zdom("div",{className:"zmReqBtnGrp zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn thmBgBtn js-btn-accept","data-val":"accept"},s),zdom("div",{className:"zmBtn smallBtn greyBgBtn js-btn-deny","data-val":"deny"},o))))}({id:t,avatar:s.avatar,name:s.fn,imgUrl:s.photo})}return i},Lt=zmText.get("notificationCenter"),Bt=$.subscribe,$t=ee.MOUSE.MOUSEUP+" "+ee.MOUSE.MOUSEDOWN+" "+ee.MOUSE.CLICK,wt=ee.MOUSE.MOUSEUP+" "+ee.MOUSE.MOUSEDOWN,Vt=ee.MOUSE.CLICK,Kt="msi-partcheck",xt="msi-uncheck",Wt="msi-check",jt="js-select-all",Ft="js-selectall-palette",Gt="js-select",qt="js-btn-accept",Yt="js-btn-deny",Zt="js-selectall-accept",Jt="js-selectall-deny",Qt="js-icon-selector",Xt="js-list-item",en="noHvr",tn="selected",nn=function(){function l(){babelHelpers.classCallCheck(this,l)}return babelHelpers.createClass(l,null,[{key:"updateSelectAllChecker",value:function(e,t,n){var i=ct(e),s=Object.keys(e.selectedMembers||{})||[],o=n.find("."+jt).closest(".zmReqRw");s.length===i.length?(n.find("."+jt).removeClass(xt+" "+Kt).addClass(Wt+" "+tn),o.addClass(tn)):s.length?(n.find("i."+jt).removeClass(xt+" "+Wt).addClass(Kt+" "+tn),o.addClass(tn)):(n.find("i."+jt).removeClass(Kt+" "+Wt).addClass(xt),o.removeClass(tn))}},{key:"updatePopupUIMemberCount",value:function(e,t,n){var i=[e.nBy.length,Lt.common.members,Lt.requestAccess.title].join(" ");n.find("#isMem").text(i)}},{key:"updatePopupSelectedMemberCount",value:function(e,t,n){var i=Object.keys(e.selectedMembers||{})||[],s=n.find("#selectedMembers");$.e(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.membersCount?zdom("b",{id:"selectedMembers"},zdom("span",{className:"js-selected-members"},e.membersCount),e.text):zdom("b",{id:"selectedMembers"},e.text)}({membersCount:i.length,text:i.length?Lt.common.membersSelected:Lt.common.selectMembers})).insertDOMBefore(s),s.remove(),i.length?n.find("."+Ft).removeClass(en):n.find("."+Ft).addClass(en)}},{key:"updatePopupUI",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};l.updateSelectAllChecker(e,t,n,i),l.updatePopupUIMemberCount(e,t,n,i),l.updatePopupSelectedMemberCount(e,t,n,i)}},{key:"destroy",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};l.getHandler(e,t,n,"closePopupHandler",i)(),Je(e,0,[e,n,i],ut)}},{key:"constructPopupListItems",value:function(t){var n=$.e(document.createDocumentFragment());return ct(t).forEach(function(e){n.appendDOM(Ut(t,e,"popup"))}),n}},{key:"selectHandler",value:function(s,o,a){return function(e){vt(e);var t=$.e(e.target).closest("."+Gt),n=t.closest(".zmReqRw"),i=$.e(e.target).closest("."+Xt).data("id");s.selectedMembers=s.selectedMembers||{},t.hasClass(Wt)?(t.removeClass(Wt+" "+Kt).addClass(xt),n.removeClass(tn),i&&delete s.selectedMembers[i]):(t.removeClass(xt+" "+Kt).addClass(Wt+" "+tn),n.addClass(tn),i&&(s.selectedMembers[i]=!0)),l.updatePopupUI(s,o,a)}}},{key:"selectAllHandler",value:function(i,s,o){return function(e){vt(e);var t=ct(i),n=$.e(e.target).closest("."+jt);n.hasClass(Wt)||n.hasClass(Kt)?(n.removeClass(Wt+" "+Kt).addClass(xt),i.selectedMembers={},s.find("."+Gt).removeClass(Wt).addClass(xt),s.find(".zmReqRw").removeClass(tn)):(i.selectedMembers={},t.forEach(function(e){i.selectedMembers[e]=!0}),n.removeClass(xt).addClass(Wt),s.find("."+Gt).removeClass(xt).addClass(Wt),s.find(".zmReqRw").addClass(tn)),l.updatePopupUI(i,s,o)}}},{key:"individualHandler",value:function(n,i,s,o,e){pt({groupId:(n.group||{}).id,entityId:n.eid,entityType:n.etype,actionType:e,requesterId:o},function(e){var t=s.find('[data-id="'.concat(o,'"]'));t.slideUp("slow","linear",function(){t.remove(),ft(n,o),ct(n).length?(l.updatePopupUI(n,i,s),Ht.publish(String("/inline/ui/render/"+n.nid),n)):l.destroy(n,i,s)})},dt,[])}},{key:"getHandler",value:function(n,i,s,o,a){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};return function(e){var t;switch(vt(e),o){case"handler":t=$.e(e.target).closest("."+Xt).data("id"),l.individualHandler(n,i,s,t,a,r);break;case"allHandler":l.allHandler(n,i,s,a,r);break;case"closePopupHandler":l.unbindEvents(n,i,s,r),s.remove()}}}},{key:"allHandler",value:function(n,i,s,e){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};if(!n._allHandlerConfirmationInitiated){n._allHandlerConfirmationInitiated=!0,n.selectedMembers=n.selectedMembers||{};var t=Object.keys(n.selectedMembers)||ct(n);t.length?pt({groupId:(n.group||{}).id,entityId:n.eid,entityType:n.etype,actionType:e,requesterId:t},function(e){n._allHandlerConfirmationInitiated=!0,Object.keys(n.selectedMembers||{}).forEach(function(e){ft(n,e)});var t=ct(n)||[];n._allHandlerConfirmationInitiated=!1,t.length?(l.rerender(n,i,s,o),Ht.publish(String("/inline/ui/render/"+n.nid),n)):l.destroy(n,i,s)},function(e){dt(e),n._allHandlerConfirmationInitiated=!1},[n,i,s,o]):(_zm.succErrMsg("e",String(Lt.requestAccess.popup.noSelection)),n._allHandlerConfirmationInitiated=!1)}}},{key:"bindEvents",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};n.off($t).on($t,vt),t.find("."+Gt).off(wt).on(wt,vt).off(Vt).on(Vt,l.selectHandler(e,t,n,i)),t.find("."+qt).off(wt).on(wt,vt).off(Vt).on(Vt,l.getHandler(e,t,n,"handler","accept",i)),t.find("."+Yt).off(wt).on(wt,vt).off(Vt).on(Vt,l.getHandler(e,t,n,"handler","deny",i)),n.find("."+jt).off(wt).on(wt,vt).off(Vt).on(Vt,l.selectAllHandler(e,t,n,i)),n.find("."+Zt).off(wt).on(wt,vt).off(Vt).on(Vt,l.getHandler(e,t,n,"allHandler","accept",i)),n.find("."+Jt).off(wt).on(wt,vt).off(Vt).on(Vt,l.getHandler(e,t,n,"allHandler","deny",i)),n.find("."+Qt).off(wt).on(wt,vt).off(Vt).on(Vt,l.getHandler(e,t,n,"closePopupHandler",i)),Ht._subscribeHandler(String("/popup/ui/rerender/"+e.nid),l.getReRenderEventHandler(e,t,n,"nid",i)),Bt("/zmncenter/accessRequest/rerender",l.getReRenderEventHandler(e,t,n,"accessRequestID",i))}},{key:"getReRenderEventHandler",value:function(n,i,s,o){return function(e,t){n.nid===t[o]&&l.rerender(n,i,s)}}},{key:"unbindEvents",value:function(e,t,n){t.find("."+Gt).off($t),t.find("."+jt).off($t),$.e(n).find("."+jt).off($t),$.e(n).find("."+Zt).off($t),$.e(n).find("."+Jt).off($t),$.e(n).find("."+Qt).off($t),Ht._unsubscribeHandler(String("/popup/ui/rerender/"+e.nid))}},{key:"rerender",value:function(e,t,n){l.unbindEvents(e,t,n),t.clearHTML(),t.appendDOM(l.constructPopupListItems(e)),l.updatePopupUI(e,t,n),l.bindEvents(e,t,$.e(n))}},{key:"render",value:function(e){var t=$.e(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=kt.label.accept,n=[e.members,kt.common.members,kt.requestAccess.title].join(" "),i=kt.common.selectMembers,s=kt.label.deny;return zdom("div",{className:"SC_Pop SC_cent wht js-popui-container"},zdom("div",{className:"SC_pe SC_PopTop",style:Pt.top},zdom("div",{className:"SC_PU"},zdom("div",{className:"SCmb puClose"},zdom("ul",null,zdom("li",null,zdom("b",{className:"js-icon-selector","data-id":"closeIcon"},zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-close"})))))),zdom("div",{className:"SC_PUtt SC_PUtIco"},zdom("div",{className:"SC_flt"}),zdom("div",{className:"SC_frt"}),zdom("h3",{id:"isMem"},n)),zdom("div",{className:"zmReqTbl zmReqTblHdr"},zdom("div",{className:"zmReqRw "},zdom("div",{className:"zmReqIcon"},zdom("i",{className:"msi-uncheck js-select-all"})),zdom("div",{className:"zmReqCont  "},zdom("b",{id:"memSel"},i)),zdom("div",{className:"zmReqBtnGrp zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn thmBgBtn js-selectall-accept","data-val":"accept"},t),zdom("div",{className:"zmBtn smallBtn greyBgBtn js-selectall-deny","data-val":"deny"},s)))),zdom("div",{className:"SC_PUcen",style:Pt.maxHeight},zdom("div",{className:"zmReqTbl",id:"zmNotiDialogReqAccList"})))))}({members:e.nBy.length})),n=t.find("#zmNotiDialogReqAccList");n.appendDOM(l.constructPopupListItems(e)),l.bindEvents(e,n,t),$.e(document.body).appendDOM(t[0])}}]),l}(),sn=zmText.get("notificationCenter"),on=$.subscribe,an=ee.MOUSE.MOUSEUP+" "+ee.MOUSE.MOUSEDOWN+" "+ee.MOUSE.CLICK,rn=ee.MOUSE.MOUSEUP+" "+ee.MOUSE.CLICK,ln=ee.MOUSE.MOUSEDOWN,cn=function(){function a(){babelHelpers.classCallCheck(this,a)}return babelHelpers.createClass(a,null,[{key:"constructInlineListItems",value:function(e){for(var t,n=$.e(document.createDocumentFragment()),i=ct(e),s=4<i.length,o=i.length<4?i.length:4,a=0;a<o;++a)n.appendDOM(Ut(e,i[a],"inline"));if(s){var r=$.e((t=kt.common.more+"...",zdom("div",{className:"zmReqRw js-list-item js-more"},zdom("span",{className:"zmLink js-more",id:"moreAccess"},t))));n.appendDOM(r)}return n}},{key:"updateInlineUIMembersCount",value:function(e,t,n){var i=ct(e);n.find(".js-members").text(i.length+" "+sn.common.members)}},{key:"individualHandler",value:function(t,n,i,s,e){pt({groupId:(t.group||{}).id,entityId:t.eid,entityType:t.etype,actionType:e,requesterId:s},function(e){i.find('[data-id="'.concat(s,'"]')).slideUp("slow","linear",function(){ft(t,s),a.rerender(t,n,i)})},dt,[])}},{key:"getHandler",value:function(n,i,s,o){return function(e){vt(e),et(e,{closePreviewCard:!0});var t=$.e(e.target).closest(".js-list-item").data("id");a.individualHandler(n,i,s,t,o)}}},{key:"popupDialogHandler",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e){vt(e),et(e,{closePreviewCard:!0}),nn.render(t,n)}}},{key:"toggleInlineListHandler",value:function(e,t,n){return function(e){vt(e),et(e,{closePreviewCard:!0}),t.slideToggle(),n.find("i").toggleClass("msi-tarrow msi-barrow")}}},{key:"bindEvents",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},s=t.find(".js-more"),o=n.find("#multiAccept");o.off(rn).on(rn,vt).off(ln).on(ln,a.toggleInlineListHandler(e,t,o)),s.off(rn).on(rn,vt).off(ln).on(ln,a.popupDialogHandler(e)),t.find(".js-btn-accept").off(rn).on(rn,vt).off(ln).on(ln,a.getHandler(e,t,n,"accept")),t.find(".js-btn-deny").off(rn).on(rn,vt).off(ln).on(ln,a.getHandler(e,t,n,"deny")),Ht._subscribeHandler("/inline/ui/render/"+e.nid,a.getReRenderEventHandler(e,t,n,"nid")),on("/zmncenter/accessRequest/rerender",a.getReRenderEventHandler(e,t,n,"accessRequestID",i))}},{key:"getReRenderEventHandler",value:function(n,i,s,o){return function(e,t){n.nid===t[o]&&a.rerender(n,i,s)}}},{key:"unbindEvents",value:function(e,t,n){t.find(".js-more").off(an),t.find(".js-btn-accept").off(an),t.find(".js-btn-deny").off(an),Ht._unsubscribeHandler("/inline/ui/render/"+e.nid)}},{key:"rerender",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};a.unbindEvents(e,t,n);var s=ct(e);s.length?1===s.length?(e.hideAcceptButton=!1,$.e(zmNCenter.Utils.AccessRequest(e,n)).insertDOMBefore(n),n.remove()):(a.updateInlineUIMembersCount(e,t,n),t.clearHTML(),t.appendDOM(a.constructInlineListItems(e)),a.bindEvents(e,t,n)):Je(e,0,[e,n,i],ut)}},{key:"render",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};t=$.e(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=kt.requestAccess.title,n=kt.common.show,i=e.ctime,s=e.nid,o=e.timestamp,a=kt.common.openInTab,r=e.members+" "+kt.common.members;return zdom("div",{className:"zmNotiList",id:s},zdom("div",{className:"zmNotiListData"},zdom("div",{className:"zmNotiImg"},zdom("i",{className:"msi-group zmThmClr"})),zdom("div",{className:"zmNotiDtl"},zdom("div",{className:"zmNotiSub"},zdom("strong",{className:"js-members"},r),"",t),zdom("div",{className:"zmNotiBtmInfo"},zdom("div",{className:"zmNotiBtmLeft"},zdom("i",{className:"msi-status"}),zdom("span",{className:"zmnTimer","data-zmn-timer":i},o),zdom("span",{className:"zmSDot"}),zdom("i",{className:"msi-openInTab","data-id":"openInTab","data-tooltip":a})),zdom("div",{className:"zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn thmBdrBtn",id:"multiAccept"},n,zdom("i",{className:"msi-barrow"}))))),zdom("div",{className:"zmNotiAction js-close-btn"},zdom("i",{className:"msi-close","data-tooltip":close,"data-tooltip-pos":"left"}))),zdom("div",{className:"zmReqTbl",id:"zmNotiMultiAcceptDD"}))}({ctime:e.ctime,timestamp:Ee(e.ctime),members:e.nBy.length,id:e.nid})),mt(e,t,n.listInstance,n.paginate);var i=t.find("#zmNotiMultiAcceptDD");return i.css("display","none"),i.appendDOM(a.constructInlineListItems(e)),a.bindEvents(e,i,t,n),t[0]}}]),a}(),mn=zmText.get("notificationCenter"),dn={confirmationInitiated:!1,confirmAction:function(t,n,e){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},s=4<arguments.length?arguments[4]:void 0;s.stopPropagation(),et(s,{closePreviewCard:!0});var o=dn,a=$.e(s.target).closest("[data-val]").data("val");o.confirmationInitiated||(o.confirmationInitiated=!0,pt({groupId:(t.group||{}).id,entityId:t.eid,entityType:t.etype,actionType:a,requesterId:Array.isArray(t.nby)?t.nby[0]:t.nby},function(e){t.hideAcceptButton=!0,o.confirmationInitiated=!1,Je(t,0,[t,n,i],ut)},function(e){dt(e),o.confirmationInitiated=!1},[]))}},un=function(e,t){var n,i,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return t=$.e(We.getUI(e)),dn.confirmationInitiated=!1,!e.hideAcceptButton&&ct(e).length&&(i={accept:mn.label.accept,deny:mn.label.deny},n=zdom("div",{className:"zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn smallBtn thmBgBtn","data-val":"accept"},i.accept),zdom("div",{className:"zmBtn smallBtn greyBgBtn","data-val":"deny"},i.deny)),$.e(n).off("mousedown").on("mousedown",dn.confirmAction.bind(dn,e,t[0],ct(e),s)),$.e(n).off("mouseup click").on("mouseup click",function(e){return e.stopPropagation()}),t.find(".zmNotiBtmInfo").appendDOM(n),mt(e,t,s.listInstance,s.paginate)),t[0]},pn=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){};return h(e.ntype)?(t=$.e(t),1<ct(e).length?function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return cn.render(e,t,n)}(e,t,{listInstance:n,paginate:i}):un(e,t,{listInstance:n,paginate:i})):t};zmail.Core.Namespaces.create("zmNCenter.Utils").AccessRequest=pn;var fn=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).model=t.model,e.id=e.model.nid,e.from=t.from,e.listRef=t.listRef,e.$el=void 0,e.bindEvents=e.bindEvents.bind(babelHelpers.assertThisInitialized(e)),e.unbindEvents=e.unbindEvents.bind(babelHelpers.assertThisInitialized(e)),e.render=e.render.bind(babelHelpers.assertThisInitialized(e)),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"addDefaultFeatures",value:function(){var e,t,n,i,s;h(this.model.ntype)?this.$el=$.e(pn(this.model,this.$el[0],this.listRef,this.listRef.paginate)):(this.$el=$.e(it(this.model,this.$el[0])),this.$el=$.e((i=this.model,s=this.$el[0],It.init(i,$.e(s)))),this.$el=$.e((e=this.model,t=this.$el[0],n=this.from,Mt.init(e,$.e(t),n))),this.$el=$.e(lt(this.model,this.$el[0],this.listRef,this.listRef.paginate)),Ze(this.model)&&!J(this.model.ntype,this.model.etype)||(_zm.addClass(this.$el,"notiNoPreview"),_zm.addClass(this.$el,"js-noti-no-preview"),_zm.removeClass(this.$el,ae.unread)))}},{key:"bindEvents",value:function(){var t=this;return this.$el&&(this.$el.on("click",function(e){t.stopEvents(e),t.trigger("click",{event:e})}),this.$el.data("zmsData",this.model)),this}},{key:"unbindEvents",value:function(){return this.$el&&this.$el.off("click"),this}},{key:"render",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.model,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.unbindEvents(t),this.$el=$.e(We.getUI(e)),this.id=this.model.nid,this.model=e,this.addDefaultFeatures(),this.bindEvents(t),this.$el.data("zmsData",e),this.$el&&this.$el[0]}}]),n}(Nt);_.noop=_.noop||function(){};var vn,hn=".js-biz-noti",En=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=this.$listWrapper,s=i.children().length,o=n.position<=0?0:n.position||s,a=e.render(t,n);0===o?function(e){var t=this.$listWrapper,n=t.find(hn);this.$stickyDismissAll?$.e(e).insertDOMAfter(this.$stickyDismissAll):n.length?$.e(e).insertDOMAfter(n.last()):t.prependDOM(e)}.apply(this,[a,n]):$.e(a).insertDOMBefore(i.children().eq(o))},Nn=["getListItem","updateItem","bindEvents","unbindEvents","addItem","selectItem","removeItem","removeUnread","constructListItem","render","paginate","clearListAndMap","reset","emptyList","loadList","init","handleOffline","displayDismissBtn","scrollCallBack"],yn=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).$listWrapper=$.e(t.parent),e.onPagination=t.onPagination||_.noop,e.whenSelected=t.whenSelected||_.noop,e.onReselect=t.onReselect||_.noop,e.from=t.from,e.range=t.range,e.elMap={},e.lastSelectedObj=void 0,e.$dismissAllBtn=t.$dismissAllBtn,e.dismissAllVisible=!0,e.$stickyDismissAll=void 0,e.isStickyDismissVisible=!1,e.isStickyDismissEnabled=!1,e.scrollDiv=t.scrollDiv[0],_zm.autoBind(babelHelpers.assertThisInitialized(e),Nn),e.init(),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"getListItem",value:function(e){return this.elMap[e.nid]}},{key:"updateItem",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=this.getListItem(e);return n&&(t.action=t.action||"render",En.apply(this,[n,e,t])),this}},{key:"bindEvents",value:function(e){var t=this;return e.on("click",function(){return t.selectItem(e)}),this}},{key:"unbindEvents",value:function(e){return e.off("click"),this}},{key:"addItem",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};t&&t.find(".SC_nmsg").remove();var i=this.getListItem(e);i?(n.position=e.isWms?0:i.$el.index(),i.$el.remove()):n.position=0;var s=this.constructListItem(e,n);return s&&(En.apply(this,[s,e,n]),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;e.isWms&&e.unread&&$.e(t.$el).addClass(ae.UNREAD)}.apply(this,[e,s]),this.displayDismissBtn()),this}},{key:"selectItem",value:function(e,t){t&&"function"==typeof t.stopPropagation&&t.stopPropagation();var n,i,s,o,a=e.$el,r=e.model;return i=r,(n=a).hasClass(ae.UNREAD)&&(n.removeClass(ae.UNREAD),i.unread=!1),Ze(r)&&!J(r.ntype,r.etype)&&(gt(a[0].parentNode),s=a,o=ae.LIST.KEYBOARD_SELECTION_CLASS,$.e(s[0].parentNode).find("."+o).removeClass(o),$.e(s).addClass(o),a.addClass(yt),this.lastSelectedObj&&this.lastSelectedObj.nid===r.nid?this.onReselect(e,r):(this.lastSelectedObj=r,this.whenSelected(e,r))),this}},{key:"removeItem",value:function(e){var t,n=this.getListItem(e);if(n){var i=n.$el;(function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).id;e&&void 0!==this.elMap[e]&&delete this.elMap[e]}).apply(this,[n]),i.slideUp("slow","linear",function(){setTimeout(function(){return i.remove()},300)})}return this.displayDismissBtn(),t=e,V.remove(t),this}},{key:"removeUnread",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.getListItem(e);return $.e(t).find("."+ae.UNREAD).removeClass(ae.UNREAD),this}},{key:"constructListItem",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!Ye(e))return!1;var n=new fn({model:e,from:this.from,listRef:this}),i=e.nid;return(this.elMap[i]=n).render(e,t),n.$el[0].id=i,this.bindEvents(n,e),n}},{key:"render",value:function(e){var n=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e.length&&!(zmNCenter.bizNotification.data()||[]).length)return this.emptyList();var s=$.e(document.createDocumentFragment());return e.forEach(function(e){e.isMail="4"===e.ntype,e.isDeleted="34"===e.ntype;var t=n.getListItem(e);t||(t=n.constructListItem(e,i).$el)&&s.appendDOM(t),n.removeUnread(e)}),this.$listWrapper.appendDOM(s),this.displayDismissBtn(),s}},{key:"paginate",value:function(){return V.hasNext()&&(this.loadList(),_.isFunction(this.onPagination)&&this.onPagination()),this}},{key:"clearListAndMap",value:function(){return this.$listWrapper.clearHTML(),this.elMap={},this}},{key:"reset",value:function(){return this.clearListAndMap(),this.timer&&this.timer.stop(),this}},{key:"emptyList",value:function(){var e=this,t=function(){e.$dismissAllBtn&&e.dismissAllVisible&&(e.dismissAllVisible=!1,e.$dismissAllBtn.css("display","none")),e.$stickyDismissAll&&e.isStickyDismissVisible&&(e.isStickyDismissVisible=!1,e.$stickyDismissAll.css("display","none"))},n=this.$listWrapper.find(".js-noti-list-item"),i=this.$listWrapper.find(hn);return n.length?this.$stickyDismissAll&&i.length===n.length-1?t():this.displayDismissBtn():(this.clearListAndMap(),this.$listWrapper.appendDOM(zdom("div",{className:"zmInfoWarnMsg"},ht.common.noNotifications)),$.q(".zmNotiSall").hide(),t()),this}},{key:"loadList",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return n&&(e=R(this.$listWrapper[0])),zmail.ContactBook.fetchProcess.then(function(){n&&e(),V.getData({callback:t.render,listInstance:t,initialLoad:n})}),this}},{key:"scrollCallBack",value:function(){_.throttle(this.displayDismissBtn,100)()}},{key:"displayDismissBtn",value:function(){var e=this.$listWrapper.find(".js-noti-list-item");this.isStickyDismissEnabled?e.length?!function(e){var t=(e=$.e(e)[0]).getBoundingClientRect(),n=t.top,i=t.height;e=e.parentNode;do{if(!e)return!1;if(n<=(t=e.getBoundingClientRect()).bottom==0)return!1;if(n+i<=t.top)return!1;e=e.parentNode}while(e!==document.body);return n<=document.documentElement.clientHeight}(this.$stickyDismissAll[0])?this.dismissAllVisible||(this.dismissAllVisible=!0,this.$dismissAllBtn.css("display","")):(this.isStickyDismissVisible||(this.isStickyDismissVisible=!0,this.$stickyDismissAll.css("display","")),this.dismissAllVisible&&(this.dismissAllVisible=!1,this.$dismissAllBtn.css("display","none"))):this.isStickyDismissVisible&&(this.isStickyDismissVisible=!1,this.$stickyDismissAll.css("display","none")):this.$dismissAllBtn&&(e.length&&!this.dismissAllVisible?(this.dismissAllVisible=!0,this.$dismissAllBtn.css("display","")):this.dismissAllVisible&&!e.length&&(this.dismissAllVisible=!1,this.$dismissAllBtn.css("display","none")))}},{key:"init",value:function(){return this.reset(),ZMStore.isOffline()?this.handleOffline():(this.timer=zmUtil.TimerUtils.createTimerComponent({$container:this.$listWrapper}),this.timer.start(),zmNCenter.bizNotification.render(this.$listWrapper,{from:this.from}),this.handleDismissAll(),this.loadList(!0),function(t,n,i){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){},e=function(e){return function(e,t,n){(3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){})(),e.offsetHeight+e.scrollTop>=e.scrollHeight-50&&t(n)}(n,i,t,s)};$.e(n).off("scroll",e).on("scroll",e)}(this,this.scrollDiv,this.paginate,this.scrollCallBack)),this}},{key:"clearLastSelectedItem",value:function(){return this.lastSelectedObj=void 0,this}},{key:"removeCurrentSelection",value:function(){return gt(this.$listWrapper),this}},{key:"handleOffline",value:function(){return this.clearListAndMap(),V.resetCache(),this.$listWrapper[0].appendChild(zdom("div",{className:"zmInfoWarnMsg"},be.common.offline)),this}},{key:"handleDismissAll",value:function(){var e=$.e(this.$listWrapper).find(hn);e.length&&(this.$stickyDismissAll=$.e(zdom("div",{className:"zmNotiList zmNotiDismissAll js-list-dismissall-item"},zdom("div",{className:"zmAMB"},zdom("ul",{className:"zmAMG",style:Oe.MARGIN},zdom("li",{className:"zmAMItem zmAMTextItem zmThmClr js-dismissall"},zdom("div",{className:"zmAMWra"},zdom("span",{className:"zmAMText"},be.common.dismissAll))))))),this.isStickyDismissVisible=!0,this.isStickyDismissEnabled=!0,$.e(this.$stickyDismissAll).insertDOMAfter(e.last()),this.$stickyDismissAll.off("mousedown mouseup click").on("mouseup click",function(e){return e.stopPropagation()}).on("mousedown",function(e){e.stopPropagation(),$.e(e.target).closest(".js-dismissall").length?ne.dismissAllNotifications():$.q(".zmNotiHeader").trigger("mousedown")}))}}]),n}(Nt),gn=Object.freeze({ESC:27,BACKSPACE:8,DELETE:46,UP_ARROW:38,DOWN_ARROW:40}),bn=ae.LIST.NAV_CLASS,On=ae.LIST.KEYBOARD_SELECTION_CLASS,Cn={time:0},Tn=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"addClass",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};t.length&&t[0].click(),e&&e.length&&(e.addClass(On).addClass(n.navClass||bn),e[0].click(),zmUtil.scrollIntoView(e[0],Cn))}},{key:"removeClass",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e.removeClass(On),e.removeClass(t.navClass||bn)}},{key:"getCurrentElement",value:function(){return this.$el.find("."+On).eq(0)}},{key:"getDefaultShortcuts",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return(zmshCut.default||[]).slice().filter(function(e){return t.indexOf(e.keyStr)<0})}}]),e}(),In=function(){return!0},An={time:500},Sn=ae.LIST.KEYBOARD_SELECTION_CLASS,_n=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,t),babelHelpers.defineProperty(this,"backspaceKeyHandler",function(e,t,n){n&&n.stopPropagation&&n.stopPropagation();var i="mac"===(_zm.getOSType()||"").trim().toLowerCase();if(this.onDeleteKeyPress()&&i){var s=this.$el.find("."+Sn).eq(0);if(s.length){s.addClass(Sn).addClass(this.navClass),zmUtil.scrollIntoView(s[0],An);var o=s.find(".js-close-btn").eq(0);o.length&&o.trigger("mousedown")}}}),this.$el=$.e(e.$el),this.scopeName=e.scopeName,this.selClass=e.selClass,this.navClass=e.navClass,this.allowDefaultShortcutScope=e.allowDefaultShortcutScope||!1,this.type=e.type||"scope",this.groupName=e.groupName||"",this.onUpKeyPress=e.onUpKeyPress||In,this.onDownKeyPress=e.onDownKeyPress||In,this.onEscKeyPress=e.onEscKeyPress||In,this.onDeleteKeyPress=e.onDeleteKeyPress||In,this.onBackspaceKeyPress=e.onBackspaceKeyPress||In,this.upArrowKeyHandler=_.debounce(this.upArrowKeyHandler.bind(this),300,!0),this.downArrowKeyHandler=_.debounce(this.downArrowKeyHandler.bind(this),300,!0),this.backspaceKeyHandler=this.backspaceKeyHandler.bind(this),this.deleteKeyHandler=this.deleteKeyHandler.bind(this),this.escKeyHandler=this.escKeyHandler.bind(this),this.keyHandler=this.keyHandler.bind(this),this.bindEvents=this.bindEvents.bind(this),this.unbindEvents=this.unbindEvents.bind(this),this.getShortcuts=this.getShortcuts.bind(this),this.rebindEvents=this.rebindEvents.bind(this)}return babelHelpers.createClass(t,[{key:"upArrowKeyHandler",value:function(e,t,n){if(this.onUpKeyPress()){var i=this.$el.children(),s=Tn.getCurrentElement.apply(this),o=i.first().is(s)||!s.length?i.first():s.prev();Tn.addClass.apply(this,[o,s]),s.is(o)||Tn.removeClass.apply(this,[s,o])}return this}},{key:"downArrowKeyHandler",value:function(e,t,n){if(this.onDownKeyPress()){var i,s=this.$el.children(),o=Tn.getCurrentElement.apply(this);i=s.last().is(o)?s.last():o.length?o.next():s.first(),Tn.addClass.apply(this,[i,o]),o.is(i)||Tn.removeClass.apply(this,[o,i])}return this}},{key:"deleteKeyHandler",value:function(e,t,n){if(n&&n.stopPropagation&&n.stopPropagation(),this.onDeleteKeyPress()){var i=this.$el.find("."+Sn).eq(0);if(i.length){i.addClass(Sn).addClass(this.navClass),zmUtil.scrollIntoView(i[0],An);var s=i.find(".js-close-btn").eq(0);s.length&&s.trigger("mousedown")}}}},{key:"escKeyHandler",value:function(e,t,n){if(n&&n.stopPropagation&&n.stopPropagation(),this.onEscKeyPress()){var i=Tn.getCurrentElement.apply(this);Tn.removeClass.apply(this,[i,{navClass:this.navClass}])}return this}},{key:"keyHandler",value:function(e){if(e)switch(e.keyCode){case gn.ESC:this.escKeyHandler(void 0,void 0,e);break;case gn.UP_ARROW:e.stopPropagation(),this.upArrowKeyHandler(void 0,void 0,e);break;case gn.DOWN_ARROW:e.stopPropagation(),this.downArrowKeyHandler(void 0,void 0,e);break;case gn.DELETE:e.stopPropagation(),this.deleteKeyHandler(void 0,void 0,e);break;case gn.BACKSPACE:e.stopPropagation(),this.backspaceKeyHandler(void 0,void 0,e)}return this}},{key:"rebindEvents",value:function(){if("scope"===this.type){var e=zmComponent.keybindings.getScope();this.prevScope=e!==this.scopeName&&e!==i.WORKSPACE_NAME?e:this.prevScope,this.prevScope=this.prevScope===this.scopeName?"default":this.prevScope,zmComponent.keybindings.setScope(this.scopeName)}return this}},{key:"getShortcuts",value:function(){return(Tn.getDefaultShortcuts(["upArrow","downArrow","esc","backspace","delete"])||[]).concat([{scope:this.scopeName,uid:"notificationUpArrowHandler",keyStr:"upArrow",group:this.groupName,actions:[this.upArrowKeyHandler],preventDefault:!0},{scope:this.scopeName,uid:"notificationDownArrowHandler",keyStr:"downArrow",group:this.groupName,actions:[this.downArrowKeyHandler],preventDefault:!0},{scope:this.scopeName,uid:"notificationEscHandler",keyStr:"esc",group:this.groupName,actions:[this.escKeyHandler],preventDefault:!0},{scope:this.scopeName,uid:"notificationDelHandler",keyStr:"delete",actions:[this.deleteKeyHandler],preventDefault:!0},{scope:this.scopeName,uid:"notificationBackspaceHandler",keyStr:"backspace",actions:[this.backspaceKeyHandler],preventDefault:!0}])}},{key:"bindEvents",value:function(){return"scope"===this.type?(this.prevScope=zmComponent.keybindings.getScope(),this.isScopeAlreadyRegistered||(zmComponent.keybindings.registerAll({scope:this.scopeName,allowDefaultScope:this.allowDefaultShortcutScope,shortcuts:this.getShortcuts()}),this.isScopeAlreadyRegistered=!0),zmComponent.keybindings.setScope(this.scopeName)):$.e(document.body).off("keydown",this.keyHandler).on("keydown",this.keyHandler),this}},{key:"unbindEvents",value:function(){return"scope"===this.type?(this.prevScope=this.prevScope||"default",zmComponent.keybindings.setScope(this.prevScope),zmComponent.keybindings.dropScope(this.scopeName)):$.e(document.body).off("keydown",this.keyHandler),this}}]),t}(),zn=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"setConfig",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new _n(e)}},{key:"bind",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new _n(e).bindEvents()}},{key:"unbind",value:function(e){e instanceof _n&&e.unbindEvents()}}]),e}(),Rn=$.publish,Dn=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"create",value:function(){var e;vn&&t.destroy(),vn=$.e((e=n.POPOUT_ELEMENT_ID,zdom("div",{id:e,className:"zmNotiPopUp zmShowO"}))),$.q("div[data-id='zm-notifications-popover']").appendDOM(vn)}},{key:"preview",value:function(e){me({data:e,previewElm:vn[0],fixedComment:!0})}},{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.create(),t.preview(e.data)}},{key:"destroy",value:function(){vn&&(Rn(ee.CLOSE_POPOUT_PREVIEW,[{element:vn[0],from:"popout"}]),t.unbindEvents(),vn.remove(),vn=void 0)}},{key:"stopEvents",value:function(e){Rn(ee.STOP_EVENTS),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation()}},{key:"bindEvents",value:function(){vn.on("mousedown mouseup",t.stopEvents)}},{key:"unbindEvents",value:function(){vn.off("mousedown mouseup")}}]),t}();_.noop=_.noop||function(){};var Mn,kn,Pn,Hn,Un,Ln=zmNCenter.counter,Bn=$.subscribe,$n=$.unsubscribe,wn=!1,Vn=!1,Kn=function(){zmNCenter.counter.reset(!0),kn&&kn.handleOffline()},xn=function(e,t){Dn.init({fromElement:Mn[0],data:t}),Vn=!0,Pn=t},Wn=function(){kn&&($n(ee.NEW_NOTIFICATION.POPOUT,kn.addItem),kn.reset(),Hn&&zn.unbind(Hn))},jn=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};wn&&t.isWms&&zmail.windowVisibility&&Ln.reset(),kn.addItem(t)},Fn=function(e,t){kn.removeItem(t)},Gn=function(e,t){kn.removeUnread(t)},qn=function(e,t){kn.updateItem(t,{action:"replace"})},Yn=function(){if(!($.q("#wms-imgpreviewcontainer").length&&WMSKeyHandler&&WMSKeyHandler.handle))return Vn&&($.q("#"+n.POPOUT_ELEMENT_ID).length&&(Dn.destroy(),Vn=!1),kn.clearLastSelectedItem().removeCurrentSelection(),Pn={}),!0;WMSKeyHandler.handle()},Zn=function(){return wn},Jn=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(Vn&&Pn.nid===t.nid||t.closePreviewCard)&&Yn()},Qn=function(){$n(ee.NEW_NOTIFICATION.POPOUT),$n(ee.REMOVE_NOTIFICATION.POPOUT),$n(ee.REMOVE_UNREAD.POPOUT),$n(ee.REMOVE_PREVIEW.POPOUT),$n(ee.DELETE_COMMENT.POPOUT),Bn(ee.NEW_NOTIFICATION.POPOUT,jn),Bn(ee.REMOVE_NOTIFICATION.POPOUT,Fn),Bn(ee.REMOVE_UNREAD.POPOUT,Gn),Bn(ee.REMOVE_PREVIEW.POPOUT,Jn),Bn(ee.DELETE_COMMENT.POPOUT,qn)},Xn=function(){kn=new yn({parent:Mn,from:"popout",onReselect:Yn,whenSelected:xn,onPagination:_.noop,$dismissAllBtn:Un,scrollDiv:Mn}),Hn=zn.bind({scopeName:"notification-popout",$el:kn.$listWrapper[0],navClass:ae.LIST.SELECTION,selClass:ae.LIST.SELECTION,allowDefaultShortcutScope:!1,onEscKeyPress:function(){return $.publish(ee.POPOUT_CLOSE,{keyboard:!0}),!0}}),Qn()},ei=function(e){e.stopPropagation(),wn||(wn=!0,zmNCenter.counter.reset(),Xn())},ti=function(){wn&&(wn=!1,Wn())};zmNCenter.isPopoutOpen=Zn;var ni,ii,si,oi,ai,ri=zmNCenter.counter,li={},ci=$.publish,mi=$.subscribe,di=$.unsubscribe,ui=zmText.get("notificationCenter"),pi=function(){si&&si.handleOffline()},fi=function(){si.removeCurrentSelection()},vi=function(){return si&&si.$listWrapper&&zmsuite.getAppObj(i.WORKSPACE_NAME)},hi=function(){vi()&&zmail.windowVisibility&&ri.reset()},Ei=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};si.addItem(t)},Ni=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};si.removeItem(t)},yi=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};si.removeUnread(t)},gi=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};si.updateItem(t,{action:"replace"})},bi=function(){$.q("#wms-imgpreviewcontainer").length&&WMSKeyHandler&&WMSKeyHandler.handle?WMSKeyHandler.handle():ii&&(ci(ee.CLOSE_POPOUT_PREVIEW,[{element:ii.$el[0],from:"tab"}]),ii.close(),li={},si.lastSelectedObj={},fi())},Oi=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};$.isEmptyObject(li)||t.nid!==li.nid&&!t.closePreviewCard||bi()},Ci=function(){di(ee.NEW_NOTIFICATION.TAB,Ei),di(ee.REMOVE_NOTIFICATION.TAB,Ni),di(ee.REMOVE_UNREAD.TAB,yi),di(ee.REMOVE_PREVIEW.TAB,Oi),di(ee.DELETE_COMMENT.TAB,gi)},Ti=function(){ni=zn.setConfig({scopeName:i.WORKSPACE_NAME,selClass:ae.LIST.SELECTION,navClass:ae.LIST.SELECTION,allowDefaultShortcutScope:!1,onEscKeyPress:function(){return function(){if(zmNCenter.States.isPickerVisible)ci(ee.PICKER_CLOSE_EVENT)}(),bi(),!0},onBackspaceKeyPress:function(){return"mac"===(_zm.getOSType()||"").trim().toLowerCase()}})},Ii=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};li=n,ii.getNodes()[0].headerArr.text=[],ii.show(),t=ii.getNodes()[1].getDOMNode()[0],$.publish(ee.CLOSE_POPOUT_PREVIEW,[{element:t,from:"tab"}]),me({data:n,previewElm:t,fixedComment:!1,openType:"preview"})},Ai=function(e,t,n){t===i.WORKSPACE_NAME&&ri.reset()},Si=function(){si=new yn({parent:oi,from:"tab",$dismissAllBtn:ai&&ai.$el,onReselect:bi,whenSelected:Ii,range:15,scrollDiv:oi.parent()}),ni.$el=si.$listWrapper,Ci(),mi(ee.NEW_NOTIFICATION.TAB,Ei),mi(ee.REMOVE_NOTIFICATION.TAB,Ni),mi(ee.REMOVE_UNREAD.TAB,yi),mi(ee.REMOVE_PREVIEW.TAB,Oi),mi(ee.DELETE_COMMENT.TAB,gi)},_i=function(){var e=ue({name:i.WORKSPACE_NAME,iconSet:ai,dismissAllHandler:function(){ne.dismissAllNotifications()},appConfig:{appname:ui.common.title,isNewHeader:!0,isNewPreview:!1,appId:i.WORKSPACE_NAME,data:{CNodes:"3"},appIcon:ae.TAB_ICON,hashKey:"notifications",hashChangeHandler:function(e,t){zmUtil.debugLog("Notifications hash-url changed",t,this)},onDelete:function(e){var t=ii.getNodes()[1].getDOMNode()[0];return $.publish(ee.CLOSE_POPOUT_PREVIEW,[{element:t,from:"tab"}]),!0},shortcuts:ni.getShortcuts(),allowDefaultShortcutScope:!1},destroy:function(){ii&&ii.close(),si&&si.reset(),Ci(),li={},ni&&zn.unbind(ni),ni=void 0,di(ee.WORKSPACE_POST_SWITCH,Ai)},listingClick:function(){},closePreview:function(e){$.publish(ee.CLOSE_POPOUT_PREVIEW,[{element:e.$el[0],from:"tab"}]),li={},si.lastSelectedObj={},e.close(),fi()}});oi=$.q(e.listArea),ii=e.previewCard,ai=e.iconSet,Si(),ri.reset(),$.unsubscribe(ee.OFFLINE,pi),$.subscribe(ee.OFFLINE,pi),$.unsubscribe(ee.ONLINE,hi),$.subscribe(ee.ONLINE,hi)},zi=function(){mi("/zmncenter/tab/removeSelection",fi),Ti(),_i(),mi(ee.WORKSPACE_POST_SWITCH,Ai)};zmNCenter.tab=zi,zmNCenter.isTabOpen=vi,zmNCenter.getCurrentTabPreview=function(){return li},zmNCenter.removeSelectionInTab=fi;var Ri,Di,Mi,ki,Pi,Hi,Ui,Li,Bi,$i,wi=function(){zmNCenter.counter.init(),V.resetCache();var e=si;void 0!==e&&vi()&&e.init();var t=kn;void 0!==t&&Zn()&&t.init()},Vi=(Ri=function(e){N(e.ntype)&&(M(e),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.eid+"_"+o.ACCESS_REQUEST[0];e.accessRequestID=t;var n=V.getEntity(t);if(n){var i=Object.keys(e.members||{})||[];n.nby=Array.isArray(n.nby)?n.nby:n.nby.split(","),n.nBy=n.nBy||[],n.nby=n.nby.filter(function(e){return i.indexOf(e)<0}),n.nBy=n.nBy.filter(function(e){return i.indexOf(e.zuid)<0})}}(e),$.publish("/zmncenter/accessRequest/rerender",e))},function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!g(e.ntype)){var t=e.refList&&e.refList.split(",")||[];if(Ri(e),m(e.ntype))!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};V.hasNid(e.nid)&&zmNCenter.counter.decrement(),$.publish(ee.REMOVE_NOTIFICATION.TAB,e),$.publish(ee.REMOVE_NOTIFICATION.POPOUT,e)}(e);else if(O(e.ntype))wi();else if(f(e.ntype))!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.eid&&!Array.isArray(e.eid)&&(e.eid=qe(e.eid));var t=e.eid||[],n={};for(var i in t.forEach(function(e){var t=V.getObjectsOfEid(e);$.extend(n,t)}),n)if(n.hasOwnProperty(i)){var s=n[i];Ge(ee.REMOVE_NOTIFICATION.TAB,s),Ge(ee.REMOVE_NOTIFICATION.POPOUT,s),Qe(0,s)}}(e);else if(v(e.ntype))tt(e);else if(c(e.ntype))zmNCenter.counter.reset(!0);else if(p(e.ntype))!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};M(e);var t=e.nIdKeys||[];Array.isArray(t)&&t.forEach(function(e){var t=V.update(e,{unread:!1});Ge(ee.REMOVE_UNREAD.TAB,t),Ge(ee.REMOVE_UNREAD.POPOUT,t)})}(e);else if(-1<t.indexOf(zmail.zuid))return Zn()||si&&si.$listWrapper&&zmTab.currentTab===i.WORKSPACE_NAME||zmNCenter.counter.increment(1),!0}return!1}),Ki=function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).data||{};Vi(t)&&(zmNCenter.wmsData.push(t),M(t),t.isWms=t.isWms||!0,t.unread=t.unread||!0,t=V.put(t),je.show(t),$.publish(ee.NEW_NOTIFICATION.TAB,t),$.publish(ee.NEW_NOTIFICATION.POPOUT,t))},xi=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"onReconnect",value:function(){wi()}},{key:"subscribe",value:function(){$.subscribe(ee.RECONNECT,e.onReconnect),zmComponent.notifier.addHandler("streams",Ki)}}]),e}(),Wi=$.e(document.body),ji=$.publish,Fi=$.subscribe,Gi=zmText.get("notificationCenter"),qi=function(){var e,t=$.e(zdom("div",{"data-id":"zm-notifications-popover",className:"zmNotiFlyout zmHideD"})),n=$.e(zdom("div",{className:"zmNotiHeader"})),i=$.e(zdom("strong",{"data-id":"zm-notification-txt"},K.common.title)),s=$.e((e="zm-notification-list",zdom("div",{className:"zmNotiListWra inFlyout js-popout",id:e,"data-id":e})));return(Di=zmIconConstructor.createIcon({iconList:[{id:"popout_noti_dismissall",type:"text",haveSeparator:!1,haveThemeColor:!0,additionalWrapperClass:"js-noti-dismissall",text:Gi.common.dismissAll,callback:Mi,tooltip:Gi.common.dismissAll},{id:"popout_noti_tabopen",type:"icon",haveSeperator:!1,tooltip:Gi.common.seeAll,iconClass:"msi-popout",callback:ki}]}))&&Di.$el&&(n.prependDOM(i).appendDOM(Di.$el),t.appendDOM(n).appendDOM(s)),t},Yi=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=zmUtil||{};"function"!=typeof t.hideMenu||e.disableHideMenu||t.hideMenu(!0)},Zi=function(){Li.addClass("sel")},Ji=function(){Li.removeClass("sel")},Qi=function(){Ui.addClass("zmHideD")},Xi=function(){Ui.removeClass("zmHideD")},es=zmNCenter.closeNotification=(Bi=function(){return ji(ee.REMOVE_PREVIEW.POPOUT,{closePreviewCard:!0})},$i=function(e,t){return s=e,(o=$.e(s.target)).closest(".zmNotiPopUp").length||!o.closest(".zmNotiHeader").length&&o.closest(Ui).length||$.q("#wms-imgpreviewcontainer").length||o.closest(".zcal_cn").length||o.closest("#wmstoolbar").length||function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(zmNCenter.States.isPickerVisible)return ji(ee.PICKER_CLOSE_EVENT),"keydown"===e.type||t.keyboard}(e,t)||function(e){if(Ui.find(".zmNotiPopUp").eq(0).length)return"keydown"===e.type}(e)||(n=e,(i=$.e(n.target).closest(".zmNotiHeader").length)&&Bi(),i);var n,i,s,o},function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e&&$i(e,t)||(Yi(t),Qi(),Ji(),Bi(),ji(ee.TOPBAR_CLOSE_EVENT),ji(ee.PICKER_CLOSE_EVENT),Wi.off("keydown",Pi),Wi.off("mousedown",es),$.unsubscribe(ee.EDITORCLICK,Hi))});Pi=function(e){e&&27===e.which&&es(e)},Hi=function(){es()};var ts=zmNCenter.openNotification=function(e){e&&e.stopPropagation(),Ui.hasClass("zmHideD")?(Yi(),ji("mailsuite/searchClose"),Xi(),Zi(),zmsuite.$el.notificationContainer=Ui,ji(ee.TOPBAR_OPEN_EVENT),$.publish("zmncenter/biz/freeOrgOfferSeen"),$.publish("zmncenter/biz/offerSeen"),Wi.off("keydown",Pi).on("keydown",Pi),Wi.off("mousedown",es).on("mousedown",es),$.unsubscribe(ee.EDITORCLICK,Hi),$.subscribe(ee.EDITORCLICK,Hi)):es()};ki=function(){es(),zi()},Mi=function(){ne.dismissAllNotifications()};var ns=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"bindEvents",value:function(){Li.off("mousedown",ts).on("mousedown",ts),Fi(ee.OPEN_NOTIFICATION,ts),Fi(ee.ONLINE,xi.onReconnect),Fi(ee.POPOUT_CLOSE,es),Fi(ee.CLOSE_POPOUT_PREVIEW_FROM_STREAMS,es),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};$n(ee.TOPBAR_OPEN_EVENT,ei),$n(ee.TOPBAR_CLOSE_EVENT,ti),Bn(ee.TOPBAR_OPEN_EVENT,ei),Bn(ee.TOPBAR_CLOSE_EVENT,ti),Bn(ee.OFFLINE,Kn),Mn=$.q("#"+n.POPOUT_ID),Un=e.$dismissAllBtn}({$dismissAllBtn:Di&&Di.$el.find(".js-noti-dismissall").eq(0)})}},{key:"initializeElements",value:function(){(Li=Li||$.q("#topBar .zmNotiIW")).attr("data-tooltip",Gi.common.title),Li.attr("data-sh-main-txt",Gi.common.title),Ui=Ui||qi(),zmsuite.outerWrapper.has(Ui).length||zmsuite.outerWrapper.appendDOM(Ui),Ui.find('[data-id="zm-notification-txt"]').text(Gi.common.title)}},{key:"startTabComponent",value:function(){zi()}}]),e}(),is=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"init",value:function(){ns.initializeElements(),ns.bindEvents(),xi.subscribe(),xi.onReconnect()}},{key:"tab",value:function(){ns.startTabComponent()}}]),e}(),ss={openInTab:de},os=zmail.Core.Namespaces.create("zmNCenter");os.Main=is,os.Datastore=V,os.wmsData=os.wmsData||[],os.features=ss}(),window.__rollupModule=void 0;