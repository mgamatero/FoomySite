"use strict";!function(){var i=["ht","tp"].join(""),a=/^on/,r={viewBox:!0},s={svg:!0,g:!0,path:!0,rect:!0,defs:!0,lineargradient:!0,stop:!0},l={fragment:!0},n=[],p=function(t,o,a){var i=!1;return n.forEach(function(e){var n=e(t,o,a);i=i||n}),i},u=function(e,n){var t;if(n)for(var o in n)if("ref"===o&&"function"==typeof n[o])n[o](e);else if(t=o,a.test(t))"string"!=typeof n[o]&&e.addEventListener(o.slice(2).toLowerCase(),n[o]);else if("style"===o&&"object"===babelHelpers.typeof(n[o]))Object.assign(e.style,n[o]);else if("className"===o)e.setAttribute("class",n[o]);else{if(p(o,e,n))continue;void 0!==n[o]&&(r[o]&&s[e.type.toLowerCase()]?e.setAttributeNS("",o,n[o]):e.setAttribute(o,n[o]))}};function m(e,n){for(var t=arguments.length,o=new Array(2<t?t-2:0),a=2;a<t;a++)o[a-2]=arguments[a];return function t(e){var o;if(!e)return document.createComment("");if("string"==typeof e)return document.createTextNode(e);if("number"==typeof e)return document.createTextNode(String(e));if(e instanceof Node)return e;var n=(e.type||"").trim().toLowerCase();return s[n]?(n=(e.type||"").trim(),o=document.createElementNS("".concat(i,"://www.w3.org/2000/svg"),n),"svg"===n&&o.setAttributeNS("".concat(i,"://www.w3.org/2000/xmlns/"),"xmlns:xlink","".concat(i,"://www.w3.org/1999/xlink")),e.props&&u(o,e.props)):l[n]?o=document.createDocumentFragment():n&&(o=document.createElement(n),e.props&&u(o,e.props)),(e.children||[]).reduce(function(e,n){return e.concat(n)},[]).forEach(function(e){if(void 0!==e){var n=t(e);void 0!==n&&o.appendChild(n)}}),o}({type:e,props:n,children:o})}!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;"function"==typeof e&&n.push(e)}(function(e,n,t){return"dangerouslySetInnerHTML"===e&&(n.innerHTML=t[e],!0)});var o={MOUNT:"mount",UNMOUNT:"unmount",BEFORE_UNMOUNT:"beforeUnmount",COPY_EMAIL:"copyEmail",WMS_CHAT_ACTION:"wmsChatAction",ZP_ACTION:"zpAction"},c=zmText.get("contact-card-component").contactCard,e=zmResource.get("image","SC-Photo.png"),v=function(e,n,t){return zmail.Utils.DOM.getRefs(e,n,t)},C=function(){return zmail.isPeopleIntegEnabled&&!1!==zmail.isPeopleUser},g=function(e){var n,t=e.email,o=e.userID;return C()?(zmail.peopleInteg=zmail.peopleInteg||{},zmail.peopleInteg.aliasZuid=zmail.peopleInteg.aliasZuid||{},zmail.peopleInteg.peopleData=zmail.peopleInteg.peopleData||{},o=zmail.peopleInteg.aliasZuid[t]||o,(n=zmail.peopleInteg.peopleData[o])?{zpDesignation:n.designation,zpTeam:n.deptname,zpTeamID:n.deptid,zpName:n.employeeDisplayName,zpID:n.erecno,zpExtensionNumber:n.extn,zpMobileNumber:n.mobile}:null):null},z={},t=function(e){var n=window.open(e,"_blank");return n.opener=null,n},b=function(){function n(){babelHelpers.classCallCheck(this,n);var e=this;e._props=null,e.anchor=null,e.container=null,e._mounted=!1,e._visible=!1,e.showTooltip=!1}return babelHelpers.createClass(n,[{key:"init",value:function(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this;t.anchor=n.anchor,t.container=n.container||document.body,t._props=(e=Object.assign(t.getDefaultProps(),n.props),new Backbone.Model(e)),t.showTooltip=n.showTooltip||!1,t.onBeforePosition=n.onBeforePosition,$.events(t),t.onPropsChangedEvent=t.onPropsChangedEvent.bind(t),t.onComponentMountEvent=t.onComponentMountEvent.bind(t),t.onComponentUnmountEvent=t.onComponentUnmountEvent.bind(t),t.onBeforeComponentUnmountEvent=t.onBeforeComponentUnmountEvent.bind(t),t.onCopyEmailButtonClickEvent=t.onCopyEmailButtonClickEvent.bind(t),t.onWMSChatActionClickEvent=t.onWMSChatActionClickEvent.bind(t),t.onWMSAudioCallActionClickEvent=t.onWMSAudioCallActionClickEvent.bind(t),t.onWMSVideoCallActionClickEvent=t.onWMSVideoCallActionClickEvent.bind(t),t.onZpTeamClickEvent=t.onZpTeamClickEvent.bind(this),t.onZpNameClickEvent=t.onZpNameClickEvent.bind(this),t.onZpMobileNumberClickEvent=t.onZpMobileNumberClickEvent.bind(this),t.onComponentWrapperClickEvent=t.onComponentWrapperClickEvent.bind(t),t.onComponentWrapperMouseDownEvent=t.onComponentWrapperMouseDownEvent.bind(t),t.onComponentWrapperMouseUpEvent=t.onComponentWrapperMouseUpEvent.bind(t),t._props.on("change",t.onPropsChangedEvent),$.events(t).on(o.MOUNT,t.onComponentMountEvent),$.events(t).on(o.UNMOUNT,t.onComponentUnmountEvent),$.events(t).on(o.BEFORE_UNMOUNT,t.onBeforeComponentUnmountEvent)}},{key:"destroy",value:function(){var e=this;e.unmount(),$.events(e).off(o.BEFORE_UNMOUNT,e.onBeforeComponentUnmountEvent),$.events(e).off(o.MOUNT,e.onComponentMountEvent),$.events(e).off(o.UNMOUNT,e.onComponentUnmountEvent),e._props.off("change",e.onPropsChangedEvent),$.events(e).off(),e.showTooltip=!1,e.anchor=null,e._props=null,e.container=null}},{key:"setProps",value:function(){return this._props.set.apply(this._props,arguments)}},{key:"getDefaultProps",value:function(){return{name:"",email:"",photo:e,wmsEnabled:!0,zpEnabled:!0}}},{key:"resetProps",value:function(){this._props.clear({silent:!0}),this._props.set(this.getDefaultProps(),{silent:!0}),this.update()}},{key:"fireEvent",value:function(e,n){$.events(this).triggerHandler(e,n)}},{key:"renderZPStatusBadge",value:function(){var e=this.props,n=null;if(e.zpEnabled&&e.hasOwnProperty("zpAvailableStatus")){var t=["zmCIioStatus"];t.push({in:"zmCIioSIn",out:"zmCIioSOut",break:"zmCIioSBreak"}[e.zpAvailableStatus]),n=m("span",{ref:"zpStatusBadge",className:t=t.join(" ")},c.labels.inOutStatus[e.zpAvailableStatus])}return n}},{key:"renderWMSStatusIcon",value:function(){var e=this.props,n=null;return e.wmsEnabled&&e.userID&&e.userID!==zmail.zuid&&(n=zmail.wmsAPI.getPresenceIcon({zid:e.userID,createChatViaWM:!0,openChatOnClick:!1}),(n=$.e(n,!0)).setAttribute("ref","wmsStatusIcon")),n}},{key:"renderZPInfo",value:function(){var e=this,n=e.props,t=null,o=n.zpEnabled&&(n.zpDesignation||n.zpTeam)&&(n.zpExtensionNumber||n.zpMobileNumber),a=null;if(n.zpExtensionNumber||n.zpMobileNumber){var i=null,r=null;n.zpExtensionNumber&&(i=m("fragment",null,m("span",{ref:"extNumberLabel",className:"zmGreyClr"},c.labels.extensionNumber+":"),m("span",{ref:"extNumber",title:e.showTooltip?n.zpExtensionNumber:""},n.zpExtensionNumber))),n.zpMobileNumber&&(r=m("fragment",null,m("span",{ref:"mobileNumberLabel",className:"zmGreyClr"},c.labels.mobileNumber+":"),m("span",{ref:"mobileNumber",className:"zmLink",title:e.showTooltip?n.zpMobileNumber:"",onClick:e.onZpMobileNumberClickEvent},n.zpMobileNumber))),a=m("div",{ref:"phoneInfoWrapper",className:"zmCIDRow"},i,r)}if(o){var s=null;n.zpDesignation&&(s=m("span",{ref:"designation",style:{paddingRight:"5px"},title:e.showTooltip?n.zpDesignation:""},n.zpDesignation));var l=null;if(n.zpTeam){var p={};n.zpDesignation&&(p.paddingLeft="5px"),l=m("strong",{ref:"team",className:n.zpTeamID?"zmLink":"",title:e.showTooltip?n.zpTeam:"",style:p,onClick:e.onZpTeamClickEvent},n.zpTeam)}t=m("div",{ref:"zpInfoWrapper",className:"zmCIDataGroup"},m("div",{ref:"teamInfoWrapper",className:"zmCIDRow"},s,n.zpDesignation&&n.zpTeam?" - ":"",l),a)}return t}},{key:"renderWMSActions",value:function(){var e=null,n=this.props,t=null,o=null;return n.wmsEnabled&&zmail.IntegrationStatus.CHAT&&(n.userID||n.groupID)&&(n.userID||n.groupID)!==zmail.zuid&&(n.userID&&(t=m("li",{className:"zmAMItem zmAMSepDot zmAMsmall",ref:"wmsAudioCallAction",title:c.tooltips.startAudioCall,onClick:this.onWMSAudioCallActionClickEvent},m("div",{className:"zmAMWra"},m("i",{className:"msi-audioCall zmAMIcon"}))),o=m("li",{className:"zmAMItem zmAMSepDot zmAMsmall",ref:"wmsVideoCallAction",title:c.tooltips.startVideoCall,onClick:this.onWMSVideoCallActionClickEvent},m("div",{className:"zmAMWra"},m("i",{className:"msi-videoCall zmAMIcon"})))),e=m("div",{ref:"wmsActionsWrapper",className:"zmCIDataGroup"},m("div",{className:"zmCIDRow"},m("div",{className:"zmAMB"},m("ul",{className:"zmAMG "},m("li",{className:"zmAMItem zmAMsmall",ref:"wmsChatAction",title:c.tooltips.startChat,onClick:this.onWMSChatActionClickEvent},m("div",{className:"zmAMWra"},m("i",{className:"msi-cliq zmAMIcon"}))),t,o))))),e}},{key:"renderProgressAnimation",value:function(){var e=null;return this.props.showProgress&&(e=m("div",{ref:"progressAnimation",className:"loading_dots"},m("span",null),m("span",null),m("span",null),m("span",null))),e}},{key:"renderAvatar",value:function(){var e=this.props,n=null;return e.avatar?(n="function"==typeof e.avatar?e.avatar():e.avatar,(n=$.e(n,!0)).setAttribute("ref","avatar")):n=m("div",{ref:"avatar",className:"SC_avtr avtrBg"},m("img",{src:e.photo,alt:e.name})),n}},{key:"render",value:function(){var e=this,n=e.props,t=["zmContactInfo"];n.useLargePhoto&&t.push("zmCIBigAvatar"),t=t.join(" ");var o=n.zpName||n.name,a="";return n.zpID&&(a="zmLink"),m("div",{ref:"wrapper",className:"zmDropDown show",onClick:e.onComponentWrapperClickEvent,onMouseDown:e.onComponentWrapperMouseDownEvent,onMouseUp:e.onComponentWrapperMouseUpEvent},m("div",{className:"zmDdDataWra"},m("div",{ref:"contentWrapper",className:"zmDdDatas"},m("div",{className:t},m("div",{ref:"avatarWrapper",className:"zmCIAvatar"},e.renderAvatar(),e.renderWMSStatusIcon()),m("div",{ref:"dataListWrapper",className:"zmCIData"},m("div",{ref:"baseInfoWrapper",className:"zmCIDataGroup"},m("div",{ref:"nameWrapper",className:"zmCIDRow"},m("strong",{ref:"name",className:a,title:e.showTooltip?o:"",onClick:e.onZpNameClickEvent},o),e.renderZPStatusBadge()),m("div",{className:"zmCIDRow"},m("span",{ref:"emailWrapper",className:"zmCIDeMail"},m("span",{ref:"email",title:e.showTooltip?n.email:""},n.email),m("i",{ref:"emailCopyButton",className:"msi-copy",title:c.tooltips.copyEmailToClipboard,onClick:e.onCopyEmailButtonClickEvent})))),e.renderWMSActions(),e.renderZPInfo(),e.renderProgressAnimation())))))}},{key:"update",value:function(){var a=this,i=a.props;if(a.dom){var e=a.refs.wrapper.getBoundingClientRect();a.unbindDOMEvents();var n=Object.keys(a._props.changed),r=!1;n.forEach(function(e){switch(e){case"zpName":i.zpName?($.e(a.refs.name).addClass("zmLink"),$.e(a.refs.name).text(i.zpName)):($.e(a.refs.name).removeClass("zmLink"),$.e(a.refs.name).text(i.name));break;case"showProgress":if(i.showProgress){var n=a.renderProgressAnimation();a.refs=Object.assign(a.refs,v(n,!0)),$.e(a.refs.dataListWrapper).appendDOM(n)}else $.e(a.refs.progressAnimation).remove();break;case"zpID":case"zpTeam":case"zpTeamID":case"zpDesignation":case"zpExtensionNumber":case"zpMobileNumber":if(!r){var t=a.renderZPInfo();a.refs.zpInfoWrapper&&$.e(a.refs.zpInfoWrapper).remove(),t&&(a.refs=Object.assign(a.refs,v(t,!0)),$.e(a.refs.dataListWrapper).appendDOM(t)),r=!0}break;case"zpAvailableStatus":if(a.refs.zpStatusBadge&&$.e(a.refs.zpStatusBadge).remove(),null!==i.zpAvailableStatus){var o=a.renderZPStatusBadge();a.refs=Object.assign(a.refs,v(o,!0)),$.e(a.refs.nameWrapper).appendDOM(o)}}}),a.refs=Object.keys(a.refs).reduce(function(e,n){var t=a.refs[n];return a.dom.contains(t)&&(e[n]=t),e},{}),a.bindDOMEvents();var t=a.refs.wrapper.getBoundingClientRect();e.width===t.width&&e.height===t.height||a.position()}}},{key:"mount",value:function(){var e=this;e.mounted||(e.dom?e.update():(e.dom=e.render(),e.refs=v(e.dom,!0),e.bindDOMEvents()),e.container.appendChild(e.dom),e._mounted=!0,e.fireEvent(o.MOUNT,{component:e}))}},{key:"unmount",value:function(){var e=this;e.mounted&&(e.hide(),e.unbindDOMEvents(),e.fireEvent(o.BEFORE_UNMOUNT,{component:e}),e.container.removeChild(e.dom),e.dom=null,e.refs=null,e._mounted=!1,e.fireEvent(o.UNMOUNT,{component:e}))}},{key:"bindDOMEvents",value:function(){}},{key:"unbindDOMEvents",value:function(){}},{key:"position",value:function(){var e=this;if(e.mounted){var n=document.body.getBoundingClientRect(),t=e.anchor.getBoundingClientRect(),o=e.refs.wrapper.getBoundingClientRect(),a=0;e.props.showProgress&&(a=e.refs.progressAnimation.getBoundingClientRect().height);var i=n.right-t.right-o.width,r=t.left-n.left-o.width<=i,s={positionToRight:r,left:r?t.left+t.width:t.left-o.width,top:t.top,height:o.height,width:o.width,anchorRight:t.right,temporalHeight:a};e.onBeforePosition&&(s=e.onBeforePosition(s)),$.e(e.refs.wrapper).css({left:s.left+"px",top:s.top+"px"})}}},{key:"show",value:function(){var e=this;e.visible||($.e(e.refs.wrapper).css({visibility:"hidden"}),$.e(e.refs.wrapper).addClass("zmShow"),e.position(),$.e(e.refs.wrapper).css({visibility:"visible"}),$.e(e.refs.wrapper).fadeIn(50),e._visible=!0)}},{key:"hide",value:function(){this.visible&&($.e(this.refs.wrapper).removeClass("zmShow"),this._visible=!1)}},{key:"onPropsChangedEvent",value:function(){this.update()}},{key:"onComponentMountEvent",value:function(){}},{key:"onComponentUnmountEvent",value:function(){}},{key:"onBeforeComponentUnmountEvent",value:function(){}},{key:"onCopyEmailButtonClickEvent",value:function(e){this.fireEvent(o.COPY_EMAIL),zmComponent.clipBoardAPI.setData(this.props.email,{onSuccess:function(){_zm.succErrMsg("s",c.messages.emailCopied)}}),e.stopPropagation(),e.preventDefault()}},{key:"onWMSChatActionClickEvent",value:function(e){var n=this.props;this.fireEvent(o.WMS_CHAT_ACTION),zmail.wmsAPI.invokeChatActions(n.userID||n.groupID,"chat"),e.stopPropagation(),e.preventDefault()}},{key:"onWMSAudioCallActionClickEvent",value:function(e){var n=this.props;this.fireEvent(o.WMS_CHAT_ACTION),zmail.wmsAPI.invokeChatActions(n.userID,"audio"),e.stopPropagation(),e.preventDefault()}},{key:"onWMSVideoCallActionClickEvent",value:function(e){var n=this.props;this.fireEvent(o.WMS_CHAT_ACTION),zmail.wmsAPI.invokeChatActions(n.userID,"video"),e.stopPropagation(),e.preventDefault()}},{key:"onZpNameClickEvent",value:function(e){var n=this.props;e.stopPropagation(),e.preventDefault(),C()&&n.zpID&&(this.fireEvent(o.ZP_ACTION),t("//people.".concat(zmail.zohoUrl,"/hr#home/dashboard/profile-userId:").concat(n.zpID)))}},{key:"onZpTeamClickEvent",value:function(e){var n=this.props;e.stopPropagation(),e.preventDefault(),C()&&n.zpTeamID&&(this.fireEvent(o.ZP_ACTION),t("//people.".concat(zmail.zohoUrl,"/hr#organization/department/searchdepts-deptId:").concat(n.zpTeamID)))}},{key:"onZpMobileNumberClickEvent",value:function(e){var n=this.props;e.stopPropagation(),e.preventDefault(),C()&&n.zpMobileNumber&&(this.fireEvent(o.ZP_ACTION),t("tel://".concat(n.zpMobileNumber)))}},{key:"onComponentWrapperClickEvent",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"onComponentWrapperMouseDownEvent",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"onComponentWrapperMouseUpEvent",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"mounted",get:function(){return this._mounted}},{key:"visible",get:function(){return this._visible}},{key:"props",get:function(){return Object.assign({},this._props.attributes)}}]),n}();b.EVENTS=o,b.show=function(){var e,o,n,a,i,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=null,s=(t=Object.assign({container:document.body},t)).contact,l=t,p=l.anchor,u=l.container,m=l.props,c=void 0===m?{}:m,v=l.onBeforePosition,f=function(){r.mounted&&r.setProps({showProgress:!1})};if((c=Object.assign(function(e){var n=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).parsedEmail,t=e.attrs.eid,o=(e.attrs.fn||"").trim();n=n||zmail.Utils.EmailParser.parse(t)[0],t===o&&(o=n.name);var a=(e.attrs.ln||"").trim(),i=(e.attrs.mn||"").trim(),r=(e.attrs.nn||"").trim(),s=[o,i,a,r?"( ".concat(r," )"):""].filter(function(e){return 0<e.length}).join(" "),l={email:e.attrs.eid,name:s,avatar:e.avatar(),isGroup:e.attrs.isGroup};return l.isGroup?(l.groupID=e.attrs.isGroup?e.attrs.zid:null,l.groupID&&(l.groupID=String(l.groupID))):(l.userID=!0!==e.attrs.isGroup?e.attrs.zid:null,l.userID&&(l.userID=String(l.userID))),l}(s),c)).isGroup)c.zpEnabled=!1;else if(C()){var d=g({contact:s,email:c.email,userID:c.userID});d?c=Object.assign(c,d):(c.showProgress=!0,(n={contact:s,email:c.email,userID:c.userID},a=n.email,i=n.userID,C()?new Promise(function(n,t){zmAppLoader.load("peopleinteg").then(function(){zmail.peopleInteg.util.getProfileInfo({zuid:i,email:a}).then(function(){var e=g({email:a,userID:i});e?n(e):t()},t)},t)}):Promise.reject()).then(function(e){r.mounted&&(r.setProps({showProgress:!1}),r.setProps(e))},f).catch(f)),(e={userID:c.userID},o=e.userID,C()&&o?new Promise(function(n,t){zmAppLoader.load("peopleinteg").then(function(){if(z[o]){var e=z[o];if(Date.now()-e.timestamp<=6e5)return void n(e.code);delete z[o]}zmail.peopleInteg._core.getUserStatus(o).then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.result=e.result||[],e.result[0]?(z[o]={timestamp:Date.now(),code:e.result[0].att_status},n(e.result[0].att_status)):(z[o]={timestamp:Date.now(),code:null},t())},t)},t)}):Promise.reject()).then(function(e){r.mounted&&r.setProps({zpAvailableStatus:{0:"out",1:"in",2:"break"}[e]||null})}).catch(function(){r.mounted&&r.setProps({zpAvailableStatus:null})})}var h={anchor:p,container:u,props:c,onBeforePosition:v};return(r=new b).init(h),r.mount(),r.show(),r},zmail.Core.Namespaces.create("zmail.Components").ContactCard=b}(),window.__rollupModule=void 0;