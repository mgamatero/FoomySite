"use strict";!function(){var r,i,t,e,n,a,o,s,u,c,l=zmail.Search.Dependencies,d=l.ExternalDependency,f=l.MailDependency,m=zmail.Maps,p=m.DelimitedMap,h=m.Map,g=zmail,v=(g.Traverser,g.Paginator,zmail.ValueTypeInferrer.TYPE_NAMES),C=zmUtil.debugLog,S=function(){},x=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(babelHelpers.classCallCheck(this,r),!(this instanceof r))return new r(e);Object.assign(this,this.defaults(),e)}return babelHelpers.createClass(r,[{key:"defaults",value:function(){return{name:"",group:"",description:"",action:S,searchable:!0}}},{key:"getDescription",value:function(r){var e=this.description;return d.isEmpty(e)?"":(d.isArray(e)||(e=[e]),d.isEmpty(r)?e[0]:(r=r.toLowerCase(),d.underscoreJSWrapper(e).find(function(e){return 0!==e.toLowerCase().indexOf(r)})))}},{key:"getDisplayValue",value:function(e){return e}}]),r}(),y=!0,M=function(){var e=f.require("zmail.Search.SearchWatcher").getCurrentContext();e&&e.__isCommand?a.mode=a.MODES.COMMANDS:a.mode=a.previousMode||a.MODES.SEARCH},w={isDefaultPrevented:function(){return!1===y},init:d.once(function(){e=f.require("zmail.Paginator"),n=f.require("zmail.SearchComponents.ListView"),a=f.require("zmail.Search.ModeKeeper"),o=f.require("zmail.Search.Utils.CommonUtil"),r=f.require("zmail.Search.ViewInstance.SearchBox"),i=f.require("zmail.Search.ViewInstance.SearchBoxContainer"),t=new n({$for:r.$el,$top:i.$els.$el,$parent:i.$els.$el,pageSize:10,hideOnRemove:!0,selectionStartIndex:0,onEscape:M,onMouseDown:M,text:function(e,r){if(d.isString(e))return e;if(u){var t=u.text||"description";if(d.isFunction(t))return t(e);if(d.isObject(e)&&d.isString(t)){var n=e[t];if(d.isString(n))return n;if(d.isArray(n)){var i=(r.query||"").toLowerCase();return d.unserscoreJSWrapper(n).find(function(e){return 0===e.toLowerCase().indexOf(i)})}return""}}},paginator:new e({pageSize:10,provider:function(e){if(u){if(d.isFunction(u.provider))return u.provider(e.query);if(d.isArray(u.provider)){var r=(e.query||"").toLowerCase(),t=u.filterProps||d.isString(u.text)&&u.text;return t&&(t=d.isArray(t)?t:[t]),u.provider.filter(function(e){return d.isString(e)?-1!==e.toLowerCase().indexOf(r):!d.isObject(e)||!t||o.isStartsWith(e,r,t,!0)})}}return[]}}),onSelect:function(e){s&&s.resolve(e),w.clearText().reset()}}).unbind(),r.registerModeHandler(a.MODES.COMMAND_EXECUTION,{autofill:function(){return t}})}),showList:function(e){return u=e,s=d.jQueryDeferred(),t.reset(),d.defer(function(){a.mode=a.MODES.COMMAND_EXECUTION,d.WHEN(t.change(r.getText())).then(function(){r.select()})}),s.promise()},setText:function(e){return r.setText(e),this},clearText:function(){return r.setText(""),this},setPlaceholder:function(e){return r.setPlaceholder(e),this},preventDefault:function(){return y=!1,this},reset:function(e){if(y||e){y=!0,s=u=void 0;var r=f.require("zmail.Search.Models.Contexts.Commands"),t=f.require("zmail.Search.SearchWatcher").getCurrentContext(),n=f.getCurrentTab();t===r&&r.tabRegexp.test(n)?a.mode=a.MODES.COMMANDS:a.mode=a.MODES.SEARCH,w.clearText(),d.defer(function(){i.hideCloseIcon().unselect()})}}},E=function(e){return e instanceof x},D=new p,O=new h,z={},b=[],T={},q=function(e){return e?(d.isArray(e)||(e=[e]),e):[]},L=function(e){if(e){var r=e.command;e.description||(e.description=r.getDescription(e.qry)),e.value&&!e.displayValue&&r.type&&(e.displayValue=r.getDisplayValue(e.value)),e.command=r,e.__command=!0}return e},A=function(e){return T[e]},N=function(e){return D.get(e).map(function(e){return T[e]})},_=function(e){if(d.isString(e)&&(e=T[e]),E(e)){w.reset();var r=[].slice.call(arguments);return r.splice(0,1),e.action.apply(Object.assign(c(),e),r)}};c=function(){return{execute:_,getByGroupName:N,showList:w.showList,setText:w.setText,clearText:w.clearText,setPlaceholder:w.setPlaceholder,preventDefault:w.preventDefault,reset:w.reset.bind(this,!0)}};var V={message:"",CommandError:function(e){this.message=e}}.CommandError,$=zmail.Core.Namespaces.create("zmail.Commander");Object.assign($,{Command:x,CommandError:V},{serialize:L,get:function(n){if(!n)return[];n=n.toLowerCase();var i={},r=new RegExp("\\s+\\w*\\W*"+n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");return b.filter(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return 0<=(e=e.toLowerCase()).indexOf(n)||e.match(r)}).reduce(function(e,r){var t=T[z[r]];return t.name in i||(i[t.name]=t.name,e.push(L({qry:n,command:t,description:r}))),e},[])},register:function(e){return q(e).reduce(function(e,r){var t=r.name;return t in T&&C("command-name: "+t+" already exits"),E(r)||(r=new x(r)),(T[t]=r).searchable&&q(r.description).forEach(function(e){b.push(e),z[e]=t}),q(r.group).forEach(function(e){D.add(e,t)}),r.type&&O.add(r.type,t),e},this),b.sort(),this},deRegister:function(r){var e=T[r];return e&&(delete T[r],!1!==e.searchable&&q(e.description).forEach(function(e){e=e.toLowerCase();var r=b.indexOf(e);-1!==r&&e.splice(r,1),delete z[e]}),q(e.group).forEach(function(e){D.remove(e,r)})),this},getCommand:A,getByGroupName:N,getCommandsBasedOnTypes:function(n){return v.reduce(function(e,r){var t=n[r];return t?e.concat(O.get(r).map(function(e){return L({value:t,command:A(e)})})):e},[])},getAllVariabled:function(){return{groupMap:D,typeMap:O,descriptionMap:z,descriptions:b,nameMap:T}},execute:_,isSerializedCommand:function(e){return e&&e.__command}},{Views:w})}(),window.__rollupModule=void 0;