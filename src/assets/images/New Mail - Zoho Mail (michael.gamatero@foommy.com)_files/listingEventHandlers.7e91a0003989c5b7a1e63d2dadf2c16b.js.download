"use strict";define([],function(A){var e=zmail.Core.Namespaces,T=zmText.get("mail").listing,N=ZMail.lConstants,c=N.cls,E=e.create("zmail.Listing.Handlers.DeliveryStatus"),l={mailUtilAction:[]};return E.getMailDeliveryStatus=function(a,e,t){if(a&&!_zm.isOfflineSyncActive()&&(0===a.indexOf("t")&&(a=a.subtring(1)),!l.mailUtilAction.includes(a))){var s=zmUtil.getMailObj(a);if(0===s.MDS&&s.RS&&-1!==s.RS)E.showDeliveryStatusDialog({MDS:0,showOnlyRS:!0},{msgId:a});else{l.mailUtilAction.push(a);var i={accId:zmail.accId,mode:"getMailDeliveryStatus",msgId:a};zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:function(e,t){E.showDeliveryStatusDialog(e,t),l.mailUtilAction.splice(l.mailUtilAction.indexOf(a),1)},efn:function(){l.mailUtilAction.splice(l.mailUtilAction.indexOf(a),1)},p:i,ep:{msgId:a,refresh:e,dInst:t},csr:"s"})}}},E.showDeliveryStatusDialog=function(d,t){if(!d.error&&(d.MDS||d.showOnlyRS)){1===d.MDS&&d.userstatus&&d.userstatus.toLogs.length&&(d.MDS=5);var i,e,c,a={},r=d.MDS,n=t.msgId,u="",l=t.dInst||{},o=T.mailDeliveryStatus,p={},m="",z={0:"",1:T.mailDeliveryStatus.statusTitle.queued,2:T.mailDeliveryStatus.statusTitle.inprogress,3:T.mailDeliveryStatus.statusTitle.inprogress,4:T.mailDeliveryStatus.statusTitle.inprogress,5:T.mailDeliveryStatus.statusTitle.success,6:T.mailDeliveryStatus.statusTitle.failure,7:T.mailDeliveryStatus.statusTitle.failure,8:T.mailDeliveryStatus.statusTitle.undo,9:T.mailDeliveryStatus.statusTitle.retry,10:T.mailDeliveryStatus.statusTitle.retry},f={0:"",1:T.mailDeliveryStatus.statusContent.queued,2:T.mailDeliveryStatus.statusContent.inprogress,3:T.mailDeliveryStatus.statusContent.inprogress,4:T.mailDeliveryStatus.statusContent.inprogress,5:T.mailDeliveryStatus.statusContent.success,6:T.mailDeliveryStatus.statusContent.failure,7:T.mailDeliveryStatus.statusContent.failure,8:T.mailDeliveryStatus.statusContent.undo,9:T.mailDeliveryStatus.statusContent.retry,10:T.mailDeliveryStatus.statusContent.retry};6!==r&&7!==r||(m=zdom("font",{id:"helpDF",className:"SC_ldot"},o.common.learnmore)),e=t.refresh||!1,u=d.userstatus&&d.userstatus.toLogs?(c=d.userstatus.toLogs||[],d.userstatus.nrcpts||""):(c=d.userstatus||[]).length;var s=function(e){return zdom("div",null,(t=e,(a=zmail.ContactBook.get({eid:t,promise:!1})[0])?a.attrs.fn||a.attrs.nn||a.attrs.eid:zmConUtil.parseContacts(t)[0].fn||t),zdom("font",null,zdom("b",null,"-"),e),zdom("span",null," ",e," "));var t,a},g=function(e,t,a){if(!e&&!t)return"";var s,i,l,n,o,m,d;return zdom("div",{className:"zmDel_status"},t?zdom("span",{className:"zmSndSts_PopupIcon"},zdom("div",{className:"zmSndStsCon "+{TEMP_FAILURE:"zmSndSts-fail",SUCCESS:"zmSndSts-suc",PERM_FAILURE:"zmSndSts-fail"}[t]},zdom("span",{className:"zmSndStsIco"},zdom("i",{className:{TEMP_FAILURE:"msi-mailRetry",SUCCESS:"msi-mailSuc",PERM_FAILURE:"msi-mailFail"}[t]})))):"",e?zdom("span",{className:"zmDel_time"},e):"",a?(s=a,i=T.mailDeliveryStatus.common.encryptionTxt,l=" zmDoubleIcon",n="",o=zmail.urls.helpURL+"email-encryption.html#alink3",d=m="",0===s?(m="msi-unsecured",m+=l,n=" "+i.plain+" ",d="redDtxt"):1===s?(d="ylwtxt",m="msi-secured",n=" "+i.tls+" ",m+=l+" "+d):2===s&&(d="greenDtxt",m="msi-secured",n=" "+i.smime+" ",m+=l+" "+d),zdom("span",{className:"zmDelSecur"},zdom("span",{className:d},zdom("i",{className:m}),n),zdom("a",{className:"greyText",target:"_blank",rel:"noopener noreferrer",href:o},zdom("i",{className:"msi-infoRound zmDoubleIcon"})))):"","TEMP_FAILURE"===t||"PERM_FAILURE"===t?zdom("span",{className:"zmDel_failLnk"},T.mailDeliveryStatus.common.knowwhy):"")},v=function(e){return zdom("fragment",null,zdom("li",{eid:e.rcpt},1<r&&r<10&&8!==r?g(e.deliveryTime,e.status,e.mailEncryptionType):"",s(e.rcpt)),6===r||7===r||10===r||9===r?(t=e.reason,a="",t&&(a=zdom("div",{className:"zmDel_failMsg"},zdom("p",null,t))),a):"");var t,a},S=function(e){var t,a=c.length,s=!1;for(t=0;t<a;t++)if(c[t].rcpt===e){s=!0;break}return s},h=function(){var e=$("#mail_delivery_status");return e.length||(e=$.e(zdom("div",{id:"mail_delivery_status",className:"delStatus_content","data-msg":t.msgId}))),e},C=function(){var e,t,a="",s=T.mailDeliveryStatus.common.member,i=T.mailDeliveryStatus.common.members,l=zdom("fragment",null),n=zdom("fragment",null),o=0,m=0;if(7===r){for(e=0;e<u;e++)"PERM_FAILURE"===(t=c[e]||{}).status?(n.appendChild(v(t)),m++):"SUCCESS"===t.status&&(l.appendChild(v(t)),o++);a=zdom("div",{id:"mds_right",className:"delStatus_rht"},zdom("div",{className:"partialMail_contact zmTV"},zdom("h4",null,T.mailDeliveryStatus.common.delivered+" "+o+" "+(1<o?i:s)),zdom("div",{className:"SC_PUcen"},zdom("ul",{className:"SC_P2r"},l))),zdom("div",{className:"partialMail_contact"},zdom("h4",null,T.mailDeliveryStatus.common.failure+" "+m+" "+(1<m?i:s)),zdom("div",{className:"SC_PUcen"},zdom("ul",{className:"SC_P2r"},n))))}else a=zdom("div",{id:"mds_right",className:"delStatus_rht"},zdom("div",{className:"singleMail_contact"},zdom("ul",{className:"SC_P2r"},function(){var e,t,a=c.length,s=zdom("fragment",null);for(e=0;e<a;e++)t=c[e],s.appendChild(v(t)),p[t.rcpt]=t.status;if(0<r&&r<5||8===r||9===r||10===r)for(a=d.undelivered.length,e=0;e<a;e++)t=d.undelivered[e],S(t)||(s.appendChild(v({rcpt:t,status:"",reason:"",deliveryTime:""})),p[t]="PERM_FAILURE");return s}())));return a},I=function(){return zdom("div",{className:"delStatus_row"},zdom("div",{id:"mds_left",className:"delStatus_lft"},function(){var e,t=A("zmList"),a=t.getMailObj(n);if(a.RS&&-1!==a.RS){var s={1:"rcProcess",2:"rcParSucc",3:"rcFailed",4:"rcSuccess",5:"rcNonOrg"};e=zdom("fragment",null,zdom("h3",{id:"mdsHeader"},zdom("span",{id:"mdsTitle"},o.statusTitle[s[a.RS]])),zdom("p",null,zdom("span",{id:"mdsContent"},o.statusContent[s[a.RS]]),zdom("font",{id:"helpRS",className:"SC_ldot"},o.common.learnmore)))}else{var i="";if(t.haveMailRecallSupport(n)&&(i=zdom("div",{id:"RCOpt",className:"zmRecallPopTxt"},zdom("div",null,zdom("span",null,zdom("i",{className:"msi-recall "+N.jsCls.rsIcon}),zdom("span",{id:"rsText"},o.common.recallOpt)),zdom("i",{className:"msi-infoRound zmDoubleIcon"}))),ZMail.utils.isRecallDisabled())){_zm("<","span",i)[0].classList.add("zmUpgrade"),i.classList.add("zmUpgradeRecall");var l=zdom("div",{className:"zmUpgradeTxt"},zdom("i",{className:"msi-fav"}),o.common.upgrade);i.appendChild(l)}e=zdom("fragment",null,i,zdom("h3",{id:"mdsHeader"},zdom("span",{id:"mdsTitle"},z[r])),zdom("p",null,zdom("span",{id:"mdsContent"},f[r]),m||""))}return e}(),1<r&&r<5?zdom("p",null,zdom("a",{id:"mds_update",className:"SC_lnk"},T.mailDeliveryStatus.common.refresh),T.mailDeliveryStatus.common.inprogresstext):"",6===r||7===r||8===r?zdom("div",{id:"mds_resend",className:"SC_PUbtm"},zdom("span",null,T.mailDeliveryStatus.common.resend)):""),d.showOnlyRS?"":C())},k=function(){i.find("li").each(function(e,s){var i=$(s).attr("eId");i&&zmail.ContactBook.get({eid:i}).then(function(e){var t,a=e[0];t=a?a.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(i),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),$(s).find("img").remove(),$(s).append(t)})})},D=function(){var e,t,a,s;i.length&&(e=i.find("#mds_update"),t=i.find(".zmDel_failLnk"),a=i.find("#mds_resend"),s=i.find("#helpDF"),e.length&&e.off("click").on("click",function(){E.getMailDeliveryStatus(n,!0,l)}),t.length&&t.off("click").on("click",function(){var e=$(this).closest("li");e.next().slideToggle(),e.toggleClass("zm_failMsg")}),a.length&&a.off("click").on("click",function(){l.remove(),ZMail.utils.loadComposer({parentId:n,composeAction:"eanew",recipientList:p})}),s.length&&s.off("click").on("click",function(){6===r?window.open("//www.zoho.com/mail/help/how-email-works.html#alink1","_blank").focus():7===r&&window.open("//www.zoho.com/mail/help/how-email-works.html#alink2","_blank").focus()}),i.on("click","#helpRS",function(e){window.open(zmail.urls.helpURL+"recall-sent-email.html","_blank").focus()}),i.on("click","#RCOpt",function(e){var t=e.target;_zm.hasClass(t,"msi-infoRound")?window.open(zmail.urls.helpURL+"recall-sent-email.html","_blank").focus():_zm.hasClass(t,"zmUpgradeTxt")||_zm.hasClass(t,"msi-fav")?window.open("//www.zoho.com/workplace/pricing.html","_blank").focus():ZMail.recall.init({mId:n,mdsRef:$(t.closest("#mail_delivery_status"))})}))};if(d.undelivered&&d.undelivered.length){var M,R,y=d.undelivered.length;for(M=0;M<y;M++)0===(R=d.undelivered[M]).indexOf(n)&&(d.undelivered[M]=d.undelivered[M].substring(n.length+1,R.length)),S(d.undelivered[M])||u++}!e&&h().parent().length&&(e=!0),e?((i=h()).html(I()),k(),D()):((i=h()).html(I()),a.$content=i,a.ignoreMouseDown=!1,a.contentWrapperClass="SC_PU singleMail_DelStatus zmSnd_stsPopup",a.dialogDidMount=function(){},a.dialogWillMount=function(){k(),D()},l=Dialog.new(a)),r!==zmList.getMailObj(n).MDS&&E.updateMailDeliveryStatus({module:"mail",MDS:r,M:n,ignorePopupUpdate:!0})}},E.updateMailDeliveryStatus=function(e){var t=e.M;e.MDS=parseInt(e.MDS);var a=zmList.getMailObj(t),s=e.ignorePopupUpdate||!1,l="",i=e.MDS;6!==i&&7!==i||(zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").updateCount(zmail.folId.sId,"inc"),zmUtil.updSendErrorStatus(!0,zmail.folId.sId));if(a&&i!==a.MDS){if(l=a.MDS,1<i&&i<5&&1<l&&l<5||i<5&&4<l)return;if(zmUtil.updateMailData("MDS",i,t),zmUtil.getFolId()===zmail.folId.sId){var n,o=zmCenterListing.mailObjectAPI.getViewObject(t,"zm_Container"),m={0:"",1:T.mailDeliveryStatus.statusTitle.queued,2:T.mailDeliveryStatus.statusTitle.inprogress,3:T.mailDeliveryStatus.statusTitle.inprogress,4:T.mailDeliveryStatus.statusTitle.inprogress,5:T.mailDeliveryStatus.statusTitle.success,6:T.mailDeliveryStatus.statusTitle.failure,7:T.mailDeliveryStatus.statusTitle.failure,8:T.mailDeliveryStatus.statusTitle.undo,9:T.mailDeliveryStatus.statusTitle.retry,10:T.mailDeliveryStatus.statusTitle.retry},d=function(e,t){var a="",s=e.find(".zmSndSts-anipro"),i=e.find(".zmSndStsCon");!s.length&&1<t&&t<5&&(a=zdom("span",{className:"zmSndSts-anipro"},zdom("span",{className:"zmSndSts-Inpro zm_delspinner"}),zdom("span",{className:"zmSndSts-Inpro zm_delfiller"}),zdom("span",{className:"zm_delmask"}))),e.length?(!s.length||1<t&&t<5?i.prepend($(a)):s.remove(),i.attr("class","zmSndStsCon "+zmInit.classObj.mdsParentClass[t]),10===l&&2===t&&i.addClass("zmSndSts-fpro"),e.find("i").removeClass().addClass(zmInit.classObj.deliverySts[t]+" jsMDSIcon"),e.attr("title",m[t])):(e=zdom("div",{className:c.mdsOuter+" "+N.jsCls.mdsStaus,title:m[t]},zdom("div",{className:"zmSndStsCon "+zmInit.classObj.mdsParentClass[t]},a,zdom("span",{className:"zmSndStsIco"},zdom("i",{className:zmInit.classObj.deliverySts[t]+" jsMDSIcon"})))),$.e(o).find("."+c.labelDQA).appendDOM(e))};o&&(o=$(o.$element)).length&&(n=o.find("."+c.mdsOuter),d(n,1!==i?2:i),4<i&&(n.length||(n=o.find("."+c.mdsOuter)),setTimeout(function(){d(n,i)},1500)))}!s&&$("#mail_delivery_status").length&&$("#mail_delivery_status").attr("data-msg")===t&&E.getMailDeliveryStatus(t)}},E}),define([],function(o){var e=zmail.Core.Namespaces,m=zmText.get("mail"),t=e.create("ZMail.recall"),d=ZMail.lConstants,c={},r=m.listing.mailDeliveryStatus,u=function(e,i){var t={u:zmail.conPath+"/mA.do",t:"POST",fn:function(e,t){_zm.succErrMsg("i",r.common.recallSucc,{hideAfter:2e3,parElem:i})},efn:function(e,t,a,s){_zm.succErrMsg("e",r.common.recallFail,{parElem:i})},ep:{mId:e},p:{mode:"recall",mailId:e}};zmAjq.XHR(t)};t.updateStatus=function(e,t){var a=o("zmList");if(a.getMailObj(e)){a.updateModel("RS",t,e);var s={1:"rcProcess",2:"rcParSucc",3:"rcFailed",4:"rcSuccess",5:"rcNonOrg"},i=c[e]||{};if(i.listRef){var l=i.listRef.find("."+d.jsCls.mdsStaus);l.after(ZMail.lView.constTemplate("RSICON",{tooltip:r.tooltips[s[t]],cls:zmInit.classObj.recallStatus[t],gif:1===t})),l.remove(),1!==t&&_zm.succErrMsg("i",r.statusContent[s[t]],{hideAfter:2e3,parElem:i.mdsRef&&i.mdsRef[0]})}if(i.mdsRef){i.mdsRef.find("#mdsTitle").text(r.statusTitle[s[t]]),i.mdsRef.find("#mdsContent").text(r.statusContent[s[t]]);var n=i.mdsRef.find(".zmRecallPopTxt");1===t?(n.html(""),n.append(zdom("img",{src:zmResource.get("image","mail/recall-2x.gif"),width:"14px"})),n.append(zdom("span",null,r.common.recallPros))):n.closest("#RCOpt").remove()}t&&1!==t&&delete c[e]}};return t.init=function(e){var t,a,s,i,l;if(!ZMail.utils.isRecallDisabled())if((c[e.mId]=e).listRef=zmCenterListing.mailObjectAPI.getViewObject(e.mId,d.mailAppId).$element,e.mdsRef&&e.mdsRef.length){e.mdsRef.addClass("zmTxtDisabled");var n=(s=function(){n.remove(),e.mdsRef.removeClass("zmTxtDisabled"),u(e.mId,e.mdsRef[0])},i=function(){n.slideToggle(300,"linear",function(){n.remove()}),e.mdsRef.removeClass("zmTxtDisabled"),delete c[e.mId]},l=zdom("div",{className:"SC_simg js-rConf",style:{display:"none"}},zdom("p",null,r.common.mdsConfirmation),zdom("div",{className:"SC_PUbtm"},zdom("span",{id:"ok",tabIndex:"1"},m.actions.common.ok),zdom("span",{id:"cancel","data-val":"Cancel"},m.actions.common.cancel))),(l=$(l)).find("#ok").off("click").on("click",s),l.find("#cancel").off("click").on("click",i),l);e.mdsRef.find("#mdsHeader").after(n[0]),n.slideToggle(300,"linear")}else t=e,a=Dialog.new({title:r.common.recallOpt,ignoreMouseDown:!1,$content:zdom("p",null,r.common.mdsConfirmation),buttons:[{name:m.actions.common.ok,callback:function(){u(t.mId),a.remove()}},{name:m.actions.common.cancel,callback:function(){a.remove(),delete c[t.mId]}}]})},t}),function(){var e=zmail.Core.Namespaces,k=zmText.get("mail"),D=k.listing,t=e.create("zmail.Listing.Handlers.SchemaActions"),n=function(e,a){var t=zmList.getMailObj(e);if(e&&t&&t.SCOBJ[0]){var s,i=t.SCOBJ[0];i.ASTATUS=!0,a.suppress||_zm.succErrMsg("s",D.quickactions.success);var l=ZMail.lConstants.cls;"CONFIRMACTION"===a.actName||"SAVEACTION"===a.actName?(!(s=$("#"+e+"  span."+l.qckAct)).length&&t.TH&&(s=$("#t"+e+"  span."+l.qckAct)),s.length&&s.each(function(e,t){$(t).html(zdom("font",{className:"SC_op3"}," ",i.DN," ")),$(t).append(zdom("i",{className:"msi-tick "+l.qckAct}))})):"REVIEWACTION"===a.actName?(i.RB=a.reviewBody||"",i.RR=a.reviewRating):"RSVPACTION"===a.actName&&(i.RSVPSTUS=a.rsvpStatus.toLowerCase(),!(s=$("#"+e+"  span."+l.qckAct)).length&&t.TH&&(s=$("#t"+e+"  span."+l.qckAct)),s.length&&s.each(function(e,t){$(t).text(D.quickactions.attending+" : "+a.rsvpStatus),$(t).append(zdom("i",{className:"msi-rsvp "+l.qckAct}))}))}},M=function(e,a,t){if(e&&a){t=t||{};var s={msgId:a,accountId:zmail.accId,actName:e.SCATYPE},i=$.extend({},s);t.evtstatus?(s.rsvpStatus=t.evtstatus.toLowerCase(),i.rsvpStatus=t.evtstatus):t.reviewRating&&(s.reviewRating=i.reviewRating=t.reviewRating,t.reviewBody&&(s.reviewBody=i.reviewBody=t.reviewBody));if(!e.ASTATUS||"RSVPACTION"===e.SCATYPE){var l={u:zmail.conPath+"/executeActSchema.do",t:"POST",fn:function(e,t){"SUCCESS"===e.ASTATUS&&n(a,t)},onerror:function(e){_zm.succErrMsg("e",e.msg)},p:s,ep:i};zmAjq.XHR(l)}}},o=function(a,s,e){if(a&&e.length){var t,i,l,n="",o="",m="SC_Rating yetToRate",d=D.quickactions.reviewcomment,c="";for(a.ASTATUS&&(d=_zm.escapeTags(a.RB||""),c="readonly",n="sel",m="SC_Rating"),i=zdom("fragment",null),l=a.RWR;l<=a.RBR;l++)o=l<=a.RR?"msi-fav "+n:"msi-fav",zmail.Utils.DOM.mountAtStart(zdom("i",{className:o,"data-value":"rate"+l,title:l}),i);var r=zdom("fragment",null,zdom("li",null,zdom("b",null,a.DN)),zdom("li",{style:{width:"200px"}}," ",a.DESC||""," "),a.SHOWRB?zdom("li",null,zdom("textarea",{id:"zm_reviewbody"+c,tabIndex:"0",maxLength:"1500",placeholder:d})):"",zdom("li",null,zdom("div",{className:m},zdom("div",null," ",i," "))),a.ASTATUS?"":zdom("li",null,zdom("div",{className:"SC_PUbtm"},zdom("span",{"data-value":"publish"},D.quickactions.submit))));t={par:e,showArrow:!0,liDom:$(r),spanClass:"minwid",ulClass:"noclass",clk:function(e,t){!function(e,t,a){var s,i,l,n=$(e).data().value||"";if("publish"===n)s=(l=$(e).closest("ul")).find("#zm_reviewbody").val(),0===(i=l.find(".sel").length)?_zm.succErrMsg("e",D.quickactions.alertrating):a.REVPARAM&&(M(a,t,s?{reviewRating:i,reviewBody:s}:{reviewRating:i}),zmUtil.hideMenu());else if(0===n.indexOf("rate")){var o=n.substring(4)||0,m=$(e).closest("li").find(".msi-fav"),d=m.length,c=0;for(o=parseInt(o),m.removeClass("sel"),c=1;c<=o;c++)m.eq(d-c).addClass("sel")}}(t,s,a)}},zmsuite.showMenu(t)}},m=function(l,n,e){if(l&&e.length){var t,a,s,i,o,m,d,c=l.EXPIRED;t=new Date(l.SD),l.ED&&(a=new Date(l.ED));var r=(h=(new Date).getTime(),C=t.getTime(),I=a&&a.getTime(),!!(C<=h&&(I&&h<I||!I)));(c||r)&&(m=r?D.quickactions.ongoing:D.quickactions.expired);var u={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"},p={0:k.days.sun,1:k.days.mon,2:k.days.tue,3:k.days.wed,4:k.days.thu,5:k.days.fri,6:k.days.sat};s=u[t.getMonth()],i=t.getDate(),o=p[t.getDay()].substr(0,3);var z,f=function(e){var t=e.getHours(),a=e.getMinutes(),s="am";return 12<t&&(t-=12,s="pm"),(t=t<10?"0"+t:t)+":"+(a=a<10?"0"+a:a)+s},g={yes:"",no:"",maybe:""};l.ASTATUS&&(g[l.RSVPSTUS]="sel"),z=r?"eventOnGoing":c?"eventExpired":"";var v=zdom("div",{className:"zmEventMailAction"},zdom("div",{className:"zmEventMailBtnWra"},zdom("span",{className:"zmEventMailBtn greenBtn "+g.yes,"data-value":"Yes"},D.quickactions.yes),"true"===l.SHOWMB&&l.MBURL?zdom("span",{className:"zmEventMailBtn blueBtn "+g.maybe,"data-value":"Maybe"},D.quickactions.maybe):"",zdom("span",{className:"zmEventMailBtn redBtn "+g.no,"data-value":"No"},D.quickactions.no))),S=zdom("li",{className:"noPad"},zdom("div",{className:"zmEventMail inDropDown "+z},zdom("div",{className:"zmEventMailWra "+(c?"zmDisabled":"")},zdom("div",{className:"zmEventMailLft"},zdom("div",{className:"zmEventMailDate"},zdom("span",null,s),zdom("strong",{className:"zmThmClr"},i<10?"0"+i:i),zdom("span",null,o))),zdom("div",{className:"zmEventMailRgt"},zdom("div",{className:"zmEventMailInfo"},zdom("h3",null,l.DN),zdom("div",{className:"zmEventMailInfoRow"},zdom("span",{className:"zmEventMailInfoIcon"},zdom("i",{className:"msi-clock"})),zdom("span",null,"On "+o+" "+s+" "+i+","+t.getFullYear()+" "+f(t)+"-"+(function(){if(a)return t.getFullYear()===a.getFullYear()&&t.getDate()===a.getDate()&&t.getMonth()===a.getMonth()}()?"":p[a.getDay()].substr(0,3)+" "+u[a.getMonth()]+" "+a.getDate()+","+a.getFullYear()+" ")+f(a)))),v)),m?zdom("div",{className:"zmEventMailTag"},zdom("span",null,m)):""));d={par:e,showArrow:!0,liDom:$.e(S),spanClass:"minwid noPad",ulClass:"noClass",liHover:"false",clk:function(e,t){var a,s,i;a=n,s=l,(i=$(t).data().value||"")&&s&&!s.EXPIRED&&(M(s,a,{evtstatus:i}),zmUtil.hideMenu())}},zmsuite.showMenu(d)}var h,C,I};t.processSchemaAction=function(e,t){var a,s,i,l,n=e.msgId;if(n&&0===n.indexOf("t")&&(n=n.substring(1)),(a=zmList.getMailObj(n))&&a.SCOBJ)switch((s=a.SCOBJ[0]).SCATYPE){case"VIEWACTION":case"TRACKACTION":case"ORDER":case"FLIGHTRESERVATION":case"PARCELDELIVERY":!function(e){if(e){var t=e.GURL||e.AURL;if(t=t?decodeURIComponent(t):e.ORDEROBJ&&e.ORDEROBJ.VIEWORDERURL||e.FLYTTKTOBJ&&e.FLYTTKTOBJ[0].url||e.PARCLDLVRYOBJ&&e.PARCLDLVRYOBJ.TRACKINGURL,e.ZMAIL_INTERNAL_SERVICE&&"task"===e.ZMAIL_INTERNAL_SERVICE){var a=zmHash.decode(t);if("stream"===a.key){var s=a.params;zmUtil.loadStreamsInTab({pid:s[1],gid:s[0],etype:s[2],actionType:s[3],commentId:s[4]})}else window.open(t,"_blank").focus()}else window.open(t,"_blank").focus()}}(s);break;case"SAVEACTION":case"CONFIRMACTION":l=n,(i=s)&&M(i,l);break;case"REVIEWACTION":o(s,n,t);break;case"RSVPACTION":m(s,n,t)}},t.updateSchemaAction=n}(),function(){var e=zmail.Core.Namespaces,t=zmText.get("mail"),u=t.listing,p=t.actions,a=e.create("zmail.Listing.Handlers.SweepAction"),z=function(){zmsDialog.remove(),$("#sweeppopup").remove()},f=function(e,t,a){if((a||e.length)&&t.length){var s=[],i=[];if(a=a||e.find(".msi-option").data("value"),t.find(".msi-check").each(function(){s.push($(this).data("value")),i.push($(this).data("msg"))}),0===s.length)return void zmUtil.succErrMsg("i",u.sweep.selonesender);if(5<s.length)return void zmUtil.succErrMsg("i",u.sweep.sellimit);if(!a)return void zmUtil.succErrMsg("i",u.sweep.seloption);var l={mode:"sweep",senderList:s,actionType:a,msgId:i,thd:[]};zmail.MailAction.Initializer.doActions("sweep","dropdown",l),z()}};a.performSweepAction=function(e){var t,a,s,i=[],l=[],n=zmUtil.getSelectedMails();a=(n=n[0].concat(n[1])).length;var o;for(t=0;t<a;t++)(s=zmList.getMailObj(n[t]).F)&&(-1!==(o=(o=s).replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"')).indexOf("<")&&(o=o.substring(o.lastIndexOf("<")+1,o.lastIndexOf(">"))),s=o=o.trim(),-1===i.indexOf(s)&&(i.push(s),l.push({msgId:n[t],emailId:s})));0===i.length?zmUtil.succErrMsg("i",u.sweep.selone):function(e,t){var a,s,i,l,n="msi-check";if("zm_Container"===zmTab.currentTab)if(zmUtil.isFolderId(t)){var o=zmInit.findFolName(t);i=u.sweep.title+" - "+o,l=zmText.applyArgs(u.sweep.sweepmsg,{foldername:o})}else i=u.sweep.titleAllFol,l=u.sweep.acrossFoler;5<e.length&&(n="msi-uncheck");var m=zdom("ul",{className:"zm_formArea zmListReset"},zdom("li",null,l));for(s=0;s<e.length;s++)m.appendChild(zdom("li",{className:"senderid"},zdom("i",{className:n,"data-msg":e[s].msgId,"data-value":e[s].emailId}),zdom("label",null,e[s].emailId)));a=zdom("div",{id:"sweeppopup",style:{display:"none"}},m);var d=(a=$.e(a)).find(".action_type"),c=a.find(".senderid");c.off("click").on("click",function(e){var t=e.srcElement||e.target;(t=$(t)).length&&((t=t.closest("i").length?t.closest("i"):t.closest("li").find("i")).hasClass("msi-check")?t.removeClass().addClass("msi-uncheck"):t.hasClass("msi-uncheck")&&t.removeClass().addClass("msi-check"))}),d.off("click").on("click",function(e){var t=e.srcElement||e.target;(t=$(t)).length&&((t=t.closest("i").length?t.closest("i"):t.prev()).hasClass("msi-option")||t.hasClass("msi-unoption"))&&(d.find("i").removeClass().addClass("msi-unoption"),t.removeClass().addClass("msi-option"))}),$("body").append(a);var r={title:i,style:{width:"500px"},buttons:[{txt:p.common.delete,selected:!1,callback:function(){f(d,c,"delete")}},{isCancel:!0,txt:p.common.cancel,callback:function(){z()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){z()}};zmInit.excludedFolders("archive",t)||r.buttons.unshift({txt:p.common.archive,selected:!1,callback:function(){f(d,c,"archive")}}),zmsDialog.create("sweeppopup",r)}(l,e)}}(),function(){var e=zmail.Core.Namespaces,g=zmText.get("mail").listing,v=e.create("zmail.Listing.Handlers.Integrations");v.associateDialog=function(i){var e,t,a,s,l,n,o,m=i.msgId,d=zmList.isRMOBJ(m),c={text:g.mailAssociates.titleReminder,selected:!0,tabName:"watch",onClk:function(e){zmWatch.listDialog(i,e)},buttons:[{text:g.mailAssociates.updateReminder,onClk:function(e){var t=i.msgId,a=e.getButtonContainer().find("span").eq(0);a.attr("id","zmWatch_save_"+t),zmWatch.addWatch(t,a)}}]},r=function(){$.unsubscribe("zm/closeAllOpenDialog",l)},u=zmList.getMailObj(i.msgId);if((32|u.MA)===u.MA){var p=function(e,t){return{mailId:i.msgId,mountingElem:e,listParam:{showHeader:!1,dialog:t}}};e={text:g.mailAssociates.titleTask,hideCloseButton:!0,tabName:"task",onClk:function(e){e.showLoadingBand("task");var t=e.getCenterElem("task"),a=p(t,e);a.taskPreCallback=function(){e.removeLoadingBand("task"),e.hideButtons("task")},v.taskAssociates(i.msgId,a)},icons:[{iconClass:"msi-add",selected:!0,text:g.mailAssociates.addTask,onClk:function(a){var s=a.getCenterElem("task");zmUtil.loadTask({action:"addAsTask",addparams:{msgid:i.msgId,accid:zmail.accId,senderid:u.F},groupId:zmail.zuid,tasks:{SUMMARY:u.SM,TITLE:u.SB}},function(t){a.getCenterElem("task").html(t.$el),t.setHeightforEle(),a.replaceButtons([{text:g.mailAssociates.add,onClk:function(){var e=p(s,a);t.addTask(v.taskAssociates.bind(v,i.msgId,e))}},{text:g.mailAssociates.cancel,onClk:function(){var e=p(s,a);v.taskAssociates(i.msgId,e)},attr:{"data-val":"Cancel"}}],"task")}),a.showButtons("task")}}]}}(64|u.MA)===u.MA&&(t={text:g.mailAssociates.titleNotes,hideCloseButton:!0,tabName:"notes",onClk:function(t){t.showLoadingBand("notes"),n=function(){t.removeLoadingBand("notes"),t.hideButtons("notes")},o=function(e){t.configOption.onClose=function(){r(),ReactDOM.unmountComponentAtNode(t.getCenterElem("notes")[0])}},v.notesAssociates(i.msgId,{mountingElem:t.getCenterElem("notes"),preCallback:n,postCallback:o})},icons:[{iconClass:"msi-add",selected:!0,text:g.mailAssociates.addNotes,onClk:function(e){var t={addparams:{msgid:i.msgId,accid:zmail.accId,senderid:u.F}};zmUtil.loadNotes("popup",t),e.showButtons("notes")}}]});(4|u.MA)===u.MA&&(a={text:zmText.applyArgs(g.mailAssociates.titleProjects,{companyName:zmail.globalI18N.companyName}),tabName:"projectsEntity",hideCloseButton:!0,onClk:function(e){e.showLoadingBand("projectsEntity"),zmUtil.loadProjects(function(){e.removeLoadingBand("projectsEntity"),zmail.projectsInteg.util.listProjectsEntities(i.msgId,e.getCenterElem("projectsEntity"))})}}),u.MSGREL&&-1<u.MSGREL.indexOf("1")&&(s={text:g.mailAssociates.titleEvent,tabName:"eventsEntity",hideCloseButton:!0,onClk:function(e){e.showLoadingBand("eventsEntity"),zmUtil.loadEvents(function(){e.removeLoadingBand("eventsEntity"),zmail.eventInteg.util.listEvents(i.msgId,e.getCenterElem("eventsEntity"),e)})},icons:[{iconClass:"msi-add",selected:!0,text:g.mailAssociates.addEvent,onClk:function(e){zmUtil.loadEvents(function(){zmail.eventInteg.util.addEvent(i.msgId,function(){e.getCenterElem("eventsEntity").html(""),s.onClk(e)})})}}]});var z={tabs:[]};d&&z.tabs.push(c),e&&z.tabs.push(e),z.onClose=function(){r(),e&&zmUtil.requireTaskModule("taskMail").done(function(){zmTask.Integrations.Mail.unsubscribeTaskListeners()})},z.ignoreMouseDown=!0,(64|u.MA)===u.MA&&z.tabs.push(t),(4|u.MA)===u.MA&&z.tabs.push(a),s&&z.tabs.push(s),d||(z.tabs[0].selected=!0);var f=zmsDialog.createTabPopupDialog(z);l=function(){f.close()},$.subscribe("zm/closeAllOpenDialog",l)},v.taskAssociates=function(e,t){var a={taction:"getTasksAssociatedMail",msgid:e,accid:zmail.accId,streamsView:!0},s=$.extend(!0,{},t);zmAjq.XHR({u:zmail.conPath+"/getTasks.do",t:"POST",fn:v.showTaskAssociates,p:a,ep:s})},v.notesAssociates=function(e,t){var a={mode:"getMailNotes",messageId:e,accid:zmail.accId,streamsView:"Notes"},s=$.extend(!0,{},t);s.mailId=e,s.accId=zmail.defAccId,zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:v.showNotesAssociates,p:a,ep:s})},v.showNotesAssociates=function(e,t){try{t.preCallback();var a={id:"mailassociated",msgid:t.mailId,accid:t.accId,senderid:zmList.getMailObj(t.mailId).F},s=t.listParam;zmUtil.loadNotes("notelist",{data:e,extraparams:{options:s,listInfo:a},mountingElem:t.mountingElem,postCallback:t.postCallback})}catch(e){zmUtil.debugLog(e)}},v.showTaskAssociates=function(e,t){try{var a="";t.preCallBk&&t.preCallBk(),t.listParam&&t.listParam.dialog&&(t.listParam.dialog.removeLoadingBand("task"),t.listParam.dialog.hideButtons("task")),zmUtil.requireTaskModule("taskMail").done(function(){a=zmTask.Integrations.Mail.generateTaskList(e,t),t.mountingElem&&(t.mountingElem.empty(),t.mountingElem.append(a))}),t.postCallBk&&t.postCallBk(a)}catch(e){zmUtil.debugLog(e)}}}();