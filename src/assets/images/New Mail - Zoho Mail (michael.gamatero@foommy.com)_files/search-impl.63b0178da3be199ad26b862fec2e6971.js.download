"use strict";!function(e){var n,a,i,r,s,l,t=zmail.Core.Namespaces.create("zmail.Search.Utils.CommonUtil");n={Subject:{lhs:"Subject"},Sender:{lhs:"Sender"},"To/Cc":{lhs:"to/cc"},Content:{lhs:"content"},"Attachment Name":{lhs:"Attachment Name"},"Attachment Content":{lhs:"Attachment Content"},"Entire Message":{lhs:"entire message"},Has:{lhs:"entire message"}},a={"Has Attachment":{flagName:"hasAtt",value:"1"},"Has Flag":{flagName:"hasFlg",value:"1"},unread:{flagName:"unread",value:"1"},responseFilter:{flagName:"resp",value:"1/0"},conversation:{flagName:"thd",value:"1"}},i=function(e){var t=[];if(_(e).each(function(e){"Folder"===e.name&&t.push(e.value)}),t.length)return{folId:t}},r=function(e){var t=[];if(_(e).each(function(e){"Tag"===e.name&&t.push(e.value)}),t.length)return{labId:t}},s=function(e){var t={};return _(e).each(function(e){e.name in a&&(t[a[e.name].flagName]=e.value)}),t},l=function(e){var t=new msSearchCollection,a=[];return _(e).each(function(e){e.name in n&&a.push({lhs:n[e.name].lhs,value:e.value,contains:!0})}),t.searchQueryArr=a,{SearchStr:t.getSearchQueryFromArr()}},t.mailQueryConverter=function(e){var t={accId:zmail.accId};return _.extend(t,s(e),l(e),i(e),r(e))}}(),function(e){var t,n,a=zmail.Core.Namespaces.create("zmail.Search.Utils.CommonUtil");t=a,n=zmail.Utils.DOM,t.genereateMailRow=function(e){_.isArray(e)||(e=[e]);var a=n.element(document.createDocumentFragment());return _(e).each(function(e){var t=null;t=n.element(zdom("div",{style:{borderBottomStyle:"dotted"}},zdom("span",null,"From: "," + ",e.F),zdom("br",null),zdom("strong",null,e.SB),zdom("span",null,e.SM))),n.mount(t,a)}),a}}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator").newType(e.ContactFilter,{className:"SenderFilter",name:t("zmText").get("search-impl","commonfilter.sender"),description:t("zmText").get("search-impl","commonfilter.senderdesc"),multipleInstance:!1});e.SenderFilter=a}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,a){var t=a("zmail.Search.Utils.TypeCreator"),n=a("zmail.ValueTypeInferrer.TYPES"),s=a("zmail.ContactBook"),i=zmText.get("search-impl"),r=t.newType(e.ContactFilter,{className:"GroupFilter",name:i.commonfilter.ingrp,description:i.commondesc.ingrp,valueType:n.Group.name,defaultValue:function(){var e=a("zmStreamsApp.events.getCurrentGroupId");if(e){var t=e();if(s.isGroup(t))return s.getGroups(t)[0]}},values:function(e){e=(e||"").toLowerCase();var t,a=s.getGroups(e,{includeGroupHome:!0,includeAllGroups:!0,containsSearch:!0});zmAppLoader.load("streamsApp").then(function(){t=zmStreamsApp.events.getCurrentGroupId()});var n,i=_.pluck(a,"attrs");if(s.isGroup(t)){for(n=0;n<i.length&&t!==i[n].id;n++);var r=a[n];a.splice(n,1),a.splice(0,0,r)}return a},restrictedToValues:!0,multipleInstance:!1,filterProps:["name","eid"],getValue:function(){var e=this.value||{};return s.isGroup(e)?e.attrs.name:""},autofillText:function(e,t){return s.isGroup(e)?e.get("name"):""},validate:function(e){if(s.isGroup(e))return!0}});e.GroupFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=zmText.get("search-impl"),r=a.newType(e.BaseFilter,{className:"EntityFilter",name:i.streamsFilter.filterby,description:i.streamsdesc.filterby,value:"",valueType:n.EntityType.name,values:["emails","notes","tasks","events","messages","bookmarks"],multipleInstance:!1,restrictedToValues:!0,removeDependentFilters:[]});e.EntityFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl","attachment"),i=a.newType(e.StringFilter,{className:"AttachmentContentFilter",name:n.filter.contains,description:n.description.contains,multipleInstance:!1});e.AttachmentContentFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=zmText.get("search-impl","attachment"),r=a.newType(e.StringFilter,{className:"AttachmentTypeFilter",name:i.filter.filetype,description:i.description.filetype,value:"",multipleInstance:!1,values:n.AttachmentType.values,valueType:n.AttachmentType.name});e.AttachmentTypeFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl","attachment"),i=a.newType(e.StringFilter,{className:"AttachmentNameFilter",name:n.filter.attachmentname,description:n.description.attachmentname,multipleInstance:!1});e.AttachmentNameFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl","attachment"),i=a.newType(e.SenderFilter,{className:"AttachmentSenderFilter",name:n.filter.from,description:n.description.from,multipleInstance:!1});e.AttachmentSenderFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=a.newType(e.StringFilter,{className:"AttachmentDocTypeFilter",name:t("zmText").get("search-impl","attachment.filter.doctype"),description:t("zmText").get("search-impl","attachment.description.doctype"),value:"",multipleInstance:!1,values:n.AttachmentDocType.values,valueType:n.AttachmentDocType.name});e.AttachmentDocTypeFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=a.newType(e.EntityFilter,{className:"AttachmentEntityFilter",name:t("zmText").get("search-impl","attachment.filter.entity"),description:t("zmText").get("search-impl","attachment.description.entity"),autofillNotAfter:[{className:"InMail"}],value:"",values:n.AttachmentEntityFilter.values,valueType:n.AttachmentEntityFilter.name});e.AttachmentEntityFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl","attachment");e.AttachmentGroupFilter=a.newType(e.GroupFilter,{className:"AttachmentGroupFilter",name:n.filter.ingroup,description:n.description.ingroup,autofillNotAfter:[{className:"InMail"}],multipleInstance:!1})}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=function(e){this.text=e.text||"",this.val={start:e.start||0,end:e.end||0}},i=function(e){return e.convertToKB&&(e.start*=1024,e.end*=1024),new n(e)};e.AttachmentSizeFilter=a.newType(e.BaseFilter,{className:"AttachmentSizeFilter",name:t("zmText").get("search-impl","attachment.filter.size"),description:t("zmText").get("search-impl","attachment.description.size"),multipleInstance:!1,value:"",values:function(){return function(){var e=window.parseInt(zmUtil.sizeConv(zmail.maxAttSz)),t=1,a=5,n=[];n.push(i({text:"Lesser than 1 MB",start:1,end:1023}));for(;a<e;)n.push(i({text:t+" to "+a+" MB",start:t,end:a,convertToKB:!0})),t=a+1,a+=5;return t-=1,n.push(i({text:"greater than "+t+" MB",start:1024*t,end:102400})),n}()},getValue:function(){var e=this.value||{};if(e instanceof n)return e.text},autofillText:function(e,t){return e instanceof n?e.text:""},validate:function(e){return e instanceof n}})}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=zmText.get("search-impl"),r=a.newType(e.StringFilter,{className:"FolderFilter",name:i.mailfilter.folder,description:i.maildesc.folder,valueType:n.Folder.name,filterValues:!1,defaultValue:function(){var e,t,a,n=zmfolAction.getMailFolderPaths(),i=zmInit.getListingDetObj()&&zmInit.getListingDetObj().fId;if(i)for(e=0;e<n.length;e++)if((t=n[e])&&t.id===i){a=t;break}return a},autofillNotAfter:[{className:"ShareFolFilter"}],values:function(t){t=(t||"").toLowerCase();var e,a,n=$.extend(!0,[],zmfolAction.getMailFolderPaths()),i=zmInit.getListingDetObj()&&zmInit.getListingDetObj().fId;if(i&&i!==n[0].id)for(e=1;e<n.length;e++)if((a=n[e])&&a.id===i){n.splice(e,1),n.unshift(a);break}return n.filter(function(e){return-1!==e.path.toLowerCase().indexOf(t)})},validate:function(e){if(!_.isObject(e))return!1;var t,a=["id","name","path"];for(t in a)if(!_.has(e,a[t]))return!1;return!0},restrictedToValues:!0,multipleInstance:!1,filterProps:["path"],getValue:function(){var e=this.value||{};return e.path||""},autofillText:function(e){return e.path}});e.FolderFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=a.newType(e.BaseFilter,{className:"TagFilter",name:t("zmText").get("search-impl","commonfilter.tag"),description:t("zmText").get("search-impl","commonfilter.hasatag"),valueType:n.Tag.name,values:function(){var e=t("zmail.Search.Utils.CommonUtil.appUtil");return e.getTagsInOrder(zmail.zohoAccLabInfo)},restrictedToValues:!0,multipleInstance:!1,filterProps:["label"],getValue:function(){var e=this.value||{};return e.label||""},autofillText:function(e){return e.label}});e.TagFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator").newType(e.ContactFilter,{className:"HasFilter",name:"contains"});e.HasFilter=a}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(a,e){var t=e("_"),n=e("zmail.Search.Utils.TypeCreator"),i=e("zmail.ContactBook"),r=e("zmail.ValueTypeInferrer.TYPES"),s=n.newType(a.ContactFilter,{className:"ContactGroupFilter",name:"contact-group",valueType:r.Contact.name,validateValueTpe:!0,restrictedToValues:!0,multipleInstance:!1,filterValues:!1,values:function(e){return t.isEmpty(e)?i.getMostUsedContacts():i.get({str:e,includeAllGroups:!0,type:"org"})},getValue:function(){var e=this.value||{};return i.isContact(e)?e.attrs.fn||e.name:i.isGroup(e)?e.attrs.name:""},autofillText:function(e,t){return i.isGroup(e)?e.get("name"):a.ContactFilter.autofillText(e,t)},validate:function(e){return i.isContact(e)||i.isGroup(e)}});a.ContactGroupFilter=s}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=a.newType(e.BaseFilter,{className:"MailReminderFilter",name:n.mailfilter.remindertype,description:n.maildesc.remindertype,values:function(){var e=[{name:n.mailfilter.reminder_nocondition,value:"1"},{name:n.mailfilter.reminder_noreply,value:"2"},{name:n.mailfilter.reminder_everyreply,value:"3"},{name:n.mailfilter.reminder_executed,value:"4"}];return e},filterProps:["name"],getValue:function(){var e=this.value||{};return void 0===e.name?"":e.name},autofillText:function(e){return e.name},restrictedToValues:!0,multipleInstance:!1,validate:function(){var e=this.value||{};return void 0!==e.name},dependedOn:["EntireMessage","Sender","ToOrCc","Subject","EmailContent","AttachmentName","AttachmentContent","AttachmentType","To","Cc","EntireMessageExclude","SenderExclude","ToOrCcExclude","SubjectExclude","EmailContentExclude","AttachmentNameExclude","AttachmentContentExclude","ToExclude","CcExclude"]});e.MailReminderFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=[{severity:"High",const:2},{severity:"Medium",const:3},{severity:"Low",const:4}],r=a.newType(e.BaseFilter,{className:"MailPriorityFilter",name:n.mailfilter.priority,description:n.maildesc.priority,multipleInstance:!1,values:function(){return i},restrictedToValues:!0,filterProps:["severity"],getValue:function(){var e=this.value||{};return e.severity||""},autofillText:function(e){return e.severity},validate:function(){var e=this.value||{};return["High","Medium","Low"].includes(e.severity)},dependedOn:["EntireMessage","Sender","SentBy","ToOrCc","Subject","EmailContent","AttachmentName","AttachmentContent","AttachmentType","To","Cc","EntireMessageExclude","SenderExclude","ToOrCcExclude","SubjectExclude","EmailContentExclude","AttachmentNameExclude","AttachmentContentExclude","ToExclude","CcExclude"]});e.MailPriorityFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=zmText.get("search-impl"),r=function(e){var t;return-1!==(e=e.replace(/ /gi,"").toLowerCase()).indexOf("k")?t=e.substring(0,e.indexOf("k")):-1!==e.indexOf("m")?(t=parseInt(e.substring(0,e.indexOf("m"))),(t*=1024).toString()):-1!==e.indexOf("b")?(t=parseInt(e.substring(0,e.indexOf("b"))),(t/=1024).toString()):(t=1024*parseInt(e)).toString()},s=a.newType(e.BaseFilter,{className:"MailSizeFilter",name:i.mailfilter.size,description:i.maildesc.size,valueType:n.MailSize.name,findValue:r,getValue:function(){var e=this.value||{};return"string"==typeof e?e=r(e):""},restrictedToValues:!1,multipleInstance:!1,validate:function(e){if("string"!=typeof(e=e||this.value||{}))return!1;e=e.replace(/ /gi,"");var t=new RegExp("^[0-9]+(k?|m?)b?$","i");return t.test(e)}});e.MailSizeFilter=s}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=a.newType(e.BaseFilter,{className:"MailFlagFilter",name:n.mailfilter.flagAs,description:n.maildesc.flagAs,values:function(){return[{name:"Info",value:1},{name:"Important",value:2},{name:"Follow-up",value:3}]},filterProps:["name"],getValue:function(){var e=this.value||{};return void 0===e.name?"":e.name},autofillText:function(e){return e.name},restrictedToValues:!0,multipleInstance:!1,validate:function(){var e=this.value||{};return void 0!==e.name}});e.MailFlagFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=zmText.get("search-impl"),r=a.newType(e.ContactFilter,{className:"EntireMessage",name:i.commonfilter.contains,description:i.maildesc.contains,valueType:n.String.name,removeDependentFilters:["HasAttachmentFilter","HasFlagFilter","HasReplyFilter","MailDateFilter","MailFromDateFilter","MailToDateFilter","MailReminderFilter","HasMailReminderFilter","ForwardFilter","HasInlineAttachmentFilter","MailPriorityFilter","FromSizeFilter","ToSizeFilter"]});e.HasMailFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),r=t("zmail.ContactBook"),s=t("zmail.Search.Models.Filters.ContactGroupFilter"),i=zmText.get("search-impl"),l=a.newType(e.StringFilter,{className:"HasStreamsFilter",name:i.commonfilter.contains,valueType:n.String.name,description:i.commondesc.contains,values:function(e){if(""!==e){if(e.startsWith("@")){var t=e.split("@");return""!==(t=t[1]?t[1]:"")?s.values(t):r.getMostUsedContacts()}if(0!==e.indexOf("#"))return s.values(e);e=e.substring(1,e.length);var a=zmStreamsApp.GroupApp.fetchHashTags();if(""===e)return a.map(function(e){return"#"+e.name});for(var n=[],i=0;i<a.length;i++)a[i].name.toLowerCase().startsWith(e)&&n.push(a[i].name);return n}},validate:function(e){if(!e&&(this.nullableOnly||this.nullable))return!0;if(this.restrictedToValues){var t=this.getValues();if(_.isArray(t))return _(t).contains(e)}else if(this.regexp instanceof RegExp)return this.regex.test(e);return Boolean(e)},filterValues:!1,autofillDOM:function(e){if(!_.isString(e))return s.autofillDOM(e)},autofillText:function(e){return _.isString(e)?e:s.autofillText(e)},getValue:function(){var e=this.value||{};return _.isString(e)?e:zmail.ContactBook.isGroup(e)?e.attrs.name:_.isFunction(e.name)?e.attrs&&e.attrs.fn||_.isFunction(e.name)&&e.name():e.name}});e.HasStreamsFilter=l}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator").newType(e.BaseFilter,{className:"BooleanFilter",name:"boolean",nullableOnly:!0,multipleInstance:!1});e.BooleanFilter=a}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl","attachment");e.InStreams=a.newType(e.BooleanFilter,{className:"InStreams",name:n.filter.instreams,description:n.description.instreams,autofillNotAfter:[{className:"InMail"}],multipleInstance:!1}),e.InMail=a.newType(e.BooleanFilter,{className:"InMail",name:"in mail",description:"search in personal mail attachment",autofillNotAfter:[{className:e.AttachmentGroupFilter.className},{className:e.InStreams.className},{className:e.AttachmentEntityFilter.className}],multipleInstance:!1})}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=zmText.get("search-impl"),r=a.newType(e.StringFilter,{className:"HashtagFilter",name:i.commonfilter.hashtag,description:i.commondesc.hashtag,valueType:n.HashTag.name,filterValues:!1,values:function(e){var t,a=zmStreamsApp.GroupApp.fetchHashTags(),n=[];if(e&&""!==e&&"#"===e.charAt(0)&&(e=e.substring(1,e.length)),!e||""===e)return a;for(t=0;t<a.length;t++)a[t].name.toLowerCase().startsWith(e)&&n.push(a[t]);return n},validate:function(e){if(!e&&(this.nullableOnly||this.nullable))return!0;if(this.restrictedToValues){var t=this.getValues();if(_.isArray(t))return _(t).contains(e)}else if(this.regexp instanceof RegExp)return this.regex.test(e);return Boolean(e)},multipleInstance:!1,filterProps:["name"],getValue:function(){var e=this.value||{};return e.name||""},autofillText:function(e){return e.name}});e.HashtagFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=[{severity:"High",const:2},{severity:"Medium",const:3},{severity:"Low",const:4}],r=a.newType(e.BaseFilter,{className:"TaskPriorityFilter",name:n.taskfilter.priority,description:n.taskdesc.priority,multipleInstance:!1,values:function(){return i},restrictedToValues:!0,filterProps:["severity"],getValue:function(){var e=this.value||{};return e.severity||""},autofillText:function(e){return e.severity}});e.TaskPriorityFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var n,a=t("zmail.Search.Utils.TypeCreator"),i=zmText.get("search-impl"),r=a.newType(e.BaseFilter,{className:"TaskProjectFilter",name:i.taskfilter.project,description:i.taskdesc.project,autofillOnlyAfter:[{className:"GroupFilter"}],multipleInstance:!1,values:function(){var e={};if(zmail.Search.Environment.has("GroupFilter")){var t=zmail.Search.Environment.get("GroupFilter")[0].toJSON();if(t&&t.obj){var a=n[t.obj.id];a&&0<Object.keys(a).length&&(e=_.toArray(a))}}return e},restrictedToValues:!0,filterProps:["categoryName"],getValue:function(){var e=this.value||{};return e.categoryName||""},autofillText:function(e){return e.categoryName},afterInit:function(){zmUtil.requireTaskModule("taskUtil").done(function(e){n=e.Categories()})}});e.TaskProjectFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=a.newType(e.BaseFilter,{className:"TaskStatusFilter",name:n.taskfilter.status,description:n.taskdesc.status,multipleInstance:!1,values:function(){var t=[{status:n.taskfilter.openStatus,const:2},{status:n.taskfilter.closedStatus,const:3}];if(zmail.Search.Environment.has("GroupFilter")){var e=zmail.Search.Environment.get("GroupFilter")[0].toJSON();if(e&&e.obj){var a=zmTask.Util.getGroupStatus(e.obj.id);_.each(a,function(e){t.push({status:e.statusName,const:Number(e.statusId)})})}}return t},restrictedToValues:!0,filterProps:["status"],getValue:function(){var e=this.value||{};return e.status||""},autofillText:function(e){return e.status},validate:function(e){if(e){if(2===e.const||3===e.const)return!0;if(zmail.Search.Environment.has("GroupFilter")){var t=zmail.Search.Environment.get("GroupFilter")[0].toJSON();if(t&&t.obj)return zmTask.Util.isGroupStatus(t.obj.id,e.const)}return!1}}});e.TaskStatusFilter=i}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=e("zmail.Search.Utils.TypeCreator"),a=zmText.get("search-impl"),r=this.ContactFilter;this.TaskAssigneeFilter=t.newType(r,{name:a.taskfilter.assignee,className:"TaskAssigneeFilter",description:a.taskdesc.assignee,autofillNotAfter:[{className:"HasNoAssignee"}],multipleInstance:!1,values:function(e){var t=$.Deferred(),a=r.values(e),n=zmail.zuid;if(zmail.Search.Environment.has("GroupFilter")){var i=zmail.Search.Environment.get("GroupFilter")[0].toJSON();n=i.obj.get("id"),zmail.ContactBook.get({groupid:n,str:e}).done(function(e){t.resolve(e)})}else $.when(a).then(function(e){t.resolve(e)});return t.promise()},getValue:function(){var e=this.value||"";return _.isString(e)?e:e.name},autofillDOM:function(e){return r.autofillDOM(e)}})}.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=[{repeatType:"Daily",const:1},{repeatType:"Weekly",const:2},{repeatType:"Monthly",const:3},{repeatType:"Yearly",const:4}],r=a.newType(e.BaseFilter,{className:"TaskRecurringFilter",name:n.taskfilter.recurring,description:n.taskdesc.recurring,multipleInstance:!1,values:function(){return i},restrictedToValues:!0,filterProps:["repeatType"],getValue:function(){var e=this.value||{};return e.repeatType||""},autofillText:function(e){return e.repeatType}});e.TaskRecurringFilter=r}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=t("zmail.ValueTypeInferrer.TYPES"),r=e.DateFilter,s=a.newType(r,{name:n.taskfilter.completeddate,className:"TaskCompletedDateFilter",description:n.taskdesc.completeddate,multipleInstance:!1,valueType:i.Date.name,autofillText:function(e){return e.display}});e.TaskCompletedDateFilter=s}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=t("zmail.ValueTypeInferrer.TYPES"),r=e.DateFilter,s=a.newType(r,{name:n.taskfilter.duedate,className:"TaskDueDateFilter",description:n.taskdesc.duedate,multipleInstance:!1,valueType:i.Date.name,autofillText:function(e){return e.display}});e.TaskDueDateFilter=s}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl"),i=n.notefilter,r=n.notedesc,s=a.newType(e.BaseFilter,{className:"NoteBookFilter",name:i.notebook,description:r.notebook,validateOnSet:!0,validate:function(e){return!_.isString(e)&&_.isObject(e)&&e.hasOwnProperty("id")&&e.hasOwnProperty("name")&&e.hasOwnProperty("display_text")},values:function(e){var t;if(zmail.Search.Environment.has("GroupFilter")){var a=zmail.Search.Environment.get("GroupFilter")[0].toJSON();t=a.obj.id}else t=zmail.zuid;return zmUtil.loadNoteCategories(t)},restrictedToValues:!0,multipleInstance:!1,filterProps:["display_text"],getValue:function(){var e=this.value||{};return e.display_text},autofillText:function(e){return e.display_text}});e.NoteBookFilter=s}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=t("zmail.ValueTypeInferrer.TYPES"),i=t("zmUtil"),r=zmText.get("search-impl"),s=r.notefilter,l=r.notedesc,o=a.newType(e.BaseFilter,{className:"NoteColorFilter",name:s.notecolor,valueType:n.NoteColor.name,values:function(){return i.noteColorArray},restrictedToValues:!0,multipleInstance:!1,filterProps:["dispname"],description:l.notecolor,getValue:function(){var e=this.value||{};return e.dispname},autofillText:function(e){return e.dispname}});e.NoteColorFilter=o}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator").newType(e.StringFilter,{className:"NoteDescriptionFilter",name:t("zmText").get("search-impl","notefilter.description"),description:t("zmText").get("search-impl","notedesc.notedescription")});e.NoteDescriptionFilter=a}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator").newType(e.StringFilter,{className:"NoteTitleFilter",name:t("zmText").get("search-impl","notefilter.notetitle"),description:t("zmText").get("search-impl","notefilter.notetitledesc")});e.NoteTitleFilter=a}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t=zmail.Core.Namespaces,a=t.create("zmail.Search.Models.Filters");(function(e,t){var a=t("zmail.Search.Utils.TypeCreator"),n=zmText.get("search-impl","bookmark");e.LinkSearchKey=a.newType(e.HasStreamsFilter,{name:n.filter.contains,description:n.description.contains}),e.LinkGroup=a.newType(e.GroupFilter,{multipleInstance:!1}),e.LinkTitle=a.newType(e.StringFilter,{name:n.filter.ingroup,description:n.description.ingroup,multipleInstance:!1}),e.LinkCollection=a.newType(e.BaseFilter,{className:"LinkCollection",name:n.filter.incollection,description:n.description.incollection,values:function(){var i,r=this,s=$.Deferred();return zmUtil.requireLinkModule().then(function(e){var t=e.isProjLoaded,a=e.getCollectionByGroupId,n=e.getGroupCategories;r.getGroupCategories=n,t().then(function(){if(zmail.Search.Environment.has("GroupFilter")){var e=zmail.Search.Environment.get("GroupFilter")[0].toJSON();i=e.obj?e.obj.id:zmail.zuid}else i=zmail.zuid;a(i).then(s.resolve)})}),s.promise()},validate:function(e){var t,a,n=[],i=-1;return!(!e||e.constructor!==Object||!e.catid)&&(a=zmail.Search.Environment.has("GroupFilter")?(t=zmail.Search.Environment.get("GroupFilter")[0].toJSON()).obj?t.obj.id:zmail.zuid:zmail.zuid,this.getGroupCategories&&(n=this.getGroupCategories(a),i=n.indexOf(_.findWhere(n,{catid:e.catid}))),0<=i)},restrictedToValues:!1,multipleInstance:!1,filterProps:["catname"],getValue:function(){var e=this.value||{};return e.catname},autofillText:function(e){return e.catname}})}).call(a,a,function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var N={},t=zmText.get("search-impl"),a=t.commondesc,n=t.commonfilter,i=t.streamsFilter,r=t.streamsdesc,S=zmail.Search.Models.Filters,z=zmail.ContactBook.Models.Entity.Contact,s=zmail.Search.Utils.TypeCreator,k={all:"-1",emails:"1",notes:"2",tasks:"3",events:"4",messages:"6",bookmarks:"10"},w={isSharedEmail:2,isSentEmail:1};N.filterConstantsClass={HasInlineImage:"HasInlineImage",HasNoDueDate:"HasNoDueDate",HasNoAssignee:"HasNoAssignee",PostedBy:"PostedBy",AttachName:"AttachName",AttachContent:"AttachContent",Summary:"Summary",IsFavourite:"IsFavourite",commentText:"commentText",CommentedBy:"CommentedBy",Invited:"Invited",Mentioned:"Mentioned",HasAttachment:"HasAttachment",title:"title",to:"to",cc:"cc",isSharedEmail:"isSharedEmail",isSentEmail:"isSentEmail",isCreateMail:"isCreateMail",sender:"sender",HasRecurring:"HasRecurring",MailAssociatedTask:"MailAssociatedTask",archived:"archived",postLikedBy:"postLikedBy",commLikedBy:"commLikedBy",postLikeCount:"postLikeCount",commentCount:"commentCount",commLikeCount:"commLikeCount"},N.filterConstantsNames={HasInlineImage:i.hasimg,HasNoDueDate:i.duedt,HasRecurring:t.taskfilter.hasrecurring,HasNoAssignee:i.noassignee,PostedBy:i.posBy,AddedBy:"added by",CommentedBy:n.commby,Invited:n.invitee,Mentioned:n.mention,AttachName:n.attachname,AttachContent:n.attachcont,Summary:i.posText,IsFavourite:n.fav,commentText:n.commtext,HasAttachment:n.hasattach,title:i.title,to:i.to,cc:i.cc,isSharedEmail:"shared emails only",isSentEmail:"sent emails only",isCreateMail:i.frmemail,CreatedBy:"created by",sender:i.from,MailAssociatedTask:t.taskfilter.mailassociated,archived:n.archived,postLikedBy:i.postLikedBy,commLikedBy:i.commentLikedBy,postLikeCount:i.postLikeCount,commentCount:i.commentCount,commLikeCount:i.commentLikeCount},N.postedByFilter=s.newType(S.ContactFilter,{name:N.filterConstantsNames.PostedBy,className:N.filterConstantsClass.PostedBy,description:r.posBy,multipleInstance:!1,autofillText:function(e){return _.isString(e)?e:e.name},getValue:function(){var e=this.value||"";return _.isString(e)?e:(e=e.attrs).fn||e.name}}),N.mentionedFilter=s.newType(S.ContactGroupFilter,{name:N.filterConstantsNames.Mentioned,className:N.filterConstantsClass.Mentioned,description:a.mention}),N.inviteeFilter=s.newType(S.ContactGroupFilter,{name:N.filterConstantsNames.Invited,className:N.filterConstantsClass.Invited,description:a.invitee}),N.isArchivedFilter=s.newType(S.BooleanFilter,{name:N.filterConstantsNames.archived,className:N.filterConstantsClass.archived,multipleInstance:!1}),N.isFavouriteFilter=s.newType(S.BooleanFilter,{name:N.filterConstantsNames.IsFavourite,className:N.filterConstantsClass.IsFavourite,multipleInstance:!1}),N.titleFilter=s.newType(S.StringFilter,{name:N.filterConstantsNames.title,className:N.filterConstantsClass.title,multipleInstance:!1,description:r.title}),N.descriptionFilter=s.newType(S.StringFilter,{name:N.filterConstantsNames.Summary,className:N.filterConstantsClass.Summary,description:r.posText}),N.postSummaryFilter=s.newType(S.HasStreamsFilter,{name:N.filterConstantsNames.Summary,className:N.filterConstantsClass.Summary,description:r.posText}),N.postLikedBy=s.newType(S.ContactFilter,{name:N.filterConstantsNames.postLikedBy,className:N.filterConstantsClass.postLikedBy,description:r.postLikedBy,validateValueTpe:!0,values:function(e,t){if(!_.isEmpty(e))return zmail.ContactBook.get({str:e,type:"org"})},autofillText:function(e){return _.isString(e)?e:e.name},getValue:function(){var e=this.value||"";return _.isString(e)?e:(e=e.attrs).fn||e.name},validate:function(e){if(zmail.ContactBook.isContact(e))return!0},multipleInstance:!1}),N.commLikedBy=s.newType(S.ContactFilter,{name:N.filterConstantsNames.commLikedBy,className:N.filterConstantsClass.commLikedBy,description:r.commentLikedBy,validateValueTpe:!0,values:function(e,t){if(!_.isEmpty(e))return zmail.ContactBook.get({str:e,type:"org"})},autofillText:function(e){return _.isString(e)?e:e.name},getValue:function(){var e=this.value||"";return _.isString(e)?e:(e=e.attrs).fn||e.name},validate:function(e){if(zmail.ContactBook.isContact(e))return!0},multipleInstance:!1});var l=s.newType(S.StringFilter,{value:"",multipleInstance:!1,values:function(){return[{text:"< 25",start:1,end:25},{text:"25 - 50",start:25,end:50},{text:"50 - 100",start:50,end:100},{text:"100 - 150",start:100,end:150},{text:"> 150",start:150,end:250}]},getValue:function(){var e=this.value||{};return e.text||""},autofillText:function(e,t){return e.text},validate:function(e){return this.regexp instanceof RegExp?this.regex.test(e):Boolean(e)}});N.postlikeCount=s.newType(l,{name:N.filterConstantsNames.postLikeCount,className:N.filterConstantsClass.postLikeCount,description:r.postLikeCount}),N.commentCount=s.newType(l,{name:N.filterConstantsNames.commentCount,className:N.filterConstantsClass.commentCount,description:r.commentCount}),N.commlikeCount=s.newType(l,{name:N.filterConstantsNames.commLikeCount,className:N.filterConstantsClass.commLikeCount,description:r.commentLikeCount}),N.TaskFilters=[S.TaskAssigneeFilter,S.TaskPriorityFilter,S.TaskProjectFilter,S.TaskStatusFilter,S.TaskRecurringFilter,S.TaskDueDateFilter,S.TaskCompletedDateFilter,s.newType(S.BooleanFilter,{name:t.taskfilter.mailassociated,className:N.filterConstantsClass.MailAssociatedTask,description:t.taskdesc.mailassociated,multipleInstance:!1}),s.newType(S.BooleanFilter,{name:N.filterConstantsNames.HasNoDueDate,className:N.filterConstantsClass.HasNoDueDate,multipleInstance:!1}),s.newType(S.BooleanFilter,{name:N.filterConstantsNames.HasRecurring,className:N.filterConstantsClass.HasRecurring,multipleInstance:!1}),s.newType(S.BooleanFilter,{name:N.filterConstantsNames.HasNoAssignee,className:N.filterConstantsClass.HasNoAssignee,multipleInstance:!1})],N.NoteFilters=[S.NoteBookFilter,S.NoteColorFilter,s.newType(S.BooleanFilter,{name:N.filterConstantsNames.HasInlineImage,className:N.filterConstantsClass.HasInlineImage,multipleInstance:!1}),s.newType(S.BooleanFilter,{name:N.filterConstantsNames.isCreateMail,className:N.filterConstantsClass.isCreateMail,multipleInstance:!1})],N.BookmarkFilters=[S.LinkCollection],N.MailFilters=[s.newType(S.ContactFilter,{name:N.filterConstantsNames.to,className:N.filterConstantsClass.to,description:r.to,restrictedToValues:!1,autofillNotAfter:[{className:S.EntityFilter.className,value:["messages","bookmarks","tasks","events","notes"]}],multipleInstance:!1}),s.newType(S.ContactFilter,{name:N.filterConstantsNames.cc,className:N.filterConstantsClass.cc,description:r.cc,restrictedToValues:!1,autofillNotAfter:[{className:S.EntityFilter.className,value:["messages","bookmarks","tasks","events","notes"]}],multipleInstance:!1}),s.newType(S.ContactFilter,{name:N.filterConstantsNames.sender,className:N.filterConstantsClass.sender,description:r.from,restrictedToValues:!1,autofillNotAfter:[{className:S.EntityFilter.className,value:["messages","bookmarks","tasks","events","notes"]}],multipleInstance:!1})],N.commentFilters=[s.newType(S.ContactFilter,{name:N.filterConstantsNames.CommentedBy,className:N.filterConstantsClass.CommentedBy,description:a.commby,validateValueTpe:!0,values:function(e,t){if(!_.isEmpty(e))return zmail.ContactBook.get({str:e,type:"org"})},autofillText:function(e){return _.isString(e)?e:e.name},getValue:function(){var e=this.value||"";return _.isString(e)?e:(e=e.attrs).fn||e.name},validate:function(e){if(zmail.ContactBook.isContact(e))return!0},multipleInstance:!1}),s.newType(S.HasStreamsFilter,{name:N.filterConstantsNames.commentText,className:N.filterConstantsClass.commentText,description:a.commtext})],N.attachmentFilters=[s.newType(S.StringFilter,{name:N.filterConstantsNames.AttachName,className:N.filterConstantsClass.AttachName,description:a.attachname}),s.newType(S.AttachmentTypeFilter,{name:n.attType,description:a.attType}),s.newType(S.StringFilter,{name:N.filterConstantsNames.AttachContent,className:N.filterConstantsClass.AttachContent,description:a.attachcont}),s.newType(S.BooleanFilter,{name:N.filterConstantsNames.HasAttachment,className:N.filterConstantsClass.HasAttachment,multipleInstance:!1})],N.dateFilters=[S.FromDateFilter,S.ToDateFilter];var x=function(e){return e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()};N.constructQueryParams=function(e,t,a){var n,i,r,s,l,o,c,m,u,p,d,h,f,F,g=N.filterConstantsClass,v=e.data,C={mode:"searchStreams",grid:"false",range:25,entityType:"-1",groupId:_zm.isStreamsEnabled()?"-1":zmail.zuid,streamsView:!0,actionType:"viewSelfData"};a.showNextPage&&e.paginate?(C.start=a.start+25,a.start=C.start):(C.start=0,a.start=0);for(var T=0;T<v.length;T++)switch((n=v[T]).className){case S.EntityFilter.className:C.entityType=k[n.value];break;case S.HashtagFilter.className:i=n.actualValue.name,r=i||n.actualValue,C.hashtag=r;break;case S.GroupFilter.className:C.groupId=n.actualValue.attrs.id,C.actionType=C.groupId!==zmail.zuid?"viewGroupData":"viewSelfData";break;case S.HasStreamsFilter.className:s=C.SearchStr,h=n.actualValue.attrs,F=h?h.eid||h.name:n.actualValue,C.SearchStr=s?s+" "+F:F;break;case g.PostedBy:if(h=n.actualValue.attrs){var y=zmail.ContactBook;d=h.zid&&y.isContact(n.actualValue)?h.zid:h.eid}else d=n.actualValue;C.postAuthor=d;break;case g.AttachName:l=C.attachname,C.attachname=l?l+" "+n.value:n.value;break;case g.AttachContent:o=C.attachContent,C.attachcontent=o?o+" "+n.value:n.value;break;case g.Summary:c=C.summary,C.summary=c?c+" "+n.value:n.value;break;case g.IsFavourite:C.favourited=!0;break;case g.archived:C.isarchived=!0;break;case g.commentText:m=C.comment,C.comment=m?m+" "+n.value:n.value;break;case S.TagFilter.className:C.labelId=n.actualValue.id;break;case g.CommentedBy:h=n.actualValue.attrs,f=h?h.zid?h.zid:h.eid:n.actualValue,C.commentAuthor=f;break;case g.Invited:u=n.actualValue instanceof z?n.actualValue.attrs.zid:n.actualValue.attrs.id,C.inviteeZuid=u;break;case g.Mentioned:u=n.actualValue instanceof z?n.actualValue.attrs.zid:n.actualValue.attrs.id,C.mentionZuid=u;break;case S.AttachmentTypeFilter.className:C.attachextn=n.value;break;case g.HasAttachment:C.hasAttach=!0;break;case S.TaskPriorityFilter.className:C.priority=n.actualValue.const;break;case S.TaskProjectFilter.className:C.folderId=n.actualValue.categoryId;break;case S.TaskStatusFilter.className:C.status=n.actualValue.const;break;case S.NoteBookFilter.className:C.folderId=n.actualValue.id;break;case S.NoteColorFilter.className:C.colour=n.actualValue.value;break;case g.HasNoAssignee:C.hasNoAssignee=!0;break;case g.HasNoDueDate:C.hasNoDuedt=!0;break;case g.HasRecurring:C.recurringTask=!0;break;case g.MailAssociatedTask:C.createdFromMail=!0;break;case S.TaskRecurringFilter.className:C.repeatType=n.actualValue.const;break;case S.TaskDueDateFilter.className:C.duedate=x(n.actualValue);break;case S.TaskCompletedDateFilter.className:C.completedDate=x(n.actualValue);break;case g.HasInlineImage:C.hasinline=!0;break;case S.FromDateFilter.className:C.fromDate=x(n.actualValue);break;case S.ToDateFilter.className:C.toDate=x(n.actualValue);break;case g.title:C.title=n.value;break;case g.to:p=n.actualValue&&n.actualValue.attrs?n.actualValue.attrs.eid:n.actualValue&&n.actualValue.eid?n.actualValue.eid:n.actualValue,C.toaddr=p;break;case g.cc:p=n.actualValue&&n.actualValue.attrs?n.actualValue.attrs.eid:n.actualValue&&n.actualValue.eid?n.actualValue.eid:n.actualValue,C.ccaddr=p;break;case g.sender:p=n.actualValue&&n.actualValue.attrs?n.actualValue.attrs.eid:n.actualValue&&n.actualValue.eid?n.actualValue.eid:n.actualValue,C.sender=p;break;case S.TaskAssigneeFilter.className:C.assignee=n.actualValue.id;break;case g.isCreateMail:C.createdFromMail=!0;break;case S.LinkCollection.className:C.folderId=n.actualValue.catid;break;case g.isSharedEmail:case g.isSentEmail:C.mailType=n.className===g.isSharedEmail?w.isSharedEmail:w.isSentEmail;break;case g.location:C.location=n.actualValue.LOC?n.actualValue.LOC:n.actualValue;break;case g.postLikedBy:u=n.actualValue instanceof z?n.actualValue.attrs.zid:n.actualValue.attrs.id,C.likedyBy=u;break;case g.commLikedBy:u=n.actualValue instanceof z?n.actualValue.attrs.zid:n.actualValue.attrs.id,C.commentLikedBy=u;break;case g.postLikeCount:C.fromLikes=n.actualValue.start,C.toLikes=n.actualValue.end;break;case g.commentCount:C.fromCommentsCount=n.actualValue.start,C.toCommentsCount=n.actualValue.end;break;case g.commLikeCount:C.fromCommentLikes=n.actualValue.start,C.toCommentLikes=n.actualValue.end}return C.SearchStr&&(C.SearchStr=encodeURIComponent(C.SearchStr)),"task"===t.contextID?(C.entityType=k.tasks,C.appView=!0):"notes"===t.contextID?(C.entityType=k.notes,C.appView=!0):"bookmarks"===t.contextID&&(C.entityType=k.bookmarks,C.appView=!0),C},N.getTagsInOrder=function(a){var n=[];return Object.keys(a).forEach(function(e){var t=a[e].se;t=void 0!==t?t:n.length,n[t]?n[t+1]?n.splice(t,0,a[e]):n[t+1]=a[e]:n[t]=a[e]}),n=n.filter(function(e){return void 0!==e})},e.appUtil=N}(zmail.Core.Namespaces.create("zmail.Search.Utils.CommonUtil")),function(){var e,o=zmail.Utils.DOM,c={},m=zmText.get("search-impl"),u=m.commondesc,p=m.commonfilter,d=m.streamsFilter,h=m.streamsdesc,f=zmail.Search.Models.Filters,F=zmail.Search.Utils.TypeCreator,t=zmail.Search.Models.Contexts,g=zmail.Search.Utils.CommonUtil.appUtil,v=g.filterConstantsClass,a=[v.to,v.cc,v.sender],n=[f.TaskAssigneeFilter.className,f.TaskPriorityFilter.className,f.TaskProjectFilter.className,f.TaskStatusFilter.className,f.TaskRecurringFilter.className,f.TaskDueDateFilter.className,f.TaskCompletedDateFilter.className,v.MailAssociatedTask,v.HasNoDueDate,v.HasNoAssignee,v.HasRecurring],r=[f.NoteBookFilter.className,f.NoteColorFilter.className,v.HasInlineImage,v.isCreateMail],s=[f.LinkCollection.className],l=[],C=g.postedByFilter,i=function(){var e={contextName:m.streamsContextName,contextID:"streams",contextIcon:"msi-streams",tabRegexp:/zmStreamsApp/,shortcutId:"streamsSearch",placeholder:m.streamsHolder,defaultFilterClass:f.HasStreamsFilter,filterClass:function(){var e,t=[],a=[],n=[],i=[],r=[],s=[],l="",o="";for(t.push(f.HasStreamsFilter,C,f.GroupFilter,g.mentionedFilter,f.EntityFilter),e=0;e<g.NoteFilters.length;e++){switch(o=l="",g.NoteFilters[e].className){case f.NoteBookFilter.className:l=d.notebook,o=h.notebook;break;case f.NoteColorFilter.className:l=d.color,o=h.color;break;case v.HasInlineImage:l=d.hasimg,o="";break;case v.isCreateMail:l=d.frmemail,o=""}n.push(F.newType(g.NoteFilters[e],{autofillNotAfter:[{className:f.EntityFilter.className,value:["messages","emails","tasks","events","bookmarks"]}],name:l,description:o}))}for(e=0;e<g.TaskFilters.length;e++){switch(s=[{className:f.EntityFilter.className,value:["messages","emails","bookmarks","events","notes"]}],r=[],o=l="",g.TaskFilters[e].className){case f.TaskProjectFilter.className:r.push({className:f.GroupFilter.className,value:_.toArray(zmail.ContactBook.get({includeAllGroups:!0,promise:!1}))}),l=d.proj,o=h.proj;break;case f.TaskAssigneeFilter.className:s.push({className:v.HasNoAssignee}),l=d.assignee,o=h.assignee;break;case v.HasNoAssignee:s.push({className:f.TaskAssigneeFilter.className}),l=d.noassignee,o="";break;case f.TaskPriorityFilter.className:l=d.priority,o=h.priority;break;case f.TaskStatusFilter.className:l=d.status,o=h.status;break;case v.HasNoDueDate:s.push({className:f.TaskDueDateFilter.className}),l=d.duedt,o="";break;case v.HasRecurring:l=m.taskfilter.hasrecurring,o="";break;case f.TaskRecurringFilter.className:l=f.TaskRecurringFilter.name,o=f.TaskRecurringFilter.description;break;case f.TaskDueDateFilter.className:s.push({className:v.HasNoDueDate}),l=f.TaskDueDateFilter.name,o=f.TaskDueDateFilter.description;break;case f.TaskCompletedDateFilter.className:l=f.TaskCompletedDateFilter.name,o=f.TaskCompletedDateFilter.description;break;case v.MailAssociatedTask:l=m.taskfilter.mailassociated,o=m.taskdesc.mailassociated}a.push(F.newType(g.TaskFilters[e],{autofillOnlyAfter:r,autofillNotAfter:s,name:l,description:o}))}for(e=0;e<g.BookmarkFilters.length;e++)o=l="",g.BookmarkFilters[e].className===f.LinkCollection.className&&(l=d.collection,o=h.collection),i.push(F.newType(g.BookmarkFilters[e],{autofillNotAfter:[{className:f.EntityFilter.className,value:["messages","emails","tasks","events","notes"]}],name:l,description:o}));for(t=t.concat(g.MailFilters),n&&(t=t.concat(n)),a&&(t=t.concat(a)),i&&(t=t.concat(i)),(t=t.concat(g.commentFilters)).push(f.HashtagFilter),t.push(F.newType(f.TagFilter,{name:p.tag,description:u.tag})),(t=t.concat(g.attachmentFilters)).push(g.inviteeFilter),e=0;e<g.dateFilters.length;e++){switch(o=l="",g.dateFilters[e].className){case f.FromDateFilter.className:l=p.fromdt,o=p.fromdt;break;case f.ToDateFilter.className:l=p.todt,o=p.todt}t=t.concat(F.newType(g.dateFilters[e],{name:l,description:o}))}return t.push(g.isFavouriteFilter,g.titleFilter,g.postSummaryFilter,g.isArchivedFilter),t.push(g.postLikedBy,g.commLikedBy,g.postlikeCount,g.commentCount,g.commlikeCount),t}(),url:zmail.conPath+"/stream.do",hasPagination:function(){return c.showNextPage},getFrameworkInstance:function(){var e=zmail.Search.Integrators.Framework;return void 0===this.frameworkInstance&&"undefined"!=typeof zmStreamsApp&&(this.frameworkInstance=new e($.extend({},zmStreamsApp.util.constructSearchConfig(),{contextID:this.contextID}))),this.frameworkInstance},prioritizedFilterClass:[f.HasStreamsFilter,C,f.GroupFilter],onAdd:function(e){if(!zmail.Search.Environment.has("EntityFilter"))for(var t=0;t<e.length;t++)switch(e[t].className){case v.to:case v.cc:case v.sender:e[t].value&&zmail.Search.addToSearch({className:f.EntityFilter.className,value:"emails"},{silent:!0});break;case f.LinkCollection.className:e[t].value&&zmail.Search.addToSearch({className:f.EntityFilter.className,value:"bookmarks"},{silent:!0});break;case f.TaskAssigneeFilter.className:case f.TaskPriorityFilter.className:case f.TaskProjectFilter.className:case f.TaskStatusFilter.className:case f.TaskRecurringFilter.className:case f.TaskDueDateFilter.className:case f.TaskCompletedDateFilter.className:e[t].value&&zmail.Search.addToSearch({className:f.EntityFilter.className,value:"tasks"},{silent:!0});break;case v.MailAssociatedTask:case v.HasRecurring:case v.HasNoDueDate:case v.HasNoAssignee:zmail.Search.addToSearch({className:f.EntityFilter.className,value:"tasks"},{silent:!0});break;case f.NoteBookFilter.className:case f.NoteColorFilter.className:e[t].value&&zmail.Search.addToSearch({className:f.EntityFilter.className,value:"notes"});break;case v.HasInlineImage:case v.isCreateMail:zmail.Search.addToSearch({className:f.EntityFilter.className,value:"notes"},{silent:!0});break;case v.location:e[t].value&&zmail.Search.addToSearch({className:f.EntityFilter.className,value:"events"},{silent:!0})}},onChange:function(e){if(e.className===f.EntityFilter.className){var t=[];switch(e.value){case"notes":t=(t=t.concat(a).concat(n)).concat(s).concat(l);break;case"tasks":t=(t=t.concat(a).concat(r)).concat(s).concat(l);break;case"bookmarks":t=(t=t.concat(a).concat(r)).concat(n).concat(l);break;case"emails":t=(t=t.concat(s).concat(r)).concat(n).concat(l);break;case"events":t=(t=t.concat(s).concat(r)).concat(n).concat(a);break;case"messages":t=(t=(t=t.concat(s).concat(r)).concat(n).concat(a)).concat(l)}zmail.Search.Environment.remove(t,{silent:!0})}else if(!zmail.Search.Environment.has("EntityFilter"))switch(e.className){case v.to:case v.cc:case v.sender:zmail.Search.addToSearch({className:f.EntityFilter.className,value:"emails"},{silent:!0});break;case f.LinkCollection.className:zmail.Search.addToSearch({className:f.EntityFilter.className,value:"bookmarks"},{silent:!0});break;case f.TaskAssigneeFilter.className:case f.TaskPriorityFilter.className:case f.TaskProjectFilter.className:case f.TaskStatusFilter.className:case f.TaskRecurringFilter.className:case f.TaskDueDateFilter.className:case f.TaskCompletedDateFilter.className:case v.MailAssociatedTask:zmail.Search.addToSearch({className:f.EntityFilter.className,value:"tasks"},{silent:!0});break;case f.NoteBookFilter.className:case f.NoteColorFilter.className:case v.HasInlineImage:case v.isCreateMail:zmail.Search.addToSearch({className:f.EntityFilter.className,value:"notes"},{silent:!0});break;case v.location:zmail.Search.addToSearch({className:f.EntityFilter.className,value:"events"},{silent:!0})}},onReset:function(e){var t=this.getFrameworkInstance().getListingCenterDOM();t&&zmStreamsApp.util.detachAndRemove(t[0])},afterSearch:function(e){var t=this.getFrameworkInstance();t&&t.preview&&t.preview.close();var a=t.getListingCenterDOM();a&&(zmStreamsApp.util.detachAndRemove(a[0]),a.empty())},searchQuery:function(e){return g.constructQueryParams(e,this,c)},mountView:function(e){var t=this.getFrameworkInstance(),a=t.getListingCenterDOM(),n=e.response;if(n){var i=n[1],r=e.paginate;if(!r){var s=zdom("span",{className:"SC_mtb SC_Tcen"},m.streamsTabResult),l=o.selector(".SC_flt",t.listingHeader.$el);o.clearHTML(l),o.mount(s,l)}c.showNextPage=i.showNextPage,c.forceScroll=i.forceScroll,zmAppLoader.load("streamsApp").then(function(){zmStreamsApp.PostApp.searchView(i,a[0],r)})}},afterInit:function(){var i=this,e=a.concat(r);e=(e=e.concat(n)).concat(s);for(var t=0;t<e.length;t++)f.EntityFilter.removeDependentFilters.push(e[t]);$.subscribe("CALSEARCH_INIT",function(){for(var e,t=ZCL_getFilter(),a=[],n=0;n<t.length;n++)(e=t[n])&&e.className===f.LocationFilter.className&&a.push(F.newType(e,{autofillNotAfter:[{className:f.EntityFilter.className,value:["messages","emails","tasks","bookmarks","notes"]}],name:h.loc,description:h.loc}));i.registerFilterClasses(a),g.filterConstantsClass.location=f.LocationFilter.className,l.push(g.filterConstantsClass.location),f.EntityFilter.removeDependentFilters.push(g.filterConstantsClass.location)})}};return new t.SearchContext(e)};_zm.isStreamsEnabled()&&(e=i(),t.streamSearchContext=e,zmail.Search.registerContext(e))}(),function(e){var t=zmail.Core.Namespaces;!function(e,t){var i,a=t("zmail.Search.Models.Contexts"),n=t("zmail.Search.Models.Filters"),r=t("zmail.Search.Utils.CommonUtil.appUtil"),s={},l=r.filterConstantsClass,o=zmail.Search.Utils.TypeCreator,c=r.filterConstantsNames,m=zmText.get("search-impl"),u=m.notefilter,p=m.notedesc,d=o.newType(r.postedByFilter,{name:u.addedby,description:p.addedby,multipleInstance:!1}),h=o.newType(r.descriptionFilter,{name:u.desc,description:p.desc}),f=o.newType(r.titleFilter,{name:u.title,description:p.title}),F=o.newType(n.HasStreamsFilter,{name:u.contains,description:p.contains}),g=o.newType(r.isArchivedFilter,{name:u.archived,description:p.archived}),v=Boolean(_zm.isStreamsEnabled()),C=[F];v&&C.push(d,n.GroupFilter);C.push(n.NoteColorFilter),e.noteSearchContext=new a.SearchContext({contextName:m.notesContextName,contextID:"notes",contextIcon:"msi-notes",tabRegexp:/zm_notes/,shortcutId:"notesSearch",placeholder:m.notesPlaceHolder||"",defaultFilterClass:F,prioritizedFilterClass:C,filterClass:function(){var e=[F];v&&e.push(d);e.push(g),v&&e.push(n.GroupFilter);e.push(n.NoteBookFilter,n.NoteColorFilter,h,f,o.newType(n.BooleanFilter,{name:c.HasInlineImage,className:l.HasInlineImage,multipleInstance:!1}),o.newType(n.BooleanFilter,{name:r.filterConstantsNames.isCreateMail,className:r.filterConstantsClass.isCreateMail,multipleInstance:!1}),n.TagFilter,o.newType(n.BooleanFilter,{name:c.IsFavourite,className:l.IsFavourite,multipleInstance:!1})),v&&e.push(o.newType(n.ContactGroupFilter,{name:c.Invited,className:l.Invited,description:t("zmText").get("search-impl","notedesc.invitee")}));e.push(n.HashtagFilter),e=e.concat(r.attachmentFilters),v&&(e=e.concat(r.commentFilters));return e=e.concat(r.dateFilters)}(),url:"".concat(zmail.conPath,"/stream.do"),getFrameworkInstance:function(){var e=t("zmail.Search.Integrators.Framework");if("pending"!==this.dependencyPromise.state())return i||(i=new e($.extend({},this.getNotesFrameworkConfig(),{contextID:this.contextID}))),i},searchQuery:function(e){e.paginate;var t=ZMStore.getInstance("searchNote");return t&&t.length&&(s.start=t.length-25),r.constructQueryParams(e,this,s)},hasPagination:function(){return"1"===s.showNextPage},mountView:function(e){this.getView(e)},onReset:function(){i=void 0},getView:function(e,t){if(e.paginate,e.response){s.showNextPage=e.response[1].page.showNextPage;var a=e.response,n=$.isArray(a[1])?a[1]:[a[1]];this.constructNotesSearch(n,!e.paginate,$.e(i.getListingCenterDOM()[0]))}},active:function(){var i=this;zmModules.notes.getNotesApp().then(function(e){var t=e.loadNoteCategories,a=e.getFrameworkConfig,n=e.constructSearch;i.getNotesFrameworkConfig=a,i.constructNotesSearch=n,t().then(function(){i.dependencyPromise.resolve()})})}}),zmail.Search.registerContext(e.noteSearchContext)}(t.create("zmail.Search.Models.Contexts"),function(e){return t.get(e,{ignore__namespace:!0})})}(),function(){var t,e,a=zmail.Search,n=zmail.Search.Models.Contexts,i=zmail.Search.Models.Filters,r=zmail.Search.Utils.TypeCreator,s=zmail.ValueTypeInferrer.TYPES,l=zmText.get("search-impl"),o=l.mailfilter,c=l.maildesc,m=[{className:"EntireMessage"},{className:"Sender"},{className:"SentBy"},{className:"ToOrCc"},{className:"Subject"},{className:"EmailContent"},{className:"AttachmentName"},{className:"AttachmentContent"},{className:"AttachmentType"},{className:"To"},{className:"Cc"}],u=["HasAttachmentFilter","HasFlagFilter","HasReplyFilter","MailDateFilter","MailFromDateFilter","MailToDateFilter","MailReminderFilter","HasMailReminderFilter","ForwardFilter","HasInlineAttachmentFilter","MailPriorityFilter","FromSizeFilter","ToSizeFilter","includeSpamTrash"],p=["EntireMessage","Sender","SentBy","ToOrCc","Subject","EmailContent","AttachmentName","AttachmentContent","AttachmentType","To","Cc","EntireMessageExclude","SenderExclude","ToOrCcExclude","SubjectExclude","EmailContentExclude","AttachmentNameExclude","AttachmentContentExclude","ToExclude","CcExclude"],d=r.newType(i.ContactFilter,{name:o.sender,className:"Sender",description:c.sender,multipleInstance:!1,removeDependentFilters:u}),h=function(){var e=zmailSearch.Model.getSearchData()&&zmailSearch.Model.getSearchData().elemObj;e&&e.listingHeaderElem.find(".zmToggleBBtn").addClass("zmDisabled")},f=[i.HasMailFilter,d,r.newType(i.ContactFilter,{name:o.toOrcc,className:"ToOrCc",description:c.toOrcc}),i.FolderFilter,r.newType(i.StringFilter,{name:o.subject,className:"Subject",description:c.subject,valueType:s.String.name,removeDependentFilters:u}),r.newType(i.StringFilter,{name:o.emailcontent,className:"EmailContent",description:c.emailcontent,valueType:s.String.name,removeDependentFilters:u}),r.newType(i.StringFilter,{name:o.attachname,className:"AttachmentName",description:c.attachname,removeDependentFilters:u}),r.newType(i.StringFilter,{name:o.attachcontent,className:"AttachmentContent",description:c.attachcontent,removeDependentFilters:u}),r.newType(i.ContactFilter,{name:o.sentby,className:"SentBy",description:c.sentby,multipleInstance:!1,removeDependentFilters:u}),r.newType(i.AttachmentTypeFilter,{name:o.attachtype,className:"AttachmentType",description:c.attachtype}),r.newType(i.DateFilter,{name:o.date,className:"MailDateFilter",description:c.date,multipleInstance:!1,autofillNotAfter:[{className:"MailFromDateFilter"},{className:"MailToDateFilter"}],dependedOn:p}),r.newType(i.FromDateFilter,{name:o.fromdate,className:"MailFromDateFilter",description:c.fromdate,multipleInstance:!1,autofillNotAfter:[{className:"MailDateFilter"}],dependedOn:p,validate:function(e){if(i.DateFilter.validate(e)){var t=zmail.Search.Environment;if(t.has("MailToDateFilter")){var a=t.get("MailToDateFilter")[0].toJSON().actualValue;return!a||!!i.DateFilter.validate(a)&&s.Date.toDate(e).getTime()<=a.getTime()}return!0}return!1}}),r.newType(i.ToDateFilter,{name:o.tilldate,className:"MailToDateFilter",description:c.tilldate,multipleInstance:!1,autofillNotAfter:[{className:"MailDateFilter"}],dependedOn:p,validate:function(e){if(i.DateFilter.validate(e)){var t=zmail.Search.Environment;if(t.has("MailFromDateFilter")){var a=t.get("MailFromDateFilter")[0].toJSON().actualValue;return!a||!!i.DateFilter.validate(a)&&s.Date.toDate(e).getTime()>=a.getTime()}return!0}return!1}}),r.newType(i.ContactFilter,{name:o.to,className:"To",description:c.to,removeDependentFilters:u}),r.newType(i.ContactFilter,{name:o.cc,className:"Cc",description:c.cc,removeDependentFilters:u}),r.newType(i.BooleanFilter,{name:o.hasreminder,className:"HasMailReminderFilter",description:c.hasreminder,multipleInstance:!1,dependedOn:p}),i.MailReminderFilter,r.newType(i.BooleanFilter,{name:o.withattachment,className:"HasAttachmentFilter",description:c.withattachment,multipleInstance:!1,dependedOn:p}),r.newType(i.BooleanFilter,{name:o.flagged,className:"HasFlagFilter",description:c.flagged,multipleInstance:!1,dependedOn:p}),r.newType(i.BooleanFilter,{name:o.replied,className:"HasReplyFilter",description:c.replied,multipleInstance:!1,autofillNotAfter:[{className:"ForwardFilter"}],dependedOn:p}),r.newType(i.ContactFilter,{name:o.negatesender,className:"SenderExclude",description:c.negatesender,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.ContactFilter,{name:o.negatetoOrcc,className:"ToOrCcExclude",description:c.negatetoOrcc,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.StringFilter,{name:o.negatesubject,className:"SubjectExclude",description:c.negatesubject,valueType:s.String.name,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.StringFilter,{name:o.negateemailcontent,className:"EmailContentExclude",description:c.negateemailcontent,valueType:s.String.name,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.StringFilter,{name:o.negateattachname,className:"AttachmentNameExclude",description:c.negateattachname,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.StringFilter,{name:o.negateattachcontent,className:"AttachmentContentExclude",description:c.negateattachcontent,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.ContactFilter,{name:o.negateto,className:"ToExclude",description:c.negateto,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.ContactFilter,{name:o.negatecc,className:"CcExclude",description:c.negatecc,autofillOnlyAfterOperator:"any",autofillOnlyAfter:m,removeDependentFilters:u}),r.newType(i.BooleanFilter,{name:o.forwarded,className:"ForwardFilter",description:c.forwarded,multipleInstance:!1,autofillNotAfter:[{className:"HasReplyFilter"}],dependedOn:p}),i.MailPriorityFilter,i.MailFlagFilter,r.newType(i.BooleanFilter,{name:o.hasinline,className:"HasInlineAttachmentFilter",description:c.hasinline,multipleInstance:!1,dependedOn:p}),r.newType(i.BooleanFilter,{name:o.withComment,className:"HasComment",description:c.withComment,multipleInstance:!1})],F=zmail.ContactBook;f.push(r.newType(i.ContactFilter,{name:o.bcc,className:"BCC",description:c.bcc,multipleInstance:!1,removeDependentFilters:u,validate:function(e){return!!e&&(F.isContact(e)||F.isGroup(e)||_.isString(e)&&zmail.Utils.EmailValidator.validate(e).status)}}));var g={name:o.tag,className:"MailTagFilter",description:c.tag,multipleInstance:!0,values:function(){return zmail.Search.Utils.CommonUtil.appUtil.getTagsInOrder(zmail.labInfo)}};f.push(r.newType(i.TagFilter,g)),f.push(r.newType(i.MailSizeFilter,{name:o.from_size,className:"FromSizeFilter",description:c.from_size,multipleInstance:!1,validate:function(e){if(i.MailSizeFilter.validate(e)){var t=zmail.Search.Environment;if(t.has("ToSizeFilter")){var a=t.get("ToSizeFilter")[0].toJSON().value;if(i.MailSizeFilter.validate(a)){var n=i.MailSizeFilter.findValue(e);return parseInt(n)<parseInt(a)}return!1}return!0}return!1},getValue:function(){var e=this.value||{};return"string"==typeof e?(e=this.findValue(e),Math.floor(e).toString()):""},dependedOn:p}),r.newType(i.MailSizeFilter,{name:o.to_size,className:"ToSizeFilter",description:c.to_size,multipleInstance:!1,validate:function(e){if(i.MailSizeFilter.validate(e)){var t=zmail.Search.Environment;if(t.has("FromSizeFilter")){var a=t.get("FromSizeFilter")[0].toJSON().value;if(i.MailSizeFilter.validate(a)){var n=i.MailSizeFilter.findValue(e);return parseInt(n)>parseInt(a)}return!1}return!0}return!1},getValue:function(){var e=this.value||{};return"string"==typeof e?(e=this.findValue(e),Math.ceil(e).toString()):""},dependedOn:p})),zmUtil.isShrFolEnabled()&&zmfolAction&&zmfolAction.hasSharedFol()&&f.push(r.newType(i.FolderFilter,{className:"ShareFolFilter",name:l.mailfilter.sharedFol,description:l.maildesc.sharedFol,valueType:zmail.ValueTypeInferrer.TYPES.sharedFolder.name,autofillNotAfter:[{className:"FolderFilter"}],values:function(t){return t=(t||"").toLowerCase(),zmfolAction.getSharedFolPaths().filter(function(e){return-1!==e.path.toLowerCase().indexOf(t)})},defaultValue:void 0,validate:function(e){if(!_.isObject(e))return!1;var t,a=["fId","shId","path"];for(t in a)if(!_.has(e,a[t]))return!1;return!0}})),zmail.Utils.FeatureUtil.isAppAvailable("notes")&&f.push(r.newType(i.BooleanFilter,{name:o.withNote,className:"HasNote",description:c.withNote,multipleInstance:!1})),zmail.Utils.FeatureUtil.isAppAvailable("task")&&f.push(r.newType(i.BooleanFilter,{name:o.withTask,className:"HasTask",description:c.withTask,multipleInstance:!1})),zmUtil.isChatletEnabled()&&f.push(r.newType(i.BooleanFilter,{name:o.withChatlet,className:"HasChatlet",description:c.withChatlet,multipleInstance:!1})),zmUtil.isProjectEnabled()&&f.push(r.newType(i.BooleanFilter,{name:o.withProject,className:"HasProject",description:c.withProject,multipleInstance:!1})),e=f.map(function(e){return{className:e.className}}),f.push(r.newType(i.BooleanFilter,{name:o.includeSpamTrash,className:"includeSpamTrash",description:c.includeSpamTrash,multipleInstance:!1,autofillOnlyAfter:e,autofillOnlyAfterOperator:"any"}));n.mailSearchContext=new n.SearchContext({contextName:l.mailContextName,contextID:"mail",contextIcon:"msi-mail",tabRegexp:/zm_Container/,shortcutId:"mailSearch",placeholder:l.mailPlaceHolder,pageSize:50,defaultFilterClass:i.HasMailFilter,filterClass:f,prioritizedFilterClass:[i.HasMailFilter,d,i.FolderFilter],url:zmail.conPath+"/search.do",getFrameworkInstance:function(){if("pending"!==this.dependencyPromise.state()){var e=zmail.Search.Integrators.Framework;return this.frameworkInstance||(t=new e($.extend({},zmailSearch.Core.getFrameworkConfig.call(this),{contextID:this.contextID})),this.frameworkInstance=t),this.frameworkInstance}},searchQuery:function(e){return zmailSearch.Core.cookSearchQuery(e)},getView:function(e,t){zmailSearch.Core.generateView(e,t)},mountView:function(e){ZMail.topbar.icons.initResizeHandler("zm_srch1"),this.getView(e,this.getFrameworkInstance())},onAccountSwitch:function(e){if("object"===("undefined"==typeof zmailSearch?"undefined":babelHelpers.typeof(zmailSearch))&&zmailSearch.Core.isWorkspaceAvailable()){zmail.Search.Environment.remove();var t=zmailSearch&&zmailSearch.Model.getSearchData();t&&t.tabInfo&&t.tabInfo.appId&&zmsuite.closeWorkspace(t.tabInfo.appId)}},hasPagination:function(){return zmailSearch.Core.hasPagination()},afterSearch:function(e){zmailSearch.Model.resetSearchData(this.getFrameworkInstance())},active:function(){var e=this;zmAppLoader.load("mailSearch").then(function(){e.dependencyPromise.resolve()})},onChange:function(t){h();var a=i.FolderFilter.className,e={BCC:function(){var e=t.getValue();ZMail.utils.isCurrentUserEmailId(e)||(zmail.Search.Environment.has(a)&&zmail.Search.Environment.remove(a),zmail.Search.addToSearch({className:a,value:zmfolAction.getFolderPath(zmail.folId.sId)},{silent:!0}))}};e[a]=function(){if("Sent/"!==t.getValue()&&zmail.Search.Environment.has("BCC")){var e=zmail.Search.Environment.toJSON("BCC")[0].value;ZMail.utils.isCurrentUserEmailId(e)||zmail.Search.Environment.remove("BCC")}};var n=t.className;e[n]&&e[n]()},onAdd:function(e){h()},onRemove:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};h();var a=_zm.getProperty(t,"removedInstanceDetails.instance")||{};if(a.className===i.FolderFilter.className){if("Sent/"!==a.getValue())return;if(zmail.Search.Environment.has("BCC")){var n=zmail.Search.Environment.toJSON("BCC")[0].value;ZMail.utils.isCurrentUserEmailId(n)||zmail.Search.Environment.remove("BCC")}}}});a.registerContext(n.mailSearchContext)}(),function(e){var t,a,n,i,r,s,l,o,c,m,u,p,d,h=zmail.Core.Namespaces,f=h.create("zmail.Search.Models.Contexts");t=f,i=(a=function(e){return h.get(e,{ignore__namespace:!0})})("zmail.Search.Models.Contexts"),r=a("zmail.Search.Models.Filters"),s=a("zmail.Search.Utils.CommonUtil.appUtil"),l=a("zmail.Search.Utils.TypeCreator"),o=zmText.get("search-impl","attachment"),c=[{className:r.AttachmentNameFilter.className},{className:r.AttachmentContentFilter.className},{className:r.AttachmentDocTypeFilter.className},{className:r.AttachmentEntityFilter.className},{className:r.AttachmentGroupFilter.className},{className:r.AttachmentSenderFilter.className},{className:r.AttachmentTypeFilter.className},{className:r.TagFilter.className}],m=function(){return l.newType(s.isFavouriteFilter,{name:"in favourites"})},u=function(){return r.InMail},p=function(){return[l.newType(r.FromDateFilter,{autofillOnlyAfterOperator:"any",autofillOnlyAfter:c}),l.newType(r.ToDateFilter,{autofillOnlyAfterOperator:"any",autofillOnlyAfter:c})]},t.attachmentSearchContext=new i.SearchContext({contextName:o.contextName,contextID:"Attachment",contextIcon:"msi-attachview",tabRegexp:/attView/,placeholder:o.placeholder.searchbox,shortcutId:"attachmentsSearch",url:"".concat(zmail.conPath,"/postAttach.do"),defaultFilterClass:r.AttachmentNameFilter,filterClass:(d=[],d.push(r.AttachmentNameFilter,r.AttachmentContentFilter,r.AttachmentSenderFilter,r.AttachmentTypeFilter,r.AttachmentGroupFilter,r.InStreams,u(),m(),r.TagFilter,r.AttachmentDocTypeFilter,r.AttachmentEntityFilter,r.AttachmentSizeFilter),d=d.concat(p())),prioritizedFilterClass:[r.AttachmentNameFilter,r.AttachmentContentFilter,r.AttachmentSenderFilter],getFrameworkInstance:function(){var e=a("zmail.Search.Integrators.Framework");if("pending"!==this.dependencyPromise.state())return n||(n=new e($.extend({},zmAttachment.search.core.getFrameworkConfig.call(this),{contextID:this.contextID}))),n},searchQuery:function(e){return zmAttachment.search.core.getAttachmentSearchQuery(e)},hasPagination:function(){return zmAttachment.search.core.hasPagination()},mountView:function(e){this.getView(e,this.getFrameworkInstance())},getView:function(e,t){zmAttachment.search.core.generateView(e,t)},onReset:function(){n=void 0,this.paginationBinded=!1,this.paginationRequestSent=!1},active:function(){var e=this;zmModules.initAttachmentSearchModule().then(function(){e.dependencyPromise.resolve()})}}),zmail.Search.registerContext(t.attachmentSearchContext)}(),function(e){var t,a,n,i,r,s,l,o,c,m,u,p,d,h,f,F=zmail.Core.Namespaces,g=F.create("zmail.Search.Models.Contexts");n=g,s=(i=function(e){return F.get(e,{ignore__namespace:!0})})("zmail.Search.Models.Contexts"),l=i("zmail.Search.Models.Filters"),o=i("zmail.Search.Utils.CommonUtil.appUtil"),c=i("zmail.Search.Utils.TypeCreator"),m=zmText.get("search-impl","bookmark"),u={},p=function(){return c.newType(o.postedByFilter,{name:o.filterConstantsNames.AddedBy,description:m.description.addedby,multipleInstance:!1})},d=function(){return c.newType(o.isFavouriteFilter,{name:m.filter.infavourites,description:m.description.infavourites})},h=function(){return c.newType(o.titleFilter,{name:m.filter.title,description:m.description.title,multipleInstance:!1})},f=function(){return c.newType(o.descriptionFilter,{name:m.filter.description,description:m.description.description,multipleInstance:!1})},n.linkSearchContext=new s.SearchContext({contextName:m.contextName,contextID:"bookmarks",contextIcon:"msi-links",tabRegexp:/zm_link/,shortcutId:"bookmarksSearch",placeholder:m.workspace.placeholder.searchbox,defaultFilterClass:l.LinkSearchKey,filterClass:(t=Boolean(_zm.isStreamsEnabled()),a=[l.LinkSearchKey],t&&a.push(p()),a.push(l.TagFilter),t&&a.push(l.LinkGroup),a.push(l.LinkCollection,d(),h(),f()),a.concat(o.dateFilters)),url:"".concat(zmail.conPath,"/stream.do"),getFrameworkInstance:function(){var e=i("zmail.Search.Integrators.Framework");if("pending"!==this.dependencyPromise.state())return r||(r=new e($.extend({},this.zmLinkFrameworkConfig(),{contextID:this.contextID}))),r},searchQuery:function(e){return u.showNextPage=this.zmLinkhasPagination(),o.constructQueryParams(e,this,u)},hasPagination:function(){return this.zmLinkhasPagination()},mountView:function(e){this.getView(e)},getView:function(e){this.zmLinkgenerateView(e)},reset:function(){r=void 0,this.paginationBinded=!1,this.paginationRequestSent=!1},active:function(){var r=this,s=this;zmUtil.requireLinkModule().then(function(e){var t=e.hasPagination,a=e.isProjLoaded,n=e.generateView,i=e.getFrameworkConfig;r.zmLinkhasPagination=t,r.zmLinkgenerateView=n,r.zmLinkFrameworkConfig=i,a().then(function(){s.dependencyPromise.resolve()})})}}),zmail.Search.registerContext(n.linkSearchContext)}(),function(e){var t=zmail.Core.Namespaces;!function(e,s){var l,t=s("zmail.Search.Models.Contexts"),a=s("zmail.Search.Models.Filters"),n=zmail.Search.Utils.TypeCreator,i=zmail.Search.Utils.CommonUtil.appUtil,r=i.filterConstantsClass,o={},c=zmText.get("search-impl"),m=n.newType(a.ContactFilter,{name:c.taskfilter.addedby,className:r.PostedBy,description:c.taskdesc.addedby,multipleInstance:!1}),u=Boolean(_zm.isStreamsEnabled()),p=[n.newType(a.HasStreamsFilter,{description:c.taskdesc.contains})];u&&p.push(m,a.TaskAssigneeFilter);e.taskContextSearch=new t.SearchContext({tabRegexp:/zm_task/,contextName:c.taskContextName,contextID:"task",contextIcon:"msi-task",shortcutId:"taskSearch",placeholder:c.taskHolder,defaultFilterClass:a.HasStreamsFilter,filterClass:function(){var e=[];e.push(n.newType(a.HasStreamsFilter,{description:c.taskdesc.contains})),u&&e.push(m,a.TaskAssigneeFilter,a.GroupFilter);e.push(a.TaskStatusFilter,a.TaskPriorityFilter,a.TaskProjectFilter,n.newType(a.BooleanFilter,{name:c.taskfilter.hasrecurring,description:c.taskdesc.hasrecurring,className:i.filterConstantsClass.HasRecurring,multipleInstance:!1}),n.newType(a.BooleanFilter,{name:c.taskfilter.noduedate,className:i.filterConstantsClass.HasNoDueDate,description:c.taskdesc.noduedate,autofillNotAfter:[{className:"TaskDueDateFilter"}],multipleInstance:!1}),i.titleFilter,n.newType(a.BaseFilter,{name:c.taskfilter.desccontains,className:i.filterConstantsClass.Summary,description:c.taskdesc.desccontains}),a.HashtagFilter),u&&e.push(n.newType(a.BooleanFilter,{name:c.taskfilter.noassignee,className:i.filterConstantsClass.HasNoAssignee,description:c.taskdesc.noassignee,autofillNotAfter:[{className:"TaskAssigneeFilter"}],autofillOnlyAfterOperator:"any",multipleInstance:!1}),i.mentionedFilter,a.TagFilter,i.inviteeFilter,i.isFavouriteFilter);e=e.concat(i.attachmentFilters),u&&(e=e.concat(i.commentFilters));return(e=e.concat(i.dateFilters)).push(a.TaskRecurringFilter),e.push(n.newType(a.TaskDueDateFilter,{name:c.taskfilter.duedate,className:"TaskDueDateFilter",autofillNotAfter:[{className:i.filterConstantsClass.HasNoDueDate}],multipleInstance:!1})),e.push(a.TaskCompletedDateFilter),e.push(n.newType(a.BooleanFilter,{name:c.taskfilter.mailassociated,className:i.filterConstantsClass.MailAssociatedTask,description:c.taskdesc.mailassociated,autofillOnlyAfterOperator:"any",multipleInstance:!1}),n.newType(a.BooleanFilter,{name:i.filterConstantsNames.isCreateMail,className:i.filterConstantsClass.isCreateMail,multipleInstance:!1})),e}(),prioritizedFilterClass:p,url:zmail.conPath+"/stream.do",searchQuery:function(e){return i.constructQueryParams(e,this,o)},hasPagination:function(){return o.showNextPage},mountView:function(e){this.getView(e)},onReset:function(){l=void 0},getFrameworkInstance:function(){var e=s("zmail.Search.Integrators.Framework");if("pending"!==this.dependencyPromise.state())return l||(l=new e($.extend({},s("zmTask.Search").getFrameworkConfig(),{contextID:this.contextID}))),l},getView:function(e){var t=(l=this.getFrameworkInstance()).getListingCenterDOM();e.pageNo||t.empty();var a=e.response;if(a){var n=a[1];if(o.showNextPage=n.showNextPage,o.forceScroll=n.forceScroll,e.paginate){if(!_.isEmpty(n.list)){var i=s("zmTask").getCurrentList("searchList"),r=[];_.each(n.order,function(e){r.push(n.list[e])}),i.push(r)}}else s("zmTask.Search").constructList(n,l).then(function(){})}l.listing.$el.mousedown(function(){zmUtil.isAnyMenuOpen()&&(zmUtil.hideMenu(),$.e(this).find(".SC_ddn").removeClass("SC_ddn"),$.e(this).find("i.msi-markcomplete.zmDDShw").removeClass("zmDDShw"),$.e(this).find("div.zmL.sel").removeClass("sel"))})},active:function(){var e=this;zmUtil.requireTaskModule("taskSearchUtil").done(function(){e.dependencyPromise.resolve()})}}),zmail.Search.registerContext(e.taskContextSearch)}(t.create("zmail.Search.Models.Contexts"),function(e){return t.get(e,{ignore__namespace:!0})})}(),function(e){var t,a,n,i,r=zmail.Core.Namespaces,s=r.create("zmail.Search.Models.Contexts");t=s,n=(a=function(e){return r.get(e,{ignore__namespace:!0})})("zmail.Search.Models.Contexts"),i=a("zmText").get("search-impl"),t.zohoOneSearchContext=new n.SearchContext({tabRegexp:/search_across_zoho/,contextName:i.zohoOneSearchPlaceholder,contextID:"search across zoho",contextIcon:"msi-search",placeholder:i.zohoOneSearchPlaceholder,shortcutId:"search_across_zoho",__isZohoOneSearch:!0,__specialIconClass:"msi-popout",__zohoOneElementID:"wmsglobalsearch"}),zmail.isRebranded||zmail.Search.registerContext(t.zohoOneSearchContext,{silent:!0})}(),function(e){var t,a,n,i,r,s,l=zmail.Core.Namespaces;l.create("zmail.Search.Models.Contexts");a=(t=function(e){return l.get(e,{ignore__namespace:!0})})("zmail.Search"),n=t("zmail.Search.Models.Contexts.SearchContext"),i=t("zmText").get("search-impl"),r=i.quickAccessPlaceHolder||"",(s=t("zmail.Search.Models.Contexts")).Commands=new n({contextName:i.quickAccessContextName,contextID:"quick access",contextIcon:"msi-quickAction",placeholder:r,shortcutId:"quickAccess",tabRegexp:/zm-settings|settings/i,__isCommand:!0}),"object"===babelHelpers.typeof(zmail.policyBasedHiddenItems)&&zmail.policyBasedHiddenItems.isSettingsEnabled&&a.registerContext(s.Commands,{silent:!0})}();