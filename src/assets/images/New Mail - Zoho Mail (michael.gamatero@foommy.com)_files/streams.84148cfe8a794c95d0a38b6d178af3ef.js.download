"use strict";window.zmStreamsApp=window.zmStreamsApp||{},window.zmStreamsApp.constants=function(){var a={rightClickId:"",workspaceId:"zmStreamsApp",popupId:"zms_dropdown",elements:{},groupWorkId:"zmStreamsGroup",setElements:function(){var e=a.workspaceId,t=zmsuite.getCenter(e)[0].getNodes(),n=t[2]&&t[2].$el.find(".SCS_rgt").length?t[2].$el.find(".SCS_rgt"):zmsuite.getCenter(e)[0].getNodes()[2].$el;a.elements={center:zmsuite.getCenter(e)[1],zm_stHdr:t[0].$el[0],streamListWrapper:t[2].$el[0],zm_stMain:t[1].$el[0].parentElement,zm_stPView:zmsuite.getCenter(e)[1].$el[0],preview:zmsuite.getCenter(e)[1],zm_stream:t[0].$el[0].parentElement,centerOuter:zmsuite.getCenterOuter(e).$el[0],leftHolder:t[2].$el.find(".zmGroupLft"),postHolder:n}},removeNotificationPreview:"/ncenter/closePreview",closeDialog:"/stream/closeDialog",reconnect:"zmailReconnect",appSwitch:"/apps/tabSwitched",mailPreviewUnload:"mail/preview/unload",smartComposeUnload:"smartCompose/removeComment",taskCloseTab:"/zm/task/closetab",notificationStopEvent:"/ncenter/stopEvents",rhsOpenClose:"/integ/rhs",rhsWidth:"",closeMailTab:"/mail/tabClosed",toggleAppBar:"zmsuite/appBarToggle",mailShareUpdate:"/mail/collab/updateshareicon",updateShareIcon:"/mail/preview/updateshare",changeStreamsView:"/streams/changePreview",notificationTabPreview:"/ncenter/removePreview/tab",maxLimit:{MAX_ALLOWED_IMAGE_SIZE:300,MAX_GROUP_NAME_LENGTH:100,MAX_GROUP_DESC_LENGTH:200},errCode:{nopost:"ENTITY_DOES_NOT_EXIST",opPermit:"OPERATION_NOT_PERMITTED",pagination:"PAGINATION_ERROR",crossOrg:"CROSS_ORG_ACCESS",appAccess:"OPERATION_RESTRICTED_CONTACT_ADMIN"},groupEvents:{removeMembers:"CONTACT_BOOK_GROUP_MEMBERS_REMOVED",addModerator:"CONTACT_BOOK_GROUP_MODERATORS_ADDED",remModerator:"CONTACT_BOOK_GROUP_MODERATORS_REMOVED",addMembers:"CONTACT_BOOK_GROUP_MEMBERS_ADDED",groupAdded:"CONTACT_BOOK_GROUP_ADDED",groupRemoved:"CONTACT_BOOK_GROUP_REMOVED",groupEdit:"CONTACT_BOOK_GROUP_CHANGED"},streamTypeInfo:{"-1":"all",1:"mail",2:"note",3:"task",4:"event",6:"status",10:"link",13:"tweet"},streamTypeName:{all:"-1",mail:"1",note:"2",task:"3",event:"4",status:"6",link:"10",tweet:"13"},postLoadCount:{grid:10,list:15},allUnreadCount:{grid:3,list:5},notifications:{mail_type:"4",like:"23",unlike:"24",post_mention:"25",unlike_comment:"26",unshared:"27",invite:"29",add_post:"30",add_comment:"31",delete_post:"32",delete_comment:"34",delete_private_comment:"35",add_private_comment:"36",change_entity:"37",comment_mention:"38",bulk_update:"39",bulk_delete:"40",add_task:"41",reminder_task:"42",add_share_comment:"43",post_group_mention:"44",comment_group_mention:"45",add_event:"46",update_event:"47",delete_event:"48",like_comment:"49",add_group_member:"50",change_moderator:"109",remove_group_member:"51",resource_share:"52",shareperm_change:"53",shareperm_removal:"54",update_event_status_yes:"55",update_event_status_no:"56",update_event_status_maybe:"57",task_assign:"58",mail_reminder:"59",accept_share:"60",mail_share:"61",add_attachment:"62",change_task_due_date:"63",change_task_assignee:"64",change_task_status:"65",change_task_priority:"66",change_task_category:"67",change_task_title:"68",change_task_description:"69",remove_attachment:"70",draft_share:"71",draft_shareupdate:"72",draft_mailmention:"73",share_unsubscribe:"74",stream_group_enable:"75",stream_group_disable:"76",mail_streams_enable:"77",mail_streams_disable:"78",add_link:"79",change_link_category:"80",change_link_title:"81",change_link_description:"82",change_link_url:"83",mark_link_fav:"84",calendar_reminder:"85",calendar_reminder_mailid_change:"86",calendar_sharing:"87",calendar_unsubscribe:"88",biz_sub_online_renew_due_fewday:"89",biz_sub_online_renew_tdy:"90",biz_sub_online_renew_overdue:"91",biz_sub_online_renew_overdue_tdy:"92",biz_sub_offline_renew_due_fewday:"93",biz_sub_offline_renew_tdy:"94",biz_sub_offline_renew_overdue:"95",biz_sub_offline_renew_overdue_tdy:"96",biz_sub_purchase_more:"97",biz_sub_purchase:"98",domain_not_verified:"99",domains_not_verified:"100",mail_hosting_nil:"101",mx_not_pointed_to_zoho:"102",reg_domain_auto_renew:"103",reg_domain_manual_renew:"104",add_subtask:"105",edit_link:"106",lock_invites:"107",unlock_invites:"108",add_tweet:"112",draft_autosave:"118",mark_read:"121",watch_post:"122",unwatch_post:"123",favourite:"124",unfavourite:"125",pin:"126",unpin:"127",add_tag:"128",remove_tag:"129",enable_comment:"130",disable_comment:"131",archive:"134",unarchive:"135",correctUnread:"138"},gender:{0:"FEMALE",1:"MALE",2:"COMMON"},DLErrConstants:{UNKNOWN:0,CONNECTIVITY:"1",CAPTCHA:"2",OTHERS:"3"}};return a}(),zmStreamsApp.i18ntext=function(){var e={};return e.streams=zmText.get("streams","streams"),e.common=zmText.get("streams","common"),e}(),window.zmStreamsApp=window.zmStreamsApp||{},zmStreamsApp.util=function(){var m=zmStreamsApp.constants,a=m.groupEvents,S=zmText.get("streams"),p=function(e,t){if(e){var n=e.model.toJSON();return n&&n.gnrl.id===t}return!1},o=function(){var t,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},m=zmStreamsApp.PostApp.getModelForEntity(r.id,r.etype),e=m.getMyActInfo().rem,n={parentDOM:r.elm,onSelect:function(s){e&&e.length?(s.actionType="edit",s.reminderId=e[0]):s.actionType="add",t.hide(),m.sync("reminder",m,s).done(function(e){if(e[0]&&e[1]&&e[1].id){m.addReminder(e[1].id,e[1],r.elm);var t=zmStreamsApp.constants.streamTypeInfo[m.getEntityType()];_zm.succErrMsg("s","add"===s.actionType?zmText.applyArgs(S.common.messages.remAdded,{type:S.streams.entityName[t]}):zmText.applyArgs(S.common.messages.remUpdate,{time:(n=Number(e[1].rtime),a=new Date(n),i=zmStreamsApp.util.getHourAndTime(n),o=a.toDateString().slice(4,10),o+=", ".concat(a.getFullYear()),"".concat(o," ").concat(i))}))}else _zm.succErrMsg("e","add"===s.actionType?S.common.messages.errRemAdd:S.common.messages.errRemEdit);var n,a,i,o})},onDelete:function(e){Dialog.confirm(S.common.messages.delReminder,function(){e.actionType="del",t.hide(),e.reminderId=m.getReminderInfo()[0].id,m.sync("reminder",m,e).done(function(e){e[0]&&e[1]&&e[1].id?(m.removeReminder(e[1].id,r.elm),_zm.succErrMsg("s",S.common.messages.remDeleted)):_zm.succErrMsg("e",S.common.messages.errRemDel)})},function(){t.hide()},{okButtonName:S.common.messages.yes,cancelButtonName:S.common.messages.no})}},a=function(){n.defaultSelection="custom",zmUtil.createReminderTimeComponent(n).then(function(e){(t=e).show()})};if(e&&e.length){var i=m.getReminderInfo();i&&i.length?(n.defaultValue=i[0].sdt||i[0].rdt,a()):m.sync("reminder",m).done(function(e){e[0]&&e[1]&&e[1].length?(e=e[1],m.set("reminderInfo",e),n.defaultValue=e[0].sdt||e[0].rdt,a()):_zm.succErrMsg("e",S.common.messages.errRemInfo)})}else a()},c={hideMenu:function(e){zmUtil.hideMenu(),$.q(".SCS_postHover").removeClass("SCS_postHover"),e&&$.q(".SC_ddn").removeClass("active"),$.q(".SC_ddn").removeClass("SC_ddn"),$.q(".SC_ddnB").removeClass("SC_ddnB"),$.q("#zm_stream_edit").remove()},getTabElement:function(e){var t=zmsuite.getCenter("zmStreamsApp")[0].$el,n=t.find(".SCS_tabWrapper.posFixed").is(":visible"),a=(void 0!==e?e:n)?"zm_staticTab":"zm_fixedTab";return t.find(".SCS_tabWrapper.".concat(a))},orderComments:function(a,e){return _(e).map(function(e,t){var n=a[e];return n&&(n.sequence=t+1),n})},removeCommentClass:function(e,t){t&&t.listObject[e]&&t.removeClassAtStart(e,"msi-lcmnt")},addReadLoader:function(e,t,n){t&&t.listObject[e]&&(n?t.removeLoader(e):t.addLoader(e))},removeGroup:function(e){$.publish(a.groupRemoved,{id:e})},addGroup:function(e){$.publish(a.groupAdded,{group:e,groupID:e.id})},editGroup:function(e,t){$.publish(a.groupEdit,{props:t,id:e})},groupManagement:function(e){var t=e.members,n=e.groupId;t=_.isArray(t)?t:t.split(","),"addMember"===e.mode?$.publish(a.addMembers,{id:n,members:t}):"removeMember"===e.mode?$.publish(a.removeMembers,{id:n,members:t}):"addModerator"===e.mode?($.publish(a.addModerator,{id:n,moderators:t}),-1!==t.indexOf(zmail.zuid)&&c.editGroup(n,{isOwner:!0})):"removeModerator"===e.mode&&($.publish(a.remModerator,{id:n,moderators:t}),-1!==t.indexOf(zmail.zuid)&&c.editGroup(n,{isOwner:!1}))},showGroupDetails:function(e,t){var n="zmStreamsApp"===zmTab.currentTab?zmsuite.getCenter("zmStreamsApp")[0].$el[0]:e.viewDOM,a=t&&t.type?t.type:"dropdown",i=zmUtil.createFLComp("groups",{data:e.groupInfo,search:"name",display:"name",displayAs:a,onSelect:e.fn,showCheckbox:!1,showCreate:!1,parentDOM:$.e(e.elm),removehandler:!0,parWidth:!0,viewDOM:n,showUnread:e.showUnread,onHide:function(){$.q(".SC_ddn").removeClass("SC_ddn")}});"dropdown"===a&&$.e(e.elm).addClass("SC_ddn"),i.show()},getNameOfInvitee:function(e,t,n){var a,i="",o=0;e=e?e.split(","):"";var s=zmStreamsApp.util.getContactDetails(e);for(var r in s){var m=(a=s[r]).name||a.fn;if(m)i+=m;else for(var l in t)String(l)===r&&(i+=t[l]);!i&&n&&(i=n),++o!==e.length&&(i+=", ")}return i},publishDeletePost:function(e){$.publish("zmstreamsapp/deletePost",e)},getHourAndTime:function(e){var t=new Date(e),n=t.getHours(),a=t.getMinutes(),i=12<=n?"PM":"AM";return"".concat(((n=(n%=12)||12)<10?"0":"")+n,":").concat(a<10?"0":"").concat(a," ").concat(i)},getFullDateFormat:function(e){var t=new Date(e);return void 0===t.getDateBy?t="":(t=t.getDateBy(zmail.userDateFormat.toUpperCase()),"".concat(t," ").concat(zmStreamsApp.util.getHourAndTime(e)))},updateTime:function(e){var t,n,a,i=new Date(e),o=new Date;if(n=i.toDateString()===o.toDateString(),a=i.getFullYear()===o.getFullYear(),t=o-i,t=Math.floor(t/6e4),a&&t&&0<t)return n?t<60?1===t?"".concat(t," ").concat(S.streams.common.minago):"".concat(t," ").concat(S.streams.common.minsago):zmStreamsApp.util.getHourAndTime(e):i.toDateString().slice(0,10).toUpperCase();if(a)return!1;var s=i.toDateString().slice(4,10).toUpperCase();return"".concat(s,", ").concat(String(i.getFullYear()))},getMentionList:function(){var m=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(i){var o=[],s=m.group;m.inviteeList=m.inviteeList||[];var r=function(){(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){-1!==e.eid.indexOf("#")&&(e.eid=e.eid.substring(e.eid.indexOf("#")+1,e.eid.length)),zmAjq.XHR({u:"".concat(zmail.conPath,"/post.do"),t:"POST",p:{mode:"mentions",groupId:e.gid,entityId:e.eid,entityType:e.etype},fn:function(e){e&&e.mentions?t(e.mentions):n()},efn:n})})})({gid:s.id,eid:m.id,etype:m.type}).then(function(e){e=e.concat(m.inviteeList),i(e)})},e=function(){if(m.shGroup){var e,t=m.shGroup,n=!1;for(var a in t)if(e=t[a].id,t[a].isGroup&&e!==zmail.zuid&&e!==s.id){if(!zmUtil.isGroupMember(zmail.zuid,e)){n=!0;break}o=(o=o.concat(e)).concat(zmStreamsApp.util.getGroupDetails(e).members||[])}n?r():i(_.uniq(o))}else i(_.uniq(o))};if(s.isGroup)if(zmUtil.isGroupMember(zmail.zuid,s.id)){var t=zmStreamsApp.util.getGroupDetails(s.id).members||[];o=(o=t.concat(m.inviteeList)).concat(s.id),e()}else r();else o.push(s.id),o=o.concat(m.inviteeList),e()})},getMentionDataEditor:function(e){for(var t=[],n=[],a=[],i=0,o=(e=e||[]).length;i<o;i++)"mention"===e[i].type&&(t.push(e[i].id),n.push(e[i].start),a.push(e[i].end));return{offset:{from:n,to:a,text:t},mention:_.uniq(t).join(",")}},getMentionsFromTextArea:function(e){var t=$.e(e).data().editor;if(t){var n=t.getMetaBlocks();return zmStreamsApp.util.getMentionDataEditor(n)}return{}},getCaretPosition:function(e){var t=$.e(e).data().editor;if(t)return t.getCursorPosition()},getPostType:function(e){var t=zmStreamsApp.constants.streamTypeInfo[e];return S.streams.post.postType[t]},sendRemove:function(e,t,n){t?$.e(e).removeClass("zs_snd"):void 0!==t&&$.e(e).addClass("zs_snd"),$.e(e).text(n)},membersSetPagination:function(e,t,n){return e.splice(t,n)},membersFilter:function(e,t){var n=zmStreamsApp.util.getGroupDetails(e),a=_zm.copyOf(zmStreamsApp.util.getContactDetails(n.members));a=_.toArray(a);var i=zmAutoFill.filterArray(a,["fn","eid","nn"],t,!0);return""!==t&&(i=i.slice(0,99)),i},createDialog:function(a){var e,t=a.items,n=a.shGroup,i=a.users,o=a.streamsEnabled,s={},r=Object.keys(t);for(var m in s=zmStreamsApp.util.getContactDetails(r))if(s[m].isDummyObj){for(var l in n)String(n[l].id)===m&&(s[m]=n[l],s[m].isGroupid=!0);s[m].isDummyObj&&(s[m].fn=i[m]||"")}for(var p in t)(e=zmStreamsApp.util.getContactDetails([t[p]])[t[p]]).isDummyObj&&(e.fn=i[t[p]]),s[t[p]]=e;var c=_.pick(a.items,function(e){return String(e)===String(zmail.zuid)}),d=_.pick(a.items,function(e){return String(e)!==String(zmail.zuid)}),u=[],g=[];if(u.push(d),g.push(c),_.size(u[0])%2&&0!==_.size(g[0])){var f=Object.keys(g[0])[0],v={};v[f]=g[0][f],u.push(v),delete g[0][f]}var h={$content:zmStreamsApp.template.popup[a.type](g,a.showInvite,s,a.isOwner,o),dialogDidMount:a.dialogDidMount,dialogWillMount:function(e){e.$els.$content[0].appendChild(zmStreamsApp.template.popup[a.type](u,a.showInvite,s,a.isOwner,o));var t=_.size(u[0])+_.size(g[0]);if(a.showInvite){var n=zmStreamsApp.template.invitee_input();$.e(n).insertDOMAfter(e.$els.$content[0]),1<t&&$.e(n).css("width",500),setTimeout(function(){$.e(n).find("input").focus()},500)}1<t&&$.e(e.$els.$contentWrapper).css("width",500),$.e(e.$els.$content).css("max-height",.8*$.e(window).height())},title:S.common.labels.invitee};a.closeAction&&(h.closeAction=a.closeAction),a.buttons&&0<a.buttons.length&&(h.buttons=a.buttons),Dialog.new(h)},createPopup:function(e){var t={};if("invitee_popup"===e.type){var n=e.items,a=e.shGroup;for(var i in n)if(zmUtil.isGroup(i))t[i]=zmStreamsApp.util.getGroupDetails(i);else{for(var o in a)String(a[o].id)===i&&(t[i]=a[o]);void 0===t[i]&&(t[i]=zmStreamsApp.util.getContactDetails([i])[i])}}var s=zmStreamsApp.template.popup[e.type](e.items,e.invite,t,e.showInvite),r={par:e.parent,showArrow:!0,liDom:s,ulClass:e.ulclass,spanClass:e.parentClass,id:m.popupId};return e.callback&&(r.clk=e.callback),e.buttons&&0<e.buttons.length&&(r.buttons=e.buttons),e.direction&&(r.direction=e.direction),e.noArrow&&(r.showArrow=!1),void 0!==e.liHover&&(r.liHover=e.liHover),e.align&&(r.align=e.align),e.container&&(r.container=e.container),e.onhide&&(r.onHide=e.onhide),e.avoidScroll&&(r.avoidScroll=e.avoidScroll),zmStreamsApp.util.showDropdown(r,e.hoverElm),e.done&&e.done($.q("#zm_dropDown")),$.q("#zm_dropDown")},closePreview:function(e){var t=zmsuite.getCenter(e),n=$.e(t[1].$el),a=n.data("view");a||(a=(n=$.e(t[0].$el)).data("view")),a&&a.remove(),t[1].$el.parent().removeClass("SC_sw"),t[1].close();var i=t[0].$el.find(".streamsList").filter(".zmSLst");if(i.length){i.removeClass("zmSLst");var o=zmStreamsApp.events.getCurrentView();if("unread"===o.view&&"zmStreamsApp"===zmTab.currentTab)if(zmStreamsApp.events.getCurrentGroupId()===zmail.zuid){var s=$.e(i).parents(".SC_GrpBlock");i.remove();var r=s.find(".SC_grpPosts").children().length,m=s.find(".SC_loadMoreUnrd");1===r&&m.length?m.click():r||(s.remove(),o.elm.children().length||(zmStreamsApp.events.clearList(zmail.zuid),zmStreamsApp.PostApp.hideMarkAsRead(!0)))}else if(i.remove(),!o.elm.children().length){zmStreamsApp.PostApp.hideMarkAsRead(!0);var l=zmStreamsApp.PostApp.template.noPost();$.e(o.elm).empty().appendDOM(l)}}},bindEntityElements:function(e){var t=e.entityElem,n=e.entityId,a=zmUtil.getMailObj(n),i=a.TH,o=zmsuite.getCenter(e.appId),s=i?a.T:n,r=$.e(o[1].$el).find(".SC_Twpr"),m=r.data("view"),l=p(m,s);m&&l||(m=(r=$.e(o[0].$el).find(".SC_Twpr")).data("view"),l=p(m,s),m&&l||(m=(r=e.entityElem.parents(".SCS_postMail")).data("view"))),i||(r=""),t.hasClass("msi-fav")?m.addLabel(t,"","",r):t.hasClass("zmst_lbl")&&m.applyLabel(t,!0)},getDropdownMenu:function(e,t){var a=$.e(zmsuite.getCenter()[1].$el).find(".SC_Twpr").data("view");a||(a=$.e(zmsuite.getCenter()[0].$el).find(".SC_Twpr").data("view")),a||"2"!==t&&"3"!==t||(a=$.e(zmsuite.getCenter()[1].$el).find(".SCS_post").data("view"));var n,i=zmStreamsApp.PostApp.getModelForEntity(e,t);n="2"===t?S.streams.post.postType.note:"3"===t?S.streams.post.postType.task:S.streams.post.postType.mail;var o=[],s=i.getGnrlInfo(),r=zmStreamsApp.util.getGroupDetails(s.group.id),m=s.owner||r&&r.isOwner;if(("2"===t||"3"===t)&&(o.push({txt:S.common.labels.print,data:{action:"print",fn:function(){zmStreamsApp.util.printEntity({pid:i.get("gnrl").id,etype:t,actionType:zmStreamsApp.events.getActionType(i.getGroupInfo()),gid:i.getGroupInfo().id,allComments:!0})}}}),_zm.isStreamsEnabled())){var l="",p="",c=r.disabled;if("2"===t&&(zmUtil.isGroupMember(zmail.zuid,s.group.id)||s.owner))l=S.common.labels.postAsNewNote,m&&!c&&(p=S.common.labels.moveNote);else if("3"===t){l=S.common.labels.postAsNewTask;var d=i.get("tasks");m&&d&&!d.subTaskPosition&&!c&&(p=S.common.labels.moveTask)}l&&o.push({txt:l,data:{action:"postasnew",fn:function(){a.postAsNew.apply(a)}}}),p&&o.push({txt:p,data:{action:"moveEntity",fn:function(){a.moveEntity.apply(a)}}})}if(m){var u;if("3"===t){var g=i.get("tasks");u=g&&g.subTaskPosition}if(!u){var f=s.archived?S.common.labels.unarchive:S.common.labels.archive;o.push({txt:"".concat(f," ").concat(n),data:{action:"archive",fn:function(){a.archivePost.apply(a)}}})}}if("3"!==t){var v=".zmPostActions";o.push({txt:S.streams.activitylog.timeline,data:{action:"streamsTimeline",fn:function(){var e=a.$el.find(".zmTimeLineCont")[0];e||(e=zdom("div",{className:"zmTimeLineCont"}),$.e(e).insertDOMBefore(a.$el.find(v)[0])),zmStreamsApp.PostActions.getActivityLogs(i.toJSON(),e),setTimeout(function(){var e=a.$el.find(v).parent(),t=$.q("body")[0].getBoundingClientRect(),n=a.$el.find(".zmTimeline").offset().top;e&&n>t.height&&e[0].scrollIntoView({behavior:"smooth"})},500)}}})}if(_zm.isStreamsEnabled()&&o.push({txt:i.get("myact").watching?"".concat(S.common.labels.unwatch," ").concat(n):"".concat(S.common.labels.watch," ").concat(n),data:{action:"watch",fn:function(){a.watchPost.apply(a)}}}),i.get("myact").showdelete&&o.push({txt:"".concat(S.common.labels.deleteOnly," ").concat(n),data:{action:"streamsdelete",fn:function(){a.deletePost.apply(a)}}}),s.owner&&_zm.isStreamsEnabled()){var h=0<i.get("cmnt").total?S.common.labels.disableFurtherComments:S.common.labels.disableComments,z=s.allowComments?h:S.common.labels.enableComments;o.push({txt:z,data:{action:"streamsdelete",fn:function(){a.enableDisableComment.apply(a)}}})}return o.push({txt:S.common.labels.copylink,data:{action:"copylink",fn:function(){a.showDialogLink.apply(a)}}}),o},showDropdownForApps:function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0,s=(o=zmStreamsApp.PostApp.addPostModel(o)).getEntityType(),n=o.getId(),a=zmStreamsApp.constants.streamTypeName,e="";switch(s){case a.note:e=S.streams.post.postType.note;break;case a.task:e=S.streams.post.postType.task;break;default:e=S.streams.post.postType.mail}var t=[],r=o.getGnrlInfo(),m=r.group.id,l=zmStreamsApp.util.getGroupDetails(m),p=r.owner||l&&l.isOwner;if((s===a.note||s===a.task)&&(t.push({txt:S.common.labels.print,data:{action:"print",fn:function(){zmStreamsApp.util.printEntity({pid:n,etype:s,actionType:zmStreamsApp.events.getActionType(o.getGroupInfo()),gid:m,allComments:!0})}}}),_zm.isStreamsEnabled())){var c="",d="",u=l.disabled;if(s===a.note&&(zmUtil.isGroupMember(zmail.zuid,r.group.id)||r.owner))c=S.common.labels.postAsNewNote,p&&!u&&(d=S.common.labels.moveNote);else if(s===a.task){c=S.common.labels.postAsNewTask;var g=o.get("tasks");p&&(g&&!g.subTaskPosition||o.get("_isPtask"))&&!u&&(d=S.common.labels.moveTask)}c&&t.push({txt:c,data:{action:"postasnew",fn:function(){if(s===a.task){var e=o.get("title");!e&&o.get("tasks")&&(e=o.get("tasks").title),zmTask.Util.moveTask({NMSPID:m,TITLE:e,TASKID:n},!0)}else if(s===a.note){var t=o.get("notes");zmModules.notes.getNotesUtils().then(function(e){e.copyNote({entityId:n,title:t.title,catId:t.catid,namespaceId:m,comments:!0},e.postAsNew,{type:"copyNote"})})}}}}),d&&t.push({txt:d,data:{action:"moveEntity",fn:function(){if(s===a.task){var e=o.get("title");!e&&o.get("tasks")&&(e=o.get("tasks").title),zmTask.Util.moveTask({NMSPID:m,TITLE:e,TASKID:n},!1)}else if(s===a.note){var t=o.get("notes");zmModules.notes.getNotesUtils().then(function(e){e.copyNote({entityId:n,title:t.title,catId:t.catid,namespaceId:m,comments:!0},e.changeGroup,{type:"moveNote"})})}}}})}if(p){var f=!0;if(s===a.task){var v=o.get("tasks");f=v&&!v.subTaskPosition||o.get("_isPtask")}if(f){var h=r.archived?S.common.labels.unarchive:S.common.labels.archive;t.push({txt:"".concat(h," ").concat(e),data:{action:"archive",fn:function(){var e=zmStreamsApp.constants.streamTypeInfo[s];zmStreamsApp.util.hideMenu();var a=S.streams.entityName[e],t=function(){o.sync("archive",o).done(function(e){if(e[0]){o.updateArchive();var t=o.getGnrlInfo().archived,n=t?S.common.messages.archivePost:S.common.messages.unarchivePost;n=zmText.applyArgs(n,{type:a}),$.publish("streams/changeArchive",{archived:t,entityId:o.getId(),etype:s,gid:o.getGroupInfo().id}),_zm.succErrMsg("s",n)}else _zm.succErrMsg("e",e[1].msg?e[1].msg:S.common.messages.errRequest)})};if("0"!==zmAdHocSettings.getArchivePostDialog()||o.getGnrlInfo().archived)t();else{var n=zmStreamsApp.PostApp.template.archiveConfirmDialog(S.streams.post.postType[e]),i=$.e(n).find(".msi-uncheck");i.click(function(){i.toggleClass("msi-uncheck msi-check")}),Dialog.confirm(void 0,function(){_zm.hasClass(i[0],"msi-check")&&zmAdHocSettings.setArchivePostDialog("1"),t()},void 0,{$content:n,okButtonName:S.common.labels.archive,cancelButtonName:S.common.labels.cancel})}}}})}}if(s!==a.task&&t.push({txt:S.streams.activitylog.timeline,data:{action:"streamsTimeline",fn:function(){var a=".zmPostActions",e=i.find(".zmTimeLineCont")[0];e||(e=zdom("div",{className:"zmTimeLineCont"}),$.e(e).insertDOMBefore(i.find(a)[0])),zmStreamsApp.PostActions.getActivityLogs(o.toJSON(),e),setTimeout(function(){var e=i.find(a).parent(),t=$.q("body")[0].getBoundingClientRect(),n=i.find(".zmTimeline").offset().top;e&&n>t.height&&e[0].scrollIntoView({behavior:"smooth"})},500)}}}),_zm.isStreamsEnabled()&&t.push({txt:o.get("myact").watching?"".concat(S.common.labels.unwatch," ").concat(e):"".concat(S.common.labels.watch," ").concat(e),data:{action:"watch",fn:function(){zmStreamsApp.util.hideMenu(),o.sync("watch",o).done(function(){o.updateWatch();var e,t=zmStreamsApp.constants.streamTypeInfo[o.getEntityType()],n=S.streams.entityName[t];e=o.get("myact").watching?S.common.messages.entityWatched:S.common.messages.entityUnwatched,_zm.succErrMsg("s",zmText.applyArgs(e,{type:n}))})}}}),o.get("myact").showdelete&&t.push({txt:"".concat(S.common.labels.deleteOnly," ").concat(e),data:{action:"streamsdelete",fn:function(){var e={$content:zmStreamsApp.i18ntext.streams.post.delPost,buttons:[{name:S.groupSubscription.txt_ok,callback:function(e){if(e.remove(),s===a.task){var t=o.get("_ptaskId");!t&&o.get("tasks")&&o.get("tasks").parentTask&&(t=o.get("tasks").parentTask.id),zmUtil.requireTaskModule("taskReq").done(function(e){e.deleteTaskReq({entityId:o.getId(),pTaskId:t,groupId:o.getGroupInfo().id},function(){o.trigger("change:deletePost")})})}else s===a.note&&zmModules.notes.getNotesUtils().then(function(e){e.deleteNotesReq({id:o.getId(),groupId:o.getGroupInfo().id})});zmStreamsApp.util.publishDeletePost({etype:s,id:o.id}),o.get("myact").unread&&o.changeUnreadCount()}},{name:S.common.labels.cancel,isCancel:!0,callback:function(e){e.remove()}}],ignoreMouseDown:!1};Dialog.new(e)}}}),r.owner&&_zm.isStreamsEnabled()){var z=0<o.get("cmnt").total?S.common.labels.disableFurtherComments:S.common.labels.disableComments,b=r.allowComments?z:S.common.labels.enableComments;t.push({txt:b,data:{action:"streamsdelete",fn:function(){zmStreamsApp.util.hideMenu(),o.enableDisableComment()}}})}return t.push({txt:S.common.labels.copylink,data:{action:"copylink",fn:function(){var e=o.toJSON();if(zmComponent.clipBoardAPI.isSupported()){var t="".concat(window.location.protocol,"//").concat(window.location.hostname).concat(zmail.conPath,"/#stream/tab/").concat(e.gnrl.group.id,"/").concat(e.gnrl.id,"/").concat(e.gnrl.type,"/").concat(zmStreamsApp.events.getActionType(e.gnrl.group));zmComponent.clipBoardAPI.setData(t,{type:"text"})}else{var n={title:S.common.labels.copylink,$content:zmStreamsApp.PostApp.template.getLinkBox(e),dialogWillMount:function(e){setTimeout(function(){$.e(e.$els.$contentWrapper).find("input").select()},500),$.e(e.$els.$content).filter(".SC_PUcen").css({"font-size":"13px",color:"grey"})}};Dialog.new(n)}}}}),$.subscribe("/apps/removeModel",function(e,t){var n=zmStreamsApp.PostApp.isModelExists(t);if(n){var a=n.get("views")||{};_.size(a)||n.destroy()}}),t},showReminder:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=zmStreamsApp.PostApp.getModelForEntity(e.id,e.etype);if(t){var n,a=t.getMyActInfo().rem,i=$.e(e.elm).find(".msi-reminder");n=a&&a.length?(i.addClass("zmThmClr"),S.common.tooltips.updReminder):(i.removeClass("zmThmClr"),S.common.tooltips.reminder),$.e(e.elm).attr("data-tooltip",n),$.e(e.elm).click(function(){o(e)})}},hideOptions:function(){var e=zmsuite.getCenter(zmStreamsApp.constants.workspaceId).rightIconHeader;e.collection.get("gotoTop").set("visible",!1),e.collection.get("writeStatus").set("visible",!1)},removeViews:function(e,t,n){t=t.element?t.element:t,zmStreamsApp.util.detachAndRemove(t,n)},detachAndRemove:function(e,t){var n=$.Deferred();try{t=t||zmTab.currentTab,e=e||zmsuite.getCenter(t)[0].$el;var a=$.e(e).find("#s_postview");if((a=a.length?$.e(a):$.e(e)).length){var i=$.e(a).find("div.zmPostActions");i.length||(i=$.e(a).find("div.mailSLWra")),i.length&&zmStreamsApp.PostActions.removeViews(i);var o=$.e(a).find("div.sc_cmdv");o.length&&zmStreamsApp.CommentModule.removeViews(o);var s=$.e(a).find(".chatlet");s.length&&zmail.Components.ChatletNew.removeViews(s);var r=$.e(a).find("div.SCS_post");!r.length&&$.e(a).hasClass("SCS_post")?r=$.e(a):!r.length&&$.e(a).find(".SC_Twpr")&&(r=$.e(a).find(".SC_Twpr")),r.length&&zmStreamsApp.PostApp.removeViews(r);var m=$.e(a).find("div.zmL");m.length&&zmStreamsApp.PostApp.removeViews(m),n.resolve()}else n.resolve()}catch(e){zmUtil.debugLog(e),n.resolve()}return n},restoreStreams:function(e){var t=zmStreamsApp.RouteHelper;return{streamAppObj:{appname:S.common.labels.appName,appId:e,data:{CNodes:"3"},appIcon:"msi-streams",searchPlaceHolder:S.common.labels.searchStreams,faqKey:"Streams",router:t,isNewHeader:!0,isNewPreview:!1,onDelete:function(){return zmStreamsApp.util.removeViews(void 0,zmsuite.getCenter(e)[0].$el[0]),!0}},tabRouter:t}},printEntity:function(e){var m=zmStreamsApp.constants.streamTypeName;e.etype===m.note?zmUtil.loadNotes("printNote",{data:{id:e.pid,namespaceId:e.gid}}):(e.dataRequest=!0,e.callback=function(e){var t=e,n=t.gnrl.type,a=zmStreamsApp.PostApp.template.post({data:e,grid:!0,type:"Status",id:e.id,isPrint:!0}),i=$.e(a).find(".postMsg");n===m.task?zmStreamsApp.PostApp.components.addTask(e,i):n===m.event?zmStreamsApp.PostApp.components.addEvent(e,i):n===m.link?zmStreamsApp.PostApp.components.addLink(e,i):n===m.tweet&&zmStreamsApp.twitter.showTweet(e,i);var o={elm:$.e(a).find(".SCS_postWra"),by:t.gnrl.by,id:t.id,etype:n,groupId:t.gnrl.group.id,showinvite:t.myact.showinvite,like:t.myact.like,invitee:parseInt(t.act.invitees),likes:parseInt(t.act.likes),postUuid:t.gnrl.on,inviteeList:t.myact.inviteeList,isOwner:t.gnrl.by===zmail.zuid,lockInvites:t.gnrl.lockInvites,shGroup:t.myact.shGroup,isDraft:t.gnrl.draft,shared:t.gnrl.shared,group:t.gnrl.group};zmStreamsApp.PostActions.getPostTemplate(o);var s=zmStreamsApp.util.orderComments(t.cmnt.comments,t.cmnt.order);s.total=t.cmnt.total;var r={elm:$.e(a).find(".SCS_postWra"),comments:s,id:t.id,isShare:!1,groupId:t.gnrl.group.id,etype:n,owner:t.gnrl.by,isDisableAdd:!0,shGroup:t.myact.shGroup,isPrint:!0};zmStreamsApp.CommentModule.getCommentTemplate(r),setTimeout(function(){zmail.Printer.print({title:S.common.labels.titlePrint,content:a,css:["streams.css"]})},200)},zmStreamsApp.PostApp.singlePost(e))},reconnectActions:function(){zmUtil.getGroupOrder().length&&(zmUtil.debugLog("Updating streams View, in respond to zmailReconnect - ".concat(new Date)),void 0!==zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.getAllUnread(),void 0!==zmStreamsApp.PostApp&&zmStreamsApp.PostApp.updateCurrentListing(),c.setStreamsAppSelection())},setStreamsAppSelection:function(e,t,n){t=t||zmTab.currentTab;var a=m.workspaceId;if(t!==a&&n===a&&"m"===(zmApp.selectedApp||zmApp.currentApp))zmail.mailLeft.getNodes()[0].resetDefaultSelection();else if(t===a&&zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.GroupId){c.getGroupDetails(zmStreamsApp.GroupApp.GroupId).disabled?zmail.mailLeft.getNodes()[0].setTempSelection("zmStreamTree","disabledGrp"):zmail.mailLeft.getNodes()[0].setTempSelection("zmStreamTree",zmStreamsApp.GroupApp.GroupId)}},getContactDetails:function(e){var t,n,a={};if(e&&e.length)for(var i=0,o=e.length;i<o;i++){if(t=String(e[i]),zmUtil.isGroup(t))n=zmStreamsApp.util.getGroupDetails(t);else{var s=zmail.ContactBook.get({zuid:t,type:"org",promise:!1});if(s.length)(n=s[0].attrs).avatar=s[0].avatar()[0];else{var r=zmResource.get("image","SC-Photo.png");n={isDummyObj:!0,photo:r,fn:"",zid:"",eid:"",nn:"",avatar:zdom("div",{className:"SC_avtr"},zdom("img",{src:r}))}}}a[t]=n}return a},getGroupDetails:function(e,t){zmUtil.loadGroupManagement();var n,a={},i={includeGroupHome:Boolean(e||t),includeAllGroups:!0};if(n=zmail.ContactBook.getGroups(e,i),!e&&n.length){var o;a={};for(var s=0;s<n.length;s++)(o=n[s].attrs)&&(a[o.id]=o,a[o.id].avatar=n[s].avatar()[0])}else n.length?(a=n[0].attrs).avatar=n[0].avatar()[0]:!n.length&&zmStreamsApp.GroupManageApp&&(a=zmStreamsApp.GroupManageApp.getGroup(e)).disabled&&(a.isDisabled=!0);return a},generateAvatarTemp:function(e,t,n){var a=zmail.ContactBook,i=e,o="";return t||(i=a.Utils.initials(e)),n||(o=a.Utils.colorClasses()),a.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:i,avatarBgColor:o})[0]},getAttachments:function(e,t){var a={},i=$.Deferred();if(void 0!==e&&""!==e){if(!e.isUploadCompleted()){var n=t?S.streams.common.attUpComm:S.streams.common.attUpPost;zmUtil.succErrMsg("i",n)}e.getStoreAttachments().done(function(e){var t=e.tempLocation,n=e.myAttachment;t.error?a=t:(a.attTmpObj=JSON.stringify(t),a.attEntObj=JSON.stringify(n),a.cloudAttList=JSON.stringify(e.cloudAttList),a.attTmpObjCnt=t.length,a.attEntObjCnt=n.length,a.cloudAttListCnt=e.cloudAttList.length),i.resolve(a)}).fail(function(){i.reject()})}else void 0!==e&&""!==e||i.resolve(a);return i.promise()},showDropdown:function(e,t){var n=zmsuite.showMenu(e);if(t){var a="SC_ddn";n&&n.dropObj&&("bottom"===n.dropObj.mountPosition?a="SC_ddnB":"top"===n.dropObj.mountPosition&&(a="SC_ddn")),$.e(t).addClass(a)}return n},adjustWidth:function(e,t){if(zmsuite.getCenter&&void 0!==zmsuite.getCenter()[1]&&!zmTab.currentTab.includes("SComp")){var n=zmsuite.getCenter();if(n[1]){var a=n[1].$el;if(a&&a.length&&a.hasClass("shw")){var i=n[1].$el.find("div.zmCmntFixed"),o=a[0].getBoundingClientRect().width-20;i.css("width","".concat(o,"px"))}}}},addInvitee:function(t){var e={t:"POST",u:"".concat(zmail.conPath,"/post.do"),p:{mode:"invite",actionType:"addInvitee",entityId:t.pid,entityType:t.etype,fZuid:t.zuid,streamsView:!0,groupId:t.gid},fn:function(e){t.succCallbk(e)},error:function(e){t.errCallbk(e)}};zmAjq.XHR(e)},errorHandling:function(t){var e=zmStreamsApp.template.errorTemplate(t),n=e.element,a=S.common.messages,i=".requestAuthor",o=".requestSnt";return $.e(n).find(i).unbind().bind("click",function(){if(!$.e(n).find(o).hasClass("disButton")){$.e(n).find(i).text(a.requesting),$.e(n).find(o).addClass("disButton");var e={t:"POST",u:"".concat(zmail.conPath,"/post.do"),p:{mode:"accessRequest",groupId:t.gid,entityId:t.pid,entityType:t.etype},fn:function(){var e=$.e(n).find(i);e.text(a.requested),e.attr("data-val","Disabled")},error:function(e){zmUtil.succErrMsg("e",a.errRequest),$.e(n).find(o).removeClass("disButton"),$.e(n).find(i).text(a.requestAccess)}};zmAjq.XHR(e)}}),e},selfPhotoUrl:function(){return"//".concat(zmail.urls.contactsURL,"/file?fs=thumb&nocache=").concat(Date.now())},defaultGroupPhotoUrl:function(){return zmResource.get("image","streams/SC-Group.png")},storeUnposted:function(e,t,n,a){t=t||{};var i=function(e){var t,n,a,i,o;return t=e.text?e.text.trim():"",a=e.mentions?_.size(e.mentions):0,i=e.replyTo?_.size(e.replyTo):0,n=e.attachment?_.size(e.attachment):0,o=e.title?e.title.trim():"",!(t||a||i||n||o)};if("localStorage"in window&&null!==window.localStorage){var o="".concat(zmail.zuid,"_streamsContent"),s=localStorage.getItem(o);if(s){var r=JSON.parse(s);if(r[e]){if(t.hasOwnProperty("text")&&(r[e].text=t.text),t.hasOwnProperty("replyTo")&&(r[e].replyTo=t.replyTo),t.hasOwnProperty("mentions")&&(r[e].mentions=t.mentions),t.hasOwnProperty("attachment")&&(r[e].attachment=t.attachment),n&&t.hasOwnProperty("title")&&(r[e].title=t.title),i(r[e]))return void c.removeUnposted(e,n,a)}else{if(i(t))return;r[e]={text:t.text||"",attachment:t.attachment||"",mentions:t.mentions||"",replyTo:t.replyTo||""},n&&(r[e].title=t.title||"")}localStorage[o]=JSON.stringify(r)}else{if(i(t))return;var m={};m[e]={text:t.text||"",attachment:t.attachment||"",mentions:t.mentions||"",replyTo:t.replyTo||""},n&&(m[e].title=t.title||"");var l=JSON.stringify(m);localStorage.setItem(o,l)}}else if(n)a&&(t.hasOwnProperty("text")&&a.set("unPost",t.text),t.hasOwnProperty("mentions")&&a.set("mentions",t.mentions),t.hasOwnProperty("attachment")&&a.set("attachment",t.attachment),t.hasOwnProperty("title")&&a.set("title",t.title));else{var p=zmStreamsApp.CommentModule.unPost||{};p[e]||(p[e]={}),t.hasOwnProperty("text")&&(p[e].text=t.text),t.hasOwnProperty("replyTo")&&(p[e].replyTo=t.replyTo),t.hasOwnProperty("mentions")&&(p[e].mentions=t.mentions),t.hasOwnProperty("attachment")&&(p[e].attachment=t.attachment),i(p[e])&&delete p[e]}},retrieveUnposted:function(e,t,n){var a={};if("localStorage"in window&&null!==window.localStorage){var i="".concat(zmail.zuid,"_streamsContent"),o=localStorage.getItem(i);if(o){var s=JSON.parse(o);s[e]&&(a=s[e])}}else if(t)n&&(a={text:n.get("unPost"),mentions:n.get("mentions"),attachment:n.get("attachment"),title:n.get("title")});else{var r=zmStreamsApp.CommentModule.unPost||{};r[e]&&(a=r[e])}if(zmUtil.isNettyUploadEnabled()&&Array.isArray(a.attachment)){var m=a.attachment.filter(function(e){return!e.hasOwnProperty("virusFree")||!0===e.virusFree});a.attachment=m}return a},removeUnposted:function(e,t,n){if(e=e||"","localStorage"in window&&null!==window.localStorage){var a="".concat(zmail.zuid,"_streamsContent"),i=localStorage.getItem(a);if(i){var o=JSON.parse(i);if(o[e]){if(delete o[e],!_.size(o))return void localStorage.removeItem(a);localStorage[a]=JSON.stringify(o)}}}else if(t)n&&(n.set("unPost",""),n.set("mentions",""),n.set("attachment",""),n.set("title",""));else{var s=zmStreamsApp.CommentModule.unPost||{};s[e]&&delete s[e]}},triggerSearch:function(e){e=_zm.copyOf(e);for(var t,n,a,i=zmail.Search,o=i.Models.Filters,s=[],r=i.Utils.CommonUtil.appUtil.filterConstantsNames,m=0;m<e.length;m++)switch((t=e[m]).name){case o.GroupFilter.name:n=zmail.ContactBook.getGroups(t.value),s.push({name:t.name,value:n[0]});break;case o.HashtagFilter.name:s.push({name:t.name,value:t.value});break;case r.PostedBy:a=zmail.ContactBook.get({zuid:t.value,promise:!1}),s.push({name:t.name,value:a[0]})}s&&(zmail.Search.setContext(i.Models.Contexts.streamSearchContext,{ignoreUsableFilters:!0}),zmail.Search.newSearch(s))},loadMemberPopup:function(e){zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.triggerEditGroup(e,[{tab:"General"},{tab:"Calendar"},{tab:"Task"},{tab:"Members",default:!0,callback:zmStreamsApp.events.loadPostsOfUsers,title:S.groupSubscription.memberActions.loadPost}])})},reloadHeader:function(e){var t=zmStreamsApp.constants.workspaceId;if(zmsuite.isWorkspaceAvailable(t)){var n=zmsuite.getCenter(t);n[0].getNodes()[1].$el.data("groupId")===e&&n.leftIconHeader.collection.get("members").set("text",zmStreamsApp.GroupManageApp.memberText(zmStreamsApp.util.getGroupDetails(e)))}},memberSuccess:function(e,t){var n="add"===t?S.common.messages.membersAdded:t;zmUtil.succErrMsg("s",n),zmStreamsApp.util.reloadHeader(e)},constructSearchConfig:function(){var n=S.search.tabText;return{appId:"Streams_Search",tooltip:n,paginateScrollPercentage:90,tabInfo:{appId:"Streams_Search",appIcon:"msi-search",appname:n,data:{CNodes:"3"},faqKey:"Streams",isNewHeader:!0,isNewPreview:!1,onDelete:function(){return zmStreamsApp.util.removeViews(void 0,zmsuite.getCenter("Streams_Search")[0].$el[0]),!0}},constructNewHeader:function(e){var t=e[1].$el[0];$.e(t).find(".zmAHBlk").appendDOM(zdom("div",{className:"zmAHRow"},zdom("strong",null,n)))}}},openSinglePostInTab:function(e){var t=_.pluck(e,"id")[0];-1!==t.indexOf("#")&&(t=t.split("#")[1]);var n=e[t],a=n.gnrl.type,i={pid:n.gnrl.id,isMail:!1,etype:a,actionType:zmStreamsApp.events.getActionType(n.gnrl.group),gid:n.gnrl.group.id};zmUtil.publishCloseNotif(),zmUtil.requireStreamsApp().then(function(){zmStreamsApp.events.openPostInTab(i)}).fail(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];zmUtil.debugLog("Streams not loaded yet !","View message area",t)})},bindInviteeDialogAutofill:function(n){return new Promise(function(t){zmAppLoader.load("zmContactsTokenInput").then(function(){var a=zmContactsTokenInput.init({input:n.tokenInput,placeHolder:n.placeHolder?n.placeHolder:S.common.labels.addInvitee});a.onRemove=n.onRemove,a.onAdd=n.onAdd;var e=zmContactsAutoComplete.autoComplete({input:$.e(n.autofillInput).find("INPUT")[0],onSelect:function(e,t){(t=t.item.attributes).text=t.firstName;var n=a.tokenModelFactory.createModel(t);a.model.attributes.tokens.add(n)},exclude:n.exclude,contactType:"org",excludeMe:!0,hideEmailId:!0,setDebounce:0,includeAllGroups:n.includeAllGroups,prioritizeAllGroupMembers:!0,listShown:function(){a.triggers.enterKeyTrigger.enabled=!1},listHidden:function(){a.triggers.enterKeyTrigger.enabled=!0}});t({autoComplete:e,tokenComponent:a})})})},requestErrHandling:function(e,t){var n=zmStreamsApp.constants.DLErrConstants;e.get("isDeleted")?_zm.succErrMsg("e",S.common.messages.deletedPost):t.err&&t.err.errCode===n.CONNECTIVITY?_zm.succErrMsg("e",S.common.messages.networkUnreachable):t.resp?_zm.succErrMsg("e",t.resp):_zm.succErrMsg("e",S.common.messages.errRequest)}};return window.WebSocketComp&&(c.logger=WebSocketComp.getLoggerInstance(200)),c}(),window.zmStreamsApp=window.zmStreamsApp||{},window.zmStreamsApp=function(e){var p=zmText.get("streams"),c=zmStreamsApp.constants,l="msi-gridview",o=function(e){var t,n,a,i=e===l,o=i?"grid":"list";if(c.setElements(),!(t=zmsuite.getCenter(c.workspaceId).rightIconHeader.collection).get(o).get("isSelectedMenu")){$.e(c.elements.zm_stMain).find(".SCS_lft").length&&$.e(c.elements.zm_stMain)[i?"removeClass":"addClass"]("SC_list"),t.get("grid").set("isSelectedMenu",i),t.get("list").set("isSelectedMenu",!i);var s=zmStreamsApp.events.getCurrentGroupId();n=o,(a=zmStreamsApp.events.getCurrentView()).elm.parent().children().each(function(e,t){$.e(t).find("div.zmInfoWarnMsg").length||"files"===a.view&&"s_files"===$.e(t).attr("id")||$.when(zmStreamsApp.util.detachAndRemove(t)).done(function(){$.e(t).data({grid:"grid"===n,request:!1,next:""}).empty()})});var r=zmStreamsApp.events.getCurrentView();if(r.elm.parent()[i?"addClass":"removeClass"]("SCS_rgtIn"),"files"===r.view)zmStreamsApp.PostApp.attachScrollRef.toggleView();else{var m={view:r.view,gridview:i,switchView:!0};zmStreamsApp.PostApp.init(r.elm,s,m,!1)}zmAdHocSettings.setStreamsListType(o)}};e.updateGroupHeader=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:zmail.zuid,t=zmsuite.getCenter(c.workspaceId),n=t.leftIconHeader.collection.get("groupName"),a=t.leftIconHeader.collection.get("groupEmail"),i=t.leftIconHeader.collection.get("members"),o=t.leftIconHeader.collection.get("chat"),s=t.leftIconHeader.collection.get("moreAction");if(t[0].getNodes()[1].$el.data("groupId",e),e===zmail.zuid)n.set({text:p.common.labels.home,avatar:{id:e}}),a.set("visible",!1),i.set("visible",!1),o&&o.set("visible",!1),s.set("visible",!1);else{var r=zmStreamsApp.util.getGroupDetails(e);n.set({text:r.name,avatar:{isGroup:!0,groupId:e}}),r.eid?a.set({text:r.eid,visible:!0}):a.set("visible",!1);var m=r.members.length,l=m+" ".concat(1===m?p.common.labels.person:p.common.labels.members);i.set({text:l,visible:!0}),o&&o.set("visible",!0),s.set("visible",!0)}},e.constructIcons=function(){var e=zmStreamsApp.constants.workspaceId,a=zmsuite.getCenter(e);if(!a.leftIconHeader){var i=a[0].getNodes();i[1].appendIconBar(),i[1].menuBar.$el.addClass("zmHideD");var t=[{type:"iconText",id:"groupName",callback:function(){var e=i[1].$el.data("groupId"),t=a.leftIconHeader.collection.get("groupName").$el;zmStreamsApp.GroupApp.showDropDown(t,e)},disabled:!0,isBold:!0,applybackgroundThemeColor:!1,menuWithArrow:!0},{type:"text",id:"groupEmail",callback:function(){var e=i[1].$el.data("groupId");zmStreamsApp.GroupApp.emailGroup(e)},disabled:!0,haveThemeColor:!0,haveSeparatorDot:!0,applybackgroundThemeColor:!1},{type:"text",id:"members",haveThemeColor:!0,haveSeparatorDot:!0,callback:function(){var e=i[1].$el.data("groupId");zmStreamsApp.util.loadMemberPopup(e)},disabled:!0,applybackgroundThemeColor:!1}].concat(babelHelpers.toConsumableArray(zmail.IntegrationStatus.CHAT?[{type:"icon",id:"chat",iconClass:"msi-chat",haveSeparatorDot:!0,tooltip:p.streams.tooltip.chat,callback:function(){var e=i[1].$el.data("groupId");zmStreamsApp.GroupApp.createGroupChat(e)}}]:[]),[{type:"icon",id:"moreAction",iconClass:"msi-action",haveSeparatorDot:!0,tooltip:p.groupSubscription.moreOpt,callback:function(e){e.stopPropagation();var t=i[1].$el.data("groupId"),n=a.leftIconHeader.collection.get("moreAction").$el;zmStreamsApp.GroupApp.showMoreOption(n,t)}}]);a.leftIconHeader=zmIconConstructor.createIcon({iconList:t,targetContainer:i[1].titleBar.$el[0]});var n=[{type:"icon",id:"writeStatus",iconClass:"msi-status",tooltip:p.common.tooltips.writeStatus,callback:function(){a[0].$el.find(".SCS_rgt").animate({scrollTop:0},500),a[0].$el.find("#SC_rteUpdateBox").trigger("click","fromIcon")}},{type:"icon",id:"gotoTop",iconClass:"msi-gototop",tooltip:p.common.tooltips.toTop,callback:function(){a[0].$el.find(".SCS_rgt").animate({scrollTop:0},500)}},{type:"icon",id:"grid",iconClass:l,tooltip:p.common.tooltips.gridView,callback:function(){o(l)}},{type:"icon",id:"list",iconClass:"msi-listview",tooltip:p.common.tooltips.listView,callback:function(){o("msi-listview")}}];return a.rightIconHeader=zmIconConstructor.createIcon({iconList:n,targetContainer:i[1].$el.children()[1]}),i}},e.constructWorkSpace=function(e,t){var n=c.workspaceId,a=zmStreamsApp.util.restoreStreams(n);if("restore"===t&&zmsuite.isWorkspaceAvailable(n))zmsuite.resetWorkspace(n,a.streamAppObj);else if(!zmsuite.setWorkSpace(a.streamAppObj))return!1;zmsuite.renderWorkSpace(),zmsuite.showWorkSpace(n);var i=zmsuite.getCenter(n);return $.e(i[1].$el[0].parentElement).addClass("SC_streams"),c.setElements(),!0},e.currentListingView=function(){var e=zmsuite.getCenter(c.workspaceId).rightIconHeader;return e?(c.setElements(),e.collection.get("grid").get("isSelectedMenu")?"grid":"list"):"grid"},e.init=function(e,t){if(!_zm.isStreamsEnabled())return zmUtil.succErrMsg("e",p.common.messages.streamsDisabled),!1;e&&(zmUtil.isGroup(e)||zmail.zuid===e)||(e=zmail.zuid);var n="list"!==zmAdHocSettings.getStreamsListType();e=e||zmail.zuid;var a={view:"all",gridview:n,addTitleHeader:!0};e===zmail.zuid&&(0<zmStreamsApp.util.getGroupDetails(e).aucount&&(a.view="unread"));return zmail.ContactBook.groupsFetched.done(function(){zmStreamsApp.PostApp.init("",e,a,!0,!1,t)}),!0};return $.subscribe(c.removeNotificationPreview,function(e,t){if(zmStreamsApp.CommentModule.retainComment(t.element),zmStreamsApp.util.removeViews(e,t),"tab"===t.from){var n=zmsuite.getCenter("zmncenter")[1].getNodes(),a=n[0].headerArr.rIcons;if(a.length){var i=a.filter(function(e){return"chatlet"===e[0].data.action});if(i.length){var o=a.indexOf(i[0]);n[0].headerArr.rIcons.splice(o,1),n[0].render()}}}}),$.subscribe(c.closeDialog,zmStreamsApp.util.removeViews),$.subscribe(c.reconnect,zmStreamsApp.util.reconnectActions),$.subscribe(c.mailPreviewUnload,function(e,t){$.e(t.prevElem).css("bottom","0px"),zmStreamsApp.util.detachAndRemove(t.prevElem)}),$.subscribe(c.closeMailTab,function(e,t){zmStreamsApp.util.detachAndRemove(t.container)}),$.subscribe(c.smartComposeUnload,function(e,t){zmStreamsApp.util.detachAndRemove(t.prevElem)}),$.subscribe(c.taskCloseTab,function(e,t){zmStreamsApp.util.detachAndRemove(t.prevElem)}),$.subscribe(c.appSwitch,zmStreamsApp.util.setStreamsAppSelection),$.subscribe(c.rhsOpenClose,zmStreamsApp.util.adjustWidth),$.subscribe(c.toggleAppBar,zmStreamsApp.util.adjustWidth),$.e(window).on("resize",function(){zmStreamsApp.util.adjustWidth()}),e}(window.zmStreamsApp||{}),zmStreamsApp.template=function(){var d=zmText.get("streams"),c={},u=function(e,t){var n;return n=e.from>t.from?1:e.from===t.from?0:-1,"QUOTE"===t.type&&e.from>t.from&&(n=1),n},g=function(e,t,n,a,i,o){var s=[],r=e.type;if("MENTION"===r)s=function(e,t,n,a,i,o){var s=zmStreamsApp.util.getContactDetails([e.text])[e.text],r="zms_mention",m=s.fn;if(m=!m&&t&&t.id===e.text?t.name:n.substring(e.from,e.to),!o){var l=[];a&&a.length&&(l=_.pluck(a,"id")),(zmUtil.isGroup(e.text)||-1!==l.indexOf(e.text))&&(r+=" cursorDefault");var p="";"string"==typeof t&&-1!==t.indexOf("#")?p=t.substring(0,t.indexOf("#")):"object"===babelHelpers.typeof(t)&&(p=t.id),p&&-1===r.indexOf("cursorDefault")&&(zmUtil.isGroup(p)||_.size(i)&&-1!==i.indexOf(e.text))&&!zmUtil.isGroupMember(e.text,p)&&(r+=" inviteeColor")}var c=zdom("span",{className:r},m);return(s.zid||o)&&$.e(c).attr({"data-zid":e.text}),c}(e,n,t,a,i,o);else if("HASHTAG"===r){var m=t.substring(e.from,e.to),l=m.indexOf("#"),p=m.substring(0,l);s=zdom("span",{className:"zm_HTag"},p+"#",zdom("span",null,e.text.substring(1)))}else if("LINK"===r)s=zdom("a",{href:e.text,target:"_blank",rel:"noopener noreferrer"},e.text);else if("SMILEY"===r){var c=e.text;s=o?zdom("img",{src:zmResource.get("image","smileys-2x/"+e.class+".png"),style:{verticalAlign:"middle",width:"24px",height:"24px"},title:e.title||""}):zdom("em",{className:c,style:{verticalAlign:"middle"},title:e.title||""})}else"BOLD"===r?s=zdom("strong",null,e.text):"ITALIC"===r?s=zdom("i",null,e.text):"STRIKE"===r&&(s=zdom("strike",null,e.text));return s},f=function(e,t,n,a,i){var o,s=0,r=t.length,m=[];for(s=0;s<r;s++)"LINK"!==(o=t[s]).type&&"SMILEY"!==o.type&&m.push({from:o.from-n,to:o.to-n,type:o.type,text:o.text});var l,p={text:e,offset:m,group:a};return i?(l=c.richTextOffSet(p),zdom("span",{className:"SC_quote",dangerouslySetInnerHTML:l})):(l=c.setOffsetValues(p),zdom("span",{className:"SC_quote"},l))};return c={errorTemplate:function(e){var t,n,a,i,o=zmStreamsApp.constants.errCode,s=[],r=e.accessRequest;if(-1!==[o.opPermit,o.crossOrg,o.appAccess].indexOf(e.code)){if(t="noAccess",a=d.common.messages.allowCont,i=o.appAccess===e.code?d.common.messages.streamsDisabled:d.common.labels.errAccess,o.appAccess===e.code&&(n=d.common.messages.streamsDisabled),e.code===o.opPermit&&"DENIED"!==r){n=d.common.messages.allowHeader;var m="REQUESTED"===r,l=m?"Disabled":"",p=m?d.common.messages.requested:d.common.messages.requestAccess;s=zdom("div",{className:"SC_PUbtm requestSnt"},zdom("span",{className:"requestAuthor","data-val":l},p))}}else t="doesNotExist",n=d.common.messages.notFoundHeader,a=d.common.messages.notFoundCont,i=d.common.labels.errFound;var c=zdom("div",{className:"zmErrorPage "+t},zdom("div",{className:"zmEPMsg"},zdom("h4",null,n),zdom("p",null,a),s));return{element:c,title:i}},RenderAttachment:function(e,t){var n,a=(t=t||{}).isDraft,i=e.attArr,o=[],s=i.length,r=e.pid;r=-1!==r.indexOf("#")?r.substring(r.indexOf("#")+1,r.length):r;for(var m,l=e.actionType,p=e.groupId,c=0;c<s;c++)(m=i[c]).inline||(n={Id:m.id,e:r,et:e.type,fs:m.size,ft:m.ft,l:m.l,fn:m.name,p:m.part,thn:m.thn,tn:!0,type:l,u:m.u,gId:p,appId:m.appId,appType:m.appType,attType:m.attType,cloudLink:m.cloudLink,shT:m.shT,digest:m.digest},o.push(n));var d={attList:o,entityInfo:{groupId:p,e:r,et:e.type,actionType:l},appName:"streams"};return a?(d.attClass="SC_Pbar zmAch",d.attListClass="zmCAt"):(d.attListClass="zmPAtt",d.showTag=!0,d.supportDrag=!0),t.showZipOpt&&(d.zipType="downloadall",d.showMOpt=!0),zmAttach.build(d)},setOffsetValues:function(e){var t=e.text,n=e.offset,a=0,i=-1,o=e.span?zdom("div",{className:"zmsPCcontent"}):zdom("span",{className:"zmsPCcontent"}),s=function(e){var t=zmUtil.parseURLS(e,{httpOnly:!0}),n=[];if(t.length){var a=0,i=t.length;for(a=0;a<i;a++)n.push({from:t[a].startIndex,to:t[a].endIndex,text:t[a].url,type:"LINK"})}return n}(t),r=zmSmiley.replaceText(t);if((n=e.listView?(o.className="sum",r):(n=s.length?n.concat(s):n,r.length?n.concat(r):n))&&n.length){n.sort(u);var m,l,p,c=0,d=n.length;for(c=0;c<d;c++){if(0!==(m=n[c].from)&&(l=0===c?t.substring(0,m):t.substring(n[c-1].to,m),l=_zm.unescapeTags(l),o.appendChild(document.createTextNode(l))),"QUOTE"===n[c].type){0!==(i=c)&&o.appendChild(zdom("br",null)),a=n[c].from,p=n.slice(c+1,n.length),o.appendChild(f(n[c].text,p,a,e.group));break}0===a&&-1===i&&o.appendChild(g(n[c],t,e.group,e.shGroup,e.inviteeList))}0===a&&0<c&&n[c-1].to<t.length&&(l=t.substring(n[c-1].to,t.length),l=_zm.unescapeTags(l),o.appendChild(document.createTextNode(l)))}else-1===i&&(t=_zm.unescapeTags(t),o.appendChild(document.createTextNode(t)));return o},richTextOffSet:function(e){var t=e.text,n=e.text,a=e.offset,i=0,o=-1;if(a&&a.length){a.sort(u);var s,r,m,l,p=0,c=a.length;for(t="",p=0;p<c;p++){if(0!==(s=a[p].from)&&(r=0===p?n.substring(0,s):n.substring(a[p-1].to,s),e.richText&&(r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=zmComponent.markdown.Component(r,{tags:"span"})),t=t.concat(r)),"QUOTE"===a[p].type){0!==(o=p)&&(t=t.concat("<br>")),i=a[p].from,m=a.slice(p+1,a.length),l=f(a[p].text,m,i,e.group,!0),t=t.concat(l.outerHTML);break}0===i&&-1===o&&(l=g(a[p],n,e.group,e.shGroup,e.inviteeList,e.richText),t=t.concat(l.outerHTML))}0===i&&0<p&&a[p-1].to<n.length&&(r=n.substring(a[p-1].to,n.length),e.richText&&(r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=zmComponent.markdown.Component(r,{tags:"span"})),t=t.concat(r))}else if(e.richText)return t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),zmComponent.markdown.Component(t,{tags:"span"});return t},getRTEContent:function(e){var t,n,a,i=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).mentions||{},o=[],s=zmSmiley.replaceText(e);if(i.text&&i.text.length)for(n=i.text.length,t=0;t<n;t++)o.push({from:i.from[t],to:i.to[t],text:i.text[t],type:"MENTION"});if(n=o.length){var r,m=s.length,l=[];for(t=0;t<m;t++){for(r=!1,a=0;a<n;a++)s[t].from>=o[a].from&&s[t].to<=o[a].to&&(r=!0);r||l.push(s[t])}o=o.concat(l)}else o=o.concat(s);return c.richTextOffSet({text:e,offset:o,richText:!0})},addAttachment:function(e){return zdom("div",{className:"zmCA zms_aAtt"},zdom("div",{id:e,className:"zmCAt"}))},invitee_input:function(){return zdom("div",{className:"addInv",style:{width:"450px"}})},popup:{oneLine:function(e){var t,n,a,i=[],o=e.length;for(n=0;n<o;n++)t=(a=e[n].fn||e[n].name)?zdom("li",{"data-id":String(e[n].id)},zdom("div",null,a),zdom("img",{src:e[n].photo})):zdom("li",{"data-item":e[n].data},e[n].txt),i.push(t);return i},comment:function(e){var t,n=[];return t=zdom("li",{style:{whiteSpace:"pre-wrap",maxHeight:"200px",overflow:"auto"}},zdom("b",null,e.name+": "),e.text),n.push(t),n},invitee_popup:function(e,t,n,a,i){var o,s,r,m,l="",p="",c="",d=zdom("ul",{className:"invList"});if(i=void 0===i||i,e&&void 0===e.input)for(var u=0;u<e.length;u++){var g=e[u];for(var f in g)if(o=n[f]){var v=zdom("li",null);p=o.isGroupid?zmStreamsApp.util.defaultGroupPhotoUrl():o.photo||zmResource.get("image","SC-Photo.png"),s=o.fn||o.name,_zm.preloadimg(p);var h=(m=n[g[f]]).zid===zmail.zuid;r={name:s,attr:{"data-uid":o.id||o.zid,"data-iid":m.zid},ph:p,ret:"dom",img:!0},h||a?(i&&(r.iclass="msi-close"),r.cls="SC_cs myInv"):r.cls="SC_cs othrInv",c=zmConUtil.bubbleUtil(r),v.appendChild(c),h||(l=m.fn||m.name,v.appendChild(zdom("span",null,l))),d.appendChild(v)}}return d},trendingtags:function(e,t){var n,a,i,o=t?d.streams.tooltip.tag:zmText.applyArgs(d.common.labels.trendingtags,{tag:"#"});n=zdom("li",null,zdom("div",null,zdom("strong",null,o),zdom("div",{className:"SCS_tTags"})));var s=$.e(n).find(".SCS_tTags")[0];return _.each(e,function(e){i=e.id||e.name,a=zdom("span",{"data-text":i}),t?(a.textContent=e.dispName,$.e(a).prependDOM(zdom("font",{className:"SClbl",style:{backgroundColor:e.color}}))):a.textContent=e.name,s.appendChild(a)}),[n]}}}}(),window.zmStreamsApp=window.zmStreamsApp||{},zmStreamsApp.events=function(){var p=zmText.get("streams");return{cardTime:null,previewImage:function(e){if(e){for(var t=$.e(e).find("img"),i=[],n=t.length,a=0;a<n;a++)t[a].src&&i.push({ft:101,fn:"image.png",src:t[a].src});var o={attObjList:i,hideAllOptions:!0,ignoreThumb:!0},s=i.length;t.click(function(e){for(var t=$.e(this),n=0,a=0;a<s;a++)i[a].src===t[0].src&&(n=a);o.startIndex=n,zmUtil.initAttSlideShow(o)})}},getActionType:function(e){return e.isGroup?"viewGroupEntity":"viewSelfData"},getCurrentGroupId:function(){return"zmStreamsApp"===zmTab.currentTab?zmStreamsApp.GroupApp.getCurrentGroup():zmail.mailLeft.selId},getCurrentView:function(e){if(!zmsuite.isWorkspaceAvailable||!zmsuite.isWorkspaceAvailable("zmStreamsApp"))return{};zmStreamsApp.constants.setElements();var t=(e=e||zmStreamsApp.constants.elements.postHolder).find("#stabHol").children(".stSel"),n=$.e(t).data("type");return{elm:e.find("#s_postview #s_"+n),view:n="userPost"===n||"hashTag"===n||"label"===n?"other":n,tab:t}},publishKeyEvent:function(e){$.publish("zmstreamsapp/keyevent",{data:e})},highlightPostAndScroll:function(e,t){var n=$.q("body")[0].getBoundingClientRect(),a=e.offset().top,i=a+e.height(),o="zmStreamsApp"===zmTab.currentTab,s=o?40:0,r=(o?e.parents("#zm_stHolder"):e.parent()).offset().top+s,m=t?a<r:i>n.height;if(e&&m){var l;l=t&&o?"center":"start",e[0].scrollIntoView({behavior:"instant",block:l})}},markAsReadProgress:function(e,t,n){var a,i,o,s=zmStreamsApp.events.getCurrentView()||{},r=$.e(s.elm).data("groupId");if(n)return"unread"===s.view&&(r===zmail.zuid?(o=$.e(s.elm).find('div[data-gid="'+e+'"]')).find(".zmMarkReadProgress").length?(o.remove(),$.e(s.elm).children().length||zmStreamsApp.events.clearList(e)):e===zmail.zuid&&zmStreamsApp.events.clearList(e):zmStreamsApp.events.clearList(e)),void((a=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree")).el.length&&zmStreamsApp.util.addReadLoader(e,a,!0));"unread"===s.view&&(t?(i=(o=$.e(s.elm).find('div[data-gid="'+e+'"]')).find(".SC_grpPosts"),o.find(".morePosts").remove()):r===e&&(i=s.elm),i&&($.e(i).data("postlist",[]),zmStreamsApp.util.detachAndRemove(i[0]),$.e(i).empty().appendDOM(zmStreamsApp.PostApp.template.markAllReadProgress())),zmStreamsApp.util.closePreview()),e!==zmail.zuid&&(a=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree")).el.length&&zmStreamsApp.util.addReadLoader(e,a)},getMarkReadProgress:function(e){var t=zmStreamsApp.GroupApp.getModel(e);return!!t&&t.get("markAllReadProgress")},getListHolders:function(e){var t,n,a=[];return zmsuite.isWorkspaceAvailable("zmStreamsApp")&&(e&&zmStreamsApp.GroupApp.getCurrentGroup()===e||!e)&&(n="zmStreamsApp"),n&&(t=zmsuite.getWorkSpace(n)[0].$el.find("#s_postview")),t&&t.length&&a.push(t),a},openPost:function(e){var t=e.ntype;if("43"===t||"38"===t&&e.shId)return e.sharedMail=!0,void(2===e.opentype?zmUtil.loadSharedFolMailOnTab(e):zmList.showNotificationPopup(e));if(e.commentuuid){var n=e.commentuuid;n instanceof Array&&(n=n[0]),e.commentId=n}zmStreamsApp.PostApp.singlePost(e)},setMaxHeight:function(e,t,n,a){var i,o=$.e(e).find(".SC_ptit",e)[0],s=0,r=$.e(window).height(),m=$.e(e).hasClass("zmNotiPopUp")?e[0]:$.e(e).parent(".zmNotiPopUp")[0],l=0;o&&(s=o.getBoundingClientRect().height),$.e(e).hasClass("SC_DrftShr")&&(m=$.e(e).parent(".zmScCmnt")[0]),m&&(l=m.getBoundingClientRect().top)<=0&&(n.style.maxHeight="300px",l=m.getBoundingClientRect().top);var p=$.e(n).innerHeight()-$.e(n).height(),c=t?t.getBoundingClientRect().height:0,d=r-(l+zmUtil.wmsBarHeight())-(c+s+p);if(n.style.maxHeight=d+"px",$.e(e).hasClass("SC_DrftShr")){var u=$.e(e).find(".zmPostActions"),g=d-(u[0]?u[0].getBoundingClientRect().height:0)+"px";$.e(e).find(".SCS_draftCmnt").css("maxHeight",g),i=(m?m.getBoundingClientRect().height/2:190)||60,$.e(t).find(".cmntText").css("maxHeight",i)}if(a){var f=t.getBoundingClientRect().height+15,v=$.e(e).parents(".SC_Twpr");if(!v.length)return;var h=$.e(v)[0].getBoundingClientRect().height;setTimeout(function(){if($.e(v).css("bottom",f+"px"),v.length){var e=zmInit.cliWid;e||(e=document.body.getBoundingClientRect().width),i=h/2,$.e(t).css({position:"fixed","will-change":"transform"}).show(),$.e(t).find(".cmntText").css("maxHeight",i)}},200)}},createWorkSpace:function(a){var i=a.msgId||a.pid,o="Streams_"+i;if(zmsuite.isWorkspaceAvailable(o)&&"restore"!==a.src)return zmsuite.showWorkSpace(o),!1;var e,t=((e=zmsuite.createAppRouter())._hashKey="stream",e.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),e.setParams(["tab",a.gid,i,a.etype,a.actionType]),e),s={appname:"Streams single post",appId:o,appIcon:"msi-post",data:{CNodes:"3"},router:t,onDelete:function(){return zmStreamsApp.util.removeViews(void 0,zmsuite.getCenter(o)[0].$el[0]),!0}};if($.subscribe("zmstreamsapp/deletePost",function(e,t){var n=t.id;-1===i.indexOf("#")&&(n=t.id.split("#")[1]),n===i&&zmsuite.isWorkspaceAvailable(o)&&zmsuite.closeWorkspace(o)}),"restore"===a.src&&zmsuite.isWorkspaceAvailable(o))s.appname=zmTab.getTabObject(o).appname,zmsuite.resetWorkspace(o,s);else if(!zmsuite.setWorkSpace(s))return{maxTabSize:!0};var r=zmsuite.getCenter(o)[0].getNodes();zmsuite.renderWorkSpace(),zmsuite.showWorkSpace(o),a.elm=r[2].$el[0],a.allComments=!0;var m={actionType:a.actionType,etype:a.etype,gid:a.gid,pid:a.pid};return a.callback=function(e,t){if(!a.opentype){var n={list:{left:{leftText:t,centerAlign:!0}}};r[1].push(n.list),s.appname=t,zmTab.updateTabLst(s),zmsuite.getCenterOuter(o).paint(),$.e(a.elm).scroll(function(){zmUtil.hideMenu()}),$.publish("zmail/SaveTabState",[{appId:o,app:"stream",appObj:{appname:t,appIcon:"msi-post"},category:"stream_post",data:m}])}},a},openPostInTab:function(e){var t=zmStreamsApp.constants,n=e.pid||e.msgId;e.markRead=!0;var a=String(e.etype);if(e.isMail||a===t.streamTypeName.mail){-1!==n.indexOf("t")&&(n=n.substring(1,n.length)),e.opentype=2;var i=zmUtil.getMailObj(n);if(i&&i.groupId){e.gid=i.groupId,e.pid=e.thId||n,e.etype=t.streamTypeName.mail,e.cachedData=!0;var o="zm_tab"+(i.T?"t":"")+n;if(zmsuite.isWorkspaceAvailable(o))return void zmsuite.showWorkSpace(o);"notification-popout"===e.invokedFrom&&zmUtil.publishCloseNotif()}e.allComments=!0,e.isTab=!0,zmStreamsApp.events.openPost(e)}else if("group"===e.gid)zmStreamsApp.init(n);else if(a===t.streamTypeName.task){var s={groupId:e.gid,entityId:n,commentId:e.commentId,opentype:"tab"},r=zmail.isTaskNewUIEnabled?"taskNEWPreview":"taskPreview";zmUtil.requireTaskModule(r).then(function(){zmail.isTaskNewUIEnabled?zmTask.NEWPreview(s):zmTask.Preview(s)})}else if(a===t.streamTypeName.note)zmUtil.loadNotes("openNoteInTab",{e:n,gId:e.gid,commentId:e.commentId});else{if((e=zmStreamsApp.events.createWorkSpace(e)).maxTabSize)return;e&&zmStreamsApp.events.openPost(e)}if(a===t.streamTypeName.note||a===t.streamTypeName.task){var m=zmStreamsApp.PostApp.getModelForEntity(e.gid+"#"+n,a);m&&m.markRead()}},clearList:function(e){var t=zmStreamsApp.events.getCurrentView();if(t&&($.e(t.elm).data("groupId")===e&&"unread"===t.view)){$.e(t.elm).data("postlist",[]),zmStreamsApp.util.detachAndRemove(t.elm[0]);var n=$.e(t.tab).parent().siblings(".postFilter")[1];n&&$.e(n).hide(),$.e(t.elm).empty().appendDOM(zmStreamsApp.PostApp.template.noPost()),zmStreamsApp.util.closePreview()}},loadPostsOfUsers:function(e){var t=String(e.zid),n=e.gid,a=e.dialog,i=e.name||"";if("zmStreamsApp"===zmTab.currentTab&&zmStreamsApp.events.getCurrentGroupId()===n){var o=zmStreamsApp.events.getCurrentView(),s=zmStreamsApp.util.getContactDetails([t])[t];s=s.isDummyObj?i:s.fn,zmStreamsApp.util.closePreview(),zmail.zuid===String(t)&&zmStreamsApp.events.getCurrentGroupId()!==zmail.zuid?o.tab.siblings("li[data-type='byme']").trigger("click"):"other"===o.view&&s===$.q("#s_zms_otherT").find("span").text()||(zmStreamsApp.PostApp.showOtherTab(s,"userPost",t,n),zmStreamsApp.PostApp.fetchPosts({type:"other",ele:o.elm,previous:o.tab}))}else{var r=[{name:zmail.Search.Utils.CommonUtil.appUtil.filterConstantsNames.PostedBy,value:t},{name:zmail.Search.Models.Filters.GroupFilter.name,value:n}];zmStreamsApp.util.triggerSearch(r)}a&&a.remove()},listHashTags:function(e){var t=(e=e||{}).gid,n=e.tag;if(zmUtil.publishCloseNotif(),"zmStreamsApp"===zmTab.currentTab&&t!==zmail.zuid&&zmStreamsApp.events.getCurrentGroupId()===t){zmStreamsApp.util.closePreview();var a=zmStreamsApp.events.getCurrentView();zmStreamsApp.PostApp.showOtherTab("#"+n,"hashTag",n,t),zmStreamsApp.PostApp.fetchPosts({type:"other",ele:a.elm,previous:a.tab})}else{var i=zmail.Search.Models.Filters,o=[{name:i.HashtagFilter.name,value:{name:e.tag}}];e.gid!==zmail.zuid&&zmail.ContactBook.isGroup(e.gid)&&o.push({name:i.GroupFilter.name,value:e.gid}),zmStreamsApp.util.triggerSearch(o)}},groupAction:function(e){zmUtil.hideMenu();var t=e.action,n=e.gid;if(n&&t)switch(t){case"viewMembers":zmStreamsApp.util.loadMemberPopup(n);break;case"createChat":zmStreamsApp.GroupApp.createGroupChat(n);break;case"email":zmStreamsApp.GroupApp.emailGroup(n);break;case"markRead":zmStreamsApp.GroupApp.markAllRead(n);break;case"hideGroup":zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.hideGroup(n)});break;case"editGroup":zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.triggerEditGroup(n,[{tab:"General",default:!0},{tab:"Calendar"},{tab:"Task"},{tab:"Members",callback:zmStreamsApp.events.loadPostsOfUsers}])})}},showContactCard:function(e){e=e||{};var t=zmStreamsApp.constants,i=e.zid||"",o=e.elm,n=e.groupId,a=String(e.eType);if($.e(o).data("show",""),!zmStreamsApp.util.getContactDetails([i])[i].isDummyObj){var s=[];if(zmUtil.isGroupMember(i,n)){var r={zid:i,gid:n};s.push({htm:p.common.labels.viewposts,clk:this.listUserPosts,id:"post",args:[r]});var m=i===zmail.zuid;a===t.streamTypeName.note?s.push({htm:m?p.common.labels.notesbyme:p.common.labels.viewnotes,clk:this.listUserPosts,id:"notes",args:[r]}):a===t.streamTypeName.task&&(s.push({htm:m?p.common.labels.tasksbyme:p.common.labels.viewtasksby,clk:this.listUserPosts,id:"taskby",args:[r]}),s.push({htm:m?p.common.labels.taskstome:p.common.labels.viewtasksto,clk:this.listUserPosts,id:"taskto",args:[r]}))}var l=zmStreamsApp.events.getCurrentView();this.cardTime=setTimeout(function(){var e=$.e(o).data("show"),t=$.q("#zm_dropDown"),n="",a=zmStreamsApp.events.getCurrentView().view;t&&(n=t.data("zid")),"false"!==e&&n!==i&&l.view===a&&$.e(document).find($.e(o)).length?zmConUtil.showContactCard({dom:o,items:s,event:null,source:"streams",hideOnBlur:!0}):$.e(o).data("show","")},750)}},listUserPosts:function(e,t,n){n&&n.remove(),zmStreamsApp.util.hideMenu();var a=(t=t||{}).zid,i=t.gid;switch(this.id||t.data){case"post":zmStreamsApp.events.loadPostsOfUsers(t);break;case"notes":zmUtil.invokeNoteSearch({zuid:a,groupId:i}),$.publish("zm/closeAllOpenDialog");break;case"taskby":zmUtil.requireTaskModule("taskSearchUtil").done(function(){zmTask.Search.listTaskSearchAction({zuid:a,groupId:i,type:"addedby"})});break;case"taskto":zmUtil.requireTaskModule("taskSearchUtil").done(function(){zmTask.Search.listTaskSearchAction({zuid:a,groupId:i,type:"assignedto"})})}},commentBoxMaxHeight:function(e){var t=$.e(e).parents(".cmntText"),n=$.e(e).parents(".zm_mention"),a=$.e(e).parents(".SCS_popUp"),i=0;if(a.length){var o=$.e(a).find(".SC_ptit");o.length&&(i=o[0].clientHeight)}if(!t.length||!n.length)return 0;var s=t.siblings(".cmntActions"),r=0;s.length&&(r=s[0].clientHeight);var m=t.find(".zms_rep"),l=0;m.length&&(l=m[0].clientHeight);var p=t.find(".showLink"),c=0;p.length&&(c=p[0].clientHeight);var d=window.parseInt(t.css("max-height"));d=window.isFinite(d)?d:0;var u=window.parseInt(n.css("padding-top"));u=window.isFinite(u)?u:0;var g=window.parseInt(n.css("padding-bottom"));return d-(u+(g=window.isFinite(g)?g:0)+l+c+i+r)}}}(),zmStreamsApp.linkPreview=function(e){e=e||{};var i=zmText.get("streams"),l=function(e){var t=zmHash.decode(e),n={};return t&&"stream"===t.key&&("tab"===t.params[0]?(n.etype=t.params[3],n.cId=t.params[5]):(n.etype=t.params[2],n.cId=t.params[4])),n},p=function(e){var t={};return t.url=e.linkUrl,t.title=e.title,t.description=e.desc,t.tags=e.tags,t.thumbnails=e.imageUrls,t.linkhtml=e.html||"",t.videoURL=e.videoUrl||"",t.title&&100<t.title.length&&(t.title=t.title.substr(0,97)+"..."),t.description&&200<t.description.length&&(t.description=t.description.substr(0,197)+"..."),t.tags&&10<t.tags.length&&(t.tags=t.tags.slice(0,10)),t.thumbnails&&20<t.thumbnails.lenth&&(t.thumbnails=t.thumbnails.slice(0,20)),t},c=function(a){return function(e){var t=zmStreamsApp.PostApp.models.posts.get(a)||{};if((("function"==typeof t.get?t.get("myact"):{})||{}).showinvite){var n=zmStreamsApp.events.getCurrentView();zmStreamsApp.PostApp.showOtherTab("#"+e,"hashTag",e,t.getGroupInfo().id),zmStreamsApp.PostApp.fetchPosts({type:"other",ele:n.elm,previous:n.tab})}else _zm.succErrMsg("e",i.common.messages.noHashTagSearch)}};return e.getLinkInfoFromComponentData=function(e){var t={};return e=e||{},t.linktitle=e.title||"",t.linkdesc=e.description||"",t.linkurl=e.url||"",t.linkhtml=e.linkhtml||"",t.videourl=e.videoURL||"",e.thumbnailURL&&(t.imageurls=[e.thumbnailURL]),e.tags&&e.tags.length&&(t.linktags=e.tags),t},e.addLinkPreviewToPost=function(e,t,n){if(e.link&&e.link.linkUrl){var a,i={},o=e.link;a=p(o),i.editMode=!1,i.data=a,i.playVideoInline=!0;var s=l(a.url);s.etype&&(i.data.entityType=s.etype,s.cId&&(i.data.isComment=!0)),i.appName="post";var r=zmLinks.createComponent(i);a.tags&&a.tags.length&&r.setConfig("onHashTagClick",c(n));var m=$.e(t).find(".postMsg")[0];m&&$.e(r.getDOM()).insertDOMAfter(m)}},e.addLinkPreviewToComment=function(e,t,n){if(e.link&&e.link.linkUrl){var a,i={},o=e.link;a=p(o),i.editMode=!1,i.data=a,i.playVideoInline=!0;var s=l(a.url);s.etype&&(i.data.entityType=s.etype,s.cId&&(i.data.isComment=!0)),i.appName="comment";var r=zmLinks.createComponent(i);a.tags&&a.tags.length&&r.setConfig("onHashTagClick",c(n)),t.appendChild(r.getDOM())}},e.addDataToParams=function(e,t){for(var n in e)t[n]=e[n];t.imageurls&&(t.imageurls=t.imageurls.join("\n")),t.tags&&(t.tags=t.tags.join("\n"))},e.getComponentDataFromLinkInfo=p,e}(),window.zmLinks=function(b){b=b||{};var e,S,h=zmText.get("streams","linkPreview"),r="click",m="mouseup",l="mousedown",z=".closeIcon",A=zmail.streamsLinkPreviewSupportedUrls||["connect","projects","mail","zmail","bugtracker"],w={6:"msi-status",1:"msi-mail",2:"msi-notes",3:"msi-task",4:"msi-calendar",10:"msi-links"},t=function(e){this.url=e,this.title="",this.description="",this.images=[],this.tags=[],this.hasData=!1,this.videoURL="",this.isZohoDocsURL=!1,this.linkhtml=""},n=function(t){var n,a=function(e){e&&e.st?n(!0,e):n(!1),S=null},i=function(){n(!1),S=null};return{done:function(e){n=e,S=zmAjq.XHR({u:zmail.conPath+"/link.do",t:"POST",p:{link:t,mode:"link",actionType:"getLinkDetails"},fn:a,efn:i})}}};t.prototype={loadData:function(){var a,i=this;return{then:function(e){a="function"==typeof e?e:function(){},i.hasData?a(i):n(i.url).done(function(e,t){if(e&&t.st){if(i.hasData=t.st,i.url=t.linkUrl||i.url,i.title=t.title||"",i.description=t.desc||"","string"==typeof t.imageUrls&&(t.imageUrls=[t.imageUrls]),i.images=t.imageUrls||[],i.tags=t.tags||[],i.videoURL=t.videoUrl||"",i.linkhtml=t.html||"","ZohoMail"===t.serviceName){if(i.entityType=t.entityType,i.isComment=t.isComment,!t.imageUrls&&t.authorZuid){var n=zmStreamsApp.util.getContactDetails([t.authorZuid])[t.authorZuid];i.images=[n.photo]}t.entityTitle&&t.desc?i.description=t.entityTitle+" - "+t.desc:i.description=t.entityTitle||t.desc}else"ZohoConnect"===t.serviceName?i.images=["https://connect."+zmail.zohoUrl+"/favicon.ico"]:"ZohoProjects"!==t.serviceName&&"ZohoBugTracker"!==t.serviceName||(i.images=["https://projects."+zmail.zohoUrl+"/favicon.ico"]);$.e(i).trigger("changed",i),a(i)}else a()})}}},subscribeChanges:function(e){$.e(this).on("changed",e)},unsubscribeChanges:function(e){$.e(this).off("changed",e)}};var p=function(e,t){return e=e||"",(t=t||[]).indexOf(e)},a=function(d){(d=d||{}).data=d.data||{},d.data.tags=d.data.tags||[],d.data.thumbnails=d.data.thumbnails||[];var u,n={},g=d.data,f={},v=0;g.thumbnails.length&&(g.thumbnailURL=g.thumbnails[v]);var t=function(e){return function(n){(n=n||{}).data=n.data||{};var t,a={},i=n.data,o=function(){var e=i.name||"";t=zdom("div",{className:"zmLkTag"},zdom("span",{title:e},e),zdom("i",{title:h.tooltips.removeTag,className:"msi-close"})),n.editMode||$.e(t).find("i").remove(),$.e(t).off().on("click",function(e){"function"==typeof n.onTagClick&&n.onTagClick(a),_zm.stopEvents(e)}),"function"==typeof n.onRemoveTag&&$.e(t).find("i").off().on("click",function(e){n.onRemoveTag(a),_zm.stopEvents(e)})};return a.setData=function(e,t){i[e]=t,o()},a.setConfig=function(e,t){n[e]=t,o()},a.getData=function(e){return e?i[e]:i},a.getDOM=function(){return t},o(),a}({editMode:d.editMode,data:{name:e},onRemoveTag:function(){n.removeTag(e)},onTagClick:function(e){if("function"==typeof d.onHashTagClick){var t=e.getData();d.onHashTagClick(t.name)}}})},a=function(){!function(){if(g.tags&&g.tags.length)for(var e in f={},g.tags)f[e]=t(g.tags[e])}(),function(){var e,t="";(e=g).title&&100<e.title.length&&(e.title=e.title.substr(0,97)+"..."),e.description&&200<e.description.length&&(e.description=e.description.substr(0,197)+"..."),e.tags&&10<e.tags.length&&(e.tags=e.tags.slice(0,10)),e.thumbnails&&20<e.thumbnails.lenth&&(e.thumbnails=e.thumbnails.slice(0,20));var n=(g=e).title||"",a=g.description||"",i=zmUtil.getHostName(g.url),o=g.tags&&g.tags.length?"linkTag zmLkTagWrap":"zmLkTagWrap SC_dyn",s=d.editMode?"inStreamsBox":"";s||(s=d.editMode||"post"!==d.appName?"inComment":"inStreams");var r=[];if(g.linkhtml&&(r=zdom("div",{className:"zmLkPvIcon rightAlign  zmAMB"},zdom("div",{className:"zmAMG previewIcon"},zdom("div",{className:"zmAMItem zmAMsmall zmAMTextItem zmThmClr"},zdom("div",{className:"zmAMWra"},zdom("i",{className:"msi-preview zmAMIcon"}),zdom("span",{className:"zmAMText"},h.messages.preview)))))),g.thumbnails&&g.thumbnails.length&&(t=g.thumbnails[v]||"")&&zmUtil.loadImage(t),u=zdom("div",{className:"zmLkPv showLink "+s},zdom("div",{className:"zmLkPvImg imageDiv"},zdom("img",{src:t}),zdom("i",{className:"msi-play"}),zdom("div",{className:"zmLkImgCtrl"},zdom("i",{className:"msi-larrow"}),zdom("i",{className:"msi-rarrow"}))),zdom("div",{className:"zmLkPvCont"},zdom("div",{className:"zmLkPvTitle titleIcon"},zdom("span",{className:"zm_linkTitle"},n)),zdom("div",{className:"zmLkPvDesc"}," ",zdom("span",null,a)),zdom("div",{className:"zmLkPvBtm"},zdom("div",{className:"zmLkPvLink"}," ",zdom("span",null,i)),r),zdom("div",{className:"zmLkPvClose closeIcon"},zdom("div",{className:"zmAMItem zmAMsmall"},zdom("div",{className:"zmAMWra"},zdom("i",{className:"msi-close zmAMIcon"})))))),g.entityType){var m=w[g.entityType];g.isComment&&(m="msi-comment"),$.e(u).find(".titleIcon").prependDOM(zdom("i",{className:m}))}if(g.videoURL&&!d.editMode||$.e(u).find(".msi-play").remove(),d.editMode||$.e(u).find(z).remove(),g.tags&&g.tags.length){var l=zdom("div",{className:"zmLkPvWrap"});$.e(l).appendDOM($.e(u));var p=$.e(zdom("div",{className:o}));for(var c in $.e(l).appendDOM(p),g.tags)f[c]&&p.appendDOM(f[c].getDOM());u=l}g.thumbnails&&g.thumbnails.length||$.e(u).find(".imageDiv").remove(),(!g.thumbnails||g.thumbnails.length<2)&&($.e(u).find(".msi-larrow").remove(),$.e(u).find(".msi-rarrow").remove())}(),e()},i=function(e,t){var n=g.thumbnails.length?g.thumbnails.length-1:0;if(0<=e&&e<=n)v=e,g.thumbnailURL=g.thumbnails[v],$.e(u).find(".imageDiv img").attr("src",g.thumbnailURL);else{var a=t?h.messages.noPrevThumbnails:h.messages.noNextThumbnails;_zm.succErrMsg("e",a)}},o=function(e){var t=e.innerHeight(),n=e.innerWidth();e.find(".frameWindow").css({"max-height":t,"max-width":n});var a=e.find("iframe")[0];a.height=t+"px",a.width=n+"px"};e=function(){var t,n;$.e(u).off(l).on(l,function(){window.getSelection&&(t=(t=window.getSelection()||"").toString())}),$.e(u).off(m).on(m,function(){window.getSelection&&(n=(n=window.getSelection()||"").toString())}),$.e(u).off(r).on(r,function(e){t===n&&zmUtil.openLink(g.url),_zm.stopEvents(e)}),$.e(u).find(".msi-larrow").off().on(r,function(e){i(v-1,!0),_zm.stopEvents(e)}),$.e(u).find(".msi-rarrow").off().on(r,function(e){i(v+1),_zm.stopEvents(e)}),$.e(u).find(".previewIcon").off().on(r,function(e){_zm.stopEvents(e),zmAppLoader.load("slideshowComp"),function(){var t=zdom("div",{className:"previewView SC_Pop blk SC_cent zm_lightBox",tabIndex:"0"},zdom("div",{className:"SC_pe frameWindow",style:{overflow:"hidden"}},zdom("div",{className:"SC_oh iframe"})),zdom("div",{className:"noclk closeIcon"},zdom("div",{className:"ZAt_cls"},zdom("i",{className:"msi-close"}))));$.e(t).find(".iframe").dangerouslySetInnerHTML(g.linkhtml);var e=$.e(t).find("iframe");e.css({visibility:"hidden"}),$.e(t).find(".iframe").appendDOM(zmAttachment.templates.loadingTemplate()),$.q("body").appendDOM(t),e.on("load",function(){$.e(t).find(".At_load").remove(),e.css({visibility:"visible"}),o($.e(t))}),e.on("error",function(){$.e(t).find(".loadingBar").remove()}),$.e(t).find(z).off().on("click",function(){$.e(t).remove()}),$.e(t).off().on("keydown",function(e){27===e.keyCode&&$.e(t).remove()}),$.e(t).focus();var n=function(){$.e(t).length&&o($.e(t))};$.e(window).off("resize",n).on("resize",n)}()});var e=function(e){g.videoURL&&(!0===d.playVideoInline?function(){if(g.videoURL&&!d.playerLoading){var e=b.getVideoIframe(g.videoURL);if(e){var t=$.e(u)[0];$.e(e).insertDOMBefore(t),$.e(t).hide(),d.playerLoading=!0}}}():"function"==typeof d.onPlayVideo&&d.onPlayVideo(),_zm.stopEvents(e))};$.e(u).find(".imageDiv img").off().on(r,e),$.e(u).find(".msi-play").off().on(r,e),"function"==typeof d.onRemovePreview&&$.e(u).find(z).off().on(r,function(e){d.onRemovePreview(),_zm.stopEvents(e)})};var s=function(e){e instanceof b.LinkData&&(g.url=e.url||"",g.title=e.title||"",g.description=e.description||"",g.thumbnails=e.images,g.linkhtml=e.linkhtml||"",g.thumbnails&&g.thumbnails.length&&(g.thumbnailURL=g.thumbnails[0]),g.tags=e.tags,g.videoURL=e.videoURL||"",e.entityType&&(g.entityType=e.entityType),g.isComment=e.isComment)};return n.setConfig=function(e,t){d[e]=t,"data"===e&&(g=d.data,v=0,g.thumbnails.length&&(g.thumbnailURL=g.thumbnails[v])),a()},n.setData=function(e,t){g[e]=t,a()},n.setTags=function(e){for(var t in e=e||[])n.addTag(t,!0);a()},n.addTag=function(e,t){(e=e||"")&&-1===p(e,g.tags)&&(g.tags.push(e),t||a())},n.removeTag=function(e){var t=p(e=e||"",g.tags);e&&-1!==t&&(g.tags.splice(t,1),a())},n.getDOM=function(){return u},n.getData=function(e){return e?g[e]:g},n.initFromLink=function(e){var t=new b.LinkData(e);t.loadData().then(function(){t.hasData&&(s(t),a())})},d.linkData instanceof b.LinkData&&s(d.linkData),a(),n},i=zdom("iframe",{className:"SC_ve",style:{minWidth:"400px",height:"300px",width:"100%",frameborder:"0"},webkitallowfullscreen:!0,mozallowfullscreen:!0,allowFullScreen:!0}),C={YOUTUBE:{urlPatterns:[/(?:https?:\/\/)?[^.\s]+\.youtube\.[^./]+\/[^\s]*watch\?[^\s]*v=([^\s&#/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?[^.\s]+\.youtube\.[^./]+\/v\/([^\s&#/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?youtu\.be\/([^\s&#/]+)(?:&t=([^\s&#]+))*[^\s]*/g],iframeURL:"//www.youtube.com/embed/{{videoID}}{{extraParams}}",timeParseRegex:/(?:([0-9]*)h)*(?:([0-9]*)m)*(?:([0-9]*)s)*/gi},VIMEO:{urlPatterns:[/(?:https?:\/\/)?vimeo\.[^./]+\/([^\s&#/]+)[^\s]*/g],iframeURL:"//player.vimeo.com/video/{{videoID}}"},DAILYMOTION:{urlPatterns:[/(?:https?:\/\/)?[^.\s]+\.dailymotion\.[^./]+\/video\/([^\s&#/_]+)[^\s]*/g,/(?:https?:\/\/)?dai.ly\/([^\s&#/_]+)[^\s]*/g],iframeURL:"//www.dailymotion.com/embed/video/{{videoID}}"},FACEBOOK:{urlPatterns:[/(?:https?:\/\/)?[^.\s]+\.facebook\.[^./]+\/[^\s]*videos\/([^\s&#/]+)*[^\s]*/g],iframeURL:"//www.facebook.com/video/embed?video_id={{videoID}}"}},o=function(e){var t,n,a,i,o,s,r,m,l,p,c,d,u,g=Object.keys(C);for(t=0,n=g.length;t<n;t++){for(o=0,s=(a=C[g[t]]).urlPatterns.length;o<s;o++)if(void((i=a.urlPatterns[o]).lastIndex=0),null!==(l=i.exec(e))&&(i.lastIndex=0,l[1])){r=l[1],m=l[2]||"";break}if(r)return p=a.iframeURL.replace(/\{\{videoID\}\}/,r),p=m?((c=a.timeParseRegex).lastIndex=0,(d=c.exec(m))[1]=parseInt(d[1])||0,d[2]=parseInt(d[2])||0,d[3]=parseInt(d[3])||0,u=3600*d[1]+60*d[2]+d[3],p.replace(/\{\{extraParams\}\}/,"?start="+u)):p.replace(/\{\{extraParams\}\}/,"")}},s="zmlinks_"+Math.round(1e3*Math.random())+"_",c=1,y={},d=function(o){var n,t,e,a={},i=!1,m={},s="",r=function(){},l=function(){},p=function(){},c=function(e){m[e]=!0},d=function(){var e=zdom("div",{className:"SC_lpload"});zmComponent.loadingBand({type:"pagination",container:e});return{show:function(){t&&t.appendDOM(e)},hide:function(){e&&$.e(e).remove()}}}(),u=function(){var e=n;n=void 0,e&&$.e(e.getDOM()).remove(),p(e)},g=function(t){n||function(e){var t,n=Boolean(m[e]);if(n=n||-1===e.indexOf("http")&&-1===e.indexOf("www"))return n;n=n||-1!==e.indexOf("."+zmail.zohoUrl);for(var a=0,i=A.length;a<i;a++)if(-1!==e.indexOf(A[a])){n=-1!==A[a].indexOf("mail")&&-1===e.indexOf("#stream");break}if(zmail.isBaihui&&!n)for(var o in C)if("YOUTUBE"===o||"FACEBOOK"===o)for(var s=0,r=(t=C[o].urlPatterns).length;s<r;s++)if(t[s].lastIndex=0,null!==t[s].exec(e)){n=!0;break}return n}(t)||s===t||(r(s=t),b.createComponentFromLink(t,{editMode:!0,onRemovePreview:function(){c(t),u()}}).then(function(e){d.hide(),s&&(s="",e?(u(),l(n=e)):c(t))}),d.show())},f=function(){var e,t=o.tagName;e="TEXTAREA"===t||"INPUT"===t?o.value:o.innerText;var n=zmUtil.parseURLS(e);if(n.length)for(var a in n){var i=n[a].url;if(!m[i])return void g(i)}},v=function(){e&&e.unbind()},h=function(){return i=!0,s="",m={},u(),v(),e=zmUtil.bindInputTextChange({input:o,callback:f}),i=!1,a},z=function(){return h()};return a.setLinkFoundCallback=function(e){var t;return r="function"==typeof(t=e)?function(){i||t.apply(this,arguments)}:function(){},a},a.setComponentReadyCallback=function(e){var t;return l="function"==typeof(t=e)?function(){i||t.apply(this,arguments)}:function(){},a},a.setPreviewRemovedCallback=function(e){var t;return p="function"==typeof(t=e)?function(){i||t.apply(this,arguments)}:function(){},a},a.setProgressDisplayDOM=function(e){return t=e?$.e(e):void 0,a},a.reset=function(){return z()},a.getPreview=function(){return n},a.getPreviewData=function(){return n&&n.getData()},a.destroy=function(){z(),v(),y[o]=void 0,delete y[o]},a.removeLoadingBar=function(){d.hide(),S&&S.abort()},h(),a};return b.PreviewManager=function(e){var t=$.e(e).attr("data-zmlinks");return t||(t=s+Date.now()+"_"+c++,$.e(e).attr("data-zmlinks",t)),y[t]||(y[t]=d(e)),y[t]},b.PreviewManager.destroy=function(){for(var e in y)y[e].destroy()},b.getVideoIframe=function(e,t){var n=o(e);if(n+=(-1!==n.indexOf("?")?"&":"?")+"autoplay=true"){var a=$.e(i).attr("src",n)[0];return"function"==typeof t&&$.e(a).on("load",function(){t()}),a}},b.isURLEmbeddable=function(e){return Boolean(o(e))},b.createComponentFromLink=function(n,a){var i;return{then:function(e){var t;i=e,(t=new b.LinkData(n)).loadData().then(function(){if(t.hasData){a.linkData=t;var e=b.createComponent(a);i(e)}else i()})}}},b.createComponent=function(e){return a(e)},b.requestLinkData=n,b.LinkData=t,b}();