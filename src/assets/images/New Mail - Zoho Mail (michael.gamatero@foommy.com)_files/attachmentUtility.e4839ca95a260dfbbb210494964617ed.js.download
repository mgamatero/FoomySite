"use strict";!function(t){var s=zmText.get("attachmentUtility");t.templates=t.templates||{},$.extend(t.templates,{filterDropDwon:function(){var t=s.filterMenu,e=_zm.isStreamsEnabled()?zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttGrp"})),zdom("label",null,t.group)):"";return zdom("div",{className:"zmFilterDD zm_attFltr"},zdom("div",{className:"zmAttFilter"},zdom("div",{className:"SC_floatLabelRow fLCol4"},e,zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttEntity"})),zdom("label",null,t.attFrom)),zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttFilTyp"})),zdom("label",null,t.attType)),zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttLbl"})),zdom("label",null,t.tags))),zdom("div",{className:"SC_PUbtm SC_tranbdr"},zdom("span",{id:"attFilter",className:"sel"},t.filter),zdom("span",{id:"filterCncl","data-val":"Cancel"},t.cancel))))},cloudFrame:function(t){return zdom("iframe",{src:t,frameBorder:"0",id:"cloudIframe",style:{height:"100%",width:"100%"}})},favIcon:function(t){var e="msi-fav",a=s.UserMsg.fav;return t&&(e+=" SC_fav",a=s.UserMsg.remFav),zdom("i",{className:e,"data-tooltip":a,"data-tooltip-pos":"bottom"})},zmFdrBox:function(t,e,a){var i=s.UserMsg,n=[];return a!==zmAttachUtility.fileType.hugeAttachment&&n.push(zdom("i",{className:t,"data-tooltip":e,"data-tooltip-pos":"bottom"})),zdom("div",{className:"zmFdr"},zdom("span",null,n,zdom("i",{className:"msi-send","data-tooltip":i.attachToNewMail,"data-tooltip-pos":"bottom"}),zdom("i",{className:"msi-download","data-tooltip":i.download,"data-tooltip-pos":"bottom"}),zdom("i",{className:"msi-action","data-tooltip":i.more,"data-tooltip-pos":"bottom"})))},divZmFrm:function(t){return zdom("div",{className:"zmFrm"},zdom("span",{id:"thumbView","data-tooltip":t,"data-tooltip-pos":"bottom"},zmUtil.getSubString(17,t)),zdom("span",{id:"listView","data-tooltip":t,"data-tooltip-pos":"bottom"},zmUtil.getSubString(40,t)))},attListingTemplate:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return zdom("div",{className:"zmL SC_Pbar",title:t.name},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze"},zdom("span",{className:"sum"},t.size)),zdom("div",{className:"zmSub"},zdom("span",{"data-name":"rename"},s.UserMsg.rename),zdom("span",{"data-name":"download"},s.UserMsg.download),zdom("i",{className:"msi-action","data-tooltip":s.UserMsg.more,"data-name":"showMore"})),zdom("div",{className:"zmFrm"},zdom("span",{"data-name":"filename"},zmUtil.getSubString(20,t.name))),zdom("div",{className:"zmImg"},t.image),zdom("div",{className:"SC_icn"},zdom("i",{className:"msi-close"})))))},attPrevInr:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=zmUtil.fileTyp(t.fn,t.attType);return t.thn?zdom("img",{src:t.thn}):zdom("i",{className:"".concat(e[1]," zm-attIcn")})},prevTopDom:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return zdom("div",{id:"zmPhdAtt",className:"SC_ptit"},zdom("div",{className:"SCmb SC_frt"},zdom("ul",null,zdom("li",null,zdom("b",{className:"SC_nrr"},zdom("i",{className:"msi-prev"}))),zdom("li",null,zdom("b",{className:"SC_nlr"},zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-next"})))),zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-close"}))))),zdom("div",{className:"SC_phd",title:t},zmUtil.getSubString(40,t)))},prevMainDom:function(t,e){var a=s.UserMsg.addLabel;return zdom("div",{className:"SC_Twpr"},zdom("div",{className:"SC_pct zmAvi"},zdom("div",{id:"zmHdrAtt",className:"zmPHdr zmAPHdr"},zdom("div",{className:"zmPT"},zdom("div",{className:"zmpr"},zdom("div",{className:"SCmb SC_frt"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-action"}),zdom("div",{className:"SC_hd"}))))),zdom("ul",{className:"SC_pvul"},zdom("li",null,t,zdom("div",null,zdom("span",{className:"sum"},e),zdom("div",{className:"SC_ldot zm_lbl"},zdom("i",{title:a,className:"msi-label zmAttLabelDrp"}),zdom("i",{title:a,className:"msi-plus zmAttLabelDrp SC_dyn"})))))))),zdom("div",null,zdom("div",{id:"zmPCAtt",className:"zmPCon"},zdom("div",{className:"zmPCnt"},zdom("div",null,zdom("div",{id:"msprevAttSrc",className:"zmAsrc"}))))),zdom("div",{className:"zmAtg"})))},loadingTemplate:function(){return zdom("div",{className:"At_load"},zdom("div",{className:"AT_lcntr Atlcr1"},zdom("div",{className:"Atcle1"}),zdom("div",{className:"Atcle2"}),zdom("div",{className:"Atcle3"}),zdom("div",{className:"Atcle4"})),zdom("div",{className:"AT_lcntr Atlcr2"},zdom("div",{className:"Atcle1"}),zdom("div",{className:"Atcle2"}),zdom("div",{className:"Atcle3"}),zdom("div",{className:"Atcle4"})),zdom("div",{className:"AT_lcntr Atlcr3"},zdom("div",{className:"Atcle1"}),zdom("div",{className:"Atcle2"}),zdom("div",{className:"Atcle3"}),zdom("div",{className:"Atcle4"})))},centerAlignBox:function(){return zdom("div",{className:"SC_Ialn"})},attachemntFileTypeIcon:function(t){return zdom("i",{className:"".concat(t," SC_vbig")})},attPreviewMsg:function(t){return zdom("div",{className:"txt"},t,zdom("font",{className:"SC_lnk"},s.common.downloadMsg))},attSelectedMsgContainer:function(){return zdom("ul",{className:"SC_ldot SC_itmSel"},zdom("li",null,zdom("strong",null)))},attDownloadContainer:function(){return zdom("ul",{className:"SC_ldot SC_itmSel",style:{display:"block"}},zdom("li",{className:"SC_thm SC_attDwnZip cursorPointer"},s.common.downloadAll))},attAddToContainer:function(){return zdom("ul",{className:"SC_ldot SC_itmSel",style:{display:"block"}},zdom("li",{className:"SC_attAttachTo SC_thm cursorPointer"},s.common.addTo,zdom("i",{className:"msi-rarrow",style:{verticalAlign:"middle"}})))},retryTemplate:function(){return zdom("div",{className:"zmInfoWarnMsg"},zdom("i",{className:"msi-error zmInfoWarnIcon"}),"".concat(s.common.errorMsg," "),zdom("span",{className:"zmLink"},s.common.retry))},getAttachSection:function(t){return zdom("div",{className:"zmPAtt attSec_".concat(t)},zdom("div",{className:"zmAttHdr"},zdom("span",{className:"zmPAttCount attSecHeader cursorPointer"},zdom("i",{className:"msi-zmPle","data-msg":"selAll"}),zdom("b",null,zdom("span",{className:"attCount"})))),zdom("div",{className:"zmAttGrp zmCAt"}))}},!0)}(window.zmAttachment=window.zmAttachment||{}),function(){var t=zmail.Core.Namespaces.create("zmAttachUtility"),z=zmText.get("attachmentUtility"),h="zmlightboxplugin",b="msi-calendar",C="msi-status",r="".concat(zmail.conPath,"/postAttach.do"),u="attachment/addLabel",c="attachment/removeLabel",d="#msprevAttSrc",l="zmlightbox_dropDown",m="msi-attsearch",p="msi-attpdf",i="msi-attdoc",n="msi-attothers",A="msi-addcloud",f="attachment/modifyFavLbl",v=".msi-label",w=".zmL.zmAch",g="div[data-atid='",T="msi-download",y=z.openEntity,S={1:y.email,2:y.note,3:y.task,4:y.event,6:y.status,10:y.link},I={1:"msi-mail",2:"msi-notes",3:"msi-task",4:b,6:C,10:"msi-links"},N=["0","101","102","103","104","105"],x={all:0,m:1,n:2,t:3,c:4,p:6,l:10,h:11},k=[{txt:z.fType[101],data:{type:"attList",action:101}},{txt:z.fType[102],data:{type:"attList",action:102}},{txt:z.fType[103],data:{type:"attList",action:103}},{txt:z.fType[104],data:{type:"attList",action:104}},{txt:z.fType[105],data:{type:"attList",action:105}},{txt:z.fType[0],data:{type:"attList",action:""}}],D=_zm.isStreamsEnabled()?{txt:z.entityType.p,data:{type:"entList",action:"p"}}:"",O=[{txt:z.prevMenu.lstAttSender,data:{type:"attList",action:1}},{txt:z.prevMenu.lstAttType,data:{type:"attList",action:2}}],s={txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,html:!0,htm:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0,msg:!0},L={xml:!0,js:!0,css:!0},U={},e={},M=[];e.getFilterDropTemplate=function(){return zmAttachment.templates.filterDropDwon()},U.isRestrictedIE=function(){return _zm.is_ie&&"Microsoft Internet Explorer"===window.navigator.appName},U.isDocsCompAllowed=function(){return!U.isRestrictedIE()},U.isNotesAppEnabled=function(){return zmail.Utils.FeatureUtil.isAppAvailable("notes")},U.isTaskAppEnabled=function(){return zmail.Utils.FeatureUtil.isAppAvailable("task")},U.showSuccErrMsg=function(t,e){"error"===t?_zm.succErrMsg("e",e[t]):_zm.succErrMsg("s",e[t]||t)},U.addEventsToCal=function(t,e){var a={groupId:t.gId,entityId:t.e,attachId:t.Id,entityType:t.et},i=z.SuccErrMsg;1===t.et&&(a.partId=t.p),t.shId&&(a.shId=t.shId),t.type?(2===t.et?a.streamsView="Notes":a.streamsView="true",a.actionType=t.type):a.accId=zmail.accId,"importToCal"===e&&(a.isImportCalCall=!0),zmAjq.XHR({u:"".concat(zmail.conPath,"/OpenDocument"),t:"GET",fn:function(t){U.showSuccErrMsg(t.msg,{added:i.Event_Added,exist:i.Event_Updated,error:i.Event_Error})},p:a,ep:{}})},U.parseToNumber=function(t){return window.Number(t)},U.parseToInteger=function(t,e){return e=e||10,window.parseInt(t,e)},U.uploadToCloud=function(){var o,v,l=!1;function c(t,e){var a=z.SuccErrMsg;t.result="dropbox"===e.source?"success":t.result,U.showSuccErrMsg(t.result,{success:a.Docs_Uploaded,error:a.Docs_Error})}function i(t,e){return{id:"zDocs",text:zmail.isRebranded?z.cloudServiceName.docs:z.cloudServiceName.zDocs,tabName:"zDocs",selected:t,onClk:function(t){!function(t,e){var a=t.$el.find("#zmAddZDocs");"undefined"!=typeof G_ADDDOCS_OBJ&&(G_ADDDOCS_OBJ.folderid=-1,G_ADDDOCS_OBJ.workspaceid=-1);var i=zmComponent.loadingBand({container:a[0],type:"pagination"}),n={servicename:"zmail",filename:e.fn,docsURL:"//".concat(zmail.urls.docsURL),containerDiv:"zmAddZDocs",isNewUI:!0,handbckobj:{attObj:e},callback:i};try{ADDDOCDIALOG.showAddDocDialog(n)}catch(t){zmUtil.debugLog("Failed to load zoho docs files.")}}(t,e)},listingArea:{id:"zmAddZDocs",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$.e(zdom("div",{className:"SCmc SC_attachviewer"}))},buttons:[{text:z.dialogText.add,onClk:function(){var t,e,a,i;U.uploadToCloud.addToCloudClose(),t=ADDDOCDIALOG.addToZDocsNewUI(),e=t.handbckobj&&t.handbckobj.attObj||{},a={method:"addtoZohoDocs",groupId:e.sid||e.gId||zmail.zuid,entityId:e.e,attachId:e.Id,entityType:e.et,filename:t.fname},i=z.SuccErrMsg,1===e.et&&(a.partId=e.p),e.shId&&(a.shId=e.shId),e.type?(2===e.et?a.streamsView="Notes":a.streamsView="true",a.actionType=e.type):a.accId=zmail.accId,t.issharedws&&(a.issharedws=t.issharedws),t.workspaceid&&-1!==U.parseToNumber(t.workspaceid)&&(a.wsId=t.workspaceid),a.foldId=t.folderid,zmAjq.XHR({u:r,t:"POST",fn:function(t){U.showSuccErrMsg(t[0].response,{success:i.Docs_Uploaded,error:i.Docs_Error})},p:a,ep:{}})}}]}}function n(t,e){return{id:"oCloud",text:U.isDocsCompAllowed()&&_zm.isZohoDocsEnabled()?z.cloudServiceName.otherCloud:z.cloudServiceName.cloud,tabName:"oCloud",selected:t,onClk:function(t){!function(t,e){var a,i=t.$el.find("#zmAddCloud"),n=zmComponent.loadingBand({container:i[0],type:"pagination"}),s="".concat(location.protocol,"//").concat(window.location.hostname),o=s,l=encodeURIComponent(e.fn),c="".concat(e.e,"_").concat(e.Id),d=s,r="".concat(s+zmail.conPath,"/jsp/cloudUploader.jsp?m=").concat(c);if(zmail.fromOtherService&&document.referrer){var m=document.referrer.split("/"),p="".concat(m[0],"//").concat(m[2]);d="".concat(p,",").concat(s)}var h=[],u=zmail.IntegrationStatus;_zm.isCloudServiceIntegEnabled&&u?(u.gDrive&&h.push("gdrive"),u.dropBox&&h.push("dropbox"),u.oneDrive&&h.push("skydrive"),u.box&&h.push("box"),h.length&&(h=h.join(","))):h="gdrive,dropbox,skydrive,box",r=encodeURIComponent(r),a="".concat(zmail.urls.gadURL,"/CloudUploader?sources=").concat(h,"&fileName=").concat(l,"&purpose=mailView&zservice=zmail"),a+="&disableSync=".concat(h,"&serURL=").concat(r,"&frameorigin=").concat(d,"&originUrl=").concat(o);var f=$.e(zmAttachment.templates.cloudFrame(a));v=e,f.on("load",function(){n()}),i.appendDOM(f)}(t,e)},listingArea:{id:"zmAddCloud",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$.e(zdom("div",{className:"SCmc SC_attachviewer"}))},hideButtons:!0}}function d(t,e,a){return"zDocs"===t?i.call(this,e,a):"oCloud"===t?n.call(this,e,a):void 0}return{initAddToCloud:function(t){l||(l=!0,function(t){var e={id:"zmAddToCloudPopup",tabs:[]},a=[],i=!1;if(zmUtil.isAddToCloudAllowed()){U.isDocsCompAllowed()&&_zm.isZohoDocsEnabled()&&a.push("zDocs"),!zmail.isBaihui&&"false"!==zmail.isCloudServiceEnabled&&zmUtil.showAddToCloudTab()&&a.push("oCloud");for(var n=0,s=a.length;n<s;n++)i=0===n,e.tabs.push(d.call(this,a[n],i,t));e.onClose=function(){l=!1},e.dialogDidMount=function(t){var e=t.$el.find(".".concat(t.contentClass));t.$el.find(".".concat(t.contentClass)).css({overflow:"hidden",width:""}),t.$el.find(".SCmc.SC_attachviewer").css({"max-height":e.css("max-height"),"max-width":e.css("max-width")})},e.classes="SC_add",o=zmsDialog.createTabPopupDialog(e)}else l=!1}(t))},addToCloudClose:function(){o.close(),l=!1},cloudUpload:function(t,e,a,i){U.uploadToCloud.addToCloudClose();var n=v,s={groupId:n.sid||n.gId||zmail.zuid,entityId:n.e,entityType:n.et,attachId:n.Id};1===n.et&&(s.partId=n.p),n.shId&&(s.shId=n.shId),n.type?(2===n.et?s.streamsView="Notes":s.streamsView="true",s.actionType=n.type):s.accId=zmail.accId,s.folderPath=t,s.source=a,s.fileName=e,i&&(s.dbAccID=i);var o={source:a};zmAjq.XHR({u:"".concat(zmail.conPath,"/UploadToCloud"),t:"POST",fn:c,p:s,ep:o})}}}(),U.openResult=function(t,e){zmUtil.prevCache(e.id,{mdata:t}),zmList.getMailData({msgId:e.id,type:"lt",opentype:2,src:"external"})},U.openMail=function(t){if(void 0!==t.sid&&t.sid!==U.parseToNumber(zmail.zuid)||t.gId!==zmail.zuid){var e=t.sid||t.gId,a=t.sid?"viewSelfData":"viewGroupEntity";zmUtil.loadStreamsInTab({pid:t.e,gid:e,etype:String(t.et),actionType:a})}else{var i={entityId:t.e,entityType:t.et,method:"openEntity"},n={id:t.e,F:t.dn};i.groupId=t.gId,zmAjq.XHR({u:r,t:"POST",fn:U.openResult,p:i,ep:n})}},U.sendMail=function(t){zmUtil.openComposeWithAtt([t])},U.openPost=function(t){var e=t.sid?t.sid:t.gId,a=t.gId!==zmail.zuid||t.sid?"viewGroupEntity":"viewSelfData",i={pid:t.e,gid:e,etype:t.et,actionType:a};t.cId&&(i.commentId=t.cId),zmUtil.loadStreamsInTab(i)};U.printImageAtt=function(t,e){var a,c,d;if(!$.q("#".concat(h)).length){if(!zmUtil.isNettyViewEnabled()){var i=window.open(zmUtil.getTheSrc("FileDownload",t),"_blank");return void(i.onload=function(){i.focus(),i.print()})}if(e)return void(c=e,d=t,new Promise(function(t,e){var a;a="attSrcView"===c.appName?0:"l"===c.dType?0:d.ft;for(var i=c.attArrObj[a].list,n=d.uniqueId,s={startIndex:i.indexOf(n),attObjList:[]},o=i.length,l=0;l<o;l++)s.attObjList.push(c.attDet[i[l]]);zmAttachUtility.initSlideshow(s),t()})).then(function(){U.printImageAtt(t)})}var n=U.loadingIndicatorTemplate();if(101===t.ft)(a=$.q("#".concat(h)).find(".ZAt_opt")).find("#attMsi-print").addClass("SC_vh"),a.appendDOM(zdom("div",{id:"zmTempDiv",style:{left:"96.4%",top:"1px"}},n));else if(101!==t.ft){return void $.q("#".concat(h)).find("iframe")[0].contentWindow.print()}zmail.prevAttachment={},t.src=zmUtil.getTheSrc("FileDownload",t),(window.ActiveXObject||"ActiveXObject"in window)&&(t.src+="&t=".concat(Date.now())),zmail.prevAttachment.attObj=t;var s=zdom("iframe",{src:"".concat(zmail.conPath,"/print.do?isImg=",!0),style:{display:"none"}});$.q("body").appendDOM(s),s.onload=function(){window.setTimeout(function(){$.e(s).remove()},2e3)}},U.showLabelPopup=function(a,i,t,e){var n,s=i.l,o={};return s&&"$6"===s[0]&&s.splice(0,1),o.parentDOM=a,o.displayAs="popup",o.accType="default",o.labelState={labelList:s},o.onCreate=function(t,e){zmlab.isValidName(t,"","default")&&zmlab.labelCreate(t,"default",{reqDoneClbk:function(t,e){t&&(o.onStateChange(e,!0,function(){}),n.hide())},color:e})},o.onHide=function(){"function"==typeof e&&e(a,i)},t&&(o.direction=t),o.onStateChange=function(t,e){U.lblPopupAction(e?"addLabel":"deleteLabel",i,a,t)},o.divId=l,(n=zmUtil.createFLComp("label",o)).show(),{remove:function(){n.hide()}}},U.lblPopupAction=function(t,e,a,i){"addLabel"===t?U.addLabelApi(a,e,i):U.removeLabelApi({el:a,id:e,lblId:i},U.removeLabelApiResult)},U.addLabelApi=function(t,e,a){var i,n=$.e(t).data().uid||a;if(n){var s=U.addLabelApiResult,o={method:"applyLabel",groupId:e.gId,entityId:e.e,attachId:e.Id,entityType:e.et,labelId:n,m:"a",fileType:e.ft,uuid:e.u};1===e.et&&(o.partId=e.p,o.accountId=zmail.accId),e.sid&&(o.sid=e.sid),i={attObj:e,labId:n},zmAjq.XHR({u:r,t:"POST",fn:s,p:o,ep:i})}},U.addLabelApiResult=function(t,e){var a,i,n,s=zmUtil.getTagList("default")[e.labId],o=e.attObj,l=o.e,c=o.Id+l;if($.publish(u,e),s&&s.id){if($.q("#".concat(h)).length){var d=$.q("#".concat(h)).find(".ZAt_opt").find("#sshwLeftIcons > div");(i=d.find(".zmLblGrp")).length?(n=zmsTemplates.constructTagListHTML([e.labId],!0,void 0,"default",{constructOuterDiv:!1,getDOM:!0}),$.e(i).appendDOM(n)):(n=zmsTemplates.constructTagListHTML([e.labId],!0,void 0,"default",{constructOuterDiv:!0,getDOM:!0}),d.appendDOM(n))}if((i=(a=$.q("".concat(g+c,"']"))).find(".zmLblGrp")).length)n=zmsTemplates.constructTagListHTML([e.labId],!1,2,"default",{constructOuterDiv:!1,getDOM:!0}),$.e(i).appendDOM(n);else{n=zmsTemplates.constructTagListHTML([e.labId],!1,2,"default",{constructOuterDiv:!0,getDOM:!0});for(var r=a.find(".zm_lbl"),m=0,p=r.length;m<p;m++)$.e(r[m]).find(v).length?$.e(n).insertDOMAfter($.e(r[m]).find(v)):$.e(r[m]).appendDOM(n);a.find(v).addClass("SC_dyn"),a.find(".msi-plus").removeClass("SC_dyn")}a.addClass("SC_hlbl")}},U.removeLabelApi=function(t,e){var a=t.el.parentNode,i=a&&a.id?a.id:t.lblId;if(i){var n=t.id,s={method:"applyLabel",groupId:n.gId,entityId:n.e,attachId:n.Id,entityType:n.et,labelId:i,m:"d",uuid:n.u,fileType:n.ft};1===n.et&&(s.partId=n.p,s.accountId=zmail.accId),n.sid&&(s.sid=n.sid);var o={attObj:n,ele:a,labId:i};zmAjq.XHR({u:r,t:"POST",fn:e,p:s,ep:o})}},U.removeLabelApiResult=function(t,e){var a=e.attObj,i=a.Id+a.e,n=e.labId;$.publish(c,e);var s=$.q("".concat(g+i,"']")),o=s.find(".zm_lbl");o.find("div[data-mid='".concat(n,"']")).remove(),o.find(".zmLbl").length||(s.removeClass("SC_hlbl"),o.find(".zmLblGrp").remove(),s.find(".msi-plus").addClass("SC_dyn"),s.find(v).removeClass("SC_dyn"));var l=$.q("#".concat(h));l.length&&(l.find("div[data-mid='".concat(n,"']")).remove(),l.find(".zmLblGrp").children().length||l.find(".zmLblGrp").remove())},U.addLabel=function(t){var e=$.q("#".concat(h)).find(v);U.showLabelPopup(e,t,"",function(){e.removeClass("SC_thm")}),$.q("#".concat(l)).css("zIndex",999)},U.searchAttachment=function(t,e,a){var i="";"sender"===t?i=e.dn:"filetype"===t&&(i=zmUtil.fileTyp(e.fn)[2]),zmUtil.listAttachmentInAttSearchView({type:t,srchStr:i})},U.menuItemClick=function(t){var e=!1;if(void 0!==t&&t.constructor===Object){var a=t.attObj,i=a&&a.attType===zmAttachUtility.fileType.hugeAttachment,n=t.action;switch(e=!1,zmUtil.hideMenu(),n){case"download":case"dwn":i?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(a)):zmUtil.downloadAttachment(a);break;case"lstSender":U.searchAttachment("sender",a,3);break;case"lstType":U.searchAttachment("filetype",a,4);break;case"sMail":U.sendMail(a);break;case"attachToPost":zmUtil.loadNewPostDialog("",[a]);break;case"attachToNote":zmUtil.loadNotes("popup",{attEntObj:[a]});break;case"attachToTask":zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:[a]}});break;case y.email:U.openMail(a);break;case y.note:zmUtil.loadNotes("openNote",a);break;case y.status:case y.task:case y.event:case y.link:U.openPost(a);break;case"remFav":U.attFav(a,!1);break;case"fav":U.attFav(a,!0);break;case"hideAtt":U.hideAtt(a,U.hideResult);break;case"unhideAtt":U.restoreToAttachmentView(a);break;case"addLab":U.addLabel(a);break;case"addToDocs":zmUtil.cloudUploader(a);break;case"addEvent":zmUtil.addEventsToCal(a);break;case"addTag":e=!0;break;case"printImg":U.printImageAtt(a,t.ref);break;case"deleteAtt":i&&U.deleteHugeAtt(a);break;case"changePerm":zmUtil.loadHugeAttachComponent(),setTimeout(function(){zmAttachComponent.hugeAttachment.getListAndEditPerm(a,this)},200);break;case"copyLink":zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.copyPermaLink(a)}if(e){var s=t.ele,o=s.parents(w);o.addClass("sel"),U.showLabelPopup(s,a,"",function(){o.removeClass("sel")})}}},U.attFav=function(t,e){if(t){var a={attObj:t,flag:e},i=U.favResult;U.favAttach(a,i)}},U.favAttach=function(t,e){var a=t.attObj,i={method:"markFavourite",groupId:a.gId,entityId:a.e,attachId:a.Id,entityType:a.et,flag:t.flag,fileType:a.ft,uuid:a.u},n={flag:t.flag,attObj:a};1===a.et&&(i.accountId=zmail.accId),a.sid&&(i.sid=a.sid),zmAjq.XHR({u:r,t:"POST",fn:e,p:i,ep:n})},U.favResult=function(t,e){if(t&&"success"===t[0].response){var a,i=e.attObj,n=e.flag,s=i.Id+i.e,o=$.q("".concat(g+s,"'].zmAch")),l=$.q(".ZAt_opt").find(".msi-fav"),c=o.length,d=z.prevMenu,r="data-tooltip";if(n){for(a=0;a<c;a++)$.e(o[a]).find("i.msi-fav").addClass("SC_fav").attr(r,d.remFav);l.length&&l.addClass("SC_fav").attr(r,d.remFav)}else{for(a=0;a<c;a++)$.e(o[a]).find("i.msi-fav").removeClass("SC_fav").attr(r,d.fav);l.length&&l.removeClass("SC_fav").attr(r,d.fav)}$.publish(f,[s,n]),$.publish("attachment/changeFavourite",e)}},U.hideAtt=function(a,i){Dialog.new({title:z.common.confirmHideAtt,buttons:[{name:zmText.get("dialog","ok"),callback:function(t){var e={method:"deleteFromAttachmentView",entityId:a.e,attachId:a.Id,filename:a.fn,entityType:a.et,uuid:a.u,fileType:a.ft};t.remove(),1===a.et&&(e.partId=a.p),a.sid?e.groupId=a.sid:e.groupId=zmail.zuid,zmAjq.XHR({u:r,t:"POST",fn:i,p:e,ep:{attObj:a}})}},{name:zmText.get("dialog","cancel"),isCancel:!0,callback:function(t){t.remove()}}],defaultCloseIcon:!1})},U.deleteHugeAtt=function(a){Dialog.new({title:z.common.confirmDeleteAtt,buttons:[{name:zmText.get("dialog","ok"),callback:function(t){zmUtil.loadHugeAttachComponent();var e={fn:U.hideResult,eprm:{attObj:a}};zmAttachComponent.hugeAttachment.deleteFile("",a.digest,"",e),t.remove()}},{name:zmText.get("dialog","cancel"),isCancel:!0,callback:function(t){t.remove()}}],defaultCloseIcon:!1})},U.hideResult=function(t,e){if(t&&(t[0]&&"success"===t[0].response||"success"===t)){for(var a=e.attObj.Id+e.attObj.e,i=zmsuite.getCenter(this.appName)[0].$el,n=$.q("".concat(g+a,"'].zmAch")),s=$.q("dl[data-atid='".concat(a,"'].zmAch")),o=n.length,l=i.find("".concat(g+a,"'].zmAch")).parent(),c=0;c<o;c++)$.e(n[c]).remove();s.remove(),U.listview.previewCard.closePrevCard.call(this),$.publish("attachment/hideAttachment",[i,a,l])}},U.restoreToAttachmentView=function(t){var e={method:"restoreToAttachmentView",entityId:t.e,attachId:t.Id,entityType:t.et};t.sid&&(e.streamsView=!0),e.groupId=t.sid||zmail.zuid,zmAjq.XHR({u:r,t:"POST",fn:function(t,e){Array.isArray(t)&&t[0]&&"success"===t[0].response?e&&e.attObj&&e.attObj.l&&(e.attObj.l.splice(e.attObj.l.indexOf("$HIDDEN"),1),zmUtil.succErrMsg("s",z.SuccErrMsg.unhideSuccess)):zmUtil.succErrMsg("e",z.SuccErrMsg.unhideFailure)},p:e,ep:{attObj:t}})},U.getGroups=function(){var t,e,a=zmUtil.getGroupOrder()||[],i=[],n=z.menuText.me;i.push({id:zmail.zuid,name:n,display_text:n,tooltip:n});for(var s=0,o=a.length;s<o;s++)(t=zmail.ContactBook.getGroups(a[s])[0])&&(e=t.attrs.name,i.push({id:a[s],name:e,display_text:e,tooltip:e}));return i},U.getLabels=function(){var t,e=zmUtil.getTagList("default"),a=[],i=z.menuText.favourites,n=z.menuText.none;for(var s in a.push({id:"f",name:i,display_text:i,tooltip:i}),e)t=_zm.escapeTags(e[s].dispName),a.push({id:s,name:t,display_text:t,tooltip:t});return a.push({id:"all",name:n,display_text:n,tooltip:n}),a},U.noAttach=function(t,e){t.removeClass("SC_tmbvw").clearHTML(),t.appendDOM(zdom("div",{id:"noattachs",className:"zmInfoWarnMsg"},e))},U.previewNotAvlbl=function(t,e,a,i){var n=zmAttachment.templates,s="".concat(z.common.previewNotAvlbl," - ");a.prependDOM(n.attPreviewMsg(s)),a.prependDOM(n.attachemntFileTypeIcon(t));var o=i.attType===zmAttachUtility.fileType.hugeAttachment;a.find(".At_load").remove(),a.find("font").on("click",function(){o?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(i)):i.attType===zmAttachUtility.fileType.workDriveAtt?window.open(i.cloudLink,"_blank"):zmUtil.downloadAttachment(i)})},U.attDropDown=function(t,e,a,i){var n,s,o=$.e(e),l={};t&&(t=t.replace(/[0-9]/g,""));var c={id:t,par:o,align:"pright",parWidth:!0,divId:"zm_dropDown"},d=zmUtil.isHugeAttachmentUploadEnabled()?{txt:z.entityType.h,data:{type:"entList",action:"h"}}:"";switch(t){case"tfil":o.find("b").addClass("SC_ddn"),(s=o.parent(".zmSelect")).addClass("zmSlOn"),c.list=k,c.divId="zmAtt_dropDown",c.align="pleft",c.clk=function(t){s.removeClass("zmSlOn"),a?a(t,o):U.dropDownClick(t,o)},c.onHide=function(){s.removeClass("zmSlOn")},zmDropDownMenu.show(c);break;case"ent":if(c.list=[{txt:z.entityType.m,data:{type:"entList",action:"m"}},D,{txt:z.entityType.n,data:{type:"entList",action:"n"}},{txt:z.entityType.t,data:{type:"entList",action:"t"}},{txt:z.entityType.c,data:{type:"entList",action:"c"}},{txt:z.entityType.l,data:{type:"entList",action:"l"}},d,{txt:z.entityType[0],data:{type:"entList",action:"all"}}],"streams"===i){var r=c.list.find(function(t){return"h"===t.data.action});c.list.splice(c.list.indexOf(r),1)}c.divId="zmAtt_dropDown",c.align="pleft",(s=o.parent(".zmSelect")).addClass("zmSlOn"),c.clk=function(t){s.removeClass("zmSlOn"),a?a(t,o):U.dropDownClick(t,o)},c.onHide=function(){s.removeClass("zmSlOn")},zmDropDownMenu.show(c);break;case"grp":(l={}).parentDOM=e,l.displayAs="dropdown",(s=o.parent(".zmSelect")).addClass("zmSlOn"),l.dataCallback=function(){return zmAttachUtility.getGroups()},l.onSelect=function(t){s.removeClass("zmSlOn"),n.hide(),a?a(t,o):U.showGroupAtt(t,o)},l.onHide=function(){s.removeClass("zmSlOn")},(n=zmUtil.createFLComp("",l)).show();break;case"lbl":(l={}).parentDOM=e,l.displayAs="dropdown",l.accType="default",l.dataCallback=function(){return zmAttachUtility.getLabels()},(s=o.parent(".zmSelect")).addClass("zmSlOn"),l.onSelect=function(t){s.removeClass("zmSlOn"),n.hide(),a?a(t,o):U.showLabelAtt(t,o)},l.onHide=function(){s.removeClass("zmSlOn")},(n=zmUtil.createFLComp("",l)).show();break;case"zm_AttView":o.find("b").addClass("SC_ddn"),c.list=M,c.clk=function(t){U.menuItemClick(t)},zmDropDownMenu.show(c)}},U.dropDownClick=function(t,e){switch(t.type){case"attList":U.showByType(t.action,e);break;case"entList":U.showEntLst(t.action,e);break;case"attGroup":U.showGroupAtt(t.action,e);break;case"lblList":U.showLabelAtt(t.action,e)}U.hideMenu()},U.hideMenu=function(){$.q("#zmAtt_dropDown").remove()},U.showEntLst=function(t,e){e.text(U.entDrpTxtChange(t)),e.data({dataIndex:t})},U.showByType=function(t,e){""===t&&(t=0),e.text(z.fType[t]),e.data({dataIndex:t})},U.showGroupAtt=function(t,e){var a="";if(t===zmail.zuid)a=z.menuText.me;else{var i=zmail.ContactBook.getGroups(t)[0];a=i?i.attrs.name:""}e.text(a),e.data({dataIndex:t})},U.showLabelAtt=function(t,e){"f"===t?e.text(z.menuText.favourites):"all"===t?e.text(z.menuText.none):e.text(_zm.escapeTags(zmUtil.getTagList("default")[t].dispName)),e.data({dataIndex:t})},U.entDrpTxtChange=function(t){var e=z.entityType;return t&&e[t]||e[0]},U.emailSplit=function(t){if("string"!=typeof t)return[];var e=[],a=t.indexOf("<"),i=t.indexOf(">"),n="",s=t;return-1!==a&&-1!==i&&(n=t.substring(0,a),s=t.substring(a+1,i)),e.push(n),e.push(s),e},U.getLabelArr=function(t){var e=t.slice(0);return e&&"$6"===e[0]&&e.splice(0,1),e},U.getAttachObject=function(t,e,a){var i=a.attArrObj[e].list.slice(0);return i.splice(0,t),U.createAttObjectArr(i,a)},U.createAttObjectArr=function(t,e){for(var a,i=[],n=t.length,s=0;s<n;s++)a=e.attDet[t[s]],i.push(a);return i},U.thumbNailContainer=function(t,e,a){var i=zdom("div",{className:"zmAmht zmAv",id:e+t},zdom("div",null,z.fType[t],zdom("span",{className:"SC_lnk"}," - ".concat(z.menuText.showAll))));return 0!==a&&$.e(i).find(".SC_lnk").hide(),i},U.chkAttResp=function(t){var e=!1;if(t)for(var a=N.length,i=0;i<a;i++)if(t[N[i]]){e=!0;break}return e},U.consList=function(e,t,a,i){var n=e.Id+e.e,s=zmAttachment.templates;e.tnsize="37";var o=s.attPrevInr(e),l=0<e.fs?zmUtil.sizeConv(e.fs):"&nbsp;",c=parseInt(e.et),d=I[c],r=S[c],m=e.l,p=U.emailSplit(e.dn),h=m&&"$6"===m[0],u=s.zmFdrBox(d,r,e.attType),f=zdom("div",{className:"zmFlt"}),v=zdom("div",{className:"SC_icn"}),g=s.favIcon(h);"attComp"===a?(g=zdom("i",{className:"msi-tick"}),v.appendChild(g)):(("attView"===a||"attSrcView"===a||"attListing"===a||"streams"===a)&&e.attType!==zmAttachUtility.fileType.hugeAttachment&&f.appendChild(zdom("i",{className:"msi-uncheck"})),f.appendChild(g));var z=s.divZmFrm(e.fn),b=zdom("div",{className:"zm_lbl"}),C=zdom("div",{"data-atid":n,className:"zmL zmAch"},zdom("div",{className:"zmLst"},f,zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg"},o),z,zdom("div",{className:"zmDate"},zdom("span",null,e.rt)),zdom("div",{className:"zmSze"},zdom("span",{className:"sum"},l)),u,zdom("div",{className:"zmSub"},zdom("span",{className:"sum"},p[1])),v,b),zdom("div",{className:"zmFrt"})));"t"===t?$.e(z).find("#listView").hide():($.e(z).find("#thumbView").hide(),_zm.addClass(C,"SC_mlst"));var A=U.getLabelArr(e.l);if(A.length&&"attComp"!==a){_zm.addClass(C,"SC_hlbl");var w=zmsTemplates.constructTagListHTML(A,!1,2,"default",{constructOuterDiv:!0,getDOM:!0});$.e(b).appendDOM(w)}return _.filter(i,function(t){return t.uniqueId===e.uniqueId}).length&&_zm.addClass(C,"SC_check"),e.thn&&U.replaceBlurImage(C,e),C},U.replaceBlurImage=function(t,e){var a=$.e(t).find(".zmImg"),i=zdom("img",{style:{display:"none"},src:zmUtil.getTheSrc("FileDownload",e,"thb")}),n=a.find("img").css("min-width","100%");$.e(i).on("load",function(){$.e(i).show(),n.remove()}),$.e(i).on("error",function(){$.e(i).remove()}),a.appendDOM(i)};var j,E,P,F,H,R,o=function(t){var e=$.e(this.selectElm),a=e.find(".attSelectCnt"),i=this.selectedAttachment,n=1<i.length?z.common.noofattselected:z.common.oneattselected;a.text("".concat(i.length," ").concat(n)),t?e.removeClass("SC_dyn"):i.length||e.addClass("SC_dyn")},V=function(){this.attachUtil.selectedAttachment=[],$.e(this.attachUtil.$el).find(".SC_check").removeClass("SC_check"),$.e(this.attachUtil.selectElm).addClass("SC_dyn")};U.onSelectAttachment=function(t,e,a){10<=this.selectedAttachment.length?_zm.succErrMsg("i",z.SuccErrMsg.att_selection):(e.addClass("SC_check"),this.selectedAttachment.push(a),"streams"===this.appName&&this.selectElm&&o.call(this,!0),$.publish("attachmentView/attachmentSelected",this.appName))},U.onUnselectAttachment=function(t,e,a){e.removeClass("SC_check");var i=this.selectedAttachment.indexOf(_.findWhere(this.selectedAttachment,{uniqueId:a}));0<=i&&(this.selectedAttachment.splice(i,1),"streams"===this.appName&&this.selectElm&&o.call(this),$.publish("attachmentView/attachmentUnselected",this.appName))},U.createShareDropDownMenu=function(a){var t=[],e=z.prevMenu,i=a.attObj||{},n=$.e(a.ele),s="left";(n=n.hasClass("msi-rarrow")?n:n.find(".msi-rarrow")).length||(n=$.e(a.ele),s="bottom"),_zm.isStreamsEnabled()&&i.attType!==zmAttachUtility.fileType.hugeAttachment&&t.push({txt:e.attachToPost,data:{action:"attachToPost"}}),t.push({txt:e.sMail,data:{action:"attachToMail"}}),i.attType!==zmAttachUtility.fileType.hugeAttachment&&(U.isNotesAppEnabled()&&t.push({txt:e.attachToNote,data:{action:"attachToNote"}}),U.isTaskAppEnabled()&&t.push({txt:e.attachToTask,data:{action:"attachToTask"}}));var o={par:n,list:t,clk:function(t,e){zmUtil.hideMenu(),"function"==typeof a.clk&&a.clk(t,e)},showArrow:!0,direction:s};a.divId&&(o.divId=a.divId),zmsuite.showMenu(o)},U.addSubMenu=function(t,n,s){var e={},a=z.prevMenu,i=[{txt:a.teamDrive,data:{item:"teamDrive"}},{txt:a.otherCloudService,data:{item:"addToDocs"}}];return n?(e.conArr=i,e.removeSelection=!0):(e.list=i,e.align="cleft"),e.divId="zm_stream_edit",e.clk=function(t,e,a){zmUtil.hideMenu();var i=t.item;switch(n&&(i=e.item),i){case"addToDocs":zmUtil.cloudUploader(s);break;case"teamDrive":zmUtil.attachToWorkDrive({attachments:[s]})}},e},U.bindAttachListEvents=function(t,e){var a,i=$.e(t.target||t.srcElement),n=i.attr("class")||i.parent().attr("class")||"",s=zmList.getParent(i[0],"SC_mclst"),o=$.e(e).attr("data-atId"),l=this.attDet[o],c=l.attType===zmAttachUtility.fileType.hugeAttachment;if(-1!==n.indexOf("msi-mail"))U.openMail(l);else if(-1!==n.indexOf("msi-fav"))a=!i.hasClass("SC_fav"),U.attFav(l,a);else if(-1!==n.indexOf(T))c?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(l)):zmUtil.downloadAttachment(l);else if(-1!==n.indexOf("msi-send"))U.sendMail(l);else if(-1!==n.indexOf(A))zmUtil.cloudUploader(l);else if(-1!==n.indexOf("msi-notes"))U.openPost(l);else if(-1!==n.indexOf(C)||-1!==n.indexOf("msi-task"))U.openPost(l);else if(-1!==n.indexOf("msi-links")||-1!==n.indexOf(b))U.openPost(l);else if(-1!==n.indexOf("msi-hideattach"))U.hideAtt(l,U.hideResult);else if(-1!==n.indexOf("msi-trash"))c&&U.deleteHugeAtt(l);else if(-1!==n.indexOf("msi-uncheck"))i.closest(w).hasClass("SC_check")?U.onUnselectAttachment.call(this,i,$.e(e),o):U.onSelectAttachment.call(this,i,$.e(e),l);else if(-1!==n.indexOf("zmLbl"))U.showLabelPopup(i.parent(),l);else if(-1!==n.indexOf("msi-action")){zmUtil.hideMenu();var d=z.prevMenu,r=[];c?(r.push({txt:d.changePermission,data:{action:"changePerm",attObj:l,ele:i}}),r.push({txt:d.addLabel,data:{action:"addTag",attObj:l,ele:i}}),r.push({txt:d.copylink,data:{action:"copyLink",attObj:l}}),r.push({txt:d.delAtt,data:{action:"deleteAtt",attObj:l,ele:i}})):(_zm.isStreamsEnabled()&&r.push({txt:d.attachToPost,data:{action:"attachToPost",attObj:l,ele:i}}),U.isNotesAppEnabled()&&r.push({txt:d.attachToNote,data:{action:"attachToNote",attObj:l,ele:i}}),U.isTaskAppEnabled()&&r.push({txt:d.attachToTask,data:{action:"attachToTask",attObj:l,ele:i}}),zmUtil.isAddToCloudAllowed()&&(_zm.isTeamDriveEnabled()?r.push({dom:zdom("fragment",null,zdom("i",{className:"msi-rarrow"}),d.addToDocs),child:function(){return U.addSubMenu(this,"",l)}}):r.push({txt:d.addToDocs,data:{action:"addToDocs",attObj:l,ele:i}})),r.push({txt:d.addLabel,data:{action:"addTag",attObj:l,ele:i}}),Array.isArray(l.l)&&0<=l.l.indexOf("$HIDDEN")&&zmail.showFeature?r.push({txt:d.unhideAtt,data:{action:"unhideAtt",attObj:l,ele:i}}):l.gId===zmail.zuid&&r.push({txt:d.hideAtt,data:{action:"hideAtt",attObj:l,ele:i}}),l.ft&&103!==l.ft&&"FileDownload"===zmUtil.isPreviewAvailable(l.fn).apiName&&r.push({txt:d.printImg,data:{action:"printImg",attObj:l,ele:i,ref:this}})),i.parents(w).addClass("sel");var m={par:i,showArrow:!0,list:r,onHide:function(){i.parents(w).removeClass("sel")},clk:function(t,e){U.menuItemClick(t,e)}};zmsuite.showMenu(m)}else if(s){var p,h,u,f,v={};if("attSrcView"===this.appName&&(void 0===this.dType||"l"===this.dType)||"attView"===this.appName&&"l"===this.dType||"attListing"===this.appName&&"list"===this.viewType)U.listview.previewCard.openPreviewCard.call(this,e),U.listview.previewCard.keyBindingForPreviwCard.call(this);else{for(u="attSrcView"===this.appName?0:"l"===this.dType?0:l.ft,h=(p=this.attArrObj[u].list).length,v.startIndex=p.indexOf(o),v.attObjList=[],f=0;f<h;f++){var g=this.attDet[p[f]];g.attType!==zmAttachUtility.fileType.hugeAttachment&&v.attObjList.push(g)}v.targetEle=i.parents(w).find(".zmImg"),v.attObjList.length&&zmAttachUtility.initSlideshow(v)}}},U.listOptions=function(t){var e=t.target||t.srcElement,a=$.e(e).closest(".zmL").attr("data-atid"),i=z.prevMenu,n=[],s=this.attachUtil?this.attachUtil.attDet[a]:this.attDet[a];n.push({txt:i.downLoad,data:{action:"dwn",attObj:s}}),n.push({sep:!0}),1===s.et&&(n.push({txt:i.lstAttSender,data:{action:"lstSender",attObj:s}}),n.push({txt:i.lstAttType,data:{action:"lstType",attObj:s}}),n.push({sep:!0}));var o=s.et,l=S[o],c=s.l;l&&(n.push({txt:l,data:{action:l,attObj:s}}),n.push({sep:!0})),n.push({txt:i.sMail,data:{action:"sMail",attObj:s}}),s.attType!==zmAttachUtility.fileType.hugeAttachment&&(_zm.isStreamsEnabled()&&n.push({txt:i.attachToPost,data:{action:"attachToPost",attObj:s}}),U.isNotesAppEnabled()&&n.push({txt:i.attachToNote,data:{action:"attachToNote",attObj:s}}),U.isTaskAppEnabled()&&n.push({txt:i.attachToTask,data:{action:"attachToTask",attObj:s}})),n.push({sep:!0}),"$6"===c[0]?n.push({txt:i.remFav,data:{action:"remFav",attObj:s}}):n.push({txt:i.fav,data:{action:"fav",attObj:s}}),s.attType!==zmAttachUtility.fileType.hugeAttachment?(zmUtil.isAddToCloudAllowed()&&(n.push({sep:!0}),_zm.isTeamDriveEnabled()?n.push({dom:zdom("fragment",null,zdom("i",{className:"msi-rarrow"}),i.addToDocs),child:function(){return U.addSubMenu(this,!0,s)}}):n.push({txt:i.addToDocs,data:{action:"addToDocs",attObj:s}})),0<=c.indexOf("$HIDDEN")&&zmail.showFeature?(n.push({sep:!0}),n.push({txt:i.unhideAtt,data:{action:"unhideAtt",attObj:s}})):s.gId===zmail.zuid&&(n.push({sep:!0}),n.push({txt:i.hideAtt,data:{action:"hideAtt",attObj:s}}))):(n.push({txt:i.changePermission,data:{action:"changePerm",attObj:s}}),n.push({txt:i.copylink,data:{action:"copyLink",attObj:s}}),n.push({txt:z.UserMsg.delAtt,data:{action:"deleteAtt",attObj:s}}));var d={clk:function(t,e){U.menuItemClick(e,t)},conArr:n};zmsuite.showContextMenu(t,d),zmUtil.stopEvents(t)},U.loadingIndicatorTemplate=function(){return zmAttachment.templates.loadingTemplate()},U.removeLabelRef=function(t,e){var a,i;if(void 0!==e&&e.constructor===Object){var n=e.attObj;if(void 0!==n&&n.constructor===Object){var s=n.Id+n.e;this.attDet&&this.attDet[s]&&0<=(i=(a=this.attDet[s].l).indexOf(e.labId))&&a.splice(i,1)}}},U.addLabelRef=function(t,e){if(void 0!==e&&e.constructor===Object){var a=e.attObj;if(void 0!==a&&a.constructor===Object){var i=a.Id+a.e;this.attDet&&this.attDet[i]&&this.attDet[i].l.indexOf(e.labId)<0&&this.attDet[i].l.push(e.labId)}}},U.modifyFavLblRef=function(t,e,a){var i,n;this.attDet&&this.attDet[e]&&(n=this.attDet[e].l,a?n.unshift("$6"):(i=n.indexOf("$6"),n.splice(i,1)))},U.ajaxReq={ajaxCallHelper:function(t,e){var a=zmComponent.loadingBand({container:e.loadingContainer,type:e.loadingType}),i=t.ep;return i.removeLoadingBand=a,{extraParam:i}},getGroupAttachments:function(e,a,i){var n,t=e.paramInfo;t.mode=t.mode||"lst";var s={u:"".concat(zmail.conPath,"/attach.do"),t:"POST",fn:a,p:t};if("object"===babelHelpers.typeof(i)){var o=function(){n.extraParam.removeLoadingBand();var t=$.e(zmAttachment.templates.retryTemplate());t.find(".zmLink")[0].onclick=function(){t.remove(),U.ajaxReq.getGroupAttachments(e,a,i)},i.loadingContainer.appendChild(t[0])};n=U.ajaxReq.ajaxCallHelper(e,i),s.onerror=o,s.onnetfailure=o}else n={extraParam:e.ep};s.ep=n.extraParam,zmAjq.XHR(s)},getGroupLblAttachments:function(e,a,i){var n,t=e.paramInfo,s={u:r,t:"POST",fn:a,p:t};if("object"===babelHelpers.typeof(i)){var o=function(){n.extraParam.removeLoadingBand();var t=$.e(zmAttachment.templates.retryTemplate());t.find(".zmLink")[0].onclick=function(){t.remove(),U.ajaxReq.getGroupLblAttachments(e,a,i)},i.loadingContainer.appendChild(t[0])};n=U.ajaxReq.ajaxCallHelper(e,i),s.onerror=o,s.onnetfailure=o}else n={extraParam:e.ep};s.ep=n.extraParam,zmAjq.XHR(s)}},U.listview={},U.listview.previewCard=(j=function(t,e,a){return zdom("iframe",{id:"zmIframe",frameBorder:"0",scrolling:"auto",width:a,height:e,style:{background:"white",visibility:"hidden"},src:t})},E=function(t){if(t){var e=this;t.onload=function(){zmsuite.getCenter(e.appName)[1].$el.find(d).find(".At_load").remove(),$.e(t).css("visibility","visible")}}},P=function(){var t=zmsuite.getCenter(this.appName)[1].$el;return{height:"".concat(t.height()-117,"px"),width:t.hasClass("shw")?"".concat(t.width()-65,"px"):"".concat(t.width()+40,"px")}},F=function(t,e){var a=zmsuite.getCenter(this.appName)[1].$el.find(d);a.find(".At_load").remove(),a.prependDOM(e),a.prependDOM(t)},H=function(t){var e=zmUtil.fileTyp(t.fn);101===t.ft?function(e){var t=zmUtil.getTheSrc("FileDownload",e),a=$.e(zdom("img",{style:{display:"none"},src:t})),i=zmsuite.getCenter(this.appName)[1].$el.find(d);a.on("load",function(){i.find(".At_load").remove(),a.css({display:"block","max-width":"100%","max-height":"100%"})}).on("error",function(){var t=zmAttachment.templates.centerAlignBox();i.appendDOM(t),i.find(".At_load").remove(),a.remove(),U.previewNotAvlbl(n,!1,$.e(t),e)}),F.call(this,U.loadingIndicatorTemplate(),a),i.appendDOM(a)}.call(this,t):e[1]!==i&&"msi-attppt"!==e[1]&&"msi-attsheet"!==e[1]||s[e[2]]?e[1]===p||e[1]===i&&s[e[2]]||e[1]===n&&s[e[2]]?function(t,e){var a,i,n,s=!1,o=!0,l=P.call(this),c=zmsuite.getCenter(this.appName)[1].$el;(window.ActiveXObject||"ActiveXObject"in window)&&(s=!0,L[e[2]]&&(i=zmAttachment.templates.centerAlignBox(),o=!1,U.previewNotAvlbl(e[1],!1,$.e(i),t))),o&&("eml"===e[2]||"msg"===e[2]?(c.find(d).appendDOM(U.loadingIndicatorTemplate()),zmAttach.util.constMailFromEml(t,function(t){c.find("#zmHdrAtt").next().dangerouslySetInnerHTML(t)})):(n=zmUtil.getTheSrc("FileDownload",t),a=$.e(j(n,l.height,l.width)),F.call(this,U.loadingIndicatorTemplate(),a),s&&e[1]===p?window.setTimeout(function(){c.find(d).find(".At_load").remove(),a.css("visibility","visible")},2e3):E.call(this,a[0])))}.call(this,t,e):"msi-attaudio"===e[1]||"msi-attvideo"===e[1]?function(t){var e=zmUtil.getTheSrc("FileDownload",t),a=zmsuite.getCenter(this.appName)[1].$el.find(d),i={filename:t.fn,source:e,$parent:a,height:a.height(),width:a.width()};zmAppLoader.load("slideshowComp").done(function(){zmAttachment.slideshow.player.create(i)})}.call(this,t):function(t,e){var a=zmAttachment.templates.centerAlignBox();zmsuite.getCenter(this.appName)[1].$el.find(d).appendDOM(a),U.previewNotAvlbl(t[1],!1,$.e(a),e)}.call(this,e,t):function(t){var e=zmUtil.getTheSrc("OpenDocument",t),a=P.call(this),i=$.e(j(e,a.height,a.width));i.attr("allowfullscreen","true"),F.call(this,U.loadingIndicatorTemplate(),i),E.call(this,i[0])}.call(this,t)},R=function(t){var e=this.attDet[t],a=e.dn&&""!==e.dn?e.dn:zmail.aInfo[zmail.accId].mailId,i=U.emailSplit(a),n=""!==i[1]?i[1]:"&nbsp;",s=""!==i[0]?i[0]:n,o=zmConUtil.bubbleUtil({attr:{"data-eid":n},name:s,ret:"dom"}),l=zmAttachment.templates,c=this,d=document.createDocumentFragment(),r=$.e(l.prevTopDom(e.fn));r.find(".msi-close").closest("b").off("click").on("click",function(){U.listview.previewCard.closePrevCard.call(c)}),d.appendChild(r[0]);var m=$.e(l.prevMainDom(o,e.rt||" ")),p=m.find(".zm_lbl"),h=U.getLabelArr(e.l);if(h.length){var u=zmsTemplates.constructTagListHTML(h,!1,2,"default",{constructOuterDiv:!0,getDOM:!0});$.e(u).insertDOMAfter(p.find(v)),p.find(v).addClass("SC_dyn"),p.find(".msi-plus").removeClass("SC_dyn")}return m.off("scroll").on("scroll",function(){zmUtil.hideMenu()}),m.find(".SCmb.SC_frt ul li").off("click").on("click",function(){(function(t){var e,a=zmsuite.getCenter(this.appName)[1].$el.attr("data-atId"),i=z.prevMenu;M=[];var n=this.attDet[a],s=n.attType===zmAttachUtility.fileType.hugeAttachment;M.push({txt:i.downLoad,data:{action:"download",attObj:n}}),M.push({sep:!0}),1===n.et&&(M.push({txt:i.lstAttSender,data:{action:"lstSender",attObj:n}}),M.push({txt:i.lstAttType,data:{action:"lstType",attObj:n}}),M.push({sep:!0}));var o=n.et,l=S[o];s?(M.push({txt:i.changePermission,data:{action:"changePerm",attObj:n}}),M.push({txt:i.sMail,data:{action:"sMail",attObj:n}}),M.push({sep:!0}),"$6"===(e=n.l)[0]?M.push({txt:i.remFav,data:{action:"remFav",attObj:n}}):M.push({txt:i.fav,data:{action:"fav",attObj:n}}),M.push({txt:i.copylink,data:{action:"copyLink",attObj:n}}),M.push({txt:i.delAtt,data:{action:"deleteAtt",attObj:n}})):(M.push({txt:l,data:{action:l,attObj:n}}),M.push({sep:!0}),M.push({txt:i.sMail,data:{action:"sMail",attObj:n}}),_zm.isStreamsEnabled()&&M.push({txt:i.attachToPost,data:{action:"attachToPost",attObj:n}}),U.isNotesAppEnabled()&&M.push({txt:i.attachToNote,data:{action:"attachToNote",attObj:n}}),M.push({sep:!0}),"$6"===(e=n.l)[0]?M.push({txt:i.remFav,data:{action:"remFav",attObj:n}}):M.push({txt:i.fav,data:{action:"fav",attObj:n}}),zmUtil.isAddToCloudAllowed()&&(M.push({sep:!0}),_zm.isTeamDriveEnabled()?M.push({dom:zdom("fragment",null,zdom("i",{className:"msi-rarrow"}),i.addToDocs),child:function(){return U.addSubMenu(this,"",n)}}):M.push({txt:i.addToDocs,data:{action:"addToDocs",attObj:n}})),101===n.ft&&(M.push({sep:!0}),M.push({txt:i.printImg,data:{action:"printImg",attObj:n}})),0<=e.indexOf("$HIDDEN")&&zmail.showFeature?(M.push({sep:!0}),M.push({txt:i.unhideAtt,data:{action:"unhideAtt",attObj:n}})):n.gId===zmail.zuid&&(M.push({sep:!0}),M.push({txt:i.hideAtt,data:{action:"hideAtt",attObj:n}}))),U.attDropDown("zm_AttView",t)}).call(c,this)}),m.find(".zmLbl").off("click").on("click",function(){U.showLabelPopup($.e(this),e)}),p.find(".zmAttLabelDrp").off("click").on("click",function(){U.showLabelPopup($.e(this),e)}),d.appendChild(m[0]),d},{keyBindingForPreviwCard:function(){var t=this;this.prev_shortcut_scope=zmComponent.keybindings.getScope();var e={allowDefaultScope:!1,shortcuts:[{uid:"next",keyStr:"downArrow",actions:[function(){zmsuite.getCenter(t.appName)[1].$el.find("b.SC_nlr:first").trigger("click")}]},{uid:"previous",keyStr:"upArrow",actions:[function(){zmsuite.getCenter(t.appName)[1].$el.find("b.SC_nrr:first").trigger("click")}]}],scope:"".concat(this.appName,"attPreviewCard")};zmComponent.keybindings.registerAll(e),zmComponent.keybindings.setScope("".concat(this.appName,"attPreviewCard"))},openPreviewCard:function(t,e){var a,i,n=$.e(t),s=n.attr("data-atId"),o=zmsuite.getCenter(this.appName),l=o[1].$el,c=o[0].getNodes()[2].$el,d=l.attr("data-atId"),r=z.contactCard,m=[{htm:r.addToContact,id:"zms_add",clk:zmConUtil.handleAddToContact},{htm:r.sendMail,clk:zmConUtil.loadCompose},{htm:r.listEmails,clk:zmConUtil.listMails}];if(s!==d){l.clearHTML(),l.attr("data-atId",s).appendDOM(R.call(this,s)),a=this.attDet[s],c.find("div.zmAch").removeClass("zmSLst"),l.removeClass("SC_w100 zmHideV").show(),n.addClass("zmSLst"),function(t){var i=t.prev(),n=t.next(),s=zmsuite.getCenter(this.appName)[1].$el;(function(){var t=this,e="b.SC_nrr:first",a="b.SC_nlr:first";i.length&&void 0!==i.attr("data-atid")?s.find(e).unbind("click").bind("click",function(){U.listview.previewCard.openPreviewCard.call(t,i,"prev")}):s.find(e).unbind("click").addClass("SC_opy3"),n.length&&void 0!==n.attr("data-atid")?s.find(a).unbind("click").bind("click",function(){U.listview.previewCard.openPreviewCard.call(t,n,"next")}):s.find(a).unbind("click").addClass("SC_opy3")}).call(this)}.call(this,n),i=a.dn&&""!==a.dn?a.dn:zmail.aInfo[zmail.accId].mailId;var p=U.emailSplit(i)[1],h=zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(p),avatarBgColor:zmail.ContactBook.Utils.colorClasses()})[0];if(l.find("#zmHdrAtt").find(".SC_pvul li").prependDOM(h),zmail.wmsAPI.showPresence(U.emailSplit(i)[1],$.e(h)),l.find("#zmHdrAtt").find(".SC_cs").click(function(t){zmConUtil.showContactCard({dom:this,items:m,event:t,source:"slideshow"})}),l.addClass("shw SC_scroll"),o[0].$el.addClass("SC_sw"),H.call(this,a),e){var u=c.find("[data-atId='".concat(d,"']"));zmUtil.initScroll(c,n,u,e,!0)}}},closePrevCard:function(){var t=zmsuite.getCenter(this.appName),e=t[1].$el,a=t[0].getNodes()[2].$el;e.attr("data-atId",""),a.find("div.zmAch").removeClass("zmSLst"),t[1].close(),e.find(d).empty(),zmComponent.keybindings.dropScope("".concat(this.appName,"attPreviewCard")),this.prev_shortcut_scope&&zmComponent.keybindings.setScope(this.prev_shortcut_scope)}});var G,a,B,q=(G={},{register:function(t){G[t]||(G[t]={})},deregister:function(t){G[t]&&delete G[t]},isRegisterd:function(t){return!!G[t]},getStoreData:function(){var t=function(t,e){if(G[t])return e?G[t][e]:G[t]}(this.appName,this.presentView);return"object"===babelHelpers.typeof(t)&&t.resp&&function(){var a=this,t=function(t,e){B.call(a,t,e)};" "!==this.prvFltr.lblId?this.getLblAttachments({loadingType:"loading",lstngObj:this.prvFltr,evType:!1,st:1,fType:this.fileType,forCaching:!0,callback:t}):this.getGroupAttachments("loading",!1,{callback:t})}.call(this),t},storeData:B=function(t,e){var a,i,n;q.isRegisterd(this.appName)&&!e.fromCache&&(a=this.appName,i=e.pView,n={resp:t,eprm:e},G[a]&&(G[a][i]=n))},flush:function(t,e){G[t]&&(e&&G[t][e]?delete G[t][e]:a(t))},flushExcept:a=function(t,e){var a,i=G[t];if(e=e||[],"object"===babelHelpers.typeof(i))for(a in i)e.indexOf(a)<0&&delete i[a]}});function W(t){this.appName=t.appName,this.$topEl=t.headerElem,this.$el=t.listElem,this.widthConst=t.thumbWidth,this.onFilterAction=t.onFilterAction,this.dType=t.dType||"t",this.viewType=t.viewType,this.groupId=t.groupId||zmail.zuid,this.entity=t.entity||"all",this.onScroll=t.onScroll,this.requireParams=t.requireParams,this.selectElm=t.selectElm,this.start=1,this.fileType=0,this.showNxt=void 0,this.showNxt101=0,this.showNxt102=0,this.showNxt103=0,this.showNxt104=0,this.showNxt105=0,this.isnew="y",this.attDet={},this.attArrObj={},this.selectedAttachment=[];for(var e=0,a=N.length;e<a;e++)this.attArrObj[N[e]]={showNxt:0,list:[]};this.prvFltr={lblId:" ",mthd:" "},this.fileTypeShowAll={101:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},102:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},103:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},104:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},105:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1}},this.isDone=!0,this.initView=!1,this.thumbCount=0,this.presentView="t".concat(zmail.zuid,"all0 "),t.cache&&(this.cachingEnabled=t.cache,this.cache={flush:q.flush,flushExcept:q.flushExcept}),"function"==typeof t.onListingUpdate&&(this.onListingUpdate=t.onListingUpdate)}W.prototype={initAttachViewComp:function(){var t,e=this;this.onScroll||this.$el.bind("scroll",function(){e.fillAttsOnScroll(),zmUtil.hideMenu()}),this.cachingEnabled?q.isRegisterd(this.appName)?(t=q.getStoreData.call(this),"object"===babelHelpers.typeof(t)&&t.resp?this.attLst(t.resp,{pView:this.presentView,thisRef:this,fromCache:!0}):this.getGroupAttachments()):(q.register(this.appName),this.getGroupAttachments()):this.getGroupAttachments()},fillAttsOnScroll:function(){var t=this.$el,e=t[0];Math.floor(e.scrollHeight-t.scrollTop())<=Math.floor(t.height())&&("t"!==this.dType||this.fileType)&&this.getAttachemntOnScroll()},getAttachemntOnScroll:function(){this.isDone||(this.isnew="n","l"===this.dType?this.start=this.showNxt:"t"===this.dType&&(this.start=this["showNxt".concat(this.fileType)]),this.start&&(" "===this.prvFltr.lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments({loadingType:"pagination",lstngObj:this.prvFltr,evType:"scrollEv"})))},onListingClick:function(t,e){U.bindAttachListEvents.call(this,t,e)},restoreOptions:function(t){var e=this.prvFltr,a=t.find("#zmAttGrp"),i=t.find("#zmAttLbl"),n=t.find("#zmAttEntity"),s=t.find("#zmAttFilTyp");"f"===e.lblId?i.text(z.menuText.favourites).data({dataIndex:e.lblId}):" "===e.lblId?i.text(z.menuText.none).data({dataIndex:e.lblId}):i.text(zmUtil.getTagList("default")[e.lblId].dispName).data({dataIndex:e.lblId}),U.showGroupAtt(this.groupId,a),n.text(U.entDrpTxtChange(this.entity)).data({dataIndex:this.entity}),s.text(z.fType[this.fileType]).data({dataIndex:this.fileType})},attLView:function(t,e){var a,i,n=document.createDocumentFragment();for(var s in this.attachCache(t,e),t){for(var o in a=t[s])(i=a[o]).Id?n.appendChild(U.consList(i,this.dType,this.appName,this.selectedAttachment)):void 0!==i.showNextPage&&(this.showNxt=i.showNextPage);return n}},attachCache:function(t,e){if(e){var a,i=N.length;for(a=0;a<i;a++)this.attArrObj[N[a]]={showNxt:0,list:[]}}for(var n in t){var s=n,o=t[n];for(var l in o){var c=o[l],d=c.Id+c.e;d&&(c.gId=this.groupId,c.uniqueId=d,c.sid?this.groupId!==zmail.zuid?c.type="viewGroupEntity":c.type="viewSelfData":this.groupId!==zmail.zuid&&(c.type="viewGroupData"),void 0===c.fn&&(c.fn=" "),this.attDet[d]=c,this.attArrObj[s].list.push(d))}}},attTView:function(t,e,a){var i,n,s,o=this.$el;for(var l in a&&"boolean"!=typeof a&&o.find("#msAttHdr".concat(this.fileType)).find(".SC_lnk").trigger("click"),e?(n=$.e(zdom("div",{className:"SC_tbdr SC_Aview"})),o.clearHTML().appendDOM(n)):n=o.find(".SC_tbdr"),this.attachCache(t,e),t)s=void 0,U.parseToNumber(l)&&t[l]&&(i=t[l],(s=e?$.e(U.thumbNailContainer(l,"msAttHdr",this.fileType)):o.find("#msAttHdr".concat(l))).length&&(this.fileTypeShowAll[l].insertSingleAttachment&&s.find("#tempLoadContainer").remove(),this.constThumbList(i,s,l)),e&&n.appendDOM(s));this.fileType&&1===U.parseToNumber(this.start)&&(o.find("#msAttHdr".concat(this.fileType)).find(".SC_nobdr").remove(),o.find("#msAttHdr".concat(this.fileType)).removeClass("zmAmht")),this.findScroll()},constThumbList:function(t,e,a,i){var n,s,o,l=t.length,c=this,d=!1,r=!1,m=0,p=1;i=i||!1;var h=this.fileTypeShowAll;s=this.$el;var u=this.widthConst;h[a].isHidden=!1,o=s[0].scrollWidth,s.is(":hidden")&&(o="attComp"===this.appName?s.closest(".SC_PUcen")[0].scrollWidth:(s=zmsuite.getCenter(this.appName)[0].getNodes()[2].$el)[0].scrollWidth);for(var f=0;f<l;f++){var v=t[f],g=void 0;if(v.Id)if(g=U.consList(v,this.dType,this.appName,this.selectedAttachment),e.appendDOM(g),1!==U.parseToNumber(this.start)||i||0!==this.fileType){if(!i&&f===l-2&&t[l-1].showNextPage){var z=e.children().length,b=(z-1)%this.thumbCount;n=z-b+1,r=d=!0;for(var C=0;C<b;C++)e.children(":last").remove()}}else{if((o<(m+=u)||h[a].insertSingleAttachment)&&2===p){e.children(":last").remove(),n=f,d=!0,this["showNxt".concat(a)]=t[t.length-1].showNextPage,void 0!==h[a].insertSingleAttachment&&(h[a].insertSingleAttachment=!1),this.thumbCount=f/2;break}(o<m||h[a].insertSingleAttachment)&&(p=2,m=u)}else this["showNxt".concat(a)]=v.showNextPage,v.showNextPage&&!d&&(d=!0)}d?("y"===this.isnew||r?h[a].stoppedIndex=0:h[a].stoppedIndex-=1,h[a].isHidden=!0,h[a].stoppedIndex+=n,e.find(".SC_lnk").off("click").on("click",function(){c.showAllThb(h[a].stoppedIndex,"t",t[t.length-1].showNextPage,c.entity,a,"n",r,e)})):e.find(".SC_lnk").hide()},showAllThb:function(t,e,a,i,n,s,o,l){var c,d,r,m;if(o)d=U.getAttachObject(t,n,this),this.constThumbList(d,l,n,!0);else{(c=this.$el.find("#msAttHdr".concat(n))).find(".SC_nobdr").remove(),c.find(".SC_lnk").hide();for(var p=101;p<=105;p++)p!==U.parseToNumber(n)&&this.$el.find("#msAttHdr".concat(p)).remove();c.removeClass("zmAmht"),d=U.getAttachObject(t,n,this),this.constThumbList(d,l,n,!0),a&&1!==U.parseToNumber(a)?" "===(r=this.prvFltr).lblId?this.getAttLst({groupId:this.groupId,dType:e,st:a,eType:i,fType:n,prvFltr:r,isNew:s,lstngObj:!1,flag:!0}):(m=r,this.getAttLst({groupId:this.groupId,dType:e,st:a,eType:i,fType:n,prvFltr:r,isNew:s,lstngObj:m,flag:!0})):this.fileType=n,this.showHideDefaultview()}},attLst:function(t,e){var a,i,n=e.thisRef,s=n.$el,o=n.presentView,l=n.dType;if("function"==typeof e.removeLoadingBand&&e.removeLoadingBand(),e.pView===o){if(U.chkAttResp(t))(a="y"===n.isnew)&&n.cachingEnabled&&q.storeData.call(n,t,e),"l"===l?("attView"===n.appName||"attComp"===n.appName||"list"===n.viewType?s.removeClass("SC_tmbvw"):s.addClass("SC_tmbvw"),i=n.attLView(t,a),1===n.start?(s.clearHTML().appendDOM(i),s.scrollTop(0)):$.e(i).insertDOMAfter(s.find(".zmAch:last")),n.findScroll(s)):(s.addClass("SC_tmbvw"),n.initView=!0,n.attTView(t,a,e.evT));else{if(1===n.start){var c=n.initView||"attView"!==n.appName?z.common.noAttFound:z.common.noAttFoundAll;U.noAttach(s,c)}"t"===n.dType?n["showNxt".concat(this.fileType)]=0:"l"===n.dType&&(n.showNxt=0)}s.children().show(),n.isDone=!1,n.showHideDefaultview(),"function"==typeof n.onListingUpdate&&n.onListingUpdate(e.fromCache)}else s.children().show()},findScroll:function(){if(!this.onScroll){var t,e,a=this.$el;(t="t"===this.dType?this["showNxt".concat(this.fileType)]:this.showNxt)&&a[0].scrollHeight<=a[0].clientHeight&&(this.start=t,this.isnew="n"," "===(e=this.prvFltr).lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments({loadingType:"pagination",lstngObj:e,evType:"scrollEv"}))}},getAttLst:function(t){var e=t.lstngObj,a=t.prvFltr,i=t.dType,n=t.groupId,s=t.eType,o=t.fType;if(this.groupId!==n||this.dType!==i||this.fileType!==o||this.entity!==s||e&&a.lblId!==e.lblId){if("object"===babelHelpers.typeof(e)?(a.lblId=e.lblId,a.mthd=e.mthd):(a.lblId=" ",a.mthd=" "),this.presentView=i+n+s+o+a.lblId,this.groupId=n,this.dType=i,t.st?this.start=t.st:this.start=1,this.entity=s&&""!==s?s:"all",this.fileType=o||0,t.isNew?this.isnew=t.isNew:this.isnew="n","y"===this.isnew&&this.cachingEnabled){var l=q.getStoreData.call(this);if("object"===babelHelpers.typeof(l)&&l.resp)return void this.attLst(l.resp,{pView:this.presentView,thisRef:this,fromCache:!0})}"attView"===this.appName&&U.listview.previewCard.closePrevCard.call(this)," "!==a.lblId?this.getLblAttachments({loadingType:"loading",lstngObj:e,evType:t.flag}):this.getGroupAttachments("loading",t.flag)}},getLblAttachments:function(t){var e=this.$el,a=t.container||e[0],i=t.st||this.start,n=t.lstngObj,s={method:n.mthd,dType:this.dType,from:i,range:25,groupId:this.groupId},o=t.loadingType;this.isDone=!0;var l=this.attLst;"all"!==this.entity&&(s.entityType=x[this.entity]);var c=t.fType||this.fileType;0!==c&&(s.fileType=c),"labelListing"===n.mthd&&(s.label=n.lblId),1===U.parseToNumber(i)&&(this.attDet=[],e.children().hide()),"streams"!==this.appName&&"attComp"!==this.appName||(o="pagination"),t.forCaching?U.ajaxReq.getGroupLblAttachments({paramInfo:s,ep:{evT:t.evType,pView:this.presentView,thisRef:this}},t.callback):U.ajaxReq.getGroupLblAttachments({paramInfo:s,ep:{evT:t.evType,pView:this.presentView,thisRef:this}},l,{loadingContainer:a,loadingType:o})},getGroupAttachments:function(t,e,a){var i=this.$el,n={};this.isDone=!0;var s=this.presentView,o=this.attLst;this.requireParams&&this.requireParams.constructor===Object?$.extend(!0,n,this.requireParams):(n.type=this.dType,n.frm=this.start,n.entity=this.entity,n.ftype=this.fileType,n.groupId=this.groupId),n.frm=this.start,"streams"!==this.appName&&"attComp"!==this.appName||(t="pagination"),"object"!==babelHelpers.typeof(a)?(1===U.parseToNumber(this.start)&&(this.attDet=[],i.children().hide()),U.ajaxReq.getGroupAttachments({paramInfo:n,ep:{evT:e,pView:s,thisRef:this}},o,{loadingContainer:i[0],loadingType:t})):U.ajaxReq.getGroupAttachments({paramInfo:n,ep:{evT:e,pView:s,thisRef:this}},a.callback)},showHideDefaultview:function(){"function"!=typeof this.onFilterAction||this.onFilterAction()}};var X,Z,J,K,Q,Y,tt,et,at,it,nt,st,ot,lt,ct,dt,rt,mt,pt=(J=[],K=Z=0,Q={},Y={},tt=function(t){zmAttachment.slideshow.closeSlideshow(),t&&$.publish("zm/closeAllOpenDialog")},et=function(t){return"msi-attimg"===t[1]||t[1]===i&&s[t[2]]||t[1]===n&&s[t[2]]},it=function(t){var a=I[t.et],e=zmUtil.fileTyp(t.fn),i={};return a&&(!Q.hideIcons||Q.hideIcons.indexOf(a)<0)&&(i.entity={class:a,title:S[t.et],events:[{name:"click",listener:function(t,e){at(a,e)}}],before:".msi-send"}),(!Q.hideIcons||Q.hideIcons.indexOf("msi-print")<0)&&et(e)&&(i.print={class:"msi-print",id:"attMsi-print",title:z.prevMenu.printImg,events:[{name:"click",listener:function(t,e){at("msi-print",e)}}],after:".".concat(T)}),"msi-mail"===a&&(!Q.hideIcons||Q.hideIcons.indexOf(m)<0)&&(i.search={class:m,title:z.prevMenu.search,events:[{name:"click",listener:function(t,e){var a=$.e(t.target||t.srcElem);at(m,e,a)}}],before:".msi-mail"}),i},nt=function(t){var e,a=zmUtil.fileTyp(t.fn);if((a[1]===i||"msi-attppt"===a[1]||"msi-attsheet"===a[1])&&!s[a[2]])return zmUtil.getTheSrc("OpenDocument",t);if(a[1]===p||a[1]===i&&s[a[2]]||a[1]===n&&s[a[2]]||"msi-atthtml"===a[1]&&s[a[2]]){if(e=!0,(window.ActiveXObject||"ActiveXObject"in window)&&L[a[2]]&&(e=!1),e)return zmUtil.getTheSrc("FileDownload",t)}else{if("msi-attaudio"===a[1]||"msi-attvideo"===a[1])return zmUtil.getTheSrc("FileDownload",t);if("msi-attimg"===a[1])return zmUtil.getTheSrc("FileDownload",t)}return""},st=function(t,e,a){Y[e]&&Y[e].l.indexOf(a)<0&&Y[e].l.push(a)},ot=function(t,e,a){if(Y[e]){var i=Y[e].l,n=i.indexOf(a);0<=n&&i.splice(n,1)}},lt=function(t,e,a){if(Y[e]){var i=Y[e].l,n=i.indexOf("$6");a?n<0&&i.unshift("$6"):0<=n&&i.splice(n,1)}},ct=function(t){tt(!0)},dt=function(){zmComponent.keybindings.dropScope("slideshowwrapper"),zmComponent.keybindings.setScope(X),$.unsubscribe(u,st),$.unsubscribe(c,ot),$.unsubscribe(f,lt),$.unsubscribe("attachment/closeSlideshow",tt),$.unsubscribe("mailsuite/hashurl/updated",ct),"function"==typeof Q.onCancel&&Q.onCancel()},rt=function(t){var a=$.e(zdom("div",{className:"SC_pEml"}));return zmAttachment.slideshow.showLoading(),zmAttach.util.constMailFromEml(t.handBackObj,function(t){var e=a.closest(".ZC_Pop");a.closest(".SC_oh").addClass("SC_emlCont"),a.closest(".SC_pe").css("height",a.closest(".SC_pe").css("max-height")),a.css({maxHeight:e.height()-5,maxWidth:e.width()-5}),zmAttachment.slideshow.removeLoading(),a.appendDOM(t)}),a},mt=function(){var t,e,a,i,n,s,o={},l={},c=!1;!function(){X=zmComponent.keybindings.getScope();zmComponent.keybindings.registerAll({allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){}]}],scope:"slideshowwrapper"}),zmComponent.keybindings.setScope("slideshowwrapper")}(),o.attachmentObjectList=[],o.setIndex=Z,o._i18NText={common:z.common,prevMenu:z.prevMenu,loupe:z.slideshow.loupe,tooltip:z.slideshow.tooltip},o.onCancel=dt,Q.hideAllOptions||(o.rightIconList=(a={},i=".".concat(T),n=Q.attObjList[Q.startIndex]||{},zmUtil.isAddToCloudAllowed()&&n.attType!==zmAttachUtility.fileType.hugeAttachment&&n.attType!==zmAttachUtility.fileType.workDriveAtt&&(a.addToCloud={class:A,title:z.UserMsg.addToCloud,events:[{name:"click",listener:function(t,e){tt(!0),zmUtil.cloudUploader(e)}}]},i=".msi-addcloud",_zm.isTeamDriveEnabled()&&(a.addToWorkDrive={class:"msi-workDrive",title:z.prevMenu.teamDrive,events:[{name:"click",listener:function(t,e){tt(!0),zmUtil.attachToWorkDrive({attachments:[e]})}}],before:".".concat(T)})),a.download={class:T,title:z.UserMsg.download,events:[{name:"click",listener:function(t,e){at(T,e,t.target)}}]},a.share={class:"msi-share",title:z.UserMsg.share,events:[{name:"click",listener:function(t,e){at("msi-share",e,t.target||t.srcElement)}}],before:i},a),(!Q.hideIcons||Q.hideIcons.indexOf("msi-fav")<0)&&(o.leftIconList={fav:{class:"msi-fav",title:z.UserMsg.fav,events:[{name:"click",listener:function(t,e){var a=!0;$.e(t.target||t.srcElement).hasClass("SC_fav")&&(a=!1,e.l&&e.l.length&&"$6"===e.l[0]&&e.l.splice(0,1)),at("msi-fav",e,a)}}]},tag:{class:"msi-label",title:z.UserMsg.addLabel,events:[{name:"click",listener:function(t,e){var a=t.target||t.srcElement;at("addLabel",e,a)}}]}})),Q.targetEle&&(o.targetEle=Q.targetEle,o.onCloseAnimation=!0);for(var d=0;d<K;d++)l={},t=J[d],l.isImage=101===t.ft,l.filename=t.fn||"",l.source=t.src||nt(t),l.thumbnail=t.thn,l.handBackObj=t,Y[t.Id+t.e]=t,e=zmUtil.fileTyp(l.filename)[2],Q.hideAllOptions||(l.iconList=it(t),l.action={text:z.UserMsg.download,listener:function(t,e){e.attType===zmAttachUtility.fileType.hugeAttachment?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(e)):e.attType===zmAttachUtility.fileType.workDriveAtt?window.open(e.cloudLink,"_blank"):zmUtil.downloadAttachment(e)}}),Q.ignoreEMLParsing||"eml"!==e&&"msg"!==e||(l.source=void 0,l.handleFilePreview=rt),(t.callee_type||t.showInFrame)&&(o.ignoreThumb=!0,l.showInFrame=t.showInFrame),Q.ignoreThumb&&(o.ignoreThumb=Q.ignoreThumb),t.hideFileName&&(c=!0),t.hideShareOption&&(l.hideShareOption=t.hideShareOption),t.tweetText&&(l.tweetText=t.tweetText,l.featureURL="".concat(window.location.protocol,"//zoho.to/newzmail")),Q.addIcons instanceof Object&&(l.iconList=(s=l.iconList,$.extend(!0,{},s,Q.addIcons))),o.attachmentObjectList.push(l);o.afterPreviewInit=function(t,e){if(e.l=Y[e.Id+e.e].l,(window.ActiveXObject||"ActiveXObject"in window)&&zmUtil.fileTyp(e.fn)[1]===p&&window.setTimeout(function(){t.find(".At_load").remove(),t.find("iframe").css("visibility","visible")},2e3),zmUtil.isZohoAccount(zmail.accId)&&!Q.hideAllOptions&&(!Q.hideIcons||Q.hideIcons.indexOf("msi-fav")<0)){var a=t.find(".msi-fav"),i=e.l;i&&i.length&&"$6"===i[0]?a.addClass("SC_fav").attr({"data-tooltip":z.UserMsg.remFav,"data-tooltip-pos":"top"}):a.removeClass("SC_fav").attr({"data-tooltip":z.UserMsg.fav,"data-tooltip-pos":"top"}),function(t,e){var a=t.find("#sshwLeftIcons > div");if($.e(a).find(".zmLblGrp").remove(),e.l){var i=U.getLabelArr(e.l);if(i.length){var n=zmsTemplates.constructTagListHTML(i,!0,void 0,"default",{constructOuterDiv:!0,getDOM:!0});a.appendDOM(n)}}}(t,e)}},(Q.hideFileName||c)&&(o.hideFileName=!0),Q.onLoad&&(o.onLoad=Q.onLoad),o.iconClasses={closeClass:"msi-close",prevClass:"msi-atprev",nextClass:"msi-atnext",moreClass:"msi-thumbnail",zoominClass:"msi-zoomin",zoomoutClass:"msi-zoomout",printClass:"msi-print",addToCloudClass:A,downloadClass:T,zoomPlusClass:"msi-plus",zoomMinusClass:"msi-minus"},o.loupe=!0,o.iconClasses.loupeClass="msi-magnify",o.afterInit=function(t){t.removeClass("ZC_lightbox SC_lightbox")},o.shortCuts=[{keyStr:"ctrl+p",action:function(t){if(t&&t.fn&&t.e){var e=zmUtil.fileTyp(t.fn);et(e)&&at("msi-print",t)}},preventDefault:!0},{keyStr:"cmd+p",action:function(t){if(t&&t.fn&&t.e){var e=zmUtil.fileTyp(t.fn);et(e)&&at("msi-print",t)}},preventDefault:!0}],o.onMouseDown=function(t){var e=$.e(t.target||t.srcElement);zmUtil.hideMenu(),e.hasClass("SC_thm")||($.q("#".concat(h," .SC_thm")).removeClass("SC_thm"),zmAttachment.slideshow.getLoupeStatus()&&$.q("#".concat(h," .msi-magnify")).addClass("zmThmClr"))},zmAppLoader.load("slideshowComp").done(function(){zmAttachment.slideshow.initSlideShow(o)})},{init:function(t){var e,a;(a=t)&&a.attObjList?(Z=(e=t).startIndex||0,J=e.attObjList,K=J.length,Q=e,Y={},mt(),$.subscribe(u,st),$.subscribe(c,ot),$.subscribe(f,lt),$.subscribe("attachment/closeSlideshow",tt),$.subscribe("mailsuite/hashurl/updated",ct)):zmUtil.debugLog("Slideshow: Invalid config")},action:at=function(t,a,e){var i,n=e,s=$.e(e),o=zmUtil.fileTyp(a.fn);switch(t){case"msi-mail":tt(!0),U.openMail(a);break;case"msi-notes":tt(),zmUtil.loadNotes("openNote",a);break;case"msi-task":case b:case C:tt(),U.openPost(a);break;case m:n.hasClass("SC_thm")?(n.removeClass("SC_thm"),zmUtil.hideMenu()):(n.addClass("SC_thm"),(i={id:"zm_lstSrc",par:n,align:"pright"}).divId=l,n.find("b").addClass("SC_ddn"),i.list=O,i.align="mright",i.showArrow=!0,i.direction="bottom",i.clk=function(t){var e=t.action;1===e?U.searchAttachment("sender",a):2===e&&U.searchAttachment("filetype",a),zmUtil.hideMenu(),tt(!0)},zmDropDownMenu.show(i),$.q("#".concat(l)).css("zIndex",1e6));break;case"msi-send":tt(!0),U.sendMail(a);break;case"msi-share":s.hasClass("SC_thm")?(s.removeClass("SC_thm"),zmUtil.hideMenu()):(U.createShareDropDownMenu({ele:s,clk:function(t){"attachToPost"===t.action?zmUtil.loadNewPostDialog("",[a]):"attachToMail"===t.action?zmUtil.openComposeWithAtt([a]):"attachToNote"===t.action?zmUtil.loadNotes("popup",{attEntObj:[a]}):"attachToTask"===t.action&&zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:[a]}}),tt(!0)},divId:l,attObj:a}),$.q("#".concat(l)).css("zIndex",1e6));break;case"msi-fav":U.attFav(a,e);break;case"addLabel":$.e(e).hasClass("SC_thm")?($.e(e).removeClass("SC_thm"),zmUtil.hideMenu()):(U.addLabel(a,"slideShow"),$.e(e).addClass("SC_thm"));break;case"removeLabel":U.removeLabelApi(a,U.removeLabelApiResult);break;case"msi-print":U.printImageAtt(a);break;case"msi-unhide":U.restoreToAttachmentView(a);break;case T:"eml"===o[2]||"msg"===o[2]?function(a,t){if(t.hasClass("SC_thm"))t.removeClass("SC_thm"),zmUtil.hideMenu();else{var e=t,i=z.prevMenu,n=[],s={},o="";a&&a.fn&&(o=zmUtil.fileTyp(a.fn)[2]||""),n.push({txt:zmText.applyArgs(i.saveasfile,{filetype:o.toUpperCase()}),data:{action:"saveaseml"}}),n.push({txt:zmText.applyArgs(i.saveasfile,{filetype:"HTML"}),data:{action:"saveashtml"}}),(s={par:t,list:n,onHide:function(){t.removeClass("SC_thm")},clk:function(t,e){"saveaseml"===t.action?zmUtil.downloadAttachment(a):zmAttach.util.save($.q("#".concat(h," .SC_pEml")).clearHTML(),"html",a.fn),zmUtil.hideMenu()},showArrow:!0}).divId=l,e.addClass("SC_thm"),zmsuite.showMenu(s),$.q("#").css("zIndex",1e6)}}(a,$.e(e)):a.attType===zmAttachUtility.fileType.hugeAttachment?zmAttachComponent.hugeAttachment.downloadFile(a):zmUtil.downloadAttachment(a)}}}),ht=function(){function a(t){this.attachUtil=null,this.config=t}var e=function(t,e){this.attachUtil.$el.off(t).on(t,e.bind(this))};a.prototype.initComponent=function(){var a=this;this.attachUtil=new zmAttachUtility.AttachmentListing(this.config),this.config.listElem.undelegate("click").delegate(".zmAch","click",function(t){a.attachUtil.onListingClick(t,this)}),e.call(this,"contextmenu",function(t){U.listOptions.call(this,t)}),this.attachUtil.dType="l";var t=this.attachUtil.selectElm;"streams"===this.attachUtil.appName&&t&&($.e(t).find(".SC_attDwnZip").click(function(){zmUtil.downloadSelected(a.attachUtil.selectedAttachment),setTimeout(function(){V.call(a)},1e3)}),$.e(t).find(".SC_attAttachTo").click(function(){U.createShareDropDownMenu({ele:this,clk:function(t){var e=a.attachUtil.selectedAttachment;"attachToPost"===t.action?zmUtil.loadNewPostDialog("",e):"attachToMail"===t.action?zmUtil.openComposeWithAtt(e):"attachToNote"===t.action?zmUtil.loadNotes("popup",{attEntObj:e}):"attachToTask"===t.action&&zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:e}}),setTimeout(function(){V.call(a)},1e3)}})}));this.attachUtil.initAttachViewComp()},a.prototype.init=function(t){this.reset(t),this.attachUtil.getGroupAttachments()},a.prototype.onScroll=function(){this.attachUtil.onScroll&&this.attachUtil.getAttachemntOnScroll()},a.prototype.reset=function(t){t&&(t.headerElem&&(t.listElem||($.e(t.headerElem).appendDOM(zdom("div",{className:"SC_tmbvw"})),t.listElem=$.e(t.headerElem).find(".SC_tmbvw")),this.attachUtil.$topEl=t.headerElem,this.attachUtil.$el=t.listElem,e.call(this,"contextmenu",function(t){U.listOptions.call(this,t)})),t.groupId&&(this.attachUtil.groupId=t.groupId),t.onScroll&&(this.attachUtil.onScroll=t.onScroll),t.viewType&&(this.attachUtil.viewType=t.viewType),t.entity&&(this.attachUtil.entity=t.entity),t.fileType&&(this.attachUtil.fileType=t.fileType),this.attachUtil.start=1)},a.prototype.isNewRequest=function(){return 1===this.attachUtil.start},a.prototype.toggleView=function(){"list"===this.attachUtil.viewType?(this.attachUtil.viewType="thumb",this.attachUtil.$el.addClass("SC_tmbvw")):(this.attachUtil.viewType="list",this.attachUtil.$el.removeClass("SC_tmbvw"))};return{init:function(t){t.listElem||($.e(t.headerElem).appendDOM(zdom("div",{className:"SC_tmbvw"})),t.listElem=$.e(t.headerElem).find(".SC_tmbvw")),t.thumbWidth||(t.thumbWidth=191),t.viewType||(t.viewType="thumb");var e=new a(t);return e.initComponent(),e}}}();t.attType=N,t.annotateImage={png:!0,jpg:!0,jpeg:!0},t.AttachmentListing=W,t.AttLstArr=k,t.getGroups=U.getGroups,t.getLabels=U.getLabels,t.attDropDown=U.attDropDown,t.createShareDropDownMenu=U.createShareDropDownMenu,t.entDrpTxtChange=U.entDrpTxtChange,t.noAttach=U.noAttach,t.consList=U.consList,t.getGroupAttachments=U.ajaxReq.getGroupAttachments,t.getGroupLblAttachments=U.ajaxReq.getGroupLblAttachments,t.addEventsToCal=U.addEventsToCal,t.addToCloud=U.uploadToCloud.initAddToCloud,t.addToCloudClose=U.uploadToCloud.addToCloudClose,t.cloudUpload=U.uploadToCloud.cloudUpload,t.getFilterDropTemplate=e.getFilterDropTemplate,t.initSlideshow=pt.init,t.initAttachListing=ht.init,t.bindAttachListEvents=U.bindAttachListEvents,t.closePrevCard=U.listview.previewCard.closePrevCard,t.createAttContextMenu=U.listOptions,t.removeLabelRef=U.removeLabelRef,t.addLabelRef=U.addLabelRef,t.modifyFavLblRef=U.modifyFavLblRef,t.isRestrictedIE=U.isRestrictedIE,t.isDocsCompAllowed=U.isDocsCompAllowed,t.parseToNumber=U.parseToNumber,t.parseToInteger=U.parseToInteger,t.showLabelPopup=U.showLabelPopup,t.appendAttachments=function(t,e,a,l){var i,n={common:" ",huge:" ".concat(z.common.hugeAtt),teamdrive:" ".concat(z.common.workDriveAtt)},c=$.e(e).find(".attSec_".concat(a));if(c.length)i=c.find(".zmAttGrp"),c.hasClass("collapsed")?c.removeClass("collapsed").find(".zmAttGrp").slideDown(400,function(){i.appendDOM(t)}):i.appendDOM(t);else{if((c=zmAttachment.templates.getAttachSection(a)).getElementsByClassName("attSecHeader")[0].onclick=function(){var t=function(){l&&l.configJSON&&l.configJSON.onExpandCollapse&&l.configJSON.onExpandCollapse()};if($.e(c).hasClass("collapsed")){var e=$.e(c).parents(".zmCAttGrp")[0];$.e(c).find(".zmAttGrp").css({position:"absolute",visibility:"hidden",display:"block"});var a,i=e.getBoundingClientRect(),n=c.getBoundingClientRect(),s=c.scrollHeight,o=n.top+s;i.height>s&&i.bottom<o?a=e.scrollTop+(o-i.bottom):n.top>i.top&&(a=e.scrollTop+(n.top-i.top)),$.e(c).find(".zmAttGrp").removeAttr("style").css({display:"none"}),$.e(c).removeClass("collapsed").find(".zmAttGrp").slideDown(400,t),void 0!==a&&10<Math.abs(e.scrollTop-a)&&setTimeout(function(){$.e(e).animate({scrollTop:a},400)},50)}else $.e(c).addClass("collapsed").find(".zmAttGrp").slideUp(400,t)},"common"===a)$.e(e).appendDOM(c);else if("teamdrive"===a)$.e(e).prependDOM(c);else if("huge"===a)if($.e(e).children().length){var s=$.e(e).find(".attSec_common");s.length?$.e(c).insertDOMBefore(s):$.e(e).find(".attSec_teamdrive").length&&$.e(e).appendDOM(c)}else $.e(e).appendDOM(c);(i=$.e(c).find(".zmAttGrp")).appendDOM(t)}var o=i.children().length,d="".concat(n[a]," ").concat(1===o?z.common.attachment:z.common.attachments);$.e(c).find(".attCount").text(o+d)},t.removeAttachments=function(t,e){var a={common:" ",huge:" ".concat(z.common.hugeAtt),teamdrive:" ".concat(z.common.workDriveAtt)},i=$.e(t).parents(".attSec_".concat(e)),n=i.find(".zmAttGrp");$.e(t).remove();var s=n.children().length;if(s){var o="".concat(a[e]," ").concat(1===s?z.common.attachment:z.common.attachments);i.find(".attCount").text(s+o)}else i.remove()}}(),function(){var t=zmail.Core.Namespaces.create("zmAttachUtility"),o=zmText.get("attachmentUtility"),l={},c="attSelCnt",a=null,e={workspaceConfig:{appname:"Attachment Listing",appId:"attachList",headerText:void 0,data:{CNodes:"3"},appIcon:"msi-attsearch",searchPlaceHolder:o.prevMenu.search,faqKey:"attachment",hashKey:"",isNewPreview:!1,isNewHeader:!0,hashChangeHandler:function(t){zmUtil.debugLog("Attachment Listing Component URL Changed",t,this)}},attachListingConfig:{appName:"attListing",viewType:"thumb",onFilterAction:function(){return!0}}};function i(t){this.configuration=t,this.workspaceConfig=$.extend(!0,{},e.workspaceConfig),this.attachListingConfig=$.extend(!0,{},e.attachListingConfig),this.attListComp=null,this.workspaceConfig.onDelete=l.workspace.onDelete.bind(this),l.initialise.call(this),this.render()}i.prototype.render=function(){var e=this;l.createAttachmentListingInsance(this.attachListingConfig).then(function(t){e.attListComp=t,a||(a=zmUtil.setDragAndDrop(t.attachUtil.$el,{getAttachments:function(){return e.attListComp.attachUtil},onDragEnd:function(){l.resetSelectionViewAndData.call(e)}}))})},i.prototype.rerender=function(t){var e,a,i;this.isWorkspaceAvailable()&&(t&&t.constructor===Object&&($.extend(!0,this.configuration,t),(e=t.attachListingConfig)&&e.constructor===Object&&$.extend(!0,this.attachListingConfig,e),(a=t.workspaceConfig)&&a.constructor===Object&&($.extend(!0,this.workspaceConfig,t.workspaceConfig),this.workspaceConfig.onClose=null,i=l.workspace.update,a.headerText&&i.title.call(this,a.headerText),a.headerDOM&&i.headerHTML.call(this,a.headerDOM),a.appname&&i.tooltip.call(this,a.appname))),this.attachListingConfig.listElem.clearHTML(),this.showWorkSpace(),l.resetSelectionViewAndData.call(this),this.render())},i.prototype.isWorkspaceAvailable=function(){return zmsuite.isWorkspaceAvailable(this.workspaceConfig.appId)},i.prototype.showWorkSpace=function(){l.workspace.show.call(this)},i.prototype.getWorkspacekey=function(){return this.workspaceConfig.workspaceKey},i.prototype.changeView=function(t){if(this.attListComp.attachUtil.viewType!==t){var e=zmsuite.getCenter(this.workspaceConfig.appId).rightIconHeader.collection;e.get("thumbNailView").set("isSelectedMenu","thumb"===t),e.get("listView").set("isSelectedMenu","list"===t),this.attListComp.toggleView()}},l.createAttachmentListingInsance=function(t){var e=$.Deferred();return zmUtil.initAttachListing(t,function(t){e.resolve(t)}),e},l.isAttachmentListingInstance=function(){return this.constructor===i},l.initialise=function(){l.isAttachmentListingInstance.call(this)&&($.extend(!0,this.workspaceConfig,this.configuration.workspaceConfig),$.extend(!0,this.attachListingConfig,this.configuration.attachListingConfig),this.workspaceConfig.onClose=null,zmsuite.isWorkspaceAvailable(this.workspaceConfig.appId)?l.workspace.show.call(this):l.workspace.create.call(this),this.attachListingConfig.headerElem=zmsuite.getCenter(this.workspaceConfig.appId)[0].$el,this.attachListingConfig.listElem=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[2].$el)},l.onAttachmentSelect=function(t,e){var a=this.attListComp.attachUtil;if(e===a.appName){var i=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes();a.selectedAttachment[1]||i[1].menuBar.$el.removeClass("zmHideD");var n=1===a.selectedAttachment.length?o.common.oneattselected:o.common.noofattselected,s=i[1].titleBar.$el.find(".".concat(c));s.length?s.find(".attSelCntTxt").text("".concat(a.selectedAttachment.length," ").concat(n)):i[1].titleBar.$el.appendDOM(zdom("span",{className:c},zdom("span",{className:"zmSDot"}),zdom("span",{className:"zmGreyClr attSelCntTxt"},"".concat(a.selectedAttachment.length," ").concat(n))))}},l.onAttachmentUnselect=function(t,e){var a=this.attListComp.attachUtil;if(e===a.appName){var i=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes();if(a.selectedAttachment[0]){var n=1===a.selectedAttachment.length?o.common.oneattselected:o.common.noofattselected;i[1].titleBar.$el.find(".attSelCntTxt").text("".concat(a.selectedAttachment.length," ").concat(n))}else i[1].menuBar.$el.addClass("zmHideD"),i[1].titleBar.$el.find(".".concat(c)).remove()}},l.resetSelectionViewAndData=function(){var t=this.attListComp.attachUtil,e=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes();e[2].$el.find(".SC_check").removeClass("SC_check"),e[1].menuBar.$el.addClass("zmHideD"),e[1].titleBar.$el.find(".".concat(c)).remove(),t.selectedAttachment=[]},l.shareOptionHandler=function(t){var e=this.attListComp.attachUtil;"attachToPost"===t.action?zmUtil.loadNewPostDialog("",e.selectedAttachment):"attachToMail"===t.action?zmUtil.openComposeWithAtt(e.selectedAttachment):"attachToNote"===t.action?zmUtil.loadNotes("popup",{attEntObj:e.selectedAttachment}):"attachToTask"===t.action&&zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:e.selectedAttachment}}),l.resetSelectionViewAndData.call(this)},l.subscribeToEvents=function(){$.subscribe("attachmentView/attachmentSelected",l.onAttachmentSelect.bind(this)),$.subscribe("attachmentView/attachmentUnselected",l.onAttachmentUnselect.bind(this))},l.unsubscribeToEvents=function(){$.unsubscribe("attachmentView/attachmentSelected",l.onAttachmentSelect.bind(this)),$.unsubscribe("attachmentView/attachmentUnselected",l.onAttachmentUnselect.bind(this))},l.workspace={show:function(){zmsuite.showWorkSpace(this.workspaceConfig.appId)},render:function(){zmsuite.renderWorkSpace()},afterRender:function(){var t=zmsuite.getCenter(this.workspaceConfig.appId)[0],e=t.getNodes();t.$el.addClass("SC_attachviewer"),e[2].$el.scroll(function(){zmUtil.hideMenu()})},set:function(){zmsuite.setWorkSpace(this.workspaceConfig)},get:{center:function(){return zmsuite.getCenter(this.workspaceConfig.appId)[0]},listing:function(){return zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[2].$el}},update:{title:function(t){"string"==typeof t&&zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[1].$el.find(".SC_mtb").text(t)},headerHTML:function(t){"string"==typeof t&&zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[1].$el.find(".SC_mtb").dangerouslySetInnerHTML(t)},tooltip:function(t){var e;"string"==typeof t&&((e=zmTab.getTabObject(this.workspaceConfig.appId)).appname=t,zmTab.updateTabLst(e))}},create:function(){var e=this;l.workspace.set.call(this);var t=zmsuite.getCenter(this.workspaceConfig.appId),a=t[0].getNodes(),i=t[1].getNodes();a[1].appendIconBar(),a[1].titleBar.$el.appendDOM(zdom("strong",null,e.workspaceConfig.headerText||e.workspaceConfig.headerDOM)),a[1].menuBar.$el.addClass("zmHideD");var n=[{type:"text",id:"downloadAsZip",text:o.common.downloadAll,haveThemeColor:!0,applybackgroundThemeColor:!1,callback:function(){var t=e.attListComp.attachUtil.selectedAttachment;zmUtil.downloadSelected(t),setTimeout(function(){l.resetSelectionViewAndData.call(e)},1e3)}},{type:"text",id:"attachTo",text:o.common.addTo,menuWithArrow:!0,menuWithArrowClassName:"msi-rarrow",haveThemeColor:!0,haveSeparatorDot:!0,applybackgroundThemeColor:!1,callback:function(t){zmAttachUtility.createShareDropDownMenu({ele:t.target,clk:l.shareOptionHandler.bind(e)})}}];zmIconConstructor.createIcon({iconList:n,targetContainer:a[1].menuBar.$el[0]});var s=[{type:"icon",id:"thumbNailView",iconClass:"msi-thumbview",tooltip:o.common.thumbView,isSelectedMenu:!0,callback:function(){e.changeView("thumb")}},{type:"icon",id:"listView",iconClass:"msi-listview",tooltip:o.common.listView,callback:function(){e.changeView("list")}}];t.rightIconHeader=zmIconConstructor.createIcon({iconList:s,targetContainer:a[1].$el.children()[1]}),a[2].setListener("contextmenu",function(t){zmAttachUtility.createAttContextMenu.call(e,t)}),i[0].setListener("click",zmAttachUtility.closePrevCard.bind(e)),l.workspace.render(),l.workspace.show.call(this),l.workspace.afterRender.call(this)},onDelete:function(){return a=null,this.configuration&&this.configuration.workspaceConfig&&"function"==typeof this.configuration.workspaceConfig.onClose&&this.configuration.workspaceConfig.onClose(),l.unsubscribeToEvents.call(this),!0}};t.listingComp={init:function(t){var e=new i(t);return l.subscribeToEvents.call(e),e}}}(),function(){var t=zmail.Core.Namespaces.create("zmAttachUtility"),e=zmText.get("attachmentUtility").SuccErrMsg;t.errorConstants={virusFound:10006,virusFailed:10005,virusError:10004,pending:10008,errContType:10015},t.errorMsgs={10001:e.Invalid_input,10002:e.Server_error,10003:e.Server_error,10004:e.Server_error,10005:e.Virus_failed,10006:e.Virus_Found,10007:e.Invalid_FName,10008:e.Virus_progress,10009:e.No_file,10010:e.Param_Mismatch,10011:e.Err_Origin,10012:e.User_Blocked,10013:e.User_Blocked,10014:e.Server_error,10015:e.Err_ContType,10017:e.url_notFound,10018:e.File_sizeEx,10019:e.File_sizeEx,10020:e.Server_error,10022:e.No_Access_File},t.statusCodes={BAD_REQUEST:400,UNAUTHORISED:401,FORBIDDEN:403,NOT_FOUND:404,PAYLOAD_LARGE:413,TOO_MANY_REQ:429,INTERNAL_SERVER_ERROR:500,SUCCESS:200},t.fileType={hugeAttachment:4,workDriveAtt:5},t.constants={HUGE_ATT_UPER_LIMIT:"",share_private:0,share_org:2,share_public:1}}();