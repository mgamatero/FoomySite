function removeSearchAutoList(doClearTimer){doClearTimer&&clearTimeout(searchMoreTimer),$("#zc_search_auto_list").remove()}function showAutoList(contacts,fetchMore){var encodeHTML=ZContacts.Utils.encodeHTML,delaySeconds=3e3,isExist=$(".SC_contApp #ztb-container #ztb-search").children("#zc_search_auto_list").length,str="";if(isExist||(str="<div class='SC_dd shw zmSearchDD js-list-container' id='zc_search_auto_list' style='top: 29px;left: 0px;'><div class='js-wrapper zmDDScroll' style='max-height: 270px;width: 404px;'><ul class='js-dropmenu'>"),contacts.length){for(var i=0;i<contacts.length;i++){var contact=contacts[i],contactId=contact.contact_id,firstName=encodeHTML(contact.first_name?contact.first_name:""),lastName=encodeHTML(contact.last_name),nickName=encodeHTML(contact.nick_name),emailId=encodeHTML(contact.primary_email_id);str+="<li class='js-dropmenuitem' contact_id='"+contactId+"' onmousedown='search(this, event)' data-menuid='"+i+"'>",str+="<div style='clear: both'><div style='text-transform: uppercase;background-color: #E5E5E5;float: left;border-radius: 100%;overflow: hidden;font-weight: 600;cursor: default;'>",str+="<img src='"+contact.photo_url+"' style='width: 40px;height: 36px;'></div>",str+="<div style='margin-left: 50px;'>";var name=firstName+(lastName?" "+lastName:"")+(nickName?" ("+nickName+")":"");str+="<div><span class='zcs_new_search_autolistingrow'>"+name+"</span></div>";var val=$(".SC_contApp #ztb-container #ztb-search-field").val();if(emailId&&emailId.toLowerCase().startsWith(val))str+="<div class='zcs_new_search_autolistingrow'>"+emailId+"</div></div></div>";else{var emails=contact.emails;if(emails)for(var j=0;j<emails.length;j++){var emailObj=emails[j];if(!emailObj.is_primary&&emailObj.email_id&&emailObj.email_id.toLowerCase().startsWith(val)){str+="<div class='zcs_new_search_autolistingrow'>"+encodeHTML(emailObj.email_id)+"</div></div></div>";break}}}str+="</li>"}isExist||(str+="</ul></div></div>"),isExist?$(".SC_contApp #ztb-container #ztb-search").children("#zc_search_auto_list").find(".js-dropmenu").append(str):$(".SC_contApp #ztb-container #ztb-search").append(str)}else delaySeconds=0;var val=$(".SC_contApp #ztb-container #ztb-search-field").val();fetchMore&&val&&(searchMoreTimer=setTimeout(function(){Contacts.getMoreAutoList(val,showAutoList)},delaySeconds))}function search(t){clearTimeout(searchMoreTimer);var contactId=$(t).attr("contact_id");Contacts.indexContact(contactId);var contact=ZContacts.Contacts.create(staticObj[contactId]);removeSearchAutoList(!0),zmsuite.showWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID),zmcontact.loadContactDetails(contact.get("contact_id"),contact.get("zid")),zmsuite.getCenter()[0].$el.find(".zmSLst").removeClass("zmSLst"),zmsuite.getCenter()[0].$el.find(".SC_conRgt").addClass("zmSLst"),setTimeout(function(){zmsuite.getCenter()[0].$el.find(".SC_conRgt").removeClass("zmSLst")},50),event.stopPropagation()}var ZContacts={_rsvbObj:{}};ZContacts.getContextPath=function(){return zmail.forContactsApp?ZContacts.meta.serviceInfo.contacts_server_url:"/zm/"+(zmail.contactsProxyPath||"zc")},ZContacts.getCurrentAccount=function(){return this.acc},ZContacts.getUserAccount=function(){return ZContacts.user},ZContacts.meta={user:{},syncUrls:{},serviceInfo:{}},ZContacts.Constants={REGEX:{EMAIL_PATTERN:/^[\w]([\w\-\.\+\'&amp;]*)@([\w\-\.]+[\w\-\.&amp;]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/i,PHONE_PATTERN:/^[\(\)\+\-0-9x\.\,\*\s#]{1,30}$/,USERNAME_PATTERN:/^[A-Z][A-z0-9_]+([.][A-z0-9_]+)*[A-Za-z0-9]$/i,BYEAR_PATTERN:/^[0-9]+$/,ZM_SRCH_TAB_PATTERN:/zm_srch[0-9]+$/},Params:{FILTER_PREFIX:"filter_",MULTIPOST_SUFFIX:"_all",DELETEALL_PREFIX:"_"},StatusCode:{OK:200,NOT_FOUND:404,CONFLICT:409},ChatStatus:{DELETED:-4,PENDING:-1,REQACC:-3,REJECTED:-2,OFFLINE:0,ONLINE:1,INVISIBLE:2,BUSY:3,IDLE:4,NO_CHAT:-10}},ZContacts.ZMailConstants={SYNC_SUMMARY:"sync_summary",VIEW_ID_ALL_CONTACTS:"all_contacts_ctgry",VIEW_ID_ORG_CONTACTS:"org_contacts_ctgr",VIEW_ID_GRP_CONTACTS:"group_",CONTACTS_APP_ID:"zm_Contacts",WORKSPACE_APP_ID:"zm_createContact",CLEAN_WORKSPACE_APP_ID:"zm_cleanDuplicates",PRINT_WORKSPACE_APP_ID:"zm_printContacts",IMPORT_APP_ID:"zm_ImportContact",SEARCH_WORKSPACE_APP_ID:"zm_srch1",NEW_SEARCH_WORKSPACE_APP_ID:"zm_srch2",NEW_GLOBAL_SEARCH_WORKSPACE_APP_ID:"zm_srch",GLOBAL_SEARCH:"zc_global_srch",PERSONAL_ACCOUNT:"personal",ORG_ACCOUNT:"org",GROUP_ACCOUNT:"groups",CONTACTS_TAB:"cn",CONTACTS_HAS_TAG:"#contacts",SELECT_LIMIT:200},ZContacts.ImportMapConstants={PHONE_Map:{Mobile:"Mobile-MOBILE","Home Phone":"Home-HOME_PHONE","Work Phone":"Work-WORK_PHONE",Fax:"Fax-FAX","Other Phone":"Others-OTHER_PHONE"},IMS_Map:{"Google IM":"Google","Yahoo IM":"Yahoo","Skype IM":"Skype","AOL IM":"Aol","ICQ IM":"Icq","Jabber IM":"Jabber","MSN IM":"Msn","Other IM":"Other"},URLS_Map:{"Blog URL":"Blog","Personal Web Address":"Home","Company Web Address":"Work","LinkedIn URL":"Linkedin","Facebook URL":"Facebook","Twitter URL":"Twitter","Amazon URL":"Amazon","Flickr URL":"Flickr","Delicious URL":"Delicious","Other URL":"Others"},SearchTypye_Map:{contains:"3","starts with":"0"}},ZContacts.ImportPage=!1,ZContacts.MappingType={Phone_Type:["Mobile","Home","Work","Fax","Others"],Ims_Type:["Google","Yahoo","Skype","Aol","Msn","Jabber","Icq","Other"],Urls_Type:["Home","Work","Blog","Linkedin","Facebook","Twitter","Amazon","Flickr","Delicious","Others"],search_type:["contains","starts with"]},ZContacts.AuditMapConstants={Contact_Map:{},Contact_Map_Names:{contact_nickname:"Nick Name",contact_firstname:"First Name",contact_middlename:"Middle Name",contact_lastname:"Last Name",emails:"Emails",contact_gender:"Gender",contact_biography:"Notes",contact_birthday:"Birth Day",contact_birthmonth:"Birth Month",contact_birthyear:"Birth Year",contact_designation:"Designation",contact_home_address:"Home Address",contact_home_address1:"Home Address1",contact_home_city:"Home City",contact_home_country:"Home Country",contact_home_postalcode:"Home Postalcode",contact_home_state:"Home State",contact_jobtitle:"Job",contact_work_address:"Work Address",contact_work_address1:"Work Address1",contact_work_city:"Work City",contact_work_company:"Company",contact_work_country:"Work Country",contact_work_postalcode:"Work Postalcode",contact_work_state:"Work State",phone_info:"Phone Number",web_url_info:"URL"}},ZContacts.Utils={camelize:function(str){return str.charAt(0).toLowerCase()+str.substring(1)},isEmptyArray:function(arr){return!arr||!arr.length},isEmailId:function(str){return str&&ZContacts.Constants.REGEX.EMAIL_PATTERN.test(str.trim())},isUserName:function(str){return str&&ZContacts.Constants.REGEX.USERNAME_PATTERN.test(str.trim())},isValidPhoneNumber:function(str){return str&&ZContacts.Constants.REGEX.PHONE_PATTERN.test(str.trim())},isValidBirthYear:function(str){return 4==str.length?str&&ZContacts.Constants.REGEX.BYEAR_PATTERN.test(str.trim()):!1},isValidSearchTab:function(str){return str&&ZContacts.Constants.REGEX.ZM_SRCH_TAB_PATTERN.test(str.trim())},encodeHTML:function(str){return str&&(str=str.replace(/"/gi,"&quot;").replace(/'/gi,"&#39;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;")),str},replaceNbsps:function(string){var str=string.replace(/\u00a0/g," ");return str.replace(/[\u200A-\u200F\uFEFF\u200E\u202F\u2000-\u2009]/g," ")}},ZContacts.StringBuilder=function(_iv){var arr=_iv?[_iv]:[];this.append=function(v){return arr.push(v),this},this.toString=function(){return arr.join("")},this.isEmpty=function(){return this.length()<1},this.length=function(){return arr.length}},ZContacts.Cookie={add:function(cn,cv,domain,maxage,secure){document.cookie=cn+"="+window.escape(cv)+";path=/"+(domain?";domain="+domain:"")+(maxage?";max-age="+maxage:"")+(secure?";secure="+secure:"")},get:function(cn){if(document.cookie.length>0){var beginIdx=document.cookie.indexOf(cn+"=");if(-1!==beginIdx){beginIdx=beginIdx+cn.length+1;var endIdx=document.cookie.indexOf(";",beginIdx);return-1===endIdx&&(endIdx=document.cookie.length),window.unescape(document.cookie.substring(beginIdx,endIdx))}}return""},append:function(cn,cv,domain,separator,maxage,secure){var oldcv=ZContacts.Cookie.get(cn),newcv="";newcv=oldcv?oldcv+separator+cv:cv,ZContacts.Cookie.add(cn,newcv,domain,maxage,secure)},remove:function(cn){document.cookie=cn+"=remove;path=/;max-age=0"},getCSRFValue:function(){return ZContacts.Cookie.get(ZContacts.meta.serviceInfo.csrf_cookie_name)}},ZContacts.I18N={data:{},load:function(arr){return $.extend(ZContacts.I18N.data,arr),this},get:function(key){return ZContacts.I18N.data[key]||key}},ZContacts.URI=function(){this.contextpath=ZContacts.getContextPath()+"/api/v1",this.apiResponse=null,this.resourceIdentifier=null,this.authUser=null,this.authPassword=null;var args=arguments;$.isArray(arguments[0])&&(args=arguments[0]),this.init.apply(this,args)},$.extend(ZContacts.URI.prototype,{init:function(type){var identifier,isFullURI="string"==typeof type;if(this.type=isFullURI?arguments[1]:type,!this.type||!this.type.superclass.__zresource)throw new Error(""+this.type+' is not a type of "ZResource"');if(isFullURI){var path=ZContacts.URI.trimSlash(type);this.requestURI=this.contextpath+"/"+path;var uriArr=path.split("/");uriArr.length%2===0&&(identifier=uriArr[uriArr.length-1])}else{var rmd=this.getRMD(),uriSB=new ZContacts.StringBuilder;if(rmd.parents){for(var parentIdIdx=1,i=0;i<rmd.parents.length;i++){var parent=rmd.parents[i],parentRMD=this.getRMD(parent),parentPath=parentRMD.path;parentPath||(parentPath=parentRMD.resourceName.toLowerCase());var parentIdentifier=arguments[parentIdIdx++];if(uriSB.append("/").append(parentPath),parentIdentifier)uriSB.append("/").append(parentIdentifier);else if(parentRMD.identifier)throw new Error("Unable to construct URI. Parent Identifier for the resource "+parentRMD.resourceName+" is missing for "+rmd.resourceName)}identifier=arguments[parentIdIdx]}else identifier=arguments[1];uriSB.append("/").append(rmd.path?rmd.path:rmd.resourceName.toLowerCase()),identifier&&uriSB.append("/").append(identifier),this.requestURI=this.contextpath+uriSB.toString()}return this.isInstance=!!identifier,this.resourceIdentifier=identifier,this},include:function(value){return this.includes=this.includes||[],this.includes.push(value),this},header:function(name,value){if(this.headers=this.headers||{},$.isPlainObject(name))for(var key in name)this.headers[key]=name[key];else if(name){if(null===value)return this.headers[name];this.headers[name]=value}return this},prependContacts:function(count){return this.prepend_contacts=count,this},setSortBy:function(sortBy,asc){return asc=asc?"":"-",this.sort=asc+sortBy,this},addFilter:function(name,value){return this.filters=this.filters||{},this.filters[name]=value,this},addSearchQuery:function(query){return this.query=query,this},addSearchComparator:function(comparator){return this.search_comparator=comparator,this},addSearchFields:function(value){return this.searchFields=this.searchFields||[],this.searchFields=this.concat(value.split(",")),this},addFields:function(value){return this.fields=this.fields||[],this.fields=this.fields.concat(value.split(",")),this},setPagination:function(page,perPage){return this.pagination=this.pagination||{},this.pagination.page=page,this.pagination.per_page=perPage,this},setRange:function(start,limit){return this.range=this.range||{},this.range.start=start,this.range.limit=limit,this},addDeleteParam:function(key,value){return this.deleteParams=this.deleteParams||{},this.deleteParams[ZContacts.Constants.Params.DELETEALL_PREFIX+key]=value,this},addPostParam:function(key,value){return this.postParams=this.postParams||{},this.postParams[key]=value,this},getParams:function(){return $.param(this.getParamsObj())},getParamsObj:function(){var params={};if(this.includes&&(params.include=this.includes.join()),this.filters)for(var key in this.filters)params[ZContacts.Constants.Params.FILTER_PREFIX+key]=this.filters[key];return this.query&&(params.q=this.query,this.search_comparator&&(params.search_comparator=this.search_comparator),this.searchFields&&(params.search_fields=this.searchFields.join())),this.sort&&(params.sort=this.sort),this.fields&&(params.fields=this.fields.join()),this.pagination&&(params.page=this.pagination.page,params.per_page=this.pagination.per_page),this.range&&(params.start=this.range.start,params.limit=this.range.limit),this.prepend_contacts>0&&(params.prepend_contacts=this.prepend_contacts),params},getRMD:function(type){return type||(type=this.type),type.getResourceMetaData?type.getResourceMetaData(type):type.getRMD()},setAuthHeader:function(zuid,password){if(zuid+="",-1!==zuid.indexOf(":"))throw new Error("Invalid character present in ZUID "+zuid);return this.authUser=zuid||"",this.authPassword=password,this}}),$.extend(ZContacts.URI.prototype,{GETS:function(){if(this.isInstance)throw new Error("GETS operation is not supported in Multi URI for "+this.type);return this._sendRequest("GETS")},GET:function(){var rmd=this.getRMD();if(rmd.identifier&&!this.isInstance)throw new Error("GET operation is not supported in Multi URI for "+this.type);return this._sendRequest("GET")},POST:function(resource){return resource.length?this._saveAll(resource,!0):this._save(resource,!0)},PUT:function(resource){return resource&&resource.length?this._saveAll(resource,!1):this._save(resource,!1)},DELETE:function(resource){if($.isArray(resource))return this.DELETEALL(resource);if(resource&&!(resource instanceof this.type))throw new Error(""+resource+" is not an instance of "+this.type);return this._sendRequest("DELETE")},DELETEALL:function(resources){if(!resources.length&&!$.isArray(resources))throw new Error("Invalid argument passed "+resources+'. Expecting Array of "ZResource"');var rmd=this.getRMD();if(rmd.identifier&&this.isInstance)throw new Error("DELETEALL operation is supported only in Multi URI for "+this.type);for(var identifiers=new ZContacts.StringBuilder,i=0,len=resources.length;len>i;i++){var resource=resources[i];if(!(resource instanceof this.type))throw new Error(""+resource+" is not an instance of "+this.type);var identifier=resource.getIdentifier();if(!identifier)throw new Error("Identifier is must to DELETE Mutliple "+rmd.resourceName);0!==i&&identifiers.append(","),identifiers.append(identifier)}return this.addDeleteParam(rmd.identifier,identifiers.toString()),this._sendRequest("DELETE")}}),$.extend(ZContacts.URI.prototype,{_sendRequest:function(type,options){var _this=this,promise=$.Deferred();options=options||{},options.url=_this.requestURI;var rmd=_this.getRMD();options.exports=rmd.exports;var isWrite=!1;if(options.type||(options.type="GETS"===type?"GET":type),$.isEmptyObject(_this.params)||(options.data=$.param(_this.params)),options.headers=options.headers||{},_this.headers&&$.extend(options.headers,_this.headers),options.type||(options.type="GETS"===type?"GET":type),options.type&&"GET"!==options.type?(options.headers["X-HTTP-Method-Override"]=options.type,options.Accept="application/json","DELETE"===options.type&&_this.deleteParams&&(options.url+="?"+$.param(_this.deleteParams),options.data=null),_this.postParams&&(options.url+="?"+$.param(_this.postParams)),options.type="POST",isWrite=!0):options.data=_this.getParams(),options.headers["X-ZCSRF-TOKEN"]=ZContacts.meta.serviceInfo.csrf_param_name+"="+ZContacts.Cookie.getCSRFValue(),_this.authUser&&(options.headers["X-Authorization"]=new ZContacts.StringBuilder("ZohoContacts-password ").append(_this.authPassword)),"object"!==$.type(options.data)&&"array"!==$.type(options.data)||options._multiPartAttrs&&(!options._multiPartAttrs||options.formObj)||options.exports){if(options._multiPartAttrs||options.exports){var formData,multipartAttrs=options._multiPartAttrs,fileCount=0,resourceName=rmd.resourceName.toLowerCase(),dataJson=options.data[resourceName];if(window.FormData&&!options.exports)if(formData=new window.FormData,"photo"==resourceName)formData.append("photo",$(dataJson.photo).prop("files")[0]),fileCount++;else for(var elem in dataJson)-1!==multipartAttrs.indexOf(elem)&&$(dataJson[elem]).prop("files").length&&(dataJson[elem]=$(dataJson[elem]).prop("files")[0],fileCount++),formData.append(resourceName+"["+elem+"]",dataJson[elem]);else{var $iframeElem=$("<iframe src='javascript:;' width='0' name='fileUploadIframe' id='"+resourceName+"fileUploadIframe' border='0' style='display:none;'></iframe>"),$formElem=$("<form method="+options.type+" target='"+$iframeElem[0].name+"' action='"+options.url+"' encoding='multipart/form-data' enctype='multipart/form-data' style='display:none;'></form>"),isGetRequest="get"===options.type.toLowerCase();if(isGetRequest&&(dataJson=_this.getParamsObj()),$formElem.append($("<input value='"+ZContacts.Cookie.getCSRFValue()+"' name='"+ZContacts.meta.serviceInfo.csrf_param_name+"'/>")),options.headers["X-Authorization"]){var password=options.headers["X-Authorization"].toString();password=password.replace("ZohoContacts-password ",""),$formElem.append($("<input type='hidden' value='"+password+"' name='password'/>"))}for(var attrName in dataJson){var nodeName=isGetRequest?attrName:resourceName+"["+attrName+"]",elemNode=$("<input name='"+nodeName+"'/>");elemNode.val(dataJson[attrName]),multipartAttrs&&-1!==multipartAttrs.indexOf(attrName)&&dataJson[attrName].value&&($(dataJson[attrName].parentElement).append(dataJson[attrName].cloneNode()),elemNode=dataJson[attrName],elemNode.name=nodeName,fileCount++),$formElem.append(elemNode)}$("body").append($iframeElem).append($formElem),window.handleIFrameResponse=_this.handleIFrameResponse,ZContacts._rsvbObj[resourceName]={resolve:promise.resolve,reject:promise.reject,iframeElem:$iframeElem,formElem:$formElem}}if(0===fileCount&&multipartAttrs)for(var i=0;i<multipartAttrs.length;i++)delete options.data[resourceName][multipartAttrs[i]];if(!window.FormData||options.exports)return void ZContacts._rsvbObj[resourceName].formElem.submit();options.data=formData,options.processData=!1,options.contentType=!1}}else options.contentType="application/json",options.data=JSON.stringify(options.data);return options.success=function(json){_this.apiResponse=json;var isError=!$.isEmptyObject(json.error)||json.status_code<200||json.status_code>=300,representation=json[rmd.resourceName.toLowerCase()];if(404!==json.status_code||isWrite||(isError=!1),isError)return void promise.reject(json);if("GETS"===type){var array=[];if(representation)for(var i=0,len=representation.length;len>i;i++)array.push(_this.type.create().deserialize(representation[i]));array._apiResponse=_this.apiResponse,promise.resolve(array)}else if("GET"===type){var o=_this.type.create();_this.resourceIdentifier&&o.set(rmd.identifier,_this.resourceIdentifier),representation?(o.deserialize(representation),promise.resolve(o)):promise.resolve(json)}else promise.resolve(json)},options.error=function(jqXHR){var json;try{json=$.parseJSON(jqXHR.responseText)}catch(e){json={status_code:jqXHR.status}}promise.reject(json)},$.ajax(options),promise},handleIFrameResponse:function(responseData){var json=responseData,resourceName=json.resource_name.toLowerCase();if(resourceName){var isError=!$.isEmptyObject(json.error)||json.status_code<200||json.status_code>=300,rsvpObj=ZContacts._rsvbObj[resourceName];$(rsvpObj.iframeElem).remove(),$(rsvpObj.formElem).remove(),isError?rsvpObj.reject(json):rsvpObj.resolve(json),delete ZContacts._rsvbObj[resourceName]}},_save:function(resource,isPost){if(isPost&&!resource||resource&&!(resource instanceof this.type))throw new Error(""+resource+" is not an instance of "+this.type);var rmd=this.getRMD(),errorObj=null;if(resource&&(resource.build(),errorObj=resource._validate(isPost)),errorObj){var promise=$.Deferred();return promise.reject({errors:errorObj}),promise}var serializedData=resource?resource.serialize():null,ajaxOptions={data:serializedData,_multiPartAttrs:rmd.multipartAttrs};return resource&&resource.get("__form")&&(ajaxOptions.formObj=resource.get("__form")),this._sendRequest(isPost?"POST":"PUT",ajaxOptions)},_saveAll:function(resources,isPost){for(var ajaxOptions={data:{}},dataArr=[],resourceName=this.getRMD().resourceName.toLowerCase(),i=0;i<resources.length;i++)dataArr.push(resources[i].serialize()[resourceName]);return ajaxOptions.data[resourceName+ZContacts.Constants.Params.MULTIPOST_SUFFIX]=dataArr,this._sendRequest(isPost?"POST":"PUT",ajaxOptions)}}),ZContacts.URI.Headers={POST_AND_GET:"X-Post-And-Get"},ZContacts.URI.trimSlash=function(path){return path&&("/"===path.charAt(0)&&(path=path.substring(1)),path.endsWith("/")&&(path=path.substring(0,path.length-1))),path},ZContacts.ZResource=function(){},$.extend(ZContacts.ZResource.prototype,{resourceName:null,parent:null,identifier:null,attrs:null,subResources:null,set:function(k,v){return this[k]=v,this},get:function(k){return this[k]},addSubResource:function(resource){if(!(resource instanceof ZContacts.ZResource))throw"'"+resource+"' must be a sub class of 'ZResource'";var rmd=resource.getRMD(),name=ZContacts.Utils.camelize(rmd.resourceName);if(!this.getSubResourceType(name))throw"'"+name+"' resource is not a sub resource of '"+this.getRMD().resource+"'";var arr=this.get(name);return rmd.identifier?arr?arr.push(resource):(arr=[],this.set(name,arr),arr.push(resource)):this.set(name,resource),this},getSubResourceType:function(varName){var resourceMetaData=this.getRMD();return resourceMetaData._subResourceObjMap&&resourceMetaData._subResourceObjMap[varName]},_validate:function(isPost){var j,validateMethod=isPost?"validate":"validatePartial",errors=[],validatedOutput=this[validateMethod]&&this[validateMethod]();errors=this.addErrors(errors,validatedOutput);var subResourcesList=this.getRMD()._subResourcesList;if(!ZContacts.Utils.isEmptyArray(subResourcesList)){errors=errors?errors:[];for(var i=0,len=subResourcesList.length;len>i;i++){var arr=this.get(subResourcesList[i]);if(arr)if(arr.length)for(j=0;j<arr.length;j++)validatedOutput=arr[j].validate&&arr[j].validate(),errors=this.addErrors(errors,validatedOutput);else validatedOutput=arr.validate&&arr.validate(),errors=this.addErrors(errors,validatedOutput)}}return errors.length?errors:null},addErrors:function(errors,errorObj){return errorObj?($.isArray(errorObj)||$.isEmptyObject(errorObj)?errors=errorObj.length?errors.concat(errorObj):errorObj:errors.push(errorObj),errors):errors},getParentIdentifier:function(){var rmd=ZResource.getResourceMetaData(this.getRMD().parent);return rmd&&this.get("parent."+rmd.identifier)},clearSubResources:function(){var subResourcesList=this.getRMD()._subResourcesList;if(subResourcesList)for(var i=0,len=subResourcesList.length;len>i;i++)this.set(subResourcesList[i],null)},serialize:function(){for(var jsonObj={},json={},rmd=this.getRMD(),attrs=rmd.attrs||[],i=0,len=attrs.length;len>i;i++){var key=attrs[i],value=this.get(key);null!==value&&void 0!==value&&(json[key]=this.serializeAttr(key,value))}return jsonObj[rmd.resourceName.toLowerCase()]=json,jsonObj},setMultipartAttrs:function(){var formObj=this.get("__form");if(formObj&&$(formObj).is("form")){var keyIndex,rmd=this.getRMD(),multipartKeys=rmd.multipartAttrs,$formObj=$(formObj);if(multipartKeys)for(keyIndex=0;keyIndex<multipartKeys.length;keyIndex++){var multiPartKey=multipartKeys[keyIndex],$file=$formObj.find("input[name='"+multiPartKey+"']");this.set(multiPartKey,$file.get(0))}}},build:function(){this.setMultipartAttrs();var subResourcesList=this.getRMD()._subResourcesList;if(!ZContacts.Utils.isEmptyArray(subResourcesList))for(var i=0;i<subResourcesList.length;i++){var subResource=this.get(subResourcesList[i]);if(subResource)if($.isArray(subResource))for(var j=0;j<subResource.length;j++)subResource[j].build();else subResource.build()}},serializeAttr:function(key,value){var serializedData,subResourceType=this.getSubResourceType(key);if(subResourceType&&value){var arr=[];if($.isArray(value)){for(var j=0;j<value.length;j++)serializedData=value[j]?value[j].serialize()[key]:null,arr.push(serializedData);return arr}return value.serialize()[key]}return value},deserialize:function(json){for(var key in json)json.hasOwnProperty(key)&&this.deserializeAttr(key,json[key]);return this},deserializeAttr:function(key,value){var subResourceType=this.getSubResourceType(key);if(subResourceType)if($.isArray(value))for(var i=0,len=value.length;len>i;i++)this.addSubResource(subResourceType.create().deserialize(value[i]));else this.addSubResource(subResourceType.create().deserialize(value));else this.set(key,value);return this},merge:function(zresource){for(var key in zresource)zresource.hasOwnProperty(key)&&this.set(key,zresource[key]);return this},getIdentifier:function(){return this.get(this.getRMD().identifier)},getURI:function(isInstance){var type=this.constructor,identifiers=Array.prototype.slice.apply(arguments).slice(1);if(1===arguments.length)for(var rmd=this.getRMD();rmd.parent;){rmd=ZResource.getResourceMetaData(rmd.parent);var value=this.get("parent."+rmd.identifier);if(!value)throw new Error("Parent Identifier ("+rmd.resourceName+"."+rmd.identifier+") is missing in the ZResource.");identifiers.splice(0,0,value)}return isInstance&&identifiers.push(this.getIdentifier()),new ZContacts.URI([type].concat(identifiers))},POST:function(){var args=Array.prototype.slice.apply(arguments);return args.splice(0,0,!1),this.getURI.apply(this,args).POST(this)},PUT:function(){var args=Array.prototype.slice.apply(arguments);return args.splice(0,0,!0),this.getURI.apply(this,args).PUT(this)},DELETE:function(paramsObj){var uri=this.getURI(!0);if($.isPlainObject(paramsObj))for(var param in paramsObj)uri.addDeleteParams(param,paramsObj[param]);return uri.DELETE(this)},getRMD:function(){return ZContacts.RMD.getMetaData(this)}}),$.extend(ZContacts.ZResource,{extendClass:function(resourceProps){var superclass=ZContacts.ZResource,subclass=function(){};subclass.prototype=new ZContacts.ZResource,subclass.prototype.constructor=subclass;for(var name in superclass)superclass.hasOwnProperty(name)&&!subclass[name]&&(subclass[name]=superclass[name]);return subclass.superclass=superclass,subclass.superproto=superclass.prototype,subclass.resourceProps=resourceProps,$.extend(subclass.prototype,resourceProps),subclass},create:function(prop){var fn=this,ins=new fn;return prop&&ins.deserialize(prop),ins},__zresource:!0,getResourceMetaData:function(type){return ZContacts.RMD.getMetaData(type)},GET:function(parentIdentifier,identifier,params){return!params&&$.isPlainObject(identifier)&&(params=identifier,identifier=void 0),new ZContacts.URI(this,parentIdentifier,identifier).GET()},GETS:function(parentIdentifier,params){return!params&&$.isPlainObject(parentIdentifier)&&(params=parentIdentifier,parentIdentifier=void 0),new ZContacts.URI(this,parentIdentifier).GETS()}}),ZContacts.RMD={RESOURCE_META_DATA:{},getMetaData:function(type){type.create||(type=type.constructor);var metadata=this.RESOURCE_META_DATA[type.__zresource_name__];if(!metadata){if(metadata=this.getFilteredMetaData(type.resourceProps),metadata.parent){for(var parents=[],parent=metadata.parent;parent;)parents.splice(0,0,parent),parent=this.getMetaData(parent).parent;metadata.parents=parents}if(type.__zresource_name__=!metadata.parents||metadata.parents.length<1?metadata.resourceName:metadata.parents[0].__zresource_name__+metadata.resourceName,this.RESOURCE_META_DATA[type.__zresource_name__]=metadata,metadata.fixed_data){for(var fixedData=metadata.fixed_data,modifiedData=[],i=0;i<fixedData.length;i++){var d=fixedData[i];modifiedData.push(type.create(d))}metadata.fixed_data=modifiedData}this.setSubResources(type)}return metadata},setSubResources:function(type){var metaData=this.RESOURCE_META_DATA[type.__zresource_name__],subResources=metaData.subResources;if(!ZContacts.Utils.isEmptyArray(subResources)){metaData._subResourceObjMap={};for(var i=0,len=subResources.length;len>i;i++){var subResource=subResources[i],resourceName=this.getMetaData(subResource).resourceName,varName=ZContacts.Utils.camelize(resourceName);metaData.attrs.push(varName),metaData._subResourceObjMap[varName]=subResource}metaData._subResourcesList=Object.keys(metaData._subResourceObjMap)}for(var properties={},requiredMetaAttrs=this.requiredMetaAttrs,index=0;index<requiredMetaAttrs.length;index++)properties[requiredMetaAttrs[index]]=null;$.extend(type.prototype,properties)},requiredMetaAttrs:["resourceName","attrs","parent","identifier","multipartAttrs","subResources","exports","path","fixed_data"],getFilteredMetaData:function(metaData){for(var metaJson={},requiredMetaAttrs=this.requiredMetaAttrs,i=0;i<requiredMetaAttrs.length;i++){var attr=requiredMetaAttrs[i];metaData[attr]&&(metaJson[attr]=metaData[attr])}return metaJson}},function(){var ZResource=ZContacts.ZResource;ZContacts.Accounts=ZResource.extendClass({resourceName:"Accounts",getAccountId:function(){return this.account_id},getType:function(){return this.type},isWritable:this.isWritable,getCount:function(){return this.count},getName:function(){return this.name},getCategories:function(){return this.categories},getLimit:function(){return this.limit},getRootFolderId:function(){return"personal"==this.type?ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS:"org"==this.type?ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS:"groups"==this.type?ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS+this.account_id:void 0}}),ZContacts.Contacts=ZResource.extendClass({resourceName:"Contacts",identifier:"contact_id",parent:ZContacts.Accounts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes","categories","is_writable","is_org","zid","photo_url"],getFullName:function(){return(this.first_name||"")+" "+(this.middle_name||"")+" "+(this.last_name||"")},getPrimaryEmail:function(){var emails=this.get("emails");if(emails)for(var i=0;i<emails.length;i++){var email=emails[i];if(email.get("is_primary"))return email.get("email_id")}return""}}),ZContacts.ContactsAutoList=ZResource.extendClass({resourceName:"contacts/autolist",identifier:"contact_id",parent:ZContacts.Accounts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes"]}),ZContacts.ContactsDuplicates=ZResource.extendClass({resourceName:"contacts/duplicates",identifier:"contact_id",parent:ZContacts.Accounts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes"]}),ZContacts.ContactsMerge=ZResource.extendClass({resourceName:"merge",identifier:"contact_id",parent:ZContacts.Contacts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes"]}),ZContacts.Categories=ZResource.extendClass({resourceName:"Categories",identifier:"category_id",parent:ZContacts.Accounts,attrs:["category_name"]}),ZContacts.ContactsCategories=ZResource.extendClass({resourceName:"categories",parent:ZContacts.Contacts,attrs:["category_name"]}),ZContacts.ContactsPhotos=ZResource.extendClass({resourceName:"photo_url",parent:ZContacts.Contacts,attrs:["photo_url"]}),ZContacts.ExportContacts=ZResource.extendClass({resourceName:"contacts/export",parent:ZContacts.Accounts,exports:!0}),ZContacts.InviteChat=ZResource.extendClass({resourceName:"invite",parent:ZContacts.Contacts}),ZContacts.Emails=ZResource.extendClass({resourceName:"Emails",identifier:"email_id",parent:ZContacts.Contacts,attrs:["email_id","is_primary"]}),ZContacts.PhoneNumbers=ZResource.extendClass({resourceName:"Phones",identifier:"number",parent:ZContacts.Contacts,attrs:["number","type"]}),ZContacts.Ims=ZResource.extendClass({resourceName:"ims",identifier:"type",parent:ZContacts.Contacts,attrs:["address","type"]}),ZContacts.Urls=ZResource.extendClass({resourceName:"Urls",identifier:"url",parent:ZContacts.Contacts,attrs:["url","type"]}),ZContacts.Address=ZResource.extendClass({resourceName:"address",identifier:"type",parent:ZContacts.Contacts,attrs:["street_addr","street_addr1","city","state","country","postal_code","type"],isEmpty:function(){return!(this.get("street_addr")||this.get("street_addr1")||this.get("city")||this.get("state")||this.get("country")||this.get("postal_code"))}}),ZContacts.Photo=ZResource.extendClass({resourceName:"photo",identifier:"photo",parent:ZContacts.Contacts,attrs:["photo"],multipartAttrs:["photo"]}),ZContacts.ImportUpload=ZResource.extendClass({resourceName:"import_upload",parent:ZContacts.Accounts,attrs:["importcontact"],multipartAttrs:["importcontact"],path:"contacts/import/upload"}),ZContacts.ImportValidate=ZResource.extendClass({resourceName:"import_validate",identifier:"mapping",parent:ZContacts.Accounts,attrs:["file_key"],path:"contacts/import/validate"}),ZContacts.MappingFields=ZResource.extendClass({resourceName:"mapping",parent:ZContacts.ImportMapping,attrs:["first_name","middle_name","last_name","nick_name","categories","emails","gender","birth_date","birth_month","birth_year","notes","company","job_title","designation","h_street_addr","h_street_addr1","h_city","h_state","h_country","h_postal_code","w_street_addr","w_street_addr1","w_city","w_state","w_country","w_postal_code"]}),ZContacts.Import=ZResource.extendClass({resourceName:"import",parent:ZContacts.Accounts,attrs:["file_key","overwrite_duplicate","category_id","file_format","total_count","valid_count"],path:"contacts/import"}),ZContacts.ImportGoogle=ZResource.extendClass({resourceName:"google",identifier:"google_url",parent:ZContacts.Accounts,attrs:["zid","category_id"],path:"contacts/import/google"}),ZContacts.ImportGoogleSync=ZResource.extendClass({resourceName:"sync",parent:ZContacts.Accounts,attrs:["zid","category_id"],path:"contacts/import/google/sync"}),ZContacts.RevokeSync=ZResource.extendClass({resourceName:"revoke",parent:ZContacts.Accounts,path:"contacts/import/google/sync/revoke"}),ZContacts.DisableSync=ZResource.extendClass({resourceName:"disable",parent:ZContacts.Accounts,path:"contacts/import/google/sync/disable"}),ZContacts.EnableSync=ZResource.extendClass({resourceName:"enable",parent:ZContacts.Accounts,path:"contacts/import/google/sync/enable"}),ZContacts.SyncDetails=ZResource.extendClass({resourceName:"details",parent:ZContacts.Accounts,path:"contacts/import/google/sync/details"}),ZContacts.ImportYahoo=ZResource.extendClass({resourceName:"yahoo",identifier:"yahoo_url",parent:ZContacts.Accounts,attrs:["zid","category_id"],path:"contacts/import/yahoo"}),ZContacts.ImportOutlook=ZResource.extendClass({resourceName:"outlook",identifier:"outlook_url",parent:ZContacts.Accounts,attrs:["zid","category_id"],path:"contacts/import/outlook"}),ZContacts.CopyFrom=ZResource.extendClass({resourceName:"from",parent:ZContacts.Copy,attrs:["zid","contact_ids"]}),ZContacts.CopyFromMultiple=ZResource.extendClass({resourceName:"from_multiple",parent:ZContacts.Copy,identifier:"zid",attrs:["zid","contact_ids"]}),ZContacts.CopyTo=ZResource.extendClass({resourceName:"to",parent:ZContacts.Copy,attrs:["zid","category_id"]}),ZContacts.Copy=ZResource.extendClass({resourceName:"copy",parent:ZContacts.Accounts,attrs:["from","to"]}),ZContacts.ContactsAudit=ZResource.extendClass({resourceName:"audits",parent:ZContacts.Contacts,attrs:["zid","category_id"]}),ZContacts.AccountAudit=ZResource.extendClass({resourceName:"account/audits",parent:ZContacts.Accounts}),ZContacts.TrashClearContacts=ZResource.extendClass({resourceName:"contacts/trash/clear",parent:ZContacts.Accounts}),ZContacts.TrashRestoreContacts=ZResource.extendClass({resourceName:"contacts/trash/restore",parent:ZContacts.Accounts}),ZContacts.AllContacts=ZResource.extendClass({resourceName:"contacts/all",identifier:"contact_id",parent:ZContacts.Accounts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes"],getFullName:function(){return(this.first_name||"")+" "+(this.middle_name||"")+" "+(this.last_name||"")},getPrimaryEmail:function(){var emails=this.get("emails");if(emails)for(var i=0;i<emails.length;i++){var email=emails[i];if(email.get("is_primary"))return email.get("email_id")}return""}}),$.extend(ZContacts.Copy.resourceProps,{subResources:[ZContacts.CopyFrom,ZContacts.CopyFromMultiple,ZContacts.CopyTo]}),$.extend(ZContacts.Contacts.resourceProps,{subResources:[ZContacts.Emails,ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]}),$.extend(ZContacts.MappingFields.resourceProps,{subResources:[ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]}),$.extend(ZContacts.ContactsDuplicates.resourceProps,{subResources:[ZContacts.Emails,ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]}),$.extend(ZContacts.ContactsMerge.resourceProps,{subResources:[ZContacts.Emails,ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]}),$.extend(ZContacts.ImportValidate.resourceProps,{subResources:[ZContacts.MappingFields]}),$.extend(ZContacts.AllContacts.resourceProps,{subResources:[ZContacts.Emails,ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]})}();var AutoListContacts={_rsvbObj:{}},autoList=[],staticObj={},emailVsCid={},page=0,per_page=50,leastUsageCount=1,maxIndexValue=0,fetchedAllOrg=!1,fetchedAllPersonal=!1,fetchMorePersonal=!0,fetchMoreOrg=!0,qryFetchedAll={},prevQry,order=1,orderVsCid={},timeTaken=[];AutoListContacts.getCurrentAccount=function(){return this.acc},AutoListContacts.setCurrentAccount=function(acc){this.acc=acc};var Contacts=function(){var getContactsForStatic=function(){new ZContacts.URI(ZContacts.ContactsAutoList,AutoListContacts.getCurrentAccount().getAccountId()).setPagination(1,500).include("personal").include("org").include("emails").include("usage_count").GETS().then(function(resp){staticObj={},autoList=[],emailVsCid={},qryFetchedAll={},leastUsageCount=1,maxIndexValue=0,fetchedAllOrg=!1,fetchedAllPersonal=!1,fetchMorePersonal=!0,fetchMoreOrg=!0,prevQry=void 0,contacts=resp._apiResponse.contacts,fetchedAllOrg=!resp._apiResponse.has_more_org,fetchedAllPersonal=!resp._apiResponse.has_more_personal;var usageCount;if(contacts){usageCount=contacts.length;for(var i=0;i<contacts.length;i++)contacts[i].primary_email_id?emailVsCid[contacts[i].primary_email_id]||(emailVsCid[contacts[i].primary_email_id]=contacts[i].contact_id,staticObj[contacts[i].contact_id]=ZContacts.Contacts.create(contacts[i]),staticObj[contacts[i].contact_id].usage_count=usageCount,staticObj[contacts[i].contact_id].order=order,orderVsCid[order]=contacts[i].contact_id,usageCount--,order++):(staticObj[contacts[i].contact_id]=ZContacts.Contacts.create(contacts[i]),staticObj[contacts[i].contact_id].usage_count=usageCount,staticObj[contacts[i].contact_id].order=order,orderVsCid[order]=contacts[i].contact_id,usageCount--,order++)}})},setContactsInSpeceficArr=function(qry,contact,firstNameArr,emailArr,nickNameArr,lastNameArr){if(qry=qry.toLowerCase(),contact.first_name&&contact.first_name.toLowerCase().startsWith(qry))return void firstNameArr.push(contact);if(contact.primary_email_id&&contact.primary_email_id.toLowerCase().startsWith(qry))return void emailArr.push(contact);if(contact.nick_name&&contact.nick_name.toLowerCase().startsWith(qry))return void nickNameArr.push(contact);if(contact.last_name&&contact.last_name.toLowerCase().startsWith(qry))return void lastNameArr.push(contact);var emails=contact.emails;if(emails)for(var i=0;i<emails.length;i++){var emailObj=emails[i];if(!emailObj.is_primary&&emailObj.email_id&&emailObj.email_id.toLowerCase().startsWith(qry)){emailArr.push(contact);break}}else;},initObj={getInitialAutoList:function(qry,callBack){if(autoList=[],qry){qry=qry.toLowerCase(),page=0,fetchMorePersonal=!0,fetchMoreOrg=!0,autoList=[];var firstName=[],nickName=[],email=[],lastName=[],combineList=[];for(var key in orderVsCid){var cid=orderVsCid[key];if(cid){var contact=staticObj[cid];contact&&setContactsInSpeceficArr(qry,contact,firstName,email,nickName,lastName)}}firstName.length&&(combineList=combineList.concat(firstName)),email.length&&(combineList=combineList.concat(email)),nickName.length&&(combineList=combineList.concat(nickName)),lastName.length&&(combineList=combineList.concat(lastName)),combineList.length&&(autoList=combineList);for(var key in qryFetchedAll)if(qry.startsWith(key))return prevQry=qry,void callBack(autoList,!1);if(0!=autoList.length){prevQry=qry;var fetchMore=!0;return fetchedAllOrg&&fetchedAllPersonal&&(fetchMore=!1),void callBack(autoList,!0)}callBack([],!0)}else{page=0,prevQry=void 0;var count=0;for(var key in staticObj){if(20==count)break;autoList.push(staticObj[key]),count++}callBack(autoList),fetchMorePersonal=!0,fetchMoreOrg=!0}},getMoreAutoList:function(qry,callBack){for(qry.slice(0,2);Object.keys(staticObj).length>=1500;)removeLeastUsageCountContact(leastUsageCount),leastUsageCount+=1;var URI;if(fetchedAllPersonal||(qry!=prevQry?(URI=new ZContacts.URI(ZContacts.ContactsAutoList,AutoListContacts.getCurrentAccount().getAccountId()).include("emails"),URI=URI.include("personal"),fetchMorePersonal=!0):fetchMorePersonal&&(URI=new ZContacts.URI(ZContacts.ContactsAutoList,AutoListContacts.getCurrentAccount().getAccountId()).include("emails"),URI=URI.include("personal"))),fetchedAllOrg||(qry!=prevQry?(URI||(URI=new ZContacts.URI(ZContacts.ContactsAutoList,AutoListContacts.getCurrentAccount().getAccountId()).include("emails")),URI=URI.include("org"),fetchMoreOrg=!0):fetchMoreOrg&&(URI||(URI=new ZContacts.URI(ZContacts.ContactsAutoList,AutoListContacts.getCurrentAccount().getAccountId()).include("emails")),URI=URI.include("org"))),autoList=[],!URI)return void callBack(autoList);page+=1;var time=(new Date).getTime();URI.addSearchQuery(qry).setPagination(page,per_page).GETS().then(function(resp){var contacts=resp._apiResponse.contacts,length=contacts?contacts.length:0;time=(new Date).getTime()-time,timeTaken.length>200&&(timeTaken=timeTaken.slice(1,timeTaken.length)),timeTaken.push("time taken "+time+" ms for "+length+" contacts, qry : "+qry),prevQry=qry,fetchMorePersonal=resp._apiResponse.has_more_personal,fetchMoreOrg=resp._apiResponse.has_more_org;var firstName=[],nickName=[],email=[],lastName=[],combineList=[];if(contacts)for(var i=0;i<contacts.length;i++)if(contacts[i].primary_email_id){var contact,cid=emailVsCid[contacts[i].primary_email_id];if(!cid)if(emailVsCid[contacts[i].primary_email_id]=contacts[i].contact_id,staticObj[contacts[i].contact_id]){var contact=staticObj[contacts[i].contact_id];staticObj[contacts[i].contact_id]=ZContacts.Contacts.create(contacts[i]),staticObj[contacts[i].contact_id].order=contact.order,staticObj[contacts[i].contact_id].usage_count=contact.usage_count,staticObj[contacts[i].contact_id].photo_url=contact.photo_url}else staticObj[contacts[i].contact_id]=ZContacts.Contacts.create(contacts[i]),staticObj[contacts[i].contact_id].order=order,staticObj[contacts[i].contact_id].usage_count=0,orderVsCid[order]=contacts[i].contact_id,order++,contact=staticObj[contacts[i].contact_id],setContactsInSpeceficArr(qry,contact,firstName,email,nickName,lastName)}else if(staticObj[contacts[i].contact_id]){var contact=staticObj[contacts[i].contact_id];staticObj[contacts[i].contact_id]=ZContacts.Contacts.create(contacts[i]),staticObj[contacts[i].contact_id].order=contact.order,staticObj[contacts[i].contact_id].usage_count=contact.usage_count,staticObj[contacts[i].contact_id].photo_url=contact.photo_url}else staticObj[contacts[i].contact_id]=ZContacts.Contacts.create(contacts[i]),staticObj[contacts[i].contact_id].order=order,staticObj[contacts[i].contact_id].usage_count=0,orderVsCid[order]=contacts[i].contact_id,order++,contact=staticObj[contacts[i].contact_id],setContactsInSpeceficArr(qry,contact,firstName,email,nickName,lastName);firstName.length&&(combineList=combineList.concat(firstName)),email.length&&(combineList=combineList.concat(email)),nickName.length&&(combineList=combineList.concat(nickName)),lastName.length&&(combineList=combineList.concat(lastName)),combineList.length&&(autoList=autoList.concat(combineList)),fetchMorePersonal||fetchMoreOrg?callBack(autoList,!0):(qryFetchedAll[qry]=!0,callBack(autoList,void 0))})},refreshStaticList:function(){AutoListContacts.getCurrentAccount()?getContactsForStatic():new ZContacts.URI(ZContacts.Accounts).include("user").include("org").GETS().then(function(resp){var acc=resp[0],org=resp[1];org&&(acc.zoid=org.account_id),AutoListContacts.setCurrentAccount(acc),getContactsForStatic()})},indexContact:function(contactId){var contact=staticObj[contactId];contact.usage_count=contact.usage_count+2;var order=contact.order;if(!isNaN(order)&&1!=order){for(var prevOrder=order-1,prevContactCid=orderVsCid[prevOrder],safeBreak=0;!prevContactCid;){if(prevOrder-=1,0>=prevOrder)return;if(prevContactCid=orderVsCid[prevOrder],safeBreak++,safeBreak>2e3)break}var prevContact=staticObj[prevContactCid];if(prevContact)for(;contact.usage_count>prevContact.usage_count;){orderVsCid[prevOrder+1]=prevContact.get("contact_id"),prevContact.order=prevOrder+1,orderVsCid[prevOrder]=contact.get("contact_id"),contact.order=prevOrder,prevOrder+1!=order&&delete orderVsCid[order],order=contact.order,prevOrder=order-1;for(var prevContactCid=orderVsCid[prevOrder],safeBreak=0;!prevContactCid;){if(prevOrder-=1,0>=prevOrder)return;if(prevContactCid=orderVsCid[prevOrder],safeBreak++,safeBreak>2e3)break}if(prevContact=staticObj[prevContactCid],!prevContact)break}}},removeLeastUsageCountContact:function(usageCount){for(var key in staticObj)if(staticObj[key].usage_count<usageCount){var contact=staticObj[key];delete orderVsCid[contact.order],contact.primary_email&&delete emailVsCid[contact.primary_email];for(var qry in qryFetchedAll){var firstName=contact.get("first_name")?contact.get("first_name"):"",primaryEmail=contact.get("primary_email_id")?contact.get("primary_email_id"):"",nickName=contact.get("nick_name")?contact.get("nick_name"):"",lastName=contact.get("last_name")?contact.get("last_name"):"";if(firstName.startsWith(qry)||primaryEmail.startsWith(qry)||nickName.startsWith(qry)||lastName.startsWith(qry))delete qryFetchedAll[qry];else if(contact.emails)for(var i=0;i<contact.emails.length;i++){var email=contact.emails[i];if(email.startsWith(qry)){delete qryFetchedAll[qry];break}}}delete staticObj[key],fetchedAllOrg=!1,fetchedAllPersonal=!1}}};return initObj}();$.subscribe("contactsApp/added",function(event,obj){if(AutoListContacts.getCurrentAccount()){var zid=obj.zid;zid==AutoListContacts.getCurrentAccount().getAccountId()?fetchedAllPersonal=!1:zid==AutoListContacts.getCurrentAccount().zoid&&(fetchedAllOrg=!1)}}),$.subscribe("contactsApp/refresh",function(){Contacts.refreshStaticList()}),$.subscribe("contactsApp/deleted",function(event,obj){for(var cids=(obj.zid,obj.contact_ids),i=0;i<cids.length;i++){var contact=staticObj[cids[i]];delete orderVsCid[contact.order],contact.primary_email&&delete emailVsCid[contact.primary_email],delete staticObj[cids[i]]}}),$.subscribe("contactsApp/updated",function(event,obj){var contactId=obj.contact.contact_id;if(staticObj[contactId]){var contact=staticObj[contactId];obj.contact.order=contact.order,obj.contact.usage_count=contact.usage_count,staticObj[contactId]=obj.contact}}),ZContacts.selectedCount=0,ZContacts.deletedCount=0,ZContacts.newSearchDeletedCount=0,ZContacts._countObj={},ZContacts._childObj={},ZContacts._parentObj={},ZContacts._currentCategoryId,ZContacts._prevContact,ZContacts._authenticatedMailId,ZContacts._sync,ZContacts._syncedTime,ZContacts._enableStatus,ZContacts._audit={},ZContacts._accountAudit={},ZContacts.isRemoved=!1,ZContacts.AccountsVsRootFolderMap={};var printResponse={},checkValues={},headerValue={},searchMoreTimer;ZContacts.setAccount=function(acc){this.acc=acc},ZContacts.getMessageFromResponse=function(json){if(json.message){var value=ZContacts.checkCompanyName(json.message);return value}if(json.errors&&json.errors.length&&json.errors[0].message){var value=ZContacts.checkCompanyName(json.errors[0].message);return value}return ZContacts.I18N.get("IAM.ERROR.GENERAL")},ZContacts.checkCompanyName=function(value){return zmail.globalI18N.companyName&&zmail.globalI18N.companyName!=ZContacts.meta.rebrand_name&&(value=value.replace(new RegExp("\\b"+ZContacts.meta.rebrand_name+"\\b","gi"),zmail.globalI18N.companyName)),value};var zmcontact=function(){var URI=ZContacts.URI,encodeHTML=ZContacts.Utils.encodeHTML,I18N=ZContacts.I18N,ContactStatus=ZContacts.Constants.ChatStatus,headerObj={list:{left:{leftHTML:""},right:[]}},zcon={},listingMetaData={page:1,noOfResults:50,isLoading:!1},initObj={isRootFolder:function(catId){return catId||(catId=ZContacts._currentCategoryId),catId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS||catId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS||catId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?!0:!1},initContactSuite:function(){zmcontact.init(),zmcontact.constructView(),zcon={contactLeft:zmsuite.getLeft(),contactsCenter:zmsuite.getCenter()},zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS)),zcon.contactLeft.getNodes()[0].getLayer("VIEWS").setChildToggle(function(){}),new URI(ZContacts.Accounts).include("groups.categories").include("contacts.total_count").GETS().then(function(resp){zmcontact.storeAccountsFromResponse(resp),ZContacts.groups&&ZContacts.groups.length&&(zmcontact.appendAccountLayer(ZContacts.groups,"GROUPS"),zcon.contactLeft.render(),zcon.contactLeft.getNodes()[0].getLayer("VIEWS").setChildToggle(function(){}),zcon.contactLeft.getNodes()[0].getLayer("GROUPS").setChildToggle(function(){}))})},getActionMenuList:function(){return[{groupId:"select",actionArr:[{iconList:["msi-uncheck zcs-check"],tooltip:I18N.get("IAM.CONTACTS.SELECTALL")}]},{groupId:"sort",actionArr:[{iconList:["msi-sort"],tooltip:I18N.get("IAM.CONTACTS.SORT.BY")}]},{groupId:"delete",actionArr:[{iconList:["msi-trash"],tooltip:I18N.get("IAM.DELETE")}]},{groupId:"addto",actionArr:[{iconList:["msi-folder"],dropAction:!0,tooltip:I18N.get("IAM.CONTACTS.ADD.TO")}]},{groupId:"clearcontacts",actionArr:[{iconList:["msi-clearContacts"],dropAction:!0,tooltip:I18N.get("IAM.CONTACTS.CLEAR.CONTACTS")}]},{groupId:"merge",actionArr:[{iconList:["msi-contactMerge"],tooltip:I18N.get("IAM.CONTACTS.MERGE")}]},{groupId:"mail",actionArr:[{iconList:["msi-mail"],tooltip:I18N.get("IAM.CONTACTS.SEND.MAIL")}]},{groupId:"print",actionArr:[{iconList:["msi-print"],tooltip:I18N.get("IAM.CONTACTS.PRINT")}]},{groupId:"addcontact",actionArr:[{iconList:["msi-plus"],tooltip:I18N.get("IAM.CONTACTS.ADD.CONTACT")}]},{groupId:"action",actionArr:[{iconList:["msi-action"],dropAction:!0,tooltip:I18N.get("IAM.CONTACTS.MORE.ACTIONS"),separator:!0}]}]},getCategory:function(categoryId){var node=ZContacts._countObj[categoryId];if(!node)return void 0;if(-1==node.p){var index=0;index=categoryId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS||categoryId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?0:1;var category,data=zcon.contactLeft.getNodes(0)[0].layerArr[index].listObject[categoryId];if(data)category={category_id:data.category_id,category_name:data.category_name,contacts_count:ZContacts._countObj[categoryId].c};else{var acc=ZContacts.AccountsVsRootFolderMap[ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS];category={category_id:acc.getRootFolderId(),category_name:acc.getName(),contacts_count:acc.getCount()}}return ZContacts.Categories.create(category)}var data=ZContacts._childObj[node.p].CH[categoryId],category={category_id:data.category_id,category_name:data.category_name,contacts_count:ZContacts._countObj[categoryId].c};return ZContacts.Categories.create(category)},getRootFolderId:function(categoryId){return categoryId||(categoryId=ZContacts._currentCategoryId),-1!=ZContacts._countObj[categoryId].p?ZContacts._countObj[categoryId].p:categoryId},getAccountByZid:function(zid){return ZContacts.AccountsVsRootFolderMap[ZContacts.AccountsVsRootFolderMap[zid]]},isRootFolder:function(catId){return catId||(catId=ZContacts._currentCategoryId),catId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS||catId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS||catId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?!0:!1},loadCategoryContacts:function(categoryId){if(categoryId!=ZContacts._currentCategoryId){$(".SC_tre.Stre").removeClass("Stre"),$("#"+categoryId).addClass("Stre");var category=zmcontact.getCategory(categoryId);zmcontact.loadFirstPage(category),zmcontact.unChkAll()}},updateHeaderBand:function(category,count,isUpdate){var htm;if(isPrintWorkSpace())htm=I18N.get("IAM.CONTACTS.PRINT");else if(isOldSearchWorkSpace()||isCleanWorkSpace()){htm=encodeHTML(category.category_name);var cnt=category.contacts_count;1==cnt?htm+='<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.SINGLE.CONTACT"),cnt)+" </span>":cnt>1&&(htm+='<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.MULTIPLE.CONATCT"),cnt)+"</span>"),headerObj.list.left.leftHTML=htm;var headerNode=zmsuite.getWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID)[0].getNodes()[1];headerNode.push(headerObj.list),headerNode.paint(),isOldSearchWorkSpace()?htm=I18N.get("IAM.CONTACTS.SEARCH.RESULTS"):isCleanWorkSpace()&&(htm=I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES"))}else if(isImportWorkSpace())htm=I18N.get("IAM.CONTACTS.IMPORT.CONTACTS");else{var htm=encodeHTML(category.category_name);count&&ZContacts.selectedCount+count>0?(ZContacts.selectedCount=isUpdate?ZContacts.selectedCount+count:count,htm+=ZContacts.selectedCount>1?'<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.OF.SELECTED"),ZContacts.selectedCount)+"</span>":'<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.SELECTED"),ZContacts.selectedCount)+"</span>"):(count=category.contacts_count,isNewSearchWorkSpace()?count>50||50==count&&0!=count?htm+=category.has_more?'<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.MULTIPLE.CONATCT"),count+"+")+" </span>":'<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.MULTIPLE.CONATCT"),count)+" </span>":1==count?htm+='<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.SINGLE.CONTACT"),count)+" </span>":50>count&&0!=count&&(htm+='<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.MULTIPLE.CONATCT"),count)+"</span>"):1==count?htm+='<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.SINGLE.CONTACT"),count)+" </span>":count>1&&(htm+='<span class="sum"> '+zmcontact.formatMessage(I18N.get("IAM.MULTIPLE.CONATCT"),count)+"</span>"),ZContacts.selectedCount=0)}headerObj.list.left.leftHTML=htm;var headerNode=zmsuite.getCenter()[0].getNodes()[1];headerNode.push(headerObj.list),headerNode.paint()},loadFirstPage:function(category){var div="<div class='SC_conLft'></div><div class='SC_conRgt'><div class='zcs-cont-details'></div><div class='zcs-cont-edit zcs-editor-form'></div></div>";$(zcon.contactsCenter.listElem).html(div),listingMetaData.page=1,zmcontact._loadContacts(category),zmcontact.unChkAll(),zmsuite.showExistingApp("zm_Contacts")},loadSearchFirstPage:function(category){zmcontact.unChkAll(),zmcontact._loadContacts(category)},loadNextPage:function(category){listingMetaData.hasMore&&(listingMetaData.page++,zmcontact._loadContacts(category))},_loadContacts:function(category){ZContacts._currentCategoryId=category.category_id,ZContacts._prevContact=void 0,ZContacts.setAccount(zmcontact.getAccByCategoryId(category.category_id)),$(".msi-uncheck.zcs-check").parents("li").attr("style","display: block;");var uri=new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).include("emails").setSortBy(ZContacts.sortBy,!0);uri.setPagination(listingMetaData.page,listingMetaData.noOfResults),ZContacts.deletedCount>0&&uri.prependContacts(ZContacts.deletedCount);var categoryId=category.get("category_id");zmcontact.isRootFolder(categoryId)||uri.addFilter("categories",categoryId),$(".SC_tre.Stre").removeClass("Stre"),$("#"+categoryId).addClass("Stre");var isNextPage=1!=listingMetaData.page;listingMetaData.isLoading=!0;var destroyLoadingDiv=zmComponent.loadingBand({container:$(zcon.contactsCenter.listElem).find(".SC_conLft").get(0),type:"pagination"});if(uri.GETS().then(function(json){destroyLoadingDiv(),listingMetaData.isLoading=!1,listingMetaData.hasMore=uri.apiResponse.has_more,zmcontact.contactsList(json,isNextPage),ZContacts.deletedCount=0},function(json){destroyLoadingDiv(),listingMetaData.isLoading=!1,json.status_code===ZContacts.Constants.StatusCode.NOT_FOUND&&(ZContacts.deletedCount=0,zmcontact.contactsList(null))}),zmail.Search&&zmail.newSearch){ZContactsContext=ZContacts.newSearchContext;var contactsURI=new ZContacts.URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).setSortBy("usage_count",!1).include("emails").include("phones");"personal"==ZContacts.getCurrentAccount().type&&contactsURI.includes.push("org");var defaultParams=contactsURI.getParams()?"?"+contactsURI.getParams():"";ZContactsContext.url=contactsURI.requestURI+defaultParams,zmail.Search.registerContext(ZContactsContext)}},init:function(){var contactsAppObj={appname:"Contacts",appId:ZContacts.ZMailConstants.CONTACTS_APP_ID,appIcon:"msi-contacts",searchPlaceHolder:I18N.get("IAM.CONTACTS.SEARCH.CONTACTS"),data:{LNodes:"2",CNodes:"3"}};contactsAppObj.handler={create:zmcontact.showQuickCreate},zmsuite.setAppInfo(contactsAppObj)},constructView:function(){zcon.contactLeft=zmsuite.getLeft(),zcon.contactsCenter=zmsuite.getCenter(),zmcontact.constructLeft(),zmcontact.constructCenter(),zmsuite.showApp(ZContacts.ZMailConstants.CONTACTS_APP_ID),zcon.contactsCenter.listElem=zcon.contactsCenter[0].getNodes()[2].$el[0]},topbarHelpDoc:function(){var helpmenu={uitype:"button",id:"zcs_help_doc",iconClass:"ztb-icon-group ztb-help-icon",title:I18N.get("IAM.CONTACTS.HELP"),action:"URL:"+ZContacts.meta.serviceInfo.help_page_url};zmail.isFuji||ztopbar.addItem(helpmenu)},updateCountInCategories:function(category,count,isUpdate){isUpdate?(count=ZContacts._countObj[category.category_id].c+count,ZContacts._countObj[category.category_id].c=count>=0?count:0,category.contacts_count=ZContacts._countObj[category.category_id].c):(ZContacts._countObj[category.category_id].c=count,category.contacts_count=count)},getCategoriesListLayer:function(categoryId){categoryId||(categoryId=ZContacts._currentCategoryId);var rootFolderId=zmcontact.getRootFolderId(categoryId),index=0;return rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS&&(index=1),zcon.contactLeft.getNodes()[0].layerArr[index]},refreshContactCounts:function(zid){zid||(zid=ZContacts.getCurrentAccount().getAccountId()),new URI(ZContacts.Contacts,zid).addFields("count").include("categories").GETS().then(function(response){if(response){response=response._apiResponse;var rootFolderId=ZContacts.AccountsVsRootFolderMap[zid],contacts=ZContacts.Contacts.create(response.contacts),count=contacts.get("contacts_count"),category=zmcontact.getCategory(rootFolderId);if(zmcontact.updateCountInCategories(category,count,!1),contacts.get("categories"))for(var categories=contacts.get("categories"),i=0;i<categories.length;i++){var category=categories[i];ZContacts._countObj[category.category_id]||(ZContacts._countObj[category.category_id]={}),ZContacts._countObj[category.category_id]={p:rootFolderId,c:category.contacts_count}}zmcontact.updateHeaderBand(category),zmcontact.unChkAll()}})},constructLeft:function(){var leftNodes=zcon.contactLeft.getNodes()[0];leftNodes.push({layerArr:[]});var views=[];views.push(ZContacts.user),ZContacts.org&&views.push(ZContacts.org),zmcontact.appendAccountLayer(views,"VIEWS"),zcon.contactLeft.setListener("click",function(data){try{zcon.contactLeft.getNodes()[0].getLayer("VIEWS").setChildToggle(function(){}),zcon.contactLeft.getNodes()[0].getLayer("GROUPS").setChildToggle(function(){})}catch(e){}isContactDetailWorkSpace()&&data.zmsData.eventInfo.currentTarget.id==ZContacts._currentCategoryId||(zmsuite.showWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID),zmcontact.bindLeftActions(data))}),zcon.contactLeft.setListener("contextmenu",function(data){zmcontact.bindLeftActions(data)}),zcon.contactLeft.render()},appendAccountLayer:function(accounts,type){var categoryMapObj={id:"category_id",name:"category_name",count:"count",hasChild:"HC",expChild:"E",sequence:"SE",parentId:"p",notBold:"notBold"},name=I18N.get("IAM.CONTACTS.VIEWS");"VIEWS"!=type&&(name=I18N.get("IAM.CONTACTS.GROUPS"));for(var acc,listObject={},expand=0,categoryTreeObj={type:"1",listId:type+"H",id:type,hasChild:!0,hasCountObject:!0,notBold:!0,mapObject:categoryMapObj,dataObject:{headerObject:{licon:"msi-folder",id:"zcateH",name:name,showList:!0,count:"<i class='msi-plus'></i>",onAdd:function(){window.open(ZContacts.meta.serviceInfo.groups_url)}}}},i=0;i<accounts.length;i++){var hasChild=!1;acc=accounts[i];var rootFolderId=acc.getRootFolderId(),catName=encodeHTML(acc.getName());expand=0,"groups"!=acc.getType()&&(categoryTreeObj.dataObject.headerObject.count=void 0),"personal"==acc.getType()&&(expand=1),ZContacts._countObj[rootFolderId]={c:acc.count,p:-1};var categories=acc.getCategories();if(categories&&categories.length){hasChild=!0;for(var j=0;j<categories.length;j++){categories[j].category_id.toString()}}acc.isWritable&&(hasChild=!0,ZContacts._countObj[rootFolderId+"_add"]={c:0,p:rootFolderId},ZContacts._childObj[rootFolderId]||(ZContacts._childObj[rootFolderId]={CH:{}}),ZContacts._childObj[rootFolderId].CH[rootFolderId+"_add"]={id:rootFolderId+"_add",account_id:acc.getAccountId(),category_id:rootFolderId+"_add",category_name:I18N.get("IAM.CONTACTS.ADD.CATEGORY"),E:0,HC:!1,SE:999,addNewType:!0});var layer=zcon.contactLeft.getNodes()[0].getLayer(type);if(layer)layer.childObject=ZContacts._childObj,layer.countObject=ZContacts._countObj,layer.listObject[rootFolderId]={category_name:catName,category_id:rootFolderId,account:acc,type:acc.type,E:expand,HC:hasChild};else{listObject[rootFolderId]={category_name:catName,category_id:rootFolderId,account:acc,type:acc.type,E:expand,HC:hasChild},categoryTreeObj.dataObject.listObject=listObject,categoryTreeObj.dataObject.countObject=ZContacts._countObj,categoryTreeObj.dataObject.childObject=ZContacts._childObj;var categoriesLayer=new ZMLayer;categoriesLayer.push(categoryTreeObj),zcon.contactLeft.getNodes()[0].layerArr.push(categoriesLayer)}}},showCreateCategoryPopUp:function(obj,data){var popOpt,folTitle,folMode,posLeft,posTop,posElem,posOffset;obj=obj||{},folMode=obj.mode||"new",posElem=$(".zm_compose"),posOffset=posElem.offset(),posTop=posOffset.top+"px",posLeft=posOffset.left+posElem.width()+"px";var categoryMapObj={id:"category_id",name:"category_name",hasChild:"HC",expChild:"E",sequence:"SE",parentId:"p"},categoryName="";"rename"===folMode?(folTitle=I18N.get("IAM.CONTACTS.RENAME.CATEGORY"),categoryName=data.category.category_name):"new"===folMode&&(folTitle=I18N.get("IAM.CONTACTS.ADD.CATEGORY"));var all_contacts_id=obj.id;popOpt={title:folTitle,style:{width:"200px"},posParent:{top:posTop,left:posLeft},buttons:[{txt:I18N.get("IAM.SAVE"),selected:!0,callback:function(){var newCategoryName=$("#zc_categorypopup").find("input:first").val().trim();if(zmcontact.isValidCategoryName(newCategoryName,{mode:obj.mode,parElem:$("#zc_categorypopup")[0]})){var categoryModel=ZContacts.Categories.create({category_name:newCategoryName});"new"===obj.mode?new URI(ZContacts.Categories,obj.account_id).POST(categoryModel).then(function(json){var category=data.category;category||(category=data.rowObject[data.eventInfo.currentTarget.id],category.category_id=category.category_id.replace("_add",""));var rootFolderId=zmcontact.getRootFolderId(category.category_id);ZContacts._parentObj[rootFolderId]||(ZContacts._parentObj[rootFolderId]=[]),ZContacts._parentObj[rootFolderId].push(json.categories);var rowInfo={};rowInfo[json.categories.category_id]={category_id:json.categories.category_id,category_name:json.categories.category_name,E:1,HC:0};var layer=zmcontact.getCategoriesListLayer(rootFolderId);layer.insertNodeBefore(rowInfo,categoryMapObj,rootFolderId+"_add",rootFolderId),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.CATEGORY.ADDED"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}):"rename"===obj.mode&&new URI(ZContacts.Categories,obj.account_id,data.category.category_id).PUT(categoryModel).then(function(json){data.category.category_name=encodeHTML(json.categories.category_name);for(var rootFolderId=zmcontact.getRootFolderId(data.category.category_id),listObj=ZContacts._parentObj[rootFolderId],i=0;i<listObj.length;i++){var cat=listObj[i];if(cat.category_id==data.category.category_id){cat.category_name=encodeHTML(json.categories.category_name);break}}var rowObj={};rowObj[data.category.category_id]=data.category;var editChild={};editChild[data.category.category_id]={E:1,HC:0,category_name:json.categories.category_name,category_id:data.category.category_id},zmcontact.getCategoriesListLayer(all_contacts_id).editNode(rowObj,categoryMapObj,editChild),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.CATEGORYNAME.CHANGED"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),zmsDialog.remove()}$("#zmsdialog_zm_createfolpopup").hide()}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove()}}],closeaction:function(){$("#zc_categorypopup").remove()},afterDisplay:function(){$("#zc_categorypopup").find("input")[0].focus()}};var $createFolElem=$("<div id='zc_categorypopup'><ul class='zmListReset'><li><input type='text' class='SC_tiput' placeholder='"+I18N.get("IAM.CONTACTS.CATEGORY.NAME")+"'/></li></ul></div>");$createFolElem.find(".SC_tiput").val(categoryName),$("#zc_categorypopup").length||$(document.body).append($createFolElem),zmsDialog.create("zc_categorypopup",popOpt),$("#zmsdialog_zc_categorypopup").mousedown(function(ev){zmUtil.stopEvents(ev,!0)}),$("#zmsdialog_zc_categorypopup").click(function(){zmUtil.hideMenu(!1,!0)}),$("#zmsdialog_zc_categorypopup").off("keypress").on("keypress",function(e){13!=e.which||e.shiftKey||$(this).find(".sel")[0].click()})},isValidCategoryName:function(catName){return catNameLwrCase=catName.toLowerCase(),catName.length?!0:(zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.INVALID.CATEGORY.NAME")),!1)},bindLeftActions:function(data){var layerType,elem,evntType,evntObj,rowobj;data=data.zmsData,rowobj=data.rowObject,evntType=data.type,evntObj=data.eventInfo,elem=evntObj.srcElement||evntObj.target,layerType=data.rowInfo.type,"contextmenu"==evntType&&"_add"!=evntObj.currentTarget.id.substr("-4")?zmcontact.rightClickMenu(evntObj,rowobj):"click"==evntType&&"list"==layerType&&("_add"==evntObj.currentTarget.id.substr("-4")?zmcontact.showCreateCategoryPopUp({mode:"new",account_id:data.rowObject[evntObj.currentTarget.id].account_id,id:data.rowObject[evntObj.currentTarget.id].category_id},data):(ZContacts.currentCategoryId=data.eventInfo.currentTarget.id,zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts.currentCategoryId))))},rightClickMenu:function(e,categoryModel){if(!e.currentTarget.id)return!1;var menuObj={clk:function(ev,data,layerId){zmcontact.bindAction(data,ev,layerId)},conArr:[]},rootFolderId=zmcontact.getRootFolderId(e.currentTarget.id.toString()),acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];acc.isWritable&&(zmcontact.isRootFolder(e.currentTarget.id)?(menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.ADD.CATEGORY"),id:"RtMenu_ADD",data:{action:"Add",category:categoryModel[e.currentTarget.id]}},{sep:!0,id:"rightMenu_lne2"}),ZContacts._parentObj[rootFolderId]&&menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.DELETE.CATEGORIES"),id:"RtMenu_CLEAR",data:{action:"DeleteCategories",category:categoryModel[e.currentTarget.id]}},{sep:!0,id:"rightMenu_lne2"})):(menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.RENAME"),id:"RtMenu_RN",data:{action:"Rename",category:categoryModel[e.currentTarget.id]}}),menuObj.conArr.push({sep:!0,id:"rightMenu_lne2"}),menuObj.conArr.push({htm:I18N.get("IAM.DELETE"),id:"RtMenu_DC",data:{action:"Delete",category:categoryModel[e.currentTarget.id]}}),menuObj.conArr.push({sep:!0,id:"rightMenu_lne2"}))),menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.EXPORT"),id:"RtMenu_EX",data:{action:"Export",category:categoryModel[e.currentTarget.id]}}),"groups"==acc.type&&(menuObj.conArr.push({sep:!0,id:"rightMenu_lne2"}),menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.MANAGE.GROUPS"),id:"RtMenu_EX",data:{action:"Manage"}})),zmsuite.showContextMenu(e,menuObj),zmUtil.stopEvents(e)},bindAction:function(data,elem){if(data){var mode=data.action;if("Manage"==mode)return zmUtil.hideMenu(),void window.open(ZContacts.meta.serviceInfo.groups_url);var categoryId=data.category.category_id,rootFolderId=zmcontact.getRootFolderId(categoryId),acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];switch(mode){case"Add":zmUtil.hideMenu(),zmcontact.showCreateCategoryPopUp({mode:"new",account_id:acc.getAccountId(),id:categoryId},data);break;case"DeleteCategories":zmUtil.hideMenu(),zmcontact.deleteAllCategories(acc);break;case"Rename":zmUtil.hideMenu(),zmcontact.showCreateCategoryPopUp({mode:"rename",account_id:acc.getAccountId(),id:$("#"+data.category.category_id).parent().children()[0].id},data,elem);break;case"Delete":zmUtil.hideMenu(),zmcontact.deletecategory(data);break;case"Export":zmUtil.hideMenu(),zmcontact.exportPopUp(zmsuite.getCenter()[0].getNodes()[2],data.category);break;default:zmUtil.hideMenu()}}},showCleanWorkspace:function(){if(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID))zmsuite.showWorkSpace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID);else{var contactsTabObj2={appname:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES"),appId:ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID,appIcon:"msi-contactMerge",searchPlaceHolder:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES"),data:{CNodes:"3"}};zmsuite.setWorkSpace(contactsTabObj2),zmsuite.showWorkSpace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID);var workspaceCenter=zmsuite.getCenter(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID),centerNodes=workspaceCenter[0].getNodes();centerNodes[0].push([]);var headerObj={left:{leftHTML:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES")},right:[]};centerNodes[1].push(headerObj);var headericon={left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};centerNodes[0].push(headericon),centerNodes[0].setListener("click",function(ev,iconName){"msi-close"==iconName&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)})}},bindHeaderIcons:function(ev,iconName){var elem=ev.srcElement||ev.target,menuNode=zmsuite.getCenter()[0].getNodes()[0],contactsNode=zmsuite.getCenter()[0].getNodes()[2];switch(iconName){case"msi-uncheck zcs-check":zmcontact.chkAll(elem);break;case"msi-uncheck msi-partcheck zcs-check":case"msi-check zcs-check":zmcontact.unChkAll(elem);break;case"msi-sort":zmUtil.hideMenu(),menuNode.$el.find(".msi-sort").closest("b").addClass("SC_ddn");var listObj={},fnameTick="",lnameTick="";"first_name"==ZContacts.sortBy?fnameTick="class='msi-tick'":lnameTick="class='msi-tick'";var list=[{htm:"<i "+fnameTick+"></i>"+I18N.get("IAM.CONTACTS.FIRSTNAME"),data:{action:"first_name"}},{sep:!0,id:"rightMenu_lne2"},{htm:"<i "+lnameTick+"></i>"+I18N.get("IAM.CONTACTS.LASTNAME"),data:{action:"last_name"}}];listObj.par=menuNode.$el.find(".msi-sort").closest("li"),listObj.defaultclass=!0,listObj.parWidth=!0,listObj.onHide=function(){menuNode.$el.find(".msi-sort").closest("b").removeClass()},listObj.list=list,listObj.clk=function(data,elem){"msi-tick"!=$(elem).find("i").attr("class")&&($(elem).parent().find(".msi-tick").removeClass("msi-tick"),$(elem).find("i").addClass("msi-tick"),$.isEmptyObject(data)||null==data||(ZContacts.sortBy=data.action,new URI(ZContacts.Contacts,ZContacts.getUserAccount().getAccountId(),"sort").addPostParam("sort",data.action).PUT().then(function(response){zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(response)),zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId))},function(response){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))}))),zmUtil.hideMenu(),menuNode.$el.find(".msi-action").closest("b").removeClass()},zmsuite.showMenu(listObj);break;case"msi-contactMerge":var noOfContactsSelected=contactsNode.$el.find(".zmL.SC_cont.SC_check").length;if(2>noOfContactsSelected||noOfContactsSelected>5)zmUtil.succErrMsg("e",zmcontact.formatMessage(I18N.get("IAM.CONTACTS.ERROR.SELECT.LIMIT"),5)),zmcontact.unChkAll(),ev.stopPropagation();else{var contactIds=zmcontact.getSelectedContactIds(zmsuite.getCenter()[0].getNodes()[2].$el);contactIds&&zmcontact.showMergeUI(contactIds,!0)}break;case"msi-action":zmUtil.hideMenu(),menuNode.$el.find(".msi-action").closest("b").addClass("SC_ddn");var listObj={},list=[];list.push({htm:I18N.get("IAM.CONTACTS.EXPORT"),data:{action:"export"}}),isNewSearchWorkSpace()||contactsNode.$el.find(".SC_conLft").length&&list.push({htm:I18N.get("IAM.PRINT"),data:{action:"print"}}),ZContacts.getCurrentAccount().isWritable&&!isNewSearchWorkSpace()&&(list.push({htm:I18N.get("IAM.CONTACTS.IMPORT"),data:{action:"import"}}),list.push({htm:I18N.get("IAM.CONTACTS.RESET.CONTACTS"),data:{action:"reset"}}),list.push({htm:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES")+"<i class='msi-rarrow'></i>",data:{action:"clean_dupes"},child:{divId:"zcs_cleanDupes",list:[{htm:I18N.get("IAM.CONTACTS.AUTO"),data:{action:"auto"}},{htm:I18N.get("IAM.CONTACTS.MANUAL"),data:{action:"manual"}}],align:"cleft",clk:function(data,elem,event){$("#zm_dropDown").hide(),$("#zcs_cleanDupes").hide(),menuNode.$el.find(".msi-action").closest("b").removeClass();var rootFolderId=zmcontact.getRootFolderId();if(0==ZContacts._countObj[rootFolderId].c)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.NO.CONTACT.ADDED.YET"));var acc=ZContacts.getCurrentAccount();if("auto"==data.action){var infoContent=I18N.get("IAM.CONTACTS.DUPLICATES.AUTO.CLEAN.NOTE");zmsDialog.confirm(infoContent,{onOk:function(){var container;zmsuite.getCenter()[0].$el.find("#zcs_loading").length||(zmsuite.getCenter()[0].$el.prepend("<div id='zcs_loading'></div>"),type="listing"),container=$("#zcs_loading").get(0);var loadingDiv=zmComponent.loadingBand({container:container,type:"listing"});new URI(ZContacts.ContactsDuplicates,acc.getAccountId()).DELETE().then(function(resp){if(loadingDiv(),204==resp.status_code){try{(acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||acc.getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&zmcontact.invokeEvent("contactsApp/refresh",{zid:acc.getAccountId()})}catch(e){}zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(resp))}else zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(resp));zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId)),zmcontact.refreshContactCounts(),delete ZContacts._accountAudit[acc.getAccountId()]},function(resp){loadingDiv(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(resp))})}})}else"manual"==data.action&&new URI(ZContacts.ContactsDuplicates,ZContacts.getCurrentAccount().getAccountId()).GETS().then(function(contacts){if(!contacts.length)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.NO.DUPES.FOUND"));zmcontact.showCleanWorkspace(),zmcontact.unChkAll();var isCleanDupes=!0;zmcontact.contactsList(contacts,!1,isCleanDupes),zmsuite.renderWorkSpace(),delete ZContacts._accountAudit[ZContacts.getCurrentAccount().getAccountId()]});event.stopPropagation()}}}),list.push({htm:I18N.get("IAM.CONTACTS.ACCOUNT.AUDIT"),data:{action:"account_audit"}}),list.push({htm:I18N.get("IAM.CONTACTS.TRASH")+"<i class='msi-rarrow'></i>",data:{action:"restore_contacts"},child:{divId:"zcs_trash",list:[{htm:I18N.get("IAM.CONTACTS.RESTORE"),data:{action:"restore"}},{htm:I18N.get("IAM.CONTACTS.CLEAR"),data:{action:"clear"}}],align:"cleft",clk:function(data,elem,event){$("#zm_dropDown").hide(),$(event.currentTarget.offsetParent).hide(),menuNode.$el.find(".msi-action").closest("b").removeClass();zmcontact.getRootFolderId(),ZContacts.getCurrentAccount();if("clear"==data.action){var msg=I18N.get("IAM.CONTACTS.CLEAR.TRASH.MSG"),html="<img style='float: left;left: 29px;top: 30px;margin-right: 5px;' src='"+ZContacts.meta.serviceInfo.contacts_server_url+"/images/error.png' /><h4 style='float: left;width:90%;padding-top: 5px;padding-bottom: 5px;'>"+msg+"</h4>";html+="<div class='SC_PUbtm'><span id='zcs_delete' class='sel' onclick='zmcontact.clearContacts(ZContacts.getCurrentAccount().getAccountId(), \"clear\");zmcontact.removeDialog(this);' >"+I18N.get("IAM.CONTACTS.CLEAR")+"</span><span data-val='Cancel' onclick='zmcontact.removeDialog(this);'>"+I18N.get("IAM.CANCEL")+"</span></div>";{Dialog["new"]({title:"",$content:html,defaultCloseIcon:!0})}}else"restore"==data.action&&zmcontact.restorePopUp(ZContacts.getCurrentAccount().getAccountId());event.stopPropagation()}}})),listObj.par=menuNode.$el.find(".msi-action").closest("li"),listObj.defaultclass=!0,listObj.parWidth=!0,listObj.onHide=function(){menuNode.$el.find(".msi-action").closest("b").removeClass()},listObj.list=list,listObj.clk=function(data){if("import"==data.action&&zmcontact.zconImportDetails(),"export"==data.action){var selectedContactIds=zmcontact.getSelectedContactIds(contactsNode.$el);selectedContactIds.length<=ZContacts.ZMailConstants.SELECT_LIMIT&&zmcontact.exportPopUp(contactsNode)}if("print"==data.action&&zmcontact.printWorkspace(contactsNode),"reset"==data.action){var rootFolderId=zmcontact.getRootFolderId();if(0==ZContacts._countObj[rootFolderId].c)return zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.NO.CONTACT.ADDED.YET")),$("#zm_dropDown").hide(),void menuNode.$el.find(".msi-action").closest("b").removeClass();var count=ZContacts._countObj[rootFolderId].c,msg=rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?I18N.get("IAM.ERROR.SURE.RESETALL.CONTACTS.ORG"):rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS?zmcontact.formatMessage(I18N.get("IAM.ERROR.SURE.RESETALL.CONTACTS.GROUP"),encodeHTML(ZContacts.getCurrentAccount().getName())):I18N.get("IAM.ERROR.SURE.RESETALL.CONTACTS.PERSONAL"),html="<img style='float: left;left: 29px;top: 30px;margin-right: 5px;' src='"+ZContacts.meta.serviceInfo.contacts_server_url+"/images/error.png' /><h4 style='float: left;width:90%;padding-top: 5px;padding-bottom: 5px;'>"+msg+"</h4>",txt=I18N.get(1==count?"IAM.CONTACTS.SINGLE.COUNT.DELETE":"IAM.CONTACTS.MULTIPLE.COUNT.DELETE");html+="<div class='SC_PUbtm'><span id='zcs_delete' class='sel' onclick='zmcontact.resetContacts(event);zmcontact.removeDialog(this);' >"+zmcontact.formatMessage(txt,count)+"</span><span data-val='Cancel' onclick='zmcontact.removeDialog(this);'>"+I18N.get("IAM.CANCEL")+"</span></div>";{Dialog["new"]({title:"",$content:html,defaultCloseIcon:!0})}}"clean_dupes"==data.action&&($("#zcs_cleanDupes").hide(),menuNode.$el.find(".msi-action").closest("b").removeClass()),"account_audit"==data.action&&zmcontact.accountAuditPopUp(ZContacts.getCurrentAccount().getAccountId()),"restore_contacts"==data.action&&($("#zcs_trash").hide(),menuNode.$el.find(".msi-action").closest("b").removeClass()),$("#zm_dropDown").hide(),menuNode.$el.find(".msi-action").closest("b").removeClass()},zmsuite.showMenu(listObj);break;case"msi-trash":var contactIds=zmcontact.getSelectedContactIds(contactsNode.$el);if(contactIds.length>ZContacts.ZMailConstants.SELECT_LIMIT)return!1;zmcontact.deleteMultiContacts(contactIds);break;case"msi-folder":var contactIds=zmcontact.getSelectedContactIds(contactsNode.$el);if(contactIds.length>ZContacts.ZMailConstants.SELECT_LIMIT)return!1;zmcontact.addTo(menuNode.$el.find(".msi-folder").closest("li"),"move");break;case"msi-clearContacts":var selectedContactIds=zmcontact.getSelectedContactIds(contactsNode.$el);if(selectedContactIds.length>ZContacts.ZMailConstants.SELECT_LIMIT)return!1;var msg,categoryId=ZContacts._currentCategoryId;msg=1==selectedContactIds.length?zmcontact.formatMessage(I18N.get("IAM.CONTACTS.SURE.REMOVE.FROM.CATEGORY"),zmsuite.getCenter()[0].$el.find("#"+selectedContactIds[0]).get(0).__zc_contact.getFullName().trim(),zmcontact.getCategory(categoryId).category_name):zmcontact.formatMessage(I18N.get("IAM.CONTACTS.SURE.REMOVE.THESE.FROM.CATEGORY"),selectedContactIds.length,zmcontact.getCategory(categoryId).category_name),zmsDialog.confirm(msg,{onOk:function(){new URI(ZContacts.ContactsCategories,ZContacts.getCurrentAccount().getAccountId(),selectedContactIds,categoryId).DELETE().then(function(resp){var elem,loadedCntDetail=$("div[data-field-type=zcs-cnt-view]"),selectedCount=selectedContactIds.length,category=zmcontact.getCategory(categoryId);if(204==resp.status_code){for(var i=0;i<selectedContactIds.length;i++){elem=$("#"+selectedContactIds[i]);var nextElem;if(!elem.next().length&&!elem.prev().length)return zmcontact.updateCountInCategories(category,-selectedCount,!0),zmcontact.loadFirstPage(category),zmcontact.unChkAll(),zmcontact.updateHeaderBand(category),void zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.CONTACTS.REMOVED.FROM.CATEGORY"));elem.next().length?nextElem=elem.next():(nextElem=$($(".zmL.SC_cont")[0]),zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),nextElem,elem)),elem.remove()}nextElem.click(),zmcontact.updateCountInCategories(category,-selectedCount,!0),zmcontact.unChkAll(),zmcontact.updateHeaderBand(category),"zcs-cnt-view"!=loadedCntDetail.attr("data-field-type")&&zmcontact.loadContactDetails($("div[data-field-type=zcs-cnt-view]")[0].id),zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.CONTACTS.REMOVED.FROM.CATEGORY"))}else zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.ERROR.GENERAL"))})}});break;case"msi-mail":var selectedMailIds=zmcontact.getSelectedMailIds(contactsNode.$el).toString();if(selectedMailIds.split(",").length>100)return void zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.EMAIL.LIMIT.SEND"),100));zmcontact.sendMail(selectedMailIds);break;case"msi-plus":zmcontact.showQuickCreate();break;case"msi-print":zmcontact.printWorkspace(contactsNode)}},removeDialog:function(t){$(t).parents(".SC_PU").find(".msi-close").click()},resetContacts:function(e){1==ZContacts.meta.user.reset_scheduled?zmUtil.succErrMsg("s",I18N.get("IAM.RESET.CONTACTS.IS.SCHEDULED")):e&&ZContacts.getCurrentAccount().isWritable&&zmcontact.deleteAllContacts(ZContacts.getCurrentAccount().account_id)},sendMail:function(mailIds){if(zmail.forContactsApp){var mailBoxExist=zmail.isMailBoxExist;if(mailBoxExist){var url=zmail.urls.mailToUrl.replace(/&amp;/g,"&").replace(/&equals;/g,"=");return void zmcontact.wopen(url+mailIds,80,77).focus()}window.location.href="mailto:"+mailIds.split(",").join(";")}else zmUtil.compose({TO:mailIds})},wopen:function(url,wd,ht,name){var nW=parseInt(wd*screen.width/100),nH=parseInt(ht*screen.height/100),l=(screen.width-nW)/2,t=(screen.height-nH)/2;return name=name?name:(new Date).getTime(),window.open(url,name,"height="+nH+", width="+nW+",status=yes,toolbar=no,top="+t+", left="+l+", menubar=no,location=no,scrollbars=yes,resizable=yes")},exportPopUp:function(contactsNode,category){var noOfContactsSelected=contactsNode.$el.find(".zmL.SC_cont.SC_check").length,contactIdsArr=zmcontact.getSelectedContactIds(zmsuite.getCenter()[0].getNodes()[2].$el),exportDiv={};if(exportDiv.title=I18N.get("IAM.CONTACTS.EXPORT.CONTACTS"),exportDiv.mask=!0,exportDiv.buttons=[{txt:I18N.get("IAM.CONTACTS.EXPORT.CONTACTS"),selected:!0,callback:function(){var password=$("#zcs_export_password_div").find("input").val();if($("#zcs_exportPopup").find(".msi-check").length){if(!password||!password.trim())return zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.PASSWORD.REQUIRED.TO.EXPORT")),!1;if(password.length<4)return zmUtil.succErrMsg("e",zmcontact.formatMessage(I18N.get("IAM.CONTACTS.PASSWORD.MINIMUMLENGTH"),4)),!1}var accountId,categoryId;noOfContactsSelected?accountId=ZContacts.getCurrentAccount().getAccountId():(accountId=$("#zcs_account").find("input")[0].id,categoryId=$("#zcs_category").find("input")[0].id);var uri;if(contactIdsArr&&contactIdsArr.length){uri=new URI(ZContacts.ExportContacts,accountId,contactIdsArr.toString());var acc=zmcontact.getAccountByZid(accountId);acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT&&isNewSearchWorkSpace()&&uri.include("org")}else{if(void 0!=ZContacts._countObj[categoryId].c&&0==ZContacts._countObj[categoryId].c){var name;if(zmcontact.isRootFolder(categoryId))name=I18N.get("IAM.CONTACTS.ALL.CONTACTS");else{var category=zmcontact.getCategory(categoryId);name=category.category_name}return void zmUtil.succErrMsg("e",zmcontact.formatMessage(I18N.get("IAM.CONTACTS.NO.CONTACTS.AVAILABLE.CATEGORY"),name))}uri=new URI(ZContacts.ExportContacts,accountId),categoryId&&!zmcontact.isRootFolder(categoryId)&&uri.addPostParam("filter_categories",categoryId)}var exportModel=ZContacts.ExportContacts.create(),format=$("#zcs_exportPopup").find("#format").attr("data-field-type");password&&uri.setAuthHeader(accountId,password),uri.addPostParam("filter_format",format),uri.POST(exportModel),delete ZContacts._accountAudit[accountId],zmsDialog.remove(),zmcontact.unChkAll()}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove(),$("#zcs_exportPopup").remove()}}],exportDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_exportPopup").remove()},exportDiv.pos="center",createFolElem=$("<div id='zcs_exportPopup'></div>"),!$("#zcs_exportPopup").length){var tags="<div class='SC_tdtl'>";if(noOfContactsSelected)tags=tags+"<div class='SC_flt SC_fst' style='padding-top: 6px;'><ul class='zmListReset'><li><b>"+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.OF.SELECTED"),noOfContactsSelected)+"</b></li></ul></div>";else if(category){var categoryId=category.category_id,rootFolderId=zmcontact.getRootFolderId(categoryId),name=encodeHTML(category.category_name);rootFolderId==categoryId&&(name=I18N.get("IAM.CONTACTS.ALL.CONTACTS"));var acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];tags=tags+"<div class='SC_flt SC_select' onclick='zmcontact.getScrollList($(\"#zcs_exportPopup\").find(\"#zcs_account ul li\"), \"account\", false)' style='width: 30%' id='zcs_account'><ul class='zmListReset'><li><b><input id='"+acc.getAccountId()+"' name='"+encodeHTML(acc.getName())+"' placeholder='"+encodeHTML(acc.getName())+"' class='SC_tiput' style='border:0px' readonly=readonly></b></li></ul></div>",tags=tags+"<div class='SC_flt SC_select' onclick='zmcontact.getScrollList($(\"#zcs_exportPopup\").find(\"#zcs_category ul li\"), \"category\", false)' style='width: 30%' id='zcs_category'><ul class='zmListReset'><li><b><input id='"+category.category_id+"' name='filter_categories' placeholder='"+name+"' class='SC_tiput' style='border:0px' readonly=readonly></b></li></ul></div>"}else{var category=zmcontact.getCategory(ZContacts._currentCategoryId),acc=ZContacts.getCurrentAccount();category||(category=zmcontact.getCategory(ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS)),tags=tags+"<div class='SC_flt SC_select' onclick='zmcontact.getScrollList($(\"#zcs_exportPopup\").find(\"#zcs_account ul li\"), \"account\")' style='width: 30%' id='zcs_account'><ul class='zmListReset'><li><b><input id='"+acc.getAccountId()+"' name='"+encodeHTML(acc.getName())+"'placeholder='"+encodeHTML(acc.getName())+"' class='SC_tiput' style='border:0px' readonly=readonly></b></li></ul></div>",tags=tags+"<div class='SC_flt SC_select' onclick='zmcontact.getScrollList($(\"#zcs_exportPopup\").find(\"#zcs_category ul li\"), \"category\")' style='width: 30%' id='zcs_category'><ul class='zmListReset'><li><b><input id='"+category.category_id+"' name='filter_categories' placeholder='"+I18N.get("IAM.CONTACTS.ALL.CONTACTS")+"' class='SC_tiput' style='border:0px' readonly=readonly></b></li></ul></div>"}tags=tags+"<div class='SC_flt SC_select' style='width: 30%;' onclick='zmcontact.getFormatList(this)' id='zcs_format'><ul class='zmListReset'><li><b><input class='SC_tiput' placeholder='"+I18N.get("IAM.CONTACTS.EXPORT.FORMAT.CSV")+"' id='format' name='format' data-field-type='csv' style='display: inline-block;border:0px' readonly=readonly></b></li></ul></div></div>",tags=tags+"<div class='SC_flt' style='padding-bottom: 15px;'><div class='zmFlt' style='color: #878787'><i class='msi-uncheck' onclick='showPassWord(this)'></i><span style='font-size: 12px'>"+I18N.get("IAM.CONTACTS.SECURE.EXPORT.FILE")+"</span></div></div>",tags=tags+"<br><div class='SC_flt' style='display: none;' id='zcs_export_password_div'><input type='password' name='password' autocomplete='new-password' placeholder='"+I18N.get("IAM.CONTACTS.ENTER.PASSWORD.EXPORT.ZIP")+"' class='SC_tiput'>",tags=tags+"<div style='clear:both;padding-top: 10px;'><span style='font-size: 12px;color: #878787;'>"+I18N.get("IAM.NOTE")+": </span><span style='font-size: 12px;color: #878787'>"+I18N.get("IAM.CONTACTS.PASSWORD.ZIP.NOTE")+"</span></div></div>",createFolElem.append(tags),$(document.body).append(createFolElem)}zmsDialog.create("zcs_exportPopup",exportDiv),$("#zcs_exportPopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_exportPopup").parents(".SC_Pop").on("click",function(){this.remove()})},exportContacts:function(account_id,contactIdsArr,categoryId){if(contactIdsArr&&!contactIdsArr.length&&void 0!=ZContacts._countObj[categoryId].c&&0==ZContacts._countObj[categoryId].c){var name;if(zmcontact.isRootFolder(categoryId))name=I18N.get("IAM.CONTACTS.ALL.CONTACTS");else{var category=zmcontact.getCategory(categoryId);name=category.category_name}return void zmUtil.succErrMsg("e",zmcontact.formatMessage(I18N.get("IAM.CONTACTS.NO.CONTACTS.AVAILABLE.CATEGORY"),name))}var form=document.createElement("form");form.setAttribute("style","display : none"),form.setAttribute("id","zcs_export_form");var format=$("#zcs_format input")[0].getAttribute("data-field-type").trim(),formatEle=document.createElement("input");formatEle.setAttribute("name","filter_format"),formatEle.setAttribute("value",format),form.appendChild(formatEle);var acc=zmcontact.getAccountByZid(account_id),uri=new URI(ZContacts.ExportContacts,account_id).requestURI;if(contactIdsArr&&contactIdsArr.length){if(uri+="/"+contactIdsArr.join(","),acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT&&isNewSearchWorkSpace()){var include=document.createElement("input");include.setAttribute("name","include"),include.setAttribute("value","org"),form.appendChild(include)}}else if(!zmcontact.isRootFolder(categoryId)){var catEle=document.createElement("input");catEle.setAttribute("name","filter_categories"),catEle.setAttribute("value",categoryId),form.appendChild(catEle)}var csrfElem=document.createElement("input");csrfElem.setAttribute("value",ZContacts.Cookie.getCSRFValue()),csrfElem.setAttribute("name",ZContacts.meta.serviceInfo.csrf_param_name),form.appendChild(csrfElem),form.setAttribute("action",uri),form.setAttribute("method","get");var iframe=document.createElement("iframe");iframe.setAttribute("src",ZContacts.meta.serviceInfo.contacts_server_url+"/html/blank.html"),iframe.setAttribute("width",0),iframe.setAttribute("heigth",0),iframe.style.display="none",iframe.setAttribute("name","zcs_exportFrame"),form.target="zcs_exportFrame",form.appendChild(iframe),document.body.appendChild(form),zmcontact.unChkAll(),zmsDialog.remove(),form.submit()},getSelectedMailIds:function(ele){var mailArr=[];ele=$(ele.find(".zmL.SC_cont.SC_check"));for(var i=0;i<ele.length;i++)ele.get(i).__zc_contact.emails&&mailArr.push(ele.get(i).__zc_contact.getPrimaryEmail());return mailArr},showMergeUI:function(contactIds,isMerge){new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId(),contactIds).include("emails").include("phones").include("ims").include("address").include("urls").GET().then(function(contacts){if(!contacts[0])return zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId)),void zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.ERROR.GENERAL"));var leftObj;if(!isMerge){leftObj={leftHTML:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES")};var headerObj={left:leftObj,right:[]};zmsuite.getCenter()[0].getNodes()[1].push(headerObj),zmsuite.getCenter()[0].getNodes()[1].paint()}zmcontact.showMergePage(contacts,contactIds,isMerge)})},checkFav:function(t){var $t=$(t);$t.parent(".zcs-mfield-row").siblings().find(".SC_fav").removeClass("SC_fav"),$t.addClass("SC_fav")},getFormatList:function(){var formatObj={},format=[{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.CSV"),data:{action:"csv"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.VCF"),data:{action:"vcf"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.LDIF"),data:{action:"ldif"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.HTML"),data:{action:"html"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.OUTLOOK.CSV"),data:{action:"outlook"}}];formatObj.list=format,formatObj.par=$("#zcs_exportPopup").find("#zcs_format ul li"),formatObj.defaultclass=!0,formatObj.parWidth=!0,formatObj.onHide=function(){},formatObj.clk=function(data){"csv"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.CSV")),"vcf"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.VCF")),"ldif"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.LDIF")),"html"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.HTML")),"outlook"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.OUTLOOK.CSV")),$("#zmsdialog_zcs_exportPopup").find("#format")[0].setAttribute("data-field-type",data.action),$("#zm_dropDown").hide()},zmsuite.showMenu(formatObj)},getFormatRestoreList:function(){var formatObj={},format=[{htm:I18N.get("IAM.CONTACTS.10.DAYS"),data:{action:"10"}},{htm:I18N.get("IAM.CONTACTS.20.DAYS"),data:{action:"20"}},{htm:I18N.get("IAM.CONTACTS.30.DAYS"),data:{action:"30"}}];formatObj.list=format,formatObj.par=$("#zcs_restorePopup").find("#zcs_format ul li"),formatObj.defaultclass=!0,formatObj.parWidth=!0,formatObj.onHide=function(){},formatObj.clk=function(data){"10"==data.action&&($("#zmsdialog_zcs_restorePopup").find("#days")[0].placeholder=I18N.get("IAM.CONTACTS.10.DAYS")),"20"==data.action&&($("#zmsdialog_zcs_restorePopup").find("#days")[0].placeholder=I18N.get("IAM.CONTACTS.20.DAYS")),"30"==data.action&&($("#zmsdialog_zcs_restorePopup").find("#days")[0].placeholder=I18N.get("IAM.CONTACTS.30.DAYS")),$("#zmsdialog_zcs_restorePopup").find("#days")[0].setAttribute("data-field-type",data.action),$("#zm_dropDown").hide()},zmsuite.showMenu(formatObj)},addTo:function(parentEle,operation){var contactsNode=zmsuite.getCenter()[0].getNodes()[2],viewCategoriesList=(zmcontact.getSelectedContactIds(contactsNode.$el),null),config={};config.parentDOM=parentEle,config.displayAs="dropdown",config.hltPar=!0,config.offsets={left:0,top:0},config.onSelect=function(id){if(!id)return zmcontact.unChkAll(),void viewCategoriesList.hide();var destZid=ZContacts.AccountsVsRootFolderMap[zmcontact.getRootFolderId(id)],categoryId=(ZContacts.getCurrentAccount().getAccountId(),zmcontact.isRootFolder(id)?-1:id);if("move"==operation){var copy=ZContacts.Copy.create(),obj={},size=0;$.each(zmsuite.getCenter()[0].$el.find(".SC_cont.SC_check"),function(key,value){obj[value.__zc_contact.zid]||(obj[value.__zc_contact.zid]=[],size++),obj[value.__zc_contact.zid].push(value.__zc_contact.contact_id)}),1==size?$.each(obj,function(zid,idsArr){var from=ZContacts.CopyFrom.create({zid:zid,contact_ids:idsArr});copy.addSubResource(from)}):$.each(obj,function(zid,idsArr){var from=ZContacts.CopyFromMultiple.create({zid:zid,contact_ids:idsArr});copy.addSubResource(from)});var copyto=ZContacts.CopyTo.create({zid:destZid.account_id,category_id:categoryId});copy.addSubResource(copyto),new URI(ZContacts.Copy,destZid.getAccountId()).POST(copy).then(function(response){return 201==response.status_code?(zmcontact.refreshContactCounts(destZid.getAccountId()),void zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(response))):void zmUtil.succErrMsg("e",I18N.get("IAM.ERROR.GENERAL"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),zmcontact.unChkAll()}viewCategoriesList.hide()};config.dataCallback=function(){var cat=[];if(ZContacts.getCurrentAccount().isWritable){isNewSearchWorkSpace()&&cat.push({id:ZContacts.getCurrentAccount().getRootFolderId(),display_text:encodeHTML(ZContacts.getCurrentAccount().name)+"/",tooltip:encodeHTML(ZContacts.getCurrentAccount().name)+"/"});var cate=ZContacts._parentObj[ZContacts.getCurrentAccount().getRootFolderId()];if(cate)for(var i=0;i<cate.length;i++){var display="/"+encodeHTML(cate[i].category_name)+"/";if(display.length>20)var displayText=".../"+encodeHTML(cate[i].category_name.substring(0,19))+"...";else var displayText=encodeHTML(ZContacts.getCurrentAccount().name)+"/"+encodeHTML(cate[i].category_name)+"/";cat.push({id:cate[i].category_id,name:displayText,display_text:displayText,tooltip:encodeHTML(ZContacts.getCurrentAccount().name)+"/"+encodeHTML(cate[i].category_name)+"/"})}}for(var i=0;i<ZContacts.AccountsList.length;i++)if(ZContacts.AccountsList[i].id!=ZContacts.getCurrentAccount().account_id){var rootFolderId=ZContacts.AccountsVsRootFolderMap[ZContacts.AccountsList[i].id],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];if(acc.isWritable){cat.push({id:ZContacts.AccountsVsRootFolderMap[ZContacts.AccountsList[i].id],display_text:encodeHTML(ZContacts.AccountsList[i].name)+"/",tooltip:encodeHTML(ZContacts.AccountsList[i].name)+"/"});var categories=ZContacts._parentObj[acc.getRootFolderId()];if(categories)for(var j=0;j<categories.length;j++){var display="/"+encodeHTML(categories[j].category_name)+"/";if(display.length>20)var displayText=".../"+encodeHTML(categories[j].category_name.substring(0,19))+"...";else var displayText=encodeHTML(acc.name)+"/"+encodeHTML(categories[j].category_name)+"/";cat.push({id:categories[j].category_id,name:categories[j].encrypt_cat_id,display_text:displayText,tooltip:encodeHTML(acc.name)+"/"+encodeHTML(categories[j].category_name)+"/"})}}}return cat},viewCategoriesList=zmUtil.createFLComp("generic",config),viewCategoriesList.show()},getScrollList:function(parentEle,operation,isWritable){$(".zcs-import-form").on("scroll",function(){$("#zm_flpopup").remove()});var viewCategoriesList=null,config={};config.parentDOM=parentEle,config.displayAs="dropdown",config.hltPar=!0,config.offsets={left:0,top:0},config.onSelect="category"==operation?function(id,elem){id&&$("#zcs_category").find("input").attr({id:id,placeholder:elem.display_text,name:elem.name}),viewCategoriesList.hide()}:function(id){var rootFolderId=ZContacts.AccountsVsRootFolderMap[id],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];$("#zcs_account").find("input").attr({id:id,name:encodeHTML(acc.name),placeholder:encodeHTML(acc.name)});var onclickValue='zmcontact.getScrollList(this, "category", false)';$("#zcs_category").find("input").attr({onclick:onclickValue,id:ZContacts.AccountsVsRootFolderMap[id],name:I18N.get("IAM.CONTACTS.ALL.CONTACTS"),placeholder:I18N.get("IAM.CONTACTS.ALL.CONTACTS")}),viewCategoriesList.hide()},config.dataCallback=function(){if("account"==operation){if(isWritable){for(var accArr=[],i=0;i<ZContacts.AccountsList.length;i++){var acc=ZContacts.AccountsList[i];acc.isWritable&&accArr.push(acc)}return accArr}return ZContacts.AccountsList}return rootFolderId=zmcontact.getRootFolderId($("#zcs_category").find("ul li input").attr("id")),zmcontact.getCategoriesList(rootFolderId,operation)},viewCategoriesList=zmUtil.createFLComp("generic",config),viewCategoriesList.show()},getCategoriesList:function(categoryId,operation){var cat=[];categoryId||(categoryId=ZContacts._currentCategoryId);var rootFolderId=zmcontact.getRootFolderId(categoryId);"category"==operation&&cat.push({id:rootFolderId,name:I18N.get("IAM.CONTACTS.ALL.CONTACTS"),display_text:I18N.get("IAM.CONTACTS.ALL.CONTACTS")});var cate=ZContacts._parentObj[rootFolderId];if(cate)for(var i=0;i<cate.length;i++)cat.push({id:cate[i].category_id,name:encodeHTML(cate[i].category_name),display_text:encodeHTML(cate[i].category_name)});return 0==cat.length&&cat.push({display_text:I18N.get("IAM.CONTACTS.NO.CATEGORIES")}),cat},addContactsToCategory:function(contactIdsArr,categoryId){if(!zmcontact.isRootFolder(categoryId)){var contactIds=contactIdsArr.join(",");new URI(ZContacts.ContactsCategories,ZContacts.getCurrentAccount().getAccountId(),contactIds,categoryId).POST(ZContacts.ContactsCategories.create({})).then(function(response){200==response.status_code?(zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(response)),new URI(ZContacts.Categories,ZContacts.getCurrentAccount().getAccountId(),categoryId).include("contacts.total_count").GET().then(function(json){var count=json.get("contacts_count");ZContacts._countObj[categoryId]||(ZContacts._countObj[categoryId]={c:count,p:ZContacts.AccountsVsRootFolderMap[ZContacts.getCurrentAccount().getAccountId()]});var category=zmcontact.getCategory(categoryId);zmcontact.updateCountInCategories(category,count,!1),categoryId==ZContacts._currentCategoryId&&zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId))})):zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}zmcontact.unChkAll()},deleteMultiContacts:function(contactIds){if(!$("#zcs_delete")[0]){if(""==contactIds)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.NO.CONTACTS"));var count=contactIds.length;if(1==count)return void zmcontact.deleteSingleContact(contactIds);var msg,rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId);rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS?msg=I18N.get("IAM.CONTACTS.SURE.DELETE.THESE"):rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?msg=I18N.get("IAM.CONTACTS.SURE.DELETE.CONTACTS.ORG"):rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS&&(msg=zmcontact.formatMessage(I18N.get("IAM.CONTACTS.SURE.DELETE.CONTACTS.GROUP"),ZContacts.getCurrentAccount().getName()));var html="<img style='float: left;left: 29px;top: 30px;' src='"+ZContacts.meta.serviceInfo.contacts_server_url+"/images/error.jpg' /><h4 style='float: left;width:90%; padding: 5px 0px 15px 5px;'>"+msg+"</h4>",txt=I18N.get(1==count?"IAM.CONTACTS.SINGLE.COUNT.DELETE":"IAM.CONTACTS.MULTIPLE.COUNT.DELETE");html+="<div class='SC_PUbtm'><span id='zcs_delete' class='sel' onclick='zmcontact.deleteContact(\""+contactIds.toString()+'", "'+ZContacts.getCurrentAccount().account_id+"\");zmcontact.unChkAll();zmcontact.removeDialog(this);' >"+zmcontact.formatMessage(txt,count)+"</span><span data-val='Cancel' onclick='zmcontact.removeDialog(this);'>"+I18N.get("IAM.CANCEL")+"</span></div>";{Dialog.new({title:"",$content:html,defaultCloseIcon:!0})}}$(".SC_PUtt").remove()},deleteSingleContact:function(contactId){var msg,zid,acc,rootFolderId,contact=zmsuite.getCenter()[0].$el.find("#"+contactId).get(0);contact=contact?contact.__zc_contact:staticObj[contactId];var name=encodeHTML(contact.getFullName().trim());if(zid=contact.get("zid"),acc=zmcontact.getAccountByZid(zid),rootFolderId=acc.getRootFolderId(),(!ZContacts._currentCategoryId||isNewSearchWorkSpace())&&(rootFolderId=acc.getRootFolderId(acc.getName)),rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS?msg=zmcontact.formatMessage(I18N.get("IAM.CONTACTS.CONFIRM.DELETE.SINGLE.CONTACT"),name):rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?msg=zmcontact.formatMessage(I18N.get("IAM.ERROR.SURE.RESETONE.CONTACTS.ORG"),name):rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS&&(msg=zmcontact.formatMessage(I18N.get("IAM.ERROR.SURE.RESETONE.CONTACTS.GROUP"),name,encodeHTML(ZContacts.getCurrentAccount().getName()))),!$("#zcs_delete")[0]){var html="<img style='float: left;left: 29px;top: 30px;' src='"+ZContacts.meta.serviceInfo.contacts_server_url+"/images/error.jpg' /><h4 style='float: left;width:90%; padding: 5px 0px 15px 5px;'>"+msg+"</h4>";html+="<div class='SC_PUbtm'><span id='zcs_delete' class='sel' onclick='zmcontact.deleteContact(\""+contactId.toString().split(",")+'", "'+acc.account_id+"\");zmcontact.removeDialog(this);' >"+I18N.get("IAM.DELETE")+"</span><span data-val='Cancel' onclick='zmcontact.removeDialog(this);'>"+I18N.get("IAM.CANCEL")+"</span></div>";{Dialog.new({title:"",$content:html,defaultCloseIcon:!0})}}$(".SC_PUtt").remove()},deleteAllContacts:function(zid){zmcontact._deleteContacts("reset",zid)},deleteContact:function(contactId,zid){contactId&&zmcontact._deleteContacts(contactId,zid)},_deleteContacts:function(param,accountId){currentAccount=zmcontact.getAccountByZid(accountId),delete ZContacts._accountAudit[accountId],currentAccount.isWritable&&new ZContacts.URI(ZContacts.Contacts,currentAccount.getAccountId(),param).DELETE().then(function(response){if(204==response.status_code){if(ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)try{"reset"==param?zmcontact.invokeEvent("contactsApp/refresh",{zid:acc.getAccountId()}):zmcontact.invokeEvent("contactsApp/deleted",{zid:currentAccount.getAccountId(),contact_ids:param.split(",")})}catch(e){}if(zmcontact.refreshContactCounts(),isNewSearchWorkSpace()){ZContacts._countSearchObj={},ZContacts._countSearchObj.category_name=I18N.get("IAM.CONTACTS.SEARCH.RESULTS"),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.DELETE.SUCCESS"));var searchEle=zmsuite.getCenter()[0].$el.find(".SC_conLft");param=param.split(",");var elem=$(searchEle.find("#"+param[param.length-1])[0]),nextElem=elem.next();zmcontact.updateHeaderBand(ZContacts._countSearchObj,0,!1),ZContacts.newSearchDeletedCount=ZContacts.newSearchDeletedCount+param.length,nextElem.length||(nextElem=$(searchEle.find(".zmL.SC_cont")[0])),nextElem.click(),zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),nextElem,elem),$.each(param,function(key,value){$(searchEle).find("#"+value).remove()}),0!=searchEle.children().length&&(ZContacts._countSearchObj.contacts_count=searchEle.children().length),ZContacts.newSearchDeletedCount>10&&ZContactsContext.getNextPage()}else if("reset"==param)zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId)),zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(response));else{zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.DELETE.SUCCESS")),param=param.split(",");for(var i=0;i<param.length;i++)delete ZContacts._audit[param[i]];var elem=$(zmsuite.getCenter()[0].$el.find("div[data-field-type=zcs-cnt-view]")[0]);if(isContactDetailWorkSpace()||isOldSearchWorkSpace()){var deletingElem=$(zmsuite.getCenter()[0].$el.find("#"+param[param.length-1])[0]);deletingElem.length&&(elem=deletingElem)}if(elem){var noOfRowsDelete,noOfRow;if(noOfRow=zmsuite.getCenter()[0].$el.find(".zmL.SC_cont"),noOfRowsDelete=isCleanWorkSpace()?1:param.length,noOfRow.length==noOfRowsDelete)isCleanWorkSpace()&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID),zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId));else{var nextElem;nextElem=$(elem).next().length?$(elem).next():$(zmsuite.getCenter()[0].$el.find(".zmL.SC_cont")[0]),zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),nextElem,elem),isContactDetailWorkSpace()||isOldSearchWorkSpace()?(isContactDetailWorkSpace()&&(ZContacts.deletedCount=ZContacts.deletedCount+param.length,ZContacts.deletedCount>10&&zmcontact.scrollDownContacts(!0)),$.each(param,function(key,value){$(zmsuite.getCenter()[0].$el.find("#"+value)[0]).remove()})):elem.remove(),$(nextElem).click()}}}}else 200==response.status_code?(ZContacts.meta.user.reset_scheduled=!0,zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(response))):zmUtil.succErrMsg("e",I18N.get("IAM.ERROR.GENERAL"))},function(response){$("#zcs_delete").parents(".SC_PU").find(".msi-close").click(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))})},getSelectedContactIds:function(elem){for(var contactIdsArr=[],i=0;i<elem.find(".zmL.SC_cont.SC_check").length;i++)contactIdsArr.push(elem.find(".zmL.SC_cont.SC_check")[i].id);return contactIdsArr},constructCenter:function(){var centerNodes=zcon.contactsCenter[0].getNodes();centerNodes[0].push(zmcontact.getActionMenuList()),centerNodes[0].setListener("click",function(event,iconName){zmcontact.bindHeaderIcons(event,iconName)}),centerNodes[2].setListener("click",function(event){zmcontact.bindEventsContactsRow(event)}),centerNodes[2].setListener("contextmenu",function(){}),zmsuite.renderCenter()},chkAll:function(elem){var centerNode=zmsuite.getCenter()[0].getNodes();if(!centerNode[2].$el.find(".zcs-contDup-row").length&&centerNode[2].$el.find(".zmL.SC_cont").length){centerNode[0].hideGroup("sort"),$(elem).hasClass("msi-uncheck")||(elem=$(elem).find(".msi-uncheck")),$(elem).attr("class","msi-check zcs-check"),centerNode[2].$el.find(".SC_conLft .zmL.SC_cont").addClass("SC_check"),centerNode[2].$el.find(".msi-uncheck").removeClass("msi-uncheck").addClass("msi-check");var selectedCount=centerNode[2].$el.find(".SC_check").length;isNewSearchWorkSpace()?zmcontact.updateHeaderBand(ZContacts._countSearchObj,selectedCount,!1):zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),selectedCount,!1),selectedCount&&(centerNode[0].showGroup("mail"),centerNode[0].showGroup("addto"),centerNode[0].showGroup("print")),ZContacts.getCurrentAccount().isWritable&&(selectedCount&&(centerNode[0].showGroup("delete"),zmcontact.isRootFolder()||centerNode[0].showGroup("clearcontacts")),selectedCount>1?centerNode[0].showGroup("merge"):centerNode[0].hideGroup("merge")),zmcontact.selectRestrictionBand()}},unChkAll:function(){var centerNode=zmsuite.getCenter()[0].getNodes();centerNode[0].$el.find(".msi-partcheck").removeClass().addClass("msi-uncheck zcs-check"),centerNode[0].$el.find(".msi-check").removeClass().addClass("msi-uncheck zcs-check"),centerNode[2].$el.find(".SC_check").removeClass("SC_check"),centerNode[2].$el.find(".msi-check").removeClass("msi-check").addClass("msi-uncheck"),isNewSearchWorkSpace()?zmcontact.updateHeaderBand(ZContacts._countSearchObj,0,!1):zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),0,!1),centerNode[0].hideGroup("delete"),centerNode[0].hideGroup("mail"),centerNode[0].hideGroup("addto"),centerNode[0].hideGroup("clearcontacts"),centerNode[0].hideGroup("merge"),ZContacts.getCurrentAccount().isWritable?centerNode[0].showGroup("addcontact"):centerNode[0].hideGroup("addcontact"),isNewSearchWorkSpace()&&(ZContacts.selectedCount=0),centerNode[0].hideGroup("print"),ZContacts._countObj[ZContacts._currentCategoryId]&&ZContacts._countObj[ZContacts._currentCategoryId].c>1&&!isSearchWorkSpace()?centerNode[0].showGroup("sort"):centerNode[0].hideGroup("sort"),zmcontact.selectRestrictionBand()},deletecategory:function(data){var category_id=data.category.category_id,account_id=zmcontact.getAccByCategoryId(zmcontact.getRootFolderId(category_id)).getAccountId(),rowObj={};rowObj[category_id]=data.category,zmsDialog.confirm(zmcontact.formatMessage(I18N.get("IAM.CONTACTS.ERROR.SURE.DLT.CATEGORY"),data.category.category_name),{onOk:function(){new URI(ZContacts.Categories,account_id,category_id).DELETE().then(function(){zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.DLTCATGRY.SUCCESS"));for(var rootFolderId=zmcontact.getRootFolderId(category_id),listObj=ZContacts._parentObj[rootFolderId],catArr=[],i=0;i<listObj.length;i++){var cat=listObj[i];cat.category_id!=category_id&&catArr.push(cat)}ZContacts._parentObj[rootFolderId]=[],ZContacts._parentObj[rootFolderId]=catArr,zmcontact.getCategoriesListLayer(rootFolderId).deleteNode(rowObj,rootFolderId),delete ZContacts._countObj[category_id],delete ZContacts._childObj[rootFolderId].CH[category_id],zmcontact.loadFirstPage(zmcontact.getCategory(rootFolderId))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}})},deleteAllCategories:function(account){zmsDialog.confirm(I18N.get("IAM.CONTACTS.ERROR.SURE.DLT.ALL.CATEGORY"),{onOk:function(){new URI(ZContacts.Categories,account.account_id).DELETE().then(function(json){zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(json));for(var rootFolderId=account.getRootFolderId(),categories=ZContacts._parentObj[rootFolderId],i=0;i<categories.length;i++)try{var rowObj={};rowObj[categories[i].category_id]=categories[i],delete ZContacts._countObj[categories[i].category_id],delete ZContacts._childObj[rootFolderId].CH[categories[i].category_id],zmcontact.getCategoriesListLayer(rootFolderId).deleteNode(rowObj,rootFolderId)}catch(e){}delete ZContacts._parentObj[rootFolderId],zmsuite.getCenter()[0].$el.find(".zmSLst").length>0&&zmcontact.loadContactDetails(zmsuite.getCenter()[0].$el.find(".zmSLst")[0].id)},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}})},getAccByCategoryId:function(categoryId){return categoryId=zmcontact.getRootFolderId(categoryId),ZContacts.AccountsVsRootFolderMap[categoryId]},bindEventsContactsRow:function(evt){var clsNme,$listRow,contact,tEle=evt.target||$tEle;$tEle=$(tEle),clsNme=$tEle.attr("class")||"",$listRow=$(tEle).closest(".zmL"),$(evt.target).hasClass("SC_cont")||($tEle=$(evt.target).parents(".SC_cont")),$tEle.length&&!$tEle.hasClass("zmSLst")&&($(".SC_cont.zmSLst").removeClass("zmSLst"),$tEle.addClass("zmSLst"),$listRow.length>0&&(contact=$listRow.get(0).__zc_contact,zmcontact.loadContactDetails(contact.get("contact_id"),contact.get("zid"))))},zconImportDetails:function(){var zid=ZContacts.getCurrentAccount().getAccountId();new URI(ZContacts.SyncDetails,zid).GET().then(function(details){if(delete ZContacts._accountAudit[zid],ZContacts._sync=details.contacts.syncEnable,1==ZContacts._sync){ZContacts._authenticatedMailId=details.contacts.authenticatedMailId;var date=new Date(parseInt(details.contacts.lastSyncedTime));ZContacts._syncedTime=date.toLocaleDateString()+","+date.toLocaleTimeString(),ZContacts._enableStatus=details.contacts.enableDisableStatus}zmcontact.zconImport()},function(){})},zconImport:function(){if(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.IMPORT_APP_ID)){zmUtil.hideMenu(),$("#impcont").replaceWith($("#impcont").val("").clone(!0));var contactImport=new ZContacts.contactimport;return contactImport.createPageContent(getHtmlForImport()),void zmsuite.showWorkSpace(ZContacts.ZMailConstants.IMPORT_APP_ID)}var importTabObj={appname:I18N.get("IAM.CONTACTS.IMPORT.CONTACTS"),appId:ZContacts.ZMailConstants.IMPORT_APP_ID,appIcon:"msi-edit",searchPlaceHolder:I18N.get("IAM.CONTACTS.SEARCH.CONTACTS"),data:{CNodes:"3"}};zmsuite.setWorkSpace(importTabObj),zmsuite.showWorkSpace(ZContacts.ZMailConstants.IMPORT_APP_ID);var workspaceCenter=zmsuite.getCenter(ZContacts.ZMailConstants.IMPORT_APP_ID),centerNodes=workspaceCenter[0].getNodes();centerNodes[0].push([]);var headerObj={left:{leftHTML:I18N.get("IAM.CONTACTS.IMPORT.CONTACTS")},right:[]};centerNodes[1].push(headerObj);var headericon={left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};centerNodes[0].push(headericon),centerNodes[0].setListener("click",function(ev,iconName){"msi-close"==iconName&&(zmsuite.closeWorkspace(ZContacts.ZMailConstants.IMPORT_APP_ID),$(zcon.contactsCenter.listElem).find(".SC_conLft").children()[0].click(),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)))});var listingCenter=centerNodes[2],$containerDiv=$("<div>").addClass("SC_import"),contactImport=new ZContacts.contactimport;ZContacts.contactimport.$containerElem=$containerDiv,contactImport.createPageContent(getHtmlForImport()),listingCenter.$el.append($containerDiv),listingCenter.$el.addClass("zcs-import-form"),zmsuite.renderWorkSpace()},contactsList:function(contacts,isNextPage,isCleanDupes){1==ZContacts.isRemoved?ZContacts.isRemoved=!1:void 0!=ZContacts._filterList&&ZContacts._filterList.length>0&&0==ZContacts._filterList.includes("SearchTypeFilter")&&(zmail.Search.addToSearch({className:"SearchTypeFilter",value:"contains"},{silent:!0,avoidDependencyLoad:!1}),ZContacts._filterList.push("SearchTypeFilter")),zcon.contactsCenter=zmsuite.getCenter();var menuNode,listElem=zmsuite.getCenter()[0].getNodes()[2].$el[0];zcon.contactsCenter.listElem=listElem;var cntElem=$(zmcontact.constructContactsRow(contacts,isCleanDupes));if(isContactDetailWorkSpace()?menuNode=zmsuite.getWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID)[0]:(isCleanWorkSpace()||isSearchWorkSpace())&&(removeSearchAutoList(!0),menuNode=zmsuite.getCenter()[0].getNodes()[0]),!(isSearchWorkSpace()||contacts&&contacts.length)){var html=new ZContacts.StringBuilder,rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId);return html.append('<div class="zsc_nmsg zmNightMode" style="padding: 10px;font-size: 15px;line-height: 48px;font-family: inherit;">'+I18N.get("IAM.CONTACTS.NO.CONTACT.ADDED.YET")+"</div>"),ZContacts.getCurrentAccount().isWritable&&rootFolderId==ZContacts._currentCategoryId&&(html.append('<div class="zsc_nmsg zmNightMode" style="line-height: 35px;font-family: inherit;font-size: 15px;">'+I18N.get("IAM.CONTACTS.ADD.NEW.CONTACT.HOME.PAGE")+"</div>"),html.append('<div class="SC_PUbtm zsc_nmsg" style="padding:25px"><span class="sel" onclick="zmcontact.zconImportDetails();">'+I18N.get("IAM.CONTACTS.IMPORT.CONTACTS")+"</span></div>"),html.append('<div class="SC_PUbtm"><span class="sel" id="zcs_add_plus" onclick="zmcontact.showQuickCreate()"><div class="zcs_css_plus"></div></span></div>')),void $(zcon.contactsCenter.listElem).html(html.toString())}if(isCleanDupes){zmcontact.unChkAll();var div="<div class='SC_conLft' id='zcs_conLft'></div><div class='SC_conRgt' id='zcs_conRgt'><div class='zcs-cont-details'></div><div class='zcs-cont-edit zcs-editor-form'></div></div>";return $(listElem).html(div),$(listElem).find(".SC_conLft").html(cntElem),void $(listElem).find(".SC_conLft").children()[0].click()}if(isNextPage)contacts&&contacts.length>0&&(isNewSearchWorkSpace()?($(listElem).find(".SC_conLft").append(cntElem),$(listElem).find(".SC_conLft").children()[0].click()):(menuNode.$el.find(".SCmb").find(".msi-check").length&&menuNode.$el.find(".SCmb").find(".msi-check").removeClass().addClass("msi-uncheck msi-partcheck zcs-check"),$(listElem).find(".SC_conLft").append(cntElem)));else if(isSearchWorkSpace()){if(menuNode.push(zmcontact.getActionMenuList()),menuNode.setListener("click",function(event,iconName){zmcontact.bindHeaderIcons(event,iconName)}),zmsuite.renderCenter(),zmcontact.unChkAll(),!(contacts&&contacts.length>0))return void $(listElem).html('<div class="SC_nmsg zcs_SC_nmsg">'+I18N.get("IAM.CONTACTS.NO.CONTACTS")+"</div>");var div="<div class='SC_conLft'></div><div class='SC_conRgt' id='zcs_srch'><div class='zcs-cont-details'></div><div class='zcs-cont-edit zcs-editor-form'></div></div>";$(listElem).html(div),$(listElem).find(".SC_conLft").html(cntElem),$(listElem).find(".SC_conLft").children()[0].click()}else isPrintWorkSpace()?zmcontact.addContactsToPrint(contacts,cntElem):zmTab.currentTab==ZContacts.ZMailConstants.IMPORT_APP_ID?$(listElem).find(".SC_conLft").html(cntElem):($(listElem).find(".SC_conLft").html(cntElem),$(listElem).find(".SC_conLft").children()[0].click());$("#ms_load").remove(),$(zcon.contactsCenter.listElem).children(".SC_conLft").unbind("scroll").bind("scroll",function(){zmUtil.hideMenu(),isCleanDupes||zmcontact.scrollDownContacts()})},showQuickCreate:function(elem){if(!ZContacts.getCurrentAccount().isWritable)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.WRITE.OPERATION.NOT.ALLOWED"));if(zmApp.currentApp!=ZContacts.ZMailConstants.CONTACTS_TAB){var acc=zmcontact.getAccountByZid(zmail.zuid);if(acc.getCount()>=acc.getLimit())return void zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.MAX.CTS.LIMIT.EXCEEDED"),acc.getLimit()));zmcontact.utilQuickCreate(elem)}else{var rootFolderId=ZContacts.getCurrentAccount().getRootFolderId();if(ZContacts._countObj[rootFolderId].c&&ZContacts._countObj[rootFolderId].c>=ZContacts.getCurrentAccount().getLimit())return void zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.MAX.CTS.LIMIT.EXCEEDED"),ZContacts.getCurrentAccount().getLimit()));zmcontact.utilQuickCreate(elem)}},utilQuickCreate:function(){var posElem=$(".zm_compose"),posOffset=posElem.offset(),posTop=posOffset.top+"px",posLeft=posOffset.left+posElem.width()+"px";if(zmsuite.isWorkspaceAvailable("zm_createContact"))return void zmsuite.showWorkSpace("zm_createContact");var contactEditor=new ZContacts.ContactEditor(!0),editorActions={save:function(t){var contact=contactEditor.toContactsModel(ZContacts.Contacts.create());if(zmsuite.isWorkspaceAvailable("zm_createContact")&&!ZContacts.getCurrentAccount().isWritable)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.WRITE.OPERATION.NOT.ALLOWED"));if(contact){var elem;elem=t?$(t.currentTarget.parentElement):this.$e.find(".SC_PUbtm"),zmcontact.restrictClick(elem,!0);var container,type;$("#zcs_loading").length||(contactEditor.quickCreate?($("#zmsdialog_zc_contactpopup").prepend("<div id='zcs_loading' style='padding-bottom: 10px;' ></div>"),type="listing"):(zmsuite.getCenter()[0].$el.prepend("<div id='zcs_loading' style='padding-bottom: 10px;'></div>"),type="listing")),container=$("#zcs_loading").get(0);var destroyLoadingDiv=zmComponent.loadingBand({container:container,type:type});new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).addPostParam("source","manual").POST(contact).then(function(json){if($(".SC_PUbtm").removeAttr("disabled"),destroyLoadingDiv(),contactEditor.quickCreate?zmsDialog.remove():zmsuite.showWorkSpace("zm_Contacts"),201==json.status_code){zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.ADDED.SUCCESS"));try{(ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&(contact.contact_id=json.contacts.contact_id,zmcontact.invokeEvent("contactsApp/added",{zid:ZContacts.getCurrentAccount().getAccountId(),contact:contact}))}catch(e){}if(zmApp.currentApp==ZContacts.ZMailConstants.CONTACTS_TAB){zmcontact.constructCenter();var currentCategory=zmcontact.getCategory(ZContacts._currentCategoryId);if(zmcontact.isRootFolder())zmcontact.updateCountInCategories(currentCategory,1,!0),zmcontact.loadFirstPage(currentCategory);else{var contactIdsArr=[];contactIdsArr.push(json.contacts.contact_id),zmcontact.addContactsToCategory(contactIdsArr,ZContacts._currentCategoryId);var rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId),rootFolderCategory=zmcontact.getCategory(rootFolderId);zmcontact.updateCountInCategories(rootFolderCategory,1,!0)}}printResponse={}}contactEditor.quickCreate||zmsuite.closeWorkspace(ZContacts.ZMailConstants.WORKSPACE_APP_ID)},function(json){if($(".SC_PUbtm").removeAttr("disabled"),destroyLoadingDiv(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json)),"409"==json.status_code){var contactId=json.errors[0].params.contact_id,currentAccountId=ZContacts.getCurrentAccount().getAccountId(),html="<h4 style='float: left;width:90%; padding: 5px 0px 15px 5px;'>"+I18N.get("IAM.CONTACTS.EDIT.EXISTING.CONTACT")+"</h4>";html+="<div class='SC_PUbtm'><span id='zcs_delete' class='sel' onclick='zmcontact.editPageConfirm(\""+contactId+'", "'+currentAccountId+"\");zmcontact.removeDialog(this);' >"+I18N.get("IAM.CONTACTS.EDIT")+"</span><span data-val='Cancel' onclick='zmcontact.removeDialog(this);'>"+I18N.get("IAM.CANCEL")+"</span></div>";{Dialog.new({title:"",$content:html,defaultCloseIcon:!0})}}})}},cancel:function(){$(".SC_PUbtm").removeAttr("disabled"),contactEditor.quickCreate?zmsDialog.remove():zmsuite.closeWorkspace("zm_createContact")}};contactEditor.setOptions({actions:editorActions});var tit=I18N.get("IAM.CONTACTS.ADD.CONTACT")+" - ("+encodeHTML(ZContacts.getCurrentAccount().getName())+")",popOpt={title:tit,posParent:{top:posTop,left:posLeft},buttons:[{txt:I18N.get("IAM.SAVE"),selected:!0,callback:editorActions.save},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:editorActions.cancel}],afterDisplay:function(){$("#zc_contactpopup").find('[data-field-type="first_name"]')[0].focus()}};$("#zc_contactpopup").remove(),$(document.body).append('<div id="zc_contactpopup"></div>'),zmsDialog.create("zc_contactpopup",popOpt),contactEditor.render($("#zc_contactpopup")),$("#zmsdialog_zc_contactpopup").mousedown(function(ev){zmUtil.stopEvents(ev,!0)}),$("#zmsdialog_zc_contactpopup").off("keypress").on("keypress",function(e){13!=e.which||e.shiftKey||$(this).find(".sel")[0].click()})},editPageConfirm:function(contactId,currentAccountId){zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.WORKSPACE_APP_ID)?zmsuite.closeWorkspace("zm_createContact"):zmsDialog.remove(),new URI(ZContacts.Contacts,currentAccountId,contactId).include("emails").include("phones").include("ims").include("address").include("urls").include("categories").GET().then(function(contact){zmcontact.showEditPage(contact)})},invokeEvent:function(key,obj){$.publish(key,obj)},scrollDownContacts:function(forceScroll){var listElem=$(zmsuite.getCenter()[0].getNodes()[2].$el[0]).find(".SC_conLft"),PAGINATE_SCROLL_PERCENT=98,currentScrollPercent=Math.round(100*(listElem[0].scrollTop+listElem.height())/listElem[0].scrollHeight),isNextPageLoading=isSearchWorkSpace()?ZContacts.isSearchLoading:listingMetaData.isLoading;if(forceScroll||currentScrollPercent>=PAGINATE_SCROLL_PERCENT&&!isNextPageLoading)if(isNewSearchWorkSpace())ZContactsContext.getNextPage();else if(isOldSearchWorkSpace()){var searchRequest=new zmContactsSearch.contactsCollection;searchRequest.hasNextPage(searchRequest)}else zmcontact.loadNextPage(zmcontact.getCategory(ZContacts._currentCategoryId))},constructContactsRow:function(contacts,isCleanDupes){for(var fragment=document.createDocumentFragment(),i=0;i<contacts.length;i++){var contact=contacts[i];fragment.appendChild(zmcontact.getContactRowElement(contact,isCleanDupes).get(0))}return fragment},setAccountPhoto:function(t,contactId){if(doAllowClick($(t))){var contact=zmsuite.getCenter()[0].$el.find("#"+contactId).get(0);contact=contact?contact.__zc_contact:staticObj[contactId],zmcontact.restrictClick($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm").children("span"),!0),zmcontact.restrictClick($(t),!0),zmcontact.uploadPhoto(contact,!1)}},setPhotoPath:function(value){value&&""!=value?(value.length>20&&(value=value.substring(0,17)+"..."),$("#zcs_choose_desktop").html(value)):$("#zcs_choose_desktop").html(I18N.get("IAM.CONTACTS.CHOOSE.FROM.DESKTOP"))},uploadPhoto:function(contact,isUpload){var photo=ZContacts.Photo.create(),zid=contact.get("zid"),contact_id=contact.get("contact_id");isUpload&&photo.set("__form","#zcs_uploadPopup"),$("#zcs_uploadPopup").parents("#zmsdialog_zcs_uploadPopup").prepend("<div id='uploadLoading' style='margin-bottom: 5%;' ></div>");var destroyLoadingDiv=zmComponent.loadingBand({container:$("#uploadLoading").get(0),type:"listing"});new URI(ZContacts.Photo,zid,contact_id).POST(photo).then(function(json){if(zmcontact.restrictClick($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),200==json.status_code){zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(json)),delete ZContacts._audit[json.photo.contact_id];var date=new Date,photo_url=zmcontact.getJsStdUrl(json.photo.photo_url)+"&nocache="+date.getTime();zmsuite.getCenter()[0].$el.find("#"+json.photo.contact_id).find("img").attr("src",photo_url),$("#"+json.photo.contact_id).find("img").attr("src",photo_url),zmsuite.getCenter()[0].$el.find("#"+json.photo.contact_id+"_img").attr("src",photo_url),$("#"+json.photo.contact_id+"_img").attr("src",photo_url),contact.photo_url=photo_url,zmsuite.getCenter()[0].$el.find("#"+json.photo.contact_id).get(0).__zc_contact&&(zmsuite.getCenter()[0].$el.find("#"+json.photo.contact_id).get(0).__zc_contact.set("photo_url",photo_url),$("#"+json.photo.contact_id).get(0).__zc_contact.set("photo_url",photo_url),contact=$("#"+json.photo.contact_id).get(0).__zc_contact),zmsDialog.remove(),$("#zcs_uploadPopup").remove();try{(ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&zmcontact.invokeEvent("contactsApp/updated",{zid:zid,contact:contact})}catch(e){}}else zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))},function(json){zmcontact.restrictClick($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm").children("span"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),$("#cnt-photo").val(""),zmcontact.setPhotoPath("")},openUploadPopup:function(contact){if(!contact.is_writable)return!1;var ct=contact,contact_id=contact.contact_id,contact_zuid=contact.contact_zuid,contact_name=contact.getFullName(),zid=contact.get("zid");createFolElem=$("<form id='zcs_uploadPopup'></div>");var tags=new ZContacts.StringBuilder;tags.append('<div class="SC_tdtl" style="width: 450px">'),tags.append('<div class="SC_tiput" id="'+contact_id+'" style="float: left; width: 150px;height: auto; background-color: #fcfcfc;cursor: pointer;padding-top: 0%;padding-left: 0%;padding-right: 0%;padding-bottom: 0%;">'),tags.append('<input style="left: 30px;top: 66px;width: 33%;position: absolute;cursor: pointer;height: 31px;opacity: 0;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;" id="cnt-photo" name="photo" onchange="zmcontact.setPhotoPath(this.files[0].name);" type="file" />'),tags.append('<div id="zcs_choose_desktop" style="font-size: 12px;color: #878787;max-width:100%;cursor: pointer;height: 97%;text-align : center;line-height: 30px;white-space: nowrap;overflow: hidden;padding-left: 5px;">'+I18N.get("IAM.CONTACTS.CHOOSE.FROM.DESKTOP")+"</div></div>"),-1!=contact_zuid&&(tags.append('<div style="text-align: center;float: left;margin-left: 10px;margin-right: 10px;margin-top: 5px;color: #878787;font-size: 12px;line-height: 20px;">'+I18N.get("OR")+"</div>"),tags.append('<div class="SC_tiput" style="padding-bottom: 0%;padding-right: 3%;float: left;width: auto;max-width: 300px;margin: auto;height: auto;font-size: 12px;color: #878787;background-color: #fcfcfc;cursor: pointer;" id="zcs_user_photo" onclick="zmcontact.setAccountPhoto(this, \''+contact_id+"');\">"),tags.append('<div style="float: left;margin-top: -2px;margin-left: -2px;"><img style="height: 25px;width: 25px;border-radius: 100%;" src="'+ZContacts.meta.serviceInfo.contacts_server_url+"/file?ID="+contact_zuid+'" /></div>'),tags.append('<span style="margin-left: 10px;line-height: 20px;">'+I18N.get("IAM.CONTACTS.KEEP.USER.PHOTO")+"</span>"),tags.append("</div>")),tags.append("</div>"),tags.append('<div style="clear: both;padding-top: 20px;">'),tags.append('<li style="font-size: 13px;color: #999;padding-bottom: 5px;">'+I18N.get("IAM.NOTE")+":</li>"),tags.append('<li style="font-size: 11px;color: #878787">'+I18N.get("IAM.UPLOAD.NOTE1")+"</li>"),tags.append('<li style="font-size: 11px;color: #878787">'+zmcontact.formatMessage(I18N.get("IAM.UPLOAD.NOTE2"),3e3)+"</li>"),tags.append('<li style="font-size: 11px;color: #878787">'+I18N.get("IAM.UPLOAD.NOTE3")+"</li>"),tags.append("</div>"),tags.append("</form>"),createFolElem.append(tags.toString()),$(document.body).append(createFolElem);var uploadDiv={};uploadDiv.title=zmcontact.formatMessage(I18N.get("IAM.CONTACTS.UPLOAD.TITLE"),contact_name),uploadDiv.mask=!0,uploadDiv.buttons=[{txt:I18N.get("IAM.UPLOAD"),selected:!0,callback:function(data){var button=$(data.toElement);if(doAllowClick(button)){var elem=$("#cnt-photo"),file=elem.val();if(""==file)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.PLEASE.CHOOSE.PHOTO"));if(!/\.(jpe?g|png|gif|bmp)$/i.test(file))return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.INVALID.PHOTO"));zmcontact.restrictClick($("#zcs_user_photo"),!0),zmcontact.restrictClick(button.parent().children("span"),!0),zmcontact.uploadPhoto(contact,!0)}}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(data){var button=$(data.toElement);doAllowClick(button)&&(zmsDialog.remove(),$("#zcs_uploadPopup").remove())}},{isCancel:!0,txt:I18N.get("IAM.CONTACTS.RESET.TO.DEFAULT"),callback:function(data){var button=$(data.toElement);if(doAllowClick(button)){zmcontact.restrictClick($("#zcs_user_photo"),!0),zmcontact.restrictClick(button.parent().children("span"),!0);var elem=$("#cnt-photo"),contact_id=elem.parent().attr("id");$("#zcs_uploadPopup").parents("#zmsdialog_zcs_uploadPopup").prepend("<div id='uploadLoading' style='margin-bottom: 5%;' ></div>");var destroyLoadingDiv=zmComponent.loadingBand({container:$("#uploadLoading").get(0),type:"listing"});new URI(ZContacts.Photo,zid,contact_id).DELETE().then(function(json){if(zmcontact.restrictClick(button.parent().children("span"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),204==json.status_code){delete ZContacts._audit[json.photo.contact_id],zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.PHOTO.RESET.SUCCESS"));var date=new Date,photo_url=zmcontact.getJsStdUrl(json.photo.photo_url)+"&nocache="+date.getTime();$("#"+json.photo.contact_id).find("img").attr("src",photo_url),$("#"+json.photo.contact_id+"_img").attr("src",photo_url);var contact=ct;contact.photo_url=photo_url,$("#"+json.photo.contact_id).get(0).__zc_contact&&($("#"+json.photo.contact_id).get(0).__zc_contact.set("photo_url",photo_url),contact=$("#"+json.photo.contact_id).get(0).__zc_contact);try{if(ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.ORG_ACCOUNT){var contact=$("#"+json.photo.contact_id).get(0).__zc_contact;zmcontact.invokeEvent("contactsApp/updated",{zid:zid,contact:contact})}}catch(e){}zmsDialog.remove(),$("#zcs_uploadPopup").remove()}else zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))},function(json){zmcontact.restrictClick(button.parent().children("span"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}}}],uploadDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_uploadPopup").remove()},uploadDiv.pos="center",zmsDialog.create("zcs_uploadPopup",uploadDiv),$("#zcs_uploadPopup").ready(function(){$($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm").children("span")[2]).css("float","right")}),$("#zcs_uploadPopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_uploadPopup").parents(".SC_Pop").on("click",function(){this.remove()})},loadContactDetails:function(contactId,zid){$("div[data-field-type=zcs-cnt-view]:not(:has(.zcs-contDup-row))").attr("data-field-type",""),zmsuite.getCenter()[0].$el.find("#"+contactId).attr("data-field-type","zcs-cnt-view");getCurrentSearchTab(zmTab.currentTab);if(!isNewSearchWorkSpace()){var $detailsContainer=zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs-cont-details");$detailsContainer.html("");var destroyLoadingDiv=zmComponent.loadingBand({container:$detailsContainer.get(0),type:"pagination"})}void 0==zid&&(zid=ZContacts.getCurrentAccount().getAccountId()),new URI(ZContacts.Contacts,zid,contactId.toString()).include("emails").include("phones").include("ims").include("address").include("urls").include("categories").GET().then(function(contact){getCurrentSearchTab(zmTab.currentTab);isNewSearchWorkSpace()||destroyLoadingDiv(),zmcontact.renderContactDetails(contact),isCleanWorkSpace()||zmcontact.switchDetailsPage(!0)})},renderContactDetails:function(contact){{var contact_id=contact.get("contact_id");encodeHTML(contact.getFullName())}if(void 0==contact.is_writable){var cont=zmsuite.getCenter()[0].$el.find("#"+contact_id).get(0).__zc_contact;contact.is_writable=cont.is_writable}var photo_url=(contact.get("contact_zuid"),zmcontact.getJsStdUrl(contact.get("photo_url"))),pattern=/nocache=[-0-9]+&?/i,updatedTime=void 0==contact.get("updated_time")?(new Date).getTime():contact.get("updated_time");photo_url=photo_url.replace(photo_url.match(pattern),"")+"&nocache="+updatedTime,contact.set("photo_url",photo_url);var contacts_details=new ZContacts.StringBuilder;contacts_details.append("<div>"),contacts_details.append('<div style="float:left; padding:20px;"><div class="zcs-left" style="height: 143px";>'),contacts_details.append('<div class="zcs-left" id="zcs-photo">'),contacts_details.append('<img id="'+contact_id+'_img" style="position: absolute;" src=').append(photo_url).append(' width="98" height="98" class="zcs-thumnail">'),contact.is_writable&&contacts_details.append('<div id="zcs-change-photo" width="98" height="98" style="display: none;position: absolute; color: #fff; font-weight: bold; background: rgba(0,0,0,0.6); border-radius: 100%; top: 21px; left: 21px; height: 98px;width: 98px;text-align: center; font-size: 10px;text-transform: uppercase;line-height: 96px;">'+I18N.get("IAM.TITLE.CHANGE")+"</div>"),contacts_details.append("</div>"),contacts_details.append('<div style="margin-left: 125px;" class="zcs-name-info">');var nickName=encodeHTML(contact.get("nick_name"));contacts_details.append('<div class="zcs-title">').append(encodeHTML(contact.getFullName().trim())).append(nickName?" ("+nickName+")":"").append("</div>"),contact.getPrimaryEmail()&&contacts_details.append("<div onclick=\"zmcontact.sendMail('"+contact.getPrimaryEmail()+'\')" class="zcs-title-mail" style="cursor: pointer">').append(encodeHTML(contact.getPrimaryEmail())).append("</div>");var workAddress=null,homeAddr=null;if(contact.address)for(var i=0;i<contact.address.length;i++){var addr=contact.address[i];"home"===addr.get("type")?homeAddr=addr:"work"===addr.get("type")&&(workAddress=addr)}(contact.job_title||contact.designation)&&(contacts_details.append('<div style="font-size: 11px;color:#9c999c;">'),contact.job_title&&(contacts_details.append(encodeHTML(contact.job_title)),contact.designation&&contacts_details.append(", ")),contact.designation&&contacts_details.append(encodeHTML(contact.designation)).append("<br>"),contacts_details.append("</div>")),contact.company&&(contacts_details.append('<div style="font-size: 11px;color:#9c999c;">'),contacts_details.append(encodeHTML(contact.company)),contacts_details.append("</div>"));var contactId=contact.get("contact_id"),zid=(encodeHTML(contact.first_name),contact.get("zid"));if(contacts_details.append('<div class="zcs-title-edit">'),contact.is_writable&&contacts_details.append('<a href="javascript:;" id="zcs-ac-editcont">').append(I18N.get("IAM.CONTACTS.EDIT.CONTACT")).append('</a> | <a href="javascript:;" onclick="zmcontact.deleteSingleContact(\''+contactId+"')\">").append(I18N.get("IAM.DELETE")).append('</a> | <a href="javascript:;" onclick="zmcontact.contactsAuditPopUp(\''+contactId+"','"+zid+"')\">").append(I18N.get("IAM.AUDIT.HISTORY")).append("</a> | "),contacts_details.append('<a href="javascript:;" id="zcs-print">').append(I18N.get("IAM.PRINT")).append("</a></div>"),contacts_details.append("</div>"),contacts_details.append("</div>"),contact.emails&&contact.emails.length||contact.get("categories")&&contact.get("categories").length){if(contacts_details.append('<div class="zcs-space" style="height:1px"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.GENERAL")).append("</div>"),contacts_details.append("<div>"),contact.emails&&contact.emails.length){contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.EMAIL.IDS")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');var primaryEmail=encodeHTML(contact.getPrimaryEmail());contacts_details.append('<a style="cursor: pointer" onclick="zmcontact.sendMail(\''+primaryEmail+"')\"").append(">").append(primaryEmail).append("</a>");for(var i=0;i<contact.emails.length;i++){var emailId=encodeHTML(contact.emails[i].email_id);emailId!=primaryEmail&&contacts_details.append('<br><a style="cursor: pointer" onclick="zmcontact.sendMail(\''+emailId+"')\"").append(">").append(emailId).append("</a>")}contacts_details.append("</div></div>")}if(contact.get("categories")&&contact.get("categories").length){contacts_details.append('<div style="clear:both;" class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.CATEGORIES")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');for(var i=0;i<contact.get("categories").length;i++){var category=encodeHTML(contact.get("categories")[i]);i>0&&contacts_details.append("<br>"),category=category.split(",");var html="<span style='cursor: pointer;text-decoration: underline;color: #337fe5;' onclick='zmcontact.loadCategoryContacts(\""+encodeHTML(category[0])+"\")'>"+category[1]+"</span>";contacts_details.append(html)}contacts_details.append("</div></div>")}contacts_details.append("</div>")}if(contact.phones){contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.BASIC.PHONE")).append("</div>"),contacts_details.append("<div>");for(var i=0;i<contact.phones.length;i++){var type=encodeHTML(contact.phones[i].type),number=encodeHTML(contact.phones[i].number);contacts_details.append('<div class="zcs-top" style="clear:both;">'),"mobile"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.MOBILE")),"home"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.HOME")),"work"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.WORK")),"fax"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.FAX")),"others"==type&&(type=I18N.get("IAM.CONTACTS.OTHERS")),contacts_details.append('<div  class="zcs-contacts-info">').append(type).append(": </div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(number),contacts_details.append("</div>"),contacts_details.append("</div>")}}if(contact.ims&&contact.ims.length){contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.IM.FULL")).append("</div>"),contacts_details.append("<div>");for(var i=0;i<contact.ims.length;i++){contacts_details.append('<div class="zcs-top" style="clear:both;">');var type=contact.ims[i].type;"google"==type&&(type=I18N.get("IAM.CONTACTS.IM.GOOGLE")),"yahoo"==type&&(type=I18N.get("IAM.CONTACTS.IM.YAHOO")),"skype"==type&&(type=I18N.get("IAM.CONTACTS.IM.SKYPE")),"aol"==type&&(type=I18N.get("IAM.CONTACTS.IM.AOL")),"icq"==type&&(type=I18N.get("IAM.CONTACTS.IM.ICQ")),"msn"==type&&(type=I18N.get("IAM.CONTACTS.IM.MSN")),"jabber"==type&&(type=I18N.get("IAM.CONTACTS.IM.JABBER")),"others"==type&&(type=I18N.get("IAM.CONTACTS.OTHERS")),contacts_details.append('<div  class="zcs-contacts-info">').append(type).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(encodeHTML(contact.ims[i].address)),contacts_details.append("</div>"),contacts_details.append("</div>")}contacts_details.append("</div>")}if(homeAddr&&!homeAddr.isEmpty()&&(contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.OTHERS.HADDRESS")).append("</div>"),contacts_details.append("<div>"),homeAddr&&!homeAddr.isEmpty())){var address="";homeAddr.street_addr&&(address+=encodeHTML(homeAddr.street_addr)+", "),homeAddr.street_addr1&&(address=address+encodeHTML(homeAddr.street_addr1)+",<br>"),homeAddr.city&&(address=address+encodeHTML(homeAddr.city)+", "),homeAddr.state&&(address=address+encodeHTML(homeAddr.state)+",<br>"),homeAddr.country&&(address=address+encodeHTML(homeAddr.country)+", "),homeAddr.postal_code&&(address+=encodeHTML(homeAddr.postal_code)),address&&(","==address.substr("-1")&&(address=address.substring(0,address.length-1)),contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.WORK.ADDRESS")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(address),contacts_details.append("</div>"),contacts_details.append("</div>"))}if(workAddress&&!workAddress.isEmpty()&&(contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.EXPORT.WORK.ADDRESS")).append("</div>"),contacts_details.append("<div>"),workAddress&&!workAddress.isEmpty())){var address="";workAddress.street_addr&&(address+=encodeHTML(workAddress.street_addr)+", "),workAddress.street_addr1&&(address=address+encodeHTML(workAddress.street_addr1)+",<br>"),workAddress.city&&(address=address+encodeHTML(workAddress.city)+", "),workAddress.state&&(address=address+encodeHTML(workAddress.state)+",<br>"),workAddress.country&&(address=address+encodeHTML(workAddress.country)+", "),workAddress.postal_code&&(address=address+encodeHTML(workAddress.postal_code)+"<br>"),address&&(","==address.substr("-1")&&(address=address.substring(0,address.length-1)),contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.WORK.ADDRESS")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(address),contacts_details.append("</div>"),contacts_details.append("</div>"))}if(contact.gender||contact.notes||contact.birth_day){if(contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.PERSONAL")).append("</div>"),contacts_details.append("<div>"),contact.gender&&(contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.GENDER")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append("M"===contact.gender?I18N.get("IAM.CONTACTS.GENDER.MALE"):I18N.get("IAM.CONTACTS.GENDER.FEMALE")),contacts_details.append("</div>"),contacts_details.append("</div>")),contact.birth_day){contacts_details.append('<div class="zcs-top" style="clear:both;">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.BASIC.BDAY")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');var bday="";contact.birth_day&&(bday=bday+contact.birth_day+"-"),contact.birth_month&&(bday+=contact.birth_month),contact.birth_year&&(bday=bday+"-"+contact.birth_year),contacts_details.append(encodeHTML(bday)),contacts_details.append("</div>"),contacts_details.append("</div>")}contact.notes&&(contacts_details.append('<div class="zcs-top" style="clear:both;">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.NOTES")).append(":</div>"),contacts_details.append('<div style="white-space: pre-wrap;width: 1700px;max-width: 50%;word-wrap: break-word;white-space: -moz-pre-wrap;" class="zcs-contacts-info-right">'),contacts_details.append(encodeHTML(contact.notes)),contacts_details.append("</div>"),contacts_details.append("</div>"))}if(contact.urls&&contact.urls.length){contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.URLS")).append("</div>"),contacts_details.append("<div>");for(var type,i=0;i<contact.urls.length;i++){contacts_details.append('<div style="clear:both;" class="zcs-top">'),type=encodeHTML(contact.urls[i].type),type=I18N.get("home"==type?"IAM.CONTACTS.EXPORT.PERSONALWEB.ADDRESS":"work"==type?"IAM.CONTACTS.EXPORT.COMPANYWEB.ADDRESS":"blog"==type?"IAM.CONTACTS.BLOG.URL":"linkedin"==type?"IAM.CONTACTS.LINKEDIN.URL":"facebook"==type?"IAM.CONTACTS.FACEBOOK.URL":"twitter"==type?"IAM.CONTACTS.TWITTER.URL":"amazon"==type?"IAM.CONTACTS.AMAZON.URL":"flickr"==type?"IAM.CONTACTS.FLICKR.URL":"delicious"==type?"IAM.CONTACTS.DELICIOUS.URL":"IAM.CONTACTS.OTHERS"),contacts_details.append('<div  class="zcs-contacts-info">').append(type).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');var readUrl=encodeHTML(contact.urls[i].url),textElm=$('<a target="_blank">'+readUrl+"</a>");0!=readUrl.indexOf("http:")&&0!=readUrl.indexOf("https:")&&(readUrl="//"+readUrl),textElm.attr("href",readUrl),contacts_details.append(textElm[0].outerHTML),contacts_details.append("</div>"),contacts_details.append("</div>")}contacts_details.append("</div>")}contacts_details.append("</div>"),contacts_details.append("</div>"),contacts_details.append("</div>");var rightContainer=zmsuite.getCenter()[0].getNodes()[2].$el.find(".SC_conRgt")[0];$(rightContainer).find(".zcs-cont-details").html(contacts_details.toString()),$(rightContainer).find("#zcs-ac-editcont").click(function(){zmcontact.showEditPage(contact)}),$(rightContainer).find("#zcs-print").click(function(){zmcontact.printContact(contactId)}),$(rightContainer).find("#zcs-photo").click(function(){contact.is_writable&&zmcontact.openUploadPopup(contact)}),$(rightContainer).find("#zcs-photo").mouseover(function(){contact.is_writable&&$(this).find("#zcs-change-photo").css("display","block").css("cursor","pointer")}),$(rightContainer).find("#zcs-photo").mouseout(function(){contact.is_writable&&$(this).find("div").css("display","none")})},printContact:function(){var printDiv={};if(printDiv.title=I18N.get("IAM.PRINT.PREVIEW"),printDiv.mask=!0,printDiv.buttons=[{txt:I18N.get("IAM.PRINT"),selected:!0,callback:function(){var prtContent=document.getElementById("zcs_printPopup"),winPrint=window.open("","","left=0,top=0,width=700,height=800,toolbar=no,scrollbars=yes,status=no");winPrint.document.write('<html><body onload="window.print()">'),winPrint.document.write('<link type="text/css" rel="stylesheet" href="'+ZContacts.meta.serviceInfo.contacts_server_url+'/new/css/new_style.css">');var logoSrc=ZContacts.meta.serviceInfo.contacts_server_url+"/images/contacts-logo.gif";winPrint.document.write('<img alt="'+I18N.get("IAM.CONTACTS.ZOHO")+'" src="'+logoSrc+'" style="margin-top: -2px;height:24px;"/></div>'),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</body></html>"),winPrint.document.close(),winPrint.focus(),zmsDialog.remove()}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove(),$("#zcs_printPopup").remove()}}],printDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_printPopup").remove()},printDiv.pos="center",createFolElem=$("<div id='zcs_printPopup'></div>"),!$("#zcs_printPopup").length){var tags="<div style='width: 200%; max-height: 555px; position: relative;'>",prtContent=zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs-cont-details");tags=tags+prtContent[0].innerHTML+"</div>",createFolElem.append(tags),$(document.body).append(createFolElem),$("#zcs_printPopup").ready(function(){$("#zcs_printPopup").find(".zcs-title-edit").remove()})}zmsDialog.create("zcs_printPopup",printDiv),$("#zcs_printPopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_printPopup").parents(".SC_Pop").on("click",function(){this.remove()})},printWorkspace:function(contactsNode){if(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID))return zmsuite.showWorkSpace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),void $("#zm_dropDown").hide();var workspace;workspace=zmsuite.getCenter(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID)?ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID:isNewSearchWorkSpace()?ZContacts.ZMailConstants.NEW_SEARCH_WORKSPACE_APP_ID:ZContacts.ZMailConstants.CONTACTS_APP_ID);var contactsTabObj2={appname:I18N.get("IAM.CONTACTS.PRINT"),appId:ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID,appIcon:"msi-print",searchPlaceHolder:I18N.get("IAM.CONTACTS.PRINT"),data:{CNodes:"3"}};zmsuite.setWorkSpace(contactsTabObj2),zmsuite.showWorkSpace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID);var workspaceCenter=zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),centerNodes=workspaceCenter[0].getNodes();centerNodes[0].push([]);var headerObj={left:{leftHTML:I18N.get("IAM.CONTACTS.PRINT")},right:[]};centerNodes[1].push(headerObj);var headericon={left:[],right:[{actionArr:[{iconList:["msi-plus"],tooltip:I18N.get("IAM.CONTACTS.ADD.CONTACT")}]},{actionArr:[{iconList:["msi-thumbview"],tooltip:I18N.get("IAM.CONTACTS.PRINT.CARDVIEW")}]},{actionArr:[{iconList:["msi-listview"],tooltip:I18N.get("IAM.CONTACTS.PRINT.LISTVIEW")}]},{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};centerNodes[0].push(headericon);var listingCenter=centerNodes[2];zmcontact.unChkAll();var $containerDiv=$("<div>").addClass("SC_print").width("1080px"),contactPrint=new ZContacts.contactprint;ZContacts.contactprint.$containerElem=$containerDiv;zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count>100&&(contactsNode.$el.find(".zmL.SC_cont.SC_check").length>100?zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.PRINT.PREVIEW")):0==contactsNode.$el.find(".zmL.SC_cont.SC_check").length&&zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.PRINT.PREVIEW"))),contactPrint.createPageContent(getHtmlForPrintCard()),listingCenter.$el.append($containerDiv),listingCenter.$el.addClass("zcs-print-form"),contactPrint.render(),zmsuite.renderWorkSpace(),zmcontact.updateHeaderBand(),zmcontact.showPrintPage(contactsNode,workspace),zmsuite.getCenter()[0].$el.find(".zcs-print-form").css("z-index","0"),centerNodes[0].setListener("click",function(ev,iconName){if("msi-close"==iconName&&(zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),zmcontact.unChkAll()),"msi-listview"==iconName){if(contactPrint.$e.find("#final_table_view_print_div").is(":visible"))return;contactPrint.createPageContent(getHtmlForPrintTable()),listingCenter.$el.append($containerDiv),listingCenter.$el.addClass("zcs-print-form"),contactPrint.render(),ZContacts.contactprint.tableView(contactsNode,workspace)}if("msi-thumbview"==iconName){if(contactPrint.$e.find("#final_business_card_print_div").is(":visible"))return;contactPrint.createPageContent(getHtmlForPrintCard()),listingCenter.$el.append($containerDiv),listingCenter.$el.addClass("zcs-print-form"),contactPrint.render(),zmcontact.showPrintPage(contactsNode,workspace,!0),void 0!=ZContacts._action&&void 0!=ZContacts._event&&ZContacts.contactprint.select(ZContacts._event,ZContacts._action)}if("msi-plus"==iconName){var headerNode=zmsuite.getCenter()[1].getNodes(),headericon={left:I18N.get("IAM.CONTACTS.PRINT"),right:[{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};headerNode[0].push(headericon),zmsuite.getCenter()[1].getNodes()[0].render(),zmsuite.renderCenter();var centerWrapper=zmsuite.getCenter(),tabNodes=centerWrapper[1].getNodes(),icons=[];icons.push({groupId:"prevIcons",actionArr:[{iconClass:"msi-close",data:"msi-close",tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]});var prevHeader={rIcons:icons};headerDOM=["DIV",{attrs:{"class":"SC_phd"},child:[["text",I18N.get("IAM.CONTACTS.SELECT")]]}],prevHeader.text=headerDOM,tabNodes[0].push(prevHeader),centerWrapper[1].show(),$(zmsuite.getCenter()[1]).ready(function(){$(zmsuite.getCenter()[1].$el).css("left","initial"),$(zmsuite.getCenter()[1].$el).css("z-index","5"),$(zmsuite.getCenter()[1].$el).css("width","350px"),$(zmsuite.getCenter()[0].$el.find(".SC_mclst")).addClass("zcs_mclst"),$(zmsuite.getCenter()[0].$el.find(".zcs_print_button_div")).css("z-index","2")}),tabNodes[0].setListener("click",function(iconName){"msi-close"==iconName&&(centerWrapper[1].close(),centerWrapper[1].$el.remove())}),accountId=ZContacts.getCurrentAccount().getAccountId(),categoryId=zmcontact.getCategory(ZContacts._currentCategoryId).category_id;var uri=new URI(ZContacts.AllContacts,accountId).include("emails").include("phones").include("address").setSortBy(ZContacts.sortBy,!0);zmcontact.isRootFolder(categoryId)||uri.addFilter("categories",categoryId);var limit,start;if(start=0,limit=zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count,limit>100&&(limit=100),uri.setRange(start,limit),0==start&&0==limit){var html=new ZContacts.StringBuilder;return html.append('<div class="zsc_nmsg zmNightMode" style="padding: 10px;font-size: 15px;line-height: 48px;font-family: inherit;">'+I18N.get("IAM.CONTACTS.NO.CONTACT.ADDED.YET")+"</div>"),zmsuite.getCenter()[1].contentObj.$el.find(".SC_conLft").html(html.toString()),printResponse[data.id]=[],void $("#zm_dropDown").hide()}uri.GETS().then(function(contactsToAdd){zmcontact.contactsList(contactsToAdd)})}})},showPrintPage:function(contactsNode,workspace,viewSwitch){var toLoadCount,uri=null,noOfContactsSelected=contactsNode.$el.find(".zmL.SC_cont.SC_check").length;if(zmsuite.getCenter()[0].$el.find(".email_icon").css("background-image","url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/Mail.png)"),zmsuite.getCenter()[0].$el.find(".address_icon").css("background-image","url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/Address.png)"),zmsuite.getCenter()[0].$el.find(".mobile_icon").css("background-image","url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/Phone.png)"),zmsuite.getCenter()[0].$el.find(".dp_bg").css("background-image","url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/user.gif)"),zmsuite.getCenter()[0].$el.find(".dp_show").css("background-image","url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/user.gif)"),loadingDiv=zmComponent.loadingBand({container:zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs_contact_main_div").get(0),type:"pagination"}),viewSwitch&&ZContacts.contactprint.printValues(printResponse).length&&(totalLength=void 0==printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].contact_id?printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].length:ZContacts.contactprint.printValues(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]).length-1),noOfContactsSelected){accountId=ZContacts.getCurrentAccount().getAccountId();var contactIdsArr=zmcontact.getSelectedContactIds(workspace[0].getNodes()[2].$el);uri=new URI(ZContacts.Contacts,accountId,contactIdsArr).include("emails").include("phones").include("address").include("urls"),viewSwitch&&null!=printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]&&totalLength>0?(loadingDiv(),zmcontact.printAllContact(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id],totalLength,ZContacts.contactprint.$containerElem)):uri.GET().then(function(contactsToAdd){loadingDiv();var contacts=[];1==noOfContactsSelected?contacts[0]=contactsToAdd:contacts=contactsToAdd,printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]=contacts,zmcontact.printAllContact(contacts,noOfContactsSelected,ZContacts.contactprint.$containerElem)})}else{accountId=ZContacts.getCurrentAccount().getAccountId(),categoryId=zmcontact.getCategory(ZContacts._currentCategoryId).category_id,uri=new URI(ZContacts.AllContacts,accountId).include("emails").include("phones").include("address").setSortBy(ZContacts.sortBy,!0),zmcontact.isRootFolder(categoryId)||uri.addFilter("categories",categoryId);var limit,start;start=0,zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count<=100?(limit=zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count,toLoadCount=-1):(limit=100,toLoadCount=zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count-limit),uri.setRange(start,limit),viewSwitch&&null!=printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]&&totalLength>0?(loadingDiv(),zmcontact.printAllContact(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id],totalLength,ZContacts.contactprint.$containerElem)):uri.GETS().then(function(contacts){loadingDiv(),printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]=contacts,zmcontact.printAllContact(contacts,contacts.length,ZContacts.contactprint.$containerElem)})}var editorActions={print:function(){if(0==zmsuite.getCenter()[0].$el.find("#final_business_card_print_div").find(".contact_card").length)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.PRINT.EMPTY.PREVIEW"));var prtContent,winPrint=window.open("","","left=0,top=0,width=850,height=800,toolbar=no,scrollbars=yes,status=no,position=fixed");winPrint.document.write('<html><body onload="window.print()">'),winPrint.document.write('<link type="text/css" rel="stylesheet" href="'+ZContacts.meta.serviceInfo.contacts_server_url+'/new/css/new_style.css">'),zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID)[0].$el.find("#final_business_card_print_div").is(":visible")&&(prtContent=document.getElementById("final_business_card_print_div"),winPrint.document.write('<div style="width:900px">'));var loadElement=document.createElement("div");loadElement.className="loading",winPrint.document.body.appendChild(loadElement);var element=document.createElement("div");element.setAttribute("id","loadContent"),element.innerHTML=I18N.get("IAM.CONTACTS.PRINT.FETCH"),winPrint.document.body.appendChild(element),noOfContactsSelected?($(winPrint.document.getElementsByClassName("loading")[0]).remove(),$(winPrint.document.getElementById("loadContent")).remove(),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</div></body></html>"),zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),winPrint.document.close(),winPrint.focus()):-1==toLoadCount?($(winPrint.document.getElementsByClassName("loading")[0]).remove(),$(winPrint.document.getElementById("loadContent")).remove(),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</div></body></html>"),zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),winPrint.document.close(),winPrint.focus()):(start=100,limit=zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count,uri.setRange(start,limit),uri.GETS().then(function(contacts){$(winPrint.document.getElementsByClassName("loading")[0]).remove(),$(winPrint.document.getElementById("loadContent")).remove(),zmcontact.printAllContact(contacts,contacts.length,ZContacts.contactprint.$containerElem),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</div></body></html>"),zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),toLoadCount=-1,winPrint.document.close(),winPrint.focus()}))},cancel:function(){isPrintWorkSpace()&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)),zmcontact.unChkAll()}},printAction=new ZContacts.contactprint({actions:editorActions});printAction.render(),printAction.bindEvents()},printAllContact:function(contacts,length,containerElement){this.$e=containerElement,_this=this.$e.find("#final_business_card_print_div");var len=$(zmsuite.getCenter()[0].getNodes()[2].$el.find("#final_business_card_print_div").find(".contact_card")).length;len&&(len=zmsuite.getCenter()[0].getNodes()[2].$el.find("#final_business_card_print_div").find(".contact_card").length);for(var name,contact_info,email_head,contactCard,cardDesign,contactBasicInfo,basicInfoListDp,dpBg,dpShow,contactName,contactNameValue,contactInfo,contactEmail,emailIcon,emailHead,contactMobile,mobileIcon,mobileHead,contactCardArray=document.createDocumentFragment(),i=len,j=0;length+len>i;i++,j++)if(null!=contacts[j]){if(name=(contacts[j].first_name||"")+" "+(contacts[j].middle_name||"")+" "+(contacts[j].last_name||""),contact_info=(contacts[j].job_title?contacts[j].job_title+"-":"")+(contacts[j].company?contacts[j].company:""),email_head="",contacts[j].emails)for(var k=0;k<contacts[j].emails.length;k++)contacts[j].emails[k].is_primary&&(email_head=contacts[j].emails[k].email_id);if(contactCard=document.createElement("div"),contactCard.className="contact_card",contactCard.id=contacts[j].contact_id,contactCard.style.minHeight="220px",cardDesign=document.createElement("span"),cardDesign.className="card_design",contactCard.appendChild(cardDesign),contactBasicInfo=document.createElement("div"),contactBasicInfo.className="contact_basicinfo",basicInfoListDp=document.createElement("span"),basicInfoListDp.className="basic_info_list_dp",dpBg=document.createElement("span"),dpBg.className="dp_bg",dpBg.style.backgroundImage="url("+contacts[j].photo_url+")",basicInfoListDp.appendChild(dpBg),dpShow=document.createElement("span"),dpShow.className="dp_show",dpShow.style.backgroundImage="url("+contacts[j].photo_url+")",basicInfoListDp.appendChild(dpShow),contactBasicInfo.appendChild(basicInfoListDp),contactName=document.createElement("div"),contactName.className="contact_name",contactNameValue=document.createTextNode(name),contactName.appendChild(contactNameValue),contactNameValue.length>31&&(contactName.style.fontSize="10px",contactName.style.overflow="hidden"),contactInfo=document.createElement("div"),contactInfo.className="contact_info",contactInfo.appendChild(document.createTextNode(contact_info)),contactBasicInfo.appendChild(contactName),contactBasicInfo.appendChild(contactInfo),contactCard.appendChild(contactBasicInfo),contacts[j].address)for(var k=0;k<contacts[j].address.length;k++){var address="";if("work"==contacts[j].address[k].type){address+=(contacts[j].address[k].street_addr?contacts[j].address[k].street_addr:"")+(contacts[j].address[k].street_addr1?","+contacts[j].address[k].street_addr1:"")+(contacts[j].address[k].city?","+contacts[j].address[k].city:"")+(contacts[j].address[k].state?","+contacts[j].address[k].state:"")+(contacts[j].address[k].country?","+contacts[j].address[k].country:"")+(contacts[j].address[k].postal_code?","+contacts[j].address[k].postal_code:"");var address0=document.createElement("div");address0.id="address0",address0.className="contact_address";var addressIcon=document.createElement("div");addressIcon.className="address_icon",addressIcon.style.backgroundImage="url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/Address.png)",address0.appendChild(addressIcon);var addressHead=document.createElement("div");addressHead.className="address_head",addressHead.appendChild(document.createTextNode(contacts[j].address[k].type.charAt(0).toUpperCase()+contacts[j].address[k].type.substring(1,contacts[j].address[k].type.length)));var addressValue=document.createElement("div");addressValue.className="address_value",addressValue.appendChild(document.createTextNode(address)),address0.appendChild(addressHead),address0.appendChild(addressValue),contactCard.appendChild(address0)}if("home"==contacts[j].address[k].type){address+=(contacts[j].address[k].street_addr?contacts[j].address[k].street_addr:"")+(contacts[j].address[k].street_addr1?","+contacts[j].address[k].street_addr1:"")+(contacts[j].address[k].city?","+contacts[j].address[k].city:"")+(contacts[j].address[k].state?","+contacts[j].address[k].state:"")+(contacts[j].address[k].country?","+contacts[j].address[k].country:"")+(contacts[j].address[k].postal_code?","+contacts[j].address[k].postal_code:"");var address1=document.createElement("div");address1.id="address1",address1.className="contact_address";var addressIcon=document.createElement("div");addressIcon.className="address_icon",addressIcon.style.backgroundImage="url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/Address.png)",address1.appendChild(addressIcon);var addressHead=document.createElement("div");addressHead.className="address_head",addressHead.appendChild(document.createTextNode(contacts[j].address[k].type.charAt(0).toUpperCase()+contacts[j].address[k].type.substring(1,contacts[j].address[k].type.length)));var addressValue=document.createElement("div");addressValue.className="address_value",addressValue.appendChild(document.createTextNode(address)),address1.appendChild(addressHead),address1.appendChild(addressValue),address1.style.display="none",contactCard.appendChild(address1)}}contactEmail=document.createElement("div"),contactEmail.className="contact_email",emailIcon=document.createElement("div"),emailIcon.className="email_icon",emailHead=document.createElement("div"),emailHead.className="email_head",emailHead.appendChild(document.createTextNode(email_head)),contacts[j].emails&&contacts[j].emails[0]&&(emailIcon.style.backgroundImage="url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/Mail.png)"),contactEmail.appendChild(emailIcon),contactEmail.appendChild(emailHead),contactCard.appendChild(contactEmail),contactMobile=document.createElement("div"),contactMobile.className="contact_mobile",mobileIcon=document.createElement("div"),mobileIcon.className="mobile_icon",mobileHead=document.createElement("div"),mobileHead.className="mobile_head";var phone="";if(contacts[j].phones)for(var k=0;k<contacts[j].phones.length;k++)if("mobile"==contacts[j].phones[k].type){mobileIcon.style.backgroundImage="url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/Phone.png)",phone+=contacts[j].phones[k].number;break}mobileHead.appendChild(document.createTextNode(phone)),contactMobile.appendChild(mobileIcon),contactMobile.appendChild(mobileHead),contactCard.appendChild(contactMobile),contactCardArray.appendChild(contactCard)}document.getElementById("final_business_card_print_div").appendChild(contactCardArray),zmsuite.getCenter()[0].$el.find(".address_head").click(function(){var listObj={},list=[];list.push({htm:I18N.get("IAM.HOME"),data:{action:"home"}}),list.push({htm:I18N.get("IAM.CONTACTS.BASIC.WORK"),data:{action:"work"}}),listObj.par=zmsuite.getCenter()[0].$el.find(".address_head"),listObj.defaultclass=!0,listObj.parWidth=!0,listObj.onHide=function(){$("#zm_dropDown").remove()},listObj.list=list,listObj.clk=function(data,event){ZContacts.contactprint.select(event,data.action),$("#zm_dropDown").hide()},zmsuite.showMenu(listObj),$("#zm_dropDown").css("z-index","1"),$("#zm_dropDown").css("width","120px"),$("#zm_dropDown").css("margin-left","-20px"),$("#zm_dropDown").css("margin-top","5px")}),$(document).mouseup(function(){$(this).find(".dropdown-content").length&&($(event.target).hasClass("dropdown-content")||$(this).find(".dropdown-content").remove())}),document.addEventListener("scroll",function(){1==$(document).find("#zm_dropDown").length&&$(document).find("#zm_dropDown").remove()},!0),zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID)[0].$el.find("#final_business_card_print_div").find(".contact_card").on("mouseover",function(){$(this).find("#cross").is(":visible")||($(this).find(".contact_name").after('<a id="cross"><i class="msi-close"></i></a>'),$("#cross").click(function(){for(var i=0;i<ZContacts.contactprint.printValues(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]).length-1;i++)if(null!=printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id][i]&&printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id][i].contact_id==this.parentNode.parentNode.id){printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id][i]=null;break}$(this.parentNode.parentNode).remove()}))}),zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID)[0].$el.find("#final_business_card_print_div").find(".contact_card").on("mouseleave",function(){$(this).find("#cross").remove()})},addContactsToPrint:function(contacts,cntElem){var accountId,div="<div style='padding: 2%; height:auto; width:96%;'><div id='ztb-search' style='left: 0%; width: 289px! important;' class='ztb-font-family ztb-search-focus SC_srcmore'><i class='msi-search'></i><i class='msi-barrow'></i><input type='text' style='width: 255px! important; border:none; padding-top:4px;' id='ztb-search-field' class='ztb-font-family zm_sgst' placeholder='"+I18N.get("IAM.CONTACTS.SELECT")+"'></div></div><div class='SC_conLft' id='zcs_printConLft'></div>";$(zmsuite.getCenter()[1].contentObj.$el).html(div),zmsuite.getCenter()[1].contentObj.$el.find(".SC_conLft").html(cntElem),zmsuite.getCenter()[1].$el.find("#ztb-search-field")[0].focus(),$(zmsuite.getCenter()[1].$el.find(".zmFrm")).css("text-overflow","ellipsis"),accountId=ZContacts.getCurrentAccount().getAccountId(),zmsuite.getCenter()[1].$el.find(".msi-barrow").click(function(){var parentEle=zmsuite.getCenter()[1].$el.find("#ztb-search"),listObj={},cat=[];cat.push({htm:encodeHTML(ZContacts.getCurrentAccount().name)+"/",data:{id:ZContacts.AccountsVsRootFolderMap[ZContacts.getCurrentAccount().getAccountId()]}});var cate=ZContacts._parentObj[ZContacts.getCurrentAccount().getRootFolderId()];if(cate)for(var i=0;i<cate.length;i++){var display="/"+encodeHTML(cate[i].category_name)+"/";if(display.length>20)var displayText=".../"+encodeHTML(cate[i].category_name.substring(0,19))+"...";else var displayText=encodeHTML(ZContacts.getCurrentAccount().name)+"/"+encodeHTML(cate[i].category_name)+"/";cat.push({htm:displayText,data:{id:cate[i].category_id}})}listObj.par=parentEle,listObj.defaultclass=!0,listObj.parWidth=!0,listObj.onHide=function(){$("#zm_dropDown").remove()},listObj.list=cat,listObj.clk=function(data){var found=0;if(null==data.id)return zmcontact.unChkAll(),void $("#zm_dropDown").hide();if(null!=printResponse[data.id]&&printResponse[data.id].length){contacts=printResponse[data.id];var cntElem=$(zmcontact.constructContactsRow(contacts));zmsuite.getCenter()[1].contentObj.$el.find(".SC_conLft").html(cntElem),zmsuite.getCenter()[1].$el.find(".SC_icn").remove(),zmsuite.getCenter()[1].$el.find('*[class^="wms"]').remove(),zmsuite.getCenter()[1].$el.find(".zmFlt").children().css("padding-top","15px"),$(zmsuite.getCenter()[1].$el.find(".zmL.SC_cont")).attr("draggable","false"),zmsuite.getCenter()[1].$el.find(".SC_conLft").after('<div class="SC_PUbtm zmModeBG printSelect"></div>'),zmsuite.getCenter()[1].$el.find(".zmL.SC_cont").click(function(){$(this).find(".msi-uncheck").length?($(this).addClass("SC_check"),$(this).find(".msi-uncheck").addClass("msi-check").removeClass("msi-uncheck")):($(this).removeClass("SC_check"),$(this).find(".msi-check").addClass("msi-uncheck").removeClass("msi-check"))}),found=1}accountId=zmcontact.isRootFolder(data.id)?ZContacts.AccountsVsRootFolderMap[data.id].account_id:ZContacts.AccountsVsRootFolderMap[zmcontact.getRootFolderId(data.id)].account_id,categoryId=zmcontact.getCategory(data.id).category_id;var uri=new URI(ZContacts.AllContacts,accountId).include("emails").include("phones").include("address").setSortBy(ZContacts.sortBy,!0);zmcontact.isRootFolder(categoryId)||uri.addFilter("categories",categoryId);var limit,start;if(start=0,limit=zmcontact.getCategory(data.id).contacts_count,uri.setRange(start,limit),0==limit&&0==start){var html=new ZContacts.StringBuilder;return html.append('<div class="zsc_nmsg zmNightMode" style="padding: 10px;font-size: 15px;line-height: 48px;font-family: inherit;">'+I18N.get("IAM.CONTACTS.NO.CONTACT.ADDED.YET")+"</div>"),zmsuite.getCenter()[1].contentObj.$el.find(".SC_conLft").html(html.toString()),printResponse[data.id]=[],void $("#zm_dropDown").hide()}0==found&&uri.GETS().then(function(contactsToAdd){if(contactsToAdd.length){printResponse[data.id]=contactsToAdd,contacts=contactsToAdd;var cntElem=$(zmcontact.constructContactsRow(contactsToAdd));zmsuite.getCenter()[1].contentObj.$el.find(".SC_conLft").html(cntElem),zmsuite.getCenter()[1].$el.find(".SC_icn").remove(),zmsuite.getCenter()[1].$el.find('*[class^="wms"]').remove(),zmsuite.getCenter()[1].$el.find(".zmFlt").children().css("padding-top","15px"),$(zmsuite.getCenter()[1].$el.find(".zmL.SC_cont")).attr("draggable","false"),zmsuite.getCenter()[1].$el.find(".SC_conLft").after('<div class="SC_PUbtm zmModeBG printSelect"></div>'),zmsuite.getCenter()[1].$el.find(".zmL.SC_cont").click(function(){$(this).find(".msi-uncheck").length?($(this).addClass("SC_check"),$(this).find(".msi-uncheck").addClass("msi-check").removeClass("msi-uncheck")):($(this).removeClass("SC_check"),$(this).find(".msi-check").addClass("msi-uncheck").removeClass("msi-check"))})}}),$("#zm_dropDown").hide()},zmsuite.showMenu(listObj),$("#zm_dropDown").css("z-index","10"),$("#zm_dropDown").css("margin-right","20px")}),$(zmsuite.getCenter()[1].$el.find("#zcs_printConLft")).ready(function(){zmsuite.getCenter()[1].$el.find(".SC_icn").remove(),zmsuite.getCenter()[1].$el.find('*[class^="wms"]').remove(),zmsuite.getCenter()[1].$el.find(".zmFlt").children().css("padding-top","15px"),$(zmsuite.getCenter()[1].$el.find(".zmL.SC_cont")).attr("draggable","false"),$(zmsuite.getCenter()[1].$el.find(".SC_conLft")).css("user-select","none"),zmsuite.getCenter()[1].$el.find(".SC_conLft").after('<div class="SC_PUbtm zmModeBG printSelect"></div>'),zmsuite.getCenter()[1].$el.find(".printSelect").append('<span id="zcs-select-btn" data-field-type="zcs-select-btn">'+I18N.get("IAM.ADD")+"</span>"),zmsuite.getCenter()[1].$el.find(".printSelect").append('<span data-val="Cancel" data-field-type="zcs-cancel-btn" id="zcs-cancel-btn" style="margin-left: 10px;" data-val="Cancel">'+I18N.get("IAM.CANCEL")+"</span>")}),zmsuite.getCenter()[1].$el.find(".zmL.SC_cont").click(function(){$(this).find(".msi-uncheck").length?($(this).addClass("SC_check"),$(this).find(".msi-uncheck").addClass("msi-check").removeClass("msi-uncheck")):($(this).removeClass("SC_check"),$(this).find(".msi-check").addClass("msi-uncheck").removeClass("msi-check"))}),zmsuite.getCenter()[1].$el.on("click","#zcs-select-btn",function(){var noOfContactsSelected=zmsuite.getCenter()[1].$el.find(".zmL.SC_cont.SC_check").length;if(noOfContactsSelected){var contactIdsArr=zmcontact.getSelectedContactIds(zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID)[1].getNodes()[1].$el);new URI(ZContacts.Contacts,accountId,contactIdsArr).include("emails").include("phones").include("address").include("urls").GET().then(function(contacts){1==noOfContactsSelected&&(contacts[0]=contacts),totalLength=void 0==printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].contact_id?printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].length:ZContacts.contactprint.printValues(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]).length-1;for(var i=0;noOfContactsSelected>i;i++)printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id][totalLength+i]=contacts[i];var div;if(zmsuite.getCenter()[0].$el.find("#final_table_view_print_div").is(":visible")){div=zmsuite.getCenter()[0].$el.find("#final_table_view_print_div"),ZContacts.contactprint.createTableContent(contacts,ZContacts.contactprint.$containerElem.find("#final_table_view_print_div"),noOfContactsSelected),zmsuite.getCenter()[0].$el.find(".zcs_print_main_div")[0].scrollTop=zmsuite.getCenter()[0].$el.find(".zcs_print_main_div")[0].scrollHeight,zmsuite.getCenter()[0].getNodes()[2].$el.find(".contact_list_header").find(".msi-uncheck").length>0&&div.find(".contact_list").addClass(1==zmsuite.getCenter()[0].getNodes()[2].$el.find(".contact_list_header").find(".msi-uncheck").length?"contact_list_1050":"contact_list_710");for(var i=0;i<ZContacts.contactprint.printValues(checkValues).length;i++)0==ZContacts.contactprint.printValues(checkValues)[i]&&div.find(Object.keys(checkValues)[i]).hide()}else{zmcontact.printAllContact(contacts,noOfContactsSelected,ZContacts.contactprint.$containerElem),zmsuite.getCenter()[0].$el.find(".zcs_print_main_div")[0].scrollTop=zmsuite.getCenter()[0].$el.find(".zcs_print_main_div")[0].scrollHeight,div=zmsuite.getCenter()[0].$el.find("#final_business_card_print_div");for(var i=0;i<ZContacts.contactprint.printValues(checkValues).length;i++){var keyStore;".contact_address"==Object.keys(checkValues)[i]&&(keyStore=ZContacts.contactprint.printValues(checkValues)[i]),1==ZContacts.contactprint.printValues(checkValues)[i]?1==keyStore&&(void 0!=ZContacts._action?div.find(".contact_card").find(Object.keys(checkValues)[i]).show():div.find(Object.keys(checkValues)[i]).show()):div.find(".contact_card").find(Object.keys(checkValues)[i]).hide()}}});var centerNode=zmsuite.getCenter()[1].getNodes();centerNode[1].$el.find(".msi-check").removeClass().addClass("msi-uncheck"),centerNode[1].$el.find(".SC_check").removeClass("SC_check")}zmsuite.getCenter()[1].close(),zmsuite.getCenter()[1].$el.remove()}),zmsuite.getCenter()[1].$el.on("click","#zcs-cancel-btn",function(){zmsuite.getCenter()[1].close(),zmsuite.getCenter()[1].$el.remove()}),$(zmsuite.getCenter()[1].$el.find("#ztb-search-field")).on("keydown",function(e){(-1==categoryId||zmcontact.isRootFolder(categoryId))&&(categoryId=-1);var k=e.which;if(20==k||16==k||9==k||27==k||17==k||91==k||19==k||18==k||93==k||45==k||k>=33&&34>=k||k>=112&&123>=k||k>=144&&145>=k)return!1;if(k>=35&&40>=k)return!0;if((e.ctrlKey||e.altKey)&&e.keyCode>=65&&e.keyCode<=90)return!0;if(8==k||46==k)setTimeout(function(){var value=$(zmsuite.getCenter()[1].$el.find("#ztb-search-field")).val();if(0==value.length)zmcontact.searchContactToPrint(value,contacts);else{var uri=new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).include("emails").include("phones").include("categories").addSearchQuery(value).setPagination("1","100").setSortBy(ZContacts.sortBy,!0);uri.addFilter("categories",categoryId),uri.GETS().then(function(json){zmcontact.searchContactToPrint(value,json)})}},100);else if(13==k){value=this.value;var uri=new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).include("emails").include("phones").include("categories").addSearchQuery(value).setPagination("1","100").setSortBy(ZContacts.sortBy,!0);uri.addFilter("categories",categoryId),uri.GETS().then(function(json){zmcontact.searchContactToPrint(value,json)})}else{var value=this.value.substring(0,zmsuite.getCenter()[1].$el.find("#ztb-search-field").prop("selectionStart"))+e.key+this.value.substring(zmsuite.getCenter()[1].$el.find("#ztb-search-field").prop("selectionStart"),this.value.length),uri=new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).include("emails").include("phones").include("categories").addSearchQuery(value).setPagination("1","100").setSortBy(ZContacts.sortBy,!0);uri.addFilter("categories",categoryId),uri.GETS().then(function(json){zmcontact.searchContactToPrint(value,json)})}})},searchContactToPrint:function(value,json){var cntElem=$(zmcontact.constructContactsRow(json));zmsuite.getCenter()[1].contentObj.$el.find(".SC_conLft").html(cntElem),zmsuite.getCenter()[1].$el.find(".SC_icn").remove(),zmsuite.getCenter()[1].$el.find(".zmFlt").children().css("padding-top","15px"),zmsuite.getCenter()[1].$el.find('*[class^="wms"]').remove(),$(zmsuite.getCenter()[1].$el.find(".zmL.SC_cont")).attr("draggable","false"),$(zmsuite.getCenter()[1].$el.find(".SC_conLft")).css("user-select","none"),zmsuite.getCenter()[1].$el.find(".zmFrm").each(function(){var index=$(this).children("span").html().toLowerCase().indexOf(value.toLowerCase());if(-1!=index){var html=$(this).children("span").html();html=html.substring(0,index)+'<font class="afHgl">'+html.substring(index,index+value.length)+"</font>"+html.substring(index+value.length),$(this).children("span").html(html)}else if(null!=this.nextSibling){var index=$(this.nextSibling.children).html().toLowerCase().indexOf(value.toLowerCase()),html=$(this.nextSibling.children).html();html=html.substring(0,index)+'<font class="afHgl">'+html.substring(index,index+value.length)+"</font>"+html.substring(index+value.length),$(this.nextSibling.children).html(html)}}),zmsuite.getCenter()[1].$el.find(".zmL.SC_cont").click(function(){$(this).find(".msi-uncheck").length?($(this).addClass("SC_check"),$(this).find(".msi-uncheck").addClass("msi-check").removeClass("msi-uncheck")):($(this).removeClass("SC_check"),$(this).find(".msi-check").addClass("msi-uncheck").removeClass("msi-check"))})},switchDetailsPage:function(isDetail){var rightContainer=zmsuite.getWorkSpace(zmTab.currentTab)[0].$el.find(".SC_mclst").find(".SC_conRgt");isDetail?($(rightContainer).find(".zcs-cont-details").show(),$(rightContainer).find(".zcs-cont-edit").hide()):($(rightContainer).find(".zcs-cont-details").hide(),$(rightContainer).find(".zcs-cont-edit").show())},initScroll:function(scrollElem,currElem,nearElem){var diff,diffLen,sTop=scrollElem.scrollTop(),currTop=currElem.offset().top,prevTop=nearElem.offset().top,halfHeight=scrollElem.height()/2;diffLen=currTop-prevTop,scrollElem.scrollTop(sTop+diffLen),0>currTop?(diff=halfHeight-currTop,scrollElem.scrollTop(sTop-diff)):currTop>scrollElem.height()&&(diff=currTop-halfHeight,scrollElem.scrollTop(sTop+diff))},showMergePage:function(contacts,contactIds,isMerge){function distinctField(fieldArr,fieldObj){$.each(fieldArr,function(key,value){fieldObj[key]&&-1==value.indexOf(fieldObj[key].trim())&&(value[value.length]=fieldObj[key].trim())})}delete ZContacts._accountAudit[ZContacts.getCurrentAccount().getAccountId()];for(var editorActions={merge:function(){var contactModel=this.toContactsModel(ZContacts.ContactsMerge.create());contactModel&&zmsDialog.confirm(zmcontact.formatMessage(I18N.get("IAM.CONTACTS.MERGE.CONFIRM"),contactIds.length),{onOk:function(){new URI(ZContacts.ContactsMerge,ZContacts.getCurrentAccount().getAccountId(),contactIds).POST(contactModel).then(function(response){if(201==response.status_code){zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.DUPLICATES.MERGED.SUCCESSFULLY"));try{(ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&(contactModel.contact_id=response.contacts.contact_id,zmcontact.invokeEvent("contactsApp/added",{zid:ZContacts.getCurrentAccount().getAccountId(),contact:contactModel}),zmcontact.invokeEvent("contactsApp/deleted",{zid:zid,contact_ids:contactIds.split(",")}))}catch(e){}if(!isMerge){var noOfRow=$(".zcs-contDup-row").parents(".SC_cont");if(1!=noOfRow.length){var elem=$("div[id='"+contactIds+"']"),nextElem=elem.next();return nextElem.length||(nextElem=$($(".zcs-contDup-row").parents("#zcs_conLft").find(".zmL")[0])),nextElem.click(),zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),nextElem,elem),elem.remove(),void zmcontact.refreshContactCounts()}1==noOfRow.length&&zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)}return zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId)),void zmcontact.refreshContactCounts()}},function(response){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))})}})},skip:function(){var prevElem=$('div[data-field-type="zcs-cnt-view"]:has(.zcs-contDup-row)');if(1==$(".zcs-contDup-row").length)zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID);else{prevElem.next().length?prevElem.next().click():$(".zcs-contDup-row").parents("#zcs_conLft").find(".zmL")[0].click();var currElem=$('div[data-field-type="zcs-cnt-view"]');zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),currElem,prevElem)}},deleteContact:function(){var elem=$("div[data-field-type=zcs-cnt-view]:has(.zcs-contDup-row)"),id=elem[0].id;zmcontact.deleteMultiContacts(id.split(","))},cancel:function(){isCleanWorkSpace()?zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID):zmcontact.switchDetailsPage(!0),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)),zmcontact.unChkAll()}},nameArr={first_name:[],middle_name:[],last_name:[],nick_name:[],job_title:[],designation:[],company:[],notes:[]},hmeAddrArr={street_addr:[],street_addr1:[],city:[],state:[],country:[],postal_code:[]},wrkAddrArr={street_addr:[],street_addr1:[],city:[],state:[],country:[],postal_code:[]},contact=contacts[0],i=0;contacts[i];i++){if(0!=i){var length=contact.emails?contact.emails.length:0;if(contacts[i].emails){0==length&&(contact.emails=[]);for(var j=0;j<contacts[i].emails.length&&contact.emails&&-1==contact.emails.indexOf(contacts[i].emails[j].email_id);j++)contact.emails[length+j]={is_primary:!1,email_id:contacts[i].emails[j].email_id}}if(length=contact.phones?contact.phones.length:0,contacts[i].phones){0==length&&(contact.phones=[]);for(var j=0;j<contacts[i].phones.length&&contact.phones&&-1==contact.phones.indexOf(contacts[i].phones[j].number);j++)contact.phones[length+j]={type:contacts[i].phones[j].type,number:contacts[i].phones[j].number}}if(length=contact.ims?contact.ims.length:0,contacts[i].ims){0==length&&(contact.ims=[]);for(var j=0;j<contacts[i].ims.length&&contact.ims&&-1==contact.ims.indexOf(contacts[i].ims[j].address);j++)contact.ims[length+j]={type:contacts[i].ims[j].type,address:contacts[i].ims[j].address}}if(length=contact.urls?contact.urls.length:0,contacts[i].urls){0==length&&(contact.urls=[]);for(var j=0;j<contacts[i].urls.length&&contact.urls&&-1==contact.urls.indexOf(contacts[i].urls[j].url);j++)contact.urls[length+j]={type:contacts[i].urls[j].type,url:contacts[i].urls[j].url}}}distinctField(nameArr,contacts[i]);var hmeAddr,wrkAddr;contacts[i].address&&contacts[i].address.length&&(hmeAddr="home"==contacts[i].address[0].type?contacts[i].address[0]:contacts[i].address[1],wrkAddr="work"==contacts[i].address[0].type?contacts[i].address[0]:contacts[i].address[1]),hmeAddr&&distinctField(hmeAddrArr,hmeAddr),wrkAddr&&distinctField(wrkAddrArr,wrkAddr)}$.each(nameArr,function(key,value){if("notes"!=key){var firstCntField;contacts[0][key]&&(firstCntField=contacts[0][key].trim()),1==nameArr[key].length&&value[0]==firstCntField&&(nameArr[key]=[])}});var firstCntHmeAddr;contacts[0].address&&contacts[0].address.length&&(firstCntHmeAddr="home"==contacts[0].address[0].type?contacts[0].address[0]:contacts[0].address[1]),firstCntHmeAddr&&0!=i&&$.each(hmeAddrArr,function(key,value){var firstCntField;firstCntHmeAddr[key]&&(firstCntField=firstCntHmeAddr[key].trim()),1==hmeAddrArr[key].length&&value[0]==firstCntField&&(hmeAddrArr[key]=[])});var firstCntWrkAddr;contacts[0].address&&contacts[0].address.length&&(firstCntWrkAddr="work"==contacts[0].address[0].type?contacts[0].address[0]:contacts[0].address[1]),firstCntWrkAddr&&0!=i&&$.each(wrkAddrArr,function(key,value){var firstCntField;firstCntWrkAddr[key]&&(firstCntField=firstCntWrkAddr[key].trim()),1==wrkAddrArr[key].length&&value[0]==firstCntField&&(wrkAddrArr[key]=[])});var contact=ZContacts.ContactsDuplicates.create(contact),ceditor=new ZContacts.ContactEditor(!1,contact,{actions:editorActions}),$rightContainer=zmsuite.getCenter()[0].getNodes()[2].$el;if(ceditor.render($rightContainer.find(".zcs-cont-edit"),!0,"merge"),zmsuite.getCenter()[0].$el.find('input[data-field-type="middle_name"]').after('<div id="zcs-first-middle" class="zcs-mr10" style="width :100%;float: left;">'),nameArr.first_name.length||nameArr.middle_name.length){zmsuite.getCenter()[0].$el.find("#zcs-first-middle").append('<div id="zcs-dup-first" style="width:48%; margin-right: 1px;" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.first_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-first").append("<label onclick=\"$('input[data-field-type=first_name]').val('"+encodeHTML(nameArr.first_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(nameArr.first_name[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-first").append("</div>")}if(nameArr.first_name.length||nameArr.middle_name.length){zmsuite.getCenter()[0].$el.find("#zcs-first-middle").append('<div id="zcs-dup-middle" style="width:47%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.middle_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-middle").append("<label onclick=\"$('input[data-field-type=middle_name]').val('"+encodeHTML(nameArr.middle_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(nameArr.middle_name[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-middle").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-first-middle").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-first-middle").after('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="nick_name"]').after('<div id="zcs-last-nick" class="zcs-mr10" style="width :100%;float: left;">'),nameArr.last_name.length||nameArr.nick_name.length){zmsuite.getCenter()[0].$el.find("#zcs-last-nick").append('<div id="zcs-dup-last" style="width:48%; margin-right: 1px;" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.last_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-last").append("<label onclick=\"$('input[data-field-type=last_name]').val('"+encodeHTML(nameArr.last_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(nameArr.last_name[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-last").append("</div>")}if(nameArr.last_name.length||nameArr.nick_name.length){zmsuite.getCenter()[0].$el.find("#zcs-last-nick").append('<div id="zcs-dup-nick" style="width:47%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.nick_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-nick").append("<label onclick=\"$('input[data-field-type=nick_name]').val('"+encodeHTML(nameArr.nick_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(nameArr.nick_name[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-nick").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-last-nick").append("</div>"),zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_street_addr"]').after('<div id="zcs-hme-street" class="zcs-mr10" style="width :66.5%;float: left;">'),hmeAddrArr.street_addr.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-street").append('<div id="zcs-dup-streetadd" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.street_addr.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd").append("<label onclick=\"$('input[data-field-type=hme_street_addr]').val('"+encodeHTML(hmeAddrArr.street_addr[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(hmeAddrArr.street_addr[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_street_addr1"]').after('<div id="zcs-hme-street1" class="zcs-mr10" style="width :66.5%;float: left;">'),hmeAddrArr.street_addr1.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-street1").append('<div id="zcs-dup-streetadd1" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.street_addr1.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd1").append("<label onclick=\"$('input[data-field-type=hme_street_addr1]').val('"+encodeHTML(hmeAddrArr.street_addr1[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(hmeAddrArr.street_addr1[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street1").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_state"]').after('<div id="zcs-hme-state-city" class="zcs-mr10" style="width: 99.1%;float: left;">'),hmeAddrArr.city.length||hmeAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append('<div id="zcs-dup-city" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.city.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-city").append("<label onclick=\"$('input[data-field-type=hme_city]').val('"+encodeHTML(hmeAddrArr.city[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(hmeAddrArr.city[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-city").append("</div>")}if(hmeAddrArr.city.length||hmeAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append('<div id="zcs-dup-state" style="width: 48%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.state.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-state").append("<label onclick=\"$('input[data-field-type=hme_state]').val('"+encodeHTML(hmeAddrArr.state[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(hmeAddrArr.state[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-state").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_postal_code"]').after('<div id="zcs-hme-country-pin" class="zcs-mr10" style="width: 99.1%;float: left;">'),hmeAddrArr.country.length||hmeAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append('<div id="zcs-dup-country" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.country.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-country").append("<label onclick=\"$('input[data-field-type=hme_country]').val('"+encodeHTML(hmeAddrArr.country[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(hmeAddrArr.country[i])+"</label>");zmsuite.getCenter()[0].$el.find("zcs-dup-country").append("</div>")}if(hmeAddrArr.country.length||hmeAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append('<div id="zcs-dup-pin" style="width: 48%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.postal_code.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-pin").append("<label onclick=\"$('input[data-field-type=hme_postal_code]').val('"+encodeHTML(hmeAddrArr.postal_code[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(hmeAddrArr.postal_code[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-pin").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="company"]').after('<div id="zcs-work-company" class="zcs-mr10" style="width :66.5%;float: left;">'),nameArr.company.length){zmsuite.getCenter()[0].$el.find("#zcs-work-company").append('<div id="zcs-dup-company" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.company.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-company").append("<label onclick=\"$('input[data-field-type=company]').val('"+encodeHTML(nameArr.company[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(nameArr.company[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-company").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-company").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-company").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="designation"]').after('<div id="zcs-work-job-designation" class="zcs-mr10" style="width :99.1%;float: left;">'),nameArr.job_title.length||nameArr.designation.length){zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append('<div id="zcs-dup-job_title" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.job_title.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-job_title").append("<label onclick=\"$('input[data-field-type=job_title]').val('"+encodeHTML(nameArr.job_title[i])+'\');"  class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(nameArr.job_title[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-job_title").append("</div>")}if(nameArr.job_title.length||nameArr.designation.length){zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append('<div id="zcs-dup-designation" style="width: 48%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.designation.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-designation").append("<label onclick=\"$('input[data-field-type=designation]').val('"+encodeHTML(nameArr.designation[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(nameArr.designation[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-designation").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_street_addr"]').after('<div id="zcs-work-street" class="zcs-mr10" style="width :66.5%;float: left;">'),wrkAddrArr.street_addr.length){zmsuite.getCenter()[0].$el.find("#zcs-work-street").append('<div id="zcs-dup-wrk_street_addr" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.street_addr.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr").append("<label onclick=\"$('input[data-field-type=wrk_street_addr]').val('"+encodeHTML(wrkAddrArr.street_addr[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(wrkAddrArr.street_addr[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr").append("</div><br><br>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_street_addr1"]').after('<div id="zcs-work-street1" class="zcs-mr10" style="width :66.5%;float: left;">'),wrkAddrArr.street_addr1.length){zmsuite.getCenter()[0].$el.find("#zcs-work-street1").append('<div id="zcs-dup-wrk_street_addr1" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.street_addr1.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr1").append("<label onclick=\"$('input[data-field-type=wrk_street_addr1]').val('"+encodeHTML(wrkAddrArr.street_addr1[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(wrkAddrArr.street_addr1[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street1").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_state"]').after('<div id="zcs-work-city-state" class="zcs-mr10" style="width: 99.1%;float: left;">'),wrkAddrArr.city.length||wrkAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append('<div id="zcs-dup-wrk_city" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.city.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_city").append("<label onclick=\"$('input[data-field-type=wrk_city]').val('"+encodeHTML(wrkAddrArr.city[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(wrkAddrArr.city[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_city").append("</div>")}if(wrkAddrArr.city.length||wrkAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append('<div id="zcs-dup-wrk_state" style="width: 48%;" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.state.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_state").append("<label onclick=\"$('input[data-field-type=wrk_state]').val('"+encodeHTML(wrkAddrArr.state[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(wrkAddrArr.state[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_state").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_postal_code"]').after('<div id="zcs-work-country-pin" class="zcs-mr10" style="width: 99.1%;float: left;">'),wrkAddrArr.country.length||wrkAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append('<div id="zcs-dup-wrk_country" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.country.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_country").append("<label onclick=\"$('input[data-field-type=wrk_country]').val('"+encodeHTML(wrkAddrArr.country[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(wrkAddrArr.country[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_country").append("</div>")}if(wrkAddrArr.country.length||wrkAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append('<div id="zcs-dup-postal_code" style="width: 48%;" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.postal_code.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-postal_code").append("<label onclick=\"$('input[data-field-type=wrk_postal_code]').val('"+encodeHTML(wrkAddrArr.postal_code[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+encodeHTML(wrkAddrArr.postal_code[i])+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-postal_code").append("</div>")}zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append('<div style="clear: both;"></div>'),isMerge&&($("#zcs-top-btn").remove(),$("#zcs-delete-btn").remove(),$("#zcs-skip-btn").remove(),zmcontact.switchDetailsPage(!1))},showEditPage:function(contact){var editorActions={save:function(){var contactModel=this.toContactsModel(ZContacts.Contacts.create());if(contactModel){zmcontact.restrictClick(this.$e.find(".SC_PUbtm"),!0),$(".SC_PUbtm").append("<div id='zcs_loading'></div>");var destroyLoadingDiv=zmComponent.loadingBand({container:$("#zcs_loading").get(0),type:"pagination"}),contactId=contact.get("contact_id").toString(),zid=contact.zid;zid||(zid=ZContacts.getCurrentAccount().getAccountId()),new URI(ZContacts.Contacts,zid,contactId).PUT(contactModel).then(function(json){if(destroyLoadingDiv(),json.status_code!==ZContacts.Constants.StatusCode.OK)return void zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json));delete ZContacts._audit[contactId],$(".SC_PUbtm").removeAttr("disabled"),zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(json));var photo_url=zmcontact.getJsStdUrl(contact.get("photo_url"));contactModel.set("photo_url",photo_url),contactModel.set("contact_id",contact.get("contact_id")),contactModel.set("is_writable",contact.get("is_writable")),contactModel.set("zid",contact.get("zid"));var $rowEle=zmcontact.getContactRowElement(contactModel),oldRowEle=zmsuite.getCenter()[0].getNodes()[2].$el.find("#"+contactId);if($rowEle.insertAfter(oldRowEle),$rowEle[0].setAttribute("data-field-type","zcs-cnt-view"),oldRowEle.remove(),isOldSearchWorkSpace()){var $contactsTabRowEle=zmcontact.getContactRowElement(contactModel),contactsTabOldRowEle=zmsuite.getWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID)[0].getNodes()[2].$el.find("#"+contactId);$contactsTabRowEle.insertAfter(contactsTabOldRowEle),contactsTabOldRowEle.remove()}printResponse={},zmcontact.renderContactDetails(contactModel),zmcontact.switchDetailsPage(!0);try{(ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&zmcontact.invokeEvent("contactsApp/updated",{zid:ZContacts.getCurrentAccount().getAccountId(),contact:contactModel})}catch(e){}},function(json){if(destroyLoadingDiv(),$(".SC_PUbtm").removeAttr("disabled"),json.status_code==ZContacts.Constants.StatusCode.CONFLICT){if(json.errors[0]&&"same_data"==json.errors[0].code)return $(".SC_PUbtm").removeAttr("disabled"),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.UPDATED.SUCCESS")),printResponse={},zmcontact.renderContactDetails(contact),void zmcontact.switchDetailsPage(!0);zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json));var contactId=json.errors[0].params.contact_id,currentAccountId=ZContacts.getCurrentAccount().getAccountId(),html="<h4 style='float: left;width:90%; padding: 5px 0px 15px 5px;'>"+I18N.get("IAM.CONTACTS.EDIT.EXISTING.CONTACT")+"</h4>";html+="<div class='SC_PUbtm'><span id='zcs_delete' class='sel' onclick='zmcontact.editPageConfirm(\""+contactId+'", "'+currentAccountId+"\");zmcontact.removeDialog(this);' >"+I18N.get("IAM.CONTACTS.EDIT")+"</span><span data-val='Cancel' onclick='zmcontact.removeDialog(this);'>"+I18N.get("IAM.CANCEL")+"</span></div>";{Dialog.new({title:"",$content:html,defaultCloseIcon:!0})}}else zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),isNewSearchWorkSpace()||zmcontact.unChkAll()}},cancel:function(){$(".SC_PUbtm").removeAttr("disabled");var contactId=contact.get("contact_id"),zid=contact.get("zid");zmcontact.loadContactDetails(contactId,zid),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId))}},ceditor=new ZContacts.ContactEditor(!1,contact,{actions:editorActions}),$rightContainer=zmsuite.getCenter()[0].getNodes()[2].$el;ceditor.render($rightContainer.find(".zcs-cont-edit"),!0),$(".zcs-cont-edit").off("keypress").on("keypress",function(e){13!=e.which||"textarea"==e.target.type||e.shiftKey||$(this).find("#zcs-save-btn")[0].click()}),zmcontact.switchDetailsPage(!1),zmsuite.getCenter()[0].getNodes()[2].$el.find('[data-field-type="first_name"]')[0].focus()},showDuplicates:function(event){var t=event.target;if($(t).hasClass("SC_cont")||(t=$(t).parents(".zmL.SC_cont")[0]),!$(t).hasClass("zmSLst")){$(".zmL.SC_cont.zmSLst").removeClass("zmSLst"),$('div[data-field-type="zcs-cnt-view"]').attr("data-field-type",""),t.setAttribute("class","zmL SC_cont zmSLst"),t.setAttribute("data-field-type","zcs-cnt-view");var id=t.id;zmcontact.showMergeUI(id.split(","))}event.stopPropagation()},getContactRowElement:function(contact,isCleanDupes){var cRow=new ZContacts.StringBuilder;if(isCleanDupes){var contact_id=contact.contact_id.toString();contact=ZContacts.Contacts.create(contact),cRow.append("<div class='zmL SC_cont' data-field-type='' onclick='zmcontact.showDuplicates(event)' id='").append(contact_id).append("'>");var count=contact_id.split(",").length;cRow.append("<div class='zmLst'>"),cRow.append("<div class='zmDtl'>"),cRow.append("<div class='zcs-contDup-row'><span>").append(encodeHTML(contact.getFullName().trim())).append("</span>"),cRow.append("<div class='zcs-matched-count'><b title='"+count+" "+I18N.get("IAM.CONTACTS.MATCHED")+"'>"+count+"</b></div>"),cRow.append("</div></div>"),cRow.append("</div>"),cRow.append("</div>")}else{var photo_url=zmcontact.getJsStdUrl(contact.get("photo_url")),pattern=/nocache=[-0-9]+&?/i,updatedTime=void 0==contact.get("updated_time")?(new Date).getTime():contact.get("updated_time");photo_url=photo_url.replace(photo_url.match(pattern),"")+"&nocache="+updatedTime,contact.set("photo_url",photo_url);{var contactZuid=contact.get("contact_zuid"),contactStatus=contact.get("status"),contact_id=contact.get("contact_id").toString(),zid=contact.get("zid");getCurrentSearchTab(zmTab.currentTab)}if(isNewSearchWorkSpace()?cRow.append("<div class='zmL SC_cont'  draggable='false' onclick='zmcontact.loadContactDetails(\""+contact_id+'", "'+zid+"\")' data-field-type='' id='").append(contact_id).append("'>"):cRow.append("<div class='zmL SC_cont'  draggable='true' ondragstart='zmcontact.doDrag(event, \""+contact_id+"\")' ondragend='zmcontact.dodragend(event)' data-field-type='' id='").append(contact_id).append("'>"),cRow.append("<div class='zmLst'>"),cRow.append("<div class='zmFlt'>"),cRow.append("<i class='msi-uncheck' onclick='zmcontact.select(event)'></i>"),-1!=contactZuid){var status,presence;try{status=WmsContacts.getStatusType(contactZuid)}catch(e){}status&&status!=ContactStatus.OFFLINE?status==ContactStatus.ONLINE?(status="wms-1-1",presence=I18N.get("IAM.ONLINE")):status==ContactStatus.INVISIBLE?(status="wms-2-1",presence=I18N.get("IAM.INVISIBLE")):status==ContactStatus.BUSY?(status="wms-3-1",presence=I18N.get("IAM.BUSY")):status==ContactStatus.IDLE&&(status="wms-4-1",presence=I18N.get("IAM.IDLE")):(status="wms-0",presence=I18N.get("IAM.OFFLINE")),cRow.append("<i class='"+status+"' title='"+presence+"'></i>")}if(cRow.append("</div>"),cRow.append("<div class='zmDtl'>"),cRow.append("<div class='zmImg'>"),cRow.append("<img src='"+photo_url+"'>"),cRow.append("</div>"),isNewSearchWorkSpace()?cRow.append("<div class='zmFrm' style='max-width: 200px; text-overflow: ellipsis;'><span>").append(encodeHTML(contact.getFullName().trim())).append("</span></div>"):cRow.append("<div class='zmFrm'><span>").append(encodeHTML(contact.getFullName().trim())).append("</span></div>"),contact.getPrimaryEmail()){if(cRow.append("<div class='zmSub'><span>").append(encodeHTML(contact.getPrimaryEmail())).append("</span></div>"),cRow.append("<div class='SC_icn'>"),cRow.append(zmail.forContactsApp?"<a onclick='zmcontact.sendMail(\""+contact.getPrimaryEmail()+"\")' style='text-decoration: none !important;'><i class='msi-mail' title='"+I18N.get("IAM.CONTACTS.SEND.MAIL")+"'></i></a>":"<i class='msi-mail' data-tooltip='"+I18N.get("IAM.CONTACTS.SEND.MAIL")+"' data-tooltip-pos='top' onclick='zmUtil.compose({\"TO\": \""+contact.getPrimaryEmail()+"\" });'></i>"),!isNewSearchWorkSpace()&&2!=contact.get("contact_type")&&"2"!=contact.get("contact_type")&&ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT)if(-1==contactZuid)cRow.append(zmail.isFuji?zmail.forContactsApp?"<i class='msi-invite-skydesk' title='"+I18N.get("IAM.CONTACTS.INVITE.ZOHO")+"' onclick='zmcontact.inviteChat(event, \""+contact_id+"\",0)'></i>":"<i class='msi-invite-skydesk' data-tooltip='"+I18N.get("IAM.CONTACTS.INVITE.ZOHO")+"' data-tooltip-pos='top' onclick='zmcontact.inviteChat(event, \""+contact_id+"\",0)'></i>":zmail.forContactsApp?"<i class='msi-invite-zoho' title='"+I18N.get("IAM.CONTACTS.INVITE.ZOHO")+"' onclick='zmcontact.inviteChat(event, \""+contact_id+"\",0)'></i>":"<i class='msi-invite-zoho' data-tooltip='"+I18N.get("IAM.CONTACTS.INVITE.ZOHO")+"' data-tooltip-pos='top' onclick='zmcontact.inviteChat(event, \""+contact_id+"\",0)'></i>");else if(contactStatus>=0)cRow.append(zmail.forContactsApp?"<i class='msi-chat' title='"+I18N.get("IAM.CONTACTS.CHAT")+"' onclick='zmcontact.openChat(\""+contactZuid+"\",event)'></i>":"<i class='msi-chat' data-tooltip='"+I18N.get("IAM.CONTACTS.CHAT")+"' data-tooltip-pos='top' onclick='zmcontact.openChat(\""+contactZuid+"\",event)'></i>");else if(contactStatus==ContactStatus.DELETED||contactStatus==ContactStatus.REJECTED){var chat;chat=I18N.get(contactStatus==ContactStatus.DELETED?"IAM.CONTACTS.DELETED":"IAM.CONTACTS.REJECTED"),cRow.append(zmail.forContactsApp?"<i class='msi-chat-rejected' title='"+chat+"' onclick='zmcontact.inviteChat(event, \""+contact_id+'",'+contactStatus+")'></i>":"<i class='msi-chat-rejected' data-tooltip='"+chat+"' data-tooltip-pos='top' onclick='zmcontact.inviteChat(event, \""+contact_id+'",'+contactStatus+")'></i>")}else contactStatus==ContactStatus.NO_CHAT?cRow.append(zmail.forContactsApp?"<i class='msi-invite-chat' title='"+I18N.get("IAM.CONTACTS.INVITE.TO.CHAT")+"' onclick='zmcontact.inviteChat(event, \""+contact_id+'",'+contactStatus+")'></i>":"<i class='msi-invite-chat' data-tooltip='"+I18N.get("IAM.CONTACTS.INVITE.TO.CHAT")+"' data-tooltip-pos='top' onclick='zmcontact.inviteChat(event, \""+contact_id+'",'+contactStatus+")'></i>"):(contactStatus==ContactStatus.PENDING||contactStatus==ContactStatus.REQACC)&&cRow.append(zmail.forContactsApp?"<i class='msi-chat-pending' title='"+I18N.get("IAM.CONTACTS.PENDING")+"'></i>":"<i class='msi-chat-pending' data-tooltip='"+I18N.get("IAM.CONTACTS.PENDING")+"' data-tooltip-pos='top' ></i>");cRow.append("</div>")}cRow.append("</div>"),cRow.append("</div>"),cRow.append("</div>")}retHTML=cRow.toString();var $html=$(retHTML);return $html.get(0).__zc_contact=contact,$html},dodragend:function(){$(".SC_dg").remove(),$(".zmTreeDrop").remove()},doDrag:function(event,contactId){event.stopPropagation(),$(event.dataTransfer)[0].setData("text/html","anything");var contactIdsArr=[];if($(event.target).hasClass("SC_check")){var selectedCount=zmsuite.getCenter()[0].$el.find(".SC_check").length;if(1==selectedCount)contactIdsArr.push(event.target.id);else for(var i=0;selectedCount>i;i++)contactIdsArr.push(zmsuite.getCenter()[0].$el.find(".SC_check")[i].id)}else contactIdsArr.push(contactId);dragElement=$("<div class='SC_dg'></div>"),1==contactIdsArr.length?($(dragElement).html(encodeHTML(zmsuite.getCenter()[0].$el.find("#"+contactIdsArr[0]).get(0).__zc_contact.first_name)+"<br>"),null!=zmsuite.getCenter()[0].$el.find("#"+contactIdsArr[0]).get(0).__zc_contact.emails&&$(dragElement).append(encodeHTML(zmsuite.getCenter()[0].$el.find("#"+contactIdsArr[0]).get(0).__zc_contact.emails[0].email_id))):$(dragElement).html(zmcontact.formatMessage(I18N.get("IAM.CONTACTS.OF.SELECTED"),contactIdsArr.length)),$(dragElement).css("minWidth","100px"),$(dragElement).css("fontWeight","bold"),$(dragElement).css("top","99999px"),$(dragElement).css("left","99999px"),$(dragElement).css("zIndex","-1"),$(dragElement).css("text-align","left"),$(dragElement).css("position","absolute"),$(document.body).append(dragElement),$(event.dataTransfer)[0].setDragImage(dragElement[0],-10,-10),$(document).ready(function(){$(document).off("drag").on("drag",function(e){$(".SC_dg").remove(),$(".SC_dg").css({top:e.originalEvent.clientY+"px",left:e.originalEvent.clientX+"px"})}),$(".zmTreeNode, .SC_tre").off("dragenter").on("dragenter",function(e){$(".SC_dg").remove(),e.preventDefault(),0==$(e.currentTarget).find(".zmTreeDrop").length&&0==$(e.currentTarget).find(".msi-plus").length&&$(e.currentTarget).find("span").last().after('<div id="zmTreeDrop" class="zmTreeDrop"></div>'),setTimeout(function(){if(zmcontact.isRootFolder(e.currentTarget.id)&&"_add"!=e.currentTarget.id.substr(-4)){{var dropDownClassName;ZContacts.AccountsVsRootFolderMap[e.currentTarget.id]}dropDownClassName=1==$(e.currentTarget).hasClass("SC_tre")?".msi-arrow45":".msi-barrow",0==$(e.currentTarget).find(dropDownClassName).length&&($(e.currentTarget).find(".msi-rarrow").click(),$(".zmTreeNode, .SC_tre").off("dragover").on("dragover",function(e){setTimeout(function(){e.preventDefault(),e.stopPropagation(),$(".zmTreeNode, .SC_tre").not($(this)).find(".zmTreeDrop").remove(),$(".SC_dg").css("opacity","0"),0==$(e.currentTarget).find(".zmTreeDrop").length&&0==$(e.currentTarget).find(".msi-plus").length&&$(e.currentTarget).find("span").last().after('<div id="zmTreeDrop" class="zmTreeDrop"></div>'),e.originalEvent.clientY==e.originalEvent.clientX&&zmcontact.doDrop(e,contactIdsArr)},20)}),$(".zmTreeNode, .SC_tre").off("dragleave").on("dragleave",function(e){e.preventDefault(),e.originalEvent.clientY==e.originalEvent.clientX&&zmcontact.doDrop(e,contactIdsArr),$(e.currentTarget).find("#zmTreeDrop").remove(),$(".SC_dg").remove()}),$(".zmTreeNode, .SC_tre").off("drop").on("drop",function(e){e.preventDefault(),zmcontact.doDrop(e,contactIdsArr)}))}},500)}),$(".zmTreeNode, .SC_tre").off("dragover").on("dragover",function(e){e.preventDefault(),$(".zmTreeNode, .SC_tre").not($(this)).find(".zmTreeDrop").remove(),$(".zmTreeNode, .SC_tre").off("drop").on("drop",function(e){e.preventDefault(),zmcontact.doDrop(e,contactIdsArr)})}),$(".zmTreeNode, .SC_tre").off("dragleave").on("dragleave",function(e){e.preventDefault(),$(".SC_dg").remove()})})},doDrop:function(event,contactIdsArr){if(event.preventDefault(),$(".zmTreeDrop").remove(),$(".SC_dg").remove(),"_add"!=event.currentTarget.id.substr(-4)){var updateCategoryId=event.currentTarget.id,categoryId=zmcontact.isRootFolder(updateCategoryId)?-1:updateCategoryId,sourceZid=ZContacts.getCurrentAccount().getAccountId(),destAcc=ZContacts.AccountsVsRootFolderMap[zmcontact.getRootFolderId(event.currentTarget.id)];if(!destAcc.isWritable)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.WRITE.OPERATION.NOT.ALLOWED"));if(sourceZid==destAcc.account_id)return void zmcontact.addContactsToCategory(contactIdsArr,updateCategoryId);var copy=ZContacts.Copy.create(),copyfrom=ZContacts.CopyFrom.create({zid:sourceZid,contact_ids:contactIdsArr}),copyto=ZContacts.CopyTo.create({zid:destAcc.getAccountId(),category_id:categoryId});copy.addSubResource(copyto),copy.addSubResource(copyfrom),new URI(ZContacts.Copy,destAcc.getAccountId()).POST(copy).then(function(response){return 201==response.status_code?(zmcontact.refreshContactCounts(destAcc.getAccountId()),sourceZid==destAcc.account_id&&zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS)),void zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(response))):void zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),zmcontact.unChkAll()}},openChat:function(contactZuid,event){WebMessanger.chat(contactZuid),event.stopPropagation()},inviteChat:function(event,contactId,status){var msg;status==ContactStatus.NO_CHAT&&(msg="IAM.CONTACTS.ERROR.SURE.INVITE"),(status==ContactStatus.DELETED||status==ContactStatus.REJECTED)&&(msg="IAM.CONTACTS.ERROR.SURE.REINVITE"),0==status&&(msg="IAM.CONTACTS.SURE.INVITE.ZOHO"),zmsDialog.confirm(I18N.get(msg),{onOk:function(){new URI(ZContacts.InviteChat,ZContacts.getCurrentAccount().getAccountId(),contactId).POST(ZContacts.InviteChat.create({})).then(function(response){return 200==response.status_code?(delete ZContacts._audit[contactId],zmUtil.succErrMsg("s",response.message),$(event.target).attr("class","msi-chat-pending"),void $(event.target).removeAttr("onclick")):void zmUtil.succErrMsg("s",I18N.get("IAM.ERROR.GENERAL"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}}),event.stopPropagation()},select:function(event){var selectedCount,t=$(event.target),menuNode=zmsuite.getCenter()[0].getNodes()[0],centerElem=zmsuite.getCenter()[0].$el,currentElem=t.parents(".SC_cont");if(currentElem.hasClass("SC_check")){if(event.shiftKey){var elem;if(ZContacts._prevContact){if(currentElem.prevAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.next(),elem.removeClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-uncheck"),elem.find(".msi-uncheck").removeClass().addClass("msi-uncheck");else if(currentElem.nextAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.prev(),elem.removeClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-uncheck"),elem.find(".msi-uncheck").removeClass().addClass("msi-uncheck");ZContacts._prevContact.hasClass("SC_check")&&(ZContacts._prevContact.removeClass("SC_check"),ZContacts._prevContact.find(".msi-check").removeClass().addClass("msi-uncheck"))}}currentElem.hasClass("SC_check")&&(currentElem.removeClass("SC_check"),t.removeClass("msi-check").addClass("msi-uncheck")),ZContacts._prevContact=currentElem,selectedCount=centerElem.find(".zmL.SC_cont.SC_check").length,zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),selectedCount,!1)}else{var currentElem=$(event.target).parents(".SC_cont");if(event.shiftKey){var elem;if(ZContacts._prevContact){if(currentElem.prevAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.next(),elem.addClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-check"),elem.find(".msi-uncheck").removeClass().addClass("msi-check");else if(currentElem.nextAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.prev(),elem.addClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-check"),elem.find(".msi-uncheck").removeClass().addClass("msi-check");ZContacts._prevContact.hasClass("SC_check")||(ZContacts._prevContact.addClass("SC_check"),ZContacts._prevContact.find(".msi-uncheck").removeClass().addClass("msi-check"))}}currentElem.hasClass("SC_check")||(currentElem.addClass("SC_check"),t.removeClass("msi-uncheck").addClass("msi-check")),ZContacts._prevContact=currentElem,selectedCount=centerElem.find(".zmL.SC_cont.SC_check").length,zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),selectedCount,!1)}ZContacts.getCurrentAccount().isWritable&&(menuNode.showGroup("delete"),menuNode.showGroup("print"),zmcontact.isRootFolder()||menuNode.showGroup("clearcontacts"),2>selectedCount?menuNode.hideGroup("merge"):menuNode.showGroup("merge")),menuNode.showGroup("addto"),menuNode.showGroup("mail");var contCount=$(".zmL.SC_cont").length;menuNode.hideGroup("sort"),selectedCount==contCount?menuNode.$el.find(".msi-uncheck").removeClass().addClass("msi-check zcs-check"):0==selectedCount?(menuNode.$el.find(".msi-check").removeClass().addClass("msi-uncheck zcs-check"),menuNode.$el.find(".msi-partcheck").removeClass().addClass("msi-uncheck zcs-check"),menuNode.hideGroup("delete"),menuNode.hideGroup("print"),menuNode.hideGroup("mail"),menuNode.hideGroup("addto"),menuNode.hideGroup("clearcontacts"),isOldSearchWorkSpace()||menuNode.showGroup("sort")):zmcontact.partiallyCheck(),zmcontact.selectRestrictionBand(),event.stopPropagation()},selectRestrictionBand:function(){var center=zmsuite.getCenter()[0].$el;if(ZContacts.selectedCount>ZContacts.ZMailConstants.SELECT_LIMIT){if(!$("#zcs_select_restrict").length){var elem=document.createElement("div");elem.id="zcs_select_restrict",elem.className="SC_simg",elem.innerHTML='<span class="SC_ldot">'+zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.SELECT.CONTACTS.LIMIT"),ZContacts.ZMailConstants.SELECT_LIMIT)+"</span>",center.addClass("SC_trsh"),center[0].insertBefore(elem,center[0].childNodes[2])}}else center.removeClass("SC_trsh"),$("#zcs_select_restrict").remove()},partiallyCheck:function(){var menuNode=zmsuite.getCenter()[0].getNodes()[0];menuNode.$el.find(".msi-uncheck").removeClass().addClass("msi-uncheck msi-partcheck zcs-check"),menuNode.$el.find(".msi-check").removeClass().addClass("msi-uncheck msi-partcheck zcs-check")},createContactInTab:function(contactEditor){if(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.WORKSPACE_APP_ID))zmsuite.showWorkSpace(ZContacts.ZMailConstants.WORKSPACE_APP_ID);else{var contactsTabObj={appname:"Create Contact",appId:ZContacts.ZMailConstants.WORKSPACE_APP_ID,appIcon:"msi-edit",searchPlaceHolder:I18N.get("IAM.CONTACTS.SEARCH.CONTACTS"),data:{CNodes:"3"}};zmsuite.setWorkSpace(contactsTabObj),zmsuite.showWorkSpace(ZContacts.ZMailConstants.WORKSPACE_APP_ID)}var workspaceCenter=zmsuite.getCenter(ZContacts.ZMailConstants.WORKSPACE_APP_ID),centerNodes=workspaceCenter[0].getNodes();centerNodes[0].push([]);var headerObj={left:{leftHTML:I18N.get("IAM.CONTACTS.ADD.CONTACT")},right:[]};centerNodes[1].push(headerObj);var headericon={left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};centerNodes[0].push(headericon),centerNodes[0].setListener("click",function(ev,iconName){"msi-close"==iconName&&zmsuite.closeWorkspace("zm_createContact")});var listingCenter=centerNodes[2],$containerDiv=$("<div>").addClass("SC_PUcen").width("600px");$(contactEditor.$e).find("#zcs_name_label").removeAttr("id"),contactEditor.rerender($containerDiv,!1),listingCenter.$el.append($containerDiv),listingCenter.$el.addClass("zcs-editor-form"),zmsuite.renderWorkSpace(),$(".zcs-editor-form").off("keypress").on("keypress",function(e){13!=e.which||"textarea"==e.target.type||e.shiftKey||$(this).find("#zcs-save-btn")[0].click()}),zmsuite.getCenter()[0].getNodes()[2].$el.find('[data-field-type="first_name"]')[0].focus()},restrictClick:function(elements,isRestrict){isRestrict?elements.attr("disabled","disabled"):elements.removeAttr("disabled")},storeAccountsFromResponse:function(resp){for(var i=0;i<resp.length;i++){var acc=resp[i],rootFolderId=acc.getRootFolderId();if(ZContacts.AccountsVsRootFolderMap[rootFolderId]=acc,ZContacts.AccountsVsRootFolderMap[acc.getAccountId()]=rootFolderId,ZContacts.AccountsList.push({id:acc.getAccountId(),name:acc.getName(),display_text:acc.getName(),isWritable:acc.isWritable}),acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT&&(ZContacts.user=acc),acc.getType()==ZContacts.ZMailConstants.ORG_ACCOUNT&&(ZContacts.org=acc),acc.getType()==ZContacts.ZMailConstants.GROUP_ACCOUNT&&(ZContacts.groups||(ZContacts.groups=[]),ZContacts.groups.push(acc)),ZContacts._countObj[rootFolderId]={c:acc.count,p:-1},acc.categories){ZContacts._childObj[rootFolderId]={CH:{}};var seq=1,categories=acc.categories;ZContacts._parentObj[acc.getRootFolderId()]=categories;for(var j=0;j<categories.length;j++){var catId=categories[j].category_id.toString();ZContacts._countObj[catId]={c:categories[j].contacts_count,p:rootFolderId},ZContacts._childObj[rootFolderId].CH[catId]={category_id:catId,category_name:encodeHTML(categories[j].category_name),E:0,HC:!1,SE:seq},seq++}}}},formatMessage:function(){var msg=arguments[0];if(msg)for(var i=1;i<arguments.length;i++)msg=msg.replace("{"+(i-1)+"}",arguments[i]);return msg},getJsStdUrl:function(url){return url=url.replace("https://",""),url=url.replace("http://",""),url.startsWith("//")||(url="//"+url),url},getAccountName:function(contact){var accountName="",acc=zmcontact.getAccountByZid(contact.zid);return accountName=I18N.get(contact.is_org&&"org"==acc.type?"IAM.CONTACTS.ORGANIZATION":"personal"==acc.type?"IAM.CONTACTS.PERSONAL":"IAM.CONTACTS.GROUPS")},getJsStdUrl:function(url){return url=url.replace("https://",""),url=url.replace("http://",""),url.startsWith("//")||(url="//"+url),url},restoreContacts:function(zid,days){zmcontact.unChkAll();var restoreContact=ZContacts.TrashRestoreContacts.create(),loadingDiv=(zmsuite.getCenter()[0].getNodes()[2].$el,function(){});zmsuite.getCenter()[0].$el.prepend("<div id='zcs_loading'></div>"),loadingDiv=zmComponent.loadingBand({container:$("#zcs_loading").get(0),type:"listing"}),new URI(ZContacts.TrashRestoreContacts,zid).addPostParam("days",days).POST(restoreContact).then(function(response){if(loadingDiv(),"200"==response.status_code){$("#zcs_loading").remove();var category=zmcontact.getCategory(ZContacts._currentCategoryId);zmcontact.loadFirstPage(category),zmcontact.refreshContactCounts(),delete ZContacts._accountAudit[ZContacts.getCurrentAccount().getAccountId()],zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(response))}},function(response){loadingDiv(),$("#zcs_loading").remove(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))})},restorePopUp:function(){var restoreDiv={};if(restoreDiv.title=I18N.get("IAM.CONTACTS.RESTORE.CONTACTS"),restoreDiv.mask=!0,restoreDiv.buttons=[{txt:I18N.get("IAM.CONTACTS.RESTORE"),selected:!0,callback:function(){var days=$("#zcs_restorePopup").find("#days").attr("data-field-type");zmcontact.restoreContacts(ZContacts.getCurrentAccount().getAccountId(),days),zmsDialog.remove(),zmcontact.unChkAll()}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove(),$("#zcs_restorePopup").remove()}}],restoreDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_restorePopup").remove()},restoreDiv.pos="center",createFolElem=$("<div id='zcs_restorePopup'></div>"),!$("#zcs_restorePopup").length){var tags="<div class='SC_tdtl'>";tags=tags+"<div class='SC_flt SC_fst' style='width: 100%; margin-top:1px; margin-bottom:1px;'><ul class='zmListReset'><li>"+I18N.get("IAM.CONTACTS.RESTORE.CONTACTS.MSG")+"</li></ul></div>",tags=tags+"<div class='SC_flt SC_select' style='width: 30%;' onclick='zmcontact.getFormatRestoreList(this)' id='zcs_format'><ul class='zmListReset'><li><b><input class='SC_tiput' placeholder='"+I18N.get("IAM.CONTACTS.10.DAYS")+"' id='days' name='format' data-field-type='10' style='display: inline-block;border:0px; cursor:pointer;' readonly=readonly></b></li></ul></div></div>",createFolElem.append(tags),$(document.body).append(createFolElem)}zmsDialog.create("zcs_restorePopup",restoreDiv),$("#zcs_restorePopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_restorePopup").parents(".SC_Pop").on("click",function(){this.remove()})},clearContacts:function(zid){zmcontact.unChkAll(),new URI(ZContacts.TrashClearContacts,zid).DELETE().then(function(response){"true"==response?(delete ZContacts._accountAudit[ZContacts.getCurrentAccount().getAccountId()],zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.TRASH.SUCCESS"))):zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.TRASH.FAILURE"))})},contactsAuditPopUp:function(contactId,zid){zmsuite.renderCenter(),zmcontact.unChkAll();var centerWrapper=zmsuite.getCenter(),tabNodes=centerWrapper[1].getNodes(),icons=[];icons.push({groupId:"contacthistory",actionArr:[{iconClass:"msi-close",data:"msi-close",tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]});var prevHeader={rIcons:icons};headerDOM=["DIV",{attrs:{"class":"SC_phd"},child:[["text",I18N.get("IAM.CONTACTS.HISTORY")]]}],prevHeader.text=headerDOM,tabNodes[0].push(prevHeader),centerWrapper[1].show(),$(zmsuite.getCenter()[1]).ready(function(){$(zmsuite.getCenter()[1].$el).attr("id","zcs_audit_main"),$(zmsuite.getCenter()[1].$el).css("left","initial"),$(zmsuite.getCenter()[1].$el).css("z-index","5"),$(zmsuite.getCenter()[1].$el).css("width","440px"),$(zmsuite.getCenter()[0].$el.find(".SC_mclst")).addClass("zcs_mclst")}),tabNodes[0].setListener("click",function(iconName){"msi-close"==iconName&&(centerWrapper[1].close(),centerWrapper[1].$el.remove())}),ZContacts._audit[contactId]?zmcontact.contactAuditHistory(ZContacts._audit[contactId]):new URI(ZContacts.ContactsAudit,zid,contactId.toString()).GET().then(function(resp){ZContacts._audit[contactId]=resp,zmcontact.contactAuditHistory(ZContacts._audit[contactId])}),$(document).bind("mouseup",function(){centerWrapper[1].close(),centerWrapper[1].$el.remove()})},accountAuditPopUp:function(zid){zmsuite.renderCenter(),zmcontact.unChkAll();var centerWrapper=zmsuite.getCenter(),tabNodes=centerWrapper[1].getNodes(),icons=[];icons.push({groupId:"accountaudit",actionArr:[{iconClass:"msi-close",data:"msi-close",tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]});var prevHeader={rIcons:icons};headerDOM=["DIV",{attrs:{"class":"SC_phd"},child:[["text",I18N.get("IAM.CONTACTS.ACCOUNT.HISTORY")]]}],prevHeader.text=headerDOM,tabNodes[0].push(prevHeader),centerWrapper[1].show(),$(zmsuite.getCenter()[1]).ready(function(){$(zmsuite.getCenter()[1].$el).attr("id","zcs_account_audit_main"),$(zmsuite.getCenter()[1].$el).css("left","initial"),$(zmsuite.getCenter()[1].$el).css("z-index","5"),$(zmsuite.getCenter()[1].$el).css("width","440px"),$(zmsuite.getCenter()[0].$el.find(".SC_mclst")).addClass("zcs_mclst")}),tabNodes[0].setListener("click",function(iconName){"msi-close"==iconName&&(centerWrapper[1].close(),centerWrapper[1].$el.remove())}),ZContacts._accountAudit[zid]?zmcontact.accountAuditHistory(ZContacts._accountAudit[zid]):new URI(ZContacts.AccountAudit,zid).GET().then(function(resp){"200"==resp.status_code&&(ZContacts._accountAudit[zid]=resp.audits,zmcontact.accountAuditHistory(ZContacts._accountAudit[zid]))},function(resp){centerWrapper[1].close(),centerWrapper[1].$el.remove(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(resp))}),$(document).bind("mouseup",function(){centerWrapper[1].close(),centerWrapper[1].$el.remove()})},accountAuditHistory:function(resp){var resp_length=Object.keys(resp).length,right_container=$(zmsuite.getCenter()[1].$el),account_history=new ZContacts.StringBuilder;account_history.append('<div class="zcs_Audit_validity">'+I18N.get("IAM.CONTACTS.AUDIT.VALIDITY")+"</div>");for(var i=0;resp_length>i;i++){var dateFormat=resp[i].date,timeFormat=resp[i].time;if(account_history.append('<div class="zcs_cAudit_main">'),resp[i].is_not_modified)account_history.append('<div class="icon-edit zcs_audit_not_edit"></div>'),account_history.append('<div class="zcs_cAudit_message zcs_audit_not_edit_msg">'+encodeHTML(resp[i].message)+"</div>");else if(resp[i].is_imported)account_history.append('<div class="icon-import zcs_cAudit_img" style="color: #56CC66;"></div>'),account_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ACCOUNT.IMPORT")+"</div>"),account_history=zmcontact.ContactAuditCommonMessage(account_history,resp[i]);else if(resp[i].is_deleted){if(account_history.append('<div class="icon-delete zcs_cAudit_img" style="color: #FF6C6C;"></div>'),account_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ACCOUNT.DELETED")+"</div>"),account_history.append('<div class="zcs_cAudit_date">'+dateFormat+"</div>"),account_history.append('<div class="zcs_cAudit_message">'+encodeHTML(resp[i].message)+"</div>"),resp[i].names)for(var j=0;j<resp[i].names.length;j++)account_history.append('<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.ACCOUNT.DELETED.LIST"),resp[i].names[j])+"</div>");account_history.append('<div class="zcs_cAudit_time" style="margin-top: 10px;">'+timeFormat+"</div>")}else resp[i].is_exported?(account_history.append('<div class="icon-export zcs_cAudit_img" style="color: #F3AA2E;"></div>'),account_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ACCOUNT.EXPORTED")+"</div>"),account_history=zmcontact.ContactAuditCommonMessage(account_history,resp[i])):resp[i].is_auto_clean?(account_history.append('<div class="icon-edit zcs_cAudit_img" style="color: #00B1FF;"></div>'),account_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ACCOUNT.CLEAN.DUPLICATE")+"</div>"),account_history=zmcontact.ContactAuditCommonMessage(account_history,resp[i])):resp[i].is_reset?(account_history.append('<div class="icon-delete zcs_cAudit_img" style="color: #FF6C6C;"></div>'),account_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ACCOUNT.RESET")+"</div>"),account_history=zmcontact.ContactAuditCommonMessage(account_history,resp[i])):resp[i].is_restored?(account_history.append('<div class="icon-import zcs_cAudit_img" style="color: #56CC66;"></div>'),account_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ACCOUNT.RESTORE")+"</div>"),account_history=zmcontact.ContactAuditCommonMessage(account_history,resp[i])):resp[i].is_cleared&&(account_history.append('<div class="icon-delete zcs_cAudit_img" style="color: #FF6C6C;"></div>'),account_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ACCOUNT.TRASH.CLEAR")+"</div>"),account_history=zmcontact.ContactAuditCommonMessage(account_history,resp[i]));account_history.append("</div>")}$(right_container).find(".SC_Twpr").html(account_history.toString())},contactAuditHistory:function(resp){var resp_length=Object.keys(resp).length,right_container=$(zmsuite.getCenter()[1].$el),contact_history=new ZContacts.StringBuilder;contact_history.append('<div class="zcs_Audit_validity">'+I18N.get("IAM.CONTACTS.AUDIT.VALIDITY")+"</div>");for(var i=resp_length;i--;){var dateFormat=resp[i].date,timeFormat=resp[i].time;if(contact_history.append('<div class="zcs_cAudit_main">'),resp[i].is_not_modified)contact_history.append('<div class="icon-edit zcs_audit_not_edit"></div>'),contact_history.append('<div class="zcs_cAudit_message zcs_audit_not_edit_msg">'+encodeHTML(resp[i].message)+"</div>");else if(resp[i].is_added_to_category)contact_history.append('<div class="icon-category zcs_cAudit_img" style="color: #56CC66;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.ADD.CATEGORY")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_created)contact_history.append('<div class="icon-new zcs_cAudit_img"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.CREATED.HEADER")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_photo_uploaded)contact_history.append('<div class="icon-profile zcs_cAudit_img" style="color: #56CC66;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.PHOTO.UPLOADED")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_photo_updated)contact_history.append('<div class="icon-profile zcs_cAudit_img" style="color: #00B1FF;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.PHOTO.UPDATED")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_photo_deleted)contact_history.append('<div class="icon-profile zcs_cAudit_img" style="color: #FF6C6C;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.PHOTO.DELETED")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_email_added)contact_history.append('<div class="icon-edit zcs_cAudit_img" style="color: #00B1FF;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.EMAIL.ADDED.HEADER")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_email_deleted)contact_history.append('<div class="icon-edit zcs_cAudit_img" style="color: #FF6C6C;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.EMAIL.REMOVED.HEADER")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_chat_invited)contact_history.append('<div class="icon-chat zcs_cAudit_img" style="color: #00B1FF;" ></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.CHAT.INVITE.HEADER")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_chat_accepted)contact_history.append('<div class="icon-chat zcs_cAudit_img" style="color: #56CC66;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.CHAT.ACCEPTED.HEADER")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_chat_rejected)contact_history.append('<div class="icon-chat zcs_cAudit_img" style="color: #FF6C6C;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.CHAT.REJECTED.HEADER")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_chat_deleted)contact_history.append('<div class="icon-chat zcs_cAudit_img" style="color: #FF6C6C;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.AUDIT.CHAT.DELETED.HEADER")+"</div>"),contact_history=zmcontact.ContactAuditCommonMessage(contact_history,resp[i]);else if(resp[i].is_updated){var old_data=resp[i].old_data,new_data=resp[i].new_data,retData={},update_oldData={},update_newData={},newEmails=[],deletedEmails=[],newPhoneNumber=[],deletePhoneNumber=[],newUrls=[],deleteUrls=[];for(var i_elem in new_data)if(new_data.hasOwnProperty(i_elem)&&new_data[i_elem]!==old_data[i_elem]){if("last_modified_time"==i_elem)continue;if("emails"==i_elem){for(var k=0;k<new_data.emails.length;k++)-1==old_data.emails.indexOf(new_data.emails[k])&&newEmails.push(new_data.emails[k]);for(var k=0;k<old_data.emails.length;k++)-1==new_data.emails.indexOf(old_data.emails[k])&&deletedEmails.push(old_data.emails[k]);update_newData.deleted_emails=deletedEmails,update_newData.added_emails=newEmails;continue}if("phones"==i_elem){for(var k=0;k<new_data.phones.length;k++)-1==old_data.phones.indexOf(new_data.phones[k])&&newPhoneNumber.push(new_data.phones[k]);for(var k=0;k<old_data.phones.length;k++)-1==new_data.phones.indexOf(old_data.phones[k])&&deletePhoneNumber.push(old_data.phones[k]);update_newData.deleted_phone=deletePhoneNumber,update_newData.added_phone=newPhoneNumber;continue}if("urls"==i_elem){for(var k=0;k<new_data.urls.length;k++)-1==old_data.urls.indexOf(new_data.urls[k])&&newUrls.push(new_data.urls[k]);for(var k=0;k<old_data.urls.length;k++)-1==new_data.urls.indexOf(old_data.urls[k])&&deleteUrls.push(old_data.urls[k]);update_newData.deleted_urls=deleteUrls,update_newData.added_urls=newUrls;continue}update_oldData[i_elem]=old_data[i_elem],update_newData[i_elem]=new_data[i_elem]}retData.old_data=update_oldData,retData.new_data=update_newData;var contact_audit_key=ZContacts.getCurrentAccount().getAccountId()+"_"+new_data.last_modified_time;ZContacts.AuditMapConstants.Contact_Map[contact_audit_key]=retData,contact_history.append('<div class="icon-edit zcs_cAudit_img" style="color: #00B1FF;"></div>'),contact_history.append('<div class="zcs_cAudit_header">'+I18N.get("IAM.CONTACTS.EDITED")+"</div>"),contact_history.append('<div class="zcs_cAudit_date">'+dateFormat+"</div>"),contact_history.append('<div class="zcs_cAudit_message">'+encodeHTML(resp[i].message)+"</div>"),contact_history=zmcontact.contactAuditMoreDetails(contact_history,contact_audit_key),contact_history.append('<div class="zcs_cAudit_time" style="margin-top: 10px;">'+timeFormat+"</div>")}contact_history.append("</div>")}$(right_container).find(".SC_Twpr").html(contact_history.toString())},ContactAuditCommonMessage:function(html,resp){return html.append('<div class="zcs_cAudit_date">'+resp.date+"</div>"),html.append('<div class="zcs_cAudit_message">'+encodeHTML(resp.message)+"</div>"),html.append('<div class="zcs_cAudit_time">'+resp.time+"</div>"),html},contactAuditMoreDetails:function(html,lastModifiedTime){var zmap=ZContacts.AuditMapConstants.Contact_Map[lastModifiedTime];for(var i_elem in zmap.new_data)if("deleted_emails"!==i_elem&&"added_emails"!==i_elem&&"deleted_phone"!==i_elem&&"added_phone"!==i_elem&&"deleted_urls"!==i_elem&&"added_urls"!==i_elem&&zmap.new_data.hasOwnProperty(i_elem)){var getHeaderName=ZContacts.AuditMapConstants.Contact_Map_Names[i_elem];html.append(zmap.old_data[i_elem]?'<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.OLD.DATA.UPDATED"),getHeaderName,encodeHTML(zmap.old_data[i_elem]),encodeHTML(zmap.new_data[i_elem]))+"</div>":'<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.NEW.DATA.ADDED"),getHeaderName,encodeHTML(zmap.new_data[i_elem]))+"</div>")}for(var i=0;i<zmap.new_data.deleted_emails.length;i++)html.append('<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.EMAIL.REMOVED"),encodeHTML(zmap.new_data.deleted_emails[i]))+"</div>");for(var j=0;j<zmap.new_data.added_emails.length;j++)html.append('<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.EMAIL.ADDED"),encodeHTML(zmap.new_data.added_emails[j]))+"</div>");for(var j=0;j<zmap.new_data.added_phone.length;j++)html.append('<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.PHONE.ADDED"),encodeHTML(zmap.new_data.added_phone[j]))+"</div>");for(var j=0;j<zmap.new_data.deleted_phone.length;j++)html.append('<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.PHONE.REMOVED"),encodeHTML(zmap.new_data.deleted_phone[j]))+"</div>");for(var j=0;j<zmap.new_data.added_urls.length;j++)html.append('<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.URLS.ADDED"),encodeHTML(zmap.new_data.added_urls[j]))+"</div>");for(var j=0;j<zmap.new_data.deleted_urls.length;j++)html.append('<div class="zcs_cAudit_more_details"><span style="margin: 5px;">-</span>'+zmcontact.formatMessage(I18N.get("IAM.CONTACTS.AUDIT.URLS.REMOVED"),encodeHTML(zmap.new_data.deleted_urls[j]))+"</div>");return html}},getCurrentSearchTab=function(currentTab){return zmail.forContactsApp&&currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID?currentTab:ZContacts.Utils.isValidSearchTab(currentTab)?ZContacts.ZMailConstants.GLOBAL_SEARCH:currentTab},isOldSearchWorkSpace=function(tab){return tab||(tab=zmTab.currentTab),zmail.forContactsApp?tab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID:!1},isNewSearchWorkSpace=function(tab){return tab||(tab=zmTab.currentTab),isOldSearchWorkSpace(tab)?!1:isSearchWorkSpace(tab)},isSearchWorkSpace=function(tab){return tab||(tab=zmTab.currentTab),ZContacts.Constants.REGEX.ZM_SRCH_TAB_PATTERN.test(tab)},isCleanWorkSpace=function(tab){return tab||(tab=zmTab.currentTab),tab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID},isPrintWorkSpace=function(tab){return tab||(tab=zmTab.currentTab),tab==ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID},isImportWorkSpace=function(tab){return tab||(tab=zmTab.currentTab),tab==ZContacts.ZMailConstants.IMPORT_APP_ID},isContactDetailWorkSpace=function(tab){return tab||(tab=zmTab.currentTab),tab==ZContacts.ZMailConstants.CONTACTS_APP_ID},loadZCon=function(){if(zmail.forContactsApp&&zmcontact.topbarHelpDoc(),zmsuite.isWorkspaceAvailable("zm_Contacts")){var curAppObj=zmsuite.getAppObj("zm_Contacts");zmTab.setTabForApp(curAppObj.obj),zmsuite.showApp("zm_Contacts"),zcon.contactLeft.setListener("click",function(data){zmcontact.bindLeftActions(data)}),zcon.contactLeft.setListener("contextmenu",function(data){zmcontact.bindLeftActions(data)});try{zcon.contactLeft.getNodes()[0].getLayer("VIEWS").setChildToggle(function(){}),zcon.contactLeft.getNodes()[0].getLayer("GROUPS").setChildToggle(function(){})}catch(e){}}else zmcontact.initContactSuite()};doAllowClick=function(element){return"disabled"==element.attr("disabled")?!1:!0},showPassWord=function(t){"msi-check"==t.className?(t.className="msi-uncheck",$("#zcs_export_password_div").hide(),$("#zcs_export_password_div").find("input").val("")):(t.className="msi-check",$("#zcs_export_password_div").show())};var logout=function(){var server_url=ZContacts.meta.serviceInfo.contacts_server_url,f=$('<form name="logoutForm" method="POST" action="'+server_url+'/logout"><input type="hidden" name="'+ZContacts.meta.serviceInfo.csrf_param_name+'" value="'+ZContacts.Cookie.getCSRFValue()+'"/></form>');$("body").append(f),f.submit()};return $.subscribe("contacts/metaDataLoaded",function(ev,obj){function refresh(){ZContacts.meta.autolist_enable&&(Contacts.refreshStaticList(),setTimeout(refresh,36e5))}var metaJson=obj.data;ZContacts.meta=metaJson,new URI(ZContacts.Accounts).include("user.categories").include("org.categories").include("contacts.total_count").GETS().then(function(resp){ZContacts.AccountsList=[],zmcontact.storeAccountsFromResponse(resp),ZContacts.setAccount(ZContacts.user),ZContacts.loadI18N=$.get(ZContacts.getContextPath()+"/new/jsp/i18n.jsp?"+metaJson.i18n_query_param),ZContacts.loadI18N.then(function(data){zmail.globalI18N.companyName&&zmail.globalI18N.companyName!=ZContacts.meta.rebrand_name&&$.each(data,function(key,value){value=value.replace(new RegExp("\\b"+ZContacts.meta.rebrand_name+"\\b","gi"),zmail.globalI18N.companyName),data[key]=value}),I18N.load(data),$.publish("contacts/i18NLoaded",{data:data}),(zmail.forContactsApp&&obj.showApp||window.location.hash==ZContacts.ZMailConstants.CONTACTS_HAS_TAG)&&(loadZCon(),ZContacts.meta.isLoaded=!0,$("#ms_load").remove()),0==ZContacts.meta.isLoaded&&$.publish("/contacts/load",{})})}),ZContacts.sortBy=4==ZContacts.meta.user.sort_by?"last_name":"first_name",zmail.forContactsApp&&refresh()}),$.subscribe("/contacts/load",function(){ZContacts.user?ZContacts.loadI18N.then(function(){ZContacts.meta.isLoaded=!0,loadZCon()}):"cn"==zmApp.currentApp&&(ZContacts.meta.isLoaded=!1)}),$.subscribe("/contacts/logout",function(){logout()}),initObj}();$(document).on("focusin",".SC_contApp #ztb-container #ztb-search-field",function(t){if(ZContacts.meta.autolist_enable&&ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT&&zmcontact.isRootFolder()){var val=$(t.srcElement).val();return removeSearchAutoList(!0),void Contacts.getInitialAutoList(val,showAutoList)}}),$(document).on("focusout",".SC_contApp #ztb-container #ztb-search-field",function(){removeSearchAutoList(!0)}),$(document).on("keyup",".SC_contApp #ztb-container #ztb-search-field",function(t){if(ZContacts.meta.autolist_enable&&ZContacts.getCurrentAccount().getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT&&zmcontact.isRootFolder()&&16!=t.which&&91!=t.which&&17!=t.which&&18!=t.which&&20!=t.which&&27!=t.which){removeSearchAutoList(!0);var val=$(t.srcElement).val();Contacts.getInitialAutoList(val,showAutoList)}}),ZContacts.ContactEditor=function(quickCreate,contacts,options){this.contact=contacts;var I18N=ZContacts.I18N;this.quickCreate=quickCreate,this.options=options,this.setOptions=function(options){this.options=options},this.getHTML=function(){var html=new ZContacts.StringBuilder;html.append("<div><div>"),html.append('<form class="SC_PUcen zcs-form2 zcs-editor" autocomplete="off"><div>'),html.append('<div class="zcs-field-group"><label id="zcs_name_label">').append(I18N.get("IAM.CONTACTS.NAME")).append("</label>"),html.append('<div class="zcs-field-row zcs-editor-name-cntnr">'),html.append('<input type="text" name="first_name" class="SC_tiput zcs-mr5" data-field-type="first_name" placeholder="').append(I18N.get("IAM.CONTACTS.FIRSTNAME")).append('">'),html.append('<input type="text" name="middle_name" data-field-type="middle_name" class="SC_tiput zcs-editor-qkcreate-hide zcs-ml5 zcs-mr10" placeholder="').append(I18N.get("IAM.CONTACTS.MIDDLENAME")).append('">'),html.append('<input type="text" name="last_name" data-field-type="last_name" class="SC_tiput zcs-mt10 zcs-mr5" placeholder="').append(I18N.get("IAM.CONTACTS.LASTNAME")).append('">'),html.append('<input type="text" name="nick_name" data-field-type="nick_name" class="SC_tiput zcs-editor-qkcreate-hide zcs-ml5 zcs-mt10 zcs-mr5" placeholder="').append(I18N.get("IAM.CONTACTS.BASIC.NNAME")).append('">'),html.append("</div></div>"),html.append('<div style="clear:both;" class="zcs-field-group"><label>').append(I18N.get("IAM.EMAIL.IDS")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="emails"  data-max-fields-count="5">'),html.append('<div class="zcs-mfield-row"><input type="text" data-field-type="email_id" name="email_id" class="SC_tiput" style="width: 49%">'),html.append('<i class="msi-fav SC_fav zcs-fav zcs-ml5"></i><i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-field-group"><label>').append(I18N.get("IAM.CONTACTS.BASIC.PHONE")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="phones"  data-max-fields-count="7">'),html.append('<div class="zcs-mfield-row"><input type="text" name="number" data-field-type="number" class="SC_tiput" style="width: 49%">'),html.append('<div class="SC_select" style="width: 150px; margin-left: 5px; height: 33px;  margin-top: -2px;">'),html.append('<select class= select zcs-phtype" name="type">'),html.append('<option value="mobile">').append(I18N.get("IAM.CONTACTS.BASIC.MOBILE")).append("</option>"),html.append('<option value="home">').append(I18N.get("IAM.CONTACTS.BASIC.HOME")).append("</option>"),html.append('<option value="work">').append(I18N.get("IAM.CONTACTS.BASIC.WORK")).append("</option>"),html.append('<option value="fax">').append(I18N.get("IAM.CONTACTS.BASIC.FAX")).append("</option>"),html.append('<option value="others">').append(I18N.get("IAM.CONTACTS.OTHERS")).append("</option>"),html.append("</select>"),html.append("</div>"),html.append('<i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-editor-qkcreate-hide">'),html.append('<div class="zcs-field-group"><label>').append(I18N.get("IAM.CONTACTS.IM.FULL")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="ims" data-max-fields-count="8">'),html.append('<div class="zcs-mfield-row"><input type="text" name="address" data-field-type="address" class="SC_tiput" style="width: 49%">'),html.append('<div class="SC_select" style="width: 150px; margin-left: 5px; height: 33px;  margin-top: -2px;">'),html.append('<select class= select zcs-phtype" name="type">'),html.append('<option value="google">').append(I18N.get("IAM.CONTACTS.IM.GOOGLE")).append("</option>"),html.append('<option value="yahoo">').append(I18N.get("IAM.CONTACTS.IM.YAHOO")).append("</option>"),html.append('<option value="skype">').append(I18N.get("IAM.CONTACTS.IM.SKYPE")).append("</option>"),html.append('<option value="aol">').append(I18N.get("IAM.CONTACTS.IM.AOL")).append("</option>"),html.append('<option value="icq">').append(I18N.get("IAM.CONTACTS.IM.ICQ")).append("</option>"),html.append('<option value="msn">').append(I18N.get("IAM.CONTACTS.IM.MSN")).append("</option>"),html.append('<option value="jabber">').append(I18N.get("IAM.CONTACTS.IM.JABBER")).append("</option>"),html.append('<option value="others">').append(I18N.get("IAM.CONTACTS.OTHERS")).append("</option>"),html.append("</select>"),html.append("</div>"),html.append('<i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-field-group"><label>').append(I18N.get("IAM.CONTACTS.URLS")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="urls"  data-max-fields-count="8">'),html.append('<div class="zcs-mfield-row"><input type="text" name="url" data-field-type="url" class="SC_tiput" style="width: 49%">'),html.append('<div class="SC_select" style="width: 150px; margin-left: 5px; height: 33px;  margin-top: -2px;">'),html.append('<select class= select zcs-phtype" name="type">'),html.append('<option value="home">').append(I18N.get("IAM.CONTACTS.EXPORT.PERSONALWEB.ADDRESS")).append("</option>"),html.append('<option value="work">').append(I18N.get("IAM.CONTACTS.EXPORT.COMPANYWEB.ADDRESS")).append("</option>"),html.append('<option value="blog">').append(I18N.get("IAM.CONTACTS.BLOG.URL")).append("</option>"),html.append('<option value="linkedin">').append(I18N.get("IAM.CONTACTS.LINKEDIN.URL")).append("</option>"),html.append('<option value="facebook">').append(I18N.get("IAM.CONTACTS.FACEBOOK.URL")).append("</option>"),html.append('<option value="twitter">').append(I18N.get("IAM.CONTACTS.TWITTER.URL")).append("</option>"),html.append('<option value="amazon">').append(I18N.get("IAM.CONTACTS.AMAZON.URL")).append("</option>"),html.append('<option value="flickr">').append(I18N.get("IAM.CONTACTS.FLICKR.URL")).append("</option>"),html.append('<option value="delicious">').append(I18N.get("IAM.CONTACTS.DELICIOUS.URL")).append("</option>"),html.append('<option value="others">').append(I18N.get("IAM.CONTACTS.OTHERS")).append("</option>"),html.append("</select>"),html.append("</div>"),html.append('<i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-field-group zcs-mt10"><label>').append(I18N.get("IAM.CONTACTS.PERSONAL")).append("</label>"),html.append('<div class="zcs-field-row">'),html.append('<label class="zcs-m0" style="display: inline-block;"><input type="radio" name="gender" value="M" class="zcs-mr5">').append(I18N.get("IAM.CONTACTS.GENDER.MALE")).append("</label>"),html.append('<label class="zcs-m0" style="display: inline-block;"><input type="radio" name="gender" value="F" class="zcs-ml30 zcs-mr5">').append(I18N.get("IAM.CONTACTS.GENDER.FEMALE")).append("</label></div>"),html.append('<div class="zcs-field-row"><div class="SC_select"  style="width: 75px;">'),html.append('<select class="select zcs-phtype" name="birth_day" >'),html.append('<option value="DD">').append(I18N.get("IAM.CONTACTS.DAY")).append("</option>");for(var i=1;31>=i;i++){var c=10>i?"0"+i:i;html.append("<option value="+c+">"+c+"</option>")}html.append("</select></div>"),html.append('<div class="SC_select" style="width: 125px; margin-left: 5px;" >'),html.append('<select class="select zcs-phtype" name="birth_month" >'),html.append('<option value="MM">').append(I18N.get("IAM.CONTACTS.MONTH")).append("</option>");for(var i=1;12>=i;i++){var c=10>i?"0"+i:i;html.append("<option value="+c+">").append(I18N.get("IAM.CONTACTS.MONTH."+c)).append("</option>")}return html.append("</select></div>"),html.append('<div style="display:inline-block;"><input class="SC_tiput" type="text" style="margin-left: 5px;width: 75px;" name="birth_year"/></div></div>'),html.append('<div class="zcs-single-field-row"><textarea name="notes" class="SC_tiput" rows="4" autocomplete="off" placeholder="').append(I18N.get("IAM.CONTACTS.NOTES")).append('"></textarea></div>'),html.append("</div>"),html.append('<div class="zcs-field-group" data-field-type="address/home"><label>').append(I18N.get("IAM.CONTACTS.OTHERS.HADDRESS")).append("</label>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="hme_street_addr" name="street_addr" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS")).append('" class="SC_tiput">'),html.append("</div>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="hme_street_addr1" name="street_addr1" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS1")).append('" class="SC_tiput">'),html.append("</div>"),html.append('<div class="zcs-field-row"><input type="text" data-field-type="hme_city" name="city" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.CITY")).append('" class="SC_tiput" style="width: 49.2%">'),html.append('<input type="text" data-field-type="hme_state" name="state" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.STATE")).append('" class="SC_tiput zcs-ml10" style="width: 49%">'),html.append("</div>"),html.append('<div class="zcs-field-row"><input type="text" data-field-type="hme_country" name="country" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.COUNTRY")).append('" class="SC_tiput" style="width: 49.2%">'),html.append('<input type="text" data-field-type="hme_postal_code" name="postal_code" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")).append('" class="SC_tiput zcs-ml10" style="width: 49%">'),html.append("</div>"),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-group" data-field-type="address/work"><label>').append(I18N.get("IAM.CONTACTS.EXPORT.WORK.ADDRESS")).append("</label>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="company" name="company" placeholder="').append(I18N.get("IAM.CONTACTS.COMPANY")).append('" class="SC_tiput">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-row"><input type="text" name="job_title" data-field-type="job_title" placeholder="').append(I18N.get("IAM.CONTACTS.JOBTITLE")).append('" class="SC_tiput" style="width: 49.2%">'),html.append('<input type="text" name="designation" data-field-type="designation" placeholder="').append(I18N.get("IAM.CONTACTS.DESIGNATION")).append('" class="SC_tiput zcs-ml10" style="width: 49%">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-single-field-row"><input type="text" data-field-type="wrk_street_addr" name="street_addr" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS")).append('" class="SC_tiput">'),html.append("</div>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="wrk_street_addr1" name="street_addr1" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS1")).append('" class="SC_tiput">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-row"><input type="text" data-field-type="wrk_city" name="city" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.CITY")).append('" class="SC_tiput" style="width: 49.2%">'),html.append('<input type="text" data-field-type="wrk_state" name="state" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.STATE")).append('" class="SC_tiput zcs-ml10" style="width: 49%">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-row"><input type="text" data-field-type="wrk_country" name="country" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.COUNTRY")).append('" class="SC_tiput" style="width: 49.2%">'),html.append('<input type="text" data-field-type="wrk_postal_code" name="postal_code" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")).append('" class="SC_tiput zcs-ml10" style="width: 49%">'),html.append("</div>"),html.append("</div>"),html.append("</div>"),html.append('<div class="SC_lnk zcs-add-moreinfo zcs-editor-qkcreate-show">').append(I18N.get("IAM.CONTACTS.ADDMORE")).append("</div>"),html.append('<div style="height: 10px;"></div>'),html.append("</div></form></div>"),html.append('<div class="zcs-editor-qkcreate-hide SC_PUbtm zc_add_contact_button">'),this.options.actions.merge&&zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID?(html.append('<span id="zcs-merge-btn" data-field-type="zcs-merge-btn" >').append(I18N.get("IAM.MERGE")).append("</span>"),html.append('<span style="margin-left: 10px;" data-field-type="zcs-delete-btn" id="zcs-delete-btn" data-val="Cancel">').append(I18N.get("IAM.DELETE")).append("</span>"),html.append('<span style="margin-left: 10px;" data-field-type="zcs-skip-btn" id="zcs-skip-btn" data-val="Cancel">').append(I18N.get("IAM.SKIP")).append("</span>")):this.options.actions.merge?html.append('<span id="zcs-merge-btn" data-field-type="zcs-merge-btn" >').append(I18N.get("IAM.MERGE")).append("</span>"):html.append('<span id="zcs-save-btn" data-field-type="zcs-save-btn">').append(I18N.get("IAM.SAVE")).append("</span>"),html.append('<span data-val="Cancel" data-field-type="zcs-cancel-btn" id="zcs-cancel-btn" style="margin-left: 10px;" data-val="Cancel">'+I18N.get("IAM.CANCEL")+"</span>"),html.append("</div></div>"),html.toString()},this.bindEvents=function(){$(".zcs-mfield").each(function(){var $mfields=$(this);1==$mfields.find(".zcs-mfield-row").length&&$mfields.find(".zcs-close-mrow").hide()}),this.$e.find('[data-field-type="emails"] .zcs-fav').click(function(){var $this=$(this);$this.parent(".zcs-mfield-row").siblings().find(".SC_fav").removeClass("SC_fav"),$this.addClass("SC_fav")}),this.$e.find(".zcs-mfield .SC_tiput").keyup(function(){var $row=$(this).parent(".zcs-mfield-row"),$siblings=$row.siblings(),maxFields=parseInt($(this).parents(".zcs-mfield").attr("data-max-fields-count"));if(zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&1!=quickCreate||!(maxFields<=$siblings.length+1)){var $input=$(this);if(!($input.val().trim().length<1||$siblings.length>0&&!$row.is(":last-child"))){0==$siblings.length&&$row.find(".zcs-close-mrow").show();var $newRow=$row.clone(!0);$newRow.find(".SC_tiput").val(""),$newRow.find(".zcs-fav").removeClass("SC_fav"),$newRow.insertAfter($row)}}}),this.$e.find(".zcs-mfield .zcs-close-mrow").click(function(){var $row=$(this).parent(".zcs-mfield-row"),$siblings=$row.siblings(),findIcon=$row.find(".SC_fav");0!=findIcon.length&&$($siblings[0]).find(".zcs-fav").addClass("SC_fav"),1==$siblings.length&&($siblings.find(".zcs-close-mrow").hide(),$siblings.find(".zcs-fav").addClass("SC_fav")),$row.remove()});var _this=this;this.quickCreate&&this.$e.find(".zcs-add-moreinfo").click(function(){zmcontact.createContactInTab(_this),zmsDialog.remove()}),this.$e.find("span[data-field-type=zcs-save-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.save&&_this.options.actions.save.apply(_this)}),this.$e.find("span[data-field-type=zcs-cancel-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.cancel&&_this.options.actions.cancel.apply(_this)}),this.$e.find("span[data-field-type=zcs-skip-btn]").click(function(event){_this.options&&_this.options.actions&&_this.options.actions.skip&&(_this.options.actions.skip.apply(_this),event.stopPropagation())}),this.$e.find("span[data-field-type=zcs-delete-btn]").click(function(event){_this.options&&_this.options.actions&&_this.options.actions.deleteContact&&(_this.options.actions.deleteContact.apply(_this),event.stopPropagation())}),this.$e.find("span[data-field-type=zcs-merge-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.merge&&_this.options.actions.merge.apply(_this)})},this.bindEditEvents=function(){var _this=this.$e;this.$e.find(".zcs-add-moreinfo").click(function(){_this.removeClass("zcs-editor-qkcreate"),_this.find(".SC_PUbtm").addClass("zmModeBG"),_this.find(".SC_PUbtm").addClass("zcs_edit_modify")})},this.handleQuickCreate=function(){this.quickCreate?this.$e.addClass("zcs-editor-qkcreate"):(this.$e.removeClass("zcs-editor-qkcreate"),this.$e.find(".SC_PUbtm").addClass("zcs_edit_modify"))},this.render=function($containerEle,override,action){this.$e=$(this.getHTML()),override?$containerEle.html(this.$e):$containerEle.append(this.$e),this.bindEvents(),"merge"==action?(this.$e.css("min-width","600px"),this.$e.find(".SC_PUbtm").addClass("zmModeBG"),this.$e.find(".SC_PUbtm").addClass("zcs_edit_modify")):this.$e.addClass("zcs-editor-qkcreate"),this.quickCreate?this.$e.parent().css("max-height","465px"):(this.$e.css("max-width","700px"),this.$e.find(".zcs-add-moreinfo").text(I18N.get("IAM.CONTACTS.EDITMORE")),this.$e.parent().find(".SC_PUbtm").show()),this.setValue(),this.$e.hasClass("zcs-editor-qkcreate")&&this.bindEditEvents()},this.rerender=function($containerEle,quickCreate){this.quickCreate=quickCreate,this.handleQuickCreate(),zmail.forContactsApp||this.bindEvents(),$containerEle.append(this.$e)},this.toContactsModel=function(contact){this.$e.find('[name="first_name"]').val().trim()&&contact.set("first_name",this.$e.find('[name="first_name"]').val()),this.$e.find('[name="company"]').val().trim()&&contact.set("company",this.$e.find('[name="company"]').val().trim());for(var $mailRows=this.$e.find('[data-field-type="emails"] .zcs-mfield-row'),isPrimaryExists=!1,emailSize=0,addEmail=0,i=0;i<$mailRows.length;i++){var $mRow=$($mailRows[i]),$input=$mRow.find('[name="email_id"]'),mailid=$input.val().trim(),primary=$mRow.find(".zcs-fav").hasClass("SC_fav");if(mailid){if(emailSize++,emailSize>5)return $input.focus(),void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.EMAIL.LIMIT.REACHED"));if(!ZContacts.Utils.isEmailId(mailid))return $input.focus(),void zmUtil.succErrMsg("e",I18N.get("IAM.ERROR.VALID.EMAIL"));primary&&!isPrimaryExists&&(isPrimaryExists=!0);var emailModel=ZContacts.Emails.create({email_id:mailid,is_primary:primary});contact.addSubResource(emailModel),addEmail++}}if(!isPrimaryExists&&0!=addEmail)return zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.PRIMARY.EMAIL.EMPTY")),void contact.clearSubResources();var fname=contact.first_name?contact.first_name.trim():void 0,company=contact.company?contact.company.trim():void 0,hasEmail=!contact.get("emails")||!contact.get("emails").length;if(!fname&&contact.get("emails")){var primaryEmail=contact.getPrimaryEmail(),getName=primaryEmail.substring(0,primaryEmail.lastIndexOf("@")),name=getName.charAt(0).toUpperCase()+getName.slice(1).toLowerCase();contact.set("first_name",name)}if(!fname&&hasEmail&&!company)return this.$e.find('[name="first_name"]').focus(),zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.FIRST.NAME.REQUIRED")),null;this.$e.find('[name="middle_name"]').val().trim()&&contact.set("middle_name",this.$e.find('[name="middle_name"]').val().trim()),this.$e.find('[name="last_name"]').val().trim()&&contact.set("last_name",this.$e.find('[name="last_name"]').val().trim()),this.$e.find('[name="nick_name"]').val().trim()&&contact.set("nick_name",this.$e.find('[name="nick_name"]').val().trim());for(var $phoneRows=this.$e.find('[data-field-type="phones"] .zcs-mfield-row'),phoneSize=0,i=0;i<$phoneRows.length;i++){var $pRow=$($phoneRows[i]),$input=$pRow.find('[name="number"]'),number=$input.val().trim(),phNo=ZContacts.Utils.replaceNbsps(number);if(phNo){if(phNo.length>"30")return $input.focus(),void zmUtil.succErrMsg("e",zmcontact.formatMessage(I18N.get("IAM.CONTACTS.EXCEED.MAX.LENGTH"),I18N.get("IAM.CONTACTS.PRINT.SAMPLE.PHONE"),30));if(!ZContacts.Utils.isValidPhoneNumber(phNo))return $input.focus(),void zmUtil.succErrMsg("e",zmcontact.formatMessage(I18N.get("IAM.ERROR.INVALID.PHONE.NUMBERS"),phNo));if(phoneSize++,phoneSize>8)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.PHONE.LIMIT.REACHED"));var phoneModel=ZContacts.PhoneNumbers.create({number:phNo,type:$pRow.find('[name="type"]').val()});contact.addSubResource(phoneModel)}}for(var $ImsRows=this.$e.find('[data-field-type="ims"] .zcs-mfield-row'),imsSize=0,i=0;i<$ImsRows.length;i++){var $imsRow=$($ImsRows[i]),$input=$imsRow.find('[name="address"]'),Ims=$input.val().trim();if(Ims&&!ZContacts.Utils.isUserName(Ims)&&!ZContacts.Utils.isEmailId(Ims))return $input.focus(),void zmUtil.succErrMsg("e",zmcontact.formatMessage(I18N.get("IAM.ERROR.INVALID.IM"),Ims));if(Ims){if(imsSize++,imsSize>8)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.IMS.LIMIT.REACHED"));var ims=ZContacts.Ims.create({address:Ims,type:$imsRow.find('[name="type"]').val()});contact.addSubResource(ims)}}for(var $urlRows=this.$e.find('[data-field-type="urls"] .zcs-mfield-row'),urlSize=0,i=0;i<$urlRows.length;i++){var $urlRow=$($urlRows[i]),$input=$urlRow.find('[name="url"]'),urls=$input.val().trim();if(urls){if(urlSize++,urlSize>8)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.URLS.LIMIT.REACHED"));var urlModel=ZContacts.Urls.create({url:urls,type:$urlRow.find('[name="type"]').val()});contact.addSubResource(urlModel)}}this.$e.find('[name="gender"]:checked').val()&&contact.set("gender",this.$e.find('[name="gender"]:checked').val());var birthMonth=this.$e.find('[name="birth_month"] option:selected').val(),birthDate=this.$e.find('[name="birth_day"] option:selected').val(),birthYear=this.$e.find('[name="birth_year"]').val().trim();if(birthYear&&!ZContacts.Utils.isValidBirthYear(birthYear))return zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.INVALID.BIRTH.YEAR")),void this.$e.find('[name="birth_year"]').focus();if(birthYear){if("DD"==birthDate||"MM"==birthMonth)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ENTER.VALID.BDATE"));contact.set("birth_year",birthYear)}if("DD"!=birthDate||"MM"!=birthMonth){if("DD"==birthDate||"MM"==birthMonth)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ENTER.VALID.BDATE"));contact.set("birth_month",birthMonth),contact.set("birth_day",birthDate)}this.$e.find('[name="job_title"]').val().trim()&&contact.set("job_title",this.$e.find('[name="job_title"]').val().trim()),this.$e.find('[name="designation"]').val().trim()&&contact.set("designation",this.$e.find('[name="designation"]').val().trim()),this.$e.find('[name="notes"]').val().trim()&&contact.set("notes",this.$e.find('[name="notes"]').val().trim());var $home_address=this.$e.find('[data-field-type="address/home"]'),homeAddress=ZContacts.Address.create({});$home_address.find('[name="street_addr"]').val().trim()&&(homeAddress.street_addr=$home_address.find('[name="street_addr"]').val().trim()),$home_address.find('[name="street_addr1"]').val().trim()&&(homeAddress.street_addr1=$home_address.find('[name="street_addr1"]').val().trim()),$home_address.find('[name="city"]').val().trim()&&(homeAddress.city=$home_address.find('[name="city"]').val().trim()),$home_address.find('[name="state"]').val().trim()&&(homeAddress.state=$home_address.find('[name="state"]').val().trim()),$home_address.find('[name="country"]').val().trim()&&(homeAddress.country=$home_address.find('[name="country"]').val().trim()),$home_address.find('[name="postal_code"]').val().trim()&&(homeAddress.postal_code=$home_address.find('[name="postal_code"]').val().trim()),homeAddress.type="home",contact.addSubResource(homeAddress);var $work_address=this.$e.find('[data-field-type="address/work"]'),workAddress=ZContacts.Address.create({});return $work_address.find('[name="street_addr"]').val().trim()&&(workAddress.street_addr=$work_address.find('[name="street_addr"]').val().trim()),$work_address.find('[name="street_addr1"]').val().trim()&&(workAddress.street_addr1=$work_address.find('[name="street_addr1"]').val().trim()),$work_address.find('[name="city"]').val().trim()&&(workAddress.city=$work_address.find('[name="city"]').val().trim()),$work_address.find('[name="state"]').val().trim()&&(workAddress.state=$work_address.find('[name="state"]').val().trim()),$work_address.find('[name="country"]').val().trim()&&(workAddress.country=$work_address.find('[name="country"]').val().trim()),$work_address.find('[name="postal_code"]').val().trim()&&(workAddress.postal_code=$work_address.find('[name="postal_code"]').val().trim()),workAddress.type="work",contact.addSubResource(workAddress),contact},this.setValue=function(){this.contact&&this.setValueInContainer(this.$e,this.contact)},this.setValueInContainer=function($container,obj){for(var k in obj)if(obj.hasOwnProperty(k)&&"categories"!=k){var value=obj.get(k);if(value)if($.isArray(value))if("address"===k)for(var i=0;i<value.length;i++){var addr=value[i],$addressContainer=$container.find('[data-field-type="address/'+addr.get("type")+'"]');this.setValueInContainer($addressContainer,addr)}else{for(var $multiContainer=$container.find('[data-field-type="'+k+'"]'),vi=0,i=0;i<value.length;i++){var vObj=value[i];if(vObj.is_primary&&"emails"===k){var v1=vObj.get("email_id"),$input=$multiContainer.find('[name="email_id"]').eq(vi);vi++,this.setValueToInput($input,v1),$input.keyup()}}"emails"!=k&&(vi=0);for(var i=0;i<value.length;i++){var vObj=value[i];for(var k1 in vObj)if(vObj.hasOwnProperty(k1)&&!vObj.is_primary&&"is_primary"!==k1){var v1=vObj.get(k1),$input=$multiContainer.find('[name="'+k1+'"]').eq(vi);"emails"==k&&vi++,$input.length>0&&(this.setValueToInput($input,v1),$input.keyup()),"is_primary"===k1&&"emails"===k&&v1&&$multiContainer.find(".zcs-fav").eq(vi).click()}"emails"!=k&&vi++}}else{var $input=$container.find('[name="'+k+'"]');this.setValueToInput($input,value)}}},this.setValueToInput=function($input,value){if($input.length>1){if($input.is(":radio"))for(var i=0;i<$input.length;i++){var elem=$input.get(i);elem.value===value&&(elem.checked=!0)}}else $input.val(value)}};var zmContactsSearch=function(){"use strict";function ContactsSearchCollection(obj){this.searchQueryArr=[],this.advSearchStr=obj&&obj.advSearchStr||[],this.searchList={},this.searchOrder=[],this.hasNext=1,this.start=1,this.limit=50,this.sending=!1,this.nextPage=!1}function ContactsSearchView(){}var hasMore=!1,page=1;ZContacts.isSearchLoading=!1,ContactsSearchCollection.prototype={setAdvSearchStr:function(str){this.advSearchStr=str},hasNextPage:function(request){request.nextPage=!0,hasMore&&this.sendRequest(zmcontact.searchValue)},setSearchQueryArr:function(arr){this.searchQueryArr=arr;var sString=this.getSearchQueryFromArr(this.searchQueryArr);this.setAdvSearchStr(sString)},addSearchList:function(searchObj){zmcontact.contactsList(searchObj,this.nextPage,!1),searchObj.order||(searchObj.order=[]),searchObj.list||(searchObj.list={})},sendRequest:function(squery){var params={},curObj=this;if(!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)||squery){this.sending=!0;var start=this.start;params.start=start,ZContacts.page=page,params.limit=this.limit,params.search=this.advSearchStr.length>0?this.advSearchStr:squery,zmcontact.searchValue=params.search,params.taction="searchContacts",params.isPrev="false",params.groupId=zmail.zuid,params.isNextPage=this.nextPage;var searchRequest=function(){var URI=ZContacts.URI;ZContacts.page=params.isNextPage?page+1:params.start;var uri=new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).include("emails").include("phones").addSearchQuery(params.search).setPagination(ZContacts.page,params.limit);return ZContacts.newSearchDeletedCount>0&&uri.prependContacts(ZContacts.newSearchDeletedCount),ZContacts.isSearchLoading=!0,uri.GETS().then(function(json){hasMore=json._apiResponse.has_more,ZContacts.isSearchLoading=!1,curObj.searchResponse(json)},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})};searchRequest()}},searchResponse:function(resp){this.sending=!1,this.addSearchList(resp)},flushData:function(){},getSearchQueryFromArr:function(){return this.searchQueryArr[0].All?this.searchQueryArr[0].All:this.searchQueryArr[0].Name?this.searchQueryArr[0].Name:this.searchQueryArr[0].Phone?this.searchQueryArr[0].Phone:this.searchQueryArr[0].Email?this.searchQueryArr[0].Email:this.searchQueryArr[0].Address?this.searchQueryArr[0].Address:this.searchQueryArr[0].Notes?this.searchQueryArr[0].Notes:this.searchQueryArr[0].Company?this.searchQueryArr[0].Company:void 0},getSearchVal:function(){}};var viewObj={getHeaderObj:function(){var headerObj={left:{leftHTML:"<b>"+ZContacts.I18N.get("IAM.CONTACTS.SEARCH.RESULTS")+"</b>"},right:[]};return headerObj},getActionObj:function(){var actionObj={list:{left:zmcontact.getActionMenuList(),right:[{actionArr:[{iconList:["msi-close"],tooltip:"Close Tab"}]}]}};return actionObj},getActionObjHandler:function(event,iconName){zmcontact.bindHeaderIcons(event,iconName)},constructCenter:function(){var centerNodes=zmsuite.getCenter()[0].getNodes();centerNodes[1].push(viewObj.getActionObj()),centerNodes[2].setListener("click",function(event){zmcontact.bindEventsContactsRow(event)}),centerNodes[2].setListener("contextmenu",function(){}),zmsuite.renderCenter()},bind:function(){viewObj.constructCenter()}};return ContactsSearchView.prototype=Object.create(SearchOuterView.prototype),$.extend(ContactsSearchView.prototype,viewObj),{contactsCollection:ContactsSearchCollection,contactsView:ContactsSearchView}}();ZContacts.importContacts={zid:void 0,categoryId:void 0,fileKey:void 0};var resetImportContacts=function(){$.each(ZContacts.importContacts,function(key){ZContacts.importContacts[key]=void 0})};ZContacts.syncResponse=function(data){if("failed"==data.result)return zmUtil.succErrMsg("e",data.error_message),1==data.sync_now?void zmsuite.getCenter()[0].getNodes()[2].$el.find("#googleSyncDetails").find(".zcs_import_header_two").html(ZContacts.I18N.get("IAM.GOOGLE.LAST.SYNC.TIME")+ZContacts._syncedTime):void syncSummeryWorkspace();zmUtil.succErrMsg("s",ZContacts.I18N.get("CONTACT.SYNC.SUCCESS")),zmsDialog.remove(),$("#zcs_twowaySyncPopup").remove(),ZContacts._sync=!0,ZContacts._authenticatedMailId=data.authenticatedMailId;var date=new Date(parseInt(data.lastSyncedTime));ZContacts._syncedTime=date.toLocaleDateString()+","+date.toLocaleTimeString(),ZContacts._enableStatus=data.enableDisableStatus,1==data.sync_now?zmsuite.getCenter()[0].getNodes()[2].$el.find("#googleSyncDetails").find(".zcs_import_header_two").html(ZContacts.I18N.get("IAM.GOOGLE.LAST.SYNC.TIME")+ZContacts._syncedTime):syncSummeryWorkspace();try{var acc=zmcontact.getAccountByZid(ZContacts.importContacts.zid);(acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||acc.getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&zmcontact.invokeEvent("contactsApp/refresh",acc.getAccountId())}catch(e){}var rootFolderId=ZContacts.AccountsVsRootFolderMap[ZContacts.importContacts.zid];category=zmcontact.getCategory(ZContacts.importContacts.categoryId&&-1!=ZContacts.importContacts.categoryId?ZContacts.importContacts.categoryId:rootFolderId),zmcontact._loadContacts(category),zmcontact.refreshContactCounts(ZContacts.importContacts.zid)},ZContacts.importResponse=function(data){if("failed"==data.result)return void zmUtil.succErrMsg("e",data.error_message);var duplicateContacts,contactImport=new ZContacts.contactimport;data.duplicate_email_ids&&(duplicateContacts={duplicate_email_ids:data.duplicate_email_ids}),contactImport.createPageContent(getHtmlForFinishImport(!0,data.total_count,data.added_count,data.updated_count,duplicateContacts,data.message),!1);try{var acc=zmcontact.getAccountByZid(ZContacts.importContacts.zid);(acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||acc.getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&zmcontact.invokeEvent("contactsApp/refresh",acc.getAccountId())}catch(e){}};var getErrorDetailsInHtml=function(key,field){var html=new ZContacts.StringBuilder;return html.append('<li style="margin-bottom: -40px;line-height: 3.5em;" class="zcs_im_align"><span>'+zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.INVALID.FIELDS.COUNT"),field)+"</span>"),html.append('<span data-val="'+key+'" onclick="errorValuesPopup(\''+key+"','"+field+'\');" class="SC_lnk zcs_show_popup">'+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span><br></li>"),html};ZContacts.contactimport=function(){var encodeHTML=ZContacts.Utils.encodeHTML,enableSync=!0;getHtmlForImport=function(){var html=new ZContacts.StringBuilder,zid=ZContacts.getCurrentAccount().account_id,rootFolderIdPopUp=ZContacts.AccountsVsRootFolderMap[zid];rootFolderIdPopUp==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS?importSyncPopUp=!0:rootFolderIdPopUp==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?importSyncPopUp=!1:rootFolderIdPopUp.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS&&(importSyncPopUp=!1);var categoryName,rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId),acc=ZContacts.AccountsVsRootFolderMap[rootFolderId],categoryId=ZContacts._currentCategoryId,rootFolderId=zmcontact.getRootFolderId(categoryId),category=zmcontact.getCategory(categoryId);return zmcontact.isRootFolder(categoryId)?(categoryName=ZContacts.I18N.get("IAM.CONTACTS.ALL.CONTACTS"),categoryId=rootFolderId):categoryName=category.category_name,html.append('<div id="syncContinue" style="padding-left : 1%;"><h4>'+ZContacts.I18N.get("IAM.CONTACTS.WHERE.IMPORT")+"</h4>"),html.append('<div style="margin-left: 2%;margin-bottom: 5%;"><p>'+ZContacts.I18N.get("IAM.CONTACTS.WHICH.CATEGORY")+"</p>"),html.append('<div class="SC_flt">'),html.append('<b id="zcs_account"><input class="SC_tiput" id='+acc.getAccountId()+' name="'+encodeHTML(acc.getName())+'" placeholder="'+encodeHTML(acc.getName())+'" onclick="zmcontact.getScrollList($(this), \'account\', true)" readonly=readonly style="width: 200px;cursor: pointer;"></b>'),html.append('<b id="zcs_category"><input class="SC_tiput" id='+categoryId+' name="'+encodeHTML(categoryName)+'" placeholder="'+encodeHTML(categoryName)+'" onclick="zmcontact.getScrollList($(this), \'category\', true)" readonly=readonly style="width: 200px;margin-left: 30px;cursor: pointer;"></b>'),html.append("</div></div>"),html.append('<span class="zcs_im_border_bottom" style="width: 94%"></span>'),html.append("</div><br>"),1==ZContacts._sync&&html.append(getHtmlForSync()),html.append('<div style="padding-top: 1%;padding-left: 1%;"><h4>'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FILE.EMAIL.PROVIDER")+"</h4></div>"),html.append('<label><div class="zcs_import_box" id="local_file" onclick= "fileImportPopUp()">'),html.append('<div class="zcs_import_img_main"><img class="zcs_import_img" src='+ZContacts.meta.serviceInfo.contacts_server_url+"/images/import/file.png></div>"),html.append('<div class="zcs_import_txt_main"><span class="zcs_import_header">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.LOCAL.DRIVE")+"</span>"),html.append('<span class="zcs_import_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FROM.FILE")+"</span></div>"),html.append("</div></label>"),zmail.isCN||(html.append(0==importSyncPopUp?'<div class="zcs_import_box" id="google" onclick = "importGoogle()">':1==ZContacts._sync?'<div class="zcs_import_box" id="google" onclick = "importGoogle()">':'<div class="zcs_import_box" id="google" onclick = "twoWaySyncPopup()">'),html.append('<div class="zcs_import_img_main"><img class="zcs_import_img" src='+ZContacts.meta.serviceInfo.contacts_server_url+"/images/import/google.png></div>"),html.append('<div class="zcs_import_txt_main"><span class="zcs_import_header">'+ZContacts.I18N.get("IAM.CONTACTS.GMAIL")+"</span>"),html.append(0==importSyncPopUp?'<span class="zcs_import_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FROM.GOOGLE")+"</span>":1==ZContacts._sync?'<span class="zcs_import_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FROM.GOOGLE")+"</span>":'<span class="zcs_import_header_two">'+ZContacts.I18N.get("IAM.IMPORT.SUPPORT.TWO.WAY.SYNC")+"</span>"),html.append("</div></div>")),zmail.isFuji||(html.append('<div class="zcs_import_box" id="yahoo" onclick="importYahoo()">'),html.append('<div class="zcs_import_img_main"><img class="zcs_import_img" src='+ZContacts.meta.serviceInfo.contacts_server_url+"/images/import/yahoo.png></div>"),html.append('<div class="zcs_import_txt_main"><span class="zcs_import_header">'+ZContacts.I18N.get("IAM.CONTACTS.YAHOO")+"</span>"),html.append('<span class="zcs_import_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.YAHOO.ACCOUNT")+"</span>"),html.append("</div></div>")),html.append('<div class="zcs_import_box" id="outlook" onclick ="importOutlook()">'),html.append('<div class="zcs_import_img_main"><img class="zcs_import_img" src='+ZContacts.meta.serviceInfo.contacts_server_url+"/images/import/outlook.png></div>"),html.append('<div class="zcs_import_txt_main"><span class="zcs_import_header">'+ZContacts.I18N.get("IAM.CONTACTS.OUTLOOK")+"</span>"),html.append('<span class="zcs_import_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.OUTLOOK.ACCOUNT")+"</span>"),html.append("</div></div>"),html.append("</div>"),html.toString()},getHtmlForSync=function(){var html=new ZContacts.StringBuilder;return html.append('<div id="sync"><div style="padding-top: 1%;padding-left: 1%;"><h4>'+ZContacts.I18N.get("IAM.GOOGLE.SYNCED.CONTACTS")+"</h4></div>"),html.append('<div class="zcs_sync_box" id="googleSync" onclick="showSyncDetails()">'),html.append('<div class="zcs_import_img_main"><img class="zcs_import_img" src='+ZContacts.meta.serviceInfo.contacts_server_url+"/images/import/google.png></div>"),html.append('<div class="zcs_import_txt_main"><span class="zcs_import_header">'+ZContacts.I18N.get("IAM.GOOGLE.TWO.WAY.SYNC")+"</span>"),html.append('<span class="zcs_import_header_two" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;">'+zmcontact.formatMessage(ZContacts.I18N.get("IAM.GOOGLE.SYNCED.ACCOUNT"),ZContacts._authenticatedMailId)+"</span></div>"),html.append("true"==ZContacts._enableStatus?'<div class="zcs_toggle_btn" onclick="onOffButton(event)" style="float: right;"><input type="checkbox"  style="cursor: pointer;" class="radio_input" onclick="" checked><div class="radio_style"></div></div>':'<div class="zcs_toggle_btn" onclick="onOffButton(event)" style="float: right;"><input type="checkbox"  style="cursor: pointer;" class="radio_input" onclick="" unchecked><div class="radio_style"></div></div>'),html.append("</div><br>"),html.append('<div class="zcs_sync_details hide" id="googleSyncDetails" >'),html.append('<div class="zcs_import_img_main"><img class="zcs_import_img" src='+ZContacts.meta.serviceInfo.contacts_server_url+"/images/import/google.png></div>"),html.append('<div class="zcs_import_txt_main"><span class="zcs_import_header">'+ZContacts.I18N.get("IAM.GOOGLE.TWO.WAY.SYNC")+"</span>"),html.append('<span class="zcs_import_header_two">'+ZContacts.I18N.get("IAM.GOOGLE.LAST.SYNC.TIME")+ZContacts._syncedTime+"</span></div>"),html.append('<div style="margin-top: 25px;"><span class="zcs_sync_header">'+ZContacts.I18N.get("IAM.GOOGLE.SYNCED.ACCOUNT.HEADER")+'</span><span style="display: block;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;width: 350px;">'+ZContacts._authenticatedMailId+"</span></div>"),html.append('<div style="margin-top: 25px;"><span class="zcs_sync_header">'+ZContacts.I18N.get("IAM.GOOGLE.SYNC.FREQUENCY")+'</span><span style="font-size: 14px;color: #000000;">'+ZContacts.I18N.get("IAM.GOOGLE.SYNC.DAILY")+"</span></div>"),html.append('<div style="margin-top: 25px;"><span class="zcs_sync_header">'+ZContacts.I18N.get("IAM.GOOGLE.DAILY.SYNC")+"</span>"),html.append("true"==ZContacts._enableStatus?'<div class="zcs_toggle_btn" onclick="onOffButton(event)"><input type="checkbox" style="cursor: pointer;" class="radio_input" checked><div class="radio_style"></div></div></div>':'<div class="zcs_toggle_btn" onclick="onOffButton(event)"><input type="checkbox" style="cursor: pointer;" class="radio_input" unchecked><div class="radio_style"></div></div></div>'),html.append('<div class="SC_PUbtm"><span data-field-type="zcs-sync-now" onclick="syncNow()" >').append(ZContacts.I18N.get("IAM.GOOGLE.SYNC.NOW")).append("</span>"),html.append('<span style="margin-left: 10px;" data-val="Cancel" data-field-type="zcs-revoke-btn" onclick="revokeSync()" data-val="Cancel">'+ZContacts.I18N.get("IAM.GOOGLE.DEACTIVATE.SYNC")+"</span>"),html.append('<span style="margin-left: 10px;" data-field-type="zcs-cancel-btn" data-val="Cancel" onclick="showSyncDetails()">'+ZContacts.I18N.get("IAM.CANCEL")+"</span>"),html.append("</div></div></div>"),html.append('<span class="zcs_im_border_bottom" style="width: 94%"></span><br>'),html.toString()},onOffButton=function(event){event.stopPropagation();var zid=$("#zcs_account").find("input").attr("id");zid&&(1==$(event.currentTarget).find(".radio_input").prop("checked")?new ZContacts.URI(ZContacts.EnableSync,zid).PUT().then(function(response){}):new ZContacts.URI(ZContacts.DisableSync,zid).PUT().then(function(response){}))},showSyncDetails=function(){var $gSyncElem=$("#googleSync");if($gSyncElem.hasClass("hide")){var check=$("#googleSyncDetails").find(".zcs_toggle_btn").find(".radio_input").prop("checked");if($("#googleSyncDetails").addClass("hide"),$gSyncElem.removeClass("hide"),$gSyncElem.find(".zcs_toggle_btn").find(".radio_input").prop("checked")==check)return;$gSyncElem.find(".zcs_toggle_btn").find(".radio_input").prop("checked",check)}else{var check=$gSyncElem.find(".zcs_toggle_btn").find(".radio_input").prop("checked");if($("#googleSyncDetails").removeClass("hide"),$gSyncElem.addClass("hide"),$("#googleSyncDetails").find(".zcs_toggle_btn").find(".radio_input").prop("checked")==check)return;$("#googleSyncDetails").find(".zcs_toggle_btn").find(".radio_input").prop("checked",check)}},fileImportPopUp=function(){var fileImportPopUpDiv={};fileImportPopUpDiv.title=ZContacts.I18N.get("IAM.IMPORT.CONTACTS.FILE"),fileImportPopUpDiv.mask=!0,fileImportPopUpDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_fileimportpopup").remove()},fileImportPopUpDiv.pos="center";var createFolElem=$("<div id='zcs_fileimportpopup'></div>");if(!$("#zcs_fileimportpopup").length){var html="<div class='SC_tdtl'>";html=html+"<div>"+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.SUPPORTED.FILE")+"</div></br>",html=html+"<div>"+ZContacts.I18N.get("IAM.CONTACTS.5000.FILE.IMPORT")+"</div></br>",html=html+"<label style='display: inline;'><div class='SC_PUbtm' style='float: left; margin-top : 10px;' onchange='processFile();'><span class='sel'>"+ZContacts.I18N.get("IAM.CONTACTS.FEEDBACK.UPLOAD")+"</span><form name='importlocalForm' id='import' enctype='multipart/form-data' method='Post'><input name='importcontact' id='importFile' accept='.ldif,.csv,.vcf' type='file' style='display: none;'/></form></div><div class='zcs_new_loading hide'></div></label>",createFolElem.append(html)}$(document.body).append(createFolElem),zmsDialog.create("zcs_fileimportpopup",fileImportPopUpDiv),$("#zcs_fileimportpopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_fileimportpopup").parents(".SC_Pop").on("click",function(){this.remove()})},twoWaySyncPopup=function(){var enableSyncDiv={};if(enableSyncDiv.title=ZContacts.I18N.get("IAM.IMPORT.CONTACTS.VIA.GOOGLE"),enableSyncDiv.mask=!0,enableSyncDiv.buttons=[{txt:ZContacts.I18N.get("IAM.CONTACTS.IMPORT"),selected:!0,callback:function(){enableSync=$("input[name=enable_sync]:checked").val(),"true"==enableSync?importGoogleSync():importGoogle(enableSync)}},{isCancel:!0,txt:ZContacts.I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove(),$("#zcs_twowaySyncPopup").remove()}}],enableSyncDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_twowaySyncPopup").remove()},enableSyncDiv.pos="center",createFolElem=$("<div id='zcs_twowaySyncPopup'></div>"),!$("#zcs_twowaySyncPopup").length){var html="<div class='SC_tdtl'>";html=html+"<div><input type='radio' id='disable_sync' style='height: 14px;cursor: pointer;' name='enable_sync' value='false' checked/><label for='disable_sync'><span style='padding:  5px;'>"+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FROM.GOOGLE")+"</span></br><span style='margin-left: 25px;font-size: 13px;'>"+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.MESSAGE")+"</span></label></div><br>",html=html+"<div><input type='radio' id='enable_sync' style='height: 14px;cursor: pointer;' name='enable_sync' value='true'/><label for='enable_sync'><span style='padding:  5px;'>"+ZContacts.I18N.get("IAM.IMPORT.SYNC.CONTACTS")+"</span></br><span style='margin-left: 25px;font-size: 13px;'>"+ZContacts.I18N.get("IAM.CONTACTS.SYNC.MESSAGE")+"</span></label></div>",html=html+"<br><div id='termsAndCondition' style='margin-left:2px;'><span><i class='msi-uncheck'></i></span>"+ZContacts.I18N.get("IAM.GOOGLE.SYNC.PRIVACY.POLICY")+"<a style='color: #0073e8; text-decoration: none;' href='"+ZContacts.meta.serviceInfo.google_terms_of_use+"' target='_blank'>"+ZContacts.I18N.get("IAM.CONTACTS.LOGIN.TERMS.USE")+"</a> "+ZContacts.I18N.get("IAM.CONTACTS.AND")+" <a style='color: #0073e8; text-decoration: none;' href='"+ZContacts.meta.serviceInfo.google_privacy_policy+"' target='_blank'>"+ZContacts.I18N.get("IAM.CONTACTS.LOGIN.PPOLICY")+"</a></div>",createFolElem.append(html),$(document.body).append(createFolElem)}zmsDialog.create("zcs_twowaySyncPopup",enableSyncDiv),$("#zcs_twowaySyncPopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_twowaySyncPopup").parents(".SC_Pop").on("click",function(){this.remove()}),$("#termsAndCondition").find(".msi-uncheck").on("click",function(event){$(event.target).hasClass("msi-uncheck")?$(event.target).removeClass("msi-uncheck").addClass("msi-check"):$(event.target).hasClass("msi-check")&&$(event.target).removeClass("msi-check").addClass("msi-uncheck")})},importGoogleSync=function(){if(1==$("#termsAndCondition").find(".msi-uncheck").length)return void zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.GOOGLE.PRIVACY.POLICY.ENSURE"));zmsDialog.remove(),$("#zcs_twowaySyncPopup").remove();var zid=$("#zcs_account").find("input").attr("id");if(zid!=ZContacts.getCurrentAccount().getAccountId())return void zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.CONTACTS.GOOGLE.SYNC.RESTRICT"));{var rootFolderId=ZContacts.AccountsVsRootFolderMap[zid];ZContacts.AccountsVsRootFolderMap[rootFolderId]}ZContacts.importContacts.zid=zid;var uri=new ZContacts.URI(ZContacts.ImportGoogleSync,zid),categoryId=$("#zcs_category").find("input").attr("id"),googleSync=ZContacts.ImportGoogleSync.create();categoryId&&!zmcontact.isRootFolder(categoryId)&&(ZContacts.importContacts.categoryId=categoryId,uri.addPostParam("category_id",categoryId));var domain;domain=zmail.forContactsApp?window.location.host:window.location.host+ZContacts.getContextPath(),uri.addPostParam("domain",domain).POST(googleSync).then(function(response){if(response){var googleUrl=response.google.google_url;return void openSyncNewTab(googleUrl,"google")}})},syncSummeryWorkspace=function(){zmsuite.getCenter()[0].getNodes()[2].$el.find("#syncContinue").after(getHtmlForSync()),zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs_import_box")[1].setAttribute("onClick","importGoogle()"),zmsuite.getCenter()[0].getNodes()[2].$el.find("#google").find(".zcs_import_header_two").html(ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FROM.GOOGLE"))},revokeSync=function(){var zid=$("#zcs_account").find("input").attr("id");zid&&confirm(ZContacts.I18N.get("IAM.SYNC.SURE.DEACTIVATE"))&&new ZContacts.URI(ZContacts.RevokeSync,zid).DELETE().then(function(response){return"true"==response?(zmsuite.getCenter()[0].getNodes()[2].$el.find("#sync").remove(),ZContacts._sync=!1,zmsuite.getCenter()[0].getNodes()[2].$el.find("#google").find(".zcs_import_header_two").html(ZContacts.I18N.get("IAM.IMPORT.SUPPORT.TWO.WAY.SYNC")),zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs_import_box")[1].setAttribute("onClick","twoWaySyncPopup()"),void zmUtil.succErrMsg("s",ZContacts.I18N.get("SYNCED.CONTACTS.RETAIN"))):void 0})},syncNow=function(){var zid=$("#zcs_account").find("input").attr("id");if(zid){ZContacts.importContacts.zid=zid;var uri=new ZContacts.URI(ZContacts.ImportGoogleSync,zid),categoryId=$("#zcs_category").find("input").attr("id"),googleSync=ZContacts.ImportGoogleSync.create();categoryId&&!zmcontact.isRootFolder(categoryId)&&(ZContacts.importContacts.categoryId=categoryId,uri.addPostParam("category_id",categoryId));var domain;domain=zmail.forContactsApp?window.location.host:window.location.host+ZContacts.getContextPath(),zmsuite.getCenter()[0].$el.find('[data-field-type="zcs-sync-now"]').html(ZContacts.I18N.get("IAM.GOOGLE.SYNCING")),zmcontact.restrictClick(zmsuite.getCenter()[0].$el.find('[data-field-type="zcs-sync-now"]'),!0),uri.addPostParam("domain",domain).POST(googleSync).then(function(response){zmsuite.getCenter()[0].$el.find('[data-field-type="zcs-sync-now"]').removeAttr("disabled"),zmsuite.getCenter()[0].$el.find('[data-field-type="zcs-sync-now"]').html(ZContacts.I18N.get("IAM.GOOGLE.SYNC.NOW")),response&&ZContacts.syncResponse($.parseJSON($.parseHTML(response)[0][0].value))})}},importGoogle=function(){zmsDialog.remove(),$("#zcs_twowaySyncPopup").remove();var zid=$("#zcs_account").find("input").attr("id");if(zid){var rootFolderId=ZContacts.AccountsVsRootFolderMap[zid],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];if(ZContacts._countObj[rootFolderId].c&&ZContacts._countObj[rootFolderId].c>=ZContacts.getCurrentAccount().getLimit())return void zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.MAX.CTS.LIMIT.EXCEEDED"),acc.getLimit()));ZContacts.importContacts.zid=zid;var uri=new ZContacts.URI(ZContacts.ImportGoogle,zid),categoryId=$("#zcs_category").find("input").attr("id"),google=ZContacts.ImportGoogle.create();categoryId&&!zmcontact.isRootFolder(categoryId)&&(ZContacts.importContacts.categoryId=categoryId,uri.addPostParam("category_id",categoryId));var domain;domain=zmail.forContactsApp?window.location.host:window.location.host+ZContacts.getContextPath(),uri.addPostParam("domain",domain).POST(google).then(function(response){if(response){var googleUrl=response.google.google_url;return void openNewTab(googleUrl,"google")}})}},importYahoo=function(){var zid=$("#zcs_account").find("input").attr("id");if(zid){var zid=$("#zcs_account").find("input").attr("id"),rootFolderId=ZContacts.AccountsVsRootFolderMap[zid],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];if(ZContacts._countObj[rootFolderId].c&&ZContacts._countObj[rootFolderId].c>=ZContacts.getCurrentAccount().getLimit())return void zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.MAX.CTS.LIMIT.EXCEEDED"),acc.getLimit()));ZContacts.importContacts.zid=zid;var uri=new ZContacts.URI(ZContacts.ImportYahoo,zid),categoryId=$("#zcs_category").find("input").attr("id"),yahoo=ZContacts.ImportYahoo.create();categoryId&&!zmcontact.isRootFolder(categoryId)&&(ZContacts.importContacts.categoryId=categoryId,uri.addPostParam("category_id",categoryId));var domain;domain=zmail.forContactsApp?window.location.host:window.location.host+ZContacts.getContextPath(),uri.addPostParam("domain",domain).POST(yahoo).then(function(response){if(response){var yahooUrl=response.yahoo.yahoo_url;return void openNewTab(yahooUrl,"yahoo")}})}},importOutlook=function(){var zid=$("#zcs_account").find("input").attr("id");if(zid){var zid=$("#zcs_account").find("input").attr("id"),rootFolderId=ZContacts.AccountsVsRootFolderMap[zid],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];if(ZContacts._countObj[rootFolderId].c&&ZContacts._countObj[rootFolderId].c>=ZContacts.getCurrentAccount().getLimit())return void zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.MAX.CTS.LIMIT.EXCEEDED"),acc.getLimit()));ZContacts.importContacts.zid=zid;var uri=new ZContacts.URI(ZContacts.ImportOutlook,zid),categoryId=$("#zcs_category").find("input").attr("id"),outlook=ZContacts.ImportOutlook.create();categoryId&&!zmcontact.isRootFolder(categoryId)&&(uri.addPostParam("category_id",categoryId),ZContacts.importContacts.categoryId=categoryId);var domain;domain=zmail.forContactsApp?window.location.host:window.location.host+ZContacts.getContextPath(),uri.addPostParam("domain",domain).POST(outlook).then(function(response){if(response){var outlookUrl=response.outlook.outlook_url;return void openNewTab(outlookUrl,"outlook")}})}},getHtmlForMapping=function(response){var html=new ZContacts.StringBuilder;html.append('<div class ="zcs_mapping_main">');var headers=response.import.headers;this.mapping_response=response,html.append('<div id="mappingPage" class ="zcs_mapping_page">'),html.append('<span class="zcs_header_loadingband"></span><br>'),html.append('<div><span class="zcs_mapping_header_one">'+ZContacts.I18N.get("IAM.CONTACTS.MAPING.HEADER")+"</span><br></br>"),html.append('<span class="zcs_mapping_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.FIELD.MAPPING")+" </span></div>"),html.append('<div class="zcs_mapping_main_div"><br>'),html.append('<div class="zcs_mapping_border_header">'),html.append('<span class="zcs_mapping_field_header">'+ZContacts.I18N.get("IAM.CONTACTS.FIELDS.HEADER")+"</span>"),html.append('<span style="margin-left: 5px;">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FIELD")+"</span>"),html.append("</div>"),html.append('<div class="zcs_mapping_scroll_div"><form id="mappingForm">'),html.append("<div><br>"),html.append('<div style="font-size: 15px;">'),html.append('<div><span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.FIRSTNAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="first_name">'+getSelectBox(response,"FIRST_NAME")+"</span></span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.MIDDLENAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="middle_name">'+getSelectBox(response,"MIDDLE_NAME")+"</span></div><br></br><br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.LASTNAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="last_name">'+getSelectBox(response,"LAST_NAME")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.BASIC.NNAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="nick_name">'+getSelectBox(response,"NICK_NAME")+"</span><br></br><br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.CATEGORIES")+" :</span>"),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"CATEGORIES")+"</span><br></br><br></br>"),html.append('<div name="email" style="clear: both" class="zcs_email_div pack_block">'),html.append('<div class="zcs_mapping_info_lft""> '+ZContacts.I18N.get("IAM.CONTACTS.EMAIL")+" :</div>"),html.append('<div name="zcs_left_field" style="float: left;padding-left: 3px;">'),html.append('<div name="zcs_field" style="width: 100%;min-height: 30px; margin-bottom: 15px;">'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="email" style="display: inline-block;">'+getSelectBox(response,"EMAIL")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'email\')"></div>'),html.append("</div></div>"),html.append("</div></div>"),html.append('<div style="clear:both;height: 20px;padding: 1px 9px 0 13px;width: 99%;"></div>'),html.append('<div name="phone" style="clear: both" class="zcs_phone_div pack_block">'),html.append('<div class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.BASIC.PHONE")+" :</div>"),html.append('<div name="zcs_left_field" style="float: left;padding-left: 3px;">');for(var mobileIndex=0,phone_map=ZContacts.ImportMapConstants.PHONE_Map,phones=[],i=0;i<headers.length;i++){var header=headers[i].name,PhoneMap=phone_map[header];if(PhoneMap){var headerType=PhoneMap.split("-")[0],headerName=PhoneMap.split("-")[1],contentStr="";contentStr+='<div name="zcs_field" style="width: 100%;min-height: 30px; margin-bottom: 15px;">',contentStr+='<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">',contentStr+='<div class="zcs_mapping_info_right SC_select" name="phone" style="display: inline-block;">'+getSelectBox(response,headerName)+"</div>",contentStr+='<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(headerType,"phone")+"</div>",phones.push(contentStr),mobileIndex++}}if(0==phones.length&&(html.append('<div name="zcs_field" style="width: 100%;min-height: 30px;margin-bottom: 15px;">'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="phone" style="display: inline-block;">'+getSelectBox(response,"phone")+"</div>"),html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(headerType,"phone")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'phone\')"></div>'),html.append("</div></div>"),html.append("</div><br></br>")),phones.length){for(var i=0;i<phones.length;i++){var ph_index=phones[i];if(0==phones.length)var htm=ph_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'phone\')"></div>');else if(phones.length===i+1&&phones.length<7){var htm=ph_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'phone\')"></div>');htm+='<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'phone\')"></div>'}else var htm=ph_index.concat('<div class="msi-close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'phone\')"></div>');var end_line="</div></div>",phone_div_complet=htm.concat(end_line);html.append(phone_div_complet)}html.append("</div></br></br>")}html.append("</div>"),html.append('<div style="clear:both;height: 20px;padding: 1px 9px 0 13px;width: 99%;"></div>'),html.append('<div name="ims" style="clear: both" class="zcs_ims_div pack_block">'),html.append('<div class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.IMS")+" :</div>"),html.append('<div name="zcs_left_field" style="float: left;padding-left: 3px;">');for(var imsIndex=0,ims=[],ims_map=ZContacts.ImportMapConstants.IMS_Map,i=0;i<headers.length;i++){var header=headers[i].name,ImsMap=ims_map[header];if(ImsMap){var imsHeaderType=ImsMap,imsHeaderName=ImsMap.toUpperCase()+"_IM",contentStr="";contentStr+='<div name="zcs_field" style="width: 100%;min-height: 30px; margin-bottom: 15px;">',contentStr+='<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">',contentStr+='<div class="zcs_mapping_info_right SC_select" name="ims" style="display: inline-block;">'+getSelectBox(response,imsHeaderName)+"</div>",contentStr+='<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(imsHeaderType,"ims")+"</div>",ims.push(contentStr),imsIndex++}}if(0==ims.length&&(html.append('<div style="width: 100%;min-height: 30px;margin-bottom: 15px;">'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="ims" style="display: inline-block;">'+getSelectBox(response,"ims")+"</div>"),html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(headerType,"ims")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'ims\')"></div>'),html.append("</div></div>"),html.append("</div><br></br>")),ims.length){for(var i=0;i<ims.length;i++){var htm,ims_index=ims[i];0==ims.length?htm=ims_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'ims\')"></div>'):ims.length===i+1&&ims.length<8?(htm=ims_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'ims\')"></div>'),htm+='<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'ims\')"></div>'):htm=ims_index.concat('<div class="msi-close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'ims\')"></div>');var end_line="</div></div>",ims_div_complet=htm.concat(end_line);html.append(ims_div_complet)}html.append("</div></br>")}html.append("</div>"),html.append('<div style="clear:both;height: 20px;padding: 1px 9px 0 13px;width: 99%;"></div>'),html.append('<div name="urls" style="clear: both" class="zcs_urls_div pack_block">'),html.append('<div class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.URLS")+" :</div>"),html.append('<div name="zcs_left_field" style="float: left;padding-left: 3px;">');for(var urlsIndex=0,urls=[],urlsHeaderType="",urls_map=ZContacts.ImportMapConstants.URLS_Map,i=0;i<headers.length;i++){var header=headers[i].name,UrlsMap=urls_map[header];if(UrlsMap){urlsHeaderType=UrlsMap;var urlsHeaderName=UrlsMap.toUpperCase()+"_WEB",contentStr="";contentStr+='<div name="zcs_field" style="width: 100%;min-height: 30px; margin-bottom: 15px;">',contentStr+='<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">',contentStr+='<div class="zcs_mapping_info_right SC_select" name="urls" style="display: inline-block;">'+getSelectBox(response,urlsHeaderName)+"</div>",contentStr+='<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(urlsHeaderType,"urls")+"</div>",urls.push(contentStr),urlsIndex++}}if(0==urls.length&&(html.append('<div name="zcs_field" style="width: 100%;min-height: 30px; margin-bottom: 15px;">'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="urls" style="display: inline-block;">'+getSelectBox(response,"urls")+"</div>"),html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(urlsHeaderType,"urls")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'urls\')"></div>'),html.append("</div></div>"),html.append("</div><br></br>")),urls.length){for(var i=0;i<urls.length;i++){var htm,urls_index=urls[i];0==urls.length?htm=urls_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'urls\')"></div>'):urls.length===i+1&&urls.length<10?(htm=urls_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'urls\')"></div>'),htm+='<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'urls\')"></div>'):htm=urls_index.concat('<div class="msi-close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \'urls\')"></div>');var end_line="</div></div>",urls_div_complet=htm.concat(end_line);html.append(urls_div_complet)}html.append("</div></br>")}return html.append("</div>"),html.append('<div style="clear:both;height: 20px;padding: 1px 9px 0 13px;width: 99%;"></div>'),html.append('<div style="padding-top: 20px;clear: both"><span class="zcs_header">'+ZContacts.I18N.get("IAM.CONTACTS.PERSONAL")+"</span><br></br>"),html.append('<div style="font-size: 15px;">'),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.GENDER")+" :</span>"),html.append('<span class="zcs_mapping_info_right SC_select" >'+getSelectBox(response,"GENDER")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.COMPANY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"COMPANY_NAME")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CANTACTS.DOB")+" :</span> "),html.append('<span class="zcs_mapping_info_right_bday SC_select">'+getSelectBox(response,"BIRTH_DAY")+"</span>"),html.append('<span class="zcs_mapping_info_right_bday SC_select">'+getSelectBox(response,"BIRTH_MONTH")+"</span>"),html.append('<span class="zcs_mapping_info_right_bday SC_select">'+getSelectBox(response,"BIRTH_YEAR")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.JOBTITLE")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"JOB_TITLE")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.NOTES")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"NOTES")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.DESIGNATION")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"DESIGNATION")+"</span>"),html.append("</div></div><br></br></br>"),html.append('<div style="padding-top: 20px;clear: both"><span class="zcs_header">'+ZContacts.I18N.get("IAM.CONTACTS.OTHERS.HADDRESS")+"</span><br></br>"),html.append('<div style="font-size: 15px;">'),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_ADDR")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_ADDR1")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_CITY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_STATE")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_COUNTRY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_ZIPCODE")+"</span><br></br></br>"),html.append("</div></div><br></br>"),html.append('<div style="clear: both"><span class="zcs_header">'+ZContacts.I18N.get("IAM.CONTACTS.EXPORT.WORK.ADDRESS")+"</span><br></br>"),html.append('<div style="font-size: 15px;">'),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_ADDR")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_ADDR1")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_CITY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_STATE")+"</span> <br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_COUNTRY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_ZIPCODE")+"</span> <br></br></br>"),html.append("</div></div>"),html.append("</div>"),html.append("</form> </div> </div>"),html.append('<div style="clear: both" class="zcs_mapping_save_div">'),html.append('<div style="position: fixed;bottom: 2px;width: 50%;height: 35px;margin-left: 24.5%;margin-bottom: 30px" class="SC_PUbtm zmModeBG">'),html.append('<span data-val="Cancel" onclick="goToImportPage(false)" >'+ZContacts.I18N.get("IAM.CONTACTS.GO.BACK")+"</span>"),html.append('<span onclick="validateContacts(mappingForm);" class="zcs_mapping_next">'+ZContacts.I18N.get("IAM.CONTACTS.NEXT")+"</span>"),html.append('<span data-val="Cancel" onclick="closeImport(false)" >'+ZContacts.I18N.get("IAM.CANCEL")+"</span>"),html.append("</div></div>"),html.append("</div>"),html.toString()},getValidatedDetailsInHtml=function(response){this.data=response.import,confirm_response=data;var html=new ZContacts.StringBuilder,rootFolderId=ZContacts.AccountsVsRootFolderMap[ZContacts.importContacts.zid],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];if(html.append('<div class="zcs_confirm_page_main"><span class="zcs_im_main_div">'),0==data.total_count)html.append('<div><span class="zcs_im_align" style="color:red">'+ZContacts.I18N.get("IAM.OOPS")+"</span><br></br>"),html.append('<span class="zcs_im_align">'+ZContacts.I18N.get("IAM.CONTACTS.UPLOADED.EMPTY.FILE")+"</span></div>"),html.append('<span class="zcs_im_border_bottom"></span><br></br>'),button_check=!0;else{categoryId=rootFolderId,html.append('<div> <form id="confirmationForm">'),data.duplicate_count&&(html.append('<div style="margin-top: 1%;"><span class="zcs_im_align redtxt">'+ZContacts.I18N.get("IAM.CONTACTS.CONFLICTS")+"</span><br></br>"),html.append('<span class="zcs_im_align">'+zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.DUPLICATE.CONTACTS.DETAILS"),encodeHTML(acc.getName()))+"</span>"),html.append('<span data-val="duplicate_email_ids" onclick="errorValuesPopup(\'duplicate_email_ids\')" class="SC_lnk zcs_show_popup">'+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span></br>"),html.append('<br><div class="zcs_im_align"><span class="zcs_im_checkbox"><input id="overwritebox" type="checkbox"/></span><span class="zcs_im_overwirte_pending">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.OVERWRITE.DUPLICATE")+"</span></div>"),html.append('<span class="zcs_im_border_bottom"></span>'),html.append("</div></br>"));var invalidCount=data.total_count-data.valid_count-(data.duplicate_count?data.duplicate_count:0),doContinueNext=data.total_count-invalidCount>0,invalidCategoryCount=data.invalid_category_count>0;if(invalidCount&&data.invalid_fields||invalidCategoryCount){html.append('<div style="margin-top: 2%;">'),html.append('<span style="margin-left: 6%;font-size: 17px;padding: 10px;text-transform: uppercase;" class="SC_thm">'+ZContacts.I18N.get("IAM.NOTE")+" :</span>");var note=doContinueNext?zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.SKIP.INVALID.IMPORT"),invalidCount,data.total_count):ZContacts.I18N.get("IAM.CONTACTS.NO.VALID.CONTACTS.FILE");if(0==invalidCount&&invalidCategoryCount)var note=zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.SKIP.INVALID.CATEGORY.IMPORT"),data.invalid_category_count);html.append('<span style="color: #545454;font-size: 17px;">'+note+"</span></br>"),html.append("<ul>"),data.invalid_fields.mandatory_missing_count&&html.append('<li style="margin-bottom: -40px;margin-top: -20px;line-height: 3.5em" class="zcs_im_align"><span>'+zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.SKIPPED.CONTACTS.COUNT"),data.invalid_fields.mandatory_missing_count)+"</span><br></li>"),$.each(data.invalid_fields,function(key){if("mandatory_missing_count"!=key){var field=ZContacts.I18N.get("IAM.CONTACTS.CHARACTERS");"first_name"==key?field=ZContacts.I18N.get("IAM.CONTACTS.FIRSTNAME"):"middle_name"==key?field=ZContacts.I18N.get("IAM.CONTACTS.MIDDLENAME"):"last_name"==key?field=ZContacts.I18N.get("IAM.CONTACTS.LASTNAME"):"nick_name"==key?field=ZContacts.I18N.get("IAM.CONTACTS.BASIC.NNAME"):"category_name"==key?field=ZContacts.I18N.get("IAM.CONTACTS.CATEGORIES"):"email_id"==key?field=ZContacts.I18N.get("IAM.EMAIL.IDS"):"phones"==key?field=ZContacts.I18N.get("IAM.CONTACTS.BASIC.PHONE"):"ims"==key?field=ZContacts.I18N.get("IAM.CONTACTS.IM.FULL"):"urls"==key?field=ZContacts.I18N.get("IAM.CONTACTS.URLS"):"gender"==key?field=ZContacts.I18N.get("IAM.CONTACTS.GENDER"):"birth_day"==key?field=ZContacts.I18N.get("IAM.CONTACTS.BASIC.BDAY"):"birth_month"==key?field=ZContacts.I18N.get("IAM.CONTACTS.BIRTH.MONTH"):"birth_year"==key?field=ZContacts.I18N.get("IAM.CONTACTS.BIRTH.YEAR"):"notes"==key?field=ZContacts.I18N.get("IAM.CONTACTS.NOTES"):"street_addr"==key?field=ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS"):"street_addr1"==key?field=ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1"):"city"==key?field=ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY"):"postal_code"==key?field=ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL"):"state"==key?field=ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE"):"country"==key?field=ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY"):"company"==key?field=ZContacts.I18N.get("IAM.CONTACTS.COMPANY"):"job_title"==key?field=ZContacts.I18N.get("IAM.CONTACTS.JOBTITLE"):"designation"==key&&(field=ZContacts.I18N.get("IAM.CONTACTS.DESIGNATION")),html.append(getErrorDetailsInHtml(key,field))}}),html.append("</ul>"),html.append('<span class="zcs_im_border_bottom"></span>'),html.append("</div></br>"),html.append("</div>")}}return html.append('<br><div class="zcs_im_save_div"><span class="SC_PUbtm" style="margin-left: 30%">'),0==data.total_count?(html.append('<span onclick="goToImportPage(false)">'+ZContacts.I18N.get("IAM.CONTACTS.GO.BACK")+"</span>"),html.append('<span data-val="Cancel" onclick="closeImport(false)">'+ZContacts.I18N.get("IAM.CANCEL")+"</span>")):(doContinueNext?("csv"==ZContacts.importContacts.fileFormat&&html.append('<span onclick="goMappingPage()">'+ZContacts.I18N.get("IAM.CONTACTS.PREV")+"</span>"),html.append('<span data-val="Next" onclick="importContacts(data)">'+ZContacts.I18N.get("IAM.CONTACTS.NEXT")+"</span>")):html.append('<span data-val="import" onclick="goToImportPage(false)">'+ZContacts.I18N.get("IAM.CONTACTS.GO.BACK")+"</span>"),html.append('<span data-val="Cancel" onclick="closeImport(false)">'+ZContacts.I18N.get("IAM.CANCEL")+"</span>")),html.append("</span></div>"),html.append("</form></div>"),html.append("</span></div>"),html.toString()},processFile=function(){var zid=$("#zcs_account").find("input").attr("id"),rootFolderId=ZContacts.AccountsVsRootFolderMap[zid],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];if(ZContacts._countObj[rootFolderId].c&&ZContacts._countObj[rootFolderId].c>=ZContacts.getCurrentAccount().getLimit())return void zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.MAX.CTS.LIMIT.EXCEEDED"),acc.getLimit()));var importForm=ZContacts.ImportUpload.create({__form:"#import"});ZContacts.importContacts.zid=zid;var categoryId=$("#zcs_category").find("input").attr("id");zmcontact.isRootFolder(categoryId)&&(categoryId=-1),ZContacts.importContacts.categoryId=categoryId;var importFile=$("#importFile")[0].files[0],fileName=importFile.name.trim();return ZContacts.importContacts.fileFormat=fileName.substring(fileName.lastIndexOf(".")+1,fileName.length).toLowerCase().trim(),"csv"!=ZContacts.importContacts.fileFormat&&"vcf"!=ZContacts.importContacts.fileFormat&&"ldif"!=ZContacts.importContacts.fileFormat?(zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.CONTACTS.INVALID.FILE.FORMAT")),$(".SC_sld").remove(),$("#importFile").prop("disabled",!1),void $("#iimportFile").replaceWith($("#importFile").val("").clone(!0))):importFile.size>3072e3?(zmUtil.succErrMsg("e",zmcontact.formatMessage(ZContacts.I18N.get("IAM.UPLOAD.NOTE2"),3072)),void $("#importFile").replaceWith($("#importFile").val("").clone(!0))):($(".zcs_new_loading").removeClass("hide"),void new ZContacts.URI(ZContacts.ImportUpload,zid).POST(importForm).then(function(response){if(200!=response.status_code)return zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response)),$(".zcs_new_loading").addClass("hide"),$(".SC_sld").remove(),$("#importFile").prop("disabled",!1),void $("#importFile").replaceWith($("#importFile").val("").clone(!0));if(0==response.import.total_count)return void zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json));ZContacts.importContacts.fileKey=response.import.file_key;var contactImport=new ZContacts.contactimport;response.import.headers?($(".zcs_new_loading").removeClass("hide"),contactImport.createPageContent(getHtmlForMapping(response),!1)):response.import.invalid_count||response.import.duplicate_count?($(".zcs_new_loading").removeClass("hide"),contactImport.createPageContent(getValidatedDetailsInHtml(response),!1)):importContacts(response.import),zmsDialog.remove(),fileFormat=""},function(response){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response)),$(".zcs_new_loading").addClass("hide"),$(".SC_sld").remove(),$("#importFile").prop("disabled",!1),$("#importFile").replaceWith($("#importFile").val("").clone(!0))}))},importContacts=function(data){var doOverWrite=$("#overwritebox").is(":checked"),doImport=data.total_count-(data.duplicate_count?data.duplicate_count:0)>0||doOverWrite,contactImport=new ZContacts.contactimport;if(!doImport)return void contactImport.createPageContent(getHtmlForFinishImport(!1,data.total_count,0,0),!1);zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.CONTACTS.IMPORTING"));var zid=ZContacts.importContacts.zid,categoryId=ZContacts.importContacts.categoryId,mappingConfirmation=ZContacts.Import.create();mappingConfirmation.set("overwrite_duplicate",$("#overwritebox").is(":checked")),mappingConfirmation.set("category_id",categoryId),mappingConfirmation.set("file_key",ZContacts.importContacts.fileKey),mappingConfirmation.set("file_format",ZContacts.importContacts.fileFormat),mappingConfirmation.set("total_count",data.total_count),mappingConfirmation.set("valid_count",data.valid_count),mappingConfirmation.set("invalid_category_count",data.invalid_category_count);var centerNode=zmsuite.getCenter()[0].getNodes()[2].$el,loadingDiv=function(){};centerNode.find(".SC_import").get(0)&&(loadingDiv=zmComponent.loadingBand({container:centerNode.find(".SC_import").get(0),type:"listing"})),new ZContacts.URI(ZContacts.Import,zid).POST(mappingConfirmation).then(function(response){return loadingDiv(),response.import?void contactImport.createPageContent(getHtmlForFinishImport(!0,response.import.total_count,response.import.added_count,response.import.updated_count),!1):void zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))})},getHtmlForFinishImport=function(isImported,totalContactsCount,addedContactsCount,updateContactsCount,duplicateContacts,msg){var html=new ZContacts.StringBuilder;html.append('<div style="padding: 20px;">');var acc=zmcontact.getAccountByZid(ZContacts.importContacts.zid);if(isImported){if(!msg)if(-1!=ZContacts.importContacts.categoryId){var category=zmcontact.getCategory(ZContacts.importContacts.categoryId);msg=category?zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.IMPORTED.TO.CATEGORY.IN.OTHER.SPACE.SUCCESSFULLY"),encodeHTML(category.category_name),encodeHTML(acc.getName())):zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.IMPORTED.IN.OTHER.SPACE.SUCCESSFULLY"),encodeHTML(acc.getName()))}else msg=zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.IMPORTED.IN.OTHER.SPACE.SUCCESSFULLY"),encodeHTML(acc.getName()));zmUtil.succErrMsg("s",msg);try{(acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT||acc.getType()==ZContacts.ZMailConstants.ORG_ACCOUNT)&&zmcontact.invokeEvent("contactsApp/refresh",acc.getAccountId())}catch(e){}}var totalContacts;totalContacts=totalContactsCount>1?zmcontact.formatMessage(ZContacts.I18N.get("IAM.MULTIPLE.CONATCT"),totalContactsCount):zmcontact.formatMessage(ZContacts.I18N.get("IAM.SINGLE.CONTACT"),totalContactsCount);var addedContacts;addedContacts=addedContactsCount>1?zmcontact.formatMessage(ZContacts.I18N.get("IAM.MULTIPLE.CONATCT"),addedContactsCount)+" "+ZContacts.I18N.get("IAM.CONTACTS.ARE"):zmcontact.formatMessage(ZContacts.I18N.get("IAM.SINGLE.CONTACT"),addedContactsCount)+" "+ZContacts.I18N.get("IAM.CONTACTS.IS");var updatedContacts;updatedContacts=updateContactsCount>1?zmcontact.formatMessage(ZContacts.I18N.get("IAM.MULTIPLE.CONATCT"),updateContactsCount)+" "+ZContacts.I18N.get("IAM.CONTACTS.ARE"):zmcontact.formatMessage(ZContacts.I18N.get("IAM.SINGLE.CONTACT"),updateContactsCount)+" "+ZContacts.I18N.get("IAM.CONTACTS.IS");var statistics=zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.IMPORT.STATISTICS.RESULT"),totalContacts,addedContacts,updatedContacts);return html.append('<div><span class="SC_thm" style="font-size: 18px;">'+ZContacts.I18N.get("IAM.CONTACTS.RESULT")+"</span><br><br>"),html.append('<span class="zcs_im_align">'+statistics+"</span><br>"),html.append("</div><br>"),duplicateContacts&&(this.data=duplicateContacts,html.append('<div><span class="SC_ltl redtxt" style="text-transform: none; font-size: 18px;">'+ZContacts.I18N.get("IAM.CONTACTS.CONFLICTS")+"</span><br></br>"),html.append('<span class="zcs_im_align">'+zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.DUPLICATE.CONTACTS.DETAILS"),encodeHTML(acc.getName()))+"</span>"),html.append('<span data-val="duplicate_email_ids" onclick="errorValuesPopup(\'duplicate_email_ids\')" class="SC_lnk zcs_show_popup">'+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span></br>"),html.append("</div></br>")),html.append('<div class="SC_PUbtm" style="margin-left: 5%;">'),html.append('<span data-val="Cancel" onclick="closeImport('+isImported+')">'+ZContacts.I18N.get("IAM.CONTACTS.DONE")+"</span>"),html.append('<span onclick="goToImportPage(true)">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.MORE")+"</span>"),html.append("</div>"),html.append("</form></div></div>"),html.toString()},errorValuesPopup=function(key,fieldName){var errorInfo=this.data,errorDetails={};if(errorDetails.title="duplicate_email_ids"==key?ZContacts.I18N.get("IAM.CONTACTS.DUPLICATE.E_ADDRESS"):zmcontact.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.INVALID.FIELD"),fieldName),errorDetails.name=key,errorDetails.mask=!0,errorDetails.buttons=[{isCancel:!0,txt:ZContacts.I18N.get("IAM.CONTACTS.DONE"),callback:function(){zmsDialog.remove(),$("#zcs_errorDetailsPopup").remove()}}],errorDetails.closeaction=function(){zmsDialog.remove(),$("#zcs_errorDetailsPopup").remove()},errorDetails.pos="center",createFolElem=$("<div id='zcs_errorDetailsPopup' style='max-height: 500px;'></div>"),!$("#zcs_errorDetailsPopup").length){var email_list="<div class='zcs_Emaildetails_main'>",fields=errorInfo[key];if(errorInfo[key]?fields=errorInfo[key]:errorInfo.invalid_fields[key]&&(fields=errorInfo.invalid_fields[key]),fields){for(var i=0;i<fields.length;i++)email_list=email_list+"<div><span>"+(i+1)+".</span><span style='margin-left: 5px;'>"+ZContacts.Utils.encodeHTML(fields[i])+"</span></div></br>";email_list+="</div>"}createFolElem.append(email_list),$(document.body).append(createFolElem)}zmsDialog.create("zcs_errorDetailsPopup",errorDetails)},getTypeSelectBox=function(data,type_model){var type_array="";"phone"==type_model?type_array=ZContacts.MappingType.Phone_Type:"ims"==type_model?type_array=ZContacts.MappingType.Ims_Type:"urls"==type_model&&(type_array=ZContacts.MappingType.Urls_Type);var selectTypeBox='<select class="zcs-list-type zcs_'+type_model+'_type" name="type">';selectTypeBox+='<option value="none">None</option>';for(var i=0;i<type_array.length;i++){var newdata=ZContacts.I18N.get("IAM.CONTACTS."+type_model.toUpperCase()+".TYPE."+type_array[i].toUpperCase());selectTypeBox+='<option value="'+type_array[i]+'" ',data&&data==type_array[i]&&(selectTypeBox+='selected = "true"'),selectTypeBox+=">"+newdata+"</option>"}return selectTypeBox+="</select>"},getSelectBox=function(response,data){var headers=response.import.headers,headers_map=response.import.headersMap,valueIndex=headers_map[data],selectBox='<select id="'+data+'_field" class="zcs_mapping_select_box select">';selectBox+='<option value="-1">None</option>';for(var i=0;i<headers.length;i++)selectBox+='<option value="'+i+'" ',-1!=valueIndex&&valueIndex===i&&(selectBox+='selected = "true"'),selectBox+=">"+encodeHTML(headers[i].name)+" ("+i+")</option>";return selectBox+="</select>"},this.createPageContent=function(content){ZContacts.contactimport.$containerElem.html($(content))},this.createAppendPageContent=function(content){ZContacts.contactimport.$containerElem.append($(content))},this.mappingValues=function(data){var mapping=ZContacts.MappingFields.create();mapping.set("first_name",$(data).find("#FIRST_NAME_field option:selected").val()),mapping.set("middle_name",$(data).find("#MIDDLE_NAME_field option:selected").val()),mapping.set("last_name",$(data).find("#LAST_NAME_field option:selected").val()),mapping.set("nick_name",$(data).find("#NICK_NAME_field option:selected").val()),mapping.set("categories",$(data).find("#CATEGORIES_field option:selected").val());for(var $emailLength=$(data).find(".zcs_email_div").find("div[name=zcs_field]").find(".zcs_siblings").find("select"),storeEmailArray=[],i=0;i<$emailLength.length;i++){var emailIndex=$($emailLength[i]).val();storeEmailArray.push(emailIndex)}mapping.set("emails",storeEmailArray);for(var $phoneRows=$(data).find(".zcs_phone_div").find("div[name=zcs_field]"),i=0;i<$phoneRows.length;i++){var phone=$($phoneRows[i]).find(".zcs_siblings").find('[name="phone"]').find("select").val(),types=$($phoneRows[i]).find(".zcs_siblings").find('[name="type"]').val(),phoneModel=ZContacts.PhoneNumbers.create({number:phone,type:types});mapping.addSubResource(phoneModel)}for(var $imsRows=$(data).find(".zcs_ims_div").find("div[name=zcs_field]"),i=0;i<$imsRows.length;i++){var ims=$($imsRows[i]).find(".zcs_siblings").find('[name="ims"]').find("select").val(),types=$($imsRows[i]).find(".zcs_siblings").find('[name="type"]').val(),imsModel=ZContacts.Ims.create({address:ims,type:types});mapping.addSubResource(imsModel)}for(var $urlRows=$(data).find(".zcs_urls_div").find("div[name=zcs_field]"),i=0;i<$urlRows.length;i++){var url=$($urlRows[i]).find(".zcs_siblings").find('[name="urls"]').find("select").val(),types=$($urlRows[i]).find(".zcs_siblings").find('[name="type"]').val(),urlModel=ZContacts.Urls.create({url:url,type:types});mapping.addSubResource(urlModel)}mapping.set("gender",$(data).find("#GENDER_field option:selected").val()),mapping.set("birth_date",$(data).find("#BIRTH_DAY_field option:selected").val()),mapping.set("birth_month",$(data).find("#BIRTH_MONTH_field option:selected").val()),mapping.set("birth_year",$(data).find("#BIRTH_YEAR_field option:selected").val()),mapping.set("notes",$(data).find("#NOTES_field option:selected").val()),mapping.set("company",$(data).find("#COMPANY_NAME_field option:selected").val()),mapping.set("job_title",$(data).find("#JOB_TITLE_field option:selected").val()),mapping.set("designation",$(data).find("#DESIGNATION_field option:selected").val());var homeAddress=ZContacts.Address.create({street_addr:$(data).find("#HOME_ADDR_field option:selected").val(),street_addr1:$(data).find("#HOME_ADDR1_field option:selected").val(),city:$(data).find("#HOME_CITY_field option:selected").val(),state:$(data).find("#HOME_STATE_field option:selected").val(),country:$(data).find("#HOME_COUNTRY_field option:selected").val(),postal_code:$(data).find("#HOME_ZIPCODE_field option:selected").val(),type:"home"});mapping.addSubResource(homeAddress);var workAddress=ZContacts.Address.create({street_addr:$(data).find("#WORK_ADDR_field option:selected").val(),street_addr1:$(data).find("#WORK_ADDR1_field option:selected").val(),city:$(data).find("#WORK_CITY_field option:selected").val(),state:$(data).find("#WORK_STATE_field option:selected").val(),country:$(data).find("#WORK_COUNTRY_field option:selected").val(),postal_code:$(data).find("#WORK_ZIPCODE_field option:selected").val(),type:"work"});return mapping.addSubResource(workAddress),mapping},ZContacts.contactimport.EmailDetailsPopup=function(key){var errorDetails={};if("duplicate_email"==key?(errorDetails.title=ZContacts.I18N.get("IAM.CONTACTS.DUPLICATE.E_ADDRESS"),errorDetails.name=key):"invalid_email"==resp?(errorDetails.title=ZContacts.I18N.get("IAM.CONTACTS.INVALID.E_ADDRESS"),errorDetails.name=resp):"record_duplicate"==resp&&(errorDetails.title=ZContacts.I18N.get("IAM.CONTACTS.RECORD.DUPLICATE.E_ADDRESS"),errorDetails.name=resp),errorDetails.mask=!0,errorDetails.buttons=[{isCancel:!0,txt:ZContacts.I18N.get("IAM.CONTACTS.DONE"),callback:function(){zmsDialog.remove(),$("#zcs_errorDetailsPopup").remove()}}],errorDetails.closeaction=function(){zmsDialog.remove(),$("#zcs_errorDetailsPopup").remove()},errorDetails.pos="center",createFolElem=$("<div id='zcs_errorDetailsPopup' style='max-height: 500px;'></div>"),!$("#zcs_errorDetailsPopup").length){var email_list="<div class='zcs_Emaildetails_main'>";if("duplicate_email"==key&&data.duplicate_email_ids){for(var i=0;i<data.duplicate_email_ids.length;i++)email_list=email_list+"<div><span>"+(i+1)+".</span><span style='margin-left: 5px;'>"+data.duplicate_email_ids[i]+"</span></div></br>";email_list+="</div>"}createFolElem.append(email_list),$(document.body).append(createFolElem)}zmsDialog.create("zcs_errorDetailsPopup",errorDetails)},goToImportPage=function(doRefreshCounts){this.data=void 0,doRefreshCounts&&zmcontact.refreshContactCounts(ZContacts.importContacts.zid),resetImportContacts();var contactImport=new ZContacts.contactimport;contactImport.createPageContent(getHtmlForImport())},validateContacts=function(map){zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.CONTACTS.VALIDATING"));var contactImport=new ZContacts.contactimport,mappingFieds=contactImport.mappingValues(map);if("-1"==mappingFieds.first_name&&"-1"==mappingFieds.emails[0]&&"-1"==mappingFieds.company)return zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.CONTACTS.FIRST.NAME.REQUIRED")),void $("#first_name_field").focus();var centerNode=zmsuite.getCenter()[0].getNodes()[2].$el,mapping_loading=zmComponent.loadingBand({container:centerNode.find(".zcs_header_loadingband").get(0),type:"listing",notToSetInnerHTML:!0}),importMapping=ZContacts.ImportValidate.create();importMapping.file_key=ZContacts.importContacts.fileKey,importMapping.addSubResource(mappingFieds),new ZContacts.URI(ZContacts.ImportValidate,ZContacts.importContacts.zid).POST(importMapping).then(function(response){if(mapping_loading(),200==response.status_code){var contactImport=new ZContacts.contactimport;$("#mappingPage").hide(),response.import.invalid_count||response.import.duplicate_count||response.import.invalid_category_count?contactImport.createAppendPageContent(getValidatedDetailsInHtml(response),!1):importContacts(response.import)}else zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))},function(response){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(response))})},closeImport=function(result){if(this.data=void 0,zmsuite.closeWorkspace(ZContacts.ZMailConstants.IMPORT_APP_ID),result){zmcontact.refreshContactCounts(ZContacts.importContacts.zid);var rootFolderId=ZContacts.AccountsVsRootFolderMap[ZContacts.importContacts.zid];category=zmcontact.getCategory(ZContacts.importContacts.categoryId&&-1!=ZContacts.importContacts.categoryId?ZContacts.importContacts.categoryId:rootFolderId),zmcontact.loadFirstPage(category),new ZContacts.URI(ZContacts.Categories,ZContacts.importContacts.zid).GETS().then(function(json){for(var rootFolderId=ZContacts.AccountsVsRootFolderMap[ZContacts.importContacts.zid],layer=zmcontact.getCategoriesListLayer(rootFolderId),i=0;i<json.length;i++)if(!layer.childObject[rootFolderId].CH[json[i].category_id]){ZContacts._parentObj[rootFolderId]||(ZContacts._parentObj[rootFolderId]=[]),ZContacts._parentObj[rootFolderId].push(json[i]);var rowInfo={};rowInfo[json[i].category_id]={category_id:json[i].category_id,category_name:json[i].category_name,E:0,HC:!1,SE:2};var categoryMapObj={id:"category_id",name:"category_name",count:"count",hasChild:"HC",expChild:"E",sequence:"SE",parentId:"p",notBold:"notBold"};layer.insertNodeBefore(rowInfo,categoryMapObj,rootFolderId+"_add",rootFolderId)}resetImportContacts()},function(){resetImportContacts()})}},openNewTab=function(url,name){var width=parseInt("80"*screen.width/100),height=parseInt("80"*screen.height/100),left=(screen.width-width)/2,top=(screen.height-height)/2;url+=-1==url.indexOf("?")?"?":"&";var contextDomain;return contextDomain=zmail.forContactsApp?zmail.urls.contactsURL:window.location.host+ZContacts.getContextPath(),url+="domain="+contextDomain,window.open(url,name,"height="+height+", width="+width+", top="+top+", left="+left+",status=1,toolbar=0,scrollbars=1,resizable=1"),!1},openSyncNewTab=function(url,name){var width=parseInt("80"*screen.width/100),height=parseInt("80"*screen.height/100),left=(screen.width-width)/2,top=(screen.height-height)/2;return url+=-1==url.indexOf("?")?"?":"&",window.open(url,name,"height="+height+", width="+width+", top="+top+", left="+left+",status=1,toolbar=0,scrollbars=1,resizable=1"),!1},goMappingPage=function(){$(".zcs_confirm_page_main").remove(),$(".zcs_mapping_page").show()},addOrRemoveField=function(elem,field){response=this.mapping_response;var $appendRow=$(elem).parents("div[name="+field+"]").find("div[name=zcs_left_field]"),isType=!1,size=0;if("email"==field?(size=5,isType=!1):"phone"==field?(size=7,isType=!0):"ims"==field?(size=8,isType=!0):"urls"==field&&(size=10,isType=!0),$(elem).hasClass("msi-plus")){var html=new ZContacts.StringBuilder,currentSize=$appendRow.find(".zcs_siblings").length;if(size>=currentSize){if(html.append('<div name="zcs_field" style="width: 100%;min-height: 30px;margin-bottom: 15px;">'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append("<div name="+field+' class="zcs_mapping_info_right SC_select">'+getSelectBox(response,field)+"</div>"),isType&&html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(field,field)+"</div>"),size>currentSize){var currentChild=$(elem).parents("div[name=zcs_field]");currentChild.find(".msi-close").length?$(elem).remove():$(elem).removeClass("msi-plus").addClass("msi-close"),currentSize!=size-1&&html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \''+field+"')\"></div>")}html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \''+field+"')\"></div>"),html.append("</div></div>"),$appendRow.append(html.toString())}}else if($(elem).hasClass("msi-close")){var $siblingElem=$(elem).parents(".zcs_siblings"),$delElm=$siblingElem.parents("div[name=zcs_field]");$delElm.remove();var children=$appendRow.find(".zcs_siblings"),lastChild=children.last();$(lastChild).find(".msi-plus").length||($(lastChild).find(".msi-close").removeClass("msi-close zcs_msi_close").addClass("msi-plus"),1!=children.length&&$(lastChild).append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="addOrRemoveField(this, \''+field+"')\"></div>")),1==children.length&&$(lastChild).find(".msi-close").removeClass("msi-close zcs_msi_close")}}},$.subscribe("contacts/i18NLoaded",function(){if(zmail.Search&&zmail.newSearch){var encodeHTML=ZContacts.Utils.encodeHTML,I18N=ZContacts.I18N,hasMore=!1,searchParams="";ZContacts._filterList=[],ZContacts._countSearchObj={},ZContacts.isSearchLoading=!1;var zcAutoListingRows=function(value){value=value||{};var fullName=value.fn?value.fn+(value.ln?" "+value.ln:""):""+(value.ln||""),photo=zmcontact.getJsStdUrl(value.photo)||"",email=value.eid||"",zcSearchList='<div><div style="text-transform: uppercase;background-color: #E5E5E5;float: left;border-radius: 100px;overflow: hidden;font-weight: 600;cursor: default;"><img src='+photo+' style="width: 40px;height: 40px;"></div><div style="margin-left: 50px;"><div><span class="zcs_new_search_autolistingrow">'+encodeHTML(fullName)+"</span>";return zcSearchList+='</div><div class="zcs_new_search_autolistingrow">'+encodeHTML(email)+"</div></div>",$(zcSearchList)},filterPrimaryEmailContact=function(contactsList){for(var value=[],i=0;i<=contactsList.length;i++)"undefined"!=typeof contactsList[i]&&contactsList[i].attrs.isPrimary&&value.push(contactsList[i]);return value},filterLastNameList=function(contactsList){for(var lastNameList=[],i=0;i<contactsList.length;i++){var lastName=contactsList[i].attrs.ln;lastName&&lastNameList.push(contactsList[i])}return lastNameList},getName=function(value,type){var name="";return name="object"===$.type(value)?"cn"==type?value.attrs.cn||"":"ln"==type?value.ln||value.attrs.ln||"":value.fn||value.attrs.fn||"":"string"===$.type(value)?value:""},commonContactsFilter=function(contactList){for(var fList=[],i=0;i<contactList.length;i++)fList.push(contactList[i].attrs);return fList},autoSuggestList=function(contactList,str,filterField){var filteredResult="";return ZContacts.getCurrentAccount().type===ZContacts.ZMailConstants.GROUP_ACCOUNT||"company"===filterField?contactList=[]:(str=str.toLowerCase(),str?zmail.ContactBook.get({str:str,type:["personal","org"]}).done(function(contactList){filteredResult=commonContactsFilter(contactList)}):filteredResult=commonContactsFilter(contactList),filteredResult)},contactsSearchParam=function(config){var obj={page:1,per_page:50},isIgnoreSearch=!1;obj.skip_search=isIgnoreSearch;for(var i=0;i<config.data.length;i++){var className=config.data[i].className;if("AllContactsFilter"==className)obj.q=config.data[i].value||config.data[i].actualValue;else if("ContactsNameFilter"==className)obj.filter_first_name=config.data[i].value||config.data[i].actualValue;else if("ContactsLastNameFilter"==className)obj.filter_last_name=config.data[i].value||config.data[i].actualValue;else if("ContactsEmailFilter"==className)obj.filter_email_id=config.data[i].value||config.data[i].actualValue;else if("ContactsCompanyFilter"==className)obj.filter_company=config.data[i].value||config.data[i].actualValue;else if("SearchTypeFilter"==className){var search_type_map=ZContacts.ImportMapConstants.SearchTypye_Map,value=config.data[i].value||config.data[i].actualValue,typeParam=search_type_map[value];obj.search_type=typeParam,isIgnoreSearch=!0}}return obj.search_type||(obj.search_type="3"),isIgnoreSearch&&1==config.data.length?(obj.skip_search=isIgnoreSearch,!1):(obj.config=config,obj)},validate=function(value){if(!value&&(this.nullableOnly||this.nullable))return!0;if(this.restrictedToValues){var values=this.getValues();if(_.isArray(values))return _(values).contains(value)}else if(this.regexp instanceof RegExp)return this.regex.test(value);return Boolean(value)};!function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Models.Filters");factory.call(module,module,function(str){return Namespaces.get(str,{ignore__namespace:!0})})}(function(module,require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),StringFilter=require("zmail.Search.Models.Filters.StringFilter"),SearchTypeFilter=TypeCreator.newType(StringFilter,{className:"SearchTypeFilter",name:I18N.get("IAM.CONTACTS.SEARCH.TYPE"),filterType:"search_type",description:I18N.get("IAM.CONTACTS.SEARCH.TYPE.USING"),multipleInstance:!1,filterValues:!1,defaultValue:function(){return ZContacts.MappingType.search_type[0]},values:function(){return ZContacts.MappingType.search_type},getValue:function(){return getName(this.value,"fn")},autofillText:function(value){return getName(value,"fn")},validate:function(value){var valueList=ZContacts.MappingType.search_type;if(!value&&(this.nullableOnly||this.nullable))return!0;if(this.restrictedToValues){var values=this.getValues();if(_.isArray(values))return _(values).contains(value)}else if(this.regexp instanceof RegExp)return this.regex.test(value);for(var i=0;i<valueList.length;i++){var test=valueList[i];if(test.toLowerCase().startsWith(value))return!0}}}),AllContactsFilter=TypeCreator.newType(StringFilter,{className:"AllContactsFilter",name:I18N.get("IAM.SEARCH.CONTACTS.CONTAINS"),filterType:"all",description:I18N.get("IAM.SEARCH.CONTACTS.USING.ALL"),multipleInstance:!1,filterValues:!0,filterProps:["eid","fn"],values:function(str){var contactsList=zmail.ContactBook.getMostUsedContacts();return autoSuggestList(contactsList,str,"all")},getValue:function(){return getName(this.value,"fn")},autofillDOM:function(value){var contact=value.attrs||value;return zcAutoListingRows(contact)},autofillText:function(value){return getName(value,"fn")},validate:function(value){return validate(value)}}),ContactsNameFilter=TypeCreator.newType(StringFilter,{className:"ContactsNameFilter",name:I18N.get("IAM.SEARCH.CONTACTS.FIRST.NAME"),filterType:"names",description:I18N.get("IAM.SEARCH.CONTACTS.USING.NAME"),multipleInstance:!1,filterValues:!0,filterProps:["fn"],values:function(str){var cList=zmail.ContactBook.getMostUsedContacts(),contactsList=filterPrimaryEmailContact(cList);return autoSuggestList(contactsList,str,"names")},getValue:function(){return getName(this.value,"fn")},autofillText:function(value){return getName(value,"fn")},validate:function(value){return validate(value)}}),ContactsLastNameFilter=TypeCreator.newType(StringFilter,{className:"ContactsLastNameFilter",name:I18N.get("IAM.SEARCH.CONTACTS.LAST.NAME"),filterType:"lastname",description:I18N.get("IAM.SEARCH.CONTACTS.USING.NAME"),multipleInstance:!1,filterValues:!0,filterProps:["ln"],values:function(str){var cList=zmail.ContactBook.getMostUsedContacts(),contactsList=filterLastNameList(cList);return autoSuggestList(contactsList,str,"lastname")},getValue:function(){return getName(this.value,"ln")},autofillText:function(value){return getName(value,"ln")},validate:function(value){return validate(value)}}),ContactsEmailFilter=TypeCreator.newType(StringFilter,{className:"ContactsEmailFilter",name:I18N.get("IAM.SEARCH.CONTACTS.EMAILS"),filterType:"email",description:I18N.get("IAM.SEARCH.CONTACTS.USING.EMAILS"),multipleInstance:!1,filterValues:!0,filterProps:["eid"],values:function(str){var contactsList=zmail.ContactBook.getMostUsedContacts();return autoSuggestList(contactsList,str,"email")},getValue:function(){if(this.value){var contact=this.value.attrs||this.value;return contact.eid}},autofillDOM:function(value){var contact=value.attrs||value;return zcAutoListingRows(contact)},autofillText:function(value){return getName(value,"fn")},validate:function(value){return validate(value)}}),ContactsCompanyFilter=TypeCreator.newType(StringFilter,{className:"ContactsCompanyFilter",name:I18N.get("IAM.SEARCH.CONTACTS.COMPANY.NAME"),filterType:"company",description:I18N.get("IAM.SEARCH.CONTACTS.USING.COMPANY"),multipleInstance:!1,filterValues:!0,filterProps:["company"],values:function(str){var contactsList=zmail.ContactBook.getMostUsedContacts();return autoSuggestList(contactsList,str,"company")},getValue:function(){return getName(this.value,"fn")},autofillText:function(value){return getName(value,"fn")},validate:function(value){return validate(value)}});module.SearchTypeFilter=SearchTypeFilter,module.AllContactsFilter=AllContactsFilter,module.ContactsNameFilter=ContactsNameFilter,module.ContactsLastNameFilter=ContactsLastNameFilter,module.ContactsEmailFilter=ContactsEmailFilter,module.ContactsCompanyFilter=ContactsCompanyFilter});var Contexts=zmail.Search.Models.Contexts,Filters=zmail.Search.Models.Filters,ZContactsContext=new Contexts.SearchContext({contextName:I18N.get("IAM.CONTACTS"),contextIcon:"msi-contacts",tabRegexp:/zm_Contacts/,placeholder:I18N.get("IAM.CONTACTS.SEARCH.CONTACTS"),shortcutId:"contactsSearch",contextID:"contacts",defaultFilterClass:Filters.AllContactsFilter,filterClass:[Filters.SearchTypeFilter,Filters.AllContactsFilter,Filters.ContactsNameFilter,Filters.ContactsLastNameFilter,Filters.ContactsEmailFilter,Filters.ContactsCompanyFilter],onAdd:function(filterSet){ZContacts._filterList.includes(filterSet[0].className)||ZContacts._filterList.push(filterSet[0].className)},onRemove:function(filterSet){for(var i=0;i<ZContacts._filterList.length;i++)void 0!=filterSet.classNameList[ZContacts._filterList[i]].length&&0==filterSet.classNameList[ZContacts._filterList[i]].length&&"SearchTypeFilter"==ZContacts._filterList[i]&&(filterSet.list.length>0?(ZContacts.isRemoved=!0,ZContacts._filterList.splice(ZContacts._filterList.indexOf("SearchTypeFilter"),1)):(ZContacts.isRemoved=!1,ZContacts._filterList.splice(ZContacts._filterList.indexOf("SearchTypeFilter"),1)))},searchQuery:function(config){return contactsSearchParam(config)},ajax:function(requestParam){requestParam.config;if(zmApp.currentApp!=ZContacts.ZMailConstants.CONTACTS_TAB){var contactsURI=new ZContacts.URI(ZContacts.Contacts,zmail.zuid).setSortBy("usage_count",!1).include("emails").include("phones"),defaultParams=contactsURI.getParams()?"?"+contactsURI.getParams():"";ZContactsContext.url=contactsURI.requestURI+defaultParams}return delete requestParam.config,delete requestParam.skip_search,searchParams=requestParam,ZContacts.isSearchLoading=!0,$.getJSON(this.url+"&"+$.param(requestParam)).then(function(json){var contactList=[];if(ZContacts._countSearchObj.category_name=I18N.get("IAM.CONTACTS.SEARCH.RESULTS"),ZContacts._countSearchObj.contacts_count=0,200==json.status_code){ZContacts.isSearchLoading=!1,hasMore=json.has_more,ZContacts._countSearchObj.contacts_count=json.contacts.length,ZContacts._countSearchObj.has_more=json.has_more,zmcontact.updateHeaderBand(ZContacts._countSearchObj,0,!1);for(var i=0;i<json.contacts.length;i++)contactList.push(ZContacts.Contacts.create(json.contacts[i]));return contactList}return 404==json.status_code?(zmcontact.updateHeaderBand(ZContacts._countSearchObj,0,!1),contactList):void 0},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})},hasPagination:function(hasMore){return hasMore},mountView:function(config){var contacts=(this.getFrameworkInstance(),config.response);this.dependencyPromise.done(function(){zmcontact.contactsList(contacts,!1,!1)}),this.hasPagination()},active:function(){this.dependencyPromise.resolve()},getNextPage:function(){if(hasMore){searchParams.page=searchParams.page+1;var listElem=zmsuite.getCenter()[0].getNodes()[2].$el[0],destroyLoadingDiv=zmComponent.loadingBand({container:$(listElem).find(".SC_conLft").get(0),type:"pagination"});ZContacts.isSearchLoading=!0;var url=this.url;return ZContacts.newSearchDeletedCount>0&&(url=url+"&prepend_contacts="+ZContacts.newSearchDeletedCount),$.getJSON(url+"&"+$.param(searchParams)).then(function(json){var hasNextContactList=[];if(ZContacts._countSearchObj.category_name=I18N.get("IAM.CONTACTS.SEARCH.RESULTS"),ZContacts.newSearchDeletedCount=0,destroyLoadingDiv(),ZContacts.isSearchLoading=!1,200==json.status_code){hasMore=json.has_more,ZContacts._countSearchObj.contacts_count=ZContacts._countSearchObj.contacts_count+json.contacts.length,ZContacts._countSearchObj.has_more=json.has_more,zmcontact.updateHeaderBand(ZContacts._countSearchObj,0,!1);for(var i=0;i<json.contacts.length;i++)hasNextContactList.push(ZContacts.Contacts.create(json.contacts[i]))}else 404==json.status_code&&zmcontact.updateHeaderBand(ZContacts._countSearchObj,0,!1);hasNextContactList.length&&zmcontact.contactsList(hasNextContactList,!0,!1)},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}}}),contactsURI=new ZContacts.URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).setSortBy("usage_count",!1).include("emails").include("phones"),defaultParams=contactsURI.getParams()?"?"+contactsURI.getParams():"";ZContactsContext.url=contactsURI.requestURI+defaultParams,ZContacts.newSearchContext=ZContactsContext,zmail.Search.Models.Contexts.contactsSearchContext=ZContactsContext,zmail.Search.registerContext(ZContactsContext)}}),ZContacts.contactprint=function(options){this.options=options,this.checkValue=[],this.headerValue=[],getHtmlForPrintCard=function(){var html=new ZContacts.StringBuilder;return html.append('<span class = "zcs_loadingband"></span><div class="zcs_print_main_div">'),html.append('<div class="zcs_print_header">'),html.append("<h3>"+ZContacts.I18N.get("IAM.CONTACTS.PRINT.CARD.TEXTONE")+"</h3>"),html.append('<p class="zcs_print_header_content">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.CARD.TEXTTWO")+"</p></div>"),html.append('<div class="zcs_print_options">'),html.append('<div class="contact_card"><span class="card_design"></span><div class="contact_basicinfo"><span class="basic_info_list_dp"><span class="dp_bg"></span><span class="dp_show"></span></span><div class="contact_name">'+ZContacts.I18N.get("IAM.CONTACTS.NAME")+'</div><div class="contact_info">'+ZContacts.I18N.get("IAM.CONTACTS.JOBTITLE")+" - "+ZContacts.I18N.get("IAM.CONTACTS.WORK.CNAME")+" </div></div>"),html.append('<div class="sample_contact_address"><i class="msi-check" onclick="ZContacts.contactprint.select(event)" value="address"></i><div class="address_icon"></div><div class="address_head"><span>Work</span><div class="arrow-down"></div></div><div class="address_value">'+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS")+", "+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")+"</div></div>"),html.append('<div class="sample_contact_email"><i class="msi-check" onclick="ZContacts.contactprint.select(event)" value="email"></i><div class="email_icon"></div><div class="email_head">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.SAMPLE.EMAIL")+"</div></div>"),html.append('<div class="sample_contact_mobile"><i class="msi-check" onclick="ZContacts.contactprint.select(event)" value="phone"></i><div class="mobile_icon"></div><div class="mobile_head">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.SAMPLE.PHONE")+"</div></div>	</div>"),html.append("</div>"),html.append('<div class="zcs_contact_main_div">'),html.append('<div class="zcs_contact_card_preview">'),html.append('<h3 style="width:75%; float:left;" class="zcs_contact_card_preview_content">'+ZContacts.I18N.get("IAM.PRINT.PREVIEW")+"</h3>"),html.append("</div>"),html.append('<div id="final_business_card_print_div" class="zcs_contact_card_div" style="width:100%;padding-left:22px;">'),html.append("</div>"),html.append("</div>"),html.append("</div>"),html.append('<div class="zcs_print_button_div">'),html.append('<div class="SC_PUbtm zcs_print_buttons zmModeBG">'),html.append('<span data-field-type="zcs-print-btn" id="zcs_print_btn">'+ZContacts.I18N.get("IAM.PRINT")+"</span>"),html.append('<span data-field-type="zcs-cancel-btn" data-val="Cancel"  >'+ZContacts.I18N.get("IAM.CANCEL")+"</span>"),html.append("</div></div>"),html.toString()},getHtmlForPrintTable=function(){var html=new ZContacts.StringBuilder;return html.append('<span class = "zcs_loadingband"></span><div class="zcs_print_main_div" style="">'),html.append('<div class="zcs_print_header">'),html.append("<h3>"+ZContacts.I18N.get("IAM.CONTACTS.PRINT.TABLE.TEXTONE")+"</h3>"),html.append('<p class="zcs_print_header_content">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.TABLE.TEXTTWO")+"</p></div>"),html.append('<div class="zcs_print_options" style="height:130px;"><br>'),html.append('<div class="contact_list_header"><div class="contact_list_float" style="width:330px;">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.BASIC")+"</div>"),html.append('<div class="contact_list_float" style="width:180px;"><i class="msi-check" onclick="ZContacts.contactprint.select(event)" value="phone_table"></i>'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.PHONE")+'</div><div class="contact_list_float" style="width:310px;"><i class="msi-check" onclick="ZContacts.contactprint.select(event)" value="work_table"></i>'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.WORKADRESS")+'</div><div class="contact_list_float" style="width:310px"><i class="msi-check" onclick="ZContacts.contactprint.select(event)" value="home_table"></i>'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.HOMEADRESS")+"</div></div>"),html.append('<div class="contact_list"><div class="basic_info_list"><span class="basic_info_list_dp"><span class="dp_bg"></span><span class="dp_show"></span></span><span class="basic_info_list_details"><span class="basic_info_list_name">'+ZContacts.I18N.get("IAM.CONTACTS.NAME")+'</span><span class="email_list">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.SAMPLE.EMAIL")+"</span></span></div>"),html.append('<div class="phnum_list">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.SAMPLE.PHONE")+"</div>"),html.append('<div class="officeaddress_list">'+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS")+", "+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")+"</div></span>"),html.append('<div class="homeaddress_list">'+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS")+", "+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY")+", "+ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")+"</div>"),html.append("</div>"),html.append("</div>"),html.append('<div class="zcs_contact_main_div">'),html.append('<div class="zcs_contact_card_preview">'),html.append('<h3 style="width:75%; float:left;" class="zcs_contact_card_preview_content">'+ZContacts.I18N.get("IAM.PRINT.PREVIEW")+"</h3>"),html.append("</div>"),html.append('<br><div class="zcs_contact_card_div" style="width:100%; padding-left:23px; padding-top:50px;">'),html.append('<div class="contact_list_header"><div class="contact_list_float" style="width:330px;">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.BASIC")+"</div>"),html.append('<div class="contact_list_float" id="phone_header" style="width:180px;">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.PHONE")+'</div><div class="contact_list_float" id="work_header" style="width:310px;">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.WORKADRESS")+'</div><div class="contact_list_float" id="home_header" style="width:310px;">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.HOMEADRESS")+"</div></div>"),html.append('<div id="final_table_view_print_div"></div></div>'),html.append("</div>"),html.append("</div>"),html.append('<div class="zcs_print_button_div">'),html.append('<div class="SC_PUbtm zcs_print_buttons zmModeBG">'),html.append('<span data-field-type="zcs-print-btn" id="zcs_print_btn">'+ZContacts.I18N.get("IAM.PRINT")+"</span>"),html.append('<span data-field-type="zcs-cancel-btn" data-val="Cancel"  >'+ZContacts.I18N.get("IAM.CANCEL")+"</span>"),html.append("</div></div>"),html.toString()},ZContacts.contactprint.select=function(event,action){var render,contactPrint=new ZContacts.contactprint;if(("work"==action||"home"==action)&&(ZContacts._event=event,ZContacts._action=action,"work"==ZContacts._action?(checkValues["#address0"]=!0,checkValues["#address1"]=!1):(checkValues["#address1"]=!0,checkValues["#address0"]=!1)),$(event.target).hasClass("msi-uncheck")){$(event.target).removeClass("msi-uncheck").addClass("msi-check");var value=event.target.getAttribute("value");render=!0}else if($(event.target).hasClass("msi-check")){$(event.target).removeClass("msi-check").addClass("msi-uncheck");var value=event.target.getAttribute("value");render=!1}else $($(zmsuite.getCenter()[0].$el.find(".address_head")[0]).children()[0]).text(action[0].toUpperCase()+action.substring(1,action.length)),zmsuite.getCenter()[0].$el.find(".sample_contact_address").find(".msi-check").length&&(zmsuite.getCenter()[0].$el.find("#final_table_view_print_div").is(":visible")?contactPrint.rerenderTable(action):contactPrint.rerenderCard(action,checkValues));"phone_table"==value&&(checkValues[".phnum_list"]=render,headerValue["#phone_header"]=render),"work_table"==value&&(checkValues[".officeaddress_list"]=render,headerValue["#work_header"]=render),"home_table"==value&&(checkValues[".homeaddress_list"]=render,headerValue["#home_header"]=render),"phone"==value&&(checkValues[".contact_mobile"]=render),"email"==value&&(checkValues[".contact_email"]=render),"address"==value&&(checkValues[".contact_address"]=render,1==render&&void 0==ZContacts._action?(checkValues["#address0"]=!0,checkValues["#address1"]=!1):1==render&&void 0!=ZContacts._action&&("work"==ZContacts._action?(checkValues["#address0"]=!0,checkValues["#address1"]=!1):(checkValues["#address1"]=!0,checkValues["#address0"]=!1))),1==render?zmsuite.getCenter()[0].$el.find("#final_table_view_print_div").is(":visible")?(contactPrint.rerenderTable(value,checkValues),contactPrint.rerenderTableHeader(value,headerValue)):contactPrint.rerenderCard(value,checkValues):zmsuite.getCenter()[0].$el.find("#final_table_view_print_div").is(":visible")?(contactPrint.rerenderTableHide(value,checkValues),contactPrint.rerenderTableHideHeader(value,headerValue)):contactPrint.rerenderCardHide(value,checkValues)},ZContacts.contactprint.printValues=function(printObject){var vals=Object.keys(printObject).map(function(key){return printObject[key]});return vals},this.createPageContent=function(content){ZContacts.contactprint.$containerElem.html($(content))},this.render=function(){this.$e=ZContacts.contactprint.$containerElem},this.rerenderCard=function(input,contactPrint){for(var div=zmsuite.getCenter()[0].$el.find("#final_business_card_print_div"),objectValues=ZContacts.contactprint.printValues(contactPrint),i=0;i<objectValues.length;i++)1==objectValues[i]?void 0!=ZContacts._action?div.find(".contact_card").find(Object.keys(contactPrint)[i]).show():div.find(Object.keys(contactPrint)[i]).show():div.find(".contact_card").find(Object.keys(contactPrint)[i]).hide()},this.rerenderCardHide=function(input,contactPrint){for(var div=zmsuite.getCenter()[0].$el.find("#final_business_card_print_div"),objectValues=ZContacts.contactprint.printValues(contactPrint),i=0;i<objectValues.length;i++)0==objectValues[i]&&div.find(Object.keys(contactPrint)[i]).hide()},this.rerenderTableHide=function(input,contactPrint){var div=zmsuite.getCenter()[0].$el.find("#final_table_view_print_div");div.find(".contact_list").addClass(1==zmsuite.getCenter()[0].getNodes()[2].$el.find(".contact_list_header").find(".msi-uncheck").length?"contact_list_1050":"contact_list_710");for(var objectValues=ZContacts.contactprint.printValues(contactPrint),i=0;i<objectValues.length;i++)0==objectValues[i]&&div.find(Object.keys(contactPrint)[i]).hide()},this.rerenderTableHideHeader=function(input,contactPrint){if(null!=contactPrint)for(var div=zmsuite.getCenter()[0].$el,objectValues=ZContacts.contactprint.printValues(contactPrint),i=0;i<objectValues.length;i++)1==objectValues[i]?div.find(Object.keys(contactPrint)[i]).show():div.find(Object.keys(contactPrint)[i]).hide()},this.rerenderTable=function(input,contactPrint){var div=zmsuite.getCenter()[0].$el.find("#final_table_view_print_div");2==zmsuite.getCenter()[0].getNodes()[2].$el.find(".contact_list_header").find(".msi-check").length?div.find(".contact_list").removeClass("contact_list_710"):3==zmsuite.getCenter()[0].getNodes()[2].$el.find(".contact_list_header").find(".msi-check").length&&div.find(".contact_list").removeClass("contact_list_1050");for(var objectValues=ZContacts.contactprint.printValues(contactPrint),i=0;i<objectValues.length;i++)1==objectValues[i]&&div.find(Object.keys(contactPrint)[i]).show()},this.rerenderTableHeader=function(input,contactPrint){if(null!=contactPrint)for(var div=zmsuite.getCenter()[0].$el,objectValues=ZContacts.contactprint.printValues(contactPrint),i=0;i<objectValues.length;i++)1==objectValues[i]?div.find(Object.keys(contactPrint)[i]).show():div.find(Object.keys(contactPrint)[i]).hide()},this.bindEvents=function(){var _this=this;this.$e.find("span[data-field-type=zcs-print-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.print&&_this.options.actions.print.apply(_this)}),this.$e.find("span[data-field-type=zcs-cancel-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.cancel&&_this.options.actions.cancel.apply(_this)})},ZContacts.contactprint.tableView=function(contactsNode,workspace){var toLoadCount,uri=null,contactprint=new ZContacts.contactprint;contactprint.render(),zmsuite.getCenter()[0].$el.find(".dp_bg").css("background-image","url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/user.gif)"),zmsuite.getCenter()[0].$el.find(".dp_show").css("background-image","url("+ZContacts.meta.serviceInfo.contacts_server_url+"/images/user.gif)"),contactprint.$e.find("#final_business_card_print_div").hide();var noOfContactsSelected=contactsNode.$el.find(".zmL.SC_cont.SC_check").length,body=contactprint.$e.find("#final_table_view_print_div");if(ZContacts.contactprint.printValues(printResponse).length&&(totalLength=void 0==printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].contact_id?printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].length:ZContacts.contactprint.printValues(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]).length-1),loadingDiv=zmComponent.loadingBand({container:zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs_contact_main_div").get(0),type:"pagination"}),noOfContactsSelected){accountId=ZContacts.getCurrentAccount().getAccountId();var contactIdsArr=zmcontact.getSelectedContactIds(workspace[0].getNodes()[2].$el);uri=new ZContacts.URI(ZContacts.Contacts,accountId,contactIdsArr).include("emails").include("phones").include("address"),null!=printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]&&totalLength>0?(loadingDiv(),ZContacts.contactprint.createTableContent(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id],body,totalLength)):uri.GET().then(function(contacts){loadingDiv(),1==noOfContactsSelected&&(contacts[0]=contacts),ZContacts.contactprint.createTableContent(contacts,body,noOfContactsSelected)})}else{accountId=ZContacts.getCurrentAccount().getAccountId(),categoryId=zmcontact.getCategory(ZContacts._currentCategoryId).category_id,uri=new ZContacts.URI(ZContacts.AllContacts,accountId).include("emails").include("phones").include("address").setSortBy(ZContacts.sortBy,!0),zmcontact.isRootFolder(categoryId)||uri.addFilter("categories",categoryId);var limit,start;start=0,zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count<=100?(limit=zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count,toLoadCount=-1):(limit=100,toLoadCount=zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count-limit),uri.setRange(start,limit),null!=printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]&&printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].length>0?(loadingDiv(),ZContacts.contactprint.createTableContent(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id],body,printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id].length)):uri.GETS().then(function(contacts){loadingDiv(),ZContacts.contactprint.createTableContent(contacts,body,contacts.length)})}var editorActions={print:function(){if(0==zmsuite.getCenter()[0].$el.find("#final_table_view_print_div").find(".contact_list").length)return void zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.CONTACTS.PRINT.EMPTY.PREVIEW"));var prtContent,winPrint=window.open("","","left=0,top=0,width=800,height=800,toolbar=no,scrollbars=yes,status=no,position=fixed");winPrint.document.write('<html><body onload="window.print()">'),winPrint.document.write('<link type="text/css" rel="stylesheet" href="'+ZContacts.meta.serviceInfo.contacts_server_url+'/new/css/new_style.css">'),zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID)[0].$el.find("#final_table_view_print_div").is(":visible")&&(prtContent=document.getElementsByClassName("zcs_contact_card_div")[0],winPrint.document.write('<div style="width:1600px">')),winPrint.document.write('<div class="loading" style="margin-left: 23%; margin-top: 23%;"></div>'),winPrint.document.write('<div id="loadContent" style="margin-left: 19%; margin-top: 2%;">'+ZContacts.I18N.get("IAM.CONTACTS.PRINT.FETCH")+"</div>"),noOfContactsSelected?($(winPrint.document.getElementById("loadContent")).remove(),$(winPrint.document.getElementsByClassName("loading")[0]).remove(),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</div></body></html>"),zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),winPrint.document.close(),winPrint.focus()):-1==toLoadCount?($(winPrint.document.getElementById("loadContent")).remove(),$(winPrint.document.getElementsByClassName("loading")[0]).remove(),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</div></body></html>"),zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),winPrint.document.close(),winPrint.focus()):(start=100,limit=zmcontact.getCategory(ZContacts._currentCategoryId).contacts_count,uri.setRange(start,limit),uri.GETS().then(function(contacts){$(winPrint.document.getElementById("loadContent")).remove(),ZContacts.contactprint.createTableContent(contacts,body,contacts.length),$(winPrint.document.getElementsByClassName("loading")[0]).remove(),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</div></body></html>"),zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),winPrint.document.close(),winPrint.focus()}))},cancel:function(){zmTab.currentTab==ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)),zmcontact.unChkAll()}},printAction=new ZContacts.contactprint({actions:editorActions});printAction.render(),printAction.bindEvents()},ZContacts.contactprint.createTableContent=function(contacts,body,length){var contactprint=new ZContacts.contactprint;contactprint.render();var len=$(zmsuite.getCenter()[0].$el.find("#final_table_view_print_div").find(".contact_list")).length;len&&(len=zmsuite.getCenter()[0].$el.find("#final_table_view_print_div").find(".contact_list").length);for(var name,contact_info,email_table,contactList,basicInfoList,basicInfoListDp,dpBg,dpShow,basicInfoListDetails,basicInfoListName,emailList,phnumList,officeAddressList,homeAddressList,contactListArray=document.createDocumentFragment(),i=len,j=0;length+len>i;i++,j++)if(null!=contacts[j]){if(name=(contacts[j].first_name||"")+" "+(contacts[j].middle_name||"")+" "+(contacts[j].last_name||""),contact_info=contacts[j].job_title||"",email_table="",contacts[j].emails)for(var k=0;k<contacts[j].emails.length;k++)contacts[j].emails[k].is_primary&&(email_table=contacts[j].emails[k].email_id);var phone="";if(contacts[j].phones)for(var k=0;k<contacts[j].phones.length;k++)if("mobile"==contacts[j].phones[k].type){phone+=contacts[j].phones[k].number;break}if(contactList=document.createElement("div"),contactList.className="contact_list",contactList.id=contacts[j].contact_id,basicInfoList=document.createElement("div"),basicInfoList.className="basic_info_list",basicInfoListDp=document.createElement("span"),basicInfoListDp.className="basic_info_list_dp",dpBg=document.createElement("span"),dpBg.className="dp_bg",dpBg.style.backgroundImage="url("+contacts[j].photo_url+")",dpShow=document.createElement("span"),dpShow.className="dp_show",dpShow.style.backgroundImage="url("+contacts[j].photo_url+")",basicInfoListDp.appendChild(dpBg),basicInfoListDp.appendChild(dpShow),basicInfoListDetails=document.createElement("span"),basicInfoListDetails.className="basic_info_list_details",basicInfoListName=document.createElement("span"),basicInfoListName.className="basic_info_list_name",basicInfoListName.appendChild(document.createTextNode(name)),basicInfoListDetails.appendChild(basicInfoListName),emailList=document.createElement("div"),emailList.className="email_list",emailList.appendChild(document.createTextNode(email_table)),basicInfoListDetails.appendChild(emailList),basicInfoList.appendChild(basicInfoListDp),basicInfoList.appendChild(basicInfoListDetails),contactList.appendChild(basicInfoList),phnumList=document.createElement("div"),phnumList.className="phnum_list",phnumList.appendChild(0==phone.length?document.createTextNode("--"):document.createTextNode(phone)),contactList.appendChild(phnumList),contacts[j].address)for(var home_address="",work_address="",k=0;k<contacts[j].address.length;k++)"home"==contacts[j].address[k].type&&(home_address+=(contacts[j].address[k].street_addr?contacts[j].address[k].street_addr:"")+(contacts[j].address[k].street_addr1?","+contacts[j].address[k].street_addr1:"")+(contacts[j].address[k].city?","+contacts[j].address[k].city:"")+(contacts[j].address[k].state?","+contacts[j].address[k].state:"")+(contacts[j].address[k].country?","+contacts[j].address[k].country:"")+(contacts[j].address[k].postal_code?","+contacts[j].address[k].postal_code:"")),"work"==contacts[j].address[k].type&&(work_address+=(contacts[j].address[k].street_addr?contacts[j].address[k].street_addr:"")+(contacts[j].address[k].street_addr1?","+contacts[j].address[k].street_addr1:"")+(contacts[j].address[k].city?","+contacts[j].address[k].city:"")+(contacts[j].address[k].state?","+contacts[j].address[k].state:"")+(contacts[j].address[k].country?","+contacts[j].address[k].country:"")+(contacts[j].address[k].postal_code?","+contacts[j].address[k].postal_code:""));officeAddressList=document.createElement("div"),officeAddressList.className="officeaddress_list",void 0==work_address||0==work_address.length?(officeAddressList.style.textAlign="center",officeAddressList.appendChild(document.createTextNode("--"))):officeAddressList.appendChild(document.createTextNode(work_address)),homeAddressList=document.createElement("div"),homeAddressList.className="homeaddress_list",void 0==home_address||0==home_address.length?(homeAddressList.style.textAlign="center",homeAddressList.appendChild(document.createTextNode("--"))):homeAddressList.appendChild(document.createTextNode(home_address)),contactList.appendChild(officeAddressList),contactList.appendChild(homeAddressList),contactListArray.appendChild(contactList)}body.append(contactListArray),zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID)[0].$el.find("#final_table_view_print_div").find(".contact_list").on("mouseover",function(){$(this).find("#cross").is(":visible")||($(this).append('<a id="cross" style="margin-top:30px; margin-right:40px;"><i class="msi-close"></i></a>'),$("#cross").click(function(){for(var i=0;i<ZContacts.contactprint.printValues(printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id]).length-1;i++)if(null!=printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id][i]&&printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id][i].contact_id==this.parentNode.id){printResponse[zmcontact.getCategory(ZContacts._currentCategoryId).category_id][i]=null;break}$(this.parentNode).remove()}))}),zmsuite.getCenter(ZContacts.ZMailConstants.PRINT_WORKSPACE_APP_ID)[0].$el.find("#final_table_view_print_div").find(".contact_list").on("mouseleave",function(){$(this).find("#cross").remove()}),zmsuite.getCenter()[0].$el.find(".contact_list_float").children().css("padding-right","5px")}},$.subscribe("zm/CrossProductMessage",function(event,object){"CO"==object.prd&&"reset"==object.msg&&(zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId)),zmcontact.refreshContactCounts(),ZContacts.meta.user.reset_scheduled=!1,zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.RESET.CONTACTS.IS.FINISHED.SCHEDULING")))});