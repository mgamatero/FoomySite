"use strict";window.zmPreviewTemplate=function(){var G,A,de={},q="";A=zmUtil.isNewMDV?{composeActionBar:"zmMailActions"}:{composeActionBar:"zm_ry"};var O=ZMail.lConstants,ce=O.cls,pe=zmText.get("preview"),ze=function(e){var t=!1,i=zmConUtil.parseContacts(e);return 1===i.length&&!0!==i[0].invalid&&-1!==(e=e.toLowerCase()).indexOf("undisclosed-recipients")&&(t=!0),t},ue=function(e,t){try{if(!e)return"";e=e||"";var i,a=zmConUtil.splitncheck(e,"object")||[],n=[];return a.forEach(function(e,t){i=(i=e.eid||"").trim(),n.push(i)}),t?", "+n.join(", "):n.join(", ")}catch(e){return zmUtil.debugLog(e),""}},fe=function(){var i,a,n,l,s,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:" ",m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=zmConUtil.splitncheck(e,"object")||[],r=zdom("fragment",null),o="";return t.forEach(function(e,t){(l=(e.eid||"").trim())&&(a=(e.fn||"").trim(),a=(a=zmUtil.replaceHTMLEntities(a))||l,n=(e.nn||"").trim(),n=zmUtil.replaceHTMLEntities(n),a===n&&(n=""),a+=n=n?" ("+n+")":"",s=l,m.hideEmail||(a='"'+a+'"',a+=" <"+l+">",s=""),t&&(o=", "),i=zdom("span",{className:"zm_eadd","data-eid":l},a),s&&i.setAttribute("data-tooltip",s),i=zdom("fragment",null,o,i),r.appendChild(i))}),r},Z=function(e,t){(1<t.find(".SC_pct:not('.SC_Drft')").length||t.find(".SCS-post").length)&&(t.find(".SC_pct").removeClass("SC_Tfcs"),$.e(e).closest(".SC_pct").addClass("SC_Tfcs"),zmUtil.isChildWindow()&&zmWindow.updateHeaderIcons())},J=function(e){var t,i,a,n="";(t=$(e).closest(".zmPCon")[0].id)&&(t=(a=t.substring(3)).substring(1),(i=zmContentCache.isCached(t)?zmContentCache.get(t):"")&&i.SHRINKED&&i.BLCKCON&&i.CONTENT.length<i.BLCKCON.length&&(n=$("#vfc"+a).parent())),$(e).next().is(":visible")?($(e).next().hide(),n&&n.hide()):($(e).next().show(),n&&n.show()),zmUtil.applyLBDots(n)},K=function(){var e=zmAdHocSettings.getMailViewSettings();e.headerState="c"===e.headerState?"e":"c",zmAdHocSettings.setMailViewSettings(e)},ge=function(e,t,i){var a,n,l=$(e),s=l.attr("data-mid");t&&_zm.stopEvents(t);var m=i||zmAdHocSettings.getMailViewSettings().headerState;if(l.hasClass("zm_tm")&&(m="c"),"e"===m){n="msi-zmPle";var r=zmContentCache.get(s);if(zmContentCache.isCached(s)&&r)if(l.length)a=!l.closest(".SC_Twpr").length||r.streams||zmUtil.isZohoAccount(zmail.accId)?r.RDT:r.SENTTIME||"";else a=r.RDT;l.addClass("zms")}else if("c"===m){n="msi-zmPme";var o=zmUtil.getMailObj(s);o&&(a=o.DT),l.removeClass("zms")}l.find(".msi-zmPme, .msi-zmPle").attr("class",n),a&&l.find(".sum").html(a)},he=function(e){var t=" zmDoubleIcon",i="",a=zmail.urls.zohoWebsiteLink+"help/"+"email-encryption.html#alink3",n=pe.contentOptions.learn,l=" "+pe.contentOptions.encryption+" ",s="",m="";return 0===e.encryptionLevel?(s="msi-unsecured",s+=t,i=" "+pe.contentOptions.plain+" ",m="redDtxt"):1===e.encryptionLevel?(s="msi-secured",s+=t+" ylwtxt",i=" "+pe.contentOptions.tls+" ",m="ylwtxt"):2===e.encryptionLevel&&(s="msi-secured",s+=t+" greenDtxt",i=" "+pe.contentOptions.smime+" ",m="greenDtxt"),zdom("div",{id:"zmENCLev"+e.elemId,className:"zmpdtl zmvia"},zdom("div",{class:"zmpr"},zdom("span",null,zdom("em",null,l),zdom("span",{className:"zmShowO "+m},zdom("i",{className:s}),i,"Â "),zdom("span",null,zdom("a",{target:"_blank",rel:"noopener noreferrer",href:a},n)))))},ve=function(e,t,i){try{var a=i&&i!==zmail.folId.sId&&i!==zmail.folId.oId&&(zmUtil.isChildWindow()||zmUtil.isFolderId(i)),n=zdom("fragment",null);if(a&&e){var l=(zmConUtil.splitncheck(e,"object")||[])[0];(l=l&&l.eid)!==t&&n.appendChild(zdom("div",{class:"zmpdtl zmvia"},zdom("div",{class:"zmpr"},zdom("span",null,zdom("em",null,pe.contentOptions.replyTo+" "),fe(e)))))}return n}catch(e){return zmUtil.debugLog(e),""}},N=function(a,e){var t,i,n=a.elemId,l=a.msgId,s="",m=a.showLimitedData,r=zmUtil.getMailObj(l),o=a.elemObj,d=function(e){var t=e.type,i={to:pe.contentOptions.to,cc:pe.contentOptions.cc,bcc:pe.contentOptions.bcc};return zdom("div",{id:{to:"zmTO",cc:"zmCC",bcc:"zmBCC"}[t]+a.elemId,className:"zmpdtl"},zdom("div",null,zdom("div",{className:"zmpr"},zdom("span",null,zdom("em",{"data-tooltip":i[t]},i[t]),fe(a[t])))))},c=zdom("fragment",null),p=[];if(a.to&&!ze(a.to)&&p.push(a.to),a.cc&&p.push(a.cc),a.bcc&&p.push(a.bcc),c.appendChild(fe(p.join(),{hideEmail:!0})),o&&$.e(o.prevElem).find("#zmHdr"+n).length&&!$.e(o.prevElem).find("#zmC"+n).length||"print"!==a.rFrom&&!o&&$.q("#zmHdr"+n).length&&!$.q("#zmC"+n).length){var z,u=zdom("fragment",null),f=zdom("fragment",null),g=zdom("fragment",null),h=zdom("fragment",null);if((z=o?$.e(o.prevElem).find("#zmHdr"+n):$.q("#zmHdr"+n)).removeClass("zm_tm"),r.S||z.find(".zmPT").addClass("zm_urd"),z.find(".sum").text(r.DT),4!==e)z.find(".zmpr").eq(1).find("font:first").after(zdom("span",null," ",c," "));else{var v=ue(a.to)+ue(a.cc,!0)+ue(a.bcc,!0),C=v;70<v.length&&(v=v.substring(0,70)+"..."),z.find(".zmBPVtoCc").appendDOM(zdom("fragment",null,zdom("span",{class:"greyText"},pe.contentOptions.To),zdom("span",{"data-tooltip":C},v)))}a.to&&!ze(a.to)&&(z.find("#zmTO"+a.elemId).remove(),u=d({type:"to"})),a.cc&&(f=d({type:"cc"})),a.bcc&&(g=d({type:"bcc"})),h=ve(a.replyTo,a.frm,r.FD),a.to||a.cc||a.bcc||z.find("#zmTO"+a.elemId).length||(u=zdom("div",{id:"zmTO"+a.elemId,className:"zmpdtl"},zdom("div",null,zdom("div",{class:"zmpr"},zdom("span",null,zdom("em",null,pe.contentOptions.to)))))),t=zmPreviewTemplate._rPath(a,"via"),i=zmPreviewTemplate._rPath(a);var I=z.find("#zmLBL"+a.elemId),b=zdom("fragment",null);return a.hasOwnProperty("encryptionLevel")&&(b=he(a)),I.length?(I.before([u,f,g]),I.after(h)):(z.find(".zmPT").appendDOM([u,f,g]),z.find(".zmPT").appendDOM(h)),z.find(".zmPT").appendDOM(b),i.childNodes&&i.childNodes.length&&z.find(".zmPT")&&(z.find(".zmPT").find('div[data-zmvia="less"]').appendDOM(t),z.find(".zmPT").appendDOM(i)),ge(z),z[0].outerHTML}var S,T="",M=r.FD||"",w=!0,O={},y=a.isSharedDraft||!1,U=a.isDraftEditable||!1,_=zmUtil.isSharedFolder(M),A="";r.streams&&(A="default"),a.sm||(a.sm="");var N=!1;if(zmUtil.isChildWindow()){if(r&&r.RMOBJ&&!$.isEmptyObject(r.RMOBJ)){var L=r.RMOBJ.WT;1!==L&&2!==L&&3!==L||(N=!0)}zmail.folId.dId!==r.FD&&zmail.folId.spId!==r.FD&&zmail.folId.tId!==r.FD&&zmail.folId.teId!==r.FD||(N=!1)}else N=zmList.isRMOBJ(l);zmUtil.isZohoAccount(zmail.accId)||(N=!1);var D,P,x,E=zdom("div",{className:"SC_frt"}),k=function(e){var t=e.iconCls,i=e.separator,a=e.title;return zdom("li",{className:i?"SC_lbr":"","data-tooltip":a},zdom("b",null,i?zdom("div",{class:"SC_hd"}):"",zdom("span",null,zdom("i",{"data-detail":"prvHdr",className:t}))))},F=!1;if(!a.isReminderMail&&!zmUtil.isChildWindow()&&!m&&(N||(D=l,P=[zmail.folId.oId,zmail.folId.dId,zmail.folId.spId,zmail.folId.tId,zmail.folId.teId],x=zmUtil.getMailObj(D)||{},!(!D||0<=P.indexOf(x.FD)||!zmUtil.isZohoAccount(zmail.accId)||zmUtil.isSharedFolder(x.FD)||x.streams||zmail.isROMode)))){var H=N?pe.contextmenu.updReminder:pe.contextmenu.setReminder,j=N?" SC_thm":"";E.appendChild(zdom("ul",{id:"zmprv_header_"+l+"_remind","data-tooltip":H},k({iconCls:"msi-reminder"+j}))),F=!0}if((3===a.opentype||y&&!U)&&(w=!1),!m&&w)if(r.FD===zmail.folId.oId||U)E.appendChild(zdom("ul",{className:"SC_ldot"},k({iconCls:"msi-edit"})));else if(r.FD===zmail.folId.dId)E.appendChild(zdom("ul",{className:"SC_ldot"},zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-edit","data-detail":"prvHdr"}),zdom("i",{class:"msi-barrow"}))))));else{var R=zmUtil.isSharedFolder(M,"R");R||zmail.isROMode||E.appendChild(zdom("ul",null,k({iconCls:"msi-reply",separator:F,title:pe.contextmenu.reply}),k({iconCls:"msi-replyall",title:pe.contextmenu.replyall}),k({iconCls:"msi-forward",title:pe.contextmenu.forward}))),E.appendChild(zdom("ul",null,k({iconCls:"msi-barrow",separator:!R,title:pe.iconTooltip.moreact})))}E=zdom("div",{className:"SCmb"},E);var B=zdom("li",null,zdom("img",{src:""})),W=r.PR;1===W||2===W?B.appendChild(zdom("i",{className:"msi-priority SC_red"})):4!==W&&5!==W||B.appendChild(zdom("i",{className:"msi-priority SC_blue"}));var V=a.frm,G=r.SN||a.sender;try{r.F===zmail.aInfo[zmail.accId].mailId&&(G="Me")}catch(e){}if(O["data-eid"]=V,S={attr:O,name:G,img:!1,smimeStatus:a.isSmimeSignAvl,eid:V,ret:"dom"},B.appendChild(zmConUtil.bubbleUtil(S)),B.appendChild(zmPreviewTemplate._rPath(a,"less",G)),e&&4===e){var q=ue(a.to)+ue(a.cc,!0)+ue(a.bcc,!0);if(q.length){var Z=q;70<q.length&&(q=q.substring(0,70)+"..."),B.appendChild(zdom("div",{className:"SC_cs zmBPVtoCc"},zdom("span",{class:"greyText"},pe.contentOptions.To),zdom("span",{"data-tooltip":Z},q)))}else B.appendChild(zdom("div",{className:"SC_cs zmBPVtoCc"}))}B.appendChild(zdom("span",{className:"SC_lnk SC_ldot zm_unsub",style:{display:"none"}},pe.newsletter.unsubscribe)),zmUtil.isZohoAccount(zmail.accId)&&zmail.isSmartFilterEnabled&&r.SFT&&!zmUtil.isSharedFolder(r.FD)&&(!zmUtil.isChildWindow()||zmUtil.isChildWindow()&&opener)&&B.appendChild(zdom("span",{className:"SC_lnk SC_ldot zm_exclude","data-tooltip":pe.smartfilter.exclude_tip},pe.contentOptions.exclude));var J=zdom("div",null);B.appendChild(J);var K,X=pe.contentOptions.plain,Q=pe.contentOptions.smime;if(0===a.encryptionLevel?J.appendChild(zdom("fragment",null,zdom("div",{"data-tooltip":X,className:"zmUnsecuredMail"},zdom("i",{className:"msi-unsecured zmDoubleIcon"})),zdom("span",{className:"zmSDot"}))):2===a.encryptionLevel&&J.appendChild(zdom("fragment",null,zdom("div",{"data-tooltip":Q,className:"zmUnsecuredMail"},zdom("i",{className:"msi-secured zmDoubleIcon greenDtxt"})),zdom("span",{className:"zmSDot"}))),a.hasAtt&&J.appendChild(zdom("i",{class:"msi-attachicon"})),m||r.FD===zmail.folId.spId||r.FD===zmail.folId.oId||r.FD===zmail.folId.dId||(!r.streams||r.groupId!==zmail.zuid||"0"===r.NFG)&&r.streams||J.appendChild(function(e){e=parseInt(e);var t={0:ce.noflag,1:ce.blueflag,2:ce.redflag,3:ce.greenflag};return zdom("div",{className:t[e]})}(a.flag)),r.DT||(r.DT=a.date),J.appendChild(zdom("span",{className:"sum"},r.DT||a.date)),!a.label&&r.TAG&&(a.label=r.TAG),_||m||(a.label&&a.label.length?r.FD!==zmail.folId.spId&&r.FD!==zmail.folId.dId&&(T=zdom("fragment",null,zmsTemplates.constructTagListHTML(a.label,!1,"",A,{customClass:"zmViewAllLbl",getDOM:!0,constructOuterDiv:!0}),zdom("i",{className:"msi-plus zmst_lbl"}))):T=zdom("i",{className:"msi-label"}),J.appendChild(zdom("div",{className:"SC_ldot zm_lbl"},T))),r.streams&&!zmUtil.isChildWindow()){var Y="msi-fav";r.isFav&&(Y="msi-fav SC_fav"),J.appendChild(zdom("div",{className:"SC_ldot"},zdom("i",{className:Y})))}m||(s=function(e){if(zmail.folTree[0][e])return zmail.folTree[0][e].FN;var t,i=zmail.folTree[1];for(var a in i)if((t=i[a].CH)[e])return t[e].FN;return""}(M),(0!==a.opentype&&4!==a.opentype||de&&("search"===de.view||!de.fId||1===r.TH))&&J.appendChild((K=s,r.AR&&(K+=" ("+pe.contentOptions.archived+")"),zdom("span",{className:"SC_ldot zm_folname js-fnHolder"},K))));var ee=zdom("fragment",null);if(!_&&!m){var te=function(e){var t=e.type;return zdom("div",{id:"zmLBL"+a.elemId,className:"zmpdtl"},zdom("div",null,zdom("div",{className:"zmpr"},zdom("span",null,zdom("em",null,pe.contentOptions.tags),zdom("div",{className:"zm_lbl"},"icon"===t?zdom("i",{className:"msi-label"}):zmsTemplates.constructTagListHTML(a.label,!0,"",A,{getDOM:!0,constructOuterDiv:!0}))))))};a.label&&a.label.length?r.FD!==zmail.folId.spId&&r.FD!==zmail.folId.dId&&ee.appendChild(te({})):ee.appendChild(te({type:"icon"}))}var ie="";if(!m&&a.showIndex){var ae=r&&zmUtil.getListMap(r.T);if(r.TH&&ae){var ne,le;ne=zmUtil.isChildWindow()?(le=ae.MO).length:(le=zmList.getListForAllMailsView(de,r.T,!0)).length;var se=le.indexOf(l);-1!==se&&(se+=1,ie=zdom("span",{id:"zm_readtitle"},pe.contentOptions.readingindex,zdom("em",null,se),"/",zdom("em",null,ne)))}}a.thd&&(c=zdom("fragment",null));var me="zmPHdr";a.thd&&(me+=" zm_tm",M===zmail.folId.sId&&r&&r.TH&&(me+=" zmsnt"));var re="";m||0!==r.S||r.FD===zmail.folId.oId||(re=" zm_urd");var oe=zdom("div",{id:"zmHdr"+a.elemId,className:me,"data-elmId":a.elemId,"data-mid":l},zdom("div",{className:"zmPT"+re},zdom("div",{class:"zmpr"},E,zdom("ul",{className:"SC_pvul"},B),m?"":zdom("i",{className:"msi-zmPme"}),zdom("i",{style:{display:"none"},className:"msi-share js-shareicon"})),zdom("div",{className:"zmpr zmpsrt"},zdom("font",{className:"zm_mail_desc"},zmUtil.replaceHTMLEntities(a.sm)),zdom("span",null,c)),a.to&&!ze(a.to)?d({type:"to"}):"",a.cc?d({type:"cc"}):"",a.bcc?d({type:"bcc"}):"",a.to||a.cc||a.bcc?"":d({type:"to"}),ee,ve(a.replyTo,a.frm,r.FD),zmPreviewTemplate._rPath(a),a.hasOwnProperty("encryptionLevel")?he(a):""),zdom("div",{className:"zmmre"},ie));return ge(oe),oe.outerHTML},L=function(e,t){var i=$.e(e).find("#zmail_block");return i.length?(i.appendDOM(zdom("i",{className:"msi-ellipsis zmDoubleIcon"})),$.e(zdom("div",{style:{display:"none"}},$.dangerouslyParseHTML(t))).insertDOMAfter(i)):e.textContent.trim().length?e.appendChild(zdom("fragment",null,zdom("div",null,zdom("i",{className:"msi-ellipsis zmDoubleIcon"})),zdom("div",{style:{display:"none"}},$.dangerouslyParseHTML(t)))):e.appendChild(zdom("div",null,$.dangerouslyParseHTML(t))),e},l=function(e,t){var i,a=!1;"plainContent"===t.type&&(a=!0);var n=t.msgId||e.msgId||"",l=zmUtil.getMailObj(n),s=""!==e.SENDER?e.SENDER:e.FROM,m=l&&l.AT||0,r=l&&l.TAG||t.tg||null,o=l&&l.NFG||t.flg||null,d=l&&l.SM||t.sm||"",c=e.TO||"",p=e.CC||"",z=e.BCC||"",u=e.RDT||"",f=e.READSTATUS||"",g=e.CONTENT?e.CONTENT:"",h=t.opentype,v=zmUtil.isChildWindow();v||(g=ZMail.previewUtil.getSmartHighLightedContent({mailContentAttrs:e})||g);var C=zdom("div",{className:"jsConTent"},$.dangerouslyParseHTML(g));if(c=(c=c.replace(/&lt;/gi,"<")).replace(/&gt;/gi,">"),p=(p=p.replace(/&lt;/gi,"<")).replace(/&gt;/gi,">"),z=(z=z.replace(/&lt;/gi,"<")).replace(/&gt;/gi,">"),e.BLCKCON){var I=v?e.BLCKCON:ZMail.previewUtil.getSmartHighLightedContent({mailContentAttrs:e,highlightDate:!1,contentKey:"BLCKCON"});L(C,I)}0===h||4===h?i=de&&"search"===de.view?"S"+n:"P"+n:2===h?i="T"+n:1===h?i="W"+n:3===h&&(i="N"+n);var b={msgId:n,frm:e.FROM,sender:s,label:r,hasAtt:m,to:c,cc:p,bcc:z,flag:o,date:u,sm:d,elemId:i,opentype:t.opentype,src:t.src,readsts:f,isSharedDraft:t.isDraftMail,isDraftEditable:t.isDraftEditable,showIndex:t.showIndex,rFrom:t.rFrom,showLimitedData:a,elemObj:t.elemObj,via:e.SPAMDATA&&e.SPAMDATA.VIA,replyTo:e.REPLYTO,viaDomain:e.SPAMDATA&&(e.SPAMDATA.VIA_DOMAIN||e.SPAMDATA.VD),isReminderMail:t.isReminder,shwDispName:e.SHOWDISPLAYNAME};b.rPath=e.RETURNPATH,b.delegate=e.DELEGATE;var S,T=zdom("div",{className:"zmRdrIco"},zdom("i",{className:"msi-readerView SC_thm","data-tooltip":pe.contentOptions.reader}));e.hasOwnProperty("MSGINTEG")&&e.MSGINTEG[8]&&e.MSGINTEG[8][0]&&(b.encryptionLevel=e.MSGINTEG[8][0].MEL,b.isSmimeSignAvl=!1,2===e.MSGINTEG[8][0].SSS&&(b.isSmimeSignAvl=!0),2===e.MSGINTEG[8][0].SES&&(S=zmail.urls.zohoWebsiteLink+"help/email-encryption.html#alink3",C=zdom("div",{class:"zmMsgBox zmWarnBox"},zdom("div",{class:"zmMsgBoxIcon"},zdom("i",{class:"msi-warning"})),zdom("div",{class:"zmMsgBoxData"},zdom("h4",null,pe.contentOptions.title,zdom("a",{href:S,target:"_blank",rel:"noopener noreferrer"},zdom("i",{class:"msi-helpRound"}))),zdom("p",null,pe.contentOptions.delCert)))));var M,w="";if(e.SHRINKED&&!a){var O=e.BLCKCON&&e.CONTENT.length<e.BLCKCON.length;M={toHide:O}.toHide,w=zdom("div",{className:"zmListInfoBox",id:"clippedMsg",style:M?{display:"none"}:{}},zdom("font",{id:"vfc"+i,className:"zmLink"},pe.contentOptions.viewfullcontent),zdom("span",{className:"zmSDot"}),zdom("span",null,pe.contentOptions.truncated))}var y=l&&l.FD,U=!(3===h||t.isDraftMail||a||zmUtil.isSharedFolder(y,"R")||zmail.isROMode),_="";return l&&l.TH&&(_=!de||de.fId!==l.FD&&""!==de.fId?" SC_Tfcs SC_Tfdr":" SC_Tfcs"),zdom("div",{className:"SC_pct "+_},$.dangerouslyParseHTML(N(b,t.opentype)),zdom("div",{id:"zmCon"+i,className:"jsContentpart"},a?"":T,zdom("div",{id:"zmC"+i,className:"zmPCon"},e.EXTIMG&&"none"!==e.EXTIMG.link?zdom("div",{className:"zmListInfoBox",id:"ImgDis"+i},zdom("span",{className:"zmLink",style:{display:"none"},"data-mode":"temporary"},pe.contentOptions.display),zdom("span",{className:"zmSDot"}),zdom("span",{style:{display:"none"},"data-mode":"message"},pe.contentOptions.imagehidden)):"",zdom("div",{className:"zmPCnt","data-zmcopy":!0},C),w),U?function(e){var t,i={reply:pe.contextmenu.reply,replyall:pe.contextmenu.replyall,fwdi:pe.contextmenu.forward,eanew:pe.contextmenu.editasnew,outbox:pe.contextmenu.edit,sharemail:pe.contextmenu.shareMail,shareConversation:pe.contextmenu.shareConversation},a=["reply","replyall","fwdi","eanew"];if(zmUtil.hideCommentBox()&&zmUtil.isZohoAccount(zmail.accId)){var n=(zmUtil.getMailListingDetails()||{}).fId;n&&!(zmfolAction.isMutualFolder(n)||zmUtil.isSharedFolder(n)||_zm.isOfflineSyncActive())&&a.push("sharemail")}t=zmUtil.getMailObj(e).FD===zmail.folId.oId?["outbox"]:a;var l=zdom("fragment",null);return t.forEach(function(e){l.appendChild(zdom("span",{"data-type":e},i[e]))}),zdom("div",{className:A.composeActionBar},l)}(n):"")).outerHTML},r=function(e){if(e.readTime)return!1;var t=zmUtil.textReadTime(e.CONTENT);return e.readTime=t,!0},X=function(t,i){var n=t&&zmContentCache.get(t);n&&zmAppLoader.load("zmReader").then(function(){var s,e,m,a=((m={}).currMsgId=t,(i=i?$.e(i).closest(".SC_Twpr"):zmsuite.getCenter(zmTab.currentTab)[1].$el.find(".SC_Twpr")).length&&1<i.find(".SC_pct").length?(e=zmUtil.getMailObj(t).T,m.mList=e&&zmUtil.getListMap(e,"MO")||[t]):m.mList=[t],m.index=m.mList.indexOf(m.currMsgId),{hasNext:function(){return m.index<m.mList.length-1},hasPrev:function(){return 0<m.index},fetchMail:function(e,t){var i,a={};if("prev"===e)m.index-=1,m.index=Math.max(m.index,0),i=m.mList[m.index];else{if("next"!==e)return;m.index+=1,m.index=Math.min(m.index,m.mList.length-1),i=m.mList[m.index]}if(m.currMsgId=i,zmContentCache.isCached(i))a=zmContentCache.get(i),0===zmUtil.getMailObj(i).S&&zmail.MailAction.Initializer.applyActions("read","click",{msgId:[i],thd:[]}),r(a),t.resolve(s(i,a));else{var n=function(e){var t=zmUtil.getMailObj(e),i=t.FD;if(!t)return!1;var a={accId:zmail.accId,msgId:e,folId:i,split:!0,summary:!0,vfc:!0};return 0===t.S&&(a.markread=!0),t.AR&&(a.archiveStatus=!0),i&&zmUtil.isSharedFolder(i)&&(a.shId=zmUtil.getShareId(i),a.isSh=!0,a.shareId=a.shId,a.groupId=zmail.shrTree[0][i].OZUID),t.streams&&(a.accId=t.accId,delete a.folId,a.actionType=t.actionType,a.streamsView="true",a.groupId=t.groupId,a.entityId=e,a.entityType=t.entityType),a}(i),l=function(e){r(e),"success"===e.READSTATUS&&(zmUtil.isChildWindow()?zmWindow.rapplyActions:zmail.MailAction.Initializer.rapplyActions)({result:"success"},{mailId:[i],thd:[],action:"read"}),t.resolve(s(i,e))};zmUtil.isChildWindow()?zmWindow.sendMailDataReq(n,{},l):zmList.sendMailDataReq(n,{},l)}},isConversation:function(){return 1!==m.mList.length},convCount:function(){return m.mList.length},currIndex:function(){return m.index+1}});s=function(e,t){var i=zmUtil.getMailObj(e);return{title:i.SB,date:i.DT,mailId:i.F,content:t&&t.CONTENT,handler:a,readTime:t&&t.readTime,attList:t.NEWATT||[]}},r(n),zmReader.load(s(t,n))})},a=function(e,t,i){var a,n,l,s=e.target||e.srcElement,m="";s=$(s),n=$(s).closest(".SC_pct").children(":first").attr("data-mid"),l=$(s).closest(".SC_pct").children(":first").attr("data-elmId")||(zmPreviewTemplate.getPrefixOnCurrentab()||q)+n,a=$(s).attr("class")||"";var r,o,d,c=zmUtil.getMailObj(n);if(-1!==a.indexOf(ce.flag)?a="zmflg":-1!==a.indexOf("zm_unsub")?a="zm_unsub":-1!==a.indexOf("msi-fav")?a="msi-fav":-1!==a.indexOf("zm_exclude")?a="zm_exclude":-1!==a.indexOf("msi-ellipsis")&&(a="msi-ellipsis"),a||!s.parent().hasClass("SC_cs")||s.closest(".SC_pct").hasClass("SC_Drft")||(a=(s=s.parent()).attr("class")),(s.hasClass("msi-label")||s.hasClass("zmst_lbl")||s.closest(".zmLbl").length)&&(a="zm_lbl"),s.hasClass("jsCallBtn")&&(a="jsCallBtn"),"IMG"===s[0].tagName){var p=[/(?:https?:\/\/)?[^.\s]+\.youtube\.[^./]+\/[^\s]*watch\?[^\s]*v=([^\s&#/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?[^.\s]+\.youtube\.[^./]+\/v\/([^\s&#/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?youtu\.be\/([^\s&#/]+)(?:&t=([^\s&#]+))*[^\s]*/g];if("A"===s.parent()[0].tagName){var z,u,f,g,h,v=p.length,C=s.parent()[0].href,I="",b="//www.youtube.com/embed/{{videoID}}{{extraParams}}";for(z=0;z<v;z++)if(null!==(u=p[z].exec(C))&&u[1]){f=u[1],g=u[2]||"",a="youtubeurl";break}if(f){if(I=b.replace(/\{\{videoID\}\}/,f),g){(h=b.timeParseRegex).lastIndex=0;var S=h.exec(g);S[1]=parseInt(S[1])||0,S[2]=parseInt(S[2])||0,S[3]=parseInt(S[3])||0;var T=3600*S[1]+60*S[2]+S[3];I=I.replace(/\{\{extraParams\}\}/,"?start="+T)}else I=I.replace(/\{\{extraParams\}\}/,"");m=I}}else a="slidez"}switch(a||"prvHdr"!==s.find("i").attr("data-detail")||(a=(s=s.find("i")).attr("class")),a=(a=(a=a.replace("SC_ldot","").trim()).replace("SC_thm","").trim()).replace("msi-share","").replace("shd","").trim()){case"msi-readerView":X(n,s);break;case"msi-zmPme":case"msi-zmPle":K(),ge(t.find("#zmHdr"+l),e);break;case"zm_draft":ZMail.utils.loadComposer({parentId:n,draftId:$.e(s).closest(".SC_pct").children(":first").attr("data-did"),prevElem:s.closest(".SC_pct").parent(),composeOpenType:"edithere"});break;case"msi-reply":case"msi-replyall":case"msi-forward":if("prvHdr"===s.attr("data-detail")){Z(s,t);ZMail.utils.loadComposer({parentId:n,composeAction:{"msi-reply":"reply","msi-replyall":"replyall","msi-forward":"fwdi"}[a],prevElem:$.e(s).closest(".SC_pct").parent()})}_zm.stopEvents(e);break;case"msi-reminder":zmWatch.showWatch({msgId:n,elem:s,openWatch:"preview_header",loadType:"popup"}),_zm.stopEvents(e);break;case"msi-download":G.show("zm_dldLst",s);break;case"msi-barrow":Z(s,t),s.parents("ul").attr("cmprid")?G.show("zm_prvRepLst",s):"prvHdr"===s.attr("data-detail")?G.show("zm_preaLst",s,{containerDOM:$(s).closest(".SC_pct").parent()}):s.prev().hasClass("msi-edit")?G.show("zm_preaLst",s):s.prev().hasClass("msi-download")&&G.show("zm_dldLst",s);break;case"msi-attachicon":G.posAView(l,t),_zm.stopEvents(e);break;case"msi-ellipsis":s.toggleClass("sel"),J(s.parent());break;case"zmflg":if(zmUtil.isReadOnlyMail(n))return void _zm.stopEvents(e);r=s,o=$(r),1<(d=o.parents(".SC_Twpr").find(".SC_pct")).length&&(d.removeClass("SC_Tfcs"),o.parents(".SC_pct").addClass("SC_Tfcs")),r.hasClass(ce.blueflag)||r.hasClass(ce.redflag)||r.hasClass(ce.greenflag)?G.flagMail(o,"0"):G.flagMail(o,"2"),_zm.stopEvents(e);break;case"msi-edit":zmUtil.isChildWindow()||"prvHdr"!==s.attr("data-detail")||ZMail.utils.loadComposer({parentId:n,composeAction:"outbox"});break;case"SC_cs":case"zm_eadd":ZMail.previewUtil.loadContactCard({msgId:n,event:e,targetElem:s,clkedOnSender:"SC_cs"===a});break;case"youtubeurl":var M=[],w={ft:103,fn:"file.mp4",src:m,showInFrame:!0,hideFileName:!0,hideShareOption:!0};M.push(w),zmUtil.initAttSlideShow(M,0,!0),_zm.stopEvents(e);break;case"slidez":zmPreviewTemplate.slideZImages(s);break;case"zm_lbl":if(c&&c.streams)$(s).addClass("zmst_lbl"),zmStreamsApp.util.bindEntityElements({entityId:n,entityElem:s,entityType:1});else{var O=c&&c.FD;if(zmUtil.isSharedFolder(O))return;var y=s.closest(".zmLbl");y=y.length?y[0]:s,function(e,t){var i,a=[],n=[];"t"===e.charAt(0)?(e=e.substring(1),n.push(e)):a.push(e);var l="",s=zmUtil.getMailObj(e);s&&s.streams&&(l="default");var m={};m.parentDOM=$(t),m.displayAs="popup",m.accType=l,m.labelState={mailList:[{id:e,ttag:Boolean(n.length)}]},m.onStateChange=function(e,t){var i=zmUtil.getTagList(l);zmUtil.isChildWindow()?zmWindow.applyActions("label","click",{msgId:a,thd:n,lA:t?"add":"delete",lId:e,accType:l,disp:i[e].dispName}):zmail.MailAction.Initializer.applyActions("label","click",{msgId:a,thd:n,lA:t?"add":"delete",lId:e,accType:l,disp:i[e].dispName})},m.onCreate=function(e,t){zmlab.isValidName(e,"",l)&&zmlab.labelCreate(e,l,{reqDoneClbk:function(e,t){e&&(m.onStateChange(t,!0,function(){}),i.hide())},color:t})},(i=zmUtil.createFLComp("label",m)).show()}(n,y)}break;case"msi-fav":zmStreamsApp.util.bindEntityElements({entityId:n,entityElem:s,entityType:1,data:c});break;case"SC_plnk":var U=s.attr("data-detail");"downloadall"===U&&G.bindAction({action:U,msgId:n},s);break;case"js-shareicon":case"js-shareicon sld":var _=$(s).parents(".zmPHdr").parents(".SC_pct").parent()[0];$.publish("/mail/preview/updateshare",{mailID:n,containerDOM:$(_)[0],elm:s[0]});break;case"zm_unsub":zmPreviewTemplate.processUnsubscription(n,t);break;case"zm_exclude":var A,N;if(c){A=c.F||"",N=c.SFT;var L={5:pe.smartfilter.notification,6:pe.smartfilter.newsletter,7:pe.smartfilter.group};if(A&&N){var D=zmText.applyArgs(pe.smartfilter.confirm_msg,{email_address:A,smart_filter_name:L[N]});zmsDialog.confirm(D,{onOk:function(){zmPreviewTemplate.classifySmartFilter(n,N,!1,$(s).closest(".SC_pct"))}})}}break;case"zm_inLnk":var P=zmContentCache.isCached(n)&&zmContentCache.get(n),x=s.attr("data-value");if(!P||!x)return;x=x.replace(/ /,"T");var E={par:s,title:P.SUBJECT,desc:"",ts:x};dateParser.loadQuickAdder(E);break;case"jsCallBtn":var k=s.attr("data-value");ZMail.previewUtil.loadClickToDial({phoneNumber:k});break;default:var F,H;if(zmUtil.isChildWindow()||-1===zmTab.currentTab.indexOf("zm_srch")||(H=zmSearchUtil.getSearchViewDetails()),H&&"search"===H.view&&zmSearchUtil.isWorkspaceAvailable()&&(F="zm_srch1"),s.attr("id")&&-1!==s.attr("id").indexOf("vfc")){Z(s,t);var j={msgId:n,type:"lt",opentype:void 0!==i?i:zmPreviewTemplate.currentWorkSpace,vfc:!0};zmUtil.isChildWindow()?zmWindow.getMail(j):(j.tabId=F,zmList.getMailData(j)),s.parent().hide()}else{var R=s.closest(".zmPHdr");if(!R.length)return;if(!R.hasClass("zm_tm")&&R.hasClass("zms")){var B=R.children(".zmPT:first").children(".zmpr:first")[0];if(s[0]!==B&&!$.contains(B,s[0]||"zmmre"===a))return}var W=c.FD===zmail.folId.dId;if(R.length&&(!W&&1<t.find(".SC_pct:not('.SC_Drft')").length&&(Z(s,t),R.toggleClass("zm_tm"),R.removeClass("zmsnt"),c.FD===zmail.folId.sId&&R.hasClass("zm_tm")&&R.addClass("zmsnt")),G.toggleMailContentViewMode(R,i,F),!R.hasClass("zm_tm")))if(zmUtil.isChildWindow())zmUtil.setPreviewScroll(R.closest(".SC_pct"),t);else{var V=R.closest(".SC_pct");zmUtil.setPreviewScroll(V,V.parent())}}}},o=function(e,t,i,r){try{var o,d,c,p,z=[],u=[];r||(r=$.e(i).closest(".SC_pct"),t=t||r.find(".zmPHdr").attr("data-mid"));var n={id:"externalLink",url:"externalURL"},l={id:"extBackImgId",url:"extBackImgURL"},s={id:"extListBackImgId",url:"extListBackImgURL"},m={id:"extStyleImgId",url:"extStyleImgURL"},a=zmContentCache.get(t);if(!(o=a.EXTIMG))return;var f,g,h=[a],v=a.TRANSLATEDCONTENT||{};(h=h.concat(Object.values(v))).forEach(function(e){var t=e.CONTENT,i=e.BLCKCON;g="",f=$.e(zdom("div",null,$.dangerouslyParseHTML(t))),i&&(g=$.e(zdom("div",null,$.dangerouslyParseHTML(i))));var a=function(e,t){var i;for(z=o[e.url],u=o[e.id],d=z.length,p=0;p<d;p++)if(c=z[p].replace(/&amp;/gi,"&"),i=r.find("#"+u[p]).length?"#"+u[p]:"[data-extimg_id="+u[p]+"]","extbg"===t)r.find(i).css("background-image","url("+c+")"),f.find(i).css("background-image","url("+c+")"),g&&g.find(i).css("background-image","url("+c+")");else if("ext"===t)r.find(i).attr("src",c),f.find(i).attr("src",c),g&&g.find(i).attr("src",c);else if("listBG"===t)r.find(i)[0].style.listStyleImage="url("+c+")",f.find(i)[0].style.listStyleImage="url("+c+")",g&&(g.find(i)[0].style.listStyleImage="url("+c+")");else if("extStyle"===t){var a=r.find(i)[0],n=u[p].split("_"),l=["cursor","styleurl"];if(n[1]===l[0]&&n[2]===l[1]){var s,m=a.style.cursor;0<=m.indexOf('url("")')&&(s=m.replace('url("")',""),a.style.cursor='url("'+c+'")'+s)}}};o.externalURL&&o.externalURL.length&&a(n,"ext"),o.extBackImgURL&&o.extBackImgURL.length&&a(l,"extbg"),o.extListBackImgURL&&o.extListBackImgURL.length&&a(s,"listBG"),o.extStyleImgId&&o.extStyleImgURL.length&&a(m,"extStyle"),e.CONTENT=f[0].innerHTML,g&&(e.BLCKCON=g[0].innerHTML)}),i&&$.e(i.parentElement).hide(),a.EXTIMG.link="none"}catch(e){zmUtil.debugLog(e)}},s=function(e,t){var i={t:"POST",u:zmail.conPath+"/readreceipt.do",p:{mode:t,msgId:e,accId:zmail.accId,folType:"p"}};zmAjq.XHR(i),zmUtil.updateMailData("RR",0,e)},d=function(e){return zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(e),avatarBgColor:zmail.ContactBook.Utils.colorClasses()})},e={currentWorkSpace:"",showOrgList:[],getTemplate:function(e,t){var i,a=void 0!==t.opentype?t.opentype:t.prms.opentype;t.prms&&"plainContent"===t.prms.type||(1===(i=a)?(zmPreviewTemplate.currentWorkSpace=1,de=$.parseJSON($("#zmWindowWrapper").attr("data-detail")),q="W"):(de=0===zmTab.currentTab.indexOf("zm_srch")?zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),0===i||4===i?de&&"search"===de.view?(q="S",zmPreviewTemplate.currentWorkSpace=zmail.mailOpt.isPopup):(de=zmInit.getListingDetObj(),q="P",zmPreviewTemplate.currentWorkSpace=i):2===i?(q="T",zmPreviewTemplate.currentWorkSpace=2):3===i&&(q="N")),G=zmUtil.isChildWindow()?zmWindow:zmPrev);var n="";switch(e){case"content":n=l(t.data,t.prms);break;case"header":n=N(t,a)}return n},getSubjectToPreview:function(e){var t=pe.common.noSubject;return e&&(t=1e3<(t=_zm.unescapeTags(e)).length?(t=t.substring(0,1e3)+"...",_zm.escapeTags(t)):e),t},consFlagContextMenu:function(e){var t,i,a,n;return t=e.target||e.srcElement,(i=$.e(t)).hasClass(ce.flag)&&(a={clk:function(e,t){zmUtil.isChildWindow()?zmWindow.flagMail(i,t):zmPrev.changeFlag(i,t)},conArr:[{dom:zdom("fragment",null,zdom("i",{className:ce.blueflag}),pe.flagmenu.infoflag),data:{flag:"1"}},{dom:zdom("fragment",null,zdom("i",{className:ce.redflag}),pe.flagmenu.important),data:{flag:"2"}},{dom:zdom("fragment",null,zdom("i",{className:ce.greenflag}),pe.flagmenu.followup),data:{flag:"3"}},{sep:!0},{dom:zdom("fragment",null,zdom("i",{className:ce.noflag}),pe.flagmenu.clearflag),data:{flag:"0"}}]},zmUtil.isChildWindow()?((n=new zmContextMenu).setMenuObj(a),n.paint(e)):zmsuite.showContextMenu(e,a),_zm.stopEvents(e)),!1},bindPreviewEvents:function(n,i){var e;$(n).find("."+ce.flag).each(function(){$(this).unbind("contextmenu").contextmenu(function(e){zmPreviewTemplate.consFlagContextMenu(e,this)})}),3!==i?(e=$(n).find(".SC_Twpr"),$(n).find(".SC_Twpr").scroll(function(){$.publish("mail/previewScrolled"),zmUtil.hideMenu()}),$(n).keydown(function(e){38!==e.keycode&&40!==e.keycode||zmUtil.hideMenu()})):e=$(n).find(".SCS_postMail"),e.off("click.mailView").on("click.mailView","div.SC_pct",function(e){zmAttach.util.removeMAct(),a(e,n,i);var t=e.target||e.srcElement;($.e(t).hasClass(A.composeActionBar)||$.e(t).parent().hasClass(A.composeActionBar))&&function(e,t){var i=$.e(e.target||e.srcElement),a=i.attr("data-type"),n=i.closest(".SC_pct").find(".zmPHdr").attr("data-mid");switch(Z(i,t),a){case"outbox":case"eanew":case"reply":case"replyall":case"fwdi":ZMail.utils.loadComposer({parentId:n,composeAction:a,prevElem:i.closest(".SC_Twpr")});break;case"sharemail":$.publish("/mail/view/focuscommentbox",{mailID:n,showCommentBox:!0,containerDOM:i.closest(".SC_Twpr")})}}(e,n),zmUtil.isChildWindow()||!zmList.listingFocused||0!==zmPreviewTemplate.currentWorkSpace&&4!==zmPreviewTemplate.currentWorkSpace||(zmList.listingFocused=!1,$(t).hasClass("msi-ellipsis")&&(zmList.listingFocused=!0))}),3===i&&$(n).find(".SC_ptit .popOut").off("click").on("click",function(){var e={msgId:$(n).attr("msgId"),gid:$(n).attr("groupId"),opentype:2,isMail:!0,pid:$(n).attr("pid"),thId:$(n).attr("thId"),invokedFrom:"notification-popout",actionType:$(n).attr("actionType"),etype:"1"};if($.publish("zmstreamsapp/closeDialog",{}),!zmsuite.isMaxLimitReached()){var t,i=$(this).data("shared"),a=$(this).data("reminder");if(i||a)e.isSharedMail=!0,e.groupId!==zmail.zuid&&(t={viewDetails:{view:"zmncenter"}},e.tabId="zmncenter"),zmList.getMailData(e,t),zmUtil.publishCloseNotif();else zmStreamsApp.events.openPostInTab(e)}zmUtil.hideMenu()})},showImageDisplayElem:function(e,t,i){var a,n,l=((i=i||{}).prefix||q)+e;if((a=zmContentCache.get(e).EXTIMG?zmContentCache.get(e).EXTIMG.link:"")&&"none"!==a){var s=2,m=0,r=t&&t.find("#ImgDis"+l)||$("#ImgDis"+l);n=r.children(),"display"===a&&(n.eq(s).show(),n.eq(m).show()),n.eq(m).unbind("click").click(function(){Z(this,t),o(0,e,this)}),i.isvfc&&"none"===i.imgStatus?n.eq(m).click():i.isvfc&&"display"===i.imgStatus&&r.show(),i={}}},showOrgMsg:function(e){var t="",i=e.mId,a=zmUtil.getMailObj(i);t=zmail.conPath+"/showOriginal.do?m="+i+"&sc=h",a?(a.FD&&zmUtil.isSharedFolder(a.FD)&&(t+="&shId="+zmUtil.getShareId(a.FD)),a.streams?t+="&accId="+a.accId+"&groupId="+a.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+i:t+="&accId="+zmail.accId):t+="&accId="+zmail.accId,zmUtil.openWindow(t,"60","60")},garbMsg:function(e){var t="",i=e.mId,a=zmUtil.getMailObj(i);t=zmail.conPath+"/gmsg.do?m="+i,a&&(a.FD&&zmUtil.isSharedFolder(a.FD)&&(t+="&shId="+zmUtil.getShareId(a.FD)),a.streams?t+="&accId="+a.accId+"&groupId="+a.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+i:t+="&accId="+zmail.accId),window.open(t,"_blank").focus()},printMsg:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a.title=zmUtil.getMailObj(a.mId,"SB");zmAppLoader.load("mailPrinter").then(function(){var e,t,i;t=a.mId,(i=zmContentCache.isCached(t)&&zmContentCache.get(t).EXTIMG)&&"none"!==i.link?e=Dialog.new({title:pe.print.warningTitle,ignoreMouseDown:!1,$content:zdom("span",null,pe.print.warningMsg),buttons:[{name:pe.common.ok,callback:function(){e.remove(),mailPrinter.print(a)}},{name:pe.common.cancel,callback:function(){e.remove()}}]}):mailPrinter.print(a)})},showProfilePhoto:function(a,l,m,r){try{zmail.ContactBook.fetchProcess.then(function(){var e=m||zmContentCache.isCached(a.msgId)&&zmContentCache.get(a.msgId)||"",s=zmUtil.getMailObj(a.msgId),n=function(e){var i,a=e.emailId,t=e.headerDom,n=$.e(t).find(".SC_pvul li"),l=$.e(t).find(".SC_pvul img");(r||l.length)&&a&&zmail.ContactBook.get({eid:a}).then(function(e){if(!n.find(".unAuthSender").length&&!n.find("div img").length){var t=e[0];i=t?t.avatar():d(s.SN||a)}},function(){i=d(s.SN||a)}).always(function(){l.remove(),n.prependDOM(i),zmail.wmsAPI.showPresence(a,$.e(t).find(".SC_avtr"))})};if("lt"===a.type&&!s.T||"th"===a.type){var t=e.FROM||s.F,i=$(l).find(".zmPHdr");i.length||(i=$.e(l)),n({emailId:t,headerDom:i})}else s.T&&$(l).find(".zmPHdr").each(function(e,t){var i=(t=$.e(t)).attr("data-mid"),a=zmUtil.getMailObj(i).F;n({emailId:a,headerDom:t})})})}catch(e){zmUtil.debugLog(e)}},processReadReceipt:function(e){var t=pe.common.readreceiptmsg,i=zmUtil.getMailObj(e);if(!i||!i.streams){var a=1===i.RR,n=zmail.mailOpt?zmail.mailOpt.askReceipt:1;if(a){if(i.FD===zmail.folId.spId)return;1===n?zmsDialog.confirm(t,{onOk:function(){s(e,"yes")},onCancel:function(){s(e,"no")}}):s(e,0===n?"yes":"no")}}},showFullContent:function(e,t){var i,a,n,l=e.mdata.CONTENT?e.mdata.CONTENT:"",s=!1,m=t.prefix||q;l=zdom("fragment",null," ",$.dangerouslyParseHTML(l)," ");var r=t.msgId,o=$.q("#zmCon"+m+r);n=(a=o.closest(".SC_Twpr")).scrollTop(),(i=o.find(".msi-ellipsis")).parent().next().is(":visible")&&(s=!0),e.mdata.BLCKCON&&("lt"===t.type&&0<=zmUtil.getMailObj(r).TC||"content"===t.type?l.appendChild(zdom("fragment",null,zdom("div",null,zdom("i",{className:"msi-ellipsis zmDoubleIcon"})),zdom("div",{style:{display:"none"}},$.dangerouslyParseHTML(e.mdata.BLCKCON)))):l.appendChild($.dangerouslyParseHTML(e.mdata.BLCKCON))),o.find(".zmPCnt").appendDOM(l,{clear:!0}),(i=o.find(".msi-ellipsis")).length&&s&&(i.toggleClass("sel"),J(i.parent())),a.scrollTop(n)},addMailsInView:function(e){var t,i,a,n,l,s,m,r=e.list||[],o=e.opentype,d=r.length,c="",p="",z="",u="";if(0!==d&&(e.contElem?(t=e.contElem,u=e.elemPrefix,n=e.viewDetails,o=e.opentype):0===o||4===o?(n=zmInit.getListingDetObj(),z="zm_Container",u="P",t=zmsuite.getCenter(z)[1].getNodes()[1].$el):2===o&&(z="zm_tabt"+zmUtil.getMailObj(r[0]).T,n=zmsuite.getCenterOuter(z).$el.data("data-detail"),u="T",t=zmsuite.getCenter(z)[1].getNodes()[1].$el),t)){for(m=t.find("div.SC_pct").length,i=0;i<d;i++)s={msgId:(a=zmUtil.getMailObj(r[i])).M,thd:!0,opentype:o,frm:a.F,sender:a.SN,hasAtt:a.AT,sm:a.SM,label:a.TAG,flag:a.NFG,date:a.DT,elemId:u+a.M,hdrId:"zmHdr"},!a.streams&&zmUtil.getMLConversionValue()&&(s.showIndex=!0),zmUtil.isChildWindow()||(l=a.FD===n.fId||!zmail.folCount[n.fId]),f=s,p=zdom("div",{className:l?"SC_pct":"SC_pct SC_Tfdr"},$.dangerouslyParseHTML(zmPreviewTemplate.getTemplate("header",f))).outerHTML,c=zmail.convSortOrder?p.concat(c):c.concat(p);var f;for(c.length&&(1===zmail.convSortOrder||"showmore"===e.mode?$(c).insertAfter(t.find("div.SC_pct:last")):t.prepend($(c)),t.parent().addClass("tmail"),e.setscroll&&(1===zmail.convSortOrder?zmUtil.setPreviewScroll(t.find("div.SC_pct").eq(m),t):zmUtil.setPreviewScroll(t.find("div.SC_pct:first"),t))),i=0;i<d;i++)zmPreviewTemplate.showProfilePhoto({msgId:r[i],type:"th"},$("#zmHdr"+u+r[i]))}},discardMsgPreview:function(e){e&&(zmUtil.isChildWindow()?$("#zmHdrW"+e).parent().remove():($("#zmHdrP"+e).parent().remove(),$("#zmHdrT"+e).parent().remove(),$("#zmHdrS"+e).parent().remove()))},showNotifBand:function(t){var i=t.targetElem,e=t.thdId,a=[],n=t.opentype;0===n||4===n?a=zmPreviewTemplate.getMissingMailList(e,"P"):2===n&&(a=zmPreviewTemplate.getMissingMailList(e,"T")),zmPreviewTemplate.removeNotifBand(i);var l=zdom("div",{className:"SC_new_activity",style:{opacity:1},id:"zms_newmail"},pe.common.notificationmsg);$.e(i).appendDOM(l),$.e(l).off("click").on("click",function(e){zmPreviewTemplate.removeNotifBand(i),$.publish("/mail/updatemailview",[{list:a,opentype:t.opentype,setscroll:!0}]),_zm.stopEvents(e)})},removeNotifBand:function(e){$.e(e).find(".SC_new_activity").remove()},refreshLabelsForMail:function(e,t){if(e){var i=!zmUtil.isChildWindow(),a=zmUtil.getMailObj(e);a.TAG=a.TAG||[];var n,l=a.TAG,s="";a.streams&&(s="default");var m=zmsTemplates.constructTagListHTML(l,!0,"",s,{constructOuterDiv:!0,getDOM:!0});m&&l.length||(m=zdom("i",{className:"msi-label"}));var r=zmsTemplates.constructTagListHTML(l,!1,"",s,{constructOuterDiv:!0,getDOM:!0}),o=r,d="";i&&(d=ZMail.lView.constTemplate("labels",{tagLst:l,conf:a}));var c="";t&&t.length&&((n=t[0].id).indexOf("t")||(n=n.substring(1)));var p,z,u,f,g=["","zmHdrP","zmHdrT","zmHdrW","zmHdrS","zmHdrN","t"];for(var h in g){p="6"===h&&n?$.q("[id="+g[h]+n+"]"):$.q("[id="+g[h]+e+"]"),c=!i||"0"!==h&&"6"!==h?"zm_lbl":(o=d,"jsLabel");for(var v=0;v<p.length;v++){switch(f="",(u=(z=p.eq(v)).find("."+c)).remove(),g[h]){case"":i?"0"===zmAdHocSettings.getCustomizeMailListing().label&&z.find("."+ce.labelDQA).prepend(zdom("div",{class:c})):z.find("."+ce.labelDQA).after(zdom("div",{class:c}));break;case"t":i?"0"===zmAdHocSettings.getCustomizeMailListing().label&&z.find("."+ce.labelDQA).prepend(zdom("div",{class:c})):z.find("."+ce.labelDQA).after(zdom("div",{class:c}));var C=n&&zmUtil.getMailObj(n);C&&(C.TTAGS=C.TTAGS||[],l=C.TTAGS||l,o=i?ZMail.lView.constTemplate("labels",{tagLst:l,conf:C}):zmsTemplates.constructTagListHTML(l,!1,4,s,{constructOuterDiv:!0,getDOM:!0}));break;case"zmHdrP":f="zmLBLP"+e;break;case"zmHdrT":f="zmLBLT"+e;break;case"zmHdrW":f="zmLBLW"+e;break;case"zmHdrS":f="zmLBLS"+e;break;case"zmHdrN":f="zmLBLN"+e}if(f){o=l.length?zdom("fragment",null,r.cloneNode(!0),zdom("i",{className:"msi-plus zmst_lbl"})):zdom("i",{className:"msi-label zmst_lbl"}),$.q("#"+f).remove();var I=zdom("div",{id:f,className:"zmpdtl"},zdom("div",null,zdom("div",{className:"zmpr"},zdom("span",null,zdom("em",null," ",pe.contentOptions.tags," ")))));z.find(".zmvia").length?$(I).insertBefore(z.find(".zmvia").eq(0)):z.find(".zmPT").append(I),$.q("#"+f).find("span").append(zdom("div",{className:"zm_lbl"})),z.find(".zmpr").eq(0).find(".sum").after(zdom("div",{className:"SC_ldot zm_lbl"}))}(u=z.find("."+c)).length&&(2===u.length?(u.eq(0).appendDOM(o,{clear:!0}),u.eq(1).appendDOM(m.cloneNode(!0),{clear:!0})):1===u.length?u.appendDOM(o,{clear:!0}):u.appendDOM(m.cloneNode(!0),{clear:!0}))}}}},updateMailHeaderView:function(t){var e=zmUtil.getMailObj(t);e&&e.FD===zmail.folId.sId&&["","t","zmHdrP","zmHdrT","zmHdrW","zmHdrS"].forEach(function(e){$(String("[id="+e)+t+"]").each(function(e,t){$(t).removeClass("zmsnt"),$(t).hasClass("zm_tm")&&$(t).addClass("zmsnt")})})},toggleHeaderState:K,applyHeaderState:ge,getRecipientCount:function(e){if(zmContentCache.isCached(e)){var t=zmContentCache.get(e),i=zmConUtil.splitncheck(t.TO||"","object").length;return i+=zmConUtil.splitncheck(t.CC||"","object").length,i+=zmConUtil.splitncheck(t.BCC||"","object").length}throw new Error(pe.common.error)},alignMailTopToPreview:function(e){var t;if(zmUtil.isMailOpenInPreview(e,zmTab.currentTab)&&("zm_Container"===zmTab.currentTab?t=$("#zmHdrP"+e):0===zmTab.currentTab.indexOf("zm_srch")&&(t=$("#zmHdrS"+e)),t)){var i=t.parent()[0];$(i).parent(".SC_Twpr")[0].scrollTop=i.offsetTop,$(i).removeClass("js-scrolltop")}},setPreviewHeaderHeight:function(e,t,i){var a;if(t=t||zmTab.currentTab,e||((e={}).prevElem=zmsuite.getCenter(t)[1].$el[0]),e.prevElem){if(4!==i||"zm_Container"!==t&&t.indexOf("zm_srch")){var n=$(e.prevElem).find(".SC_ptit");a=n[0]&&n[0].clientHeight}else a="0";var l=$(e.prevElem).find(".SC_Twpr");a&&l.css({top:a+"px"})}},addDraftsToView:function(e,t,i){var a;((zmUtil.getListMap(e)||{}).MO||[]).forEach(function(e){(a=zmUtil.getMailObj(e,"DMID"))&&t.find("#zmHdr"+i+e).closest(".SC_pct").length&&ZMail.utils.loadComposer({parentId:e,draftId:a,elmPrefix:i,prevElem:t,composeOpenType:"drafted"})})},setSlideShow:function(e,t,i){for(var a,n,l=e.length,s="",m=0;m<l;m++)s=(a=e[m]).e,n=zmUtil.getMailObj(s),a.gId=n&&n.streams?n.groupId:zmail.zuid},getAddToMenu:function(i,a){var e;if(a=a||"left",zmail.Settings){var t=zmail.Settings.MailSuite.Settings.Integration;e=t.Apps.Collection.getIntegAppConfig(t.Constants.ZOHOPROJECTS)}var n=[],l={},s=zmUtil.getMailObj(i);l.align="pleft",l.clk=function(e,t){"right"===a?(t.msgId=i,zmPrev.bindAction(t,e)):(e.msgId=i,G.bindAction(e,t))},l.divId="zm_dropaddto";var m,r=zmUtil.isSharedFolder(s.FD);return s&&s.FD!==zmail.folId.sId&&s.FD!==zmail.folId.spId&&(n=[{htm:pe.contextmenu.filters,data:{action:"addfilter",msgId:i}}]),!zmUtil.isZohoAccount(zmail.accId)||zmail.isAusCustomer||zmUtil.isChildWindow()||r||n.push({htm:pe.contextmenu.tasks,data:{action:"addtotasks"}}),!zmUtil.isZohoAccount(zmail.accId)||zmUtil.isChildWindow()||r||zmail.isAusCustomer||n.push({htm:pe.contextmenu.notes,data:{action:"addtonotes"}}),!zmUtil.isZohoAccount(zmail.accId)||zmail.isAusCustomer||zmUtil.isChildWindow()||r||n.push({htm:pe.contextmenu.calendar,data:{action:"addtoevents"}}),zmUtil.isZohoAccount(zmail.accId)&&!r&&e&&e.getStatus()&&!zmail.isAusCustomer&&n.push({htm:pe.contextmenu.projects,data:{action:"addtoprojects"}}),zmUtil.isZohoAccount(zmail.accId)&&(m=zmail.smartFilterStatus,zmail.isSmartFilterEnabled&&m&&m.Group|m.NewsLetter|m.Notification)&&s&&s.FD!==zmail.folId.sId&&s.FD!==zmail.folId.spId&&!r&&(n=n.concat({dom:zdom("fragment",null,"right"===a?zdom("i",{className:"msi-rarrow"}):zdom("i",{className:"msi-larrow"}),pe.contentOptions.include),data:{action:"smartfiltermenu",msgId:i,menuDirection:"left"},child:function(){return zmPreviewTemplate.getSmartFilterMenu(i,a)}})),l.list=n,l},getSaveSubMenus:function(t){return{align:"pleft",clk:function(e){switch(e.optionName){case"saveAsHtml":ZMail.previewUtil.downloadAsHTML({msgId:t});break;case"saveAsEml":ZMail.previewUtil.downloadAsEML({msgId:t})}zmUtil.hideMenu()},divId:"zm_saveAs",list:[{txt:pe.contextmenu.saveAsHtml,data:{optionName:"saveAsHtml"}},{txt:pe.contextmenu.saveAsEml,data:{optionName:"saveAsEml"}}]}},getSmartFilterMenu:function(i,a){var e=[],t={};t.align="pleft",t.clk=function(e,t){"right"===a?(t.msgId=i,zmPrev.bindAction(t,e)):(e.msgId=i,G.bindAction(e,t))},t.divId="zm_dropsmartfilter";var n,l,s,m=zmail.smartFilterStatus;for(l in n=[function(){return!!m.Notification&&{htm:pe.smartfilter.notification,data:{action:"addsmartfilter",filtervalue:5,msgId:i}}},function(){return!!m.NewsLetter&&{htm:pe.smartfilter.newsletter,data:{action:"addsmartfilter",filtervalue:6,msgId:i}}},function(){return!!m.Group&&{htm:pe.smartfilter.group,data:{action:"addsmartfilter",filtervalue:7,msgId:i}}}])(s=n[l]())&&e.push(s);return t.list=e,t},createNewFilter:function(e){var t,i=e.msgId,a="",n="",l="",s="",m=[],r={};if(i&&(t=zmContentCache.isCached(i)?zmContentCache.get(i):zmUtil.getMailObj(i))){n=t.SUBJECT||t.SB||"",s=t.FROM||t.F||"",l=t.TO||t.TOADDR||"",a=s.substring(0,s.indexOf("@")),l?t.CC&&"NOT PROVIDED"!==t.CC.toUpperCase()&&(l=l+","+t.CC):t.CC&&"NOT PROVIDED"!==t.CC.toUpperCase()&&(l=t.CC);var o,d=(m=l?(l=(l=(l=l.replace(/&lt;/gi,"<")).replace(/&gt;/gi,">")).replace(/&quot;/gi,'"')).split(","):"").length,c=[],p="",z={};for(c.push({rhs:n,operator:"contains",lhs:"subject"}),c.push({rhs:s,operator:"contains",lhs:"sender"}),o=0;o<d;o++)-1!==(p=m[o]).indexOf("<")&&(p=p.substring(p.lastIndexOf("<")+1,p.lastIndexOf(">"))),p=p.trim(),z={rhs:m[o]=p,operator:"contains",lhs:"to/cc"},c.push(z);r.criterias=c,r.name=a,r.actionSrc=e.actionSrc,$.publish("FILTER_SUGGESTION",r)}},editFilter:function(){},loadPrevMail:function(){var i,a,e,n,l=zmTab.currentTab,t=zmPrev.prevDetails(),s=[],m=zmUtil.getMLConversionValue(),r=zmUtil.getSelectedMails(),o=r[0][0]||r[1][0];if(t.msgId||o){var d,c,p,z,u,f,g={},h=[];if(o=t.msgId,f=zmUtil.getMailObj(o),a=t.type,i=4===zmail.mailOpt.isPopup?4:0,"zm_Container"===l&&"zmStreamTree"!==zmail.mailLeft.selLayerId)zmList.listingFocused=!0,(g=zmInit.getListingDetObj()).fId!==zmail.folId.sId&&g.fId!==zmail.folId.tId||(m=0),"lt"===a?(u=0!==m&&f&&f.TH?"t"+o:o,e=zmUtil.getFolId(),d=(s=zmUtil.getListMap(e,"MO")||[]).indexOf(o),(c=zmCenterListing.mailObjectAPI.getViewObject(o))&&((h=c.$element).length||(h=(c=zmList.getElemObj(l)).find("#"+u))),h.length?((p=h.prev()).is(":visible")||(p=p.prev()),p.hasClass(ce.thdChild)?(z=p.find("."+ce.mRow+":last"),n=z.attr("id"),a="th"):p.hasClass(O.cls.mRow)&&(n=p.attr("id"),a="lt")):n=s[d-1]):"th"===a&&((e=f?f.T:"")&&zmUtil.getListMap(e)&&(s=zmList.getViewBasedMsgList(e,g)),0===(d=s.indexOf(o))?((c=zmCenterListing.mailObjectAPI.getViewParentOf("c"+o))&&((h=c.$element).length||(h=(c=zmList.getElemObj(l)).find("#"+o).closest("."+ce.thdChild).prev())),h.length&&((p=h.prev()).is(":visible")||(p=p.prev()),p.hasClass(ce.thdChild)?(z=p.find("."+ce.mRow+":last"),n=z.attr("id"),a="th",u=o):p.hasClass(O.cls.mRow)&&(n=p.attr("id"),u=n,a="lt"))):(u=o,n=s[d-1])),n&&zmPrev.updateListOnNavigation(o,de);else if("zm_srch1"===l)zmList.listingFocused=!0,de=zmSearchUtil.getSearchViewDetails(),d=(s=zmSearchUtil.getSearchList()||[]).indexOf(o),n=s[d-1],u=o;else if(!l.indexOf("zm_tab")){de=zmsuite.getCenterOuter().$el.data("data-detail");var v=(t=zmsuite.getCenterOuter().$el.data("row-detail")).msgId;v.indexOf("t")||(v=v.substring(1)),a=t.type,e=zmUtil.getFolId(de),de.fId!==zmail.folId.sId&&de.fId!==zmail.folId.tId&&"search"!==de.view||(m=0),0!==m&&f&&f.TH?(u="t"+f.T,v=zmList.getDupThdRowId(o,e)):u=o,o.indexOf("t")||(o=o.substring(1)),"search"===e?s=zmSearchUtil.getSearchList():zmUtil.getListMap(e)&&(s=zmUtil.getListMap(e,"MO")||[]),d=s.indexOf(v);var C=zmUtil.getFolId();if(-1===d&&e===C){for(var I=zmsuite.getCenterOuter().$el.data("data-maillist"),b=I.indexOf(v),S=I[b-1];S&&-1===s.indexOf(S);)S=I[(b-=1)-1];d=s.indexOf(S)+1}n=s[d-1],i=2,n&&zmPrev.updateListOnNavigation(v,de)}n?$.when(zmPrev.cmpClose()).then(function(e){var t;t="th"===a?"c"+n:n.includes("t")?n.substr(1):n,zmCenterListing.mailObjectAPI.setFocus("Mouse",t),e&&(zmList.getMailData({msgId:n,type:a,opentype:i,from:u}),"zm_Container"!==l&&"zm_srch1"!==l||!zmsuite.isWorkspaceAvailable(l)||("unread"!==de.view?zmUtil.initScroll(zmsuite.getCenter(l)[0].getNodes()[2].$el,n,u,"prev",!1,4===i):zmList.setScrollUnreadView(zmsuite.getCenter(l)[0].getNodes()[2].$el,n)),zmContentCache.remove(o))}):ZMail.previewUtil.disableNavigation(l,"prev")}else{if(i=4===zmail.mailOpt.isPopup?4:0,a="lt","zm_Container"===l&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(e=zmUtil.getFolId(),!(n=zmUtil.getListMap(e,"MO")[0]))return}else{if("zm_srch1"!==l)return;if(!(n=zmSearchUtil.getSearchList()[0]))return}zmList.getMailData({msgId:n,type:a,opentype:i})}},loadNextMail:function(){var i,a,e,n,l=zmTab.currentTab,t=zmPrev.prevDetails(),s=[],m=zmUtil.getMLConversionValue(),r=zmUtil.getSelectedMails(),o=r[0][0]||r[1][0];if(t.msgId||o){var d,c,p,z,u,f,g,h={};if(o||(o=t.msgId),g=zmUtil.getMailObj(o),a=t.type,i=4===zmail.mailOpt.isPopup?4:0,"zm_Container"===l&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(zmList.listingFocused=!0,(h=zmInit.getListingDetObj()).fId!==zmail.folId.sId&&h.fId!==zmail.folId.tId||(m=0),"lt"===a)if(f=0!==m&&g&&g.TH?"t"+o:o,e=zmUtil.getFolId(),-1===(d=(s=zmUtil.getListMap(e,"MO")||[]).indexOf(o))&&g&&g.TH&&(o=t.msgId,f=f.indexOf("t")?o:"t"+o),d=s.indexOf(o),p=[],(c=zmCenterListing.mailObjectAPI.getViewObject(o))&&((p=c.$element||[]).length||(p=(c=zmList.getElemObj(l)).find("#"+f))),p.length){if((z=p.next()).is(":visible")||(z=z.next()),z.hasClass(ce.thdChild))u=z.find("."+O.cls.mRow).eq(1),n=u.attr("id"),a="th",f=o;else if(z.hasClass(O.cls.mRow)){var v=z.next();a=v.hasClass(ce.thdChild)&&v.is(":visible")?(n=v.find("."+ce.mRow+":first").attr("id"),"th"):(n=z.attr("id"),"lt")}}else n=s[d+1];else if("th"===a)if((e=g?g.T:"")&&zmUtil.getListMap(e)&&(s=zmList.getViewBasedMsgList(e,h)),d=s.indexOf(o),f=o,d===s.length-1){var C=[];if((c=zmCenterListing.mailObjectAPI.getViewParentOf("c"+o))&&((p=c.$element).length||(p=(c=zmList.getElemObj(l)).find("#"+o).closest("."+ce.thdChild).prev()),C=p.next().next()),C.length){n=C.attr("id");var I=zmUtil.getMailObj(n);I&&I.TH?((z=C.next()).hasClass(ce.thdChild)&&z.is(":visible")||(z=z.prev()),z.hasClass(ce.thdChild)?(u=z.find("."+ce.mRow+":first"),n=u.attr("id"),a="th"):z.hasClass(O.cls.mRow)&&(n=z.attr("id"),a="lt")):a="lt"}}else n=s[d+1];n&&zmPrev.updateListOnNavigation(o,h)}else if("zm_srch1"===l)zmList.listingFocused=!0,h=zmSearchUtil.getSearchViewDetails(),d=(s=zmSearchUtil.getSearchList()||[]).indexOf(o),n=s[d+1],f=o;else if(!l.indexOf("zm_tab")){h=zmsuite.getCenterOuter().$el.data("data-detail");var b=(t=zmsuite.getCenterOuter().$el.data("row-detail")).msgId;b.indexOf("t")||(b=b.substring(1)),a=t.type,e=zmUtil.getFolId(h),h.fId!==zmail.folId.sId&&h.fId!==zmail.folId.tId&&"search"!==h.view||(m=0),0!==m&&g&&g.TH?(f="t"+g.T,b=zmList.getDupThdRowId(o,e)):f=o,o.indexOf("t")||(o=o.substring(1)),"search"===e?s=zmSearchUtil.getSearchList():zmUtil.getListMap(e)&&(s=zmUtil.getListMap(e,"MO")||[]),d=s.indexOf(b);var S=zmUtil.getFolId();if(-1===d&&e===S){for(var T=zmsuite.getCenterOuter().$el.data("data-maillist"),M=T.indexOf(b),w=T[M+1];w&&-1===s.indexOf(w);)w=T[(M+=1)+1];d=s.indexOf(w)-1}n=s[d+1],i=2,n&&zmPrev.updateListOnNavigation(b,h)}n?($.when(zmPrev.cmpClose()).then(function(e){var t;t="th"===a?"c"+n:n.includes("t")?n.substr(1):n,zmCenterListing.mailObjectAPI.setFocus("Mouse",t),e&&(zmList.getMailData({msgId:n,type:a,opentype:i,from:f}),"zm_Container"!==l&&"zm_srch1"!==l||!zmsuite.isWorkspaceAvailable(l)||("unread"!==h.view?zmUtil.initScroll(zmsuite.getCenter(l)[0].getNodes()[2].$el,n,f,"next",!1,4===i):zmList.setScrollUnreadView(zmsuite.getCenter(l)[0].getNodes()[2].$el,n)))}),zmContentCache.remove(o)):ZMail.previewUtil.disableNavigation(l,"next")}else{if(i=4===zmail.mailOpt.isPopup?4:0,a="lt","zm_Container"===l&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(e=zmUtil.getFolId(),!(n=zmUtil.getListMap(e,"MO")[0]))return}else{if("zm_srch1"!==l)return;if(!(n=zmSearchUtil.getSearchList()[0]))return}zmList.getMailData({msgId:n,type:a,opentype:i})}},showUnsubscribe:function(e,t){if(zmContentCache.isCached(e)){var i=zmContentCache.get(e);i.USOBJ&&!$.isEmptyObject(i.USOBJ)&&($(t).find("[data-mid='"+e+"'] .zm_unsub").show(),!0===i.USOBJ.USA&&$(t).find("[data-mid='"+e+"'] .zm_unsub").text(pe.newsletter.unsubscribed).removeClass("SC_lnk"))}},processUnsubscription:function(l,i){var a=function(e,t){"success"===e.status?(i&&$(i).length&&($(i).find("[data-mid='"+l+"'] .zm_unsub").text(pe.newsletter.unsubscribed).removeClass("SC_lnk"),zmUtil.isChildWindow()||zmPreviewTemplate.updateUnsubscribeStatus(l)),zmContentCache.isCached(t.msgId)&&(zmContentCache.get(t.msgId).USOBJ.USA=!0),_zm.succErrMsg("s",pe.newsletter.unsub_success),$.publish("spam/unsubscribed")):_zm.succErrMsg("e",pe.newsletter.unsub_failure)},s=function(e,t,i){i=i||a,zmContentCache.get(l).USOBJ.USA||zmAjq.XHR({u:zmail.conPath+"/unsubscribe.do",t:"POST",fn:i,p:e,ep:t,csr:"s"})},e=function(e){var t,i,a;"success"===e.status&&(e.valid?(a=zmContentCache.get(l).USOBJ,t={accId:zmail.accId,mode:"add",msgId:l},i={msgId:l},a.USL?t.link=a.USL:a.USM&&(t.send=!0,t.mailto=a.USM,t.from=zmail.aInfo[zmail.accId].mailId,a.USS&&(t.subject=a.USS),a.USC&&(t.content=a.USC)),zmsDialog.confirm(pe.newsletter.confirm_link,{onOk:function(){zmsDialog.remove(),s(t,i)}})):function(){if(!$.q("#unsubscribepopup").length){var e=zdom("div",{id:"unsubscribepopup"},zdom("h4",null,pe.newsletter.confirm_mail,zdom("div",{className:"mail_opt"},zdom("i",{className:"msi-option",value:"true"}),zdom("span",null," ",pe.newsletter.confirm_mail_unsubscribe)),zdom("div",{className:"mail_opt"},zdom("i",{className:"msi-unoption",value:"false"}),zdom("span",null,pe.newsletter.confirm_mail_markspam))));$.q("body").appendDOM(e);var n=$.q("div.mail_opt",e),t=$.q("i",n);n.on("click",function(){t.removeClass().addClass("msi-unoption"),$.e(this).closest("div").find("i").removeClass().addClass("msi-option")});var i={title:pe.newsletter.unsubscribe,style:{width:"500px"},buttons:[{txt:pe.common.ok,selected:!0,callback:function(){var e,t,i,a=zmContentCache.get(l).USOBJ;e={accId:zmail.accId,mode:"add",msgId:l},t={msgId:l},a.USM&&(i=$.q("i.msi-option",n).attr("value"),e.mailto=a.USM,e.from=zmail.aInfo[zmail.accId].mailId,a.USS&&(e.subject=a.USS),a.USC&&(e.content=a.USC),"true"===i&&(e.send=!0),zmsDialog.remove(),s(e,t))}},{isCancel:!0,txt:pe.common.cancel,callback:function(){zmsDialog.remove(),$.q("#unsubscribepopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center"};zmsDialog.create("unsubscribepopup",i)}}())};if(zmContentCache.isCached(l)){var t,n={};if(!(t=zmContentCache.get(l).USOBJ)||!0===t.USA)return;t.USL?(t.USL,e({status:"success",valid:!0})):t.USM&&(n={accId:zmail.accId,mode:"check",msgId:l},s(n,{msgId:l,selector:i},e))}},updateUnsubscribeStatus:function(e){if(e){var t,i,a=zmTab.tabArr;for(t=0;t<a.length;t++)i=a[t].appId,zmsuite.isWorkspaceAvailable(i)&&zmsuite.getCenter(i)[1]&&zmsuite.getCenter(i)[1].getNodes()[1].$el.find("[data-mid='"+e+"'] .zm_unsub").text(pe.newsletter.unsubscribed)}},updateRSVPSchema:function(a,e){var t=zmUtil.getMailObj(a);if(t&&t.SCOBJ){var n=t.SCOBJ[0];if(n&&"RSVPACTION"===n.SCATYPE&&("RSVPACTION"!==n.SCATYPE||!n.ASTATUS||n.RSVPSTUS!==e)){var i=["yes","no","disable:0","disable:1"];if(n.SHOWMB&&i.push("maybe","disable:2"),-1!==i.indexOf(e)){var l={msgId:a,accountId:zmail.accId,actName:n.SCATYPE,updCal:!1},s=$.extend({},l);switch(e){case"yes":case"disable:1":l.rsvpStatus=pe.calendar.yes.toLowerCase(),s.rsvpStatus=pe.calendar.yes;break;case"no":case"disable:2":l.rsvpStatus=pe.calendar.no.toLowerCase(),s.rsvpStatus=pe.calendar.no;break;case"maybe":case"disable:3":l.rsvpStatus=pe.calendar.maybe.toLowerCase(),s.rsvpStatus=pe.calendar.maybe}if(l.rsvpStatus!==n.RSVPSTUS){var m={u:zmail.conPath+"/executeActSchema.do",t:"POST",fn:function(e,t){if("SUCCESS"===e.ASTATUS){n.ASTATUS=!0,n.RSVPSTUS=t.rsvpStatus.toLowerCase();var i={msgId:a,actName:"RSVPACTION",suppress:!0,rsvpStatus:t.rsvpStatus};zmUtil.isChildWindow()&&window.opener?window.opener.$.publish("/mail/updateSchema",i):$.publish("/mail/updateSchema",i)}},onerror:function(e){zmUtil.debugLog("Error while updating RSVP schema"+e.msg)},p:l,ep:s};zmAjq.XHR(m)}}}}},addShowMoreMailsLink:function(e,t){if(e.contElem.length){var i=zdom("div",{className:"SC_simg"},zdom("font",{className:"zm_shwconv"},pe.contentOptions.showmore));$(i).insertAfter(e.contElem.find("div.SC_pct:last")),e.contElem.find(".zm_shwconv").off("click").on("click",function(){$(this).parent().remove(),zmPreviewTemplate.fetchMoreMails(e.contElem.parent(),t)})}},fetchMoreMails:function(e,t){var i,c=$(e).find("div.SC_pct:first").parent(),p=c.data("msg_params"),a={accId:zmail.accId,summary:!0},n=p.msgId;-1!==n.indexOf("t")&&(n=n.substring(1));var l=zmUtil.getMailObj(n);if(i=l?l.T:""){var s=!1;zmUtil.isChildWindow()&&(s=!0),a.thId=i,p.shId&&zmUtil.getFolderIdwithShId(p.shId)&&(a.shId=p.shId),p.streamsShowMail&&(a.accId=l.accId||zmail.accId,a.streamsView=!0),p.entityType&&(a.entityType=p.entityType),p.actionType&&(a.actionType=p.actionType),p.groupId&&(a.groupId=p.groupId),p.entityId&&(a.entityId=i);var m=function(e,t){var i,a=t.thId,n=zmUtil.getListMap(a);if(e.tdata=e.tdata||[],i={MO:e.map(function(e){return e.M})},t.streamsView){var l,s,m,r=i.MO,o=r.length;for(l=0;l<o;l++)(m=(s=r[l])&&zmUtil.getMailObj(s))&&(m.accId=t.accId,m.actionType=t.actionType,m.entityType=t.entityType,m.groupId=t.groupId,m.S=1,m.streams=!0)}zmUtil.isInlineCompose()&&zmUtil.mapDraftId(a);var d=zmPreviewTemplate.getMissingMailList(a,q);zmPreviewTemplate.addMailsInView({list:d,contElem:c,elemPrefix:q,viewDetails:p.elemObj.viewDetails,opentype:p.opentype,mode:"showmore"}),1===n.showNextPage&&zmPreviewTemplate.addShowMoreMailsLink({contElem:c})},r=zmUtil.getListMap(i,"MO")||[];r.length&&(a.thdindex=r.length+1);var o=$.extend({},a);if(o.from="tIcon",o.opentype=t,o.contElem=c,s)o.fetchMoreMails=!0,zmWindow.sendMailDataReq(a,o,m);else{if(_zm.isOfflineSyncActive()){var d=zmUtil.getMailObj(_.last(r))||{};o.lastMsgRevTime=d.R,o.lastMsgId=d.M}zmList.sendMailDataReq(a,o,m)}}},getMissingMailList:function(e,t){var i,a,n,l=[],s=zmUtil.getListMap(e,"MO").slice(),m=s.length;for(i="zmHdr"+t,1===zmail.convSortOrder&&s.reverse(),a=0;a<m;a++)n=zmUtil.getMailObj(s[a]),zmUtil.isInlineCompose()&&n&&(n.FD===zmail.folId.dId||n.FD===zmail.folId.tId)||$("#"+i+s[a]).length||l.push(s[a]);return l},_rPath:function(e,t,i){var a,n=zdom("fragment",null),l="",s="",m="",r="",o="",d=e.delegate,c=[],p=[],z="",u="",f="";if(e.frm&&(z=e.frm),i=e.shwDispName?i:z,d&&e.rPath){u=zdom("fragment",null);var g=e.rPath;for(p=(g=(g=g.replace(/</gi,"")).replace(/>/gi,"")).split(","),p=_.uniq(p),a=0;a<=p.length;a++)(l=p[a])&&(-1!==(s=l.indexOf("@"))&&u.appendChild(zdom("b",null,l.substr(s+1))),-1===l.indexOf("zmgrbounces")&&l.toLowerCase()!==z.toLowerCase()||(p.splice(a,1),a--))}if(p.length){for(a=0;a<=p.length;a++)(l=p[a])&&-1!==(s=l.indexOf("@"))&&c.push(l.substr(s+1));var h=z;if(h){var v=(h=(h=h.replace(/</gi,"")).replace(/>/gi,"")).indexOf("@");-1!==v&&(h=h.substr(v+1))}u=c.join(","),f=p.join(","),f=f.replace(/</gi,""),f=f.replace(/>/gi,""),r="redtxt",m=pe.contentOptions.sentBy,o="via",1===c.length&&h===c[0]&&(r="ylwtxt"),d&&(r="bluetxt",m=pe.contentOptions.sentBy,o="delegate")}(e.via&&(p.push(e.via),f=e.via,u=e.viaDomain,r="redtxt",m=pe.contentOptions.sentBy,o="via"),"less"===t)?(n=zdom("div",{"data-zmvia":"less","data-tooltip":z,className:"SC_cs","data-eid":z},zdom("span",null,zmUtil.replaceHTMLEntities(i)),p.length?zdom("fragment",null,zdom("span",{className:r},pe.contentOptions.via),zdom("span",null,u)):""),"delegate"===o&&(n=zdom("div",{className:"SC_cs","data-eid":z},zdom("span",null," ",z," "),p.length?zdom("fragment",null,zdom("span",{className:r},pe.contentOptions.delegateVia),zdom("span",null,u)):""))):"via"===t?n=zdom("fragment",null,zdom("span",{className:r},"via"),zdom("span",null,u)):p.length&&(n=zdom("div",{id:"zmRPATH"+e.elemId,className:"zmpdtl zmvia"},zdom("div",null,zdom("div",{class:"zmpr"},zdom("span",null,zdom("em",{class:r,"data-tooltip":m},m),zdom("span",null," ",f))))));return n},classifySmartFilter:function(e,t,i,a){e&&t&&void 0!==i&&(zmUtil.isChildWindow()?opener.zmail.Settings:zmail.Settings).Apps.Filter.categoriseMail({msgId:e,filType:t,include:i}).then(function(){i?(zmUtil.updateMailData("SFT",t,e),_zm.succErrMsg("s",pe.smartfilter.include)):(zmUtil.updateMailData("SFT",0,e),a.find(".zm_exclude").remove(),_zm.succErrMsg("s",pe.smartfilter.exclude))})},showEvents:function(e){var t,i=e.msgId,a=e.mailContElem||$.q("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+i),n=i&&zmUtil.getMailObj(i);if(n&&n.MSGREL&&-1<n.MSGREL.indexOf("1")&&!e.streamsMail&&a.length){(t=a.find(".zm_mail_events")).length?t.find(".multiAppInfo").empty():(t=$.e(zdom("div",{className:"zm_mail_events multiAppData"},zdom("div",{className:"multiAppInfo"})))).insertAfter(a.find(".zmPCon"));var l=$.e(zdom("div",{className:"multiAppHead"},zdom("span",null,pe.contextmenu.events))),s=$.e(zdom("div",{className:"eventWrapper"})),m=t.find(".multiAppInfo");m.appendDOM(l),m.appendDOM(s),zmUtil.loadEvents(function(){zmail.eventInteg.util.listEvents(i,m)})}},showNotes:function(e){var t,i=e.msgId,a=e.mailContElem;if(i){var n=zmUtil.getMailObj(i);n&&n.MA?t=n.MA:zmContentCache.isCached(i)&&(t=zmContentCache.get(i).MA)}if(t&&zmUtil.isZohoAccount(zmail.accId)){var l,s={};if((64|t)!==t)return;a.length&&((l=a.find(".zm_mail_note")).length||((l=$.e(zdom("div",{className:"zm_mail_note"}))).insertDOMAfter(a.find(".zmPCon")),e.vfc||e.streamsShowMail||(s={mailId:i,mountingElem:l,preCallback:function(){},postCallback:function(){},listParam:{showHeader:!0}},zmail.Listing.Handlers.Integrations.notesAssociates(i,s))))}},showTasks:function(e){var t,i=e.msgId,a=e.mailContElem;if(i){var n=zmUtil.getMailObj(i);n&&n.MA?t=n.MA:zmContentCache.isCached(i)&&(t=zmContentCache.get(i).MA)}if(t&&zmUtil.isZohoAccount(zmail.accId)){var l,s={};if((32|t)!==t)return;a.length&&((l=a.find(".zm_mail_task")).length||(l=$.e(zdom("div",{className:"zm_mail_task"}))).insertDOMAfter(a.find(".zmPCon"))),e.vfc||e.streamsShowMail||(s={mailId:i,mountingElem:l,preCallBk:function(){},postCallBk:function(){zmUtil.requireTaskModule("taskMail").done(function(){var e=zmTask.Integrations.Mail;e.unsubscribeTaskListeners(),e.subscribeDeleteListener(i,l)})},listParam:{showHeader:!0}},zmail.Listing.Handlers.Integrations.taskAssociates(i,s))}},showProjectsEntities:function(e){var t,i=e.msgId,a=e.mailContElem||$.q("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+i);if(i){var n=zmUtil.getMailObj(i);n&&n.MA?t=n.MA:zmContentCache.isCached(i)&&(t=zmContentCache.get(i).MA)}if(t){if((4|t)!==t)return;var l;if(a.length){(l=a.find(".zm_mail_projects")).length?l.find(".multiAppInfo").empty():(l=$.e(zdom("div",{className:"zm_mail_projects multiAppData"},zdom("div",{className:"multiAppInfo"})))).insertDOMAfter(a.find(".zmPCon"));var s=l.find(".multiAppInfo"),m=$.e(zdom("div",{className:"multiAppHead"},zdom("span",null,zmText.applyArgs(pe.common.zohoProj,{companyName:zmail.globalI18N.companyName}))));s.appendDOM(m),zmUtil.loadProjects(function(){zmail.projectsInteg.util.listProjectsEntities(i,s)})}}},unsubscribeNotesTasks:function(e){$(e).length&&$(e).find(".zm_mail_note").each(function(e,t){ReactDOM.unmountComponentAtNode(t)})},updateNoteComponent:function(e){if(e&&zmUtil.getMailObj(e)){var t=["zmConP","zmConT","zmConW","zmConS"];for(var i in t){var a;a=$("[id="+t[i]+e+"]");for(var n=0;n<a.length;n++){var l=a.eq(n);zmPreviewTemplate.showNotes({msgId:e,mailContElem:l})}}}},updateTaskComponent:function(e){if(e&&zmUtil.getMailObj(e)){var t=["zmConP","zmConT","zmConW","zmConS"];for(var i in t){var a;a=$("[id="+t[i]+e+"]");for(var n=0;n<a.length;n++){var l=a.eq(n);zmPreviewTemplate.showTasks({msgId:e,mailContElem:l})}}}},postSaveDraftAction:function(e,t,i){$.isEmptyObject(i)||$.publish("/mail/draftsaved",i);var a=zmUtil.getMailObj(t.M);a&&(t.TC=a.TC,t.PA=a.PA),a||zmUtil.isChildWindow()||ZMail.utils.updateCount({fId:zmail.folId.dId,mode:"inc",state:"read"}),zmUtil.addMailData(t,t.M),(a=zmUtil.getMailObj(t.M)).PA||(a.PA=e),$.publish("/maction/newm",[[t]])},slideZImages:function(i){if(i.length&&i[0].src){var e,a=[],n=0;i.closest(".zmPCnt").find("img").each(function(e,t){t.src&&(a.push({ft:101,fn:"image.png",src:t.src}),t.src===i[0].src&&(n=a.length-1))}),e={startIndex:n,attObjList:a,hideAllOptions:!0,ignoreThumb:!0},zmUtil.initAttSlideShow(e)}},isTruncatedMail:function(e){return zmContentCache.isCached(e)&&zmContentCache.get(e).SHRINKED},getPrefixOnCurrentab:function(){var e;if(zmUtil.isChildWindow())return e="W";var t=zmTab.currentTab;return"zm_Container"===t||"zmncenter"===t||"zmStreamsApp"===t?e="P":"zm_srch1"===t?e="S":t.indexOf("zm_tab")&&t.indexOf("zm_viewatt")||(e="T"),e},FCLoader:function(e,t){var i=$.Deferred(),a={msgId:e.mId,type:"lt",opentype:zmPreviewTemplate.currentWorkSpace,vfc:!0,tabId:void 0};$.when(i).then(function(e){t(e)}),zmUtil.isChildWindow()?zmWindow.getMail(a,i):zmList.getMailData(a,void 0,i),e.toHideVfcMsg&&$("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+e.mId+" #clippedMsg").hide()},shortCutHandler:function(e,t){switch(e){case"openReader":if(!zmPrev.prevDetails().msgId)return;X(t.mId);break;case"printMail":zmPreviewTemplate.printMsg({mId:t.mId})}},isMailOpenedViaStreams:function(e){var t=(e=$(e)).hasClass("SCS_postMail")||0<e.parent(".SCS_postMail").length||"zmncenter"===zmTab.currentTab,i="zmStreamsApp"===zmTab.currentTab,a=zmsuite.getCenter(zmTab.currentTab)[0].$el.hasClass("zms_streams"),n=0!==e.find(".SCS_cmnt").length;return t||i||a||n},addFocusOnclick:Z,constructContent:l,appendBlockQuoteDOM:L,loadImages:o};return $.subscribe("/mail/draftsaved",function(e,t){var a=(t=t||{}).draftId,n=t.msgId;a&&n&&$("[id$="+n+"New]").each(function(e,t){(t=$(t)).attr("data-mid",a);var i=t.attr("id");t.attr("id",i.replace(n+"New",a))})}),$.subscribe("/mail/collab/updateshareicon",function(e,t){!function(e){if((e=e||{}).containerDOM&&e.mailID&&e.hasOwnProperty("state")){var t=e.containerDOM,i=e.mailID,a=e.state,n=e.tooltip||"",l=$.e(t).find("[data-mid="+i+"]").find(".js-shareicon");switch(l.attr("data-tooltip",n),a){case 1:l.addClass("shd").show();break;case 0:l.removeClass("shd").show().data("shared",!1);break;case-1:l.removeClass("shd").hide();break;default:l.hide()}}}(t=t||{})}),e}(),define([],function(g){var l=zmail.Core.Namespaces.create("ZMail.previewUtil"),h=zmText.get("preview");return l.loadContactCard=function(e){var i=e.msgId,t=e.event,a=e.targetElem,n=e.clkedOnSender;if(!_zm.isOfflineSyncActive()){var l,s=g("zmConUtil"),m=g("zmUtil"),r=[];zmail.isROMode||(r=[{htm:h.contactbubble.addcontact,id:"zms_add",clk:s.handleAddToContact},{htm:h.contactbubble.sendmail,clk:s.loadCompose}],m.isChildWindow()||(r=r.concat([{htm:h.contactbubble.listmails,clk:s.listMails},{htm:h.contactbubble.listattachments,clk:s.listAttachment}])));var o="",d=zmContentCache.get(i),c="";if(d&&d.hasOwnProperty("MSGINTEG")){var p=d.MSGINTEG[8],z=h.smimeSignatureStatus;p&&p[0]&&(c=z[p[0].SSS],2===p[0].SSS?o="verified":[1,3,4,5,6,7,8,9,10].includes(p[0].SSS)&&(o="unverified"))}if(n)l=m.getMailObj(i,"SN");else{var u=s.parseContacts(a.data("eid"))[0];l=u&&u.fn}var f={dom:a,items:r,event:t,source:m.isChildWindow()?"popmail":"mail",displayName:l,isSmimeVerifiedEmail:o,tooltip:c};s.showContactCard(f).done(function(e){if(n){var t=g("zmContentCache").get(i,"SPAMDATA")||{};1===parseInt(t.ALERT_TYPE||t.AT||0)&&e.replaceAvatar(zdom("div",{className:"SC_avtr"},zdom("span",null,zdom("i",{className:"msi-spamAvatar"}))))}})}},l.buildSharedMailParams=function(e){var t=zmUtil.getMailObj(e);if(t){var i={};return t.FD&&zmUtil.isSharedFolder(t.FD)&&(i.shId=zmUtil.getShareId(t.FD)),t.streams&&Object.assign(i,{accId:t.accId,groupId:t.groupId,actionType:"viewGroupMailEntity",entityType:1,entityId:e,streamsView:!0}),i}},l.downloadAsEML=function(e){var n=e.msgId;zmUtil.secureDownloader().then(function(e){var t={m:n,accId:zmail.accId,type:"eml",fName:"sub"},i=l.buildSharedMailParams(n)||{};Object.assign(t,i);var a=e.password;a&&(t.password=a),zmAjq.formSubmit(t,zmail.conPath+"/msgDownload.do?mode=dwn")})},l.downloadAsHTML=function(e){var l=e.msgId;zmUtil.secureDownloader().then(function(e){var t=zmUtil.getMailObj(l);if(t){var i=zmail.conPath+"/FileDownload?mode=msg",a={fName:"msg"+l,entityId:l,entityType:1};t.streams?(a.groupId=t.groupId,a.streamsView=!0,a.actionType="viewGroupEntity"):a.accId=zmail.accId,zmUtil.isSharedFolder(t.FD)&&(a.shId=zmUtil.getShareId(t.FD));var n=e.password;n&&(a.password=n),zmAjq.formSubmit(a,i)}},function(){})},l.blockSender=function(e){var t,i=e.msgId,a=zmUtil.getMailModel(i),n=h.blockSender,l={title:n.confirmation.title,ignoreMouseDown:!1,$content:zdom("span",null,n.confirmation.message),buttons:[{name:n.confirmation.block,callback:function(){t.remove(),a.antiSpamAction({msgId:i,mode:"rejectedSender",isSpam:!1}).then(function(e){"success"===e.resp.data&&_zm.succErrMsg("s",n.successMessage)}).catch(function(e){zmUtil.debugLog(e)})}},{name:h.common.cancel,isCancel:!0,callback:function(){t.remove()}}]};t=Dialog.new(l)},l.trustSender=function(e){var o=e.msgId,d=e.onAcceptingConfirmation,t=e.toBeAffectedEmailIds,c=void 0===t?[]:t;return new Promise(function(i,t){var a,n=zmUtil.getMailModel(o),l=n.attributes,e=h.trustSender,s=e.confirmation,m=e.successMessage,r={title:s.title,ignoreMouseDown:!1,$content:zdom("span",null,1<c.length?s.emailAddresses:s.emailAddress,zmText.applyArgs(s.message,{emailId:zdom("b",null," ",c.join(", ")," ")})),buttons:[{name:s.accept,callback:function(){var e;e=l.FD===zmail.folId.spId,n.antiSpamAction({msgId:o,mode:"trustedSender",isSpam:e,toBeAffectedEmailIds:c}).then(function(e){if(e.resp){var t=zmText.applyArgs(m,{emailId:c.join(", ")});_zm.succErrMsg("s",t),ZMail.listing.collection.updateProperty({keyPath:"antispam.trustedSenders",opType:"add",value:c})}i()}).catch(function(e){t(e)}),d&&d(),a.remove()}},{name:h.common.cancel,isCancel:!0,callback:function(){a.remove(),t()}}]};a=Dialog.new(r)})},l.reportPhising=function(a,n){var t,i=zmUtil.getMailModel(a),l=i.attributes,e=h.phishing,s=e.confirmation,m=e.successMessage,r={title:s.title,ignoreMouseDown:!1,$content:zdom("div",{className:"zmPopTxt"},zdom("p",null,s.phisingPromptDesc),zdom("div",{className:"zmPopNoteTxt"},zdom("h4",null,s.phisingPromptNoteHeading),zdom("ol",null,zdom("li",null,s.phisingPromptNote1),zdom("li",null,s.phisingPromptNote2)))),buttons:[{name:s.phisingAccept,callback:function(){var e;e=l.FD===zmail.folId.spId,i.antiSpamAction({msgId:a,mode:"phishingEmail",isSpam:e}).then(function(e){if(e.resp){var t,i=m;_zm.succErrMsg("s",i),(t=zmUtil.isChildWindow()?zmWindow:zmmailAct).doActions("spam","dropdown",{thd:[],msgId:t===zmWindow?a:[a]}),n.hasOwnProperty("PHM")?n.PHM=!0:n.IS_PHISHING_MARKED=!0}}).catch(function(e){zmUtil.debugLog(e)}),t.remove()}},{name:h.common.cancel,isCancel:!0,callback:function(){t.remove()}}]};t=Dialog.new(r)},l.getSmartHighLightedContent=function(e){var t=e.mailContentAttrs,i=e.highlightDate,a=void 0===i||i,n=e.contentKey,l=void 0===n?"CONTENT":n,s={},m=t.PHONE_NUMBERS||t.PHNO;return m&&window.PB&&window.PB.isIntegrationEnabled()&&(s.PHONE_NUMBERS=m),a&&t.hasOwnProperty("DATECONTENT")&&(s.DATECONTENT=t.DATECONTENT),Object.keys(s).length?ZMail.preview.smartHighlighter(s,t[l]):t[l]},l.loadTranslator=function(e){var t=e.contentAttrs.MAIL_LANGUAGE||e.contentAttrs.ML,i=zmail.user.lang;t!==i&&(e.contentLanguage=t,e.userLanguage=i,zmAppLoader.load("translator").then(function(){ZMail.preview.translator.load(e)}))},l.loadQuarantineMarkup=function(e){var t=e.contentAttrs,i=e.targetElem,a=_zm.getProperty(t,"SPAMDATA.QUARANTINE_INFO.data")||_zm.getProperty(t,"SPAMDATA.QI.data")||[];0!==a.length&&zmAppLoader.load("quarantineMarkup").then(function(){ZMail.preview.quarantineMarkup.load({collections:a,targetElem:i})})},l.loadSpamAlert=function(e){var t=e.spamInfo,i=e.folId;(0!==parseInt(t.ALERT_TYPE||t.AT||0)||t.hasOwnProperty("SPAM_REASON")||t.hasOwnProperty("SR"))&&zmUtil.isZohoAccount(zmail.accId)&&!zmfolAction.isSystemFolder({folType:"outgoing",folId:i})&&zmAppLoader.load("spamAlerts").then(function(){ZMail.preview.spamAlert.load(e)})},l.disableNavigation=function(t,e){if(zmsuite.isWorkspaceAvailable(t)){if("zm_Container"!==t&&"zm_srch1"!==t){var i=["previous","next"];return"prev"===e?i=["previous"]:"next"===e&&(i=["next"]),void i.forEach(function(e){ZMail.topbar.icons.updateAttribute({iconName:e,tabId:t,key:"isDisabled",value:!0,container:"preview"})})}var a=zmsuite.getCenter(t)[1].getNodes()[0].$el,n=a.find(".msi-prev").parents("b"),l=a.find(".msi-next").parents("b");"prev"===e?n.unbind("click").addClass("SC_opy3"):("next"===e||n.unbind("click").addClass("SC_opy3"),l.unbind("click").addClass("SC_opy3"))}},l.enableNavigation=function(t,e){if(zmsuite.isWorkspaceAvailable(t)){if("zm_Container"!==t&&"zm_srch1"!==t){var i=["previous","next"];return"prev"===e?i=["previous"]:"next"===e&&(i=["next"]),void i.forEach(function(e){ZMail.topbar.icons.updateAttribute({iconName:e,tabId:t,key:"isDisabled",value:!1,container:"preview"})})}var a=zmsuite.getCenter(t)[1].getNodes()[0].$el,n=a.find(".msi-prev").parents("b"),l=a.find(".msi-next").parents("b");"prev"===e?n.removeClass("SC_opy3"):("next"===e||n.removeClass("SC_opy3"),l.removeClass("SC_opy3"))}},l.loadClickToDial=function(e){var t=e.phoneNumber;ZPB.clickToDial.trigger(t)},l});