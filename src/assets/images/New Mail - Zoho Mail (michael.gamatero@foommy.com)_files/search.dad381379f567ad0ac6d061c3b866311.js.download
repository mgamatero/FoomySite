"use strict";window.zmSearch=function(){var e,s,n=1,r=1,l="all",u=zmText.get("search"),i="zm-settings",p="#zm_rnssrchpopup";e=["Subject","Sender","To/Cc","To","Cc","Content","Attachment Name","Attachment Content","Entire Message"];var o=function(){return"zmStreamsApp"===zmTab.currentTab||"zm_Container"===zmTab.currentTab&&"zmStreamTree"===zmail.mailLeft.selLayerId?"zmStreamsApp":"attView"===zmTab.currentTab?zmTab.currentTab:"attSrcView"===zmTab.currentTab?"attView":-1!==zmTab.currentTab.indexOf("zm_srch")?s:"zm_Container"===zmTab.currentTab?"m":"zm_notes"===zmTab.currentTab?"n":"zm_task"===zmTab.currentTab?"t":"zm_Contacts"===zmTab.currentTab?"cn":zmTab.currentTab===i?i:zmApp.currentApp},c=function(e,t){var a;switch(e){case 0:case 1:a={contentArray:"",compare:["fn","ln","nn","eid"],LType:"1",OType:"1",selection:"onDemand",supressBlur:!0,callback:t};break;case 2:a={contentArray:[],compare:[""],LType:"2",OType:"2",callback:t,text:!0};break;case 3:var i=[];i.push({name:"jsp"}),i.push({name:"doc"}),i.push({name:"png"}),i.push({name:"js"}),i.push({name:"docx"}),i.push({name:"pdf"}),i.push({name:"jpeg"}),i.push({name:"jpg"}),i.push({name:"jspf"}),i.push({name:"css"}),i.push({name:"gif"}),i.push({name:"html"}),i.push({name:"java"}),i.push({name:"xml"}),i.push({name:"mp4"}),i.push({name:"mp3"}),i.push({name:"odt"}),a={contentArray:i,compare:["name"],LType:"2",OType:"2",selection:"onDemand",callback:t,text:!0}}return a},h=function(){return c(0,function(e){var t;e?(t=e.eid||e.EMAIL,zmSearch.searchField.val(t)):t=zmSearch.searchField.val(),zmSearch.contextualSearch(t)})},d=function(){var e=$.trim(zmSearch.searchField.val());e&&zmSearch.contextualSearch(e)};return $.subscribe("/apps/tabSwitched",function(){zmSearch.updateSearchValues()}),{searchField:$.q("#zm-search-field"),getSearchTabObj:function(e,t){var a={appname:e.getSearchVal()||"Search",appId:"zm_srch"+t,data:{CNodes:"3"},appIcon:"msi-search",noLeftSel:!1,titleProvider:function(){return zmText.get("search","resultsHeader")+" - "+(e.getSearchVal()||"")}};if(1<n){var i=zmail.searchObj[n-1];a.onDelete=i&&i.getOnClose&&_zm.bindFn(i.getOnClose,i)}return a},addSearch:function(e){var t,a,i,r;if(e&&e.searchQueryArr.length&&(this.hasSearchableText(e.searchQueryArr)||e.refineSearchView)){if(1<n)zmSearch.deleteSearch("zm_srch"+(n-1)),zmsuite.isWorkspaceAvailable("zm_srch"+(n-1))&&zmsuite.closeWorkspace("zm_srch"+(n-1)),n=1;else if(zmsuite.isMaxLimitReached())return;"m"===(r=e.app||"m")?t=new msSearchCollection(e):"t"===r?t=new zmTaskSearch.taskCollection(e):"zmStreamsApp"===e.app?t=new zmStreamSearch.streamCollection(e):"cn"===e.app?t=new zmContactsSearch.contactsCollection(e):"n"===e.app&&(t=new zmNotesSearch.notesCollection(e)),t.setSearchQueryArr(e.searchQueryArr),i=zmSearch.getSearchTabObj(t,n),"m"===r&&(i.shortcuts=zmshCut.mail),zmsuite.setWorkSpace(i),"m"===r?a=new msSearchView:"t"===r?a=new zmTaskSearch.taskView:"cn"===r?a=new zmContactsSearch.contactsView:"n"===r?a=new zmNotesSearch.notesView:"zmStreamsApp"===r&&(a=new zmStreamSearch.streamView).setCSSToCenterDOM(),a.setInstanceId(n),a.setCollection(t),e.refineSearchView&&(a.refineSearchView=!0),a.search(),i.onDelete=_zm.bindFn(a.getOnClose,a),zmail.searchObj[n]=a,n+=1,"m"===r&&(ZMail.lView.applyDisplayDensity(),ZMail.topbar.icons.renovate({type:"listing",isSearchView:!0,tabId:"zm_srch1"}))}},deleteSearch:function(e){e=e.replace(/[^0-9]/g,""),delete zmail.searchObj[e]},initSearch:function(){var e,t,a=[],i="";(t=$.q("#zm-search-field").val(),"1"===$.q("#zsfolder").val()&&"zm_Container"===zmTab.currentTab)&&((i=zmInit.getListingDetObj().fId)&&a.push(i));e={sString:t,sQuery:parseInt($.q("#zsfilter").val()),type:"srch",folderArr:a},zmSearch.addSearch(e)},openRefineSearchView:function(e,t){1<n&&zmsuite.isWorkspaceAvailable("zm_srch"+(n-1))&&t===s?(zmsuite.showWorkSpace("zm_srch"+(n-1)),zmail.searchObj[n-1]&&zmail.searchObj[n-1].showFilterElem()):zmSearch.contextualSearch(e,"refineSearch")},hasSearchableText:function(e){var t,a,i;for(i=e.length,t=0;t<i;t+=1)for(a in e[t])if(e[t][a])return!0;return!1},showSearchDrop:function(){},sendWarmUpRequest:function(e){var t;"m"===o()&&(e=encodeURIComponent(e),t={accId:zmail.accId,ty:"warmup",SrchQry:9,SearchStr:e},zmAjq.XHR({u:zmail.conPath+"/search.do",t:"POST",p:t,csr:"s",ep:null}))},getSearchParams:function(e){var t,a={};return t=zmail.searchObj[e].collection,a.srchStr=t.advSearchStr,t.folderArr.length&&(a.viewfolId=t.folderArr[0]),"yes"===t.attachFilter?a.attach=1:"no"===t.attachFilter&&(a.attach=0),"yes"===t.flagFilter?a.flag=1:"no"===t.flagFilter&&(a.flag=0),t.labelArr.length&&(a.label=t.labelArr[0]),"yes"===t.unreadFilter?a.unreadStatus=1:"no"===t.unreadFilter&&(a.unreadStatus=0),"yes"===t.responseFilter?a.resp=1:"no"===t.responseFilter&&(a.resp=0),"yes"===t.threadFilter?a.thd=1:"no"===t.threadFilter&&(a.thd=0),a},getSavedSearchName:function(r){var e,t,s,a,i,n,l,o,c,h="",d={};if(r=r||{},l=$.Deferred(),"edit"===(s=r.mode||"add")&&l.resolve(),"add"===s||"rename"===s){switch(s){case"add":t="Provide a name for this view",h="New Search";break;case"rename":t="Rename Saved Search",h=zmail.savedSearchList[zmSearch.savedSearchId].FN}d={title:t,style:{width:"200px"},customClass:"noanim",buttons:[{txt:"Save",selected:!0,callback:function(){var e,t="",a=$.q().find("input"),i="";e=a.val(),"rename"===s&&(t=zmSearch.savedSearchId,i=h.toLowerCase()),zmSearch.isValidName(e,r,t)?("rename"===s&&i===e.toLowerCase()?l.reject():l.resolve({savedsearchname:e}),zmsDialog.remove()):a.focus()}},{isCancel:!0,txt:"Cancel",callback:function(){zmsDialog.remove()}}],closeaction:function(){$.q(p).remove(),l.reject()},afterDisplay:function(){$.q(p).find("input").focus(),$.q(p).find("input").select()}},"rename"===s?(n=zmsuite.getAppLeft().getNodes()[0].getLayer("zmlSSrchTreeH").el,a=(o=$.e(".zm_compose")).offset().left+o.width(),0<(c=(i=n.position().top<0?$.e(".zm_compose").offset().top:n.offset().top)+250-$.e(document.body).height())&&(i-=c),d.posParent={top:i+"px",left:a+"px"}):"add"===s&&(d.mask=!0,d.pos="center");var m=u.savedsearch.placeholder;h=" "+h,e=$.e(zdom("div",{id:"zm_rnssrchpopup",className:"SC_p10"},zdom("ul",{className:"tempFormList"},zdom("li",{className:"SC_p10"},zdom("input",{type:"text","data-enableshortcuts":"true",className:"SC_tiput",value:h,placeholder:m}))))),$.q(p).length||$.e(document.body).appendDOM(e),zmsDialog.create("zm_rnssrchpopup",d),$.q("#zmsdialog_zm_rnssrchpopup").mousedown(function(e){zmUtil.stopEvents(e,!0)}),$.q("#zmsdialog_zm_rnssrchpopup").click(function(e){zmUtil.hideMenu(!1,!0)})}return l.promise()},processSavedSearch:function(e){var t,a={};t={accId:zmail.accId},"rename"===e.mode&&(t.searchname=a.searchname=e.searchName),a.mode=t.method=e.mode,t.searchId=e.id,zmAjq.XHR({u:zmail.conPath+"/savesearch.do",t:"POST",fn:_zm.bindFn(this.initiateSavedSearch,this),p:t,ep:a})},initiateSavedSearch:function(e,t){var a,i,r,s,n=e.app||"m",l={};e.searchid?"get"===t.mode?("m"===n&&(l=new msSearchCollection),l.app=n,l.updateCollection(e),zmSearchUtil.isNewSearch()?zmSearchUtil.launchSavedSearch(e):(zmSearch.setPrevAppSearch(n),zmSearch.addSearch(l))):"delete"===t.mode?(i=e.searchid,a="zmlSSrchTreeH",r=zmail.mailLeft.getNodes()[0].getLayer(a),s=zmList.getRowInfo(i,a),r.deleteNode(s),"m"===zmApp.currentApp&&zmail.isPrivilegedUser&&zmLHS.updateCollection("zmlSSrchTreeH","remove",{id:i}),0===Object.keys(r.getListObject()).length&&zmail.mailLeft.getNodes()[0].deleteLayer(a),$.publish("savedSearch/deleted",[{searchid:i}]),zmUtil.succErrMsg("s",u.savedsearch.deleteSuccess)):"rename"===t.mode&&(a="zmlSSrchTreeH",r=zmail.mailLeft.getNodes()[0].getLayer(a),(s=zmList.getRowInfo(e.searchid,a))[e.searchid].FN=_zm.escapeTags(t.searchname),r.editNode(s,r.mapObject),$.publish("savedSearch/renamed",[{searchid:e.searchid,searchname:t.searchname}]),zmUtil.succErrMsg("s",u.savedsearch.renameSuccess)):zmUtil.succErrMsg("e",zmail.i18n.errproc)},addInitSearch:function(e,t){var a=[],i={},r={lhs:"Entire Message"};r.value=e,r.contains=!0,a.push(r),i.searchQueryArr=a,t&&(i.refineSearchView=!0),s=i.app="m",zmSearch.addSearch(i)},addTaskSearch:function(e){var t=[],a={};t.push({taskStr:e}),s=a.app="t",a.searchQueryArr=t,zmSearch.addSearch(a)},addNotesSearch:function(e){var t=[],a={};t.push({notesStr:e}),s=a.app="n",a.searchQueryArr=t,zmSearch.addSearch(a)},addStreamSearch:function(e){var t=[],a={};t.push({All:e}),s=a.app="zmStreamsApp",a.searchQueryArr=t,zmSearch.addSearch(a)},addContactsSearch:function(e){var t,a=[],i={};switch(r){case 1:a.push({All:e});break;case 2:a.push({Name:e});break;case 3:a.push({Email:e});break;case 4:a.push({Phone:e});break;case 5:a.push({Address:e});break;case 6:a.push({Notes:e});break;case 7:a.push({Company:e})}"cn"===zmApp.currentApp&&"all"!==l&&(t=zmInit.getCurrentLeftId(),i.categoryArr=[t]),s=i.app="cn",i.searchQueryArr=a,zmSearch.addSearch(i)},addAttachmentSearch:function(e){zmAttachmentSearch.core.searchAttachment("name",e,1)},setPrevAppSearch:function(e){s=e},getPrevAppSearch:function(e){return s},getSearchAppType:o,contextualSearch:function(e,t){var a,i;"zmStreamsApp"===(a=zmSearch.forceSearch?zmSearch.forceSearch:o())?i=zmSearch.addStreamSearch:"attView"===a?i=zmSearch.addAttachmentSearch:"t"===a?i=zmSearch.addTaskSearch:"cn"===a?i=zmSearch.addContactsSearch:"n"===a&&zmail.showFeature?i=zmSearch.addNotesSearch:"m"!==a&&"c"!==a&&"n"!==a&&"l"!==a||(i=zmSearch.addInitSearch),i&&(t?i(e,1):i(e))},searchQueryArr:e,updateSearchValues:function(e){var t,a={};e?zmSearch.forceSearch=e:(e=o(),zmSearch.forceSearch=""),"zmStreamsApp"===e?(t=zmText.applyArgs(u.searchInApp,{appname:"Streams"}),a=h()):"attView"===e?(t=zmText.applyArgs(u.searchInApp,{appname:"Attachments"}),a=c(2,d)):"t"===e?(t=zmText.applyArgs(u.searchInApp,{appname:"Task"}),a=h()):"cn"===e?(t=zmText.applyArgs(u.searchInApp,{appname:"Contacts"}),a=h()):"n"===e&&zmail.showFeature?(t=zmText.applyArgs(u.searchInApp,{appname:"Notes"}),a=h()):"m"===e||"c"===e||"n"===e||"l"===e?(t=zmText.applyArgs(u.searchInApp,{appname:"Mail"}),a=h()):e===i&&(t=zmText.applyArgs(u.searchInApp,{appname:"Settings"}),a=zmail.Settings.SearchCommandIntegrator.getAutoFillObj()),zmSearch.updateSearchPlaceHolder(t),zmSearch.currentAutoFillId&&zmAutoFill.removeAutoFill(zmSearch.currentAutoFillId),zmSearch.currentAutoFillId=zmAutoFill.setAutofill(a,zmSearch.searchField)},getAFObj:c}}(),function(){var t=!1;function e(){this.collection=void 0,this.id=void 0,this.listElem=void 0,this.prevElem=void 0,this.mainElem=void 0,this.filterElem=void 0,this.elemObj=void 0,this.centerObj=void 0,this.loadingBandFn=void 0}e.prototype={getHeaderObj:function(){var e=zmText.get("search","resultsHeader");return{left:{leftDOM:zdom("b",null,e)},right:[]}},getActionObj:function(){return{list:{left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:zmText.get("search","closeTab")}]}]}}},constructListOuter:function(){var a,e,t,i,r,s;a=(s=this).id,t={list:[]},r={left:{},right:[]},this.getActionObj&&(t=this.getActionObj()),this.getHeaderObj&&(r=this.getHeaderObj()),this.centerObj=zmsuite.getCenter(),e=this.centerObj[0].getNodes(),this.addSearchFilter&&(i=this.addSearchFilter(),zmSearch.refineSearchView=i),e[0].push(t.list),e[0].setListener("click",function(e,t){s.getActionObjHandler&&s.getActionObjHandler(e,t),"msi-close"===t&&(s.unbindOuterEvents(),s.deleteSearchObj(),zmsuite.closeWorkspace("zm_srch"+a))}),e[1].push(r),zmsuite.renderWorkSpace(),zmsuite.showWorkSpace("zm_srch"+a),this.addSearchFilter&&this.centerObj[1].$el.after(i),zmsuite.getCenterOuter().$el.data("data-detail",this.elemObj.viewDetails),this.mainElem=this.centerObj[0].$el,this.listElem=this.centerObj[0].getNodes()[2].$el,this.prevElem=this.centerObj[1].$el,this.filterElem=this.mainElem.find(".SC_srch"),this.bindEvents()},updateHeaderObject:function(){var e;this.getHeaderObj&&(e=this.getHeaderObj());var t=this.centerObj[0].getNodes();t[1].push(e),t[1].paint(),this.bindEvents()},setInstanceId:function(e){var t;t=zmsuite.getCenter(),this.id=e,this.elemObj={prevElem:t[1].$el[0],listElem:t[0].getNodes()[2].$el[0],mainElem:t[0].$el,hdrId:"zmHdr",viewDetails:{fId:"",view:"search",flag:"",label:"",attach:""}}},bindEvents:function(){var e=this;this.centerObj[0].getNodes()[1].$el.find(".zm_savesearch").on("click",function(){e.collection.flushData(),e.collection.setSearchQueryArr(e.getAdvSearchQueryArr()),e.collection.sendRequestForSave(),e.cloneCollection()}),$(this.listElem).scroll(_zm.bindFn(this.fillSearch,this))},deleteSearchObj:function(){var e="zm_srch"+this.id;return zmSearch.deleteSearch(e),!0},toggleFilterElem:function(){this.filterElem.hasClass("shw")?this.hideFilterElem():this.showFilterElem()},showFilterElem:function(){var e=this.filterElem.find("span[data-val='Cancel']");this.refineSearchView?e.css("visibility","hidden"):e.css("visibility","visible"),zmPrev.isPrevOpen("zm_srch"+this.id)&&(this.prevElem.hide(),t=!0),this.filterElem.addClass("shw")},hideFilterElem:function(){this.filterElem.removeClass("shw"),t&&(this.prevElem.show(),t=!1)},fillSearch:function(){var e=this.listElem;90<=Math.round(100*(e[0].scrollTop+e.height())/e[0].scrollHeight)&&this.sendRequest("pagination")},search:function(){this.constructListOuter(),this.collection.flushData(),this.refineSearchView?this.toggleFilterElem():this.sendRequest()},sendRequest:function(e){e||(e="listing"),!this.collection.sending&&this.collection.hasNext&&(this.loadingBandFn=zmComponent.loadingBand({container:this.listElem[0],type:e})),this.collection.sendRequest()},setCollection:function(e){this.collection=e,this.cloneCollection&&this.cloneCollection(),this.bindOuterEvents(),this.bind&&this.bind()},bindOuterEvents:function(){var i=this,e="zm_srch"+this.id;$(this.collection).on("search/listUpdated",function(e,t,a){i.updateListing(e,t,a)}),$(this.collection).on("search/closeTab",function(){i.unbindOuterEvents(),i.deleteSearchObj(),zmsuite.closeWorkspace(e)})},unbindOuterEvents:function(){$(this.collection).off("search/listUpdated"),$(this.collection).off("search/closeTab")},selectOption:function(e){e.removeClass("msi-unoption").addClass("msi-option")},unSelectOption:function(e){e.removeClass("msi-option").addClass("msi-unoption")},optionSelect:function(e,t){var a,i;a=e.target||e.srcElement,this.unSelectOption(t.find("i")),"I"===a.tagName?i=$(a):"SPAN"===a.tagName?i=$(a).prev():"DIV"===a.tagName&&(i=$(a).find("i")),this.selectOption(i)},getSearchConditionDom:function(){var e,t,a,i,r,s,n,l=$.e(zdom("td",null)),o=$.e(zdom("table",null));for(i=this.collection.searchQueryArr,e=0;e<i.length;e++)r=(a=i[e]).lhs,s=a.value,n=a.contains?"true":"false",t=zmSearch.searchQueryArr.indexOf(r)+1,e===i.length-1?1===i.length?o.append(this.getSearchConstraintDom(t,n,s,!0)):o.append(this.getSearchConstraintDom(t,n,s)):o.append(this.getSearchConstraintDom(t,n,s,!1,!0));return l.append(o),l},getSerarchButtonsDom:function(){var e,t,a=this,i=zmText.get("search","search"),r=zmText.get("search","cancel");return t=(e=$.e(zdom("td",null,zdom("div",{className:"SC_PUbtm SC_tranbdr"},zdom("span",{className:"sel"},i),zdom("span",{"data-val":"Cancel"},r))))).find("span"),this.searchBtn=t.eq(0),t.eq(0).on("click",function(){a.updateSearchParams()}),t.eq(1).on("click",function(){a.hideFilterElem()}),e},addRemConstraintEventHandler:function(e){var t,a,i;a=(t=e.target||e.srcElement).className,t=$(t),"msi-plus"===a?(i=t.parents("tr").eq(0),this.addConstraint(i),this.searchBtn&&this.searchBtn[0].scrollIntoView()):"msi-minus"===a&&(i=t.parents("tr").eq(0),this.removeConstraint(i))},addConstraint:function(e){var t;t=this.getSearchConstraintDom(),e.after(t);var a=e.find("span");a.clearHTML(),a.appendDOM(zdom("fragment",null,zdom("i",{className:"msi-minus"}),zdom("i",{className:"msi-none"})))},removeConstraint:function(e){var t,a,i;a=e.parent(),e.remove(),t=a.children().length,i=a.find("tr:last").find("span"),1<t?(i.clearHTML(),i.appenDOM(zdom("fragment",null,zdom("i",{className:"msi-plus"}),zdom("i",{className:"msi-minus"})))):1===t&&i.appenDOM(zdom("fragment",null,zdom("i",{className:"msi-plus"}),zdom("i",{className:"msi-none"})))},getOnClose:function(){return this.unbindOuterEvents(),$.publish("search/closeTab",[]),this.deleteSearchObj()},isDataFillPossible:function(){var e=this.listElem[0];return 0<e.clientHeight&&!(e.scrollHeight>e.clientHeight)}},window.SearchOuterView=e}(),function(t){var e={escapeSpecialChars:function(e){return-1!==e.indexOf("=")&&-1===e.indexOf("\\=")&&(e=e.replace(new RegExp("=","gi"),"\\=")),-1!==e.indexOf("!")&&-1===e.indexOf("\\!")&&(e=e.replace(/!/gi,"\\!")),-1!==e.indexOf("&")&&-1===e.indexOf("\\&")&&(e=e.replace(/&/gi,"\\&")),-1!==e.indexOf("|")&&-1===e.indexOf("\\|")&&(e=e.replace(/\|/gi,"\\|")),-1!==e.indexOf('"')&&-1===e.indexOf('\\"')&&(e=e.replace(/"/gi,'\\"')),-1!==e.indexOf("(")&&-1===e.indexOf("\\(")&&(e=e.replace(/\(/gi,"\\(")),-1!==e.indexOf(")")&&-1===e.indexOf("\\)")&&(e=e.replace(/\)/gi,"\\)")),-1!==e.indexOf("<")&&-1===e.indexOf("\\<)")&&(e=e.replace(/</gi,"\\<")),-1!==e.indexOf(">")&&-1===e.indexOf("\\>)")&&(e=e.replace(/>/gi,"\\>")),-1!==e.indexOf("'")&&-1===e.indexOf("\\')")&&(e=e.replace(/'/gi,"\\'")),-1===e.indexOf(" ")&&-1===e.indexOf(",")||(e="( "+e+" )"),e}};(t=t||{}).util=e,t.isStreamSearchOpen=function(){return!(!zmail.searchObj[1]||!zmail.searchObj[1].collection.getSearchType||"zm_stream"!==zmail.searchObj[1].collection.getSearchType())},t.isValidName=function(e,t,a){var i;return(i=$.trim(e)).length?zmUtil.hasSpecialChars(i)?(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.nochar")),!1):"null"===i.toLowerCase()?(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.nonull")),!1):!function(e,t){var a,i=e.toLowerCase(),r=Object.keys(zmail.savedSearchList);for(a=0;a<r.length;a++)if(i===zmail.savedSearchList[r[a]].FN.toLowerCase()&&(!t||r[a]!==t))return!0;return!1}(i,a)||(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.alreadypresent")),!1):(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.noempty")),!1)},t.getSearchFieldVal=function(){return t.searchField.val()},t.updateSearchPlaceHolder=function(e){t.searchField.attr("placeholder",e)},window.zmSearch=t}(zmSearch),function(e){(e=e||{}).view={},window.zmSearch=e}(zmSearch),function(){function e(e){this.searchQueryArr=[],this.advSearchStr=e&&e.advSearchStr||"",this.folderArr=e&&e.folderArr||[],this.dateRange=e&&e.dateRange?e.dateRange:{},this.labelArr=e&&e.labelArr||[],this.attachFilter=e&&e.attachFilter?e.attachFilter:"all",this.flagFilter=e&&e.flagFilter?e.flagFilter:"all",this.unreadFilter=e&&e.unreadFilter?e.unreadFilter:"all",this.responseFilter=e&&e.responseFilter?e.responseFilter:"all",this.threadFilter=e&&e.threadFilter?e.threadFilter:"all",this.searchList=[],this.savedSearchId=e&&e.savedSearchId||"",this.savedSearchName=e&&e.savedSearchName||"",this.threadObj={},this.hasNext=1,this.from=1,this.limit=25,this.sending=!1}e.prototype={setAdvSearchStr:function(e){this.advSearchStr=e},updateCollection:function(e){var t,a,i,r,s={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},n=this;e.eDate&&e.fDate&&(r=e.fDate.split("-"),a=new Date(r[2],s[r[1]],r[0]),r=e.eDate.split("-"),i=new Date(r[2],s[r[1]],r[0]),n.setDateRange(a,i));e.labId&&n.updateSearchLabel(e.labId),e.folId&&n.updateSearchFolder(e.folId),t=void 0!==e.resp?1===e.resp?"yes":"no":"all",n.updateSearchResponseFilter(t),t=void 0!==e.thd?1===e.thd?"yes":"no":"all",n.updateSearchThreadFilter(t),t=void 0!==e.hasAtt?1===e.hasAtt?"yes":"no":"all",n.updateSearchAttachFilter(t),t=void 0!==e.hasFlg?1===e.hasFlg?"yes":"no":"all",e.searchid&&n.setSavedSearchId(e.searchid),e.searchname&&n.setSavedSearchName(e.searchname),n.updateSearchFlagFilter(t);var l=e.searchstring;l&&(l=$.parseJSON(zmUtil.replaceHTMLEntities(l))),n.setSearchQueryArr(l)},getAdvSearchStr:function(){return this.advSearchStr},setSearchQueryArr:function(e){var t;this.searchQueryArr=e,t=this.getSearchQueryFromArr(this.searchQueryArr),this.setAdvSearchStr(t)},setThreadObj:function(e,t){this.threadObj[e]=t},getThreadObj:function(e){return this.threadObj[e]},addToFolderArr:function(e){this.folderArr||(this.folderArr=[]),this.folderArr.push(e)},updateSearchFolder:function(e){this.folderArr[0]=e},removeSearchFolder:function(){this.folderArr=[]},updateSearchLabel:function(e){this.labelArr[0]=e},removeSearchLabel:function(){this.labelArr=[]},updateSearchAttachFilter:function(e){this.attachFilter=e},updateSearchFlagFilter:function(e){this.flagFilter=e},updateSearchResponseFilter:function(e){this.responseFilter=e},updateSearchThreadFilter:function(e){this.threadFilter=e},setDateRange:function(e,t){e&&t?(this.dateRange.from=e,this.dateRange.to=t):this.dateRange={}},addToLabelArr:function(e){this.labelArr||(this.labelArr=[]),this.labelArr.push(e)},addToAttTypeArr:function(e){this.attTypeArr||(this.attTypeArr=[]),this.attTypeArr.push(e)},addSearchList:function(e){var t,a,i,r,s=e.length;i=zmCache.dolistObj(null,e).MO,r=e[s-1].stateinfo,this.hasNext=parseInt(r[13]),this.hasNext&&e[s-1].lastRT&&(this.cacheObj.lastRT=e[s-1].lastRT,this.cacheObj.M=e[s-2].M),this.searchList.length?(t=this.searchList.length,this.searchList=this.searchList.concat(i)):(t=0,this.searchList=i),a=this.searchList.length,this.from=a+1,$.e(this).trigger("search/listUpdated",[t,a])},deleteFromList:function(e){var t;-1!==(t=this.searchList.indexOf(e))&&(this.searchList.splice(t,1),this.from=this.searchList.length+1),this.searchList.length<25&&$.e(this).trigger("search/sendNewRequest",[])},setSavedSearchId:function(e){this.savedSearchId=e},setSavedSearchName:function(e){this.savedSearchName=e},getAdditionalParams:function(){var e={};return Object.keys(this.cacheObj).length&&(this.cacheObj.lastRT&&(e.lastRT=this.cacheObj.lastRT),this.cacheObj.M&&(e.lastM=this.cacheObj.M)),e},sendRequestForSave:function(){var t,e,a,i,r,s,n=this;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)&&(this.sending=!0,t={accId:zmail.accId},this.folderArr[0]&&(t.folId=this.folderArr[0]),this.labelArr[0]&&(t.labId=this.labelArr[0]),"yes"===this.attachFilter?t.hasAtt=1:"no"===this.attachFilter&&(t.hasAtt=0),"yes"===this.flagFilter?t.hasFlg=1:"no"===this.flagFilter&&(t.hasFlg=0),"yes"===this.unreadFilter?t.unread=0:"no"===this.unreadFilter&&(t.unread=1),"yes"===this.responseFilter?t.resp=1:"no"===this.responseFilter&&(t.resp=0),"yes"===this.threadFilter?t.thd=1:"no"===this.threadFilter&&(t.thd=0),e={0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"},this.dateRange.from&&(a=this.dateRange.from,t.fDate=a.getDate()+e[a.getMonth()]+a.getFullYear()),this.dateRange.to&&(i=this.dateRange.to,t.eDate=i.getDate()+e[i.getMonth()]+i.getFullYear()),s=this.savedSearchId?(t.searchId=this.savedSearchId,t.searchname=this.savedSearchName,"edit"):"add",r={mode:s},zmSearch.getSavedSearchName(r).then(function(e){"add"===s&&(t.searchname=e.savedsearchname),t.method=s,t.searchStr=JSON.stringify(n.searchQueryArr),zmAjq.XHR({u:zmail.conPath+"/savesearch.do",t:"POST",fn:_zm.bindFn(n.savedSearchResponse,n),p:t,csr:"s",ep:r})}).fail(function(){n.sending=!1}))},getCurrentParams:function(){var e,t,a,i;return e={accId:zmail.accId,from:this.from,to:this.limit},this.folderArr[0]&&(e.viewfolId=this.folderArr[0]),this.labelArr[0]&&(e.labId=this.labelArr[0]),"yes"===this.attachFilter?e.hasAtt=1:"no"===this.attachFilter&&(e.hasAtt=0),"yes"===this.flagFilter?e.hasFlg=1:"no"===this.flagFilter&&(e.hasFlg=0),"yes"===this.unreadFilter?e.unread=0:"no"===this.unreadFilter&&(e.unread=1),"yes"===this.responseFilter?e.resp=1:"no"===this.responseFilter&&(e.resp=0),"yes"===this.threadFilter?e.thd=1:"no"===this.threadFilter&&(e.thd=0),t={0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"},this.dateRange.from&&(a=this.dateRange.from,e.fDate=a.getDate()+t[a.getMonth()]+a.getFullYear()),this.dateRange.to&&(i=this.dateRange.to,e.eDate=i.getDate()+t[i.getMonth()]+i.getFullYear()),e.thdView=!1,e.SearchStr=encodeURIComponent(this.advSearchStr),e},savedSearchResponse:function(e,t){if(this.sending=!1,e.searchid&&e.searchname){if(this.setSavedSearchId(e.searchid),this.setSavedSearchName(e.searchname),"add"===t.mode){if($.q("#zmlSSrchTree").length){var a,i,r,s="zmlSSrchTreeH";for(r in zmail.savedSearchList[e.searchid]={id:e.searchid,FN:e.searchname},a=zmail.mailLeft.getNodes()[0].getLayer(s),i=zmList.getRowInfo(e.searchid,s)){i[r].FN=e.searchname,i[r].id=e.searchid;break}a.appendNode(i,a.mapObject)}else{var n={};n.id=e.searchid,n.FN=e.searchname,zmail.savedSearchList[e.searchid]=n;if(0<Object.keys(zmail.savedSearchList).length){var l=new ZMLayer,o={type:"1",mapObject:{id:"id",name:"FN"},disableSelection:!0,listId:"zmlSSrchTree",id:"zmlSSrchTreeH",dataObject:{headerObject:{id:"zmlSSrchTreeH",name:zmText.get("search","common.savedSearches"),showList:!0},listObject:zmail.savedSearchList}};l.push(o),zmail.mailLeft.getNodes()[0].insertLayerAfter("zmlview",l)}}zmUtil.succErrMsg("s",zmText.get("search","savedsearch.saveSuccess"))}else"edit"===t.mode&&zmUtil.succErrMsg("s",zmText.get("search","savedsearch.updateSuccess"));$.e(this).trigger("saveSearch/save",[])}else zmUtil.succErrMsg("e",zmail.i18n.errproc)},sendRequest:function(){var e,t,a,i;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)&&(this.sending=!0,e={accId:zmail.accId,from:this.from,to:this.limit},this.folderArr[0]&&(e.folId=this.folderArr[0]),this.labelArr[0]&&(e.labId=this.labelArr[0]),"yes"===this.attachFilter?e.hasAtt=1:"no"===this.attachFilter&&(e.hasAtt=0),"yes"===this.flagFilter?e.hasFlg=1:"no"===this.flagFilter&&(e.hasFlg=0),"yes"===this.unreadFilter?e.unread=0:"no"===this.unreadFilter&&(e.unread=1),"yes"===this.responseFilter?e.resp=1:"no"===this.responseFilter&&(e.resp=0),"yes"===this.threadFilter?e.thd=1:"no"===this.threadFilter&&(e.thd=0),t={0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"},this.dateRange.from&&(a=this.dateRange.from,e.fDate=a.getDate()+t[a.getMonth()]+a.getFullYear()),this.dateRange.to&&(i=this.dateRange.to,e.eDate=i.getDate()+t[i.getMonth()]+i.getFullYear()),e.thdView=!1,$.extend(e,this.getAdditionalParams()),e.SearchStr=encodeURIComponent(this.advSearchStr),zmAjq.XHR({u:zmail.conPath+"/search.do",t:"POST",fn:_zm.bindFn(this.searchResponse,this),p:e,csr:"s",ep:null,oncaptchafailure:_zm.bindFn(this.onCaptchaFailure,this)}))},onCaptchaFailure:function(){$.e(this).trigger("search/closeTab",[])},searchResponse:function(e){this.sending=!1,this.addSearchList(e)},flushData:function(){this.hasNext=1,this.from=1,this.searchList=[],this.threadObj={},this.cacheObj={}},getSearchQueryFromArr:function(){var e,t,a,i,r,s="",n="",l="";for(t=(a=this.searchQueryArr||[]).length,e=0;e<t;e++)i=a[e],n=zmSearch.util.escapeSpecialChars(i.value),r=i.lhs,l=i.contains?" = ":" != ","to/cc"===r.toLowerCase()?" = "===l?s+="( To"+l+n+" ||Cc"+l+n+" )":" != "===l&&(s+="To"+l+n+" && Cc"+l+n):"entire message"===r.toLowerCase()?s+="Entire"+l+n:s+=r+l+n,e!==t-1&&(s+=" && ");return s},getSearchVal:function(){return this.searchQueryArr[0].value}},window.msSearchCollection=e}(),function(){function e(){this.viewCollection=[]}var h=zmText.get("search"),t={getActionObj:function(){var e=h.mail.tooltips,t=ZMail.topbar.icons.model.get("search");return t.right=t.right.concat([{actionArr:[{iconList:["msi-close"],tooltip:e.closeTab}]}]),{list:t}},getActionObjHandler:function(e,t){zmInit.bindActionHeaderIcons(e,t)},checkForCollectionChanges:function(){var e=this.latestCollection,t=this.collection,a=e.advSearchStr===t.advSearchStr,i=0===$.e(e.folderArr).not(t.folderArr).length&&0===$.e(t.folderArr).not(e.folderArr).length,r=e.attachFilter===t.attachFilter&&e.flagFilter===t.flagFilter&&e.unreadFilter===t.unreadFilter&&e.responseFilter===t.responseFilter&&e.threadFilter===t.threadFilter,s=JSON.stringify(e.dateRange)===JSON.stringify(t.dateRange);return!!(a&&i&&r&&s)},cloneCollection:function(){this.latestCollection=$.extend({},this.collection),this.latestCollection.folderArr=0<this.collection.folderArr.length?this.collection.folderArr.slice(0):[],this.latestCollection.labelArr=0<this.collection.labelArr.length?this.collection.labelArr.slice(0):[],this.latestCollection.dateRange=$.extend({},this.collection.dateRange)},getHeaderObj:function(){var e,t;if(this.collection.savedSearchId){var a=this.collection.savedSearchName;if(t=zdom("fragment",null,a),!this.checkForCollectionChanges()){var i=h.savedsearch.saveChanges;$.e(t).appendDOM(zdom("span",{className:"SC_lnk zm_savesearch"},i))}e={leftDOM:t}}else if(this.refineSearchView)e={leftText:h.mail.resultsHeader};else{var r=h.mail.resultsHeader,s=h.savedsearch.save;e={leftDOM:zdom("fragment",null,r,zdom("span",{className:"SC_lnk zm_savesearch"},s))}}return{left:e,right:[]}},handleDataFillIfPossible:function(){var e=this;e&&!e.isRemoved&&e.isDataFillPossible()&&e.collection.hasNext&&e.sendRequest("pagination")},updateListing:function(e,t,a){var i,r,s,n,l;for(l=document.createDocumentFragment(),n=this.collection.searchList,0===t&&this.clearViewCollection(),i=t;i<a;i++)r=new msSearchRowModel(n[i]),s=new msSearchRowView({model:r,type:"m",parent:this}),this.viewCollection[i]=s,l.appendChild(s.constructRow()[0]);this.loadingBandFn(),0===t&&(this.listElem.clearHTML(),this.listElem.scrollTop(0),0===a&&this.listElem.dangerouslySetInnerHTML(zmInit.emptyRow(h.emptyResults))),this.listElem.appendDOM(l)},setEmptyListing:function(){0===this.collection.searchList.length&&this.listElem.dangerouslySetInnerHTML(zmInit.emptyRow(h.emptyResults))},deleteSearchObj:function(){var e="zm_srch"+this.id;return this.isRemoved=!0,this.clearViewCollection(),zmSearch.deleteSearch(e),!0},clearViewCollection:function(){var e,t;for(t=this.viewCollection.length,e=0;e<t;e++)this.viewCollection[e]&&this.viewCollection[e].clearAll()},addSearchFilter:function(){return this.getSearchFilterDOM()},bindOuterEvents:function(){var t,e,i=this,a="zm_srch"+this.id,r={};$.e(this.collection).on("search/listUpdated",function(e,t,a){i.refineSearchView&&(i.refineSearchView=!1),i.elemObj.listArr=i.collection.searchList,i.updateListing(e,t,a),i.updateHeaderObject(),r=zmSearch.getSearchTabObj(i.collection,i.id),zmTab.updateTabLst(r),i.handleDataFillIfPossible()}),$.e(this.collection).on("search/closeTab",function(){i.unbindOuterEvents(),i.deleteSearchObj(),zmsuite.closeWorkspace(a)}),$.e(this.collection).on("saveSearch/save",function(){i.updateHeaderObject()}),$.e(this.collection).on("search/sendNewRequest",_.debounce(function(){0===i.collection.from?i.collection.hasNext?i.sendRequest():$.e(i.collection).trigger("search/listUpdated",[0,0]):i.sendRequest("pagination")},50)),$.subscribe("savedSearch/deleted",function(e,t){i.collection.savedSearchId&&t.searchid===i.collection.savedSearchId&&(i.collection.setSavedSearchId(""),i.collection.setSavedSearchName(""),i.updateHeaderObject())}),$.subscribe("savedSearch/renamed",function(e,t){i.collection.savedSearchId&&t.searchid===i.collection.savedSearchId&&(i.collection.setSavedSearchName(t.searchname),i.updateHeaderObject())}),this.elemObj.searchType=3,this.elemObj.searchStr=this.collection.advSearchStr,this.elemObj.listArr=this.collection.searchList,this.elemObj.collection=this.collection,this.elemObj.id=this.id,this.elemObj.appType="m",t=this.elemObj,(e=zmsuite.getCenter("zm_srch1")[0].getNodes()[2]).setListener("click",function(e){i.hideFilterElem(),zmList.bindEventsMailRow(e,t)}),e.setListener("contextmenu",function(e){zmList.mailUtility(e)}),e.setDragDrop({onDrop:function(e,t,a,i){var r,s,n,l,o=[],c=[];for(n in a)r=n;for(l=t.length,n=0;n<l;n++)-1!==t[n].id.indexOf("t")?c.push(zmInit.zmsubStr(t[n].id,"t")):o.push(t[n].id);a[r].FN?(s={action:"move",folId:r,msgId:o,thd:c},zmmailAct.doActions("move","drop",s)):(s={action:"label",msgId:o,thd:c,lA:"add",lId:r},zmmailAct.applyActions("label","drop",s))},allowDrag:function(e){var t,a=e.attr("id");return!(!(t=zmUtil.getMailObj(a,"FD"))||t===zmail.folId.dId||t===zmail.folId.teId||t===zmail.folId.spId||t===zmail.folId.oId)},allowDrop:function(e,t,a){var i,r;for(i in t)r=i;return t[r].FN?"inside"===a&&(r!==zmail.folId.dId&&r!==zmail.folId.teId&&r!==zmail.folId.oId):"inside"===a},dragStart:function(e,t){var a,i={};return 1<t.length?(i.count=t.length,i.text="Messages selected"):(a=zmInit.zmsubStr(t[0].id,"t"),i.text=zmUtil.getMailObj(a,"SB")),i},allowedParents:"#zmlTreeH,#zmllabelH"}),zmsuite.getCenter()[1].getNodes()[0].setListener("click",function(e,t){zmList.bindAction(e,t)}),$.e(t.listElem).scroll(_zm.bindFn(this.fillSearch,this))},getSearchFilterEntities:function(){var e;return(e=document.createDocumentFragment()).appendChild(this.getAttachmentOptions()),e.appendChild(this.getFlagOptions()),e.appendChild(this.getConversationOptions()),e.appendChild(this.getRespondedOptions()),e},getAttachmentOptions:function(){var t,e,a=this,i=a.collection.attachFilter,r=h.mail.allEmails,s=h.mail.withAttachments,n=h.mail.withoutAttachments;return(t=$.e(zdom("td",{className:"zm_atchopt"},zdom("div",null,zdom("i",{className:"msi-option"}),zdom("span",null,r)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,s)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,n))))).on("click","div",function(e){a.optionSelect(e,t)}),e=t.find("i"),"all"!==i&&(a.unSelectOption($.e(e[0])),"yes"===i?a.selectOption($.e(e[1])):a.selectOption($.e(e[2]))),t[0]},getFlagOptions:function(){var t,e,a=this,i=a.collection.flagFilter,r=h.mail.allEmails,s=h.mail.flagged,n=h.mail.notFlagged;return(t=$.e(zdom("td",{className:"zm_flgopt"},zdom("div",null,zdom("i",{className:"msi-option"}),zdom("span",null,r)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,s)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,n))))).on("click","div",function(e){a.optionSelect(e,t)}),e=t.find("i"),"all"!==i&&(a.unSelectOption($.e(e[0])),"yes"===i?a.selectOption($.e(e[1])):a.selectOption($.e(e[2]))),t[0]},getConversationOptions:function(){var t,e,a=this,i=a.collection.threadFilter,r=h.mail.allEmails,s=h.mail.withinConv,n=h.mail.withNoConv;return(t=$.e(zdom("td",{className:"zm_convopt"},zdom("div",null,zdom("i",{className:"msi-option"}),zdom("span",null,r)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,s)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,n))))).on("click","div",function(e){a.optionSelect(e,t)}),e=t.find("i"),"all"!==i&&(a.unSelectOption($.e(e[0])),"yes"===i?a.selectOption($.e(e[1])):a.selectOption($.e(e[2]))),t[0]},getRespondedOptions:function(){var t,e,a=this,i=a.collection.responseFilter,r=h.mail.allEmails,s=h.mail.withReplies,n=h.mail.withoutReplies;return(t=$.e(zdom("td",{className:"zm_respopt"},zdom("div",null,zdom("i",{className:"msi-option"}),zdom("span",null,r)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,s)),zdom("div",null,zdom("i",{className:"msi-unoption"}),zdom("span",null,n))))).on("click","div",function(e){a.optionSelect(e,t)}),e=t.find("i"),"all"!==i&&(a.unSelectOption($.e(e[0])),"yes"===i?a.selectOption($.e(e[1])):a.selectOption($.e(e[2]))),t[0]},getSearchConstraintAFObj:function(e,t){var a={};switch(e){case 2:case 3:case 4:case 5:a=zmSearch.getAFObj(0,function(e){e&&t.val(e.eid)});break;case 6:case 1:case 7:case 8:case 9:a=zmSearch.getAFObj(2,function(){})}return a},getSearchConstraintDom:function(e,t,a,i,r){var s,n,l,o="",c=this;return r?i||(o=zdom("fragment",null,zdom("i",{className:"msi-minus"}),zdom("i",{className:"msi-none"}))):o=i?zdom("fragment",null,zdom("i",{className:"msi-plus"}),zdom("i",{className:"msi-none"})):zdom("fragment",null,zdom("i",{className:"msi-plus"}),zdom("i",{className:"msi-minus"})),(s=$.e(zdom("tr",null,zdom("td",null,zdom("div",{className:"SC_select"},zdom("select",{className:"select"},zdom("option",{value:"1"},h.dropdown.mail.subject),zdom("option",{value:"2"},"Sender"),zdom("option",{value:"3"},h.dropdown.mail.toOrcc),zdom("option",{value:"4"},h.dropdown.mail.to),zdom("option",{value:"5"},h.dropdown.mail.cc),zdom("option",{value:"6"},h.common.content),zdom("option",{value:"7"},h.dropdown.common.attachmentName),zdom("option",{value:"8"},h.dropdown.common.attachmentContent),zdom("option",{value:"9"},h.dropdown.mail.entireMessage)))),zdom("td",null,zdom("div",{className:"SC_select"},zdom("select",{className:"select",id:"zma3"},zdom("option",{value:"yes"},h.common.contains),zdom("option",{value:"no"},h.common.doesNotContain)))),zdom("td",null,zdom("input",{type:"text",placeholder:h.common.placeHolder.searchWord})),zdom("td",null,zdom("span",null,o))))).find("input").val(a),n=s.find("td"),e&&(n.eq(0).find("option[value='"+e+"']")[0].selected="selected"),e=e||1,l=s.find("input")[0],zmAutoFill.setAutofill(c.getSearchConstraintAFObj(e,$.e(l)),l),s.find("select").eq(0).on("change",function(){zmAutoFill.setAutofill(c.getSearchConstraintAFObj(this.selectedIndex+1,$.e(l)),l)}),t&&"true"!==t&&(n.eq(1).find("option[value='no']")[0].selected="selected"),s},getSearchFilterDOM:function(){var e,t,a=h.mail.inFolder,i=h.mail.inDateRange,r=h.mail.withTags,s=h.common.attachments,n=h.common.flags,l=h.common.conversations,o=h.common.replies;return(t=(e=$.e(zdom("div",{className:"SC_srch"},zdom("table",null,zdom("tr",null,zdom("td",null,zdom("table",null,zdom("tbody",null,zdom("tr",{className:"sml"},zdom("td",null,a),zdom("td",null,i),zdom("td",null,r)),zdom("tr",null,zdom("td",null,zdom("span",null,zdom("input",{type:"text",disabled:!0}))),zdom("td",null,zdom("span",null,zdom("input",{type:"text",disabled:!0}))),zdom("td",null,zdom("span",null,zdom("input",{type:"text",disabled:!0}))),zdom("td",null)))))),zdom("tr",null,zdom("td",null,zdom("table",{cellSpacing:"0"},zdom("tbody",null,zdom("tr",{className:"sml"},zdom("td",null,s),zdom("td",null,n),zdom("td",null,l),zdom("td",null,o)),zdom("tr",null))))),zdom("tr",null),zdom("tr",null))))).find("tr")).eq(5).append(this.getSearchFilterEntities()),t.eq(6).append(this.getSearchConditionDom()),t.eq(7).append(this.getSerarchButtonsDom()),this.initAdvDiv(e),this.bindEventsToAdvDiv(e),e},bindEventsToAdvDiv:function(e){var i,l;i=e.find("span"),l=this,e.on("click","i",_zm.bindFn(this.addRemConstraintEventHandler,this)),i.eq(0).parent().on("click",function(){var t,e={},a=i.eq(0).find("input");e.parentDOM=a,e.displayAs="dropdown",e.excludeList=[zmail.folId.oId],e.showAllItem=!0,e.parWidth=!0,e.onSelect=function(e){"all"===e?(l.collection.removeSearchFolder(),a[0].value=l.getFolderText()):e&&(l.collection.updateSearchFolder(e),a[0].value=l.getFolderText(e)),t.hide()},(t=zmUtil.createFLComp("folder",e)).show()}),i.eq(1).parent().on("click",function(e){var t,a,i={},r=function(e){return zdom("fragment",null,e)};a=e.target||e.srcElement,t=[{dom:r(h.dropdown.common.all),data:{val:"all"}},{dom:r(h.mail.today),data:{val:"today"}},{dom:r(h.mail.yesterday),data:{val:"yesterday"}},{dom:r(h.mail.lastWeek),data:{val:"l7d"}},{dom:r(h.mail.thisMonth),data:{val:"mtd"}},{dom:r(h.mail.thisYear),data:{val:"ytd"}},{dom:r(h.mail.prevMonth),data:{val:"pm"}},{dom:r(h.mail.afterDate),data:{val:"ada"}},{dom:r(h.mail.specificRange),data:{val:"dr"}}],i.par=$.e(a),i.list=t,i.parWidth=!0,i.clk=function(e,t){var a,r,i,s,n;switch(a=e.val,r=l.collection,n=!0,i=zmUtil.getCurrentDateObj(),s=zmUtil.getCurrentDateObj(),a){case"all":i=s=null,zmUtil.hideMenu();break;case"today":zmUtil.hideMenu();break;case"yesterday":i.setDate(i.getDate()-1),s.setDate(s.getDate()-1),zmUtil.hideMenu();break;case"l7d":i.setDate(i.getDate()-7),zmUtil.hideMenu();break;case"mtd":i.setDate(1),zmUtil.hideMenu();break;case"ytd":i.setDate(1),i.setMonth(0),zmUtil.hideMenu();break;case"pm":i.setDate(1),i.setMonth(i.getMonth()-1),s.setFullYear(s.getFullYear(),s.getMonth(),0),zmUtil.hideMenu();break;case"ada":n=!1,zmUtil.showDatePicker(t,function(e){var t,a;a=new Date(e),t=new Date,l.setDateValue(l.getDateText(a,t)),r.setDateRange(a,t)});break;case"dr":n=!1,zmUtil.showDateRangePicker(t,function(e,t){var a,i;a=new Date(e),i=new Date(t),l.setDateValue(l.getDateText(a,i)),r.setDateRange(a,i)})}n&&(l.setDateValue(l.getDateText(i,s)),r.setDateRange(i,s))},zmsuite.showMenu(i)}),i.eq(2).parent().on("click",function(){var t,e={},a=i.eq(2).find("input");e.parentDOM=a,e.displayAs="dropdown",e.showAllItem=!0,e.parWidth=!0,e.onSelect=function(e){"all"===e?(l.collection.removeSearchLabel(),a[0].value=l.getLabelText()):e&&(l.collection.updateSearchLabel(e),a[0].value=l.getLabelText(e)),t.hide()},(t=zmUtil.createFLComp("label",e)).show()})},setDateValue:function(e){this.filterElem.find("span").eq(1).find("input")[0].value=e},getFolderText:function(e){return e?zmInit.findFolName(e):h.mail.allFolders},getDateRangeText:function(){var e,t;return this.collection.dateRange&&this.collection.dateRange.from&&this.collection.dateRange.to?(e=this.collection.dateRange.from,t=this.collection.dateRange.to,this.getDateText(e,t)):h.dropdown.common.all},getLabelText:function(e){return e?zmail.labInfo[e].dispName:h.dropdown.common.all},getDateText:function(e,t){return e&&t?zmUtil.getDateFromDateObj(e)+" - "+zmUtil.getDateFromDateObj(t):h.dropdown.common.all},initAdvDiv:function(e){var t,a;t=this.collection.folderArr[0],a=this.collection.labelArr[0],e.find("input")[0].value=this.getFolderText(t),e.find("input")[1].value=this.getDateRangeText(),e.find("input")[2].value=this.getLabelText(a)},getAdvSearchQueryArr:function(){var e,t,a,i,r,s=this.filterElem.find("table").eq(3).find("tr"),n=s.length,l="",o=0,c=[];for(e=0;e<n;e++,o+=4)r={},(a=s.eq(e).find("input").val().trim())&&(l="3"===(i=(t=s.eq(e).find("select")).eq(0).val())?"To/Cc":"9"===i?"Entire Message":zmSearch.searchQueryArr[i-1],r.lhs=l,r.value=a,"yes"===t.eq(1).val()?r.contains=1:r.contains=0,c.push(r));return c},getAdvSearchQuery:function(){var e,t,a,i,r=this.filterElem.find("table").eq(3).find("tr"),s=r.length,n="",l=0;for(e=0;e<s;e++,l+=4)(a=r.eq(e).find("input").val().trim())&&(a=zmSearch.escapeSpecialChars(a),0!==e&&(n+=" && "),n+="3"===(i=(t=r.eq(e).find("select")).eq(0).val())?"To":"7"===i?"Entire":zmSearch.searchQueryArr[i-1],"yes"===t.eq(1).val()?n+=" = ":n+=" != ",n+=a,"3"===i&&(n+="|| Cc = "+a));return n},updateSearchParams:function(){var e,t,a,i,r,s;e=this.filterElem.find(".zm_atchopt"),t=this.filterElem.find(".zm_flgopt"),a=this.filterElem.find(".zm_convopt"),i=this.filterElem.find(".zm_respopt"),s=this.collection,r=this.getSelectedVal(e),s.updateSearchAttachFilter(r),r=this.getSelectedVal(t),s.updateSearchFlagFilter(r),r=this.getSelectedVal(a),s.updateSearchThreadFilter(r),r=this.getSelectedVal(i),s.updateSearchResponseFilter(r),s.setSearchQueryArr(this.getAdvSearchQueryArr()),zmSearch.hasSearchableText(this.collection.advSearchStr)&&(s.flushData(),this.hideFilterElem(),zmPrev.isPrevOpen("zm_srch"+this.id)&&zmPrev.clsPreview(),this.sendRequest(),zmWinTitle.updateTitle())},getSelectedVal:function(e){var t,a;return t=e.find(".msi-option"),0===(a=e.find("i").index(t))?a="all":1===a?a="yes":2===a&&(a="no"),a}};e.prototype=Object.create(SearchOuterView.prototype),$.extend(e.prototype,t),window.msSearchView=e}(),function(){function e(e){this.obj=e,this.updateRowReadFn=void 0,this.updateRowUnreadFn=void 0,this.updateFlagRowFn=void 0,this.updateRowDeleteFn=void 0,this.updateLabelRowFn=void 0,this.updateRowMoveFn=void 0,this.updateRowArchiveFn=void 0,this.updateRowUnarchiveFn=void 0,this.updateRowSpamFn=void 0,this.updateRowNotspamFn=void 0,this.init()}e.prototype={updateRowRead:function(e,t,a){t===this.obj&&$.e(this).trigger("search/read",[t,a])},updateRowUnread:function(e,t,a){t===this.obj&&$.e(this).trigger("search/unread",[t,a])},updateFlagRow:function(e,t,a,i){t===this.obj&&$.e(this).trigger("search/flag",[t,a,i])},updateRowDelete:function(e,t,a){t===this.obj&&$.e(this).trigger("search/delete",[t,a])},updateLabelRow:function(e,t,a,i){t===this.obj&&$.e(this).trigger("search/label",[t,a,i])},updateRowMove:function(e,t,a,i){t===this.obj&&$.e(this).trigger("search/move",[t,a,i])},updateRowArchive:function(e,t,a){t===this.obj&&$.e(this).trigger("search/archive",[t,a])},updateRowUnarchive:function(e,t,a){t===this.obj&&$.e(this).trigger("search/unarchive",[t,a])},updateRowSpam:function(e,t,a){t===this.obj&&$.e(this).trigger("search/spam",[t,a])},updateRowNotspam:function(e,t,a,i){t===this.obj&&$.e(this).trigger("search/notspam",[t,a,i])},init:function(){this.updateRowReadFn=_zm.bindFn(this.updateRowRead,this),this.updateRowUnreadFn=_zm.bindFn(this.updateRowUnread,this),this.updateFlagRowFn=_zm.bindFn(this.updateFlagRow,this),this.updateRowDeleteFn=_zm.bindFn(this.updateRowDelete,this),this.updateLabelRowFn=_zm.bindFn(this.updateLabelRow,this),this.updateRowMoveFn=_zm.bindFn(this.updateRowMove,this),this.updateRowArchiveFn=_zm.bindFn(this.updateRowArchive,this),this.updateRowUnarchiveFn=_zm.bindFn(this.updateRowUnarchive,this),this.updateRowSpamFn=_zm.bindFn(this.updateRowSpam,this),this.updateRowNotspamFn=_zm.bindFn(this.updateRowNotspam,this),$.subscribe("mail/read",this.updateRowReadFn),$.subscribe("mail/unread",this.updateRowUnreadFn),$.subscribe("mail/flag",this.updateFlagRowFn),$.subscribe("mail/delete",this.updateRowDeleteFn),$.subscribe("mail/label",this.updateLabelRowFn),$.subscribe("mail/move",this.updateRowMoveFn),$.subscribe("mail/archive",this.updateRowArchiveFn),$.subscribe("mail/unarchive",this.updateRowUnarchiveFn),$.subscribe("mail/spam",this.updateRowSpamFn),$.subscribe("mail/notspam",this.updateRowNotspamFn)},unsubscribe:function(){$.unsubscribe("mail/read",this.updateRowReadFn),$.unsubscribe("mail/unread",this.updateRowUnreadFn),$.unsubscribe("mail/flag",this.updateFlagRowFn),$.unsubscribe("mail/delete",this.updateRowDeleteFn),$.unsubscribe("mail/label",this.updateLabelRowFn),$.unsubscribe("mail/move",this.updateRowMoveFn),$.unsubscribe("mail/archive",this.updateRowArchiveFn),$.unsubscribe("mail/unarchive",this.updateRowUnarchiveFn),$.unsubscribe("mail/spam",this.updateRowSpamFn),$.unsubscribe("mail/notspam",this.updateRowNotspamFn)}},window.msSearchRowModel=e}(),function(){function e(e){this.model=e&&e.model,this.type=e&&e.type,this.parent=e&&e.parent,this.$el=void 0}e.prototype={constructRow:function(){var e,t;return"m"===this.type&&(t=zmInit.constructMailRow("",[this.model.obj]),e=$.e(t.querySelectorAll(".zmL")[0]),this.$el=e,this.subscribe()),this.$el},subscribe:function(){$.e(this.model).on("search/read",_zm.bindFn(this.mailRead,this)),$.e(this.model).on("search/unread",_zm.bindFn(this.mailUnread,this)),$.e(this.model).on("search/flag",_zm.bindFn(this.flagMail,this)),$.e(this.model).on("search/delete",_zm.bindFn(this.deleteMail,this)),$.e(this.model).on("search/label",_zm.bindFn(this.labelMail,this)),$.e(this.model).on("search/move",_zm.bindFn(this.moveMail,this)),$.e(this.model).on("search/archive",_zm.bindFn(this.archiveMail,this)),$.e(this.model).on("search/unarchive",_zm.bindFn(this.unarchiveMail,this)),$.e(this.model).on("search/spam",_zm.bindFn(this.markMailSpam,this)),$.e(this.model).on("search/notspam",_zm.bindFn(this.markMailNotspam,this))},clearAll:function(){this.model.unsubscribe()},mailRead:function(e,t,a){var i,r={};i={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?r.trElem=this.$el:"thd"===a&&(r.thdElem=this.$el),this.$el.next().hasClass("zmTV")?r.thdContainer=this.$el.next():r.thdContainer=$.q(""),r.msgId=t,r.hdrId=this.parent.elemObj.hdrId+"S"+t,zmsearcActions.mailRead(a,r,i)},mailUnread:function(e,t,a){var i,r={};i={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?r.trElem=this.$el:"thd"===a&&(r.thdElem=this.$el),r.thdContainer=$.q(""),r.msgId=t,r.hdrId=this.parent.elemObj.hdrId+"S"+t,zmsearcActions.mailUnread(a,r,i)},flagMail:function(e,t,a,i){var r,s={};r={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?s.trElem=this.$el:"thd"===a&&(s.thdElem=this.$el),this.$el.next().hasClass("zmTV")?s.thdContainer=this.$el.next():s.thdContainer=$.q(""),s.msgId=t,s.hdrId=this.parent.elemObj.hdrId+"S"+t,s.prevElem=this.parent.prevElem,zmsearcActions.flagMail(a,i,s,r)},deleteMail:function(e,t,a,i){var r,s={};r={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?s.trElem=this.$el:"thd"===a&&(s.thdElem=this.$el),this.$el.next().hasClass("zmTV")?s.thdContainer=this.$el.next():s.thdContainer=$.q(""),s.msgId=t,s.hdrId=this.parent.elemObj.hdrId+"S"+t,s.prevElem=this.parent.prevElem,zmsearcActions.deleteMail(a,i,s,r),this.parent.collection.deleteFromList(t),this.parent.setEmptyListing()},labelMail:function(e,t,a,i){var r,s={};r={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?s.trElem=this.$el:"thd"===a&&(s.thdElem=this.$el),this.$el.next().hasClass("zmTV")?s.thdContainer=this.$el.next():s.thdContainer=$.q(""),s.msgId=t,s.hdrId=this.parent.elemObj.hdrId+"S"+t,s.prevElem=this.parent.prevElem,zmsearcActions.labelMail(a,i,s,r)},moveMail:function(e,t,a,i){var r,s={};if(r={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?s.trElem=this.$el:"thd"===a&&(s.thdElem=this.$el),this.$el.next().hasClass("zmTV")?s.thdContainer=this.$el.next():s.thdContainer=$.q(""),s.msgId=t,s.hdrId=this.parent.elemObj.hdrId+"S"+t,s.prevElem=this.parent.prevElem,i.folderArr=this.parent.collection.folderArr,i.folId===zmail.folId.tId){zmsearcActions.deleteMail(a,1,s,r),this.parent.collection.deleteFromList(t),this.parent.setEmptyListing()}else zmsearcActions.moveMail(a,i,s,r),i.folderArr[0]&&i.folderArr[0]!==i.folId&&(this.parent.collection.deleteFromList(t),this.parent.setEmptyListing())},archiveMail:function(e,t,a){var i,r={};i={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?r.trElem=this.$el:"thd"===a&&(r.thdElem=this.$el),r.thdContainer=$.q(""),r.msgId=t,r.hdrId=this.parent.elemObj.hdrId+"S"+t,zmsearcActions.archiveMail(a,r,i)},unarchiveMail:function(e,t,a){var i,r={};i={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?r.trElem=this.$el:"thd"===a&&(r.thdElem=this.$el),r.thdContainer=$.q(""),r.msgId=t,r.hdrId=this.parent.elemObj.hdrId+"S"+t,zmsearcActions.unarchiveMail(a,r,i)},markMailSpam:function(e,t,a){var i,r={};i={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?r.trElem=this.$el:"thd"===a&&(r.thdElem=this.$el),r.thdContainer=$.q(""),r.msgId=t,r.hdrId=this.parent.elemObj.hdrId+"S"+t,r.prevElem=this.parent.prevElem,zmsearcActions.spamAction(a,r,i),this.parent.collection.deleteFromList(t),this.parent.setEmptyListing()},markMailNotspam:function(e,t,a,i){var r,s={};r={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===a?s.trElem=this.$el:"thd"===a&&(s.thdElem=this.$el),s.thdContainer=$.q(""),s.msgId=t,s.hdrId=this.parent.elemObj.hdrId+"S"+t,s.prevElem=this.parent.prevElem,zmsearcActions.notspamAction(a,i,s,r),this.parent.collection.deleteFromList(t),this.parent.setEmptyListing()}},window.msSearchRowView=e}(),window.zmsearcActions=function(){var h=function(e,t){var a=zmInit.findFolName(t),i="",r=e.msgId;i=zmUtil.getMailObj(r,"AR")?a+" (ARCHIVED)":a,e.trElem&&e.trElem.length&&e.trElem.find(".zmFdr span").text(a),$.q("#zmHdrS"+r+" .js-fnHolder").text(i),e.thdElem&&e.thdElem.length&&(e.thdElem.find(".zmFdr span").text(a),e.thdContainer&&e.thdContainer.length&&e.thdContainer.find(".zmFdr span").text(a))},F=function(e,t,a){var i=[];return zmUtil.getListMap(t)?i=zmList.getListForAllMailsView(a,t):i.push(e),i};return{rmDuplicateLabel:function(e,t,a){for(var i,r,s,n=e.toString().split(","),l=n.length,o=[],c=0;c<l;c++){if(s=n[c],i=!1,r=zmUtil.getMailObj(s,"TAG"))for(var h in r)if(r[h]===t){i=!0;break}i||o.push(s)}return o},mailRead:function e(t,a,i){var r,s,n,l,o,c,h=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;if(r=a.trElem,c=a.thdElem,s=a.thdContainer,o=a.msgId,"msg"===t)r.removeClass("zm_urd"),s.hasClass("zmTV")&&(s.children("div").hasClass("zm_urd")||s.prev().removeClass("zm_urd")),$.q("#"+a.hdrId).find(".zmPT").removeClass("zm_urd");else if("thd"===t)for(var d in c.removeClass("zm_urd"),s.children("div").removeClass("zm_urd"),(l=$.extend({},i)).view="all",n=F(o,zmUtil.getMailObj(o,"T"),l)){var m=$.extend({},a);m.msgId=n[d],m.trElem=h.find("#"+n[d]),m.thdElem=$.q(""),m.thdContainer=$.q(""),e("msg",m,i)}var u=zmUtil.getMailObj(o,"T");"msg"===t&&u&&zmInit.checkThreadRead(u)&&(0<s.length?s.prev().removeClass("zm_urd"):$.q("#zmListing .zmSLst").removeClass("zm_urd"))},mailUnread:function e(t,a,i){var r,s,n,l,o,c,h=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;if(s=a.trElem,r=a.thdElem,n=a.thdContainer,c=a.msgId,"msg"===t)s.addClass("zm_urd"),n.hasClass("zmTV")&&n.children("div").hasClass("zm_urd")&&n.prev().addClass("zm_urd"),$.q("#"+a.hdrId).find(".zmPT").addClass("zm_urd");else if("thd"===t)for(var d in r.addClass("zm_urd"),n.children("div").addClass("zm_urd"),(o=$.extend({},i)).view="all",l=F(c,zmUtil.getMailObj(c,"T"),o)){var m=$.extend({},a);m.msgId=l[d],m.trElem=h.find("#"+l[d]),m.thdElem=$.q(""),m.thdContainer=$.q(""),e("msg",m,i)}},flagMail:function e(t,a,i,r){var s,n,l,o,c,h,d,m,u=zmInit.flgClass(a);if(o=i.trElem,l=i.thdElem,c=i.prevElem,h=i.msgId,m=zmUtil.getMailObj(h),"msg"===t){var p,f;m.TH&&0!==zmail.folviewThread&&(p=(d=zmList.getListForAllMailsView(r,m.T))[0],f=$.q("#t"+p),zmmailAct.updateFlagStatusforThd(p,m.NFG,a),s=zmInit.getThdFlagvalue(p),n=zmInit.flgClass(s),f.find(".zmflg").removeClass().addClass(n)),o.find(".zmflg").removeClass().addClass(u),c.attr("data-mid")===h&&$.q("#"+i.hdrId).find(".zmflg").removeClass().addClass(u)}else if("thd"===t){var g,z,v,S=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;for(v=m.T,g=(d=F(h,v,r)).length,z=0;z<g;z++){var b=$.extend({},i);b.msgId=d[z],b.trElem=S.find("#"+d[z]),b.thdElem=$.q(""),b.thdContainer=$.q(""),e("msg",a,b,r)}l.find(".zmflg").removeClass().addClass(u)}},deleteMail:function(e,t,a,i){var r,s,n,l,o,c;s=a.trElem,r=a.thdElem,n=a.thdContainer,l=a.prevElem,o=a.msgId,c=zmUtil.getMailObj(o),"msg"===e?(h(a,zmail.folId.tId),c.T&&(c.FD===zmail.folId.dId&&zmUtil.removeDraftMapping(o),function(e,t,a,i){var r,s,n,l,o=zmList.getListForAllMailsView(i,zmUtil.getMailObj(e,"T"));if(r=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el,1<o.length){var c=(s=r.find("#"+o[0]).parent()).prev().find(".zmtCt");t===zmail.folId.tId&&(l=c,(n=o).length<=100?l.text(n.length-1):l.text("99+"),"1"===c.text()&&(s.prev().find(".zm_td").remove(),s.prev().removeClass("zmTLst"),s.remove()))}else 1===o.length&&(zmPrev.clsPreview(),r.find("#t"+o[0]).remove());r.find("#"+e).remove()}(o,zmail.folId.tId,c.FD,i)),5!==t&&c.FD===zmail.folId.tId&&(t=5),l.attr("data-mid")===o&&zmPrev.updatePrevOnDeletion(o,"zm_srch1"),c.TH||s.remove(),5===t&&$.publish("/mail/msgDiscarded",[{draftId:o,actionType:"discard_draft"}]),zmContentCache.remove(o)):"thd"===e&&(r.remove(),n.remove(),l.attr("data-mid")===o&&zmPrev.updatePrevOnDeletion(o,"zm_srch1")),"msg"===e&&zmPreviewTemplate.updateMailHeaderView(o)},moveMail:function(e,t,a,i){var r,s,n,l,o;r=t.folId,s=a.msgId,l=t.folderArr?t.folderArr[0]:"",(n=a.trElem).removeClass("zmarch"),o=a.prevElem,h(a,r),"msg"===e&&(zmPreviewTemplate.updateMailHeaderView(s),l&&l!==r&&(n.remove(),o.attr("data-mid")===s&&zmPrev.clsPreview()))},labelMail:function e(t,a,i,r){var s,n,l,o,c,h,d,m;if(s=i.thdElem,l=i.msgId,o=a.lA,c=a.lId,d=zmUtil.getMailObj(l),"msg"===t)d.TH&&0!==zmail.folviewThread&&(m=(n=zmList.getListForAllMailsView(r,d.T))[0],s=s&&s.length?s:$.q("#t"+m),zmmailAct.updateLabelsforThd(m,[c],o));else if("thd"===t){var u,p,f,g=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;for(p=d.T,u=(n=F(l,p,r)).length,h=0;h<u;h++)if(f=zmUtil.getMailObj(n[h]),"deleteall"===o&&f.TAG||"add"===o&&(!f.TAG||-1===$.inArray(c,f.TAG))||"delete"===o&&$.inArray(c,0<=f.TAG)){var z=$.extend({},i);z.msgId=n[h],z.trElem=g.find("#"+n[h]),z.thdElem=$.q(""),z.thdContainer=$.q(""),e("msg",a,z,r)}}zmPreviewTemplate.refreshLabelsForMail(l,s)},archiveMail:function(e,t,a){var i,r,s;i=t.msgId,r=zmUtil.getMailObj(i,"FD"),s=t.trElem,h(t,r),"msg"===e&&s.addClass("zmarch")},unarchiveMail:function(e,t,a){var i,r,s;i=t.msgId,r=zmUtil.getMailObj(i,"FD"),s=t.trElem,h(t,r),"msg"===e&&s.removeClass("zmarch")},spamAction:function(e,t,a){var i,r,s,n,l,o;i=zmail.folId.spId,r=t.msgId,n=t.trElem,s=t.thdElem,l=t.thdContainer,o=t.prevElem,"msg"===e?(h(t,i),o.attr("data-mid")===r&&zmPrev.clsPreview(),n.remove(),zmContentCache.remove(r)):"thd"===e&&(s.remove(),l.remove(),o.attr("data-mid")===r&&zmPrev.updatePrevOnDeletion(r,"zm_srch1"))},notspamAction:function(e,t,a,i){var r,s,n,l,o,c;s=a.msgId,n=a.trElem,o=a.thdElem,c=a.thdContainer,l=a.prevElem,"msg"===e?(r=t[0].folId,h(a,r),n.remove(),l.attr("data-mid")===s&&zmPrev.clsPreview(),zmContentCache.remove(s)):"thd"===e&&(o.remove(),c.remove(),zmPrev.clsPreview())}}}(),window.zmStreamSearch=function(){var s=zmText.get("search");function e(e){this.searchQueryArr=[],this.searchList={},this.searchOrder=[],this.hasNext=void 0,this.range=25,this.sending=!1,this.entityType=e.entityType||-1}function t(){}e.prototype={setSearchQueryArr:function(e){this.searchQueryArr=e},getSearchType:function(){return"zmStreamsApp"},addSearchList:function(e){var t,a;e&&e.order.length>this.range?(this.hasNext=1,e.order.pop()):this.hasNext=0,$.extend(this.searchList,e.list),this.searchOrder.length?(t=this.searchOrder.length,this.searchOrder=this.searchOrder.concat(e.order)):(t=0,this.searchOrder=e.order),a=this.searchOrder.length,this.from=a+1,$.e(this).trigger("search/listUpdated",[t,a])},deleteFromList:function(e){var t;-1!==(t=this.searchList.indexOf(e))&&this.searchList.splice(t,1),this.searchList.length<this.range&&this.sendRequest()},getSearchParams:function(){var e,t={};return(e=this.searchQueryArr[0]).Summary?t.summary=e.Summary:e["Attachment Name"]?t.attachname=e["Attachment Name"]:e["Attachment Content"]?t.attachContent=e["Attachment Content"]:t.SearchStr=encodeURIComponent(e.All),t},sendRequest:function(){var e,t,a={},i=this;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.searchQueryArr)&&(this.sending=!0,e=this.searchOrder.length,a.start=e,a.actionType="viewSelfData",a.mode="searchStreams",a.grid="false",a.range=this.range,a.entityType=this.entityType,a.groupId=zmail.zuid,a.streamsView="true",t=function(){var t=$.Deferred();return zmAjq.XHR({u:zmail.conPath+"/stream.do",t:"POST",fn:function(e){t.resolve(e)},p:a,csr:"s"}),t.promise()},$.extend(a,this.getSearchParams()),$.when(t(),zmUtil.loadStreams()).done(function(e){i.searchResponse(e)}))},searchResponse:function(e){this.sending=!1,this.addSearchList(e)},flushData:function(){this.hasNext=1,this.from=1,this.searchList=[]},getSearchVal:function(){for(var e in this.searchQueryArr[0])return this.searchQueryArr[0][e]}};var a={updateListing:function(e,t,a){var i,r;r=this.collection.searchList,i=this.collection.searchOrder.slice(t,a),this.loadingBandFn(),0===t&&(this.listElem.html(""),this.listElem.scrollTop(0),0===a&&this.listElem.html(zmInit.emptyRow(s.emptyResults))),zmStreamsApp.PostApp.searchView({order:i,list:r},this.listElem[0])},getHeaderObj:function(){return{left:{leftHTML:s.stream.resultsHeader},right:[]}},setCSSToCenterDOM:function(){zmsuite.getCenter()[0].$el.addClass("zms_streams")}};return t.prototype=Object.create(SearchOuterView.prototype),$.extend(t.prototype,a),{streamCollection:e,streamView:t}}(),function(){function e(e){this.searchQueryArr=[],this.advSearchStr=e&&e.advSearchStr||"",this.searchList={},this.searchOrder=[],this.hasNext=1,this.limit=20,this.sending=!1}function t(){}e.prototype={setAdvSearchStr:function(e){this.advSearchStr=e},getAdvSearchStr:function(){return this.advSearchStr},setSearchQueryArr:function(e){var t;this.searchQueryArr=e,t=this.getSearchQueryFromArr(this.searchQueryArr),this.setAdvSearchStr(t)},addSearchList:function(e){var t,a;e.order||(e.order=[]),e.list||(e.list={}),e.order.length>this.limit?this.hasNext=1:this.hasNext=0,$.extend(this.searchList,e.list),this.searchOrder.length?(t=this.searchOrder.length,this.searchOrder=this.searchOrder.concat(e.order)):(t=0,this.searchOrder=e.order),a=this.searchOrder.length,this.from=a,$(this).trigger("search/listUpdated",[t,a])},deleteFromList:function(e){var t;-1!==(t=this.searchList.indexOf(e))&&this.searchList.splice(t,1),this.searchList.length<20&&this.sendRequest()},sendRequest:function(){var e,t,a,i={},r={load:"taskapp"},s=this;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)&&(this.sending=!0,e=this.searchOrder.length||0,i.start=e,i.limit=this.limit,i.search=this.getAdvSearchStr(),i.taction="searchTasks",i.isPrev="false",i.actionType="appView",i.streamsView=!0,i.groupId=zmail.zuid,i.entityType=3,t=function(){var t=$.Deferred();return zmAjq.XHR({u:zmail.conPath+"/taskView.do",t:"POST",fn:function(e){t.resolve(e)},p:i,csr:"s"}),t.promise()},a=function(){var e=$.Deferred();return zmUtil.loadTask(r,function(){e.resolve()}),e.promise()},$.when(t(),a()).done(function(e){s.searchResponse(e)}))},searchResponse:function(e){this.sending=!1,this.addSearchList(e)},flushData:function(){this.hasNext=1,this.from=0,this.searchList=[]},getSearchQueryFromArr:function(){return this.searchQueryArr[0].taskStr},getSearchVal:function(){return this.searchQueryArr[0].taskStr}};var a={updateListing:function(e,t,a){var i,r,s,n,l,o,c=[];for(n=this.collection.searchList,r=(s=this.collection.searchOrder).length,zmSearch.taskObj&&zmSearch.taskObj.deleteSubscribers&&zmSearch.taskObj.deleteSubscribers(),zmSearch.taskObj=zmTask._list.constructList({order:s,list:n},void 0,"zm_srch1"),this.loadingBandFn(),0===t&&(this.listElem.html(""),this.listElem.scrollTop(0),0===a&&this.listElem.html(zmInit.emptyRow(zmText.get("search","emptyResults")))),this.limit<r&&(r=this.limit),i=0;i<r;i++)$(c[i]).data("data-model",n[s[i]]),l=n[s[i]].NMSPID,o=n[s[i]].TASKID,this.listElem.append(zmSearch.taskObj.centerListingObj[l][o].listingEl)},getHeaderObj:function(){return{left:{leftHTML:zmText.get("search","task.resultsHeader")},right:[]}},bind:function(){var e;(e=zmsuite.getCenter()[0].getNodes()[2]).setListener("click",function(e){zmSearch.taskObj.listClickHandler(e)}),e.setListener("contextmenu",function(e){zmSearch.taskObj.contextMenuHandler(e,"search")}),$.subscribe("search/closeTab",function(e){zmSearch.taskObj&&zmSearch.taskObj.deleteSubscribers()})}};t.prototype=Object.create(SearchOuterView.prototype),$.extend(t.prototype,a),window.zmTaskSearch={taskCollection:e,taskView:t}}();