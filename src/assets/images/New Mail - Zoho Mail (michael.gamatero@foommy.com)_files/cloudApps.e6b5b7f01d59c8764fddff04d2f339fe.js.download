"use strict";(window.zmCloudAtt=window.zmCloudAtt||{}).attConst={ZOHOTEAMDRIVE:5},function(e){var l;e.core={};var u=zmText.get("cloudApps");function n(e,t){this.cloudAttTemp=[],this.appName=e,this.attRef=t,this.appType="",this.uniqueId=0}function m(e){var t=this,n=[];if(e){for(var i=0;i<e.fileList.length;i++){var o=e.fileList[i];o.uid=t.uniqueId+1,t.uniqueId+=1,t.cloudAttTemp.push(o),n.push(o)}t.appType=e.appType,t.appId=e.appId,t.prependAttach&&(t.attachmentSection=e.attachmentSection,t.onRemove=e.onRemove,t.onAddAtt=e.onAddAtt)}t.attRef.configJSON.offlineUpload||t.addAttachments.call(this,n)}function o(e,t){var n=this.cloudAttTemp.indexOf(_.findWhere(this.cloudAttTemp,{uid:e}));0<=n&&(this.cloudAttTemp.splice(n,1),t&&(this.attachmentSection?zmAttachUtility.removeAttachments(t,"teamdrive"):t.remove()),this.onRemove())}function f(t,n){var i=this;t.off("click").on("click",function(e){$.e(e.target).hasClass("closeIcon")?o.call(i,n.uid,t):window.open(n.link,"_blank")})}function i(i,e){var t=$.e(e),n=[{txt:u.workDrive.preview.sendMail,data:{action:"attachToMail"}},{txt:u.workDrive.preview.attachInPost,data:{action:"attachToPost"}}];$.e(e).closest(".zmL, .zmAch").addClass("sel"),$.e(e).addClass("active");var o={divId:"cloudAttachMenu",par:t,parWidth:!0,list:n,clk:function(e,t){!function(e,t){var n=e.action;switch(l.remove(),n){case"attachToMail":zmUtil.openComposeWithAtt([i]),zmUtil.hideMenu();break;case"attachToPost":zmUtil.loadNewPostDialog("",[i]),zmUtil.hideMenu()}}(e)},onHide:function(){$.e(e).parents(".zmL.zmAch").removeClass("sel"),$.e(e).removeClass("active")},showArrow:!0};if(zmUtil.isChildWindow()){var a=new zmDropDownMenu;a.setDropObj(o),a.paint(),l=a}else l=zmsuite.showMenu(o)}$.subscribe("cloudAtt/dropRemove",function(){l&&l.remove()}),n.prototype={init:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this,e="rhs";n.prependAttach=t.prependAttach;var i=function(e){n.attachmentSection=t.attachmentSection,n.onRemove=t.onRemove,n.onAddAtt=t.onAddAtt,m.call(n,e)},o=zmail.Settings.MailSuite.Settings.Integration.Constants.ZOHOTEAMDRIVE;if(n.attRef.configJSON.appTypePopup&&(e="popup"),t.prependAttach){var a,l=t.files||{};a={appType:l.appType,appId:l.appId,attachmentSection:t.attachmentSection,onRemove:t.onRemove,onAddAtt:t.onAddAtt};var s=void 0!==l.shT?l.shT:l.shType;!l.attType&&l.fileList?a.fileList=l.fileList:l.attType||l.fileList?a.fileList=[{fileName:l.fn,link:l.cloudLink,shareType:s}]:a.fileList=[{fileName:l.fName,link:l.cloudLink,shareType:s}],m.call(n,a)}else"undefined"==typeof ZMWidgets?zmUtil.loadExtensions(function(){ZMWidgets.renderAttachComp(o,i,e)}):ZMWidgets.renderAttachComp(o,i,e)},getCloudAttachments:function(){for(var e,t=this.cloudAttTemp,n=[],i=0;i<t.length;i++)e=t[i],n.push({fName:e.fileName,cloudLink:e.link,appId:this.appId,appType:this.appType,shType:e.shareType});return n},removeAllCloudAtt:function(){var e=this,t=_zm.copyOf(e.cloudAttTemp);e.attachmentSection?e.attRef.$ele.find(".attSec_teamdrive").remove():e.attRef.$ele.find(".cloudAttTemp").remove();for(var n=0;n<t.length;n++)o.call(e,t[n].uid)},getCloudLinkHTML:function(){var e=_zm.copyOf(this.getCloudAttachments()),t=zdom("div",{className:"zmCloudLink"});return t.appendChild(zdom("br",null)),t.appendChild(zmCloudAtt.templates.getCloudLink(e)),t},addAttachments:function(e){var t=this.attRef.configJSON.offlineUpload;if(function(){var e=this.attRef.componentId||"";return"mail"===e||0<=e.indexOf("zmEdi_")}.call(this)&&zmComp&&!t){var n=this.attRef.componentId.split("_")[1];if("plaintext"===zmComp.getEditor(n).mode)return zmUtil.succErrMsg("e",zmText.applyArgs(u.workDrive.message.plainTextErr,{appname:"WorkDrive"})),!1}for(var i,o,a,l=zmCloudAtt.templates,s=e,m=this.attRef.$ele,d=this,c="task"===d.attRef.componentId,r="notes"===d.attRef.componentId,p=0;p<s.length;p++)i=s[p],a=zmUtil.fileTyp(i.fileName,zmAttachUtility.fileType.hugeAttachment),o=l.workDriveTemp({fn:i.fileName,cls:a[1],shType:i.shareType}),f.call(d,$.e(o),i),d.attachmentSection?(zmAttachUtility.appendAttachments(o,m,"teamdrive",d.attRef),o.scrollIntoView()):(c||$.e(o).addClass("zmAch attachment"),m.appendDOM(o)),r||c?d.onAddAtt({fName:i.fileName,cloudLink:i.link,appId:d.appId,appType:d.appType,shType:i.shareType},o,"cloudAttachment"):d.onAddAtt()},clearCloudAttachments:function(){this.cloudAttTemp=[],this.appName="",this.attRef="",this.appType="",this.appId="",this.uniqueId=0}},e.init=function(e,t){return new n(e,t)},e.core.getPreviewHeader=function(e,t){return zmCloudAtt.templates.previewHeader(zmText.applyArgs(u.workDrive.compose.header,{num:e}),t)},e.core.getPreviewContent=function(t){var e=zmUtil.fileTyp(t.fn,zmAttachUtility.fileType.hugeAttachment),n=zmCloudAtt.templates.previewContent({fn:t.fn,fs:t.fs,cls:e[1],className:t.className});return $.e(n).find(".view").off("click").on("click",function(e){e.stopPropagation(),window.open(t.cloudLink,"_blank")}),$.e(n).find(".copyLink").unbind("click").bind("click",function(e){e.stopPropagation(),function(e){var t=u.workDrive.preview;if(zmComponent.clipBoardAPI.isSupported())zmComponent.clipBoardAPI.setData(e,{type:"text",onSuccess:function(){zmUtil.succErrMsg("s",t.copyLink)}});else{var n={title:t.title,$content:require("zmAttachment").templates.showCopyLink(e),dialogWillMount:function(e){setTimeout(function(){$.e(e.$els.$contentWrapper).find("input").select()},500),$.e(e.$els.$content).filter(".SC_PUcen").css({"font-size":"13px",color:"grey"})}};require("Dialog").new(n)}}(t.cloudLink)}),$.e(n).find(".moreAction").unbind("click").bind("click",function(e){_zm.stopEvents(e),zmAttach.util.removeMAct(),i(t,$.e(this))}),$.e(n).off("click").on("click",function(e){window.open(t.cloudLink,"_blank")}),n},e.core.initWDOnboarding=function(e){var t="1"===zmAdHocSettings.getHugeAttOnBoarding()||!zmUtil.isHugeAttachmentUploadEnabled();if("0"===zmAdHocSettings.getWorkdriveInteg()&&t&&_zm.isTeamDriveEnabled()){$.q("body").appendDOM(zmAttachment.templates.transparentMask());var n=e.toolbardiv,i=$.e(n).find(".zei-workDrive"),o=$.q("body").find(".transMask"),a=zmCloudAtt.templates.cloudOnBoarding();$.e(a).find(".saveBtn").unbind().bind("click",function(){zmUtil.hideMenu()}),$.e(a).find(".closeIcon").unbind().bind("click",function(){zmUtil.hideMenu()}),$.e(a).find(".lrnBtn").unbind().bind("click",function(){zmUtil.hideMenu(),window.open(window.location.protocol+"//www."+zmail.zohoUrl+"/mail/help/zohomail-workdrive-integration.html","_blank")});var l,s={par:i,showArrow:!0,loadHTML:!0,htm:a,divId:"workOnboard",spanClass:"minwid fadeIn",arrowPosition:"left",onHide:function(){zmAdHocSettings.setWorkdriveInteg("1"),$.e(n).parent().find(".highEle").remove(),$.e(n).removeClass("zmHighlightIcons"),$.e(i).removeClass("zmHighlightIcon pulseIcon"),$.e(o).remove(),$.publish("compose/focusTo",{type:"cloudOnboard"})}};(zmUtil.isChildWindow()||zmail.isComposeMail)&&(s.direction="left"),(l=new zmDropDownMenu).setDropObj(s),l.paint(),$.e(o).on("click",function(e){e.stopPropagation()}),zmail.isComposeMail&&($.e(o).keydown(function(e){27===e.keyCode&&zmUtil.hideMenu()}),$.e(o).focus())}}}(window.zmCloudAtt=window.zmCloudAtt||{}),function(e){e.templates=e.templates||{};var s=zmText.get("cloudApps"),a=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.fileSize?e.fileSize:0,n=e.appType+"#"+e.shType+"#"+t+"#"+e.appId;return window.btoa(n)};$.extend(e.templates,{workDriveTemp:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.fn,n=zmUtil.getSubString(20,t),i=e.cls+" zm-attIcn",o=function(e){e=String(e);var t=s.workDrive.shareType,n=t.pvt;switch(e){case"0":n=t.pvt;break;case"1":n=t.public;break;case"2":n=t.org;break;case"3":n=t.team}return n}(e.shType),a=e.fileSize?zdom("li",{className:"SCtxt"},zdom("b",null,zdom("span",{className:"sum fileSize"},e.fileSize))):[];return zdom("div",{className:"zmL SC_Pbar noHvr cloudAttTemp"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze zmOpt showOpt"},zdom("div",{className:"SCmb"},zdom("ul",null,a,zdom("li",{className:"SCtxt SC_ldot optParent"},zdom("b",null,zdom("span",{className:"sum SC_thm changeOpt"},o)))))),zdom("div",{className:"zmFrm"},zdom("span",{"data-name":"filename",className:"attachTitle","data-tooltip":t},n)),zdom("div",{className:"zmImg"},zdom("i",{className:i})),zdom("div",{className:"SC_icn closeIcon"},zdom("i",{className:"msi-close closeIcon"})))))},previewHeader:function(e,t){var n=t.showToggleOpt?zdom("i",{className:"msi-zmPle expandCollapse"}):[];return zdom("div",{className:"zmAttHdr"},n,zdom("b",null,zdom("span",{className:"cloudHeader"},e)))},getCloudLink:function(){for(var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n={"text-decoration":"none",margin:"0px","font-size":"14px","font-family":"Arial, sans-serif",color:"rgb(0, 114, 198)"},i=zdom("fragment",null),o=0;o<t.length;o++)e=t[o],i.appendChild(zdom("a",{"data-cloud-meta":a(e),style:n,href:e.cloudLink,target:"_blank",rel:"noopener noreferrer"}," ",e.fName));return i},previewContent:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.fn.lastIndexOf("."),n=e.fn,i="";-1!==t&&(n=e.fn.substring(0,t),i=e.fn.substring(t,e.fn.length));var o=s.workDrive.preview,a=e.fs&&"0"!==e.fs?e.fs:"",l=e.className||"zmAch sel";return zdom("div",{className:"zmL "+l},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg"},zdom("i",{className:e.cls+" zm-attIcn"})),zdom("div",{className:"zmFrm"},zdom("span",{"data-tooltip":e.fn,className:"attachTitle zmAttTitle"},zdom("span",null,n),zdom("span",null,i))),zdom("div",{className:"zmSze"},zdom("span",{className:"sum fileSize"},a)),zdom("div",{className:"zmSub"},zdom("span",{className:"view"},o.view),zdom("span",{className:"copyLink"},o.copylink)))))},cloudOnBoarding:function(){var e=s.workDrive.onboard;return zdom("fragment",null,zdom("ul",{className:"zmListReset"},zdom("li",null,zdom("div",{className:"zmWDOnboard"},zdom("div",{className:"zmWDOBImg"}),zdom("div",{className:"zmWDOBTxt"},zdom("p",null,e.sub1,zdom("br",null),zdom("b",null,e.sub2)," "," "+e.sub3+" ",zdom("br",null),e.sub4),zdom("div",{className:"zmBtnWra"},zdom("span",{className:"zmLink lrnBtn"},e.lrnmre),zdom("div",{className:"zmBtnGroup"},zdom("div",{className:"zmBtn thmBgBtn saveBtn"},e.gtit))))))),zmAttachment.templates.closeIcon())}},!0)}(window.zmCloudAtt=window.zmCloudAtt||{});