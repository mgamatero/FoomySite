"use strict";define([],function(v){var C={init:function(){var i=v("zmText"),t=v("_zm"),e=v("zmUtil"),o=v("zmAppLoader"),n=!1,r="zei-bold",a="zei-italic",l="zei-underline",s="zei-strike",d="zei-textclr",m="zei-textleft",c="zei-unorder",u="zei-removeformat",f="zei-smiley";"MacIntel"===navigator.platform&&(n=!0);var g=function(t,e,o){return i.get("editorInteg",t,e,o)};C.staticVersion=zmail.editorStatic||"v53";var p={bold:g("tooltip.bold"),italic:g("tooltip.italic"),underline:g("tooltip.underline"),strike:g("tooltip.strikethrough"),font:g("tooltip.font"),size:g("tooltip.fontSize"),fontColor:g("tooltip.fontColor"),bgColor:g("tooltip.backgroundColor"),align:g("tooltip.alignOptions"),list:g("tooltip.listOptions"),image:g("tooltip.insertImage"),link:g("tooltip.insertLink"),quote:g("tooltip.insertQuote"),removeFormat:g("tooltip.removeFormatting"),table:g("tooltip.table"),smiley:g("tooltip.insertSmiley")};C.language=zmail.user.lang,C.needplaintext=!0,C.editorCSS=!0,C.inlineQuotes=!0,C.modeChange=e.modeChange,C.spellcheckURL=zmail.urls.spellcheckURL,C.spellcheckProxyUrl=zmail.conPath+"/ze",C.useSameDomain=!0,C.useProxy=!0,C.domain=document.domain,C.tabKeyHandling=!0,C.needEditorFocus=!1,C.needEditorBorder=!0,C.needResizeImage=!1,C.removeInsertOptions=!1,C.removeFontFamily=!1,C.removeFontSize=!1,C.iscsignature=zmail.icsSignature,C.defaultFontSize="10pt",C.defaultFontFamily="Arial,Helvetica,sans-serif",C.defaultFontColor="black",C.outGoingFontFamily="",C.outGoingFontSize="",C.outGoingColor="",zmail.isPrivilegedUser&&(C.allowZiaInteg=!0),C.serviceName="Mail";var h=window.location.protocol,z=zmPath.getCompletePath("default").domain.js;C.cssPath=C.imgPath=z+"/ze/"+C.staticVersion,C.jsPath=z+"/ze/"+C.staticVersion,C.jsStatic=z,C.toolbarOrder=[[["attach","Attachment","zei-attachment"]],[["bold",p.bold,r],["italic",p.italic,a],["underline",p.underline,l],["strikethrough",p.strike,s]],[["fontfamily",p.font,"zei-fontfamily"]],[["fontsize",p.size,"zei-arrow"]],[["forecolor",p.fontColor,d],["backcolor",p.bgColor,"zei-bgclr"]],[["alignoptions",p.align,m],["listoptions",p.list,c],["indentoptions",g("tooltip.indentOptions"),"zei-outdent"],["directionoptions",g("tooltip.directionOptions"),"zei-rtl"]],[["image",p.image,"zei-image"],["link",p.link,"zei-link"]],[["quote",p.quote,"zei-quote"],["removeformat",p.removeFormat,u]],[["table",p.table,"zei-table"],["inserthorizontalrule",p.hr,"zei-line"]],[["smiley",p.smiley,f]],[["otheroptions",g("tooltip.spellcheck"),"zei-arrow ze-big"]]],C.insertOptions=[["table",p.bold,"ze_tbl"],["inserthorizontalrule",p.hr,"ze_hr"],["object",g("tooltip.insertHtml"),"ze_obj"],["code",g("tooltip.insertCode"),"ze_icode"],["quote",p.quote,"ze_quote"]],C.align=[{htm:g(n?"macdropdown.alignLeft":"dropdown.alignLeft"),datAttr:"justifyleft"},{htm:g(n?"macdropdown.alignRight":"dropdown.alignRight"),datAttr:"justifyright"},{htm:g(n?"macdropdown.justify":"dropdown.justify"),datAttr:"justifyfull"},{htm:g(n?"macdropdown.alignCenter":"dropdown.alignCenter"),datAttr:"justifycenter"}],C.lineHeight=[{htm:g("dropdown.single"),datAttr:"singleInd"},{htm:g("dropdown.normal"),datAttr:"normalInd"},{htm:g("dropdown.medium"),datAttr:"mediumInd"},{htm:g("dropdown.double"),datAttr:"doubleInd"}],C.list=[{htm:g(n?"macdropdown.bullets":"dropdown.bullets"),datAttr:"insertunorderedlist"},{htm:g(n?"macdropdown.numbering":"dropdown.numbering"),datAttr:"insertorderedlist"}],C.formatingoptions=[{htm:g("tooltip.formatpainter"),datAttr:"formatpainter"},{htm:p.removeFormat,datAttr:"removeformat"}],C.scripts=[{htm:g(n?"mactooltip.superscript":"tooltip.superscript"),datAttr:"superscript"},{htm:g(n?"mactooltip.subscript":"tooltip.subscript"),datAttr:"subscript"}],C.indent=[{htm:g(n?"macdropdown.incIndent":"dropdown.incIndent"),datAttr:"indent"},{htm:g(n?"macdropdown.decIndent":"dropdown.decIndent"),datAttr:"outdent"}],C.others=[{htm:g("dropdown.plainText"),datAttr:"switchmode"}],C.fontfamily=[{htm:"Serif",ff:"serif"},{htm:"Arial",ff:"arial,helvetica,sans-serif"},{htm:"Courier",ff:"'courier new',courier,monospace"},{htm:"Georgia",ff:"georgia,times new roman,times,serif"},{htm:"Tahoma",ff:"tahoma,arial,helvetica,sans-serif"},{htm:"Times New Roman",ff:"'times new roman',times,serif"},{htm:"Trebuchet MS",ff:"'trebuchet ms',arial,helvetica,sans-serif"},{htm:"Verdana",ff:"verdana"},{htm:"Comic Sans MS",ff:"'Comic Sans MS'"},{htm:"Calibri",ff:"Calibri, Verdana, Arial, sans-serif"}],C.keyupTriggered=function(){},C._getFontFamily=function(){var t,e=C.fontfamily,o=C.fontfamily,i=zmAdHocSettings.getCustomFontFamilyList().split(",");if("0"!==i[0]&&""!==i[0].trim()){i.forEach(function(e){o.find(function(t){return t.htm===e})||({},t={htm:e,ff:e+",arial,helvetica"},C.fontfamily.push(t))});var n=[];(n=zmail.userOptions?zmail.userOptions.composeFonts.slice():["Serif","Arial","Courier","Georgia","Tahoma","Times New Roman","Trebuchet MS","Verdana","Comic Sans MS","Calibri"]).push(["systemFont"]),zmAdHocSettings.getCustomFontFamilyList().split(",").forEach(function(t){n.push(t)}),"customFontFamily"!==(e=C.fontfamily.filter(function(t){return-1!==n.indexOf(t.htm)}))[9].htm&&e.splice(10,0,{htm:"System Font",ff:"System Font"})}else e=C.fontfamily.slice(0,10);return e},C.fontsize=[{htm:"8",datAttr:"1"},{htm:"10",datAttr:"2"},{htm:"12",datAttr:"3"},{htm:"14",datAttr:"4"},{htm:"18",datAttr:"5"},{htm:"24",datAttr:"6"},{htm:"36",datAttr:"7"}],C.insertOptions=[["image",p.image,"ze_tim"],["smiley",p.smiley,"ze_tis"],["link",p.link,"ze_til"],["table",p.table,"ze_tbl"],["inserthorizontalrule",p.hr,"ze_hr"],["object",g("tooltip.insertHtml"),"ze_obj"],["code",g("tooltip.insertCode"),"ze_icode"],["quote",p.quote,"ze_quote"]],C.textDir=[{htm:g(n?"macdropdown.rightToLeft":"dropdown.rightToLeft"),datAttr:"rtl"},{htm:g(n?"macdropdown.leftToRight":"dropdown.leftToRight"),datAttr:"ltr"}],C.hideVisibleDropDown=function(){e.hideMenu(!0)},C.SmarttoolbarOrder=[[["fontfamily",p.font,"zei-arrow"]],[["fontsize",p.size,"zei-arrow"]],[["heading",g("tooltip.heading"),"zei-arrow"]],[["bold",p.bold,r],["italic",p.italic,a],["underline",p.underline,l],["strikethrough",p.strike,s]],[["forecolor",p.fontColor,d]],[["backcolor",p.bgColor,"zei-bgclr"]],[["removeformat",p.removeFormat,u]],[["link",p.link,"zei-link"]],[["alignoptions",p.align,m]],[["listoptions",p.list,c]]],C.Paragraphtoolbar=[[["heading",g("tooltip.heading"),"zei-arrow"]],[["alignLeft",g("dropdown.alignLeft"),m],["alignRight",g("dropdown.alignRight"),"zei-textright"],["alignCenter",g("dropdown.alignCenter"),"zei-textcenter"],["alignjustify",g("dropdown.justify"),"zei-textjustify"]],[["NumBullets",g("dropdown.bullets"),c],["DotBullets",g("dropdown.numbering"),"zei-order"]],[["LefttoRight",g("dropdown.rightToLeft"),"zei-rtl"],["RightToLeft",g("dropdown.leftToRight"),"zei-ltr"]]],C.insertToolbar=[[["quote",p.quote,"zei-quote"]],[["image",p.image,"zei-image"]],[["removeformat",p.removeFormat,u]],[["link",p.link,"zei-link"]],[["unlink",g("tooltip.removeLink"),"zei-unlink"]],[["tableGrid",p.table,"zei-table"]],[["inserthorizontalrule",p.hr,"zei-line"]],[["smiley",p.smiley,f]]],C.generalNotesToolbar=[[["attach","Attachment","zei-attachment"]],[["bold",p.bold,r],["italic",p.italic,a],["underline",p.underline,l],["strikethrough",p.strike,s]],[["fontfamily",p.font,"zei-fontfamily"]],[["fontsize",p.size,"zei-arrow"]],[["forecolor",p.fontColor,d],["backcolor",p.bgColor,"zei-bgclr"]],[["alignoptions",p.align,m],["listoptions",p.list,c],["indentoptions",g("tooltip.indentOptions"),"zei-outdent"],["directionoptions",g("tooltip.directionOptions"),"zei-rtl"]],[["image",p.image,"zei-image"],["link",p.link,"zei-link"]],[["quote",p.quote,"zei-quote"],["removeformat",p.removeFormat,u]],[["table",p.table,"zei-table"],["inserthorizontalrule",p.hr,"zei-line"]],[["smiley",p.smiley,f]],[["otheroptions",g("tooltip.spellcheck"),"zei-arrow ze-big"]]],C.heading=[{htm:g("dropdown.normal"),datAttr:"Normal",fontsize:"20"},{htm:g("dropdown.heading1"),datAttr:"Heading1",fontsize:"26"},{htm:g("dropdown.heading2"),datAttr:"Heading2",fontsize:"24"},{htm:g("dropdown.heading3"),datAttr:"Heading3",fontsize:"22"},{htm:g("dropdown.heading4"),datAttr:"Heading4",fontsize:"20"},{htm:g("dropdown.heading5"),datAttr:"Heading5",fontsize:"18"},{htm:g("dropdown.heading6"),datAttr:"Heading6",fontsize:"16"}],C.imgAction="/ze/uploadImage",C.context="zm",C.imgAction="/zm/zeUploadImage.do",C.csrfParamVal="zmrcsr",C.plainTextDataDef=!0,C.csrfCookieVal=t.getCookie("zmcsr"),C.contextVal="zm";var b=zmPath.getCompletePath("default").domain.js;C.smileyPath=h+b+"/ze/"+C.staticVersion+"/images/",C.imgParameters="?aId="+zmail.accId+"&mode=composeSet&frm=c",C.imgParametersFunction=function(){var t=v("zmTab");"object"!==babelHelpers.typeof(t)||"settings"!==t.currentTab&&"zm-settings"!==t.currentTab?C.imgParameters="?aId="+zmail.accId+"&mode=composeSet&frm=c":C.imgParameters="?aId="+zmail.defAccId+"&mode=composeSet&frm=s"},C.attachDrop=[{htm:g("dropdown.attachDesktop"),clk:function(t){zmComp.triggerUpload(t)}},{htm:g("dropdown.attachCloud"),clk:function(t){zmComp.triggerCloudUpload(t)}}],C.setContentProcessed=!1;var y=navigator.userAgent.toLowerCase();C.is_ie=-1!==y.indexOf("ie"),C.is_safari=-1!==y.indexOf("safari"),C.is_opera=-1!==y.indexOf("opera"),C.is_mac=-1!==y.indexOf("mac"),C.language=C.ElementInArray(["en","zh","da","nl","fr","de","hu","it","ja","pl","pt","ru","es","sv","hi","tr","uk","ta","mr","bg","cs","ko","bn","te","hr"],C.language)||"en",C.is_opera&&C.toolbarOrder.pop(),C.editorCoreLoaded=Promise.all([o.loadFiles("extjs",C.jsPath+"/js/i18n/"+C.language+"/zep.min.js"),o.loadFiles("extcss",C.cssPath+"/css/editor.min.css")]),C.loading=!0},attach:function(t){zmComp.triggerUpload(t)},template:function(t){"undefined"!=typeof zmComp&&"function"==typeof zmComp.triggerTemplate&&zmComp.triggerTemplate(t)},signature:function(t){"undefined"!=typeof zmCDrop&&"function"==typeof zmCDrop.openSignatureList&&zmCDrop.openSignatureList({cmpId:t.split("_")[1]})},getTemplateList:function(t,e){var o,i,n=new Promise(function(t,e){o=t,i=e});return zmail.HotKeys?e.initobj.addSmartSuggestion?zmail.HotKeys.Utils.getSmartSuggestedWords(t).done(function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};t.keyFound=e,o(t)},function(){i()}):zmail.HotKeys.Utils.getCurrentMatchingWord(t).done(function(t){o(t)},function(){i()}):zmail.HotKeysWindow&&(e.initobj.addSmartSuggestion?zmail.HotKeysWindow.getSmartSuggestedWords(t).then(function(t){var e;1<arguments.length&&void 0!==arguments[1]&&arguments[1];t.hasOwnProperty("_matchArr")?e=t._matchArr:(e=t).keyFound={},t.hasOwnProperty("keyNotMatched")&&(e.keyFound=t),o(e)},function(){i()}):zmail.HotKeysWindow.getCurrentMatchingWord(t).then(function(t){o(t)},function(){i()})),n},setFocus:function(t){"undefined"!=typeof zmComp&&"function"==typeof zmComp.trigggerFocus&&zmComp.trigggerFocus(t)},setBlur:function(t){"undefined"!=typeof zmComp&&"function"==typeof zmComp.tirggerBlur&&zmComp.trigggerBlur(t)},loadURL:function(t,e){var o,i,n=document;"css"===e?((o=n.createElement("link")).type="text/css",o.rel="stylesheet",o.href=t,n.getElementsByTagName("head")[0].appendChild(o)):"js"===e&&((i=n.createElement("script")).type="text/javascript",i.src=t,i.charset="utf-8",n.getElementsByTagName("head")[0].appendChild(i))},ElementInArray:function(t,e){for(var o=t.shift();o;){if(o===e)return o;o=t.shift()}},loadInsertImage:function(t,e,o,i,n,r){var a="/zm/ImageSignature?fileName="+t;a+="&accountId="+o+"&storeName="+e,a+="c"===n?"&frm=c":"&frm=s",null!=r&&(a+="&fileId="+r),ZE&&ZE.activeEditor&&ZE.activeEditor.previewImage(a)},toolbarClickTriggered:function(){zmUtil.hideMenu()}};C.removeTooltip=function(){zmTooltip.remove()};var t=function(){try{!function(){var t=document.getElementById("ze_dropdown");if(t||(t=document.getElementById("ze_spellcheck_options")),t){t.parentElement.removeChild(t);for(var e=document.getElementsByClassName("ze_SCmb"),o=e.length,i=0;i<o;i++){var n=e[i].getElementsByClassName("ze_Sel")[0];n&&(n.className="")}}}()}catch(t){}};return C.getTriggerHandlerKeys=function(){return["@","/"]},C.mentionHandler=function(o,i){return new Promise(function(e,t){"@"===o.key?i.initobj.getNewAutofillContacts(o.word).then(function(t){e({type:"contacts",customCallback:i.initobj.triggerOnMention,result:t})}):"/"===o.key&&C.getTemplateList(o.word,i).then(function(t){e({type:"hotkeys",result:t,keyFound:t.keyFound||{}})})})},window.ZE_Init=C,$.subscribe("mail/previewScrolled",function(){t()}),$.subscribe("streams/previewScrolled",function(){t()}),$.subscribe("settings/previewScrolled",function(){t()}),C}),function(){var t=zmail.Core.Namespaces.create("zmail.ZEditor.AutoComplete.System"),e=zmail.Utils.DOM,r=zmail.Components.AutoComplete,o=function(t){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,t),babelHelpers.createClass(n,[{key:"init",value:function(t,e){var o=this;o.editor=t,o.isIFrame=e,o.avoidEnterAction=!1,o.editor.initobj.isEnterKeyHandler=o.enterKeyHandler.bind(o);var i=e?t.doc.body:t.iframe;babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"init",this).call(this,i)}},{key:"destroy",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"destroy",this).call(this),this.editor=null}},{key:"getSelectionRange",value:function(){var t,e,o=this.editor,i=o.win,n=o.doc;return t=i.getSelection(),"function"!=typeof n.createRange?null:(e=n.createRange(),t.rangeCount?(e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.anchorNode,t.anchorOffset),e):null)}},{key:"enterKeyHandler",value:function(){var t=this;return t.avoidEnterAction||setTimeout(function(){e.element(t).triggerHandler("textchange",{element:t.editor.doc.body,source:t,event:null})},0),t.avoidEnterAction}},{key:"replaceContent",value:function(t,e){var o=this.editor.win.getSelection(),i=this.getCurrentTypingWord(e),n=this.getSelectionRange();n.setStart(n.startContainer,n.startOffset-i.length),o.removeAllRanges(),o.addRange(n),this.editor.pasteHTML(t)}},{key:"findWordAtIndex",value:function(t,e){t=t||"",e=e||t.length;var o=t.substring(0,e);if(o.match(/^\s+/))o=o.replace(/\s+/,"");else{var i=o.lastIndexOf("@");" "===o.charAt(i-1)&&(o=o.substring(i,e))}var n=/(?:[@]{1}(([^\s]+[\s]?)*))/i.exec(o);return n?n[0]:""}},{key:"getCurrentTypingWord",value:function(t){var e=this.getSelectionRange(),o=e.startContainer,i=e.startOffset;if(3!==o.nodeType&&((!o.childNodes.length||1===o.childNodes.length&&3===o.childNodes[0].nodeType)&&this.checkAndInsertSingleTextNode(),o=o.childNodes[0]),void 0===o)return"";var n=o.nodeValue;return t?this.findWordAtIndex(n,i):r.Utils.findWordAtIndex(n,i)}},{key:"getListAnchorBounds",value:function(){var t=this.editor,e=window.getSelection(),o=this.getCurrentTypingWord(),i=this.getSelectionRange(),n=i.startContainer;if(3!==n.nodeType){if(!n.childNodes.length||1===n.childNodes.length&&3===n.childNodes[0].nodeType){var r=i.startContainer.textContent,a=e.anchorOffset,l=document.createTextNode(r);(i=document.createRange()).setStart(l,a),i.setEnd(l,a)}}else 0<i.startOffset-o.length?i.setStart(i.startContainer,i.startOffset-o.length):i.setStart(i.startContainer,0);var s=t.iframe.getBoundingClientRect(),d=i.getBoundingClientRect(),m={top:d.top,right:d.right,left:d.left,bottom:d.bottom,height:d.height,width:d.width};return this.isIFrame&&(m.top=s.top+d.top,m.right=s.left+d.left+d.width,m.left=s.left+d.left,m.bottom=s.top+d.top+d.height),m}}]),n}(r.System.AbstractHTMLContentEditable);t.ZEditorUserInput=o}();