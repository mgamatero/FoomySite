"use strict";!function(){var a=zmail.Core.Namespaces.create("zmailSearch.Core"),e=a.i18n=zmText.get("search");a.queryParam="";var t,i={get:{frameworkConfig:function(){return{appId:"zm_srch1",tooltip:e.common.tooltip,tabInfo:{onDelete:function(){return zmailSearch.Model.beforeSearchTabClose(),!0},appname:"Search",appId:"zm_srch1",data:{CNodes:"3"},appIcon:"msi-search",noLeftSel:!1,shortcuts:zmshCut.mail,titleProvider:a.i18n.resultsHeader,isNewHeader:!0,isNewPreview:!1,newHeaderOnly:!0},constructNewHeader:function(e){var a=e[1];a.appendIconBar();var t=a.titleBar.$el,i=zmailSearch.View.getTitleBarElem();t.appendDOM(i,{clear:!0})},overRideDefaultConfig:function(e){return zmailSearch.Core.overRideDefaultConfig(e)},onWorkSpaceConstruction:function(){zmailSearch.Core.onWorkspaceCreation(this),this.listingCenter.setDragDrop({onDrop:function(e,a,t,i){var r,l,s,n,c=[],o=[];for(s in t)r=s;for(n=a.length,s=0;s<n;s++)-1!==a[s].id.indexOf("t")?o.push(zmInit.zmsubStr(a[s].id,"t")):c.push(a[s].id);t[r].FN?(l={action:"move",folId:r,msgId:c,thd:o},zmail.MailAction.Initializer.doActions("move","drop",l)):(l={action:"label",msgId:c,thd:o,lA:"add",lId:r},zmail.MailAction.Initializer.applyActions("label","drop",l))},allowDrag:function(e){var a,t=e.attr("id");return!(!(a=zmUtil.getMailObj(t).FD)||a===zmail.folId.dId||a===zmail.folId.teId||a===zmail.folId.spId||a===zmail.folId.oId)},allowDrop:function(e,a,t){var i,r;for(i in a)r=i;return a[r].FN?"inside"===t&&r!==zmail.folId.dId&&r!==zmail.folId.teId&&r!==zmail.folId.oId:"inside"===t},dragStart:function(e,a){var t,i={};return 1<a.length?(i.count=a.length,i.text="Messages selected"):(t=zmInit.zmsubStr(a[0].id,"t"),i.text=zmUtil.replaceHtmlInSubject(zmUtil.getMailObj(t).SB)),i},allowedParents:"#zmlTreeH,#zmllabelH",rowCls:"zmList",selCls:"zmLCheck"})},workspace:function(){return t}}}},set:{workspace:function(e){t=e}}};a.cookSearchQuery=function(e){var a=zmailSearch.Utils.QueryBuilder.buildQuery(e);return a&&zmailSearch.Core.setQueryParams(a),a},a.generateView=function(e,a){zmailSearch.Core.initSearchResponse(e,a)},a.getFrameworkConfig=function(){return i.get.frameworkConfig.call(this)},a.onWorkspaceCreation=function(e){a.setWorkspace(e)},a.setWorkspace=function(e){i.set.workspace(e)},a.getWorkspace=function(){return i.get.workspace()},a.setQueryParams=function(e){zmailSearch.Core.queryParam=e},a.getQueryParams=function(){return zmailSearch.Core.queryParam},a.setSaveSearchQuery=function(e){zmailSearch.Core.saveSesarchQuery=e},a.getSaveSearchQuery=function(){return zmailSearch.Core.saveSesarchQuery},a.initSearchResponse=function(e,a){if(e.paginate||zmailSearch.Model.initSearchData(e,this.getFrameworkConfig(),a),zmailSearch.Model.populateSearchData(e,a),e.paginate){var t=ZMail.utils.getHeaderRef({}).find(".msi-uncheck");t.hasClass("msi-check")&&t.removeClass().addClass("msi-uncheck msi-partcheck")}else ZMail.lView.applyDisplayDensity(),ZMail.topbar.icons.renovate({type:"listing",isSearchView:!0,tabId:"zm_srch1"}),zmList.unchkAll(),zmailSearch.View.bindEvents(a)},a.hasPagination=function(){return!!zmailSearch.Model.hasPagination()},a.getPageSize=function(){return zmail.Search.Models.Contexts.mailSearchContext.pageSize},a.isWorkspaceAvailable=function(){return!!zmailSearch.Model.getSearchData()},a.setCenterListingListener=function(e){e.listingCenter.eventListeners=[{event:"click",callback:function(e,a){zmList.bindEventsMailRow(e,a)}},{event:"contextmenu",callback:function(e,a){zmList.mailUtility(e,a)}}]},a.setListingHeaderListener=function(e){e.listingHeader.eventListeners=[{event:"click",callback:function(e){if("spamToggle"===e){var a=zmailSearch.Model.getSearchData()&&zmailSearch.Model.getSearchData().elemObj;a&&a.listingHeaderElem.length&&(a.listingHeaderElem.find(".zmToggleBBtn").hasClass("off")?zmail.Search.addToSearch({className:"includespamtrash",value:!0}):zmail.Search.Environment.remove("includeSpamTrash"))}else"savesearch"===e&&zmailSearch.Core.saveSearch(e)}}]},a.setPreviewHeaderListner=function(e){e.previewHeader.eventListeners=[{event:"click",callback:function(e,a){zmList.bindAction(e,a)}}]},a.setEventListeners=function(e){zmailSearch.Core.setListingHeaderListener(e),zmailSearch.Core.setCenterListingListener(e),zmailSearch.Core.setPreviewHeaderListner(e)},a.overRideDefaultConfig=function(e){return zmailSearch.View.setHeaderActionObj(e),zmailSearch.Core.setEventListeners(e),e},a.saveSearch=function(e){"savesearch"===e&&zmailSearch.View.savedSearchName().then(zmailSearch.Utils.CommonUtils.newSavedSearch)},a.isMailListedInSearch=function(e){return-1!==zmSearchUtil.getSearchList().indexOf(e)}}(),function(){var a=zmail.Core.Namespaces.create("zmailSearch.Actions");a.markAsRead=function(e,a){a.rowElem.length&&(a.rowElem.removeClass(ZMail.lConstants.cls.unread),a.previewContentElem.find("#zmHdrS"+e+" .zmPT").removeClass("zm_urd"))},a.markAsUnread=function(e,a){a.rowElem.length&&(a.rowElem.addClass(ZMail.lConstants.cls.unread),a.previewContentElem.find("#zmHdrS"+e+" .zmPT").addClass("zm_urd"))},a.applyFlag=function(e,a,t){if(a.rowElem.length){var i=ZMail.lConstants.cls,r=t.flagVal,l=zmInit.flgClass(r);a.rowElem.find("."+i.flag).removeClass().addClass(l),a.previewContentElem.find("#zmHdrS"+e+" ."+i.flag).removeClass().addClass(l)}},a.applyTag=function(){},a.markAsSpam=function(e){zmailSearch.View.removeRowElem(e),zmCenterListing.mailObjectAPI.rowRemovedInView(e,"",ZMail.lConstants.searchAppId),zmailSearch.Model.deleteMessageFromList(e),zmailSearch.Model.deleteMessageContent(e),zmailSearch.View.closePreview(e)},a.markAsNotSpam=function(e){zmailSearch.View.removeRowElem(e),zmCenterListing.mailObjectAPI.rowRemovedInView(e,"",ZMail.lConstants.searchAppId),zmailSearch.Model.deleteMessageFromList(e),zmailSearch.View.closePreview(e)},a.archiveMail=function(e,a){if(a.rowElem.length){a.rowElem.addClass(ZMail.lConstants.cls.archIndication);var t=zmailSearch.Utils.CommonUtils.getFolderNameOfMsg(e);zmailSearch.View.updateFolderName(e,a,t)}},a.unarchiveMail=function(e,a){if(a.rowElem.length){a.rowElem.removeClass(ZMail.lConstants.cls.archIndication);var t=zmailSearch.Utils.CommonUtils.getFolderNameOfMsg(e);zmailSearch.View.updateFolderName(e,a,t)}},a.deleteMail=function(e){a.markAsNotSpam(e)},a.moveMail=function(e,a,t){if(a.rowElem.length){var i=zmailSearch.Utils.CommonUtils.getFolderName(t);zmailSearch.View.updateFolderName(e,a,i);var r=zmailSearch.Model.getSearchData().requestParams.folId||[];r.length&&r[0]!==t&&(zmailSearch.View.removeRowElem(e),zmCenterListing.mailObjectAPI.rowRemovedInView(e,"",ZMail.lConstants.searchAppId),zmailSearch.Model.deleteMessageFromList(e),zmailSearch.View.closePreview(e))}},a.rnSSrchContextMenu=function(){zmUtil.hideMenu(),zmailSearch.View.savedSearchName({mode:"rename"}).then(function(e){zmSearch.processSavedSearch({id:zmSearch.savedSearchId,searchName:e.savedsearchname,mode:"rename"})}).fail(function(){})},a.delSavedSrchContextMenu=function(){var e=zmSearch.savedSearchId,a=zmail.savedSearchList[e]?zmail.savedSearchList[e].FN:"";zmsDialog.confirm(zmText.get("search","savedsearch.confirmDelete",{name:a}),{onOk:function(){zmSearch.processSavedSearch({id:e,mode:"delete"})}}),zmUtil.hideMenu()},a.listMailsContextMenuAction=function(e){var a,t,i,r,l,s,n=[],c=zmSearchUtil.isNewSearch();a=zmInit.rclkId,a=zmInit.zmsubStr(a,"t");var o=zmUtil.getMailObj(a);zmTab.currentTab===ZMail.lConstants.searchAppId?n=zmSearchUtil.getSearchedFolders().slice():(s=zmInit.getListingDetObj().fId)&&n.push(s);if("sender"===e)(t=o.F||o.SN)&&c&&((l=l||[]).push({className:"Sender",value:t}),n.length&&zmUtil.isSharedFolder(n[0])&&l.push({className:"ShareFolFilter",value:zmfolAction.getSharedFolPath(n[0])}),o.FD===zmail.folId.tId&&l.push({className:"includespamtrash",value:!0}),o.FD===zmail.folId.spId&&l.push({className:"folderFilter",value:zmfolAction.getFolderPath(n[0])}));else if("recipient"===e)try{var m=o.TO||o.TOADDR||(o.CC&&"Not Provided"!==o.CC?o.CC:"")||o.CCADDR||void 0;(i=(i=m?zmConUtil.splitncheck(m,"object"):[]).length?i[0].eid:void 0)&&c&&((l=l||[]).push({className:"toorcc",value:i}),n.length&&zmUtil.isSharedFolder(n[0])&&l.push({className:"ShareFolFilter",value:zmfolAction.getSharedFolPath(n[0])}))}catch(e){}else"subject"===e&&(r=-1!==zmInit.rclkId.indexOf("t")?zmInit.getThreadSubject(a):o.SB)&&(r='"'+(r=zmUtil.replaceHtmlInSubject(r))+'"',c&&((l=l||[]).push({className:"subject",value:r}),n.length&&zmUtil.isSharedFolder(n[0])&&l.push({className:"ShareFolFilter",value:zmfolAction.getSharedFolPath(n[0])}),o.FD===zmail.folId.tId&&l.push({className:"includespamtrash",value:!0}),o.FD===zmail.folId.spId&&l.push({className:"folderFilter",value:zmfolAction.getFolderPath(n[0])})));l?c?(zmail.Search.setContext(zmail.Search.Models.Contexts.mailSearchContext,{ignoreUsableFilters:!0}),zmail.Search.newSearch(l,{addShrinkClass:!0,disableSearchBoxFocus:!0})):(zmSearch.setPrevAppSearch("m"),zmSearch.addSearch(l)):_zm.succErrMsg("e",zmText.get("search-impl").errorsearch),zmUtil.hideMenu()}}(),function(){var e=zmail.Core.Namespaces.create("zmailSearch.Utils.QueryBuilder"),i={Subject:{lhs:"Subject"},Sender:{lhs:"Sender"},SentBy:{lhs:"Sender"},ToOrCc:{lhs:"to/cc"},To:{lhs:"to"},Cc:{lhs:"cc"},EmailContent:{lhs:"Content"},AttachmentName:{lhs:"Attachment Name"},AttachmentContent:{lhs:"Attachment Content"},AttachmentType:{lhs:"formatType"},EntireMessage:{lhs:"entire message"},Has:{lhs:"entire message"}},r={SubjectExclude:{lhs:"Subject"},SenderExclude:{lhs:"Sender"},ToOrCcExclude:{lhs:"to/cc"},ToExclude:{lhs:"to"},CcExclude:{lhs:"cc"},EmailContentExclude:{lhs:"Content"},AttachmentNameExclude:{lhs:"Attachment Name"},AttachmentContentExclude:{lhs:"Attachment Content"},EntireMessageExclude:{lhs:"entire message"},HasExclude:{lhs:"entire message"}},m={HasAttachmentFilter:{flagName:"hasAtt",value:"1"},HasNoAttachmentFilter:{flagName:"hasAtt",value:"0"},HasFlagFilter:{flagName:"hasFlg",value:"1"},HasNoFlagFilter:{flagName:"hasFlg",value:"0"},HasReplyFilter:{flagName:"status2id",value:"1"},HasNoReplyFilter:{flagName:"resp",value:"0"},ConversationFilter:{flagName:"thd",value:"1"},NoConversationFilter:{flagName:"thd",value:"0"},HasMailReminderFilter:{flagName:"hasRem",value:"1"},unread:{flagName:"unread",value:"1/0"},ForwardFilter:{flagName:"status2id",value:"2"},HasInlineAttachmentFilter:{flagName:"hasinline",value:"1"},includeSpamTrash:{flagName:"includespamtrash",value:!0}},h={HasComment:{value:1},HasNote:{value:2},HasTask:{value:3},HasEvent:{value:4},HasProject:{value:5},HasChatlet:{value:6}},d=function(e){return e.getDate()+{0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"}[e.getMonth()]+e.getFullYear()},u=function(e){var a=[];_(e).each(function(e){e.className in i?a.push({lhs:i[e.className].lhs,value:e.value,contains:!0}):e.className in r&&a.push({lhs:r[e.className].lhs,value:e.value,contains:!1})});var t=function(e){var a,t,i,r,l="",s="",n="";for(t=e.length,a=0;a<t;a++)i=e[a],s=zmailSearch.Utils.CommonUtils.escapeSpecialChars(i.value),r=i.lhs,n=i.contains?" = ":" != ","to/cc"===r.toLowerCase()?" = "===n?l+="( To"+n+s+" ||Cc"+n+s+" )":" != "===n&&(l+="To"+n+s+" && Cc"+n+s):"entire message"===r.toLowerCase()?l+="Entire"+n+s:l+=r+n+s,a!==t-1&&(l+=" && ");return l}(a);return t?{SearchStr:encodeURIComponent(t),searchQuery:a}:{}};e.buildQuery=function(e){var a=e.data,t={accId:zmail.accId,thdView:!1,from:1};t.to=zmail.Search.Models.Contexts.mailSearchContext.pageSize,e.paginate&&(t.from=zmailSearch.Model.getStartIndexforNextPage(),t.lastRT=zmailSearch.Model.getLastRetrievalTime(),t.lastM=zmailSearch.Model.getLastMessageId());var i,r,l,s,n,c,o=u(a);return zmailSearch.Core.setSaveSearchQuery(o.searchQuery),t=_.extend(t,{SearchStr:o.SearchStr},(c={},_(a).each(function(e){e.className in m&&(c[m[e.className].flagName]=m[e.className].value)}),c),function(e){var a=[];if(_(e).each(function(e){"FolderFilter"===e.className&&a.push(e.actualValue.id)}),a.length)return{folId:a}}(a),function(e){var a=[];if(_(e).each(function(e){"MailTagFilter"===e.className&&a.push(e.actualValue.id)}),a.length)return{labId:a.join()}}(a),function(e){var a=[];if(_(e).each(function(e){"MailReminderFilter"===e.className&&a.push(e.actualValue.value)}),a.length)return{wType:a}}(a),(s={},n=["MailFromDateFilter","MailToDateFilter","MailDateFilter"],_(a).each(function(e){if(-1!==n.indexOf(e.className))switch(e.className){case"MailFromDateFilter":s.fDate=d(e.actualValue),s.eDate||(s.eDate=d(new Date));break;case"MailToDateFilter":s.fDate||(s.fDate=d(new Date(0))),s.eDate=d(e.actualValue);break;case"MailDateFilter":s.fDate=d(e.actualValue),s.eDate=s.fDate}}),s.fDate&&s.eDate?s:{}),function(e){var a=[];if(_(e).each(function(e){"ShareFolFilter"===e.className&&(a.push(e.actualValue.fId),a.push(e.actualValue.shId))}),a.length)return{folId:[a[0]],shId:[a[1]],sharedFolderSearch:!0}}(a),function(e){var a=[];if(_(e).each(function(e){"MailPriorityFilter"===e.className&&a.push(e.actualValue.const)}),a.length)return{priority:a[0]}}(a),(r={},l=["FromSizeFilter","ToSizeFilter"],_(a).each(function(e){if(-1!==l.indexOf(e.className))switch(e.className){case"FromSizeFilter":r.fromSize=e.value,void 0===r.toSize&&(r.toSize=51200);break;case"ToSizeFilter":r.toSize=e.value,void 0===r.fromSize&&(r.fromSize=0)}}),void 0!==r.fromSize&&void 0!==r.toSize?r:{}),function(e){var a=[];if(_(e).each(function(e){"MailFlagFilter"===e.className&&a.push(e.actualValue.value)}),a.length)return{flagid:a}}(a),(i=[],a.forEach(function(e){e.className in h&&i.push(h[e.className].value)}),i.length?{aentities:i.join()}:{}),function(e){var a=[];if(_(e).each(function(e){"BCC"===e.className&&a.push(e.value)}),a.length)return{bccaddr:a}}(a))}}(),function(){var d=zmail.Core.Namespaces.create("zmailSearch.View"),t=".zm_spam_separator";d.i18n=zmText.get("search");var u="#zm_rnssrchpopup";d.getTitleBarElem=function(){return ZMail.topbar.header.searchHeaderTemplate()},d.setHeaderActionObj=function(e){var a=ZMail.topbar.icons.model.get("search");e.listingAction={},e.listingHeader.obj.left=a.left,e.listingHeader.obj.right=a.right,e.listingCenter={eventListeners:[]}},d.generateListView=function(e,a){void 0===e&&(e=0);var t=zmailSearch.Model.getSearchData(),i=t.searchList,r=0,l=t.elemObj.listingContentElem;a=a||i.length;var s,n,c=document.createDocumentFragment();for(r=e;r<a;r++)c.appendChild((s=i[r],n=void 0,n=zmInit.constructMailRow("",[s]),$.e(n))[0]);if(0===e&&(l.html(""),l.scrollTop(0),0===a&&this.setEmptyListing()),l.appendDOM(c),!zmail.isAusCustomer&&!zmail.isRebranded&&0===t.hasNextPage){var o=zdom("div",{className:"zmInfoWarnMsg"},zdom("span",{className:"zmLink jsAcrossSearch"},zdom("i",{className:"msi-zgSearch jsAcrossSearch"}),this.i18n.mail.zohoOneSearch));l.appendDOM(o)}zmailSearch.View.modifyIncludeSpamTrashOption()},d.setEmptyListing=function(){var e=zmailSearch.Model.getSearchData().elemObj.listingContentElem;0===zmailSearch.Model.getSearchData().searchList.length&&e.appendDOM(zmInit.emptyRow(this.i18n.emptyResults),{clear:!0})},d.removeListingContent=function(){zmailSearch.Model.getSearchData()&&zmailSearch.Model.getSearchData().elemObj&&zmailSearch.Model.getSearchData().elemObj.listingContentElem.html("")},d.toggleSavesearchOption=function(e){var a=zmailSearch.Model.getSearchData()&&zmailSearch.Model.getSearchData().elemObj;a&&a.listingHeaderElem.length&&("hide"===e?(a.listingHeaderElem.find(".zm_savesearch").hide(),a.listingHeaderElem.find(".zm_saveSearch_separator").hide()):(a.listingHeaderElem.find(".zm_savesearch").show(),a.listingHeaderElem.find(".zm_saveSearch_separator").show()))},d.modifyIncludeSpamTrashOption=function(){var e=zmailSearch.Model.getSearchData()&&zmailSearch.Model.getSearchData().elemObj,a=e.listingHeaderElem.find(".zmToggleBBtn");a.removeClass("zmDisabled"),e&&e.listingHeaderElem.length&&(zmailSearch.Core.queryParam.hasOwnProperty("folId")?(a.addClass("zmHideD"),e.listingHeaderElem.find(t).addClass("zmHideD")):zmailSearch.Core.queryParam.hasOwnProperty("includespamtrash")?(e.listingHeaderElem.find(t).removeClass("zmHideD"),a.removeClass("zmHideD"),a.removeClass("off").addClass("on")):(a.removeClass("on").addClass("off"),a.removeClass("zmHideD"),e.listingHeaderElem.find(t).removeClass("zmHideD")))},d.bindEvents=function(e){this.subcribeEvents(e)},d.subcribeEvents=function(){$.subscribe("mail/read",d.updateRowRead),$.subscribe("mail/unread",d.updateRowUnread),$.subscribe("mail/flag",d.updateFlagRow),$.subscribe("mail/delete",d.updateRowDelete),$.subscribe("mail/label",d.updateLabelRow),$.subscribe("mail/move",d.updateRowMove),$.subscribe("mail/archive",d.updateRowArchive),$.subscribe("mail/unarchive",d.updateRowUnarchive),$.subscribe("mail/spam",d.updateRowSpam),$.subscribe("mail/notspam",d.updateRowNotspam)},d.unsubscribeEvents=function(){$.unsubscribe("mail/read",d.updateRowRead),$.unsubscribe("mail/unread",d.updateRowUnread),$.unsubscribe("mail/flag",d.updateFlagRow),$.unsubscribe("mail/delete",d.updateRowDelete),$.unsubscribe("mail/label",d.updateLabelRow),$.unsubscribe("mail/move",d.updateRowMove),$.unsubscribe("mail/archive",d.updateRowArchive),$.unsubscribe("mail/unarchive",d.updateRowUnarchive),$.unsubscribe("mail/spam",d.updateRowSpam),$.unsubscribe("mail/notspam",d.updateRowNotspam)},d.updateRowRead=function(e,a){if(zmList.isMailListedInSearch(a)){var t=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);zmailSearch.Actions.markAsRead(a,t)}},d.updateRowUnread=function(e,a){if(zmList.isMailListedInSearch(a)){var t=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);zmailSearch.Actions.markAsUnread(a,t)}},d.updateFlagRow=function(e,a,t,i){if(zmList.isMailListedInSearch(a)){var r=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);zmailSearch.Actions.applyFlag(a,r,{flagVal:i})}},d.updateRowDelete=function(e,a){zmList.isMailListedInSearch(a)&&zmailSearch.Actions.deleteMail(a)},d.updateLabelRow=function(e,a,t,i){if(zmList.isMailListedInSearch(a)){var r=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);zmailSearch.Actions.applyTag(a,r,i)}},d.updateRowMove=function(e,a,t,i){if(zmList.isMailListedInSearch(a)){var r=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);zmailSearch.Actions.moveMail(a,r,i.folId)}},d.updateRowArchive=function(e,a){if(zmList.isMailListedInSearch(a)){var t=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);zmailSearch.Actions.archiveMail(a,t)}},d.updateRowUnarchive=function(e,a){if(zmList.isMailListedInSearch(a)){var t=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);zmailSearch.Actions.unarchiveMail(a,t)}},d.updateRowSpam=function(e,a){zmList.isMailListedInSearch(a)&&zmailSearch.Actions.markAsSpam(a)},d.updateRowNotspam=function(e,a){zmList.isMailListedInSearch(a)&&zmailSearch.Actions.markAsNotSpam(a)},d.removeRowElem=function(e){if(zmList.isMailListedInSearch(e)){zmailSearch.Utils.CommonUtils.getMsgRowElemObj(e).rowElem.remove();var a=zmailSearch.Core.getPageSize(),t=zmailSearch.Core.hasPagination();(zmailSearch.Model.getSearchList()||[]).length<a&&t&&zmail.Search.SearchWatcher.handlePagination()}},d.updateFolderName=function(e,a,t){if(a.rowElem.length){var i=ZMail.lConstants.cls;a.rowElem.find("."+i.folName).text(t)}a.previewContentElem.length&&a.previewContentElem.find("[data-mid="+e+"]").find(".zm_folname").text(t)},d.closePreview=function(e){if(zmailSearch.Core.isWorkspaceAvailable()){var a=zmailSearch.Utils.CommonUtils.getSearchTabId(),t=zmPrev.prevDetails(a);t.msgId&&(e&&t.msgId===e||!e)&&zmPrev.clsPreview(a)}},d.savedSearchName=function(r){var e,a,l,t,i,s,n,c,o,m="",h={};if(r=r||{},n=$.Deferred(),"edit"===(l=r.mode||"add")&&n.resolve(),"add"===l||"rename"===l){switch(l){case"add":a=d.i18n.savedsearch.nameInfo,m=d.i18n.savedsearch.newSearch;break;case"rename":a=d.i18n.savedsearch.renameInfo}h={title:a,style:{width:"200px"},customClass:"noanim",buttons:[{txt:d.i18n.savedsearch.popup.save,selected:!0,callback:function(){var e,a="",t=$.q(u).find("input"),i="";e=t.val(),"rename"===l&&(a=zmSearch.savedSearchId,i=m.toLowerCase()),zmSearch.isValidName(e,r,a)?("rename"===l&&i===e.toLowerCase()?n.reject():n.resolve({savedsearchname:e}),zmsDialog.remove()):t.focus()}},{isCancel:!0,txt:d.i18n.cancel,callback:function(){zmsDialog.remove()}}],closeaction:function(){$.q(u).remove(),n.reject()},afterDisplay:function(){$.q(u).find("input").focus(),$.q(u).find("input").select()}},"rename"===l?(s=zmsuite.getAppLeft().getNodes()[0].getLayer("zmlSSrchTreeH").el,t=(c=$.q(".zm_compose")).offset().left+c.width(),0<(o=(i=s.position().top<0?$.q(".zm_compose").offset().top:s.offset().top)+250-$.e(document.body).height())&&(i-=o),h.posParent={top:i+"px",left:t+"px"}):"add"===l&&(h.mask=!0,h.pos="center"),e=zdom("div",{id:"zm_rnssrchpopup"},zdom("ul",{className:"tempFormList"},zdom("li",null,zdom("input",{type:"text","data-enableshortcuts":"true",maxLength:"50",className:"SC_tiput",value:m,placeholder:d.i18n.savedsearch.placeholder})))),$.q(u).length||$.e(document.body).appendDOM($.e(e)),zmsDialog.create("zm_rnssrchpopup",h),$.q("#zmsdialog_zm_rnssrchpopup").mousedown(function(e){zmUtil.stopEvents(e,!0)}),$.q("#zmsdialog_zm_rnssrchpopup").click(function(e){zmUtil.hideMenu(!1,!0)})}return n.promise()},d.updateSavedSearchLayer=function(e,a){if("add"===a){if($.q("#zmlSSrchTree").length){var t,i,r,l="zmlSSrchTreeH";for(r in zmail.savedSearchList[e.searchid]={id:e.searchid,FN:e.searchname},t=zmail.mailLeft.getNodes()[0].getLayer(l),i=zmList.getRowInfo(e.searchid,l)){i[r].FN=e.searchname,i[r].id=e.searchid;break}if("m"===zmApp.currentApp&&zmail.isPrivilegedUser){var s=zmLHS.currentList.zmlSSrchTreeH.models.length,n={id:e.searchid,isSelected:!1,seq:s,text:e.searchname,title:"",visible:!0},c={mode:"add",nObj:$.extend({},i)};t.updateListObject(c,t.mapObject),zmLHS.updateCollection("zmlSSrchTreeH","add",n)}else t.appendNode(i,t.mapObject)}else{var o={id:e.searchid,FN:e.searchname};zmail.savedSearchList[e.searchid]=o;if(0<Object.keys(zmail.savedSearchList).length){var m=new ZMLayer,h={type:"1",mapObject:{id:"id",name:"FN"},disableSelection:!0,listId:"zmlSSrchTree",id:"zmlSSrchTreeH",dataObject:{headerObject:{id:"zmlSSrchTreeH",name:d.i18n.savedsearch.savedSearches,showList:!0},listObject:zmail.savedSearchList}};m.push(h),zmail.mailLeft.getNodes()[0].insertLayerAfter("zmlview",m)}}zmUtil.succErrMsg("s",d.i18n.savedsearch.saveSuccess),d.toggleSavesearchOption("hide")}}}(),function(){var i,e=zmail.Core.Namespaces.create("zmailSearch.Model");e.i18n=zmText.get("search");var r=function(e,a,t){this.initSearchTabInfo(a),this.initSearchReqData(),this.initSearchResult(e.response),this.initSearchElemObj(t)};r.prototype={initSearchTabInfo:function(e){this.tabInfo=e.tabInfo},initSearchReqData:function(){this.requestParams=zmailSearch.Core.getQueryParams()},initSearchResult:function(e){this.searchList=[],this.from=1,this.to=zmailSearch.Core.getPageSize(),this.hasNextPage="",this.lastRT="",this.lastMsgId=""},initSearchElemObj:function(e){this.elemObj={centerContainerElem:e.listing.$el,listingHeaderElem:e.listingHeader.$el,listingActionElem:e.listingAction.$el,listingContentElem:e.listingCenter.$el,prevContainerElem:e.preview.$el,previewHeaderElem:e.previewHeader.$el,previewContentElem:e.previewContent.$el,viewDetails:{fId:"",view:"search",flag:"",label:"",attach:""}}},initSearchResponse:function(e){var a=e.response||[];a.length&&(a=a[1]),this.addSearchList(a)},addSearchList:function(e){var a,t,i,r,l=e.length;i=zmUtil.addDMapModels(e,null).MO,r=e[l-1].stateinfo,this.setHasPagination(parseInt(r[13])),this.hasNextPage&&e[l-1].lastRT&&(this.setLastRetrievalTime(e[l-1].lastRT),this.setLastMessageId(e[l-2].M)),this.searchList.length?(a=this.searchList.length,this.searchList=this.searchList.concat(i)):(a=0,this.searchList=i),t=this.searchList.length,this.from=t+1,zmailSearch.View.generateListView(a,t)},setHasPagination:function(e){this.hasNextPage=e},setLastRetrievalTime:function(e){this.lastRT=e},setLastMessageId:function(e){this.lastMsgId=e}},e.initSearchData=function(e,a,t){i=new r(e,a,t)},e.populateSearchData=function(e,a){this.getSearchData().initSearchResponse(e)},e.getSearchData=function(){return i},e.getStartIndexforNextPage=function(){return this.getSearchData().from||1},e.getLastRetrievalTime=function(){return this.getSearchData().lastRT},e.getLastMessageId=function(){return this.getSearchData().lastMsgId},e.hasPagination=function(){return(this.getSearchData()||{}).hasNextPage||!1},e.resetSearchData=function(){i&&(zmailSearch.View.closePreview(),zmailSearch.View.removeListingContent(),zmCache.clearSearchList(),zmCenterListing.mailObjectAPI.dropViewObjectStore(this.getSearchData().tabInfo.appId),zmailSearch.View.toggleSavesearchOption("show"),i=void 0)},e.deleteMessageFromList=function(e){var a=this.getSearchList(),t=a.indexOf(e);-1!==t&&a.splice(t,1),zmailSearch.View.setEmptyListing()},e.deleteMessageContent=function(e){zmContentCache.remove(e)},e.beforeSearchTabClose=function(){this.resetSearchData(),zmailSearch.View.unsubscribeEvents()},e.getSearchList=function(){return this.getSearchData().searchList}}(),function(){var e=zmail.Core.Namespaces.create("zmailSearch.Utils.CommonUtils"),i=zmText.get("mail").preview;e.escapeSpecialChars=function(e){-1!==e.indexOf("=")&&-1===e.indexOf("\\=")&&(e=e.replace(/[=]/gi,"\\=")),-1!==e.indexOf("!")&&-1===e.indexOf("\\!")&&(e=e.replace(/!/gi,"\\!")),-1!==e.indexOf("&")&&-1===e.indexOf("\\&")&&(e=e.replace(/&/gi,"\\&")),-1!==e.indexOf("|")&&-1===e.indexOf("\\|")&&(e=e.replace(/\|/gi,"\\|"));var a=!1;return-1!==e.indexOf('"')&&-1===e.indexOf('\\"')&&('"'===e.charAt(0)&&'"'===e.charAt(e.length-1)?(e=e.substring(0,1)+e.substring(1,e.length-1).replace(/"/gi,"")+e.substring(e.length-1,e.length),a=!0):e=e.replace(/"/gi,"")),-1!==e.indexOf("(")&&-1===e.indexOf("\\(")&&(e=e.replace(/\(/gi,"\\(")),-1!==e.indexOf(")")&&-1===e.indexOf("\\)")&&(e=e.replace(/\)/gi,"\\)")),-1!==e.indexOf("<")&&-1===e.indexOf("\\<)")&&(e=e.replace(/[<]/gi,"\\<")),-1!==e.indexOf(">")&&-1===e.indexOf("\\>)")&&(e=e.replace(/[>]/gi,"\\>")),-1!==e.indexOf("'")&&-1===e.indexOf("\\')")&&(e=e.replace(/'/gi,"\\'")),(-1!==e.indexOf(" ")||-1!==e.indexOf(",")||a)&&(e="( "+e+" )"),e},e.getMsgRowElemObj=function(e){var a=$.extend({},zmailSearch.Model.getSearchData().elemObj),t=zmCenterListing.mailObjectAPI.getViewObject(e,a.viewDetails.view),i=t&&t.$el||[];return i.length||(i=a.listingContentElem.find("#"+e)),a.rowElem=i||[],a},e.getSearchTabId=function(){return zmailSearch.Model.getSearchData().tabInfo.appId},e.getSearchViewDetails=function(){return zmailSearch.Model.getSearchData().elemObj?zmailSearch.Model.getSearchData().elemObj.viewDetails:{}},e.getFolderNameOfMsg=function(e){var a=zmailSearch.Utils.CommonUtils.getFolderIdOfMsg(e),t=zmInit.findFolName(a);return zmUtil.getMailObj(e,"AR")&&(t=t+" ("+i.contentOptions.archived+")"),t},e.getFolderName=function(e){return zmInit.findFolName(e)},e.getFolderIdOfMsg=function(e){return e&&zmUtil.getMailObj(e,"FD")||""},e.getConversationViewType=function(){return 0},e.newSavedSearch=function(e){var a=e.mode||"add",t={mode:a},i={searchStr:JSON.stringify(zmailSearch.Core.getSaveSearchQuery())};$.extend(!0,i,zmailSearch.Core.getQueryParams()),delete i.SearchStr,"add"===a&&(i.searchname=e.savedsearchname,i.shId&&(i.shareId=i.shId,delete i.shId),delete i.thdView,delete i.lastM,delete i.lastRT,delete i.from,delete i.to);i.method=a,zmAjq.XHR({u:zmail.conPath+"/savesearch.do",t:"POST",fn:function(e,a){e.searchid&&e.searchname?zmailSearch.View.updateSavedSearchLayer(e,a.mode):zmUtil.succErrMsg("e",zmail.i18n.errproc)},p:i,csr:"s",ep:t})},e.getFilterValue=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"EntireMessage";return zmail.Search.Environment.has(e)?zmail.Search.Environment.toJSON(e)[0].value:""},e.buildZiaQuery=function(){var a=[];return["EntireMessage","Subject","Sender","To","Cc","ToOrCc","AttachmentName"].forEach(function(e){zmail.Search.Environment.has(e)&&a.push(zmail.Search.Environment.toJSON(e)[0].value)}),a.join(" ")}}(),window.zmSearchUtil={isNewSearch:function(){return zmail.newSearch},getSearchString:function(){var e;return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchData().requestParams.SearchStr:zmail.searchObj[1].collection.searchContArr[0]||zmail.searchObj[1].collection.advSearchStr),e||""},getRequestParams:function(){var e;return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchData().requestParams:zmail.searchObj[1].collection.getCurrentParams()),e||{}},isWorkspaceAvailable:function(){if(zmSearchUtil.isNewSearch()){if(zmailSearch.Core.isWorkspaceAvailable())return!0}else if(zmsuite.isWorkspaceAvailable("zm_srch1")&&zmail.searchObj[1]&&"m"===_zm.getProperty(zmail.searchObj[1],"elemObj.appType"))return!0;return!1},getSearchList:function(){var e=[];return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchList():zmail.searchObj[1].collection.searchList),e||[]},getSearchElemObj:function(){},getSearchedFolders:function(){var e=[];return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchData().requestParams.folId:zmail.searchObj[1].collection.folderArr),e||[]},getSearchViewDetails:function(){var e;return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Utils.CommonUtils.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail")),e||{view:"search"}},getSearchTabId:function(){var e="";return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Utils.CommonUtils.getSearchTabId():"zm_srch1"),e},hasNextPage:function(){var e=!1;return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Model.hasPagination():zmail.searchObj[1].collection.hasNext),e},getPageSize:function(){var e="";return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?zmailSearch.Core.getPageSize():zmail.searchObj[1].collection.limit),e},getSearchAppType:function(){var e="";return zmSearchUtil.isWorkspaceAvailable()&&(e=zmSearchUtil.isNewSearch()?"m":zmSearch.getSearchAppType()),e},launchSavedSearch:function(e){var a=[];if(e.searchstring){var t,i=$.parseJSON(zmUtil.replaceHTMLEntities(e.searchstring)),r=i.length,l={"entire message":"EntireMessage",Sender:"Sender","to/cc":"ToOrCc",to:"To",cc:"Cc",Subject:"Subject",Content:"EmailContent","Attachment Name":"AttachmentName","Attachment Content":"AttachmentContent",formatType:"AttachmentType"},s={"entire message":"EntireMessageExclude",Sender:"SenderExclude","to/cc":"ToOrCcExclude",to:"ToExclude",cc:"CcExclude",Subject:"SubjectExclude",Content:"EmailContentExclude","Attachment Name":"AttachmentNameExclude","Attachment Content":"AttachmentContentExclude"};for(t=0;t<r;t++)i[t].contains?a.push({className:l[i[t].lhs],value:i[t].value}):a.push({className:s[i[t].lhs],value:i[t].value})}if(e.folId&&(e.shareId?a.push({className:"ShareFolFilter",value:zmfolAction.getSharedFolPath(e.folId)}):a.push({className:"FolderFilter",value:zmfolAction.getFolderPath(e.folId)})),e.labId&&e.labId.split(",").forEach(function(e){zmail.labInfo[e]&&a.push({className:"MailTagFilter",value:zmail.labInfo[e]})}),e.fDate||e.eDate){var n={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};if(e.fDate){var c=e.fDate.split("-");c=new Date(c[2],n[c[1]],c[0]),a.push({className:"MailFromDateFilter",value:c,actualValue:c})}if(e.eDate){var o=e.eDate.split("-");o=new Date(o[2],n[o[1]],o[0]),a.push({className:"MailToDateFilter",value:o,actualValue:o})}}e.fromSize&&(a.push({className:"FromSizeFilter",value:e.fromSize+"kb"}),a.push({className:"ToSizeFilter",value:e.toSize+"kb"})),"1"===e.hasRem&&a.push({className:"HasMailReminderFilter"}),"1"===e.hasinline&&a.push({className:"HasInlineAttachmentFilter"}),e.includespamtrash&&a.push({className:"includeSpamTrash"}),e.hasAtt&&a.push({className:{0:"HasNoAttachmentFilter",1:"HasAttachmentFilter"}[e.hasAtt]}),e.hasFlg&&a.push({className:{0:"HasNoFlagFilter",1:"HasFlagFilter"}[e.hasFlg]}),e.status2id&&a.push({className:{1:"HasReplyFilter",2:"ForwardFilter"}[e.status2id]});var m=e.aentities;if(m){var h=["","HasComment","HasNote","HasTask","HasEvent","HasProject","HasChatlet"];m.split(",").forEach(function(e){a.push({className:h[e]})})}var d=e.flagid;d&&a.push({className:"MailFlagFilter",value:{name:["","Info","Important","Follow-up"][d],value:d}}),e.priority&&a.push({className:"MailPriorityFilter",value:{severity:{2:"High",3:"Medium",4:"Low"}[e.priority],const:parseInt(e.priority)}}),e.wType&&a.push({className:"MailReminderFilter",value:{name:{1:"remind on a particular date",2:"remind if no reply",3:"remind for every reply",4:"already reminded"}[e.wType],value:e.wType}}),e.bccaddr&&a.push({className:"BCC",value:e.bccaddr}),zmail.Search.setContext(zmail.Search.Models.Contexts.mailSearchContext,{ignoreUsableFilters:!0}),zmail.Search.newSearch(a)}};