"use strict";!function(){var n={7:"clearbit.do",8:"fullcontact.do",11:"zendeskAction.do",13:"asanaAction.do",18:"trello.do",16:"hubspotAction.do",1001:"zohodeskAction.do",1002:"zohocrmAction.do",1003:"zmsupport.do",1008:"zrecruitAction.do",1012:"zohovaultAction.do",1014:"mmAction.do"},d="0000",s=zmText.get("zm-settings-app-integrationsettings"),g=zmText.get("zmWidgets"),l={};zmAdHocSettings.getFontValidValues().forEach(function(e,t){l[t+=1]=e,l[e]=t});var o,f,z,v,C="/integPlatform",h={url:C+"/plugin/executeURL?sessionID="+(zmail._ws&&zmail._ws.sessionId),type:"POST",contentType:"application/json",dataType:"json"},I={"zoho.mail.preview.rightpanel":"rhs","zoho.mail.attachment.popup":"popup"},r=[1002,1003],b="/integPlatform/mmAction.do",S="pointer-events",A={createTemplate:function(){zmAppLoader.load("Template").then(function(){zmComponent.createTemplate()})},chooseTemplate:function(t){var e={},a=function(e){t.promise.resolve(e)};e.tmpInsert=a,e.insertCRMTemplate=a,e.showCrmTemplates=!0,zmAppLoader.load("TemplateCategory").done(function(){ZMail.Template.init({start:1,end:21},"all",e)})},fetchTemplate:function(e,t,a){zmAjq.XHR({u:zmail.conPath+"/md.do",t:"POST",p:{accId:zmail.accId,msgId:e},efn:a,fn:function(e){t(e.mdata||{})}})},saveTemplate:function(e,t,a,i){var n={accId:zmail.accId,originalMode:"template",from:zmail.cmpdata.DEFFRM_ADDR,to:"",cc:"",bcc:"",sendImm:!1,content:t.content,subject:t.subject,priority:"Medium",smType:2,replyTo:"",tempact:!0,mymId:e,charSet:"UTF-8"};zmAjq.XHR({u:zmail.conPath+"/send.do",t:"POST",p:n,fn:a,efn:i,csr:"s"})},sendHTTPrequest:function(e,a,t){if(!e.actionMode){var i=new XMLHttpRequest;return i.open("POST",b),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var e=JSON.parse(i.response);e=e[0]&&e[1].data||{},a(e)}else t()},void i.send(e)}zmAjq.XHR({u:b,t:"POST",p:e,efn:function(){t()},csr:"s",fn:function(e){var t=e.data||{};a(t)}})},extractFile:function(t){var e=new FormData,a=t.data.actionData.params,i=new File([a.data],a.name);e.append("actionMode","EXTRACT_FILE_DATA"),e.append("fileName",i),e.append("zmrcsr",zmAjq.getCookie("zmcsr")),A.sendHTTPrequest(e,function(e){e.fileName=i.name,o=i,t.promise.resolve(e)},function(){t.promise.reject()})},runMailMerge:function(e){var a=e.mdata;return a.fromAddress=zmail.user.loginName,"EXTERNAL_CONTACT"===e.mdata.actionMode&&((a=new FormData).append("fromAddress",zmail.user.loginName),a.append("fileName",o),a.append("actionMode",e.mdata.actionMode),a.append("zmrcsr",zmAjq.getCookie("zmcsr")),a.append("msgId",e.mdata.msgId)),new Promise(function(t,e){A.sendHTTPrequest(a,function(e){ZMWidgets.publish("runMailMerge",e),t(e)},function(){e()})})},replacePlaceholders:function(e,i,n){var s=e;return i.headers.forEach(function(e){var t=new RegExp("{{"+e+"}}","g");if(i.values[0][e]){var a=n?i.values[0][e]:"<span class='mailMHighL'>"+i.values[0][e]+"</span>";s=s.replace(t,a||"")}}),s},showInsertFields:function(e,t,a){var i,n=e.currentTarget.parentElement,s={parentDOM:$.e(n),parWidth:e.currentTarget.parentElement.offsetWidth+"px",displayAs:"dropdown",dataCallback:function(){return t.headers.map(function(e){return{id:e,name:e}})},onSelect:function(e){i.hide(),a(e)}};(i=zmUtil.createFLComp("mmFields",s)).show(),e.preventDefault(),e.stopPropagation()},switchSentFolder:function(){zmApp.showApp("m"),$.publish("/mail/listMails",{fId:zmail.folId.sId})},enableDisable:function(e){e.dialog.$els.$buttonContainer.find(".js-button-selector[data-id="+e.index+"]").css(S,e.enable?"none":"auto")}},a=function(e){return zdom("div",{className:"zmBtn thmBdrBtn",onClick:e},g.labels.edit)},T=function(e,n){var t=5===n.values.length?g.labels.viewless:"+"+(n.values.length-5)+" "+g.labels.more,s=function(i){return i.map(function(e,t){var a=t!==i.length-1?",":"";return(e.To||e.to)&&zdom("span",null,e.To||e.to,a," ")})};return zdom("div",null,zdom("div",{className:"mailMPvw pu_bdr"},zdom("div",{className:"mailMRecpWra"},zdom("div",{className:"greyText mailMLbl"},g.labels.recipients,": "),zdom("div",{className:"mailMRecp"},zdom("span",null,s(n.values.slice(0,5))),5<n.values.length&&zdom("span",{className:"zmLink viewMore",onClick:function(e){var t=$.e(e.target),a=t.hasClass("viewMore")?n.values:n.values.slice(0,5),i=$.e(e.currentTarget.previousElementSibling);i.clearHTML(),i.appendDOM(s(a)),t.toggleClass("viewMore viewLess"),t.text(5===a.length?"+"+(n.values.length-5)+" "+g.labels.more:g.labels.viewless)}},t))),zdom("div",{className:"mailMRecpWra"},zdom("div",{className:"greyText mailMLbl"},g.labels.subject,": "),zdom("div",{className:"mailMRecp"},zdom("span",null,A.replacePlaceholders(e.SUBJECT,n,"true"))))),zdom("div",{id:"previewTemplate"}))},D=function(){return zdom("div",{className:"SC_floatLabel"},zdom("input",{type:"text",id:"Subject"}),zdom("label",null,g.labels.subject))},M=function(){return zdom("div",{className:"zmSelect zmCTempCat",id:"mmFields"},zdom("span",null,g.labels.insertField),zdom("i",{className:""}))},t=function(e){return zdom("h3",null,zdom("i",{className:"msi-readerView"}),g.labels.previewMerge,zdom("i",{className:"msi-infoRound",onClick:e}))},N=function(e,t){return zdom("div",{className:"zmFxdToolTip lt"},zdom("div",null,zdom("div",{className:"zmFxdTTipHdr"},zdom("div",{className:"zmFxdTTipHdrMsg"},g.labels.note,":"),zdom("div",null,zdom("i",{className:"msi-close",onClick:t}))),zdom("div",{className:"zmFxdTTipMsg"},e[0]),zdom("div",{className:"zmFxdTTipMsg"},e[1]),zdom("div",{className:"zmFxdTTipMsg"},e[2])))},m=function d(m,p,c,u){var e={headerClass:"SC_PUhd SC_PUtt pu_bdr",contentClass:"SC_PUcen pu_bdr"};e.buttons=[{name:g.labels.testmail,callback:function(t){A.enableDisable({dialog:t,index:0,enable:!0}),zmAjq.XHR({u:b,t:"POST",p:{headers:JSON.stringify(c.headers),values:JSON.stringify(Object.values(c.values[0])),fromAddress:zmail.user.loginName,to:zmail.user.loginName,action:"TEST_MAIL",msgId:m},efn:function(e){A.enableDisable({dialog:t,index:0,enable:!1}),_zm.succErrMsg("e",g.labels.errorMsg)},csr:"s",fn:function(){A.switchSentFolder(),_zm.succErrMsg("s",g.labels.testMail),z.remove(),z=void 0}})}},{name:zmText.applyArgs(g.labels.runmail,{count:c.values.length}),callback:function(e){A.enableDisable({dialog:e,index:1,enable:!0}),u()}}],e.dialogDidMount=function(e){e.$els.$contentWrapper[0].style.width="800px",e.$els.$contentWrapper[0].style.maxWidth="800px",e.$els.$contentWrapper[0].style.marginRight="200px",e.$els.$content[0].style.height="500px";var t=a(function(){var a,i,n,s,o,r,e,l;return z.remove(),z=void 0,a=m,i=p,n=c,s=function(e,t){d(e,t,c,u)},r=D(),e={title:g.labels.editTemplate,contentClass:"SC_PUcen pu_bdr",ignoreMouseDown:!1},l=function(e){var t="{{"+e+"}}";f.insertHTML(t)},e.buttons=[{name:g.labels.save,callback:function(e){A.enableDisable({dialog:e,index:0,enable:!0});var t={subject:$.e(r).find("#Subject")[0].value,content:f.getContent()};A.saveTemplate(a,t,function(){A.fetchTemplate(a,function(e){o.remove(),s(a,e)})},function(){A.enableDisable({dialog:e,index:0,enable:!1}),_zm.succErrMsg("e",g.labels.errorMsg)})}},{name:g.labels.cancel,isCancel:!0,callback:function(){o.remove(),s(a,i)}}],e.dialogDidMount=function(e){(o=e).$els.$contentWrapper[0].style.width="800px",e.$els.$contentWrapper[0].style.maxWidth="800px",e.$els.$content[0].style.height="500px",e.$els.$content.appendDOM(r),e.$els.$content.appendDOM(zdom("div",{id:"editTemplate"}));var t=M();e.$els.$rightHeader.appendDOM(t),$.e(t).click(function(e){A.showInsertFields(e,n,l)}),f=ZE.create({id:"editTemplate",editorheight:e.$els.$content.height()-(r.offsetHeight+60)}),$.e(r).find("#Subject")[0].value=i.SUBJECT,f.setContent(i.CONTENT)},Dialog.new(e),v&&v.remove()});e.$els.$rightHeader.appendDOM(t),e.$els.$content.appendDOM(T(p,c)),zmail.Utils.DOM.__dangerouslySetInnerHTML(e.$els.$content.find("#previewTemplate")[0],A.replacePlaceholders(p.CONTENT,c))},e.closeAction=function(){return z=void 0,v&&v.remove()},z=Dialog.new(e);var i=["1) "+zmText.applyArgs(g.labels.message1,{count:c.values.length}),"2) "+g.labels.message2,"3) "+g.labels.message3];z.$els.$leftHeader.appendDOM(t(function(e){var t=$.e(e.currentTarget);t.css(S,"none");var a=e.currentTarget.getBoundingClientRect();v=N(i,function(){t.css(S,""),v.remove()}),$.e(document.body).appendDOM(v),v.style.top=a.top-(a.bottom-a.top)/2+"px",v.style.left=a.left+a.width+7+"px"}))},p=function(t){var a,i,n,s,o,e=t.data.actionData;switch(e.action){case"templateCount":t.promise.resolve(zmail.folCount[zmail.folId.teId].c);break;case"create":A.createTemplate();break;case"select":A.chooseTemplate(t);break;case"fetchMsg":A.fetchTemplate(e.msgId,function(e){t.promise.resolve(e)},function(){t.promise.reject()});break;case"parseFile":A.extractFile(t);break;case"previewMailMerge":i=(a=t).data.actionData.params,n=i.mdata.msgId,s=i.fileData,o=function(){var e=function(){z.remove(),z=void 0};A.runMailMerge(i).then(function(){A.switchSentFolder(),_zm.succErrMsg("s",g.labels.runMsg),e()},function(){_zm.succErrMsg("e",g.labels.errorMsg),a.promise.reject(),e()})},z||A.fetchTemplate(n,function(e){a.promise.resolve(),m(n,e,s,o)},function(){a.promise.reject()}),a.promise.resolve();break;case"runMailMerge":A.runMailMerge(e.params).then(function(e){t.promise.resolve(e),z=void 0},function(){t.promise.reject()});break;case"switchSentFolder":A.switchSentFolder()}},c=zmail.Settings.MailSuite.Settings.Integration.Apps.Collection,u={},k=[200,201],_=function(i){var e=i.data.xhrObj;"POST"===e.type&&(e.headers=e.headers||{},e.headers["X-ZCSRF-TOKEN"]="zmrcsr="+zmAjq.getCookie("zmcsr")),$.ajax(i.data.xhrObj).done(function(e,t,a){try{$.isArray(e)?1===e[0]&&e[1].data&&(!e[1].data.STATUS||-1<k.indexOf(e[1].data.STATUS))?e[1].data.WebsocketID?u[e[1].data.WebsocketID]=i.promise:("function"==typeof i.callback&&i.callback(e[1].data),i.promise.resolve(e[1].data)):i.promise.reject(e[1]):200===a.status||201===a.status||204===a.status?("function"==typeof i.callback&&i.callback(),i.promise.resolve(e)):i.promise.reject({status:a.status,data:a.responseText})}catch(e){i.promise.reject({status:a.status,data:a.responseText})}finally{i.widgetID&&"popup"===I[ZApp.GetWidgetInstance(i.widgetID).__WIDGET__.location]&&ZMWidgets.toggleWidget("popup")}}).fail(function(e){i.promise.reject({status:e.status,data:e.responseText})})},R=function(e,t){var a=new XMLHttpRequest;a.open(h.type,e.url||h.url,!0),a.setRequestHeader("Content-type","application/json"),a.setRequestHeader("X-ZCSRF-TOKEN","zmrcsr="+zmAjq.getCookie("zmcsr")),a.responseType="blob",a.onload=function(){var e=Array.isArray(this.response)?"":this.response;t&&t(e)},a.send(e.data)};zmComponent.notifier&&zmComponent.notifier.addHandler("integration",function(e,t){var a=t.data||{};a.WebSocketData&&a.WebsocketID&&(-1<k.indexOf(a.WebSocketData.STATUS)?u[a.WebsocketID].resolve(a.WebSocketData):(a.WebSocketData.data=babelHelpers.objectSpread({},a.WebSocketData),u[a.WebsocketID].reject(a.WebSocketData)),delete u[a.WebsocketID])});var x,y={appId:d,zappid:d,pluginId:d,status:1,ostatus:!0,appName:"Local",manifest:"{}",manifestObj:{}},O={order:[d],list:{"0000":$.extend({},y)}},w={},i=!1,E=!0,L=!1,W=!1,H=!0,F=!1,j={},P={},Z={},U=zmail.Settings.MailSuite.Settings.Integration,B=U.Apps.Collection,G=U.Apps.MarketplaceCollection,q=U.Apps.ConfigManager,J=function(e){var t={};if(e&&!$.isEmptyObject(zmContentCache.get(e))){var a=zmContentCache.get(e);t.FROM=_zm.unescapeTags(a.FROM),t.TO=_zm.unescapeTags(a.TO),t.CC=_zm.unescapeTags(a.CC),t.BCC=_zm.unescapeTags(a.BCC),t.ACCOUNT_ID=zmail.accId,t.MSGID=e}return t},X=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length?arguments[1]:void 0;t=t||"undefined"!=typeof zmPrev&&zmPrev.prevDetails&&zmPrev.prevDetails().msgId;var i={};if(t){i=J(t);var n=$.extend({},zmContentCache.get(t),zmUtil.getMailObj(t));$.isEmptyObject(i)&&(i.FROM=_zm.unescapeTags(n.F),i.TO=_zm.unescapeTags(n.TO||""),i.CC="Not Provided"!==n.CC?_zm.unescapeTags(n.CC||""):"",i.BCC=_zm.unescapeTags(n.BCC||""),i.SUBJECT=n.SB,i.SUMMARY=n.SM,i.FOLDER_ID=n.FD),i.ACCOUNT_ID=zmail.accId,i.MSGID=t,e.forEach(function(e){var t,a;/(NEWATT|ATTACHMENT)/i.test(e)?i[e]=(t=n.NEWATT,a=[],$.isEmptyObject(t)||(a=t.map(function(e){return e.groupId=e.gId,e.entityId=e.e,e.entityType=e.et,e.attachId=e.id,e})),a):i[e]=n[e.toUpperCase()]||""})}return i},V=function(e){if(e.appId===d||(e.pluginId||e.integServiceId)&&!e.isExtLoaded){e.isExtLoaded=!0,"string"!=typeof e.manifest&&(e.manifest=JSON.stringify(e.manifest));var t=JSON.parse(e.manifest);(e.manifestObj=t).hashkey=e.encryptedHash,t.zappid=e.appId,t.id=e.appId,t.version=e.version,t.locale&&(t.locale=zmail.i18nMap[zmText.currentLang]?zmText.currentLang:zmail.user.lang);try{if(e.appId===d){var a=t.modules.widgets[0].name;a&&(O.list[d].appName=a)}}catch(e){}ZApp.LoadExtension(t)}},K=function(e){for(var t in I)if(I[t]===e)return void ZApp.RenderWidgets(t)},Y=function(e){return e&&q.get(e)&&B.has(e)},Q=function(e){return O.list[e]&&O.list[e].integServiceId},ee=function(e,t,a){a&&"function"==typeof t&&(P[a]=P[a]||{},P[a][Z[e]||e]=t)},te=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length?arguments[2]:void 0,i=3<arguments.length?arguments[3]:void 0;try{if(i)return void j[i].publish(e,t,a);for(i in j)j[i].publish(e,t,a)}catch(e){return!1}},ae=function(e,a){var i=O.list[e],t=i.manifest;"string"==typeof t&&(t=JSON.parse(t)),i.manifestObj||(i.manifestObj=t,i.widgets={}),t.modules.widgets.forEach(function(e){var t;I[e.location]&&-1===w[I[e.location]].indexOf(i.appId)&&(a||(i.widgets[I[e.location]]={isLoadedDef:$.Deferred()},"rhs"===I[e.location]&&Y((t=i).integServiceId)&&B.get(String(t.integServiceId)).on("change",function(e){j.rhs.handleSettingsChange(t.appId,e)})),w[I[e.location]].push(i.appId))})},ie=function(){for(var e in j)j[e].updatePlugins()},ne=function(t){return x=$.Deferred(),$.ajax({url:C+"/plugin/get",type:"GET",headers:{"X-ZCSRF-TOKEN":"zmrcsr="+zmAjq.getCookie("zmcsr")},dataType:"json"}).done(function(e){O.order=[d],function(){for(var e in I)w[I[e]]=[]}(),e.data.forEach(function(e){O.order.push(e.appId),O.list[e.appId]=O.list[e.appId]||{},$.extend(O.list[e.appId],e),ae(e.appId,t),V(O.list[e.appId]),e.integServiceId&&(Z[e.integServiceId]=e.appId)}),ie(),x.resolve(O)}),x},se=function(i,n){return new Promise(function(t){var a=O.list[i],e=a.integServiceId;a.pluginId?t():n?$.ajax({url:C+"/plugin/install",type:"POST",data:{appId:i,hash:a.encryptedHash,version:a.version,integServiceId:e},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-ZCSRF-TOKEN":"zmrcsr="+zmAjq.getCookie("zmcsr")}}).done(function(e){$.extend(a,e.data.pluginData),n||(a.isExtLoaded=!1,V(a)),t()}):(a.isExtLoaded||(a.isExtLoaded=!1,V(a)),t())})},oe=function(e,t,a,i){try{x||ne();var n=function(){a&&O.list[e].widgets[t].isLoadedDef.done(function(){a(e)})};x.done(function(){t=t||"rhs",e=Z[e]||e,j[t].renderApp(e,i),"rhs"!==t?se(e).then(function(){n()}):n()})}catch(e){return!1}},re=function(e){return{order:w[e],list:O.list}},e=function(e,t){j[e]||(j[e]=t)},le=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rhs";L&&(L=!1,ZMStore.getInstance("IntegAppsCollection").reFetchList()),zmUtil.getIntegSettings(),G.isLoaded||G.fetchList(),x||ne(),j[e]&&j[e].toggle()},de=function(e){var i=function(){j.rhs.remove(d),j.rhs.constructPluginList(),W=!0,(zmail.zappsTestRun||e)&&ZMWidgets.renderApp(d,"rhs")},t=function(){W=!1,j.rhs.constructPluginList()};zmail.zappsTestRun?zmUtil.fetchAppDetail(zmail.zappsTestRun.appId,zmail.zappsTestRun.version,zmail.zappsTestRun.hashkey,!0).then(function(e){O.list[d].manifest=e.appObj.manifest;var t=JSON.parse(e.appObj.manifest);t.hashkey=zmail.zappsTestRun.hashkey,t.zappid=zmail.zappsTestRun.appId,t.id=d,t.version=zmail.zappsTestRun.version,t.locale&&(t.locale=zmail.i18nMap[zmText.currentLang]?zmText.currentLang:zmail.user.lang);try{var a=t.modules.widgets[0].name;a&&(O.list[d].appName=a)}catch(e){}ZApp.LoadExtension(t),i()},t):$.ajax({url:"http://127.0.0.1:5000/plugin-manifest.json",success:function(e){O.list[d].manifest=JSON.stringify(e),V(O.list[d]),i()},error:function(e){O.list[d]=y,j.rhs.changeLocalAppConfig(y),t()}})},me=function(){return E},pe=function(){me()&&((i=!i)?(ZApp.DeleteExtension(d),de()):(ZApp.changeDevHost({protocol:"http:",host:"127.0.0.1",port:"5000",path:""}),delete zmail.zappsTestRun,j.rhs.remove(d),j.rhs.constructPluginList()))},ce=function(){return i},ue=function(e){return j[e]},ge=function(){var t=function(e){E=e.hasDevPrivilege,e.devMode&&E&&pe(),"boolean"==typeof e.marketplaceStatus&&(H=e.marketplaceStatus),e.freeOrg&&(F=!(H=!1))};zmail.IntegrationSettingData?t(zmail.IntegrationSettingData):zmUtil.getIntegSettings().then(function(e){t(zmail.IntegrationSettingData)})},fe={protocol:"http:",host:"127.0.0.1",port:"5000",path:""};zmail.zappsTestRun&&(fe={protocol:"https:",host:"{{zappid}}."+zmail.urls.pluginURL,path:"/appfiles/v2/{{zappid}}/{{version}}/{{hashkey}}"});var ze=location.protocol+"//"+window.location.hostname,ve=ze,Ce=zmUtil.getUrlParams(location.href).frameorigin;Ce&&Ce!==ze&&(ve=Ce+","+ze);var he={serverConfig:{zappsHost:{protocol:"https:",host:"{{zappid}}."+zmail.urls.pluginURL,path:"/appfiles/v2/{{zappid}}/{{version}}/{{hashkey}}",frameOrigin:"frameorigin="+ve},devHost:fe},isDevMode:!1,RenderHandlers:{WidgetHandler:function(e,t){return j[I[e]]&&j[I[e]].renderHandler(t)}},EventListeners:{APP_EVENT:function(t){if(ZMWidgets.validateForEvents(t)){var a,e=zmail.zappsTestRun&&ZMWidgets.getWidgetInstance("rhs").getSelectedApp()===d?d:ZApp.GetExtensionInstance(t.extension_id).zappid,i=ZMWidgets.getPluginData(e),n=i&&i.integServiceId,s=ZApp.GetExtensionInstance(t.extension_id),o=function(e){(a={url:C+"/plugin/"+i.pluginId+"/"+t.data.operation+e,type:"get"===t.data.operation?"GET":"POST"}).data=t.data.params,"set"===t.data.operation&&(a.headers={"Content-Type":"application/json"}),t.data.xhrObj=a,_(t)};switch(t.data.name){case"init":if(a={fontId:l[zmAdHocSettings.getFont()]||l[zmAdHocSettings.getFontDefault()],isNightMode:"1"===zmAdHocSettings.getNightMode()},ZMWidgets.isAppSettingsAvail(n)){var r=c.getIntegAppConfig(n).get("integList");a.settingData=r&&r[0]||{}}a.currentLang=zmail.i18nMap[zmText.currentLang]?zmText.currentLang:zmail.user.lang,t.promise.resolve(a);break;case"appLoaded":ZMWidgets.updateLoadedWidget(i.appId,ZApp.GetWidgetInstance(t.widgetID).__WIDGET__.location),ZMWidgets.publish("mail_preview",ZMWidgets.getMailPreviewDetails());break;case"params":o("Params");break;case"data":o("Data");break;case"invokeUrl":if(a=$.extend({},h),t.data.xhrObj.appId=i.appId,t.data.xhrObj.fileData&&t.data.xhrObj.file){!function(t){var e=t.data.xhrObj,a=new FormData,i=new File([e.fileData],e.file.fileName);delete e.fileData,a.append("payload",JSON.stringify({data:e})),a.append("fileData",i),a.append("zmrcsr",zmAjq.getCookie("zmcsr"));var n=new XMLHttpRequest;n.open("POST",h.url),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status)try{var e=JSON.parse(n.response);e[0]&&t.promise.resolve(e[1].data),t.promise.reject()}catch(e){t.promise.reject()}else t.promise.reject()},n.send(a)}(t);break}if(a.data=JSON.stringify({data:t.data.xhrObj}),"BLOB"===t.data.xhrObj.contentType){R(a,function(e){e?t.promise.resolve(e):t.promise.reject()});break}t.data.xhrObj=a,_(t);break;case"hideComp":zmUtil.hideMenu();break;case"drop":i.listenDrop=t.data.toListen;break;case"openSettings":ZMWidgets.renderAppSettings(s.zappid,I[ZApp.GetWidgetInstance(t.widgetID).__WIDGET__.location]);break;case"connectorParams":a={url:C+"/connectors.do",type:"GET",data:{action:"GET_EXTRADETAILS",detailType:t.data.paramType,serviceName:t.data.serviceName,uid:e===d?zmail.zuid:e}},t.data.xhrObj=a,_(t)}}},MAIL_EVENT:function(a){if(ZMWidgets.validateForEvents(a)){var t=ZApp.GetExtensionInstance(a.extension_id),e=ZMWidgets.getPluginData(t.zappid),i=!1;switch(a.data.name){case"currentMailInfo":a.promise.resolve(ZMWidgets.getMailPreviewDetails(a.data.customFields));break;case"currentComposeMailInfo":var n=[];if("undefined"!=typeof zmComp&&"undefined"!=typeof zmCUtil&&zmComp.getCurrentCompId()){var s=zmCUtil.getContactsEmails(zmComp.getCurrentCompId(),"to"),o=zmCUtil.getContactsEmails(zmComp.getCurrentCompId(),"cc"),r=zmCUtil.getContactsEmails(zmComp.getCurrentCompId(),"bcc");n=s?s.split(","):[],n=o?n.concat(o.split(",")):n,n=r?n.concat(r.split(",")):n}a.promise.resolve(n);break;case"mailInfo":a.promise.resolve(ZMWidgets.getMailPreviewDetails(a.data.customFields,a.data.msgId));break;case"fetchMailInfo":zmList.sendMailDataReq({accId:a.data.ACCOUNT_ID,msgId:a.data.MSGID,folId:a.data.FOLDER_ID},{},function(){a.promise.resolve(ZMWidgets.getMailPreviewDetails(a.data.customFields,a.data.MSGID))},function(){a.promise.reject()});break;case"compose":var l=a.data.mailData;"insert"===a.data.mode&&"string"==typeof l?"undefined"!=typeof zmComp&&zmComp.getCurrentCompId()?zmComp.getEditor(zmComp.getCurrentCompId()).insertHTML(l):zmUtil.compose({CONTENT:l}):a.data.mode||zmUtil.compose(l).then(function(e){l.ATTACHMENT&&zmComp.getAttRef(e).uploadFiles(l.ATTACHMENT)}),a.promise.resolve();break;case"attach":"undefined"!=typeof zmComp&&zmComp.getCurrentCompId()?zmComp.getAttRef(zmComp.getCurrentCompId()).uploadFiles(a.data.files):zmUtil.compose().then(function(e){zmComp.getAttRef(e).uploadFiles(a.data.files)});break;case"hugeAttach":var d=String(e.integServiceId);if(ZMWidgets.hasEventCallback("hugeAttach",t.zappid))ZMWidgets.getEventCallback("hugeAttach",t.zappid)({fileList:a.data.files,appId:t.zappid,appType:d});else{var m=[{fileList:a.data.files,appId:t.zappid,appType:e.integServiceId}];"undefined"!=typeof zmComp&&zmComp.getCurrentCompId()?zmComp.getAttRef(zmComp.getCurrentCompId()).addFiles(m):zmUtil.openComposeWithAtt(m)}break;case"mailActions":if(a.data.msgId){var p={loadApp:"integration",msgId:a.data.msgId,mode:a.data.mode,type:"t"};a.data.composeData&&a.data.composeData.TO&&(p.predata={TO:a.data.composeData.TO}),zmUtil.cmpReply(p),a.promise.resolve()}break;case"associateApp":a.data.xhrObj={url:C+"/plugin/customData?appId="+t.zappid+"&messageId="+a.data.msgId+"&accId="+zmail.accId,type:"POST",contentType:"application/json",data:JSON.stringify(a.data.mapData)},a.callback=function(){var e=ZMWidgets.getMailPreviewDetails(["MSGINTEG"],a.data.msgId).MSGINTEG||{},t=a.data.mapData;e[10]?e[10].forEach(function(e){String(e.appId)===a.extension_id&&(e.appData=t)}):e[10]=[{appData:t,appId:ZApp.GetExtensionInstance(a.extension_id).zappid}]},i=!0,_(a);break;case"integData":var c,u=ZMWidgets.getMailPreviewDetails(["MSGINTEG"],a.data.msgId).MSGINTEG;u&&u[10]&&u[10].forEach(function(e){e.appId===t.zappid&&(c=e.appData)}),a.promise.resolve(c);break;case"downloadAttachment":var g=$.extend({},h);g.url=C+"/plugin/attachFromMail",a.data.attachInfo.accId=zmail.accId;var f={appId:t.zappid,attachment:a.data.attachInfo};g.data=JSON.stringify({data:$.extend(f,a.data.callbackApi)}),a.data.xhrObj=g,a.data.callbackApi?(i=!0,_(a)):R(g,function(e){e?a.promise.resolve(e):a.promise.reject()});break;case"uploadAttachment":var z,v=$.extend({},h);v.url=C+"/plugin/attachToMail",a.data.attachApiXhr.appId=t.zappid,v.data=JSON.stringify({data:a.data.attachApiXhr}),a.data.xhrObj=v,a.callback=function(e){try{var t={sN:(e=JSON.parse(e.response)[1].uploadResponseData)[0],size:e[1],fP:e[2],name:e[3]};zmComp.getAttRef(z).addFiles([t])}catch(e){return}},i=!0,"undefined"!=typeof zmComp&&zmComp.getCurrentCompId()?(z=zmComp.getCurrentCompId(),_(a)):zmUtil.compose().then(function(e){z=e,_(a)})}"popup"!==I[ZApp.GetWidgetInstance(a.widgetID).__WIDGET__.location]||i||ZMWidgets.toggleWidget("popup")}},CONTACT_EVENT:function(e){if(ZMWidgets.validateForEvents(e))switch(e.data.name){case"contactInfo":var t={promise:!1,type:["personal","org"]};e.data.eid&&(t.eid=e.data.eid),e.data.zuid&&(t.zuid=String(e.data.zuid));var a=zmail.ContactBook.get(t)[0];(a=a&&a.attrs)||(a={eid:e.data.eid,zid:e.data.zuid}),delete a.avatar,e.promise.resolve(a)}},INHOUSE_EVENT:function(e){var t=ZApp.GetExtensionInstance(e.extension_id),a=ZMWidgets.getPluginData(t.zappid);if(ZMWidgets.isPrivilegedDev()&&ZMWidgets.isDevModeEnabled()||ZMWidgets.isInhouseApp(t.zappid))switch(e.data.name){case"zmailMeta":if($.isArray(e.data.key)){var i={};e.data.key.forEach(function(e){i[e]=zmail[e]}),e.promise.resolve(i)}else e.promise.resolve({data:zmail[e.data.key]});break;case"getConfig":e.data={xhrObj:{url:C+"/integAction.do",data:{action:"GET_CONFIGURED_ACCS",appType:a.integServiceId},type:"GET"}},_(e);break;case"invokeApi":!e.data.xhrObj.url&&a.integServiceId&&(e.data.xhrObj.url=C+"/"+n[a.integServiceId],-1<r.indexOf(a.integServiceId)&&(e.data.xhrObj.data=e.data.xhrObj.data||{},e.data.xhrObj.data.sessionID=zmail._ws&&zmail._ws.sessionId)),_(e);break;case"filterAction":ZMWidgets.hasEventCallback(e.data.name,t.zappid)&&ZMWidgets.getEventCallback(e.data.name,t.zappid)(e.data.folderInfo);break;case"templateAction":p(e);break;case"installPlugin":a.pluginId?e.promise.resolve():se(a.appId,!0).then(function(){e.promise.resolve()})}else e.promise.reject()}}};ZApp.Bootstrap(he),ge();var Ie,be,Se,Ae=$.q("body"),Te="rhsOnboarding",De="integration/intro/slider/",Me=$.q(".zmRhsPane"),Ne={},ke=function(){return zdom("div",{className:"zmIntegLoad fixedCenter"},zdom("div",null),zdom("div",null),zdom("div",null),zdom("div",null))},_e=function(){Me.find(".zmIntegIntroFlipEle").removeClass("zmAnimateIBox"),ue("rhs").switchToHome()},Re=function(){Ne.configRef.addClass("zmHideD"),ue("rhs").renderAppSettings()},xe=function(){ZApp.DeleteExtension(d),de(!0)},ye=function(){ue("rhs").toggle()},Oe=function(){zmail.Commander.execute(zmail.Commander.getCommand("load-integrations-settings"))},we=function(){Ne.moreAppsRef.hasClass("show")?Ne.moreAppsRef.find("i")[0].className="msi-tarrowD":(Ne.moreAppsRef.find("i")[0].className="msi-barrowD",ue("rhs").renderMoreApps()),Ne.moreAppsRef.toggleClass("show")},$e=function(e){ue("rhs").filter(e.target.value)},Ee=g.onboarding,Le=new(function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"getView",value:function(){this.$el=$.e(this.template()),this.bindActions()}},{key:"template",value:function(){return zdom("div",{className:"zmIntroRhs"},zdom("div",{className:"zmIntegIntro"},zdom("div",{className:"zmIntegIntroTexture"},zdom("div",{className:"zmIntegIntroWrapper"},zdom("div",{className:"zmCarousel_text"},zdom("div",{className:"zmCarousel_textFinal"},zdom("span",{className:"zmCelebImg zmCelebImgLeft"}),zdom("span",{className:"zmCelebImg zmCelebImgRight"}),zdom("h2",null,"Introducing ",zdom("span",{className:"zmCelebFinalTxt",id:"finalTxt"},"extension"),"Widget")),zdom("div",{className:"zmCarousel_text1 zmCarousel_textActive"},zdom("p",null,zmText.applyArgs(Ee.text1,{breakLine:zdom("br",null)}),zdom("b",null,Ee.text1_1))),zdom("div",{className:"zmCarousel_text2"},zdom("p",null,zmText.applyArgs(Ee.text2,{breakLine:zdom("br",null)}))),zdom("div",{className:"zmCarousel_text3"},zdom("p",null,zmText.applyArgs(Ee.text3,{breakLine:zdom("br",null)}))),zdom("div",{className:"zmCarousel_text4"},zdom("p",null,zmText.applyArgs(Ee.text4,{breakLine:zdom("br",null)}))),zdom("div",{className:"zmCarousel_text5"},zdom("p",null,zmText.applyArgs(Ee.text5,{breakLine:zdom("br",null)})))),zdom("div",{className:"zmCarousel"},zdom("div",{className:"zmCarousel_item zmCarousel_item1"},zdom("div",{className:"zmCarousel_img zmCarousel_jpg"},zdom("img",{src:zmResource.get("image",De+"screw.jpg")})),zdom("div",{className:"zmCarousel_img zmCarousel_gif"},zdom("img",{src:zmResource.get("image",De+"screw.gif")}))),zdom("div",{className:"zmCarousel_item zmCarousel_item2"},zdom("div",{className:"zmCarousel_img zmCarousel_jpg"},zdom("img",{src:zmResource.get("image",De+"opener.jpg")})),zdom("div",{className:"zmCarousel_img zmCarousel_gif"},zdom("img",{src:zmResource.get("image",De+"opener.gif")}))),zdom("div",{className:"zmCarousel_item zmCarousel_item3"},zdom("div",{className:"zmCarousel_img zmCarousel_jpg"},zdom("img",{src:zmResource.get("image",De+"cork.jpg")})),zdom("div",{className:"zmCarousel_img zmCarousel_gif"},zdom("img",{src:zmResource.get("image",De+"cork.gif")}))),zdom("div",{className:"zmCarousel_item zmCarousel_item4"},zdom("div",{className:"zmCarousel_img zmCarousel_jpg"},zdom("img",{src:zmResource.get("image",De+"hacksaw.jpg")})),zdom("div",{className:"zmCarousel_img zmCarousel_gif"},zdom("img",{src:zmResource.get("image",De+"hacksaw.gif")}))),zdom("div",{className:"zmCarousel_item zmCarousel_active"},zdom("div",{className:"zmCarousel_img zmCarousel_jpg"},zdom("img",{src:zmResource.get("image",De+"scissors.jpg")})),zdom("div",{className:"zmCarousel_img zmCarousel_gif"},zdom("img",{src:zmResource.get("image",De+"scissor.gif")}))),zdom("div",{className:"zmCarousel_item zmCarousel_final "},zdom("div",{className:"zmCarousel_img zmCarousel_jpg"},zdom("img",{src:zmResource.get("image",De+"scissors.jpg")})),zdom("div",{className:"zmCarousel_img zmCarousel_gif"},zdom("img",{src:zmResource.get("image",De+"swiss.gif")})))),zdom("div",{className:"zmCarousel_nav"},zdom("span",{className:"active","data-id":"1"}),zdom("span",{"data-id":"2"}),zdom("span",{"data-id":"3"}),zdom("span",{"data-id":"4"}),zdom("span",{"data-id":"5"}),zdom("span",{"data-id":"6"})),zdom("div",{className:"zmCarousel_ctrl"},zdom("div",{className:"zmCarousel_prevSlide zmHideD"},zdom("span",{className:"zmPrevIcon"})),zdom("div",{className:"zmCarousel_nextSlide"},zdom("span",{className:"zmNextIcon"}))),zdom("div",{className:"zmIntegIntroTxt"},zdom("p",{style:{"font-size":"18px"}},zmText.applyArgs(Ee.intro,{breakLine:zdom("br",null)})),zdom("span",{className:"zmIntegIntroBtn pointerEventsNone"},Ee.show)),zdom("div",{className:"zmIntegSkip"},zdom("span",null,Ee.skip))))),zdom("div",{className:"zmIntegIntroFlipEle"}))}},{key:"bindActions",value:function(){var t=this,n=1,e=zmComponent.keybindings.getScope(),s=this.$el.find(".zmCarousel_prevSlide"),o=this.$el.find(".zmCarousel_nextSlide"),i=this.$el.find(".zmIntegSkip");this.$el.find(".zmIntegSkip,.zmIntegIntroBtn").bind("click",function(){zmComponent.keybindings.scopeInfos.hasOwnProperty(Te)&&(zmComponent.keybindings.dropScope(Te),zmComponent.keybindings.setScope(e)),Ae.find(".msi-integration").closest("li").removeClass("zmActiveInteg"),Me.css("z-index",""),zmAdHocSettings.setRhsOnBoarding("false"),Me.addClass("flipped"),Me.find(".zmIntegIntroFlipEle").addClass("zmAnimateIBox"),setTimeout(function(){Me.find(".zoSidebar_container").fadeIn(600)},1e3),Ne.listRef.addClass("zmAniIntegL"),setTimeout(function(){Ae.find(".blkMask").fadeOut(150,function(){Ae.find(".blkMask").remove(),Me.css("z-index","")}),t.$el.remove(),Me.removeClass("zmRhsOnboard flipped")},1700),setTimeout(function(){Ne.listRef.removeClass("zmAniIntegL")},1e3*(.5*ZMWidgets.getPluginsByLocation("rhs").order.length+1.5))}),this.$el.find(".zmCarousel_nav span").bind("click",function(e){for(var t=$.e(e.target).data("id"),a=n<t?o:s,i=Math.abs(t-n);i--;)a.click()}),o.bind("click",function(){t.$el.find(".zmCarousel_textActive").removeClass("zmCarousel_textActive").next().addClass("zmCarousel_textActive");var e=t.$el.find(".zmCarousel_active").removeClass("zmCarousel_active");s.removeClass("zmHideD"),t.$el.find(".zmCarousel_item4").removeClass("zmCarousel_item4").addClass("zmCarousel_active"),t.$el.find(".zmCarousel_item3").removeClass("zmCarousel_item3").addClass("zmCarousel_item4"),t.$el.find(".zmCarousel_item2").removeClass("zmCarousel_item2").addClass("zmCarousel_item3"),t.$el.find(".zmCarousel_item1").removeClass("zmCarousel_item1").addClass("zmCarousel_item2"),e.addClass("zmCarousel_item1"),t.$el.find(".zmCarousel_nav .active").removeClass("active").next().addClass("active"),5===n&&(setTimeout(function(){t.$el.find(".zmIntegIntroBtn").addClass("zmAnimateBtn").removeClass("pointerEventsNone")},8e3),t.$el.find(".zmIntegIntroTxt").addClass("zmIntegIntroTxtShw"),setTimeout(function(){t.$el.find(".zmCarousel").addClass("combine")},300),e.addClass("zmCarousel_activeFinal"),t.$el.find(".zmCarousel_final").addClass("zmCarousel_activeFinal"),t.$el.find(".zmCarousel_textFinal").addClass("zmCarousel_textActive"),t.$el.find(".zmCarousel_ctrl,.zmCarousel_nav").addClass("zmHideD"),setTimeout(function(){t.$el.find(".zmCarousel_final").addClass("zmCarousel_active")},2e3)),n++}),s.bind("click",function(){t.$el.find(".zmCarousel_textActive").removeClass("zmCarousel_textActive").prev().addClass("zmCarousel_textActive");var e=t.$el.find(".zmCarousel_active").removeClass("zmCarousel_active");t.$el.find(".zmCarousel_item1").removeClass("zmCarousel_item1").addClass("zmCarousel_active"),t.$el.find(".zmCarousel_item2").removeClass("zmCarousel_item2").addClass("zmCarousel_item1"),t.$el.find(".zmCarousel_item3").removeClass("zmCarousel_item3").addClass("zmCarousel_item2"),t.$el.find(".zmCarousel_item4").removeClass("zmCarousel_item4").addClass("zmCarousel_item3"),e.addClass("zmCarousel_item4"),t.$el.find(".zmCarousel_nav .active").removeClass("active").prev().addClass("active"),1===--n&&s.addClass("zmHideD")});var a=[function(e,t,a){switch(a.preventDefault(),a.stopPropagation(),e){case"prevSlide":1<n&&n<6&&s.click();break;case"nextSlide":n<6&&1<=n&&o.click();break;case"close":i.click()}}],r={scope:Te,allowDefaultScope:!1,defaultOccurrence:!0,shortcuts:[{uid:"prevSlide",keyStr:"leftArrow",scope:Te,actions:a,preventDefault:!0},{uid:"nextSlide",keyStr:"rightArrow",scope:Te,actions:a,preventDefault:!0},{uid:"close",keyStr:"esc",scope:Te,actions:a,preventDefault:!0},{uid:"donothingTab",keyStr:"tab",scope:Te,actions:a,preventDefault:!0},{uid:"donothingShiftTab",keyStr:"shift+tab",scope:Te,actions:a,preventDefault:!0},{uid:"donothingCtrlTab",keyStr:"ctrl+tab",scope:Te,actions:a,preventDefault:!0}]};document.activeElement.blur(),zmComponent.keybindings.registerAll(r),zmComponent.keybindings.setScope(Te)}}]),e}()),We=zmail.Settings.MailSuite.Settings.Integration,He=We.Apps.Collection,Fe=We.Apps.ConfigManager,je=function(e){var t,a=!1===e.ostatus?" cursorDefault":"",i="",n=Fe.get(e.integServiceId);Y(e.integServiceId)&&((t=He.getIntegAppConfig(e.integServiceId)).get("allowedForPlan")&&t.get("ostatus")&&!t.isConfigured()||(a=" cursorDefault"));return(!1===e.ostatus||t&&!t.get("ostatus"))&&(i=" zmSILDisable"),zdom("div",{className:"zmSIL"+a+i,"data-appid":e.appId,onClick:function(){a||Me.find(".zmSIL[data-appid="+e.appId+"]").click()}},zdom("div",{className:"zmSILWrap"},t&&t.get("new")&&!e.pluginId?zdom("span",{className:"zmIntegNew"},"NEW"):"",zdom("div",{className:"SC_avtr noBdr"+(e.logoUrl?"":" zmThmAvtr")},e.logoUrl&&zdom("img",{src:e.logoUrl})||zdom("span",null,e.displayName.substr(0,1))),zdom("div",{className:"zmSILC"},zdom("h3",null,n?n.displayName:e.appName),zdom("p",null,g.desc&&g.desc[e.integServiceId]||n&&n.desc||"")),t&&!t.get("allowedForPlan")?zdom("div",{className:"zmIntegPremium"},zdom("i",{className:"msi-crown","data-tooltip-pos":"left","data-tooltip":zmText.applyArgs(s.featureAvailableInPaidPlan,{featureName:n.displayName})})):""),a&&zdom("div",{className:"zmSILBtm"},function(i,e){if(!1===i.ostatus||e&&!e.get("ostatus"))return zdom("div",{className:"zmSILDisableTxt "},zdom("h5",null,zdom("i",{className:"msi-fail zmDoubleIcon"}),s.integdis),zdom("p",{className:"zmSetIBDesc"},s.integdisdesc));if(!e||e.get("allowedForPlan"))return zdom("div",{className:"zmToggleBBtn off","data-tooltip-pos":"left","data-tooltip":g.enable,onClick:function(e){var t=e.target.closest(".zmSIL");$.e(e.target).toggleClass("on off");var a=He.getIntegAppConfig(i.integServiceId);a.toggleStatus(!0,{integId:a.get("integList")[0].integId}),$.e(t).addClass("zmAniSlideOut"),t.remove()}},zdom("span",{className:"zmTBBWra"},zdom("span",{className:"zmTBBswitch"})));var t;return zmail.bizData&&zmail.bizData.links&&(zmail.bizData.links.forEach(function(e){"UPG"===e.linkType&&(t=e.link)}),t)?zdom("div",{className:"zmLink",onClick:function(){e&&e.get("new")&&($.q("[data-appid="+i.appId+"]").find(".zmIntegNew").remove(),e.toggleNewStatus()),_zm.windowOpen(t)}},s.upgrade):void 0}(e,t)))},Pe=zmail.Settings.MailSuite.Settings.Integration,Ze=Pe.Constants,Ue=Pe.Apps.Collection,Be=Pe.Apps.MarketplaceCollection,Ge=Pe.Apps.ConfigManager,qe=[d],Je=[],Xe={},Ve=!1,Ke="[data-appid=",Ye=".zmSIL[data-appid=",Qe=".zmSIL:not(.zmHideD)",et=".pluginBox",tt=".zmFavInteg:not(.zmHideD)",at=".zmPluginOverlay",it=function(e){Je.indexOf(e)<0&&Je.push(e)},nt=function(e){(e===d&&!ZApp.isDevMode()||e!==d&&ZApp.isDevMode())&&ZApp.toggleDevMode()},st=function(){var n=[];qe.forEach(function(e){if(Xe[e]){var t,a=Xe[e].integServiceId;if(!a||a.toString()!==Ze.SLACK){Y(a)&&(t=Ue.getIntegAppConfig(a));var i=function(e){var t,a=Xe[e],i=a.favorite,n=Ge.get(a.integServiceId),s=Y(a.integServiceId),o=e===d;s&&(t=Ue.getIntegAppConfig(a.integServiceId).get("new"),i=Ue.getIntegAppConfig(a.integServiceId).get("favorite")),ce()&&me()&&(o=!1),nt(e),a.logoUrl="",a.displayName=a.appName,n?(a.logoUrl=zmResource.get("image",n.imgSrc),a.displayName=n.displayName):a.logo?a.logoUrl="//marketplace"+zmail.urls.mailURL.substr(zmail.urls.mailURL.indexOf("."))+a.logo:a.manifestObj.logo&&a.pluginId&&(a.logoUrl=ZApp.GetExtensionBaseURL(e)+"/"+a.manifestObj.logo);var r="";(i||e===d)&&(r=" zmFavInteg");var l=a.manifestObj?a.manifestObj.description:"";return zdom("div",{className:"zmSIL"+r+(o?" zmHideD":""),"data-appid":e},zdom("div",{className:"zmSILWrap"},t&&!a.pluginId?zdom("span",{className:"zmIntegNew"},"NEW"):"",zdom("div",{className:"SC_avtr noBdr"+(a.logoUrl?"":" zmThmAvtr")},a.logoUrl&&zdom("img",{src:a.logoUrl})||zdom("span",null,a.displayName.substr(0,1))),zdom("div",{className:"zmSILC"},zdom("div",{className:"zmSILHdr"},zdom("h3",null,a.displayName),e===d&&zdom("div",{className:"zmSILRL"},zdom("i",{className:"msi-play"}),zdom("span",null,zmail.zappsTestRun?g.testRun:g.localRun))),zdom("p",null,g.desc&&g.desc[a.integServiceId]||n&&n.desc||a.tagline||l||"")),e!==d&&zdom("div",{className:"zmSILIcon"},zdom("i",{className:"msi-fav "+(a.favorite?"zmFav":"")}))))}(e);t&&!t.hasUserPermission()||n.push(i),(t?!t.hasUserPermission()||t.isUserDisabled()||Xe[e].isConfigRequired&&!t.isConfigured()&&!t.get("new"):!1===Xe[e].ostatus||2===Xe[e].status||Xe[e].isConfigRequired)&&(it(e),$.e(i).addClass("zmHideD"),Ie||(Ne.viewerRef.addClass("zmWMApps"),Ne.moreAppsRef.removeClass("zmHideD")))}}}),n.length&&Ne.listRef.clearHTML().appendDOM(n),Ne.listRef.find(tt).filter(":last").addClass("zmFavLast")},ot=function(){var e=(Ne.headerRef.outerHeight(!0)||0)+($.q(".zmTopBar").outerHeight(!0)||0)+(Me.outerHeight()-Me.height());Ue.getIntegAppConfig(Ze.CHATLET).getStatus()&&(e+=zmsuite.$el.chatBarDummyDOM.outerHeight()||0);return"calc(100vh - "+e+"px)"},rt=function(e){te("app_visible",Boolean(e))},lt=function(){var e=zmAdHocSettings.getEWidgetState();e.isOpen===Ve&&e.selectedApp===Ie||(e.isOpen=Ve,e.selectedApp=Ie,zmAdHocSettings.setEWidgetState(e))},dt=function(e){e&&Me.find(".pluginSettings")[0]&&(Pe.View.ViewManager.get(Xe[e].integServiceId).rhsunmount(),Me.find(".pluginSettings").remove())},mt=function(){Ne.listRef.find(".zmSIL").bind("click",function(e){var t=e.target.closest(".zmSIL").dataset.appid,a=Xe[t],i=a.integServiceId,n=Ge.get(i),s=Ie;(function(e){var t="zmSWorstCase";if(e===d&&!W){if(Ne.containerRef.addClass("zoSCenterAlign"),Ne.containerRef.find("."+t)[0])return Ne.containerRef.find("."+t).show();var a=$.e(zdom("div",{className:t},zdom("i",{className:"msi-infoRound"}),zdom("div",{className:"zmSWorstCaseMsg"},g.runExtension),zdom("div",{className:"zmSWorstCaseMsg zmLink"},g.learnMore)));return a.find(".zmLink").click(function(){window.open(window.location.protocol+"//www."+zmail.zohoUrl+"/mail/help/developer-platform.html#alink7","_blank")}),Ne.containerRef.addClass("zoSCenterAlign"),$.e(Ne.containerRef).prependDOM(a)}Ne.containerRef.removeClass("zoSCenterAlign"),Ne.containerRef.find("."+t)[0]&&Ne.containerRef.find("."+t).hide()})(Ie=t),Ne.viewerRef.find(".zoSidebar_search").addClass("zmHideD"),Ne.listRef.hide(),Ne.integSettingRef.addClass("zmHideD"),Ne.moreAppsRef.addClass("zmHideD"),Ne.moreAppsRef.removeClass("show"),Ne.viewerRef.removeClass("zmWMApps"),nt(t);var o="span.appName",r=Y(i)&&Ue.getIntegAppConfig(i);!a.pluginId&&r&&n.isOpenable&&!r.isConfigured()?(Ne.titleRef.find("img").removeClass().attr("src",zmResource.get("image",n.imgSrc)),Ne.titleRef.find(o).text(n.displayName),be.renderAppSettings(t)):se(a.appId).then(function(){var e=Xe[t];a.logoUrl?Ne.titleRef.find("img").removeClass().attr("src",a.logoUrl):Ne.titleRef.find("img").addClass("zmHideD").attr("src",""),Ne.titleRef.find(o).text(e.displayName),Ne.homeRef.removeClass("zmHideD"),dt(s),Me.find(et).hide(),Ne.refreshRef.addClass("zmHideD"),Y(e.integServiceId)&&Ge.get(e.integServiceId).isOpenable?Ne.configRef.removeClass("zmHideD"):(Ne.configRef.addClass("zmHideD"),e.appId===d&&Ne.refreshRef.removeClass("zmHideD")),Me.find("#"+e.appId)[0]?(te("mail_preview",X()),Me.find("#"+e.appId).show(),rt(!0)):K("rhs")}),$.e(e.target.closest(".zmSIL")).find(".zmIntegNew").remove(),r&&r.get("new")&&r.toggleNewStatus(),lt()}),Ne.listRef.find(".msi-fav").bind("click",function(e){e.stopPropagation(),Ne.listRef.removeClass("zmAniIntegL"),$.e(e.target).toggleClass("SC_nopntr");var t=$.e(e.target.closest(".zmSIL")).data("appid"),a=Xe[t];a.integServiceId?Ue.getIntegAppConfig(a.integServiceId).toggleFavorite():Be.has(t)&&Be.get(String(t)).toggleFavorite()})};e("rhs",be=new(function(){function e(){var t=this;babelHelpers.classCallCheck(this,e),this.$ele=$.e(zdom("div",{className:"zoSidebar_viewer",ref:function(e){Ne.viewerRef=$.e(e)}},zdom("div",{className:"zoSidebar_header",ref:function(e){Ne.headerRef=$.e(e)}},zdom("div",{className:"zmSidebarHdr"},zdom("div",{className:"SCmb zmSidebarHome"},zdom("ul",null,zdom("li",{className:"zmHideD","data-tooltip-pos":"left","data-tooltip":g.home,ref:function(e){Ne.homeRef=$.e(e)},onClick:_e},zdom("b",{className:"js-icon-selector"},zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-integration zmDoubleIcon"})))),zdom("li",{"data-tooltip-pos":"left","data-tooltip":g.integSettings,ref:function(e){Ne.integSettingRef=$.e(e)},onClick:Oe},zdom("b",{className:"js-icon-selector"},zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-integSettings"})))))),zdom("div",{className:"zmSidebarTitle",ref:function(e){Ne.titleRef=$.e(e)}},zdom("img",{className:"zmHideD"}),zdom("span",{className:"appName"},g.integrations),zdom("span",{className:"zmIntegTitleIcon zmHideD","data-tooltip-pos":"left","data-tooltip":g.editConfig,ref:function(e){Ne.configRef=$.e(e)},onClick:Re},zdom("i",{className:"msi-settings"})),zdom("span",{className:"zmIntegTitleIcon zmHideD","data-tooltip-pos":"left","data-tooltip":g.refreshApp,ref:function(e){Ne.refreshRef=$.e(e)},onClick:xe},zdom("i",{className:"msi-refresh"}))),zdom("div",{className:"SCmb noPad",onClick:ye},zdom("ul",null,zdom("li",null,zdom("b",{className:"js-icon-selector"},zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-close"})))))))),zdom("div",{className:"zoSidebar_search"},zdom("div",{className:"zmIconLabel SC_floatLabel flBox"},zdom("i",{className:"msi-search"}),zdom("input",{type:"text",placeholder:g.searchApps,onInput:$e}))),zdom("div",{className:"zoSidebar_content",ref:function(e){Ne.containerRef=$.e(e)}},zdom("div",{className:"zmSInteg",ref:function(e){Ne.listRef=$.e(e)}},ke()),zdom("div",{className:"zmSIntegAdd",ref:function(e){Ne.favMsgRef=$.e(e)}},zdom("span",null,g.favAdded))),zdom("div",{className:"zmWMoreInteg zmHideD",ref:function(e){Ne.moreAppsRef=$.e(e)}},zdom("div",{className:"zmWMoreIntegBtn"},zdom("span",{className:"zmThmClr",onClick:we},g.moreApps,zdom("i",{className:"msi-tarrowD"}))),zdom("div",{className:"zmWMoreIntegList"},zdom("div",{className:"zsb_integs",ref:function(e){Ne.moreAppsListRef=$.e(e)}}))))),zmModules.getRHSModule().then(function(e){(0,e.rhs)().dom.find(".zoSidebar_container").appendDOM(t.$ele),$.q(".zmRhsPane").on("transitionend",function(){$.publish("setIntegBanner")}),Ue.get(Ze.CHATLET)&&Ue.get(Ze.CHATLET).on("change",function(){Ne.containerRef.find("iframe").height(ot())})})}return babelHelpers.createClass(e,[{key:"constructPluginList",value:function(){Ne.listRef.clearHTML().appendDOM(ke()),Ne.viewerRef.removeClass("zmWMApps"),Ne.moreAppsRef.addClass("zmHideD"),st(),mt(),this.renderMoreApps()}},{key:"updatePlugins",value:function(){var e=re("rhs");(qe=e.order).indexOf(d)<0&&qe.unshift(d),Xe=e.list,this.constructPluginList()}},{key:"changeLocalAppConfig",value:function(e){Xe[d]=e}},{key:"toggle",value:function(){if(rt(!Ve),Ae.toggleClass("SC_nrp"),$.q(".zmRhsPane").parent().toggleClass("showPane"),Ve=!Ve){if($.publish("/integ/rhs/start",{}),"true"===zmAdHocSettings.getRhsOnBoarding()){Ae.appendDOM(zdom("div",{className:"blkMask",id:"onboardingBlkMask"})),Ae.find(".msi-integration").closest("li").addClass("zmActiveInteg"),Me.find(".zoSidebar_container").hide(),Le.getView();var e=$.e(Le.$el);Me.prependDOM(e),e.click()}te("mail_preview",X(),this.selectedAppId)}else _zm.setCookie("ZM-rpane","1");setTimeout(function(){$.publish("/integ/rhs",{isOpen:Ve})},300),setTimeout(function(){Ae.hasClass("SC_nrp")?(Me.find(".zmIntegIntroFlipEle").removeClass("zmAnimateIBox"),_zm.setCookie("ZM-rpane","1")):("true"===zmAdHocSettings.getRhsOnBoarding()&&Me.addClass("zmRhsOnboard"),_zm.setCookie("ZM-rpane","0"))},70),lt()}},{key:"remove",value:function(e){Ne.listRef.find(Ke+e+"]").remove(),Xe[e]&&Xe[e].pluginId&&this.$ele.find("#"+e).remove(),Ie===e&&this.switchToHome()}},{key:"switchToHome",value:function(){Ne.homeRef.addClass("zmHideD"),Ne.configRef.addClass("zmHideD"),Ne.refreshRef.addClass("zmHideD"),Ne.integSettingRef.removeClass("zmHideD"),Ne.containerRef.find(".zmSWorstCase").hide(),Ne.containerRef.removeClass("zoSCenterAlign"),dt(Ie),this.$ele.find(et).hide(),rt(!1),Ie="",Ne.titleRef.find("img").addClass("zmHideD"),Ne.titleRef.find("span.appName").text(g.integrations),Je.length&&(Ne.moreAppsRef.removeClass("zmHideD"),Ne.moreAppsRef.removeClass("show"),Ne.viewerRef.addClass("zmWMApps")),Ne.viewerRef.find(".zoSidebar_search").removeClass("zmHideD"),Ne.listRef.show(),lt()}},{key:"isOpen",value:function(){return Ve}},{key:"renderApp",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];!Ve&&t&&le("rhs"),this.$ele.find(Ye+e+"]").click()}},{key:"getMoreApps",value:function(){return Je}},{key:"renderHandler",value:function(e){var t,a=Ne.containerRef;if(a&&e.getExtensionID()===Ie){(t=$.e(zdom("iframe",{src:e.getResolvedURL()}))).css({height:ot(),width:"100%",border:0});var i=$.q("#"+Ie)[0]?$.q("#"+Ie):$.e(zdom("div",{className:"pluginBox",id:Ie},zdom("div",{className:"zmPluginOverlay zmHideD",onClick:be.hideDropWrapper}),zdom("div",{className:"pluginContent zmHideD"}),ke())),n=".pluginContent";return i.find(n).appendDOM(t),a.appendDOM(i),t.on("load",function(){i.find(".zmIntegLoad").remove(),i.find(n).removeClass("zmHideD"),(new zmail.dndComp.Drop).init(i.find(at)[0],{onDragOver:function(){return{allowDragOver:Boolean(Xe[Ie].listenDrop)}},onDrop:function(e){var t=e.dragObj.type,a="text",i=e.ev.dataTransfer.getData("text/html");t?(i=t.attObj||t.attList,a="attachment"):-1<e.ev.dataTransfer.types.indexOf("text/uri-list")&&(a="link",i=e.ev.dataTransfer.getData("url")),te("drop",{type:a,data:i}),be.hideDropWrapper()}})}),t[0]}}},{key:"filter",value:function(e){Se=e;var n="zmFilterHide zmHideD";if(Ne.listRef.find(".filterMoreApps").remove(),e){e=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");var s=new RegExp(e,"i");qe.forEach(function(e){var t=Ne.listRef.find(Ye+e+"]");t.hasClass("zmHideD")&&!t.hasClass("zmFilterHide")||(s.test(t.find("h3").text())?t.removeClass(n):t.addClass(n));var a=Ne.moreAppsListRef.find(Ye+e+"]");if(a[0]&&s.test(a.find("h3").text())){var i=je(Xe[e]);i.className+=" filterMoreApps",Ne.listRef.appendDOM(i)}})}else Ne.listRef.find(".zmFilterHide").removeClass(n)}},{key:"showDropWrapper",value:function(){if(Ve&&Ie){if(Ie===d&&!W)return;Xe[ZApp.GetExtensionInstance(Ie).zappid].listenDrop&&(Ne.containerRef.find("#"+Ie+" "+at).removeClass("zmHideD"),Ne.containerRef.find("#"+Ie).find("iframe").addClass("pointerEventsNone")),te("drag",{started:!0})}}},{key:"hideDropWrapper",value:function(){Ve&&Ie&&(Ne.containerRef.find(et+" "+at).addClass("zmHideD"),Ne.containerRef.find("#"+Ie).find("iframe").removeClass("pointerEventsNone"),te("drag",{ended:!0}))}},{key:"publish",value:function(e,t,a){if(a&&Xe[a].pluginId||Ve&&(a=Ie)){var i=this.$ele.find("#"+a+et);if(i[0]&&i.find("iframe")[0])ZApp.GetWidgetInstance(i.find("iframe").attr("id")).SendEvent(e,t)}}},{key:"getSelectedApp",value:function(){return Ie}},{key:"renderAppSettings",value:function(e){e=e||Ie;var a,t=$.e((a=e,zdom("div",{className:"pluginBox pluginSettings",id:a},zdom("div",null,zdom("div",{className:"zmIntegPageBk"},zdom("span",null,zdom("i",{className:"msi-larrow",onClick:function(){var e,t=Xe[a].integServiceId;Y(t)&&(e=Ue.getIntegAppConfig(t)),e&&e.isConfigured()&&e.getStatus()?be.$ele.find(Ye+a+"]").click():be.switchToHome()}}),g.settings)),zdom("div",{className:"pluginContent"},ke())))));this.$ele.find(et).hide(),Ne.homeRef.removeClass("zmHideD"),dt(Ie),Ge.get(Xe[e].integServiceId).init().then(function(){Pe.View.ViewManager.get(Xe[e].integServiceId).rhsmount(t.find(".pluginContent")[0])}),Ne.containerRef.appendDOM(t)}},{key:"renderMoreApps",value:function(){var t=[];Je.forEach(function(e){Xe[e]&&t.push(je(Xe[e]))}),Ne.moreAppsListRef.clearHTML().appendDOM(t)}},{key:"handleSettingsChange",value:function(t,e){if(Xe[t])if(e&&e.changed.hasOwnProperty("favorite"))!function(t,e){if(!Ne.moreAppsListRef.find(Ke+t+"]")[0]){Xe[t].favorite=e.changed.favorite;var a=Ne.listRef.find(Ke+t+"]");a.find(".msi-fav").toggleClass("zmFav").removeClass("SC_nopntr");var i=$.e(Ne.listRef.find(Qe)[0]),n=$.e(Ne.listRef.find(".zmSIL")[0]),s=$.q(".zmFavLast"),o=$.q(".zmFavInteg").filter(":last");if(a.toggleClass("zmFavInteg"),e.changed.favorite){if(Xe[t].integServiceId&&e.hasUserPermission()&&e.isUserDisabled())return o[0]?a.insertDOMAfter(o):a.insertDOMBefore(n);if(a.is(":first-child")||a.prev()[0].isSameNode(o[0])||a[0].isSameNode(i[0])||o[0]&&!o.nextUntil(a[0],Qe)[0])s.removeClass("zmFavLast"),a.addClass("zmFavLast"),o[0]?a.insertDOMAfter(o):a.insertDOMBefore(n);else{var r=a.prevUntil(Qe,":last");a.addClass("zmAniSlideOut"),(r[0]?r:a).prev().addClass("zmAniSlideBot"),s[0]?s.addClass("zmFavLastAni"):i.addClass("zmAniFirstTopR"),setTimeout(function(){o[0]?a.insertDOMAfter(o):a.insertDOMBefore(n),a.toggleClass("zmAniSlideOut zmAniSlideIn"),s.removeClass("zmFavLast"),a.addClass("zmFavLast")},400)}var l=Ne.favMsgRef;l.fadeIn(),setTimeout(function(){l.fadeOut()},1e3)}else{if(Xe[t].integServiceId&&e.hasUserPermission()&&e.isUserDisabled())return o[0]&&a.insertDOMAfter(o);if(a.hasClass("zmFavLast"))s.removeClass("zmFavLast"),Ne.listRef.find(tt).filter(":last").addClass("zmFavLast");else{if(a.addClass("zmAniSlideOut"),a[0].isSameNode(i[0])){var d=a.nextUntil(Qe,":first");a.addClass("zmAniSlideFirst"),(d[0]?d:a).next().addClass("zmAniFirstTop"),s.addClass("zmFavLastAni firstChild")}else{var m=a.prevUntil(Qe,":last");(m[0]?m:a).prev().addClass("zmAniSlideBot"),s.addClass("zmFavLastAni")}setTimeout(function(){a.toggleClass("zmAniSlideOut zmAniSlideIn").insertDOMAfter(o)},400)}}setTimeout(function(){if(a.removeClass("zmAniSlideIn"),a.removeClass("zmAniSlideOut zmAniSlideFirst"),$.q(".zmAniSlideBot").removeClass("zmAniSlideBot"),$.q(".zmAniFirstTop").removeClass("zmAniFirstTop"),$.q(".zmAniFirstTopR").removeClass("zmAniFirstTopR"),$.q(".zmFavLastAni").removeClass("zmFavLastAni firstChild"),qe.splice(qe.indexOf(t),1),a.prev()[0]){var e=a.prev()[0].dataset.appid;qe.splice(qe.indexOf(e)+1,0,t)}else qe.splice(0,0,t)},800),Ne.listRef.find(".zmFavLast").removeClass("zmFavLast"),Ne.listRef.find(tt).filter(":last").addClass("zmFavLast")}}(t,e);else{if((e=Ue.getIntegAppConfig(String(Xe[t].integServiceId))).getStatus()){this.$ele.find(Ye+t+"].filterMoreApps").remove(),this.$ele.find(Ye+t+"]").removeClass("zmHideD");var a=e.get("integList");a=a&&a[0],te("app_setting",a||{},t),Je=Je.filter(function(e){return e!==t}),$.isEmptyObject(Je)&&(Ne.moreAppsRef.addClass("zmHideD"),Ne.moreAppsRef.removeClass("show"),Ne.viewerRef.removeClass("zmWMApps"))}else this.$ele.find("#"+t).remove(),e.isConfigured()||delete Xe[t].pluginId,this.$ele.find(Ke+t+"]").addClass("zmHideD").removeClass("zmFilterHide"),Ie||Ne.moreAppsRef.removeClass("zmHideD"),Ne.viewerRef.addClass("zmWMApps"),it(t),t!==Ie||!e.isUserDisabled()&&this.$ele.find(".pluginSettings#"+t)[0]||this.switchToHome();this.renderMoreApps(),this.filter(Se)}}}]),e}()));var pt,ct,ut=zmail.Settings.MailSuite.Settings.Integration.Apps.ConfigManager;e("popup",new(function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"updatePlugins",value:function(){var e=re("popup");pt=e.list}},{key:"renderHandler",value:function(e){var t,a=this,i=ut.get(pt[ct].integServiceId);if(e.getExtensionID()===ct)return(t=$.e(zdom("iframe",{src:e.getResolvedURL()}))).css({height:"60vh",width:"100%",border:0}),this.popupWidget=Dialog.new({title:i.displayName||pt[ct].appName,ignoreMouseDown:!1,$content:t,closeAction:function(){a.popupWidget=null,ct=""}}),t[0]}},{key:"toggle",value:function(){this.popupWidget&&this.popupWidget.remove()}},{key:"getSelectedApp",value:function(){return ct}},{key:"isOpen",value:function(){return Boolean(this.popupWidget)}},{key:"renderApp",value:function(e){ct=e,K("popup")}},{key:"publish",value:function(e,t){if(this.popupWidget){var a=this.popupWidget.$els.$content;if(a[0]&&a.find("iframe")[0])ZApp.GetWidgetInstance(a.find("iframe").attr("id")).SendEvent(e,t)}}}]),e}()));var gt=function(){ZMWidgets.broadcast("mail_setting",{fontId:l[zmAdHocSettings.getFont()]||l[zmAdHocSettings.getFontDefault()],isNightMode:"1"===zmAdHocSettings.getNightMode()})};zmAdHocSettings.subscribeFontChange(function(){gt()}),zmAdHocSettings.subscribeNightModeChange(function(){gt()}),$.subscribe("compose/attachments",function(e,t){var a=t.to||"";a+=t.cc&&","+t.cc||"",a+=t.bcc&&","+t.bcc||"";try{var i={},n=[];for(var s in zmail.Utils.EmailParser.parse(a).forEach(function(e){e.valid&&n.push(e.email)}),t.attachments&&JSON.parse(t.attachments).forEach(function(e){0===e.shType&&(i[e.appId]=i[e.appId]||[],i[e.appId].push(e.cloudLink))}),i)ZMWidgets.publish("attachment_share",{links:i[s],recipients:n},s)}catch(e){return}}),$.q("body").on("drag",function(){ZMWidgets.showDropWrapper()}),$.subscribe("/mail/previewclosed",function(){ZMWidgets.publish("mail_close",{}),ZMWidgets.deRegisterCallbackEvent("hugeAttach")}),$.subscribe("/apps/tabSwitched",function(e,t,a){var i=ZMWidgets.getMailPreviewDetails();t!==a&&ZMWidgets.publish($.isEmptyObject(i)?"mail_close":"mail_preview",i),ZMWidgets.deRegisterCallbackEvent("hugeAttach")}),$.subscribe("mail/draggingStarted",function(){ZMWidgets.showDropWrapper()}),$.subscribe("mail/draggingEnded",function(){ZMWidgets.hideDropWrapper()}),$.subscribe("attachement/cancelCallback",function(){ZMWidgets.deRegisterCallbackEvent("hugeAttach")}),ZMStore.getInstance("IntegAppsCollection").on("refetchEnd",function(){ZMWidgets.fetchPlugins(!0)});var ft=zmail.Settings.MailSuite.Settings.Integration.Apps.MarketplaceCollection,zt=!1,vt=function(){zt||(zt=!0,ft.on("remove",function(e){ZMWidgets.removeApp(e.id)}),ft.on("add",function(e){ZMWidgets.addApp(e.id,e.attributes)}),ft.models.forEach(function(e){e.on("change:favorite",function(){ZMWidgets.getWidgetInstance("rhs").handleSettingsChange(e.id,e)})}))};ft.isLoaded?vt():ft.on("fetched",vt);var Ct=zmail.Core.Namespaces.create("ZMWidgets");if(Ct.Constants={appUrl:n},$.extend(!0,Ct,{toggleWidget:le,publish:te,broadcast:function(e,t){ZApp.BroadcastEvent(e,t)},fetchPlugins:ne,getPluginsByLocation:re,getMailDetails:J,isInhouseApp:Q,isAppSettingsAvail:Y,validateForEvents:function(e){var t=ZApp.GetExtensionInstance(e.extension_id),a=I[ZApp.GetWidgetInstance(e.widgetID).__WIDGET__.location];return!!(Q(t.zappid)||j[a].isOpen()&&j[a].getSelectedApp()===t.zappid||zmail.zappsTestRun&&j[a].getSelectedApp()===d)||(e.promise.reject(),!1)},registerWidgetInstance:e,isDevModeEnabled:ce,toggleDevMode:pe,isPrivilegedDev:me,getMailPreviewDetails:X,deRegisterCallbackEvent:function(e){P[e]=null},renderAttachComp:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"rhs";oe(e,a,function(e){te("attachment_pick",{},e,a),ee(e,t,"hugeAttach")})},addApp:function(e,t){-1<O.order.indexOf(e)||!x||x.done(function(){O.order.push(e),O.list[e]=$.extend({},t),ae(e),V(O.list[e]),ie()})},renderApp:oe,removeApp:function(e){x&&x.done(function(){ZApp.DeleteExtension(e),O.order.splice(O.order.indexOf(e),1),j.rhs.remove(e),delete O.list[e]})},refetchOnToggle:function(){j.rhs.isOpen()?ZMStore.getInstance("IntegAppsCollection").reFetchList():L=!0},renderWidgets:K,getPluginData:function(e){return O.list[e]},showDropWrapper:function(){j.rhs.showDropWrapper()},hideDropWrapper:function(){j.rhs.hideDropWrapper()},addAttachmentToWidget:function(e,t,a){zmUtil.isChildWindow()&&(a="popup"),oe(e,a,function(e){te("attachment_add",t.attObj||t.attList,e)})},hasEventCallback:function(e,t){return P[e]&&"function"==typeof P[e][t]},getEventCallback:function(e,t){return P[e][t]},publishDropData:function(e){var t,a=[];if("m"===zmApp.currentApp){t="mail";var i=zmDragger.getDropMailData(e,zmTab.currentTab),n=i.mIds;n.length||(n=i.tIds),n.forEach(function(e){a.push(X(["SUBJECT","CONTENT","NEWATTR","SM"],e))})}else{t="task";for(var s=0;s<e.length;s++){var o=$.q(e[s]).data();delete(o=zmTask.getCurrentList("taskList").findWhere({NMSPID:o.groupId,TASKID:o.entityId}).toJSON()).ROWINFO,a.push(o)}}te("drop",{type:t,data:a})},renderAppSettings:function(e,t){Q(e)&&j[t].getSelectedApp()===e&&j[t].renderAppSettings(e)},getWidgetInstance:ue,updateLoadedWidget:function(e,t){e!==d&&(O.list[e].widgets[I[t]].isLoadedDef.resolve(),"popup"===I[t]&&(O.list[e].widgets[I[t]].isLoadedDef=$.Deferred()))},renderFilterActionComp:function(e,t){oe(e,"rhs",function(e){te("filter_action",{},e,"rhs"),ee(e,t,"filterAction")})},updateAppConfig:function(t,a){x||ne(),x.done(function(){t=Z[t]||t;var e=O.list[t];a&&(e.pluginId=e.pluginId||a),V(e),oe(t,"rhs")})},updateIntegSettings:ge,getDisabledApps:function(){var e=j.rhs.getMoreApps();return i&&E||e.push(d),e},openRhs:function(){return j.rhs.isOpen()||le(),x},getMarketplaceStatus:function(){return H},templateChange:function(e,t){if(Z[U.Constants.MAILMERGE]){var a={templateId:e,context:t,count:zmail.folCount[zmail.folId.teId].c};te("template_change",a,Z[U.Constants.MAILMERGE])}},isFreeOrg:function(){return F}}),!zmail.isComposeMail&&!zmUtil.isChildWindow()){var ht=zmAdHocSettings.getEWidgetState();zmail.zappsTestRun?zmUtil.getIntegSettings().then(function(){var e=function(){le()};if(!Ct.isPrivilegedDev()){var t=g.noTestRunPermission;return t+=zmail.isAdmin?g.upgrade:g.contactAdmin,void _zm.succErrMsg("e",t)}Ct.isDevModeEnabled()?e():zmUtil.changeDevMode(!0,e)}):$.isEmptyObject(ht)||zmail.zappsTestRun||(!ht.selectedApp||zmail.zappsTestRun||ht.selectedApp===d&&!ce()?ht.isOpen&&le():oe(ht.selectedApp,"rhs",null,ht.isOpen))}}(),window.__rollupModule=void 0;