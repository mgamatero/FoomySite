(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"+sAg":function(e,t,n){"use strict";n.d(t,"k",function(){return d}),n.d(t,"g",function(){return s}),n.d(t,"t",function(){return c}),n.d(t,"u",function(){return m}),n.d(t,"o",function(){return f}),n.d(t,"m",function(){return p}),n.d(t,"j",function(){return z}),n.d(t,"c",function(){return g}),n.d(t,"b",function(){return b}),n.d(t,"i",function(){return h}),n.d(t,"f",function(){return v}),n.d(t,"e",function(){return C}),n.d(t,"w",function(){return G}),n.d(t,"a",function(){return S}),n.d(t,"s",function(){return O}),n.d(t,"r",function(){return k}),n.d(t,"l",function(){return B}),n.d(t,"v",function(){return l}),n.d(t,"p",function(){return N}),n.d(t,"n",function(){return w}),n.d(t,"d",function(){return A}),n.d(t,"h",function(){return I}),n.d(t,"q",function(){return L});var r=n("hSUr"),o=n("qfKh"),i=n("YV/N"),a=o.b.require,u="CONTACT_BOOK_GROUP_CHANGED",d=function(){return zmail.isOrg},s=function(){return window.ZCL_streamEve},c=function(){var e=$.Deferred();return r.f.load("streamsApp").then(function(){e.resolve()}),e.promise()},m=function(){return r.f.load("streamsComments")},f=function(){return c()},p=function(){return new Promise(function(e,t){r.f.load("streamsGroupManagement").then(function(){zmail.ContactBook.fetchProcess.then(function(){e()})})})},l=function(e){var t={},n=e.groupId;if((t=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree")).listObject[n])if(e.newcomment){var r=_.size(e.reflist)?e.reflist.split(","):[];_.find(r,function(e){if(e===zmail.zuid)return!0})||t.addClassAtStart(n,"msi-lcmnt")}else{var o=void 0!==e.incFlag&&e.incFlag;t.updateCount(n,"upd",e.count,o,!1),o||t.clearNew(n)}},z=function(e,t){var n=zmail.ContactBook.getGroups(t)[0];if(n){var r=(n=n.attrs).members;if(r&&r.length)return-1!==r.indexOf(e)}return!1},g=function(e,t,n){var r,o,i=zmail.ContactBook.getHomeGroup().attrs||{},a=_.pluck(zmail.ContactBook.getGroups(e),"attrs");(e&&_.size(a)||zmail.zuid===e)&&(o=zmail.zuid===e?i:a[0],r=void 0!==n?parseInt(n):parseInt(o.scount),t?r+=1:void 0===n&&(r-=1),r<0&&(r=0),$.publish(u,{props:{scount:r},id:e}),$.publish("group/unread",{groupId:e,count:r,incFlag:t}))},b=function(e,t){var n=zmail.ContactBook.getHomeGroup().attrs||{},r=void 0!==t?parseInt(t):parseInt(n.aucount);e?r+=1:void 0===t&&(r-=1),r<0&&(r=0),$.publish(u,{props:{aucount:r},id:zmail.zuid});var o=a("zmStreamsApp");o&&o.GroupApp&&o.GroupApp.updateAllUnreadCount&&o.GroupApp.updateAllUnreadCount(r),l({groupId:zmail.zuid,count:r,incFlag:e})},h=function(e){if(e){e=String(e);var t=zmail.ContactBook.getGroups(),n=_.pluck(t,"attrs");return-1!==_.pluck(n,"id").indexOf(e)}return!1},v=function(){var e=zmail.ContactBook.getGroups(),t=_.pluck(e,"attrs"),n=_.pluck(t,"id");return n.length||(n=[]),n},C=function(e){var t={},n=zmail.ContactBook.getGroups(),r=zmail.ContactBook.getHomeGroup().attrs||{};if(t[r.id]=$.extend({},r),t[r.id].name=Object(i.b)("8cf04a9734132302f96da8e113e80ce5"),t[r.id].order=1,n.length){var o=_.pluck(n,"attrs"),a={},u=!1,s=0,c=v(),m=c.length,f=2,p=0;for(s=0;s<o.length;s++)o[s].disabled||o[s].hidden?o[s].disabled&&(u=!0):a[o[s].id]=o[s];for(s=0;s<m;s++)_.size(a[c[s]])&&(t[c[s]]=$.extend({},a[c[s]]),t[c[s]].order=f,f++,e||(f=3===p?f+1:f,p>3&&(t[c[s]].hideNode=!0)),p++);u&&d()&&(t.disabledGrp={name:Object(i.b)("c111444b68dafb2f10ebcf3e939a58ba"),id:"disGrp",order:f++,hideNode:p>4&&!e,txtNodeClass:"SC_thm",rowTitle:Object(i.b)("ec863f45bc2942d0443de4655db55525")}),p>4&&(t.more={name:Object(i.b)("b184988f9d37c584d0404d033bb9044f"),id:"more",order:6,txtNodeClass:"SC_thm",hideNode:Boolean(e),rowTitle:Object(i.b)("de02b1338f12bc376c4944d9d86ac988")},t.less={name:Object(i.b)("63a12adb0f6cf65b1a2fbd962f3d54fe"),id:"less",order:f++,hideNode:!e,txtNodeClass:"SC_thm",rowTitle:Object(i.b)("4e48dc52853a333f613a3d71e9049619")})}else if(d()&&zmail.ContactBook.isGroupsFetched()){var l,z=["zmStreamsOnBoardD","zmStreamsOnBoardL"][_.random(0,1)],g=Object(i.b)("da783a70d7bed3ba2d7805f6500a9ac4"),b=parseInt(zmAdHocSettings.getStreamsGroupImg()),h=Object(i.b)("7ffbc4e1d3aa80b791a86f3223ffdf92");b?t.createGrp={id:"createGrp",name:g,count:"",order:2,txtNodeClass:"SC_thm"}:(l=zdom("div",null,zdom("span",{className:"zmStreamsOnBoardCls"},zdom("i",{className:"msi-close closeImg"})),zdom("span",{className:"zmStreamsOnBoardImg toHide "+z}),zdom("span",{className:"toHide"},h),zdom("div",{className:"zmStreamsCreate"},zdom("span",{className:"zmLink"},g))),t.createGrp={id:"createGrp",name:"",count:"",customNode:!0,order:2,customNodeHtmlTemplate:l.innerHTML})}return t},G=function(){a("zmComponent").notifier.addHandler("streams",function(e,t){"string"==typeof(t=t.data||{}).group&&(t.group=$.parseJSON(t.group)),"string"==typeof t.shgroups&&(t.shgroups=$.parseJSON(t.shgroups)),t.group=t.group||{};var n=_.size(t.group)?[t.group]:[];_.size(t.shgroups)&&(n=t.shgroups);var r,o,i,u=t.ntype;if(("30"===u||"4"===u||"41"===u||"46"===u||"25"===u||"44"===u||"79"===u||"61"===u||"71"===u)&&t.nby!==zmail.zuid||"112"===u&&t.group.id!==zmail.zuid){var d,s=!1,m=a("zmStreamsApp");for(i in n)r=n[i],o=h(r.id)?r.id:zmail.zuid,(d=m.util.getGroupDetails(o)).hidden||d.disabled?s=!0:g(o,!0);s||b(!0)}if(("31"===u||"45"===u||"38"===u)&&t.nby!==zmail.zuid)for(i in n)l({groupId:n[i].id,newcomment:!0,reflist:t.refList});var f=_.keys(t.members);if("50"!==u&&"75"!==u&&"51"!==u||t.memberzuid!==zmail.zuid&&!f.includes(zmail.zuid)||c().done(function(){var e=a("zmStreamsApp");e.GroupApp.requestGroupId=n[0].id,e.GroupApp.updateGroupListing(!h(n[0].id))}),"121"===u)for(i in n)g(n[i].id,!1),n[i].id!==zmail.zuid&&b(!1)})},N=function(e){c().done(function(){a("zmStreamsApp").events.openPostInTab(e)})},O=function(){$.publish("/streams/closePopOut")},k=function(e){var t=a("zmHash"),n=_.isElement(e)?e.href:e,r=t.decode(n);if("stream"===r.key){O();var o=r.params;"tab"===o[0]&&o.splice(0,1);var i={pid:o[1],gid:o[0],etype:o[2],actionType:o[3]};o[4]&&(i.commentId=o[4],i.allComments=!0),N(i)}},S=function(){_zm.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:".*/zm/#stream/.*",callback:k})},B=function(e){return!!e&&new RegExp(".*/zm/#stream/.*").test(e)},w=function(e,t,n){void 0===t&&(t=[]),c().done(function(){a("zmStreamsApp").updateBox.createNewPostDialog({content:e,attachment:t,mentions:n})})},A=function(e){zmail.mailLeft&&(zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree").setListObject(C(e)),zmail.mailLeft.rerender("zmStreamTree","list"))},I=function(){var e=zmAdHocSettings.getCommentBoxView();return"0"===e&&!zmail.isOrg||zmail.isOrg&&"off"===e},L=function(){zmail.ContactBook&&_zm.isStreamsEnabled()&&zmail.ContactBook.groupsFetched.done(function(){A(!1)})}}}]);