"use strict";define([],function(e,t){var n=e("zmComponent"),d={},u={};return d.setData=function(e,t){var n=Object.keys(t);if(void 0===u[e])u[e]=t;else{var r=u[e];n.forEach(function(e){r[e]=t[e]}),u[e]=r}},d.storeData=function(t,e){var n=$.Deferred(),r={sender:t,recipients:e.toString(),mode:"getFromToAddress"};return zmAjq.XHR({u:zmail.conPath+"/SMimeAction.do",t:"get",p:r,isXHRNeeded:!1,fn:function(e){d.setData(t,e),n.resolve(e)}}),n},d.foundMissingList=function(e,n){return n=Object.keys(n),e.filter(function(e,t){return-1===n.map(function(e){return e}).indexOf(e)})},d.getData=function(t,n){var r=$.Deferred(),i=u[t],o={};if(void 0===i)return d.storeData(t,n).done(function(e){o[t]=e,r.resolve(o)}),r.promise();var s=Object.keys(i),a={};"string"==typeof n&&(n=n.split(",")),n.forEach(function(t){var e=s.find(function(e){return e===t});void 0!==i[e]&&(a[t]=i[e])}),o[t]=a;var e=d.foundMissingList(n,i);return 0<e.length?(d.storeData(t,e).done(function(e){d.getData(t,n).done(function(){r.resolve(u[t])})}),r.promise()):r.resolve(o)},d.subscribeCertChange=function(){$.subscribe("sendmailas/smimeCertChange",function(e,t){if("disabled"===t.mode)delete u[t.addr],$.publish("smimeChangeCertTriggered",t);else if("enabled"===t.mode&&u[t.addr]){var n=Object.keys(u[t.addr]);delete u[t.addr],d.getData(t.addr,n).then(function(){$.publish("smimeChangeCertTriggered",t)})}})},d.subscribeCertChange(),n.smimeAPI=d,n});