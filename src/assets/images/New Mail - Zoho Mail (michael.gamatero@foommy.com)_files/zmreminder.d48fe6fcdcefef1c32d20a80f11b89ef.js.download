"use strict";window.zmWatch=function(){var n,l,q={},x={},I=function(e){var t=zmUtil.getMailObj(e).RMOBJ;return t.WT?t:t[t.length-1]},d=function(e,t,a){e.accId=zmail.accId,zmAjq.XHR({u:zmail.conPath+"/watch.do",t:"POST",fn:a,efn:function(e){_zm.succErrMsg("e",e.emsg)},p:e,ep:t})},E=zmText.get("zmreminder");return{getTxt:function(e){var t=" SCtxt SC_op3 SC_nopntr",a="ZM_SCType",i="SC_mt10 checkBox";q[e].calleeObj.showReminderPartial&&(a+=t,i+=t);var c=zdom("tr",{id:"zmWatch_type_{{cmpId}}"},zdom("td",{ref:"remindOptionsHeader",className:a},zdom("label",{"data-val":"zm_watchType_1"},zdom("i",{className:"msi-unoption"}),zdom("span",{"data-tooltip":E.watch.regardless_tooltip},E.watch.regardless)),zdom("label",{"data-val":"zm_watchType_3"},zdom("i",{className:"msi-unoption"}),zdom("span",{"data-tooltip":E.watch.response_tooltip}," ",E.watch.response)),zdom("label",{"data-val":"zm_watchType_2"},zdom("i",{className:"msi-unoption"}),zdom("span",{"data-tooltip":E.watch.noreply_tooltip},E.watch.noreply)))),r=zdom("tr",{id:"zmWatch_header_{{cmpId}}"},zdom("td",null,zdom("div",{id:"zmWatch_clear_{{cmpId}}",className:"SC_frt SC_link SC_dyn SC_thm"},E.watch.clear),zdom("b",null,E.watch.remind))),n=zdom("tr",{id:"zmWatch_desc_{{cmpId}}"},zdom("td",null,zdom("textarea",{id:"zmWatch_txtdesc_{{cmpId}}",placeholder:E.watch.adddes,className:"SC_tiput",style:{resize:"none"}}))),o=zdom("tr",{id:"zmWatch_option_{{cmpId}}"},zdom("td",null,zdom("div",{className:"SC_dib"},zdom("div",{className:"SC_dib","data-val":"zm_reminderDate","data-tooltip":E.watch.remindon},zdom("input",{className:"SC_input",type:"textbox","data-type":"date",readOnly:!0})),zdom("div",{className:"SC_dib","data-val":"zm_reminderTime"},zdom("input",{className:"SC_input",type:"textbox","data-type":"time"})),zdom("div",{className:"SC_dib","data-val":"zm_reminderMode"},zdom("div",{"data-prop":"reminderModeSelect",className:"zmSelect","data-tooltip":E.watch.remindmode},zdom("span",{className:"reminderMode","data-val":"0"},E.watch.bynotif)))),zdom("div",{className:i,"data-val":"zm_reminderType_1"},zdom("i",{className:"msi-uncheck"}),zdom("label",{"data-tooltip":E.watch.remindrecip_tooltip},E.watch.remindrecip)))),d=zdom("tr",{id:"zmWatch_editor_{{cmpId}}",className:"SC_dyn"},zdom("td",null,zdom("div",{id:"zmWatch_editor_load_{{cmpId}}",className:"zmCE"}))),m=zdom("tr",null,zdom("td",null,zdom("div",{className:"SC_PUbtm"},zdom("span",{id:"zmWatch_save_{{cmpId}}"},E.watch.addrem),zdom("span",{id:"zmWatch_close_{{cmpId}}"},E.buttons.close)))),l={header:r};return l.type=c,l.desc=n,l.editor=d,l.option=o,l.button=m,l},getWatchTxt:function(e){var t=zmWatch.getTxt(e),a=[],i=[],c=[];t.type&&(a=t.type),t.option&&(i=t.option),t.editor&&(c=t.editor);var r=zdom("div",{id:"zmWatch_{{cmpId}}",ref:"container"},zdom("table",{className:"SC_schd"},zdom("tbody",{ref:"tbody"}))),n=_zm.getDOMReferenceMap(r,!0);return $.e(n.tbody).appendDOM(a),$.e(n.tbody).appendDOM(i),$.e(n.tbody).appendDOM(c),n.container},showWatch:function(e){var t={};n=zmComponent.keybindings.getScope();var a=!1;if(!zmUtil.isChildWindow()&&"compose_tab"===e.openWatch){var i=zmComp.getObj(e.msgId);i.RMOBJ&&!$.isEmptyObject(i.RMOBJ)&&(t=i.RMOBJ),i._reminder_draft&&(a=!0)}var c=e.msgId;q[c]||(q[c]={}),$.isEmptyObject(t)?"dropdown"===e.loadType&&(q[c].RMD=e.RMD,q[c].RMM=e.RMM,q[c]._load_type="custom"):(q[c]._load_type||(q[c]._load_type="drafted"),q[c]._draft_obj=t,a&&(q[c]._reminder_draft=a)),q[c].openWatch=e.openWatch,q[c].dialogType=e.loadType,q[c].dateScan=e.dateScan,q[c].calleeObj=e,q[c].parent=e.parent,zmWatch.watchDialog(c);var r=[{uid:"navigation",keyStr:"tab",actions:[function(){}],preventDefault:!0}];zmComponent.keybindings.registerAll({scope:"reminder",shortcuts:r,allowDefaultScope:!1,preventDefault:!0}),zmComponent.keybindings.setScope("reminder")},updateDialog:function(e){var t=e.config.cmpId;e.$els.$positionWrapper.addClass("SC_PopTop"),e.$els.$positionWrapper.css("top","150px"),zmWatch.triggerWatch(t),void 0!==window.event&&zmUtil.stopEvents(window.event)},modifyDialog:function(e){var t=e.config.cmpId;q[t]._dDialog=e;l=zdom("div",null,zdom("span",{className:"sel",id:"zmWatch_save_"+t},E.watch.addrem),zdom("span",{"data-val":"Cancel",id:"zmWatch_close_"+t},E.buttons.close),zdom("label",{"data-val":"Cancel",id:"zmWatch_clear_"+t,className:"SC_frt SC_link SC_dyn SC_thm"}," ",E.watch.clear));var a=zdom("div",{id:"zmWatch_error_band_"+t,className:"SC_msg SC_emsg SC_dyn"},zdom("span",null,zdom("font",{id:"zmWatch_server_error_"+t}),zdom("i",{id:"zmWatch_error_close_"+t,className:"msi-close"})));e.$els.$contentWrapper.prependDOM(a),e.$els.$content.attr("id","zmwatch_center_"+t);var i="zmWatch_center_dontshow_"+t;$.e(e.$els.$buttonContainer).children().remove(),$.e(e.$els.$buttonContainer).appendDOM(l),"popupalert"===q[t].dialogType&&$.e(zdom("div",{id:i,className:"zmRadioEle zmRemAlertInfo"},zdom("label",null,zdom("i",{className:"msi-uncheck"}),E.dontshowmsg))).insertDOMAfter(e.$els.$buttonContainer)},watchDialog:function(d){var e=[{attrs:'id="zmWatch_save_'+d+'" data-watch="add"',callback:function(){zmsDialog.remove()}}],t=zmWatch.loadWatch(d);q[d]._watchDOM=t;var a={title:E.watch.remind};"popupalert"===q[d].dialogType&&(a.title=E.promotereminder),a.cmpId=d,a.openWatch=q[d].openWatch,a.dialogType=q[d].dialogType;var i="zm_reminder_dialog_title_"+d,c=zdom("h3",null,zdom("i",{className:"msi-mail SC_thm"}),zdom("label",{id:i})),r=zdom("div",null);if("popupalert"===q[d].dialogType){var n=zmail.urls.helpURL+"follow-up-emails.html#alink2",o=E.date_reminder_alert+" ";o=zdom("fragment",null,zmText.applyArgs(o,{USER_INPUT:zdom("i",null,zdom("b",null))}));var m=zdom("div",null);$.e(m).attr("id","zmcmp_reminderdate_"+d),$.e(m).appendDOM(o),$.e(m).appendDOM($.e(zdom("a",{className:"zmLink",target:"_blank",rel:"noopener noreferrer",href:n},zdom("u",null,E.learnmore)))),$.e(m).find("b").eq(0).text(q[d].dateScan.text),$.e(r).appendDOM(m),$.e(t).addClass("zmFollowUpRem"),$.e(r).appendDOM(t)}else $.e(r).appendDOM(c),$.e(r).appendDOM(t);a.$content=r,a.buttons=e,a.ignoreMouseDown=!1,a.dialogDidMount=function(e){if("dropdown"===q[d].dialogType){var t=q[d].parent||document.body;$.e(l).addClass("SC_PUbtm"),$.e(e.$els.$content[0].children[0]).appendDOM(l),$.e(e.$els.$content)[0].className="zmRemSchedDD";var a={par:t,showArrow:!0,removeLi:!0,divId:"temp",liDom:$.e(e.$els.$content)};new zmDropDownMenu(a).paint(),$.e(e.$els.$content).on("click",function(e){var t=$.q(e.target).closest("[data-prop]")[0];void 0!==t&&"reminderModeSelect"===t.getAttribute("data-prop")||"function"!=typeof x.remove||x.remove()})}var i=e.config.cmpId,c=e.config.openWatch,r="",n=zmUtil.getMailObj(i);if(n&&(r=n.SB),c&&"compose_tab"===c){r=E.nosubject;var o=zmComp.getSubject(d);o&&""!==$.trim(o)&&(r=$.trim(o))}r=_zm.unescapeTags(r),$.q("#zm_reminder_dialog_title_"+i).text(r),e.$els.$contentWrapper.css({"max-width":"470px"}),zmWatch.updateDialog(e)},a.dialogWillMount=function(e){zmWatch.modifyDialog(e)},"dropdown"===q[d].dialogType&&(a.doesMountToDom=!1),Dialog.new(a)},listDialog:function(e,t){var a=e.msgId;q[a]||(q[a]={}),q[a].openWatch=e.openWatch,q[a].dialogType=e.loadType,q[a].calleeObj=e,q[a]._dDialog=t;var i=zdom("label",null);$.e(i).text(E.watch.clear),$.e(i).attr("id","zmWatch_clear_"+a),$.e(i).addClass("SC_frt SC_link SC_thm SC_dyn"),$.e(t.getButtonContainer()).appendDOM(i);var c=zmWatch.loadWatch(a),r=zmUtil.getMailObj(a);r&&0===r.MA&&t.$el[0].getElementsByClassName("SC_PU")[0].style.removeProperty("max-width"),$.e(t.getCenterElem(t.configOption.tabs[0].tabName)).appendDOM(c),q[a]._watchDOM=c,zmWatch.triggerWatch(a)},listDOM:function(e){var t,a,i=zmCenterListing.mailObjectAPI.getViewObject(e);return i?t=i.$element:(a=zmsuite.getCenter("zm_Container")[0].getNodes()[2].$el).length&&(t=a.find("#"+e)),t},updateWatch:function(e,t){var a,i,c=t.cmpId,r="",n=t.watchMode,o=zmWatch.listDOM(c);if("success"===e.stat){var d=ZMail.lConstants.cls;if("a"!==n&&"u"!==n||((i=zmUtil.getMailObj(c))&&(i.RMOBJ=t.RMOBJ,q[c].reminder=!0),"a"===n&&(r=E.errors.watchadd),"u"===n&&(r=E.errors.watchupd),(a=$.q("#zmprv_header_"+c+"_remind*")).attr("data-tooltip",E.watch.updrem),a.find(".msi-reminder").addClass("SC_thm"),o.length&&!o.find("."+d.associate).length&&zmList.addAssociateIndication(o)),"d"===n){(a=$.q("#zmprv_header_"+c+"_remind*")).attr("data-tooltip",E.watch.setrem),a.find(".msi-reminder").removeClass("SC_thm");var m=(i=zmUtil.getMailObj(c)||{}).hasOwnProperty("MA")&&0!==i.MA;o.length&&o.find("."+d.associate).length&&!m&&o.find("."+d.associate).remove(),delete i.RMOBJ,r=E.errors.watchrem}zmWatch.closeWatch(c),zmWatch.hideWatch(c),_zm.succErrMsg("s",r)}else{$.q("#zmWatch_save_"+c).off("click").on("click",function(){zmWatch.addWatch(c,$.e(this))});var l=$.q("#zmWatch_save_"+c).attr("vtxt");$.q("#zmWatch_save_"+c).text(l),"a"===t.watchMode&&(e.emsg?zmWatch.errorShow(c,e.emsg):_zm.succErrMsg("e",E.errors.probadd)),"d"===t.watchMode&&(e.emsg?zmWatch.errorShow(c,e.emsg):_zm.succErrMsg("e",E.errors.probrem)),"u"===t.watchMode&&(e.emsg?zmWatch.errorShow(c,e.emsg):_zm.succErrMsg("e",E.errors.probupd))}},errorShow:function(e,t){q[e]&&q[e]._dDialog&&"header_all"===q[e].openWatch?q[e]._dDialog.showSuccErrMsg("e",t):($.q("#zmWatch_error_band_"+e).removeClass("SC_dyn"),$.q("#zmWatch_server_error_"+e).text(t),$.q("#zmWatch_error_close_"+e).off("click").on("click",function(){$.q("#zmWatch_error_band_"+e).addClass("SC_dyn")}))},errorHide:function(e){$.q("#zmWatch_error_band_"+e).addClass("SC_dyn")},getWatchType:function(e){return q[e].WT},setWatchType:function(e,t){q[e].WT=t},getReminderType:function(e){return q[e].RMT},setReminderType:function(e,t){q[e].RMT=t},getReminderMode:function(e){return q[e].RMM},setReminderMode:function(e,t){q[e].RMM=t},getReminderDesc:function(e){return q[e].RMDSC},setReminderDesc:function(e,t){q[e].RMDSC=t},getReminderDate:function(e){return q[e].RMD},setReminderDate:function(e,t){q[e].RMD=t},getEditor:function(e){return q[e].editor},setEditor:function(e,t){q[e].editor=t},allowWatch:function(e){var t,a=!1;return q[e]&&q[e].WT&&(t=q[e].WT),1!==t&&2!==t&&3!==t||(a=!0),a},loadWatch:function(e){var t=zmWatch.getWatchTxt(e);return t=t.innerHTML.replace(/{{cmpId}}/g,e),$(t)},getHours:function(e){var t=zmWatch.getWatchDateEle(e)._time_elm.val(),a=(t=$.trim(t)).split(" "),i=a[1],c=a[0].split(":"),r=c[0];return"pm"===i&&(r=String(parseInt(c[0])+12)),r+":"+c[1]},getCurrentDate:function(){var e,t,a,i,c=zmWatch.getCurrentDateObj();return c&&(e=c.getDate(),t=c.getMonth()+1,a=c.getFullYear(),e<10&&(e="0"+e),t<10&&(t="0"+t)),"dd/mm/yyyy"===zmail.userDateFormat.toLowerCase()?i=e+"/"+t+"/"+a:"mm/dd/yyyy"===zmail.userDateFormat.toLowerCase()&&(i=t+"/"+e+"/"+a),i},getCurrentDateObj:function(e){var t=new Date,a=e||zmail.timeZoneOffset,i=t.getTime()+6e4*t.getTimezoneOffset();return new Date(i+a)},getCurrentTime:function(){var e=new Date;e.setMinutes(e.getMinutes()+30);var t=zmWatch.getCurrentDate(),a=String(e.getHours()),i=String(e.getMinutes());return{date:t,time:(1<a.length?a:"0"+e.getHours())+":"+(1<i.length?i:"0"+e.getMinutes())}},bindDatePicker:function(e,t){var a;if("undefined"!=typeof ZEVENTS){var i=zmail.userDateFormat.toUpperCase(),c=zmWatch.getCurrentDate();void 0!==e&&(a=ZEVENTS(e).picker("date",{dform:i,wkst:0,mode:"popup",update:"yes",range:[c,""],minhgt:251,fullDtclk:1}).on("dateclick",function(){t&&t(this.getDate().getDateBy(i))}).bind())}return a},bindTimePicker:function(e){var t;return"undefined"!=typeof ZEVENTS&&void 0!==e&&(t=ZEVENTS(e).picker("time",{tform:"HH:mm ss"}).bind()),t},triggerWatch:function(e){zmWatch.clearWatchElem(e,"trigger"),zmWatch.loadEditor(e)},getWatchDom:function(e){var t=zmComp.getType(e);return"w"===t||"d"===t||"p"===t?$.q("#zmWatchM_"+e).find("li"):$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("[data-event='watch']")},addWatchTheme:function(e){if("compose_tab"===q[e].openWatch){var t=q[e].calleeObj;if(t.flex)t.addReminderTheme(e,!0);else q[e].calleeObj.elem.addClass("SC_thm")}},clearWatchTheme:function(e){"compose_tab"===q[e].openWatch&&(q[e].calleeObj.flex?q[e].calleeObj.clearReminderTheme(e,!1):q[e].calleeObj.elem.removeClass("SC_thm"))},showWatchClear:function(e){$.q("#zmWatch_clear_"+e).removeClass("SC_dyn"),$.q("#zmWatch_clear_"+e).off("click").on("click",function(){q[e].reminder?zmWatch.deleteReminder(e):q[e].clear_reminder?(zmWatch.clearWatchTheme(e),zmWatch.setCmpModified(e),zmWatch.setAvoidWatch(e,!0),q[e]._load_type="reupdate",q[e].clear_reminder=!1,q[e]&&"list"===q[e].dialogType?q[e]._dDialog.$el.remove():q[e]._dDialog.remove()):zmWatch.clearReminder(e)})},hideWatchClear:function(e){$.q("#zmWatch_clear_"+e).addClass("SC_dyn")},clearWatchElem:function(e,t){var a=q[e]._watchDOM,i=a.find("tr#zmWatch_type_"+e).find('label[data-val^="zm_watchType_"]');i.filter('label[data-val="zm_watchType_3"]').find("i").eq(0).removeClass().addClass("msi-unoption"),i.filter('label[data-val="zm_watchType_2"]').find("i").eq(0).removeClass().addClass("msi-unoption"),i.filter('label[data-val="zm_watchType_1"]').find("i").eq(0).removeClass().addClass("msi-unoption");var c=a.find("tr#zmWatch_option_"+e);c.find('div[data-val="zm_reminderType_1"]').find("i").eq(0).removeClass().addClass("msi-uncheck"),c.find('div[data-val="zm_reminderDate"]').find("input").eq(0).val(zmWatch.getCurrentTime().date),c.find('div[data-val="zm_reminderTime"]').find("input").eq(0).val(zmWatch.getCurrentTime().time);var r=c.find('div[data-val="zm_reminderMode"]').find("span").eq(0);r.attr("data-val","0"),r.text(E.watch.bynotif),zmWatch.hide(c),zmWatch.errorHide(e),zmWatch.hideWatchClear(e);var n=a.find("tr#zmWatch_editor_"+e);if(zmWatch.hide(n),"clear"===t){i.filter('label[data-val="zm_watchType_3"]').find("i").eq(0).removeClass().addClass("msi-option");var o=zdom("div",null,zdom("br",null));zmWatch.getEditor(e).setContent(o.outerHTML)}},updateWatchType:function(n){var e,t;try{var a={},i=!0,c=q[n].openWatch;"compose_tab"!==c&&"custom_popup"!==c||(i=!1);var r="";i&&zmList.isRMOBJ(n)?(a=I(n),q[n].reminder=!0,r="remove_list"):"drafted"===q[n]._load_type&&q[n]._reminder_draft?(a=q[n]._draft_obj,q[n].clear_reminder=!0,r="clear_drafted"):"compose_saved"===q[n]._load_type?(a.WT=q[n].WT,a.RMDSC=q[n].RMDSC,a.RMM=q[n].RMM,a.RMT=q[n].RMT,a.RMD=q[n].RMD,q[n].clear_reminder=!0,r="clear_saved"):"custom"===q[n]._load_type&&(a.WT=q[n].WT,a.RMDSC=q[n].RMDSC,a.RMM=q[n].RMM,a.RMT=q[n].RMT,a.RMD=q[n].RMD,q[n].calleeObj.showClearWatch&&(q[n].clear_reminder=!0,r="clear_saved")),e=zmWatch.getCurrentTime().date,t=zmWatch.getCurrentTime().time;var o="",d=0,m=e+" "+t,l=1,s=0;a&&(a.WT&&(l=a.WT),a.RMDSC&&(o=a.RMDSC),void 0!==a.RMM&&(d=a.RMM),void 0!==a.RMT&&(s=a.RMT),a.RMD&&(m=a.RMD),3===a.WT&&(s=0));var h=!0,p=!0,z=q[n]._watchDOM,_=z.find("tr#zmWatch_type_"+n),f=_.find('label[data-val^="zm_watchType_"]'),u=z.find("tr#zmWatch_option_"+n),W=z.find("tr#zmWatch_editor_"+n);_.off("click").on("click",function(e){var t=(e=e||window.event).target||e.srcElement,a=$.e(t).parents().filter('label[data-val^="zm_watchType"]').eq(0).attr("data-val");if("zm_watchType_1"===a||"zm_watchType_2"===a||"zm_watchType_3"===a){var i=f.filter('label[data-val="zm_watchType_3"]').find("i").eq(0),c=f.filter('label[data-val="zm_watchType_2"]').find("i").eq(0),r=f.filter('label[data-val="zm_watchType_1"]').find("i").eq(0);if(i.removeClass().addClass("msi-unoption"),c.removeClass().addClass("msi-unoption"),r.removeClass().addClass("msi-unoption"),f.filter('label[data-val="'+a+'"]').find("i").eq(0).addClass("msi-option"),"zm_watchType_3"===a&&(zmWatch.hide(u),zmWatch.hide(W)),"zm_watchType_2"===a||"zm_watchType_1"===a)zmWatch.show(u),u.find('div[data-val="zm_reminderType_1"]').find("i").eq(0).hasClass("msi-check")&&zmWatch.show(W);zmWatch.showWatchClear(n)}});var v=u.find("div[data-val='zm_reminderType_1']");v.off("click").on("click",function(){var e=$.e(this).find("i").eq(0);e.hasClass("msi-uncheck")?(e.removeClass().addClass("msi-check"),zmWatch.show(W),setTimeout(function(){zmWatch.getEditor(n).squireInstance.focus(),q[n].editor.updateToolbar()},100)):(zmWatch.hide(W),e.removeClass().addClass("msi-uncheck"))}),1===s&&v.find("i").eq(0).removeClass().addClass("msi-check");var g=u.find('div[data-val="zm_reminderMode"]'),C=g.find("span").eq(0);0===d?C.text(E.watch.bynotif):C.text(E.watch.bymail);var M=[],y={txt:E.watch.bynotif,data:{val:"0",text:E.watch.bynotif,elem:C}},w={txt:E.watch.bymail,data:{val:"1",text:E.watch.bymail,elem:C}};M.push(y),M.push(w),g.on("click",function(){(x=new zmDropDownMenu({par:g,clk:function(e){var t,a;a=(t=e).elem,$.e(a).attr("data-val",t.val),a.text(t.text),x.hide()},list:M,ulClass:"SC_tin",align:"pleft"})).paint()}),f.filter('label[data-val="zm_watchType_'+l+'"]').find("i").eq(0).removeClass().addClass("msi-option"),2!==l&&1!==l||(p=!1,s&&(h=!1)),p?zmWatch.hide(u):zmWatch.show(u),e=zmWatch.getCurrentTime().date,t=zmWatch.getCurrentTime().time;var b=u.find("div[data-val='zm_reminderDate']").find("input").get(0),T=u.find("div[data-val='zm_reminderTime']").find("input").get(0);zmWatch.bindTimePicker(T),$.e(T).on("click",function(){"function"==typeof x.remove&&x.remove()}),m||(m=e+" "+t);var D=zmWatch.getUpdateDate(n,m);if(e=D[0],t=D[1],u.find('div[data-val="zm_reminderDate"]').find("input").eq(0).val(e),u.find('div[data-val="zm_reminderTime"]').find("input").eq(0).val(t),zmWatch.bindDatePicker(b),zmWatch.showWatchClear(n),r||zmWatch.hideWatchClear(n),"popupalert"===q[n].dialogType&&"compose_tab"===q[n].openWatch)$.q("#zmWatch_save_"+n).text(E.addremindersend),$.q("#zmWatch_close_"+n).text(E.skipsend),$.q("#zmWatch_save_"+n).off("click").on("click",function(){zmWatch.offReminderWarning(n),zmComp.setDateReminder(n,!1),zmWatch.cmpWatch(n),zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(n),cmpId:n,actVal:"datefalse"})}),$.q("#zmWatch_close_"+n).off("click").on("click",function(){zmWatch.offReminderWarning(n),zmComp.setDateReminder(n,!1),zmWatch.closeWatch(n),zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(n),cmpId:n,actVal:"datefalse"})}),$.q("#zmWatch_center_dontshow_"+n).off("click").on("click",function(){var e=$.e(this).find("i").eq(0);e.hasClass("msi-uncheck")?(e.attr("class","msi-check"),zmComp.setReminderSetting(n,!0)):(e.attr("class","msi-uncheck"),zmComp.setReminderSetting(n,!1))}),zmWatch.hideWatchClear(n);else if("compose_tab"===q[n].openWatch)$.q("#zmWatch_save_"+n).text(E.watch.add),$.q("#zmWatch_save_"+n).off("click").on("click",function(){zmWatch.cmpWatch(n)}),$.q("#zmWatch_close_"+n).text(E.watch.cancel),q[n].clear_reminder&&($.q("#zmWatch_save_"+n).text(E.watch.updrem),$.q("#zmWatch_clear_"+n).text(E.watch.remrem)),$.q("#zmWatch_clear_"+n).text(E.watch.close),$.q("#zmWatch_close_"+n).off("click").on("click",function(){zmWatch.closeWatch(n)});else if("custom_popup"===q[n].openWatch){var S=$.q("#zmWatch_save_"+n),R=$.q("#zmWatch_close_"+n);if($.e(S).text(q[n].calleeObj.saveTxt),R.text(q[n].calleeObj.cancelTxt),R.off("click").on("click",function(){zmUtil.hideMenu()}),S.off("click").on("click",function(){zmWatch.callbackWatch(n)}),q[n].calleeObj.showClearWatch){var k=$.q("#zmWatch_clear_"+n);$.e(k).text(q[n].calleeObj.clearTxt),k.off("click").on("click",function(){zmWatch.callbackWatch(n,{clear:!0})})}}else $.q("#zmWatch_save_"+n).off("click").on("click",function(){zmWatch.addWatch(n,$.q(this))}),q[n].reminder&&($.q("#zmWatch_save_"+n).text(E.watch.updrem),$.q("#zmWatch_clear_"+n).text(E.watch.remrem)),$.q("#zmWatch_close_"+n).off("click").on("click",function(){zmWatch.closeWatch(n),zmWatch.hideWatch(n)});if(h)zmWatch.hide(W);else{zmWatch.show(W);try{var O=o;zmWatch.getEditor(n).setContent(O),setTimeout(function(){zmWatch.getEditor(n).squireInstance.focus(),q[n].editor.updateToolbar()},100)}catch(e){zmUtil.debugLog(e)}}}catch(e){zmUtil.debugLog(e)}},getToolbar:function(){return[[["bold","Bold (Ctrl+B)","zei-bold"],["italic","Italic (Ctrl+I)","zei-italic"],["underline","Underline (Ctrl+U)","zei-underline"],["strikethrough","Strikethrough","zei-strike"]],[["fontfamily","Font","zeFFce"]],[["fontsize","Font Size",["ze_pdl","zeFUce"].join(" ")]],[["forecolor","Font color","zei-textclr"],["backcolor","Background Color","zei-bgclr"]],[["link","Insert Link","zei-link"]],[["quote","Insert Quote","zei-quote"],["removeformat","Remove Formatting","zei-removeformat"]],[["spellcheck","Check Spelling","zei-spellCheck"]]]},offReminderWarning:function(e){if(zmComp.getReminderSetting(e))try{zmail.Settings.MailSuite.Settings.Compose.ReminderPrompt.Setting.set(!0)}catch(e){zmAdHocSettings.setReminderWarningState("1")}},loadEditor:function(e){q[e]._watchDOM.find("tr#zmWatch_editor_"+e).removeClass("SC_dyn");var t=zmWUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==t&&(ZE_Init.defaultFontFamily=t),zmail.mailOpt.fs&&(ZE_Init.defaultFontSize=zmail.mailOpt.fs+"pt");var a,i=zdom("div",null,zdom("div",null,E.DefaultTemplate.hello),zdom("div",null,E.DefaultTemplate.goodday),zdom("div",null,E.DefaultTemplate.takeme),zdom("div",null,E.DefaultTemplate.awaiting)),c=ZE.create({id:"zmWatch_editor_load_"+e,avoidPlainText:!0,customTooltip:!0,content:i.outerHTML,needEditorFocus:!1,avoidThresholdValue:!0,toolbarOrder:zmWatch.getToolbar(),defaultFontFamily:zmail.userOptions.fontFamily});zmWatch.setEditor(e,c);try{zmWatch.getEditor(e).afterEditorLoad((a=e,function(){zmWatch.postEditorLoad(a)}))}catch(e){zmUtil.debugLog("Editor load ",e)}},postEditorLoad:function(e){var t=q[e]._watchDOM.find("tr#zmWatch_editor_"+e);t.find(".zmCE").height("200px");var a=200-(t.find(".ze_SCmb").outerHeight()+2),i=t.find(".ze_area");i.height(a+"px"),i.css("display","block"),zmWatch.updateWatchType(e,"trigger"),q[e].editor.updateToolbar()},getWatchDate:function(e){var t="",a=zmWatch.getWatchDateEle(e)._date_elm,i=zmWatch.getWatchDateEle(e)._time_elm;zmWatch.getReminderDate(e)&&a&&i&&(t=$.e(a).val()+" "+$.e(i).val());return t},show:function(e){e.removeClass("SC_dyn")},hide:function(e){e.addClass("SC_dyn")},getUpdateDate:function(e,t){var a="",i="";if(t){var c=t.split(" ");a=c[0];var r=c[1];i=(r=r.split(":"))[0]+":"+r[1]}return[a,i]},deleteReminder:function(e){var t={accId:zmUtil.getZohoAccId(),mymId:e,actType:"watch",watchMode:"d"};t.watchType=I(e).WT;var a={cmpId:e};a.watchMode=t.watchMode,d(t,a,zmWatch.updateWatch)},clearReminder:function(e){zmWatch.clearWatchTheme(e),zmWatch.clearWatchElem(e,"clear"),zmWatch.hideWatchClear(e)},closeWatch:function(e){q[e]&&"list"===q[e].dialogType?q[e]._dDialog.$el.remove():q[e]&&q[e]._dDialog.remove(),zmComponent.keybindings.setScope(n),n=""},cmpWatch:function(e){try{var t,a=q[e]._watchDOM.find("tr#zmWatch_type_"+e);if(a.find("i.msi-option").length)t=a.find("i.msi-option").closest("label").eq(0).attr("data-val").split("_")[2];if(!t)return zmWatch.errorShow(e,"Please select any reminder type"),!1;var i=zmWatch.getRMOBJ(e);if(!i)return!1;q[e]._load_type="compose_saved",zmWatch.setRMOBJ(e,i),zmWatch.closeWatch(e),zmWatch.addWatchTheme(e)}catch(e){zmUtil.debugLog(e)}},setRMOBJ:function(e,t){zmWatch.setWatchType(e,t.WT),zmWatch.setReminderDesc(e,t.RMDSC),zmWatch.setReminderDate(e,t.RMD),zmWatch.setReminderType(e,t.RMT),zmWatch.setReminderMode(e,t.RMM),zmWatch.setCmpModified(e),zmWatch.setModified(e,!0),zmWatch.setAvoidWatch(e,!1)},getRMOBJ:function(e){try{var t={};if(q[e]._watchDOM){var a,i=q[e]._watchDOM,c=i.find("tr#zmWatch_type_"+e),r=i.find("tr#zmWatch_option_"+e);if(c.find("i.msi-option").length)a=c.find("i.msi-option").closest("label").eq(0).attr("data-val").split("_")[2],a=parseInt(a);var n=r.find('div[data-val="zm_reminderMode"]').find(".reminderMode").attr("data-val");n=parseInt(n);var o=r.find('div[data-val="zm_reminderDate"]').find("input").eq(0).val(),d=r.find('div[data-val="zm_reminderTime"]').find("input").eq(0).val();if(!d&&""===$.trim(d))return zmWatch.errorShow(e,"Time field is empty! Please provide the time"),!1;if(d&&!zmWUtil.isValidateTime(d))return zmWatch.errorShow(e,"Please provide the valid time"),!1;if(d)1===(d=$.trim(d)).split(":")[0].length&&(d="0"+d);o=o+" "+d;var m=zmWatch.getEditor(e).getContent(),l=0;r.find('div[data-val="zm_reminderType_1"]').find("i").eq(0).hasClass("msi-check")&&(l=1),t.WT=a,t.RMM=n,t.RMD=o,t.RMDSC=m,t.RMT=l}return t}catch(e){zmUtil.debugLog(e)}},callbackWatch:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=zmWatch.getRMOBJ(e);if(!a)return!1;"function"==typeof q[e].calleeObj.callback&&q[e].calleeObj.callback(a,t)&&(zmUtil.hideMenu(),delete q[e])},addWatch:function(e,t){var a,i=q[e]._watchDOM.find("tr#zmWatch_type_"+e);i.find("i.msi-option").length&&(a=i.find("i.msi-option").closest("label").eq(0).attr("data-val").split("_")[2]);if(!a)return zmWatch.errorShow(e,"Please select any reminder type"+e),!1;var c={accId:zmUtil.getZohoAccId(),mymId:e,actType:"watch",watchMode:"a"};q[e]&&q[e].reminder&&(c.watchMode="u");var r=zmWatch.getRMOBJ(e);if(!r)return!1;q[e]._load_type="list_saved",zmWatch.setRMOBJ(e,r),c.watchType=zmWatch.getWatchType(e),c.reminderMode=0,c.reminderDesc=zmWatch.getReminderDesc(e);var n=c.watchType;!n||1!==n&&2!==n||(c.reminderType=zmWatch.getReminderType(e),c.reminderMode=zmWatch.getReminderMode(e),c.rDate=zmWatch.getReminderDate(e)+":00");var o={cmpId:e};o.RMOBJ=zmWatch.getRMOBJ(e),o.watchMode=c.watchMode,t.attr("vtxt",t.html()),t.text(E.watch.adding),$.q("#zmWatch_save_"+e).off("click"),d(c,o,zmWatch.updateWatch)},resetWatch:function(e){var t=!1;q[e]&&!q[e].reminder&&(t=!0),t&&zmWatch.clearWatchTheme(e),q[e]&&(zmWatch.clearWatchElem(e),zmWatch.hideWatchClear(e),delete q[e])},setCmpModified:function(e){"undefined"!=typeof zmComp&&zmComp.getCurrentCompId()&&zmComp.setModified(e,1)},setModified:function(e,t){q[e]._modified_draft=t},getModified:function(e){var t=!1;return q[e]&&q[e]._modified_draft&&(t=!0),t},setAvoidWatch:function(e,t){q[e]._avoidWatch=t},getAvoidWatch:function(e){var t=!1;return q[e]&&q[e]._avoidWatch&&(t=!0),t},hideWatch:function(e){zmWatch.resetWatch(e)},getWatchObj:q}}(),window.zmWUtil={isValidateTime:function(e){return!(""===e||""!==e&&!e.match(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/))},addWatchTheme:function(e){$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("[data-event='watch']").addClass("SC_thm")},getfontFamily:function(e){var t="";switch(e){case"Arial":t="Arial,Helvetica,serif,sans-serif";break;case"Courier":t="Courier New,Courier,monospace,sans-serif";break;case"Georgia":t="Georgia,Times New Roman,Times,serif,sans-serif";break;case"Tahoma":t="Tahoma,Arial,Helvetica,sans-serif";break;case"Times":t="Times New Roman,Times,serif,sans-serif";break;case"Trebuchet":t="Trebuchet ms,Arial,Helvetica,sans-serif";break;case"Verdana":t="Verdana,Arial,Helvetica,sans-serif";break;case"Comic Sans MS":t="Comic Sans MS,sans-serif";break;case"Serif":t="Serif,sans-serif";break;case"Default":t="Default";break;case"Calibri":t="Calibri,Verdana,Arial,sans-serif";break;default:t=e}return t}};