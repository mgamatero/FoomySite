"use strict";define([],function(i,n){var e=i("zmComponent"),t=i("zmail.Framework.Utils.PUBSUB"),o={},a=new t,r={push:function(n,e){r.handle(n,e)},addHandler:function(n,e){a._subscribeHandler(n,e),o[n]=-1<o[n]?o[n]+1:1},removeHandler:function(n,e){a._unsubscribeHandler(n,e),0<o[n]&&(o[n]-=1)},commonHandler:function(n,e){window.console.log("unhandled notification : ",n),window.console.log("module"+e),n.error?i("zmUtil").updOutbox(n):n.bulk||n.sweep?i("zmail.MailAction.Initializer").notifyBulkAction(n):zmAppLoader.load("NewMailNotifier").done(function(){zmail.Listing.Notifier.getNewMessage("newm","chat",n)})},handle:function(n,e){var i=(e=e||{}).module||n.module||"";0<o[i]?a.publish(i,{data:n,opts:e}):r.commonHandler(n,e)}};return e.notifier={__handlers:o,push:r.push,addHandler:r.addHandler,removeHandler:r.removeHandler},e}),define([],function(n){var i,t,o,a,r,u=n("zmComponent"),l=n("$.subscribe"),d=n("$"),e=n("_zm"),c=n("zmail.Utils.DOM"),s=[],m=!1,f=[],p=0,v=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return zdom("div",{className:"zmNewMail"},zdom("ul",{className:"SC_P2r"},zdom("li",null,zdom("div",null,zdom("span",null,n.sender),zdom("span",null,n.subject)))))},h=function(){var n=0;if(m&&d(r).length){var e=d(r).find("[type='notification']").eq(0);if(e.length)n=e[0].getBoundingClientRect().height+10}d(t).css("margin-bottom",n+"px")},g=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};m=e.focus||!1,r=e.elem,h()},z=function(n){var e={};return e.subject=n.SB||"",e.sender=n.SN||"",v(e)},w={start:function(){p<i?w.create():p=i<p?0:p},add2Q:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};n.elm=z(n),s.push(n),o=o||setInterval(function(){w.start()},1e3)},popFromQ:function(n){w.destroy(n)},addElm2Parent:function(n){var e=t.firstChild;h(),e?c.mountBefore(n,e):c.mount(n,t)},create:function(){if(0<s.length){var n=s.shift(),e=n.elm;f.push(n),w.action(e,n),w.addElm2Parent(e),p++,u.soundNotifier.play("mail"),setTimeout(function(){w.popFromQ(e)},4e3)}else clearInterval(o),o=void 0},action:function(n,e){u.bind({elm:n,ev:"click",fn:a,args:[e]})},destroy:function(n){e.addClass(n,"zmRemoveNM"),setTimeout(function(){e.remove(n)},200),p=0<p?p-1:0}};return u.mailNotifier=function(){var n,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t=(n=e)&&n.parent||document.body,i=n&&n.notifications2Display||2,l("comments/focus",g),a=n&&n.openMail||function(n){window.console.log("open mail for this notification : ",n)},{push:function(n){w.add2Q(n)},nobj:function(){return u.debug?f:""}}},u}),define([],function(t,n){var e,i=t("zmail.Core.Namespaces"),o=zmText.get("notifier").soundNotifier,a=i.create("zmComponent.soundNotifier"),r={},u=["mail","stream"],l=".mp3",d={},c=void 0!==window.Audio&&"function"==typeof window.Audio,s={1:o.bell,2:o.electric,3:o.cue,4:o.wink,5:o.ting},m={1:"Bell",2:"Electric",3:"Cue",4:"Wink",5:"Ting"},f=[0];Object.keys(m).forEach(function(n){f.push(Number(n))});var p=function(n){var e,i=d[n];return e=m.hasOwnProperty(i)?m[i]+l:m[1]+l,new Audio(zmResource.get("media",e))},v=function(n,e){-1<u.indexOf(n)&&(d[n]=e||0,e&&c&&(r[n]=p(n)))};return a.play=t("_").throttle(function(n){var e,i=t("zmUtil").getWindowVisibilityStatus();i=i<=0;try{if(!i||!d[n]||!c)return;void 0===r[n]?r[n]=p(n):void 0!==r[e=n]&&(r[e].pause(),r[e].currentTime=0),r[n].play()}catch(n){}},500),a.stop=function(n){void 0!==r[n]&&r[n].pause()},a.initialize=function(){e=zmail.Settings.MailSuite.Settings.General.MailSoundNotifier.Setting,v("mail",e.get()),e.on("props.change",function(n){(n=n||{}).changed.hasOwnProperty("value")&&v("mail",n.changed.value)})},a._allowedValues=f,a.soundCodesMap=s,a._getAudioObject=function(n){var e;if(m.hasOwnProperty(n)&&c)return e=m[n]+l,new Audio(zmResource.get("media",e))},a._isSupported=c,a});