"use strict";define([],function(o){var s=zmail.Core.Namespaces.create("zmfolAction");s.rgtFolId="";var d=o("zmUtil");s.loadFolderApp=function(e){o("zmAppLoader").load("zmFolder").then(function(){e()})};var c,t;s.isDeletedFolder=function(e){for(var r=s.getChildrenOf(zmail.folId.tId),t=r.length,i=0;i<t;i++)if(r[i]===e)return!0;return!1},s.getChildrenOf=function(e){var o=[],l=zmail.folTree[1];return function e(r){var t=l[r];if(t){var i=t.CH;for(var a in i)o.push(a),l[a]&&e(a)}}(e),o},s.hasSharedFol=function(){return!(!zmail.shrTree||!zmail.shrTree.length)},s.getSortProperties=function(e,r,t){try{var i={sortBy:"date",sortOrder:!1,type:0};if(!e&&void 0===t)return i;if(void 0===t)if(d.isFolderId(e))if(s.isChildFol(e)){var a=s.getParentFolderId(e);t=zmail.folTree[1][a].CH[e].SMIF}else t=zmail.folTree[0][e].SMIF;else t=o("zmList").getListObj(e,"sortOrder")||0;return 0===t||1===t?i.sortOrder=1===t:2!==t&&3!==t||(i.sortBy="size",i.sortOrder=3===t),i.type=t||0,r?i[r]:i}catch(e){return d.debugLog(e),!1}},s.getParentFolderId=function(e){var r=zmail.folTree[1];for(var t in r)if(r[t].CH[e])return t;return 0},s.getNotificationSuppressedFolders=function(e){var r=o("zmAjq"),t=$.Deferred();return r.XHR({u:zmail.conPath+"/mailNotification.do",t:"POST",fn:function(e){e=e||{},t.resolve({folderList:e.status||[]})},p:{mode:"getSuppressedFolderList",accId:e||zmail.accId},csr:"s",efn:function(){t.reject()}}).fail(function(){t.reject()}),t.promise()},s.getShareFolderNotificationList=function(){var e=o("zmAjq"),r=$.Deferred();return e.XHR({u:zmail.conPath+"/share.do",t:"get",p:{mode:"getShrNotifInfo"},fn:function(e){var t,i;t=e.stats,(i=zmail.shrTree[0])&&Object.keys(i).forEach(function(r){t.forEach(function(e){e.SHID!==i[r].SHID||(i[r].isNotificationEnabled=e.NOTIFY)})}),r.resolve(e)},efn:function(e){r.reject(e)},isXHRNeeded:!1}),r.promise()},s.isChildFol=function(e){return!!s.getParentFolderId(e)},s.getFolCV=function(e){if(s.isChildFol(e)){var r=s.getParentFolderId(e);return zmail.folTree[1][r].CH[e].CV}return zmail.folTree[0][e].CV},s.getMailFolderPaths=(t=function(){c=void 0},$.subscribe("folder/added",t),$.subscribe("folder/trashemptied",t),$.subscribe("folder/moved",t),$.subscribe("folder/renamed",t),$.subscribe("folder/deleted",t),$.subscribe("/mail/accountSwitch",function(e,r){"success"===(r=r||{}).status&&t()}),function e(r,t){var i,a=[];if((t=t||{}).pathStack=t.pathStack||[],t.idStack=t.idStack||[],t.folderMap=t.folderMap||zmail.folTree[0],!r&&!t.isSubTree)return c||e(!0);for(i in t.isSubTree||(c=[]),c=c||[],t.folderMap)a[t.folderMap[i].SE-1]=i;for(var o=0,l=a.length;o<l;o++)if(a[o]){i=a[o],t.pathStack.push(t.folderMap[i].FN),t.idStack.push(i);var d=zmail.folTree[1][i]&&zmail.folTree[1][i].CH?Object.keys(zmail.folTree[1][i].CH).length:0,n=t.idStack[0],f=t.idStack[t.idStack.length-2];c.push({id:i,name:t.folderMap[i].FN,path:t.pathStack.join("/")+"/",parentName:1<t.pathStack.length?t.pathStack[0]:"",parentID:n||null,immediateParentID:f||null,levelCount:t.pathStack.length-1,isSharedFolder:"-1"!==t.folderMap[i].SH,childCount:d}),zmail.folTree[1][i]&&e(!1,{pathStack:t.pathStack,idStack:t.idStack,folderMap:zmail.folTree[1][i].CH,isSubTree:!0}),t.pathStack.pop(),t.idStack.pop()}else a.splice(o,1),o--,l--;return c}),s.allowDrag=function(e){var r,t;for(r in e)t=r;return t!==zmail.folId.iId&&t!==zmail.folId.dId&&t!==zmail.folId.teId&&t!==zmail.folId.sId&&t!==zmail.folId.spId&&t!==zmail.folId.oId&&t!==zmail.folId.tId},s.allowDrop=function(e,r,t){var i,a,o,l,d;if("header"===t)return!0;for(i in r)a=i;for(i in e)l=i;if(1===zmail.mailOpt.folSort&&"inside"!==t)return d=zmail.folTree[0][a],!("next"!==t||!d||Object.keys(zmail.folTree[0]).length!==d.SE);if(a===l)return!1;if(a===zmail.folId.iId&&"inside"===t)return!0;if(a===zmail.folId.iId||a===zmail.folId.dId||a===zmail.folId.teId||a===zmail.folId.sId||a===zmail.folId.spId||a===zmail.folId.oId||a===zmail.folId.tId)return!1;for(o=s.getParentFolderId(a);o;){if(o===l)return!1;o=s.getParentFolderId(o)}return!0},s.updateFoldersCV=function(e){var r,t,i,a=zmail.folTree;for(r in a[0])if(d.hasFolSpecConversation(r)){a[0][r].CV=e;var o=s.getChildrenOf(r);for(i in o){t=o[i];var l=s.getParentFolderId(t);a[1][l].CH[t].CV=e}}},s.updateCV=function(e,r){var t=zmail.folTree,i=s.getParentFolderId(e);i?t[1][i].CH[e].CV=r:t[0][e].CV=r};var i=function(e){var r,t=o("zmText").get("folderPreUtils").sharedFolder;switch(e){case"11":r=t.read;break;case"12":r=t.write;break;case"13":r=t.readWrite}return r};return s.updateSFProperty=function(){try{var e,r;if(s.hasSharedFol()&&d.isShrFolEnabled())for(e in zmail.shrTree[0])(r=zmail.shrTree[0][e]).roleName=i(r.ROLE)}catch(e){d.debugLog(e)}},s.isMutualFolder=function(e){try{if(!d.isFolderId(e))return!1;if(s.isChildFol(e)){var r=s.getParentFolderId(e);return"-1"!==zmail.folTree[1][r].CH[e].SH}return"-1"!==zmail.folTree[0][e].SH}catch(e){return d.debugLog(e),!1}},s.getSystemFolders=function(e){var r=e.folType,t=zmail.folId,i=t.dId,a=t.teId,o=t.spId,l=t.tId,d=t.oId,n=t.sId,f=[];switch(r){case"outgoing":f=[i,a,d,n];break;case"incoming":f=[o,l];break;case"composing":f=[i,a,d]}return f},s.isSystemFolder=function(e){var r=e.folType,t=e.folId;return s.getSystemFolders({folType:r,folId:t}).includes(t)},s.getExcludedFolders=function(e){var r=zmail.folId,t=r.dId,i=r.teId,a=r.spId,o=r.tId,l=r.oId,d=r.sId,n=[],f=s.getChildrenOf(o);switch(e){case"headerBand":n=[t,i];break;case"attListing":n=[t,i,l];break;case"archive":n=[t,i,a,l];break;case"views":n=[t,i,a,o,l].concat(f);break;case"unreadStatus":n=[t,i,a,o,l,d].concat(f);break;case"unreadCount":n=[t,i,d];break;case"threadCount":n=[o,t,a,i,l].concat(f)}return n},s.isExcludeFolder=function(e,r){return s.getExcludedFolders(e).includes(r)},s.updateModel=function(e,r,t){try{if(!e||!["CV","E","FN","SN","HC","IA","SE","SH","SMIF","VW","ISF"].includes(r)||!d.isFolderId(e))return;var i=zmail.folTree;if(s.isChildFol(e)){var a=s.getParentFolderId(e);i[1][a].CH[e][r]=t}else i[0][e][r]=t}catch(e){return d.debugLog(e),!1}},s.getModel=function(e,r){try{if(!e||!d.isFolderId(e))return;var t;if(s.isChildFol(e)){var i=s.getParentFolderId(e);t=zmail.folTree[1][i].CH[e]}else t=zmail.folTree[0][e];return r?t[r]:t}catch(e){d.debugLog(e)}},s.getUnreadCount=function(e){return e&&d.isFolderId(e)&&!o("zmInit").excludedFolders("unreadCount",e)?Number(zmail.folCount[e].c):0},s.isDeskNotificationEnabled=function(e){var r=e.SHID;if(r){var t=zmail.shrTree[0];return!!(t&&t[r]&&t[r].isNotificationEnabled)}},s});