"use strict";_defineSettingsModule("App",function(e,a,s){var i,t,o=a("Platform.Events.Base"),r=a("Platform.System.Utils"),p=a("Platform.System.Constants"),u=!1,l=!1,d={OPEN:"settings.mailsuite.app.opened",CLOSING:"settings.mailsuite.app.closing",CLOSE:"settings.mailsuite.app.closed",TAB_ACTIVE:"settings.mailsuite.app.tab.active",TAB_INACTIVE:"settings.mailsuite.app.tab.inactive",HASHURL_CHANGE:"settings.mailsuite.app.hashurl.changed"},c={appId:"zm-settings",appIcon:"msi-settings",appCenterCustomClass:"zm-settings",loaderId:"zm-settings-loading-bar"},n={appName:zmText.get("zm-settings-mailsuite-appshell","mailsuiteApp.shell.appName")},g=function(){var t=$.e(zdom("div",null));t.attr({id:c.loaderId}),$.e(t).css({"text-align":"center","margin-top":"200px"});var e=$.e(zdom("div",{className:"msi-settings zmSetGearLoading"}));return $.e(t).appendDOM(e),{show:function(e){e&&($.e(e).appendDOM(t),t.show())},hide:function(e){(e=e||{}).noRemove?$.e(t).hide():$.e(t).remove()}}}(),m={appId:c.appId,appname:n.appName,appIcon:c.appIcon,customCenterClass:c.appCenterCustomClass,data:{CNodes:3},onDelete:function(){var e={stopClosing:!1};return o.publishEvent(s,d.CLOSING,e),!1===e.stopClosing&&t(),!e.stopClosing},hashKey:"settings",hashChangeHandler:function(e){var t=this,p=null;u?l||zmsuite.showWorkSpace(c.appId):p=i();var n=function(){o.publishEvent(s,d.HASHURL_CHANGE,{params:e,router:t})};null!==p?p.done(n):n(),r.debugLog("settings hash-url updated",e)}};i=function(){var e,t,p;if(zmTab.currentTab===m.appId)return r.makeDeferred().resolve();if(!zmsuite.isWorkspaceAvailable(m.appId)){if(zmTab.isMaxLimitReached())return!0;zmsuite.setWorkSpace(m),zmsuite.renderWorkSpace()}zmsuite.showWorkSpace(m.appId),e=zmsuite.getCenter(c.appId)[0].centerArr[2].$el[0],t=zmsuite.getCenter(c.appId)[1].$el[0],p=p=zmsuite.getCenter(c.appId)[0].$el[0],g.show(e);var n=r.makeDeferred();return o.publishEvent(s,d.OPEN,{appContainer:e,previewCard:t,appWrapper:p,process:n}),n.done(function(e){r.debugLog("App opened successfully !!",e)}).fail(function(e){r.debugLog("App opening failed !!",e)}),n.always(function(){g.hide()}),u=!0,n.promise()},t=function(){var e,t,p;e=zmsuite.getCenter(c.appId)[0].centerArr[2].$el[0],t=zmsuite.getCenter(c.appId)[1].$el[0],p=zmsuite.getCenter(c.appId)[0].$el[0];var n=r.makeDeferred();return o.publishEvent(s,d.CLOSE,{appWrapper:p,appContainer:e,previewCard:t,process:n}),n.done(function(e){r.debugLog("App closed successfully !!",e),zmModules.getRHSModule().then(function(e){(0,e.rhs)().rhsBar.getApp("Settings").unSelect()})}).fail(function(e){r.debugLog("App closing failed !!",e)}),u=!1,n.promise()};var f=function(){return new Promise(function(e,t){zmAppLoader.load(p.ModuleList.MAILSUITE_APP_CORE).then(function(){e()},function(){t()})})},C=function(e,t,p){t===c.appId?(l=!0,o.publishEvent(s,d.TAB_ACTIVE,{}),r.debugLog("Settings App Tab - Gained focus")):p===c.appId&&(l=!1,o.publishEvent(s,d.TAB_INACTIVE,{}),r.debugLog("Settings App Tab - Lost focus"),zmModules.getRHSModule().then(function(e){(0,e.rhs)().rhsBar.getApp("Settings").unSelect()}))};s.Events=r.copyProperties(d,s.Events),s.Constants=r.copyProperties(c,s.Constants),$.subscribe("/apps/tabSwitched",C),o.subscribeEvent(s,d.OPEN,function(e){var t=(e=e||{}).appContainer,p=e.previewCard,n=e.appWrapper,s=e.process;zmail.Settings.initializeSystem().done(function(){setTimeout(function(){f().then(function(e){r.debugLog("App core module loaded",e),a("MailSuite.App.Core").openApp({appWrapper:n,appContainer:t,previewCard:p,process:s})},function(e){r.debugLog("App core module failed to load",e),s.reject(e)})},0)}).fail(function(e){r.debugLog("Settings system failed to initialize",e),s.reject(e)})}),o.subscribeEvent(s,d.CLOSE,function(e){var t=(e=e||{}).appContainer,p=e.appWrapper,n=e.previewCard,s=e.process;f().then(function(e){r.debugLog("App core module loaded",e),a("MailSuite.App.Core").closeApp({appWrapper:p,appContainer:t,previewCard:n,process:s})},function(e){s.reject(e),r.debugLog("App core module failed to load",e)})}),e.openApp=i,e.closeApp=t,e.triggerWorkspaceClose=function(){zmsuite.closeWorkspace(c.appId)},e.Events=d,e.Constants=c},"MailSuite");