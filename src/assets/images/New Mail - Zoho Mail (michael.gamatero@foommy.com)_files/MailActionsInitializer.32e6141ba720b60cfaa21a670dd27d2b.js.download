"use strict";!function(){var m=zmail.Core.Namespaces.create("zmail.MailAction.Initializer"),u=zmText.get("MailActionsInitializer"),d=ZMail.lConstants,i=d.cls;m.doActions=function(t,a,e){zmmailAct.doActions(t,a,e)},m.applyActions=function(t,a,e){zmmailAct.applyActions(t,a,e)},m.rapplyActions=function(t,a){zmmailAct.rapplyAction(t,a)},m.rdoActions=function(t,a){zmmailAct.rdoAction(t,a)},m.handleWMSEvents=function(t,a,l,c){var s,o=[],e=l.AID||a.AID,r={MOVE_MAIL:function(){var a,e=l.FD&&"null"!==l.FD?l.FD:"",t=l.MLIST||[],i=[];if(!e)return r.DELETE_MAIL();var n=t[0].SFID;e===zmail.folId.tId&&""!==zmfolAction.getEmptyFolderStatus(n)||(t.forEach(function(t){a=t[d.meta.id],i.push(a),(s=zmUtil.getMailObj(a))&&s[d.meta.fId]!==e&&o.push(t.M)}),zmInit.updateIDB({transactType:"update",data:{msgIds:i,actionName:"move",changeId:c,newValue:e}}),o.length&&m.rdoActions({result:"success"},{action:"move",mailId:o,folId:e,from:"notifier"}))},DELETE_MAIL:function(){var a,t=l.MLIST||[],e=[];t.forEach(function(t){a=t[d.meta.id],e.push(a),zmUtil.getMailObj(a)&&o.push(a)}),o.length&&m.rdoActions({result:"success"},{action:"delete",mailId:o,from:"notifier",fT:5}),zmInit.updateIDB({transactType:"delete",data:{msgIds:e,actionName:"delete",changeId:c}})},ARCHIVE_MAIL:function(){var a,e,t=l.MLIST||[],i=[];t.forEach(function(t){a=t[d.meta.id],i=i.concat(a),void 0!==(e=zmUtil.getMailObj(a,d.meta.archive))&&0===e&&o.push(String(t.M))}),o.length&&m.rdoActions({result:"success"},{action:"archive",mailId:o,tmailId:[],from:"notifier"}),zmInit.updateIDB({transactType:"update",data:{msgIds:i,actionName:"archive",changeId:c}})},UNARCHIVE_MAIL:function(){var a,e,t=l.MLIST||[],i=[];t.forEach(function(t){a=t[d.meta.id],i=i.concat(a),(e=zmUtil.getMailObj(a,d.meta.archive))&&1===e&&o.push(String(a))}),o.length&&m.rdoActions({result:"success"},{action:"unarchive",mailId:o,tmailId:[],from:"notifier"}),zmInit.updateIDB({transactType:"update",data:{msgIds:i,actionName:"unarchive",changeId:c}})},MARK_FLAGGED:function(){var a,t=l.METADATA,e=[],i=l.S,n="1"===i?"read":"unread";t.forEach(function(t){a=t[d.meta.id],e.push(a),(s=zmUtil.getMailObj(a))&&i!==String(s[d.meta.read])&&o.push(String(a))}),o.length&&m.rapplyActions({result:"success"},{action:n,mailId:o}),zmInit.updateIDB({transactType:"update",data:{msgIds:e,actionName:n,changeId:c}})},APPLY_FLAG:function(){var a,e,t=l.METADATA,i=l.NFG,n=[];t.forEach(function(t){a=t[d.meta.id],n.push(a),(e=zmUtil.getMailObj(a,d.meta.flag))&&e!==i&&o.push(a)}),o.length&&m.rapplyActions({result:"success"},{action:"flag",mailId:o,tmailId:[],fVal:i}),zmInit.updateIDB({transactType:"update",data:{msgIds:n,actionName:"applyFlag",changeId:c,newValue:i}})},APPLY_LABEL:function(){var a,t=l.METADATA,e=[],i=l.TAG[0];t.forEach(function(t){a=t[d.meta.id],e.push(a),(zmUtil.getMailObj(a,d.meta.tag)||[]).includes(i)||o.push(a)}),o.length&&m.rapplyActions({result:"success"},{action:"label",mailId:o,tmailId:[],lA:"add",lId:i}),zmInit.updateIDB({transactType:"update",data:{msgIds:e,actionName:"addLabel",changeId:c,newValue:i}})},REMOVE_LABEL:function(){var a,t=l.METADATA,e=[],i=l.TAG[0];t.forEach(function(t){a=t[d.meta.id],e.push(a),(zmUtil.getMailObj(a,d.meta.tag)||[]).includes(i)&&o.push(a)}),o.length&&m.rapplyActions({result:"success"},{action:"label",mailId:o,tmailId:[],lA:"delete",lId:i}),zmInit.updateIDB({transactType:"update",data:{msgIds:e,actionName:"removeLabel",changeId:c,newValue:i}})},MARK_RECENT:function(){var a,e,t=l.METADATA,i=l.S2,n=[];t.forEach(function(t){a=t[d.meta.id],n.push(a),(e=zmUtil.getMailObj(a,"NS2"))&&e!==i&&zmUtil.updateMailData("NS2",i,a)}),zmInit.updateIDB({transactType:"update",data:{msgIds:n,actionName:"status2Id",changeId:c,newValue:i}})}};e===zmail.accId&&r[t]&&r[t]()},m.notifyBulkAction=function(t){var a,e=t.bulk,i="",n="",l="",c=zmUtil.getFolId(),s="";if(e){zmInit.getFolderTreeCount(),-1!==e.indexOf("'")&&(e=e.replace(/'/gi,'"')),e=$.parseJSON(e);var o={SEARCH:{text:u.filterview.search,id:"search"},FOLDER:{text:zmInit.findFolName(e.fId)+" "+u.filterview.folder,id:e.fId},LABEL:{text:zmUtil.findTagName(e.label)+" "+u.filterview.tagview,id:e.label},UNREAD:{text:u.filterview.unreadview,id:"unread"},ALLMESSAGE:{text:u.filterview.allmsgview,id:"all"},FLAGED:{text:u.filterview.flagview,id:"flag"}};switch(a=e.action,l=o[n=e.view].text,s=o[n].id,"SEARCH"===n||zmPrev.prevDetails("zm_Container").msgId||c===s&&$.publish("/mail/listMails",{}),a){case"READ":i=zmText.applyArgs(u.bulkaction.view.readcomplete,{viewtype:l});break;case"UNREAD":i=zmText.applyArgs(u.bulkaction.view.unreadcomplete,{viewtype:l});break;case"MOVE_TO":var r=e.actionList,m=zmInit.findFolName(r);i=zmText.applyArgs(u.bulkaction.view.movecomplete,{destinationfolder:m,viewtype:l});break;case"SPAM":i=zmText.applyArgs(u.bulkaction.view.spamcomplete,{viewtype:l});break;case"NOTSPAM":i=zmText.applyArgs(u.bulkaction.view.notspamcomplete,{viewtype:l});break;case"LABEL":var d=e.actionList,p=zmUtil.findTagName(d);i=zmText.applyArgs(u.bulkaction.view.tagadded,{tagname:p,viewtype:l});break;case"UNLABEL":d=e.actionList,p=zmUtil.findTagName(d),i=zmText.applyArgs(u.bulkaction.view.tagremoved,{tagname:p,viewtype:l});break;case"FLAG":case"CLEAR_FLAG":switch(parseInt(e.actionList)){case 0:i=zmText.applyArgs(u.bulkaction.view.clearflag,{viewtype:l});break;case 1:i=zmText.applyArgs(u.bulkaction.view.infoflag,{viewtype:l});break;case 2:i=zmText.applyArgs(u.bulkaction.view.impflag,{viewtype:l});break;case 3:i=zmText.applyArgs(u.bulkaction.view.followupflag,{viewtype:l})}break;case"DELETE":case"DELETE_FROM_SPAM":case"DELETE_FROM_TEMPLATE":case"DELETE_FROM_DRAFT":case"DELETE_FROM_TRASH":i=zmText.applyArgs(u.bulkaction.view.deletecomplete,{viewtype:l});break;case"ARCHIVE":i=zmText.applyArgs(u.bulkaction.view.archivecomplete,{viewtype:l});break;case"UNARCHIVE":i=zmText.applyArgs(u.bulkaction.view.unarchivecomplete,{viewtype:l})}zmUtil.succErrMsg("s",i)}else if(t.sweep){switch(e=t.sweep,zmInit.getFolderTreeCount(),-1!==e.indexOf("'")&&(e=e.replace(/'/gi,'"')),a=(e=$.parseJSON(e)).action){case"DELETE":i=u.bulkaction.sweep.deletecomplete;break;case"ARCHIVE":i=u.bulkaction.sweep.archivecomplete}zmUtil.succErrMsg("s",i)}},m.flagMail=function(t,a){var e,i={};-1!==(e=t.parents("."+d.cls.mRow)[0].id).indexOf("t")?(i.thd=[zmInit.zmsubStr(e,"t")],i.msgId=[]):(i.msgId=[e],i.thd=[]),i.fVal=a,zmail.MailAction.Initializer.applyActions("flag","click",i)},m.setFlag=function(t,a){var e=a.flag;t.css("visibility",""),m.flagMail(t,e),zmUtil.hideMenu()},m.delMail=function(t){var a,e=t.parents("."+d.cls.mRow).attr("id");a=e.indexOf("t")?{msgId:[e],thd:[]}:{thd:[e.substring(1,e.length)],msgId:[]},zmUtil.getMailObj(e,"OFFLINE")?zmmailAct.deleteOfflineEmail(e):zmail.MailAction.Initializer.doActions("delete","mail",a)},m.delMailFromContextMenu=function(t,a){var e;t&&""!==t&&((e=t.indexOf("t")?{msgId:[t],thd:[]}:{thd:[t.substring(1,t.length)],msgId:[]}).actionSrc=a,zmail.MailAction.Initializer.doActions("delete","mail",e))},m.markSpamFromContextMenu=function(t,a){var e;t&&""!==t&&((e=t.indexOf("t")?{msgId:[t],thd:[]}:{thd:[t.substring(1,t.length)],msgId:[]}).actionSrc=a,zmail.MailAction.Initializer.doActions("spam","mail",e))},m.markNotSpamFromContextMenu=function(t,a){var e;t&&""!==t&&((e=t.indexOf("t")?{msgId:[t],thd:[]}:{thd:[t.substring(1,t.length)],msgId:[]}).actionSrc=a,zmail.MailAction.Initializer.doActions("notspam","mail",e))},m.markAsReadUnread=function(t){var a,e={};t=t.parents("."+d.cls.mRow),-1!==(a=$(t)[0].id).indexOf("t")?(e.thd=[zmInit.zmsubStr(a,"t")],e.msgId=[]):(e.msgId=[a],e.thd=[]),t.hasClass(i.unread)?zmail.MailAction.Initializer.applyActions("read","dropdown",e):zmail.MailAction.Initializer.applyActions("unread","dropdown",e)}}();