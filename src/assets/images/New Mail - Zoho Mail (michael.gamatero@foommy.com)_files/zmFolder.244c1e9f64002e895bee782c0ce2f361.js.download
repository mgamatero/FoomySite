"use strict";window.zmfolAction=function(I){var m={},n={},d={},h=zmText.get("zmFolder"),r=function(e,o,l){zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:l,p:e,csr:"s",ep:o})},s=function(e,o,l,t){var i;for(i in o=o.toLowerCase(),e)if(e[i].FN.toLowerCase()===o&&i!==l)return zmUtil.succErrMsg("e",h.folderCreateRename.folexist,t),!1;return!0},c=function(e,o){if("success"===e.status){m[e.folId]=Date.now(),ZMail.utils.updateCount({fId:e.folId,mode:"upd",count:0});var l=[e.folId];o.mailId&&l.push(o.mailId),$.publish("folder/read",l)}};zmfolAction.updateFolSortType=function(e,o){try{if(!e||!zmUtil.isFolderId(e))return;var l=zmail.folTree;if(zmfolAction.isChildFol(e)){var t=zmfolAction.getParentFolderId(e);l[1][t].CH[e].SMIF=o}else l[0][e].SMIF=o}catch(e){return zmUtil.debugLog(e),!1}},zmfolAction.getFolProperties=function(e){try{if(e&&zmail.folTree[0][e])return zmail.folTree[0][e];var o=zmfolAction.getParentFolderId(e);return o&&zmail.folTree[1][o].CH[e]}catch(e){return void zmUtil.debugLog(e)}},zmfolAction.hasChild=function(e,o){var l;return(l=I.getParentFolderId(o))===e||0!==l&&void(o=l)},zmfolAction.hasObjLength=function(e){var o;for(o in e)return!0;return!1},zmfolAction.insertNewFolder=function(e,o){var l=e.prefolId,t=e.folId,i=e.fName;if("success"===e.status){if(!zmInit.findFolName(t)){var a,d=[];a=zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH"),d[t]={E:0,FN:i,HC:0,SH:"-1",count:"0",IA:0,CV:zmail.folviewThread,SMIF:0,VW:!0},a.insertNodeAfter(d,a.mapObject,l),$.publish("folder/added",{folderID:t})}}else zmUtil.succErrMsg("e",e.emsg);o&&o.reqDoneClbk&&o.reqDoneClbk("success"===e.status,t)},zmfolAction.insertNewSubFolder=function(e,o){var l=e.prefolId,t=e.pfolId,i=e.folId,a=e.fName;if("success"===e.status){if(!zmInit.findFolName(i)){var d,m=[];d=zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH"),m[i]={E:0,FN:a,HC:0,SH:"-1",count:"0",IA:0,CV:zmail.folviewThread,SMIF:0,VW:!0},l?d.insertNodeAfter(m,d.mapObject,l,t):d.appendNode(m,d.mapObject,t),$.publish("folder/added",{folderID:i})}}else zmUtil.succErrMsg("e",e.emsg);o&&o.reqDoneClbk&&o.reqDoneClbk("success"===e.status,i)},zmfolAction.renameFolder=function(e){var o=e.folId;if("success"===e.status){var l=e.fName;if(zmInit.findFolName(o)!==l){var t,i=[],a="zmlTreeH";(t=zmList.getRowInfo(o,a,"info")).FN=l,i[o]=t,zmList.editLeftRow(i,a),$.publish("folder/renamed",{folderID:o}),$.publish("/folder/rename")}}else zmUtil.succErrMsg("e",e.emsg)},zmfolAction.markAsReadFolder=function(e){var o,l,t=zmInit.getListingDetObj();o=e||t.fId,l={accId:zmail.accId,mode:"read",folId:o};var i=[],a=zmUtil.getListMap(o);a&&(i=a.MO.slice()),r(l,{action:"read",mailId:i},c)};var f=function(e){var o=e.id,l=zmList.getMailObj(o);l&&l.FD===zmail.folId.tId&&0===l.TH&&zmContentCache.remove(o)};zmfolAction.emptyFolder=function(e,o,l){if("success"===e.status){n[e.folId]=Date.now(),zmsDialog.remove();var t=e.folId,i=zmUtil.getFolId(),a=zmInit.getListingDetObj();if(i===t&&zmPrev.clsPreview(),$("#emptyfolpopup").remove(),zmUtil.getListMap(t)?$.publish("/mail/discardFromThread",{fId:t}):zmUtil.getListMap(i)&&$.publish("/mail/discardFromThread",{fId:t,viewId:i}),$.publish("folder/archived",[t,e.isArchived]),t===zmail.folId.spId)a.fId===zmail.folId.spId&&$(zmail.mailCenter.listElem).html(zmInit.emptyRow()),ZMail.utils.updateCount({fId:t,mode:"upd",count:0}),l||zmUtil.succErrMsg("s",h.emptyfolder.emptyspammsg);else if(t===zmail.folId.tId){a.fId===zmail.folId.tId?$(zmail.mailCenter.listElem).html(zmInit.emptyRow()):I.isDeletedFolder(a.fId)&&$.publish("/mail/listMails",{fId:zmail.folId.iId}),ZMail.utils.updateCount({fId:t,mode:"upd",count:0}),zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").clearChild(zmail.folId.tId),l||zmUtil.succErrMsg("s",h.emptyfolder.emptytrashmsg),zmail.mailContainer.filter(f),$.publish("folder/trashemptied",{})}else if(t===zmail.folId.sId)a.fId===zmail.folId.sId&&$(zmail.mailCenter.listElem).html(zmInit.emptyRow()),l||zmUtil.succErrMsg("s",h.emptyfolder.emptysentmsg);else{if(l||zmUtil.succErrMsg("s",zmText.applyArgs(h.emptyfolder.emptyfol,{foldername:zmInit.findFolName(t)})),a.fId===t?zmList.showMailListing({fId:t},{toSelFol:!1}):a.fId===zmail.folId.tId?$.publish("/mail/listMails",{fId:zmail.folId.tId}):zmUtil.isFolderId(i)||$.publish("/mail/listMails",{}),e.foltree)zmail.folCount=e.foltree,zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").setCountObject(zmail.folCount),ZMail.utils.updateCount({fId:t,mode:"upd",count:zmail.folCount[t].c}),ZMail.utils.updateCount({fId:zmail.folId.tId,mode:"upd",count:zmail.folCount[zmail.folId.tId].c})}}else l||zmUtil.succErrMsg("e",e.emsg);d[e.folId]="1",zmInit.listingBand.SpamTrashBand.setBand()},zmfolAction.deleteTrashFolder=function(e,o){if("success"!==e.status)return!1;$.publish("folder/deleted");var l,t=e.folderId||e.folId,i=zmfolAction.getParentFolderId(t),a=zmUtil.getFolId(),d=zmInit.getListingDetObj(),m="zmlTreeH";l=zmList.getRowInfo(t,m),Object.keys(l).length&&(zmail.mailLeft.getNodes()[0].getLayer(m).deleteNode(l,i),a===t&&zmPrev.clsPreview(),d.fId===t&&$.publish("/mail/listMails",{fId:zmail.folId.iId}))},zmfolAction.getEmptyFolderStatus=function(e){return void 0!==d[e]?d[e]:""},zmfolAction.resetEmptyFolderStatus=function(e){d[e]=""},zmfolAction.sendEmptyFolderReq=function(e){var o,l,t;if(o=e||I.rgtFolId,!$.q("#emptyfolpopup").length){var i=[];zmUtil.getFolderObject(o).IA&&i.push(zdom("div",{className:"zm_formLne"},zdom("div",{className:"SC_lne"})),zdom("div",{className:"zm_formFld zm_formTxt"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-uncheck",id:"selArchive",onClick:zmfolAction.selectOption}),zdom("span",{id:"selArchiveText",onClick:zmfolAction.selectOption},h.emptyfolderdialog.includeArchive))));var a=zdom("div",{id:"emptyfolpopup",style:{display:"none"},className:"zm_formArea zm_Formflex"},zdom("div",{className:"zm_formFld zm_formTxt"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-option",id:"optionAll",onClick:zmfolAction.selectOption}),zdom("span",{onClick:zmfolAction.selectOption},h.emptyfolderdialog.deleteall))),zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"optionRange",onClick:zmfolAction.selectOption}),zdom("span",{onClick:zmfolAction.selectOption},h.emptyfolderdialog.deletebydate)),zdom("div",{className:"zm_formCell"},zdom("input",{className:"SC_tiput zmDisabled",type:"text",id:"delDateVal",disabled:"true",d_format:zmail.userDateFormat}))),zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"optionCount",onClick:zmfolAction.selectOption}),zdom("span",{onClick:zmfolAction.selectOption},h.emptyfolderdialog.deletebycount)),zdom("div",{className:"zm_formCell"},zdom("input",{className:"SC_tiput zmDisabled",type:"text",value:"100",id:"delMailCount",disabled:"true"}))),i[0],i[1]);$.q("body").appendDOM(a),l=(l=zmInit.findFolName(o))?" - "+l:"",$.q("#emptyfolpopup").attr("data-id",o),(t=$.q("#delDateVal")).attr("value",(new Date).getDateBy(zmail.userDateFormat)),t.attr("readonly",!0);var d=ZEVENTS(t[0]).picker("date",{dform:zmail.userDateFormat.toUpperCase(),mode:"popup"}).bind(),m={title:zdom("span",null,h.emptyfolderdialog.title+" "+l).innerHTML,style:{width:"500px"},buttons:[{txt:h.dialogMenu.ok,selected:!0,callback:function(){zmfolAction.emptyMailsFromFolder(e),zmsDialog.remove(),$.q("#emptyfolpopup").remove()}},{isCancel:!0,txt:h.dialogMenu.cancel,callback:function(){zmsDialog.remove(),$.q("#emptyfolpopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){$("#emptyfolpopup").remove(),ZEVENTS.remove(d),$.q("#"+d._cont).remove()}};zmsDialog.create("emptyfolpopup",m)}},zmfolAction.selectOption=function(e){var o=$.e(this).attr("id")||$.e(this).prev().attr("id");-1!==o.indexOf("selArchive")&&(o="selArchive",$.q("#"+o).hasClass("msi-uncheck")?$.q("#"+o).removeClass().addClass("msi-check"):$.q("#"+o).removeClass().addClass("msi-uncheck")),$.q("#"+o).hasClass("msi-unoption")&&($.q("#emptyfolpopup i").each(function(e,o){($.e(o).hasClass("msi-option")||$.e(o).hasClass("msi-unoption"))&&$.e(o).removeClass("msi-option").addClass("msi-unoption")}),$.q("#"+o).removeClass("msi-unoption").addClass("msi-option"),"optionRange"===o?($.q("#delDateVal").attr("disabled",!1),$.q("#delDateVal").focus(),$.q("#delDateVal").removeClass("zmDisabled"),$.q("#delMailCount").addClass("zmDisabled"),$.q("#delMailCount").attr("disabled",!0).blur()):"optionCount"===o?($.q("#delMailCount").attr("disabled",!1),$.q("#delMailCount").val("100").focus(),$.q("#delMailCount").removeClass("zmDisabled"),$.q("#delDateVal").addClass("zmDisabled"),$.q("#delDateVal").unbind("click").blur(),$.q("#delDateVal").attr("disabled",!0)):($.q("#delDateVal").unbind("click").blur(),$.q("#delMailCount").attr("disabled",!0).blur(),$.q("#delDateVal").attr("disabled",!0),$.q("#delDateVal").addClass("zmDisabled"),$.q("#delMailCount").addClass("zmDisabled")))},zmfolAction.emptyMailsFromFolder=function(e){var o=$("#emptyfolpopup i.msi-option").attr("id"),l=$("#emptyfolpopup #selArchive").hasClass("msi-check");if(!o||!e)return!1;var t={accId:zmail.accId,mode:"emptyfolder",folId:e},i={};if("optionRange"===o)t.selDate=i.selDate=$("#delDateVal").val();else if("optionCount"===o){var a=$("#delMailCount");if(t.leaveCount=i.leaveCount=a.val(),(parseInt(t.leaveCount)||0)<1)return a.val("0"),zmUtil.succErrMsg("e",h.emptyfolder.emptycount),!1}l&&(t.includeArchiveMails=!0),d[e]="0",zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:I.emptyFolder,p:t,csr:"s",ep:i})},zmfolAction.deleteFolder=function(e,o){if("success"===e.status){var l,t,i=e.folId,a="zmlTreeH";if(l=zmList.getRowInfo(i,a),!Object.keys(l).length)return;"-1"!==l[i].SH&&o&&o.toTrash&&(l[i].SH="-1"),t=zmail.mailLeft.getNodes()[0].getLayer(a),"move"===o?t.moveNode(l,t.mapObject,e.prefolId,e.pfolId):t.moveNode(l,t.mapObject,null,zmail.folId.tId,!0),$.publish("folder/moved",{folderID:i,toTrash:"move"!==o})}else zmUtil.succErrMsg("e",e.emsg)},zmfolAction.isValidFolder=function(e,o){var l,t=e.text(),i=o&&o.length&&o[0].id;return t=$.trim(t),"zmLTMenu_Rf"===e[0].id?l="rename":"zmLTMenu_Nf"!==e[0].id&&0!==i||(l="new"),!!I.isValidName(t,i,l)||(setTimeout(function(){e.focus()},100),!1)},zmfolAction.isValidName=function(e,o,l){var t,i,a,d,m,n=zmail.folTree[0],r=zmail.folTree[1];if(i=(t=$.trim(e)).toLowerCase(),m=l.opType||l.mode,!t.length)return zmUtil.succErrMsg("e",h.folderCreateRename.folnull,l),!1;if(zmUtil.hasSpecialChars(t,"folderName"))return zmUtil.succErrMsg("e",h.folderCreateRename.folsplchar,l),!1;if("null"===i)return zmUtil.succErrMsg("e",h.folderCreateRename.folnull,l),!1;if("inbox"===i||"drafts"===i||"draft"===i||"templates"===i||"template"===i||"sent"===i||"spam"===i||"trash"===i||"outbox"===i)return zmUtil.succErrMsg("e",h.folderCreateRename.folnameerr,l),!1;if("rename"===m){if(r[a=I.getParentFolderId(o)]?d=r[a].CH:n[o]&&(d=n),!s(d,t,o,l))return!1}else if("new"===m){if(o){if(!r[o])return!0;d=r[o].CH}else d=n;if(!s(d,t,o,l))return!1}else if("move"===m){if(!r[a=I.getParentFolderId(o)])return!0;if(d=r[a].CH,!s(d,t,o,l))return!1}return!0},zmfolAction.sendNewFolderReq=function(e,o,l){var t,i,a={};e||($("#zmLTMenu_Nf[contentEditable='true']").length?e=$.trim($("#zmLTMenu_Nf").text()):$("#zmActionNewfolder[contentEditable='true']").length&&(e=$.trim($("#zmActionNewfolder").text()))),e.length&&(i={accId:zmail.accId,mode:"add",fName:e},I.rgtFolId?(t=I.insertNewSubFolder,i.pfolId=I.rgtFolId,I.rgtFolId=""):l?(t=I.insertNewSubFolder,i.pfolId=l):t=I.insertNewFolder,o&&"function"==typeof o.reqDoneClbk&&(a.reqDoneClbk=o.reqDoneClbk),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:t,p:i,csr:"s",ep:a}))},zmfolAction.sendFolderMoveReq=function(e){var o;e.prefolId!==e.srcFolId&&(e.accId=zmail.accId,e.mode="move",o=I.deleteFolder,"move",zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:o,p:e,csr:"s",ep:"move"}))},zmfolAction.sendRenameFolderReq=function(e){var o,l;(o=(e=e||{}).fName||$.trim($("#zmLTMenu_Rf").text()))!==$("#"+I.rgtFolId).text()&&(l={accId:zmail.accId,folId:I.rgtFolId,mode:"edit",fName:o},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:I.renameFolder,p:l,csr:"s"}))},zmfolAction.onDrop=function(e,o,l,t){var i,a,d,m={},n=zmail.folTree[1];for(a in o)m.srcFolId=a;for(a in l)i=a;if("inside"===t){if(m.desFolId=i,zmfolAction.getParentFolderId(m.srcFolId)===i&&1===zmail.mailOpt.folSort)return!1;if(n[i]&&(d=n[i].CH,!s(d,zmInit.findFolName(m.srcFolId),m.srcFolId)))return!1}else if("header"===t)m.prefolId=function(){var e,o,l,t=0;for(e in l=zmail.folTree[0])l[e].SE>t&&(t=l[o=e].SE);return o}();else{if((m.prefolId=i)===zmail.folId.iId||i===zmail.folId.dId||i===zmail.folId.teId||i===zmail.folId.sId||i===zmail.folId.spId||i===zmail.folId.tId)return!1;if($("#"+i).next().is($("#"+m.srcFolId)))return!1;"-1"!==zmail.folCount[i].p&&(m.desFolId=zmail.folCount[i].p)}I.sendFolderMoveReq(m)},zmfolAction.getShortFolderPath=function(e,o){for(var l=(o=o||{}).maxLength||50,t=o.filler||"...",i=t.length,a=o.separator||"/",d=(e=e&&e.trim()||"").split(a),m=0;m<d.length;m++)d[m]=d[m].trim(),d[m].length||(d.splice(m,1),m--);1===d.length?e.length>l&&(e=e.substr(0,l-i)+t):2===d.length?e.length>l&&(e=t+a+d[1].substr(0,l-(i+1+i))+t):e=l<d[0].length+d[d.length-1].length+2+i?t+a+d[d.length-1].substr(0,l-(i+1+i))+t:d[0]+a+t+a+d[d.length-1];return e},zmfolAction.getSharedFolPaths=function(){var e,o,l=[];for(e in zmail.shrTree[0])o=zmail.shrTree[0][e],l.push({fId:e,shId:o.SHID,path:o.FN});return l},zmfolAction.getSharedFolPath=function(e){if(e&&zmUtil.isSharedFolder(e)){var o,l,t=zmfolAction.getSharedFolPaths(),i=t.length;for(o=0;o<i;o++)if((l=t[o]).fId===e)return l}return""},zmfolAction.getFolderPath=function(e){if(zmUtil.isFolderId(e)){var o,l,t=zmfolAction.getMailFolderPaths(),i=t.length;for(o=0;o<i;o++)if((l=t[o]).id===e)return l}return""};var e=function(e,o){return zmfolAction.isValidFolder(e,$("#"+zmfolAction.rgtFolId))?(o(),!0):(e.focus(),!1)};zmfolAction.newFolderMenuHandler=function(){return e(this.activeMenu.activeMenuElement,zmfolAction.sendNewFolderReq)},zmfolAction.renameFolderMenuHandler=function(){return e(this.activeMenu.activeMenuElement,zmfolAction.sendRenameFolderReq)},zmfolAction.showCreateFolderPopUp=function(t){var e,o,l,i,a,d,m,n,r,s="new",c="",f="",u=[],z=h.folderCreateRename.nestunder;i=(t=t||{}).mode||"new",m=zmsuite.getAppLeft().getNodes()[0].getLayer("zmlTreeH").el,a=(r=$(".zmLHSWra")).offset().left+r.width();var p=(d=m.position().top<0?$(".zmLHSWra").offset().top:m.offset().top)+250-$(document.body).height();0<p&&(d-=p),"rename"===i?(l=h.folderCreateRename.editfolname,z=h.folderCreateRename.nestunder,c=zmInit.findFolName(I.rgtFolId)||"/"):"new"===i&&(l=h.folderCreateRename.Createfol),"rename"===i?n=I.getParentFolderId(I.rgtFolId):"new"===i&&(n="subfolder"===t.type?I.rgtFolId:0),(u=(u=zmfolAction.getMailFolderPaths()).filter(function(e){return e.id===n})).length&&(f=u[0].path),f=f||"/",e={title:l,style:{width:"200px"},posParent:{top:d,left:a},customClass:"noanim",buttons:[{txt:h.dialogMenu.save,selected:!0,callback:function(){var e,o,l={};e=$("#zm_createfolpopup").find("input:first").val(),o="new"===t.mode?n:I.getParentFolderId(I.rgtFolId),"new"!==s&&o!==s?"new"===t.mode&&(I.rgtFolId=s||""):"new"===t.mode&&"new"===s&&"subfolder"!==t.type&&(I.rgtFolId=""),zmfolAction.isValidName(e,I.rgtFolId,{mode:t.mode,parElem:$("#zm_createfolpopup")[0]})&&("new"===t.mode?zmfolAction.sendNewFolderReq(e):"rename"===t.mode?I.sendRenameFolderReq({fName:e}):"move"===t.mode&&(l.srcFolId=I.rgtFolId,s&&(l.desFolId=s),I.sendFolderMoveReq(l)),zmsDialog.remove())}},{isCancel:!0,txt:h.dialogMenu.cancel,callback:function(){zmsDialog.remove()}}],closeaction:function(){$.q("#zm_createfolpopup").remove(),zmUtil.hideMenu()},afterDisplay:function(){var e=$("#zm_createfolpopup").find("input")[0];e&&e.focus()}};c=_zm.escapeTags(c),o=zdom("div",{id:"zm_createfolpopup"},zdom("ul",{className:"tempFormList"},zdom("li",null,zdom("input",{type:"text",maxLength:"50","data-enableshortcuts":"true",value:c,className:"SC_tiput jsFName",placeholder:h.folderCreateRename.folname})),zdom("li",null,zdom("div",null,z),zdom("span",null,zdom("input",{type:"text",className:"SC_tiput jsFPath",value:f}))))),o=$(o),"new"!==t.mode?o.find("input")[1].disabled=!0:o.find("span").click(function(e){var l,t={};zmUtil.stopEvents(e,!0),zmUtil.hideMenu(!1,!0),t.parentDOM=$(this),t.displayAs="dropdown",t.excludeList=[zmail.folId.dId,zmail.folId.teId,zmail.folId.sId,zmail.folId.tId,zmail.folId.spId,zmail.folId.oId],t.showAllItem=!0,t.showAllItemText="/",t.onSelect=function(e){var o=t.parentDOM.find("input");"all"!==e?(s=e,o[0].value=zmInit.findFolName(e)):o[s=0].value="/",l.hide()},(l=zmUtil.createFLComp("folder-path",t)).show(),l.elem.zIndex(102)});var v=$.q("#zm_createfolpopup");v.length?(v.find(".jsFName").val(c),v.find(".jsFPath").val(f)):$(document.body).append(o),zmsDialog.create("zm_createfolpopup",e),$("#zmsdialog_zm_createfolpopup").mousedown(function(e){zmUtil.stopEvents(e,!0)}),$("#zmsdialog_zm_createfolpopup").click(function(){zmUtil.hideMenu(!1,!0)})},zmfolAction.archiveFolder=function(e,o){if("success"===e.status){zmsDialog.remove();var l=e.folId,t=zmUtil.getFolId(),i=zmInit.getListingDetObj(),a=!1;t===l&&zmPrev.clsPreview(),"unarchiveAll"===o.selectedOption||"deleteArchives"===o.selectedOption?zmfolAction.updateModel(l,"IA",0):zmfolAction.updateModel(l,"IA",1),$("#archivefolpopup").remove(),"emptyArchivefolder"===o.mode?zmUtil.succErrMsg("s",zmText.applyArgs(h.archivefolder.deletearchive,{foldername:zmInit.findFolName(l)})):"unArchivefolder"===o.mode?zmUtil.succErrMsg("s",zmText.applyArgs(h.archivefolder.unarchivefol,{foldername:zmInit.findFolName(l)})):zmUtil.succErrMsg("s",zmText.applyArgs(h.archivefolder.archivefol,{foldername:zmInit.findFolName(l)})),$.publish("folder/archived",[l,e.isArchived]),"emptyArchivefolder"===o.mode&&(zmUtil.getListMap(l)?$.publish("/mail/discardFromThread",{fId:l}):zmUtil.getListMap(t)&&$.publish("/mail/discardFromThread",{fId:l,viewId:t})),"optionAll"!==o.mode&&zmUtil.removeListMap(l),i.fId===l?o.archDate||o.archCount||"unArchivefolder"===o.mode?(zmInit.reInitListing(),zmInit.setListingDetObj({}),zmInit.foldView({folId:l}),a=!0):"archive"===i.view&&"emptyArchivefolder"===o.mode?(zmInit.reInitListing(),$(zmail.mailCenter.listElem).html(zmInit.emptyRow())):"emptyArchivefolder"!==o.mode&&(zmInit.reInitListing(),$(zmail.mailCenter.listElem).html(zmInit.emptyRow()),ZMail.utils.updateCount({fId:l,mode:"upd",count:0})):"unread"!==i.view&&($.publish("/mail/listMails",{}),a=!0),a&&zmInit.getFolderTreeCount()}else zmUtil.succErrMsg("e",e.emsg)},zmfolAction.sendArchiveFolderReq=function(e){var o,l,t;if(o=e||I.rgtFolId,!$.q("#archivefolpopup").length){var i=(zmList.getRowInfo(o,"zmlTreeH","info")||{}).IA?zdom("div",{id:"archivefolpopup",className:"zm_formArea zm_Formflex"},zdom("div",{className:"zm_formFld zm_formTxt"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-option",id:"archiveAll"}),zdom("span",null,h.archivefolderdialog.archiveall))),zdom("div",{className:"zm_formSubFld",id:"archiveoptions"},zdom("div",{className:"zm_formFld zm_formTxt"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-option",id:"optionAll"}),zdom("span",null,h.archivefolderdialog.archivefol))),zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"optionRange"}),zdom("span",null,h.archivefolderdialog.archivebydate)),zdom("div",{className:"zm_formCell"},zdom("input",{className:"SC_tiput zmDisabled",type:"text",id:"delDateVal",disabled:"true",d_format:"dd/MM/yyyy",readOnly:"readonly"}))),zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"optionCount"}),zdom("span",null,h.archivefolderdialog.archivebycount)),zdom("div",{className:"zm_formCell"},zdom("input",{className:"SC_tiput zmDisabled",type:"text",value:"100",id:"delMailCount",disabled:"true"})))),zdom("div",{className:"zm_formFld zm_formTxt"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"unarchiveAll"}),zdom("span",null,h.archivefolderdialog.unarchiveall))),zdom("div",{className:"zm_formFld zm_formTxt"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"deleteArchives"}),zdom("span",null,h.archivefolderdialog.deletearchived)))):zdom("div",{id:"archivefolpopup",className:"zm_formArea zm_Formflex"},zdom("div",{className:"zm_formFld zm_formTxt"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-option",id:"optionAll"}),zdom("span",null,h.archivefolderdialog.archivefol))),zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"optionRange"}),zdom("span",null,h.archivefolderdialog.archivebydate)),zdom("div",{className:"zm_formCell"},zdom("input",{className:"SC_tiput zmDisabled",type:"text",id:"delDateVal",disabled:"true",d_format:zmail.userDateFormat,readOnly:"readonly"}))),zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-unoption",id:"optionCount"}),zdom("span",null,h.archivefolderdialog.archivebycount)),zdom("div",{className:"zm_formCell"},zdom("input",{className:"SC_tiput zmDisabled",type:"text",value:"100",id:"delMailCount",disabled:"true"}))));$.q("body").appendDOM(i),l=(l=zmInit.findFolName(o))?" - "+l:"",$.q("#archivefolpopup").attr("data-id",o),(t=$.q("#delDateVal")).attr("value",(new Date).getDateBy(zmail.userDateFormat)),t.attr("readonly",!0);var a=ZEVENTS(t[0]).picker("date",{dform:zmail.userDateFormat.toUpperCase(),mode:"popup"}).bind(),d={title:zdom("span",null,h.archivefolderdialog.title+" "+l).innerHTML,style:{width:"500px"},buttons:[{txt:h.dialogMenu.ok,selected:!0,callback:function(){zmfolAction.archiveMailsFromFolder(e)}},{isCancel:!0,txt:h.dialogMenu.cancel,callback:function(){zmsDialog.remove(),$.q("#archivefolpopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){$.q("#archivefolpopup").remove(),ZEVENTS.remove(a),$.q("#"+a._cont).remove()}};zmsDialog.create("archivefolpopup",d),$.q("#archivefolpopup").off("click").on("click","i, span",function(){zmfolAction.selectArchiveOption(this,$.q("#archivefolpopup"))})}},zmfolAction.selectArchiveOption=function(e,o){var l=$.e(e).attr("id")||$.e(e).prev().attr("id"),t=o.find("#"+l),i=o.find("#delDateVal"),a=o.find("#delMailCount"),d=o.find("#archiveoptions"),m=o.find("#unarchiveAll"),n=o.find("#deleteArchives"),r=o.find("#archiveAll");if(d.length||(d=o),$.q("#"+l).hasClass("msi-unoption"))switch(l){case"optionRange":d.find("i").removeClass("msi-option").addClass("msi-unoption"),t.removeClass("msi-unoption").addClass("msi-option"),$.q("#delDateVal").removeClass("zmDisabled"),$.q("#delMailCount").addClass("zmDisabled"),i.attr("disabled",!1),i.focus(),a.attr("disabled",!0).blur();break;case"optionCount":d.find("i").removeClass("msi-option").addClass("msi-unoption"),t.removeClass("msi-unoption").addClass("msi-option"),$.q("#delDateVal").addClass("zmDisabled"),$.q("#delMailCount").removeClass("zmDisabled"),a.attr("disabled",!1),a.val("100").focus(),i.unbind("click").blur(),i.attr("disabled",!0);break;case"optionAll":d.find("i").removeClass("msi-option").addClass("msi-unoption"),t.removeClass("msi-unoption").addClass("msi-option"),$.q("#delDateVal").addClass("zmDisabled"),$.q("#delMailCount").addClass("zmDisabled"),i.unbind("click").blur(),a.attr("disabled",!0).blur(),i.attr("disabled",!0);break;case"archiveAll":d.slideDown(),m.removeClass("msi-option").addClass("msi-unoption"),n.removeClass("msi-option").addClass("msi-unoption"),t.removeClass("msi-unoption").addClass("msi-option");break;case"unarchiveAll":d.slideUp(),r.removeClass("msi-option").addClass("msi-unoption"),n.removeClass("msi-option").addClass("msi-unoption"),t.removeClass("msi-unoption").addClass("msi-option");break;case"deleteArchives":d.slideUp(),r.removeClass("msi-option").addClass("msi-unoption"),m.removeClass("msi-option").addClass("msi-unoption"),t.removeClass("msi-unoption").addClass("msi-option")}},zmfolAction.archiveMailsFromFolder=function(e){var o=$("#archivefolpopup i.msi-option");if(!(o=1<o.length?"archiveAll"===o[0].id?$("#archiveoptions i.msi-option").attr("id"):o[1].id:$("#archivefolpopup i.msi-option").attr("id"))||!e)return!1;var l={accId:zmail.accId,mode:"archivefolder",folId:e},t={};switch(o){case"optionRange":l.archDate=t.archDate=$("#delDateVal").val();break;case"optionCount":var i=$("#delMailCount"),a=i.val()||0;if(a=parseInt(a),l.archCount=t.archCount=a,a<1)return i.val("0"),zmUtil.succErrMsg("e",h.archivefolder.emptycount),!1;break;case"archiveAll":case"optionAll":t.mode="optionAll";break;case"unarchiveAll":l.mode=t.mode="unArchivefolder";break;case"deleteArchives":l.mode=t.mode="emptyArchivefolder"}t.selectedOption=o,zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:I.archiveFolder,p:l,csr:"s",ep:t,efn:function(e,o){e&&o&&("unArchivefolder"===o.mode&&"Error while empty spam folder (Internal Error occurs)"===e?zmUtil.succErrMsg("e",h.archivefolder.errormessage):"emptyArchivefolder"===o.mode&&"Error while empty spam folder (Internal Error occurs)"===e&&zmUtil.succErrMsg("e",h.archivefolder.errormessage))}}),zmsDialog.remove()};var l=function(e,o){var l,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=$.Deferred();return e?("string"==typeof e&&(e=[e]),l=o?"addFoldersToSuppressList":"removeFoldersFromSuppressList",zmAjq.XHR({u:zmail.conPath+"/mailNotification.do",t:"POST",fn:function(){zmInit.updateSuppressedFolders(e,o),i.resolve()},p:{mode:l,accId:t.accId?t.accId:zmail.accId,folderIds:e.join(",")},csr:"s",efn:function(){i.reject()}}).fail(function(){i.reject()})):i.reject(),i.promise()};return zmfolAction.suppressNotification=function(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return l(e,!0,o)},zmfolAction.allowNotification=function(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return l(e,!1,o)},zmfolAction.handleWMSEvents=function(e,o,l){var t,i,a,d=Date.now();if(-1!==(zmail.isWSEnabled?["EMPTY_FOLDER","FOLDER_READ","ADD_FOLDER","DELETE_FOLDER","MOVE_FOLDER","RENAME_FOLDER"]:["addFolder","renameFolder","moveFolder","deleteFolder","emptyFolder","folderRead"]).indexOf(e))switch(i=l.FD&&"null"!==l.FD?l.FD:"",t=l.PID&&"null"!==l.PID?l.PID:"",a={prefolId:l.PREVID&&"null"!==l.PREVID?l.PREVID:"",pfolId:t,folId:i,fName:l.FN||"",status:"success"},e){case"addFolder":case"ADD_FOLDER":(t?zmfolAction.insertNewSubFolder:zmfolAction.insertNewFolder)(a);break;case"renameFolder":case"RENAME_FOLDER":zmfolAction.renameFolder(a);break;case"deleteFolder":case"DELETE_FOLDER":zmfolAction.deleteTrashFolder(a);break;case"moveFolder":case"MOVE_FOLDER":zmfolAction.getParentFolderId(i)!==t&&zmfolAction.deleteFolder(a,"move");break;case"folderRead":case"FOLDER_READ":if(m[i]&&d-m[i]<=2e3)return;c(a,{});break;case"emptyFolder":case"EMPTY_FOLDER":if(n[i]&&d-n[i]<=2e3)return;zmfolAction.emptyFolder(a,{},!0)}},zmfolAction.wsProcessor=function(e){var o,l=e.mode,t=e.FD;"updateSortOption"===l?(o=e.SMIF,zmfolAction.updateFolSortType(t,o)):"archivefolder"===l&&(o=e.IA,"IA",zmfolAction.updateModel(t,"IA",o))},zmfolAction.markFolderAsUnarchived=function(e){var o=e.folId;r({mode:"updateUnarchiveStatus",folId:o,accId:zmail.accId},"",function(e){e.status&&zmfolAction.updateModel(o,"IA",0)})},zmfolAction}(zmfolAction||{}),function(){var e=zmail.Core.Namespaces,i=zmText.get("zmFolder").leftTree,a=e.create("zmail.Folder.EventHandlers");a.allowFolderOperation=function(e){var o=!0;if(!e)return!1;for(var l in zmail.folId)if(zmail.folId[l]===e){o=!1;break}return o},a.nwFolContextMenu=function(){var e=$("#zmLTMenu_Nf"),o=zmfolAction.rgtFolId;zmUtil.setEditable({ele:e,target:$("#"+o),callback:zmUtil.hideMenu,allowCondition:function(){return zmail.folId.iId,!0},parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:e,activeMenuHandler:zmfolAction.newFolderMenuHandler}])},a.rnFolContextMenu=function(){var e=zmfolAction.rgtFolId,o=a.allowFolderOperation(e),l=$("#zmLTMenu_Rf");zmUtil.setEditable({ele:l,target:$("#"+e),callback:zmUtil.hideMenu,initialize:!0,allowCondition:function(){return!(!e||zmfolAction.getParentFolderId(e)===zmail.folId.tId)&&o},parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:l,activeMenuHandler:zmfolAction.renameFolderMenuHandler}])},a.delFolContextMenu=function(){var e,l=zmfolAction.rgtFolId,t="delete";a.allowFolderOperation(l)&&l?(zmfolAction.isDeletedFolder(l)&&(t="deleteTrashFolder"),e=zmail.folTree[1][l]?"deleteTrashFolder"===t?i.emptyfolconfmsg.perDelWitSubFol:i.emptyfolconfmsg.delWithSubFol:"deleteTrashFolder"===t?i.emptyfolconfmsg.permanentDel:i.emptyfolconfmsg.delFol,zmsDialog.confirm(zmText.applyArgs(e,{foldername:'"'+zmInit.findFolName(l)+'"'}),{onOk:function(){var e=zmfolAction.deleteFolder,o={accId:zmail.accId,mode:t,folId:l};"deleteTrashFolder"===t&&(e=zmfolAction.deleteTrashFolder),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:e,p:o,ep:{toTrash:"delete"===t?1:0,mode:t},csr:"s"})}}),$("#zmCntxtMenu").hide()):zmUtil.hideMenu(!0)},a.mrkReadContextMenu=function(){var e=zmfolAction.rgtFolId;e?zmfolAction.markAsReadFolder(e):zmUtil.hideMenu(!0)},a.emptyFolContextMenu=function(e){var o,l=e||zmfolAction.rgtFolId;if(l===zmail.folId.dId||l===zmail.folId.teId||l===zmail.folId.oId)return!1;l===zmail.folId.spId?zmsDialog.confirm(i.emptyfolconfmsg.spammsg,{onOk:function(){o={accId:zmail.accId,mode:"emptyspam",folId:l},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:o,csr:"s"})}}):l===zmail.folId.tId?zmsDialog.confirm(i.emptyfolconfmsg.trashmsg,{onOk:function(){o={accId:zmail.accId,mode:"emptytrash",folId:l},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:o,csr:"s"})}}):l===zmail.folId.sId?zmsDialog.confirm(i.emptyfolconfmsg.sentmsg,{onOk:function(){o={accId:zmail.accId,mode:"emptysent",folId:l},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:o,csr:"s"})}}):zmfolAction.sendEmptyFolderReq(l),zmUtil.hideMenu(!0)},a.archiveFolderContextMenu=function(e){var o=e||zmfolAction.rgtFolId;o===zmail.folId.dId||o===zmail.folId.teId||o===zmail.folId.spId||o===zmail.folId.oId||o===zmail.folId.tId||zmfolAction.isDeletedFolder(o)||zmfolAction.sendArchiveFolderReq(o)},a.markFolderAsReadHandler=function(e,o){var l,t,i,a,d,m,n=0!==(o=o||[]).length,r=zmInit.getListingDetObj(),s="unread"===r.view,c=!1,f=[],u=[],z={action:"read"};if(n||(a=(r.flag?"flag":r.view)||r.label,o=zmUtil.getListMap(a,"MO")||[]),d=o.length){for(m=0;m<d;m++)if(l=zmList.getMailObj(o[m])){if(!n&&(l.TH||s&&l.FD===e)){c=!0;break}e===l.FD&&(l.TH?u.push(l.M):f.push(l.M))}c?(t="unread"===r.view?"zm_unread":"",a=r.label?"label":a,i=r.label||r.flag,zmUtil.clearCollectionDMap(),zmInit.setListingDetObj({}),zmInit.foldView({folId:t,view:a,viewId:i,reInitialize:!0})):(0===zmUtil.getMLConversionValue()?(f=f.concat(u),z.mailId=f):(z.mailId=f,z.tmailId=u),zmail.MailAction.Initializer.rapplyActions({result:"success"},z))}},a.markFolderAsArchived=function(e,o){var l;e&&(zmUtil.isFolderId(e)&&(l=zmList.getRowInfo(e,"zmlTreeH","info")),l&&(l.IA=o?parseInt(o):1))}}();