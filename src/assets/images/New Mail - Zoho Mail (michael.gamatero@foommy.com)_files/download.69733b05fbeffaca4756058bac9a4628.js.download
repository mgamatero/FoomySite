"use strict";!function(){var e,a=(e={},$.extend(e,zmText.get("attachmentUtility","SuccErrMsg"),zmText.get("download","downloadError"),!0),e),u="download",d="hugeAttachment",g="tempDownload",f="downloadAsZip",p="selDwn",r="view",i="thb",o="tmpview",c="downloadAsZipSecure",I="getzipstream",z=[d,g,I],n={1:a.commonErr,10001:a.Invalid_input,10002:a.Server_error,10003:a.Server_error,10004:a.Server_error,10005:a.Virus_failed_Download,10006:a.Virus_Found,10008:a.Virus_progress,10011:a.Err_Origin_Download,10012:a.User_Blocked_Download,10013:a.User_Blocked_Download,10014:a.Server_error,10017:a.url_notFound,10018:a.File_sizeEx,10019:a.File_sizeEx,10020:a.Server_error,10022:a.No_Access_File},s="https://"+zmail.urls.downloadurl;window.addEventListener("message",function(e){var a;if((e.origin||e.originalEvent.origin)===s&&(a=e.data).ec){var t=n[a.ec];t||(t=n[1]),_zm.succErrMsg("e",zmText.applyArgs(t,{fname:window.decodeURIComponent(a.fn)}))}},!1);var v=function(e){var a;if(a=function(e){try{var a=zmUtil.getMailObj(e,"SB");return a&&zmUtil.replaceHtmlInSubject(a)}catch(e){return!1}}(e))return a=(a=a.substring(0,75)).replace(/\s/g,"_")},h=function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=s+"/";switch(e){case u:t+="normalDownload";break;case d:t=a.cloudLink;break;case g:t+="tempDownload";break;case f:case p:t+="downloadAsZip";break;case r:case o:t+="view";break;case i:t+="thumbnail";break;case c:t+="downloadAsZipSecure?zmudrcsr="+zmAjq.getCookie("zmudcsr");break;case I:t+="getZipStream"}return t},w=function(e){var a="POST";switch(e){case u:case d:case g:case f:case p:case I:a="GET";break;case c:a="POST"}return a},_=function(e,a){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},d={pd:location.host};if(zmUtil.debugLog("Att Param from apps ===> "+e),zmUtil.debugLog("data Param from apps ===> "+e),a===u||a===f){var r=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||e.Id,et:e.et||1,e:e.e||e.id,gId:e.gId||e.groupId}}(_zm.copyOf(e)),i=t.appName;d=$.extend(d,!0,{entityType:r.et,entityId:r.e}),a===u&&(d.attachId=r.id);var o=r.e,n=zmUtil.getMailObj(o),s=!1,l=!1;if(n&&zmUtil.isSharedFolder(n.FD)){var m=zmUtil.getShareId(n.FD);d.shId=m,s=!0}else(n&&n.streams||"streams"===i)&&(l=!0);if(e.sid?d.groupId=e.sid:e.type?d.groupId=r.gId:n&&n.streams?d.groupId=n.groupId:1!==r.et||l||s?s||(d.groupId=zmail.zuid):d.accId=zmail.accId,t.threadedAtt&&(d.threadedAtt=!0),a===f){l||(d.accId=zmail.accId);var c=v(r.e);if(c)d.fName=c;else if(i)switch(i){case"streams":d.groupId=r.gId,d.fName="Attachments";break;case"task":d.fName="Attachments"}}}else a===g?$.extend(d,!0,{fPath:e.fP,fName:e.name,fSize:e.size}):a===p?d=$.extend(d,!0,function(){for(var e,a,t,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=[],o=zmail.accId,n=[],s=!1,l=0,m=d.length;l<m;l++)t=(a=d[l]).e,s=(n=zmUtil.getMailObj(t))&&zmUtil.isSharedFolder(n.FD),e={et:parseInt(a.et),e:t,Id:a.Id},s||(a.sid?e.groupId=a.sid:a.type?e.groupId=a.gId:e.groupId=zmail.zuid),i.push(e);var c={attEntObj:JSON.stringify(i)};return s&&(c.shId=zmUtil.getShareId(n.FD)),zmUtil.isZohoAccount(o)||(c.accId=o),r.fName&&(c.fName=r.fName),c}(e,t)):a===I&&$.extend(d,!0,{fPath:e.FILEPATH});return d},S=function(e,a,t,d){var r=zmail.Utils.DOM;if(_zm("#","tarIframe")){var i=document.getElementById("tarIframe");i.parentNode.removeChild(i)}var o="tarIframe";r.mount(zdom("iframe",{id:o,name:o,width:"0",height:"0",frameBorder:"0",style:{display:"none"}}),document.body);var n=zdom("form",{id:"dwnFrm",target:o,name:"dwnFrm",action:a,encType:"application/x-www-form-urlencoded",method:t||"post",style:{display:"none"}});for(var s in r.mount(n,document.body),e)r.mount(zdom("input",{type:"hidden",name:s,value:e[s]}),n);if(d){var l=document.getElementById("tarIframe");l.onload=function(){try{var e=l.innerText||l.textContent,a=JSON.parse(e);0===a[0]&&d(a[1])}catch(e){}}}n.submit(),setTimeout(function(){_zm.remove(n)},0)};window.zmDownload=window.zmDownload||{};var t=window.zmDownload;t.downloadApp=function(){var a,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=e.mode,i=h(r,t),o=_(t,r,d),n=w(r),s=_zm.isSecureDownloadEnabled();if(s&&-1===z.indexOf(r)){var l=r;i=h(r=s?c:f),n=w(r),(a=$.Deferred(),zmAppLoader.load("securedownload").then(function(){zmComponent.securedownload().then(function(e){a.resolve(e)},function(){a.reject()})}),a.promise()).done(function(e){if(e.adHocValue&&(o.pswd=e.password),zmail.isDownloadZipOfflineEnabled&&zmail.isWSEnabled&&l===p){var a={};zmail._ws&&zmail._ws.getSessionId()&&(a.sId=zmail._ws.getSessionId());var t={type:n,url:i,data:o,xhrFields:{withCredentials:!0},headers:a};$.ajax(t)}else S(o,i,n)})}else if(zmail.isDownloadZipOfflineEnabled&&zmail.isWSEnabled&&r===p){zmail._ws&&zmail._ws.getSessionId()&&(o.sId=zmail._ws.getSessionId());var m={type:n,url:i,data:o,xhrFields:{withCredentials:!0}};$.ajax(m)}else S(o,i,n)},t.viewDocument=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length?arguments[1]:void 0;if(e.returnUrl)return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length?arguments[1]:void 0,t=h(a.mode);if(a.mode===o)t+="?fPath="+encodeURIComponent(e.fP)+"&fName="+encodeURIComponent(e.name)+"&fSize="+e.size;else{t+="?attachId="+e.Id+"&entityType="+e.et+"&entityId="+e.e,1!==e.et||void 0!==e.gId&&e.gId!==zmail.zuid||void 0!==e.sid||(t+="&accId="+zmail.accId),e.sid?t+="&groupId="+e.sid:(e.type||e.gId&&e.gId!==zmail.zuid)&&(t+="&groupId="+e.gId);var d=zmUtil.getMailObj(e.e);e.shId?t+="&shId="+e.shId:d&&zmUtil.isSharedFolder(d.FD)&&(t+="&shId="+zmUtil.getShareId(d.FD))}return t}(a,e)}}(),window.__rollupModule=void 0;