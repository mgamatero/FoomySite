"use strict";define([],function(y){var i,s,e=y("zmail.Core.Namespaces"),n=y("_zm"),M=y("zmText"),a="zm/framework/dialogClosed",T=e.create("zmsDialog"),q=new zmail.Navigator({onEscape:function(){T.remove()}}),O=function(e){e.$el&&e.$el.addClass("sel")},U=function(e){e.$el&&e.$el.removeClass("sel")},A=function(e){var t,o,n,a=0;for(e&&(a=e.length),n=$.e(zdom("div",{className:"SC_PUbtm"})),t=0;t<a;t++)o=$.e(zdom("span",null,e[t].txt)),(e[t].$el=o).on("click",e[t].callback),e[t].selected?o.addClass("sel"):e[t].isCancel&&o.attr("data-val","Cancel"),n.appendDOM(o);return n},E=function(e){var t=$.e(zdom("div",null));return"top"===e?t.addClass("SC_arr SC_arrt"):"tleft"===e?t.addClass("SC_arr SC_arrtl"):"tright"===e?t.addClass("SC_arr SC_arrtr"):"bottom"===e?t.addClass("SC_arr SC_arrb"):"bleft"===e?t.addClass("SC_arr SC_arrbl"):"bright"===e&&t.addClass("SC_arr SC_arrbr"),t},H={dragMove:function(e,t){var o,n,a=$("#zmsdialog_"+T.elemId);o=e.pageX,n=e.pageY,t(a,o-i,n-s,o,n),i=o,s=n},setDrag:function(e,t){e.on("mousedown",function(e){i=e.pageX,s=e.pageY,e.preventDefault(),$.e(document).mousemove(function(e){H.dragMove(e,t)}),$.e(document).mouseup(function(){$.e(document).off("mousemove")})})},movePopup:function(e,t,o){var n=$.e(document.body).width(),a=$.e(document.body).height(),i=e.width(),s=e.height(),l=e.offset();l.left+t<=0?e.css("left","0px"):l.left+i+t>=n?e.css("left",n-i+"px"):e.css("left",l.left+t+"px"),l.top+o<=0?e.css("top","0px"):l.top+s+o+13>=a?e.css("top",a-s-13+"px"):e.css("top",l.top+o+"px")},resPopup:function(e,t,o,n,a){var i=$.e(document.body).width(),s=$.e(document.body).height(),l=e.width(),r=e.height(),c=e.offset();i<=n+t?e.width(i-c.left):e.width(t+l),s<=a?e.height(s-c.top-13):e.height(o+r)}},t={elemId:null,create:function(e,t){var o,n,a,i,s,l,r,c,m,u,d,f,p,g,h,v,C="",b=0,z=void 0===t.defaultNavigator||t.defaultNavigator;if(this.elemId=e,this.closeaction=t.closeaction,this.options=t,g="SC_Pop ",$.q("#zmsdialog_zm_AlertText")&&$.q("#zmsdialog_zm_AlertText").remove(),t.customClass&&(g+=" "+t.customClass),t.style)for(var _ in t.style)C+=_+":"+t.style[_]+";";if(t.posParent||(g+=" SC_cent"),t.mask||(g+=" jsTrans"),$.q("#zmsdialog_"+e).length)return $.q("#zmsdialog_"+e).attr("style",C),void $.q("#zmsdialog_"+e).show();o=zdom("div",{className:g},zdom("div",{className:"SC_pe"},zdom("div",{id:"zmsdialog_"+e,className:"SC_PU"},zdom("div",{id:"zmsdialogcont_"+e,className:"SC_PUcen"})))),$.q("#"+e).wrap(o);var S,k,N=$.q("#zmsdialogcont_"+e);if((m=$.q("#zmsdialog_"+e)).attr("style",C),t.posParent&&m.parents(".SC_Pop").css(t.posParent),t.stopPropagation&&m.on("mousedown",function(e){y("zmUtil").stopEvents(e)}),t.title){var D=t.hdr_actions,P=M.get("dialog").tooltip.close,w=null;if(D){w=[];for(var x=0,W=D.length;x<W;x++)w.push(zdom("i",{className:"SC_lnk"},D[x].text))}else w=zdom("div",{className:"SCmb"},zdom("div",{className:"SC_frt"},zdom("ul",null,zdom("li",{dataTooltip:P},zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("span",{className:"SC_ttip ttr"},zdom("i",{className:"msi-close"})))))));n=zdom("div",{className:"SC_PUtt"},zdom("h3",null,w,t.title)),N.before(n)}if(t.buttons&&t.buttons.length&&(a=A(t.buttons),N.after(a)),z&&(S=t.buttons,k=q.dom,(S=S||[]).forEach(function(e,t){q.focused<0&&(q.focused=e.selected?t:-1),k.push({isArrowKeyAllowed:!0,$el:e.$el,onFocus:O,onBlur:U,onEnter:e.callback})}),q.setThisAsCurrentNavigator()),t.hideButtons&&$.q("#zmsdialog_"+e).find(".SC_PUbtm").addClass("SC_vh"),t.bottom&&N.after(zdom("div",{className:"SC_PUbtm"},t.bottom)),t.ptr&&N.after(E(t.ptr)),t.res){var I=$.e(zdom("div",null));I.css({position:"absolute",bottom:"0px",right:"0px",width:"10px",height:"10px",background:"grey"}),N.after(I),H.setDrag($.q("#zmsdialog_"+e+" div"),H.resPopup)}m.show(),$.q("#"+e).show(),setTimeout(function(){t.mask?m.parents(".SC_Pop").addClass("wht"):m.parents(".SC_Pop").addClass("tra"),t.afterDisplay&&setTimeout(function(){t.afterDisplay()},100)},500),u=(c=$.e(document.body)).height(),d=c.width(),f=m.height(),p=m.width(),t.pos&&("center"===t.pos?(i=u/2-f/2,s=d/2-p/2):"tleft"===t.pos?s=i="10%":"tcenter"===t.pos?(i="10%",s=d/2-p/2):"tright"===t.pos?l=i="10%":"mleft"===t.pos?(s="10%",i=u/2-f/2):"mright"===t.pos?(l="10%",i=u/2-f/2):"bleft"===t.pos?(s="10%",i=.9*(u-f)):"bcenter"===t.pos?(i=.9*(u-f),s=d/2-p/2):"bright"===t.pos?(i=.9*(u-f),l="10%"):"onevent"===t.pos&&(u<(i=(r=t.onelem.offset()).top+t.onelem.height()+3)+f&&(i=u-f-20),d<(s=r.left)+p&&(s=d-p-20))),m.css("top",i),s?m.css("left",s):m.css("right",l),h=m.find(".SC_PUtt").height()||0,b&&(b=a.height()||0),u=$.e(document.body).height(),window.isFinite(t.heightPercent)&&(t.heightPercent=window.parseInt(t.heightPercent),u*=t.heightPercent/100),v=u-(h+b+100),t.notToSetMaxHeight||N.css("max-height",v+"px"),t.hideclose?$.q("#zmsdialog_"+e+" .SC_PUtt i.msi-close").hide():$.q("#zmsdialog_"+e+" .SC_PUtt i.msi-close").closest("li").click(function(){T.remove()}),t.drag&&H.setDrag($.q("#zmsdialog_"+e).children(":first"),H.movePopup),t.posParent&&$.publish("/mail/menuCreated",[{element:m.parents(".SC_Pop")[0],menuHandler:this.remove.bind(this)}])},remove:function(o){var n=this,e=$.q("#"+T.elemId);q.clearTrace(),e.parents(".SC_Pop").removeClass("wht tra"),setTimeout(function(){var e,t=T.elemId;$.q("#"+t).hide(),e=$("#zmsdialogcont_"+t).contents(),$.q("#zmsdialog_"+t).parents(".SC_Pop").replaceWith(e),$.q("#zmsMask").remove(),n.closeaction&&(o||n.closeaction(),n.closeaction=null),T.elemId=null,$.publish(a,{id:t})},500)},hide:function(){$.q("#"+T.elemId).parents(".SC_Pop").removeClass("wht tra"),setTimeout(function(){$.q("#zmsdialog_"+T.elemId).parents(".SC_Pop").hide(),$.q("#zmsMask").remove()},500)},succErrMsg:function(e,t,o){(o=o||{}).parElem=o.parElem||$.q("#"+T.elemId)[0],n.succErrMsg(e,t,o)},showButtons:function(){$.q("#zmsdialog_"+T.elemId).find(".SC_PUbtm").removeClass("SC_vh")},hideButtons:function(){$.q("#zmsdialog_"+T.elemId).find(".SC_PUbtm").addClass("SC_vh")},isOpen:function(){return null!==T.elemId},listenOnceDialogClose:function(t){if("function"==typeof t){$.subscribe(a,function e(){$.unsubscribe(a,e),t()})}}};return $.extend(!0,T,t),T}),define([],function(o){var e=o("zmail.Core.Namespaces"),a=o("_zm"),i=o("zmText"),s=e.create("zmsDialog"),l="zm_AlertText",r=function(e){var t=o("zmComponent").htmlizer(["h4",{attrs:{id:l},child:[["text",e]]}]);return document.body.appendChild(t),t};return s.confirm=function(e,t){var o,n;s.create(l,(o=r(e),(n=(n=t)||{}).buttons=n.buttons||[{txt:i.get("dialog","ok"),selected:!0},{txt:i.get("dialog","cancel"),isCancel:!0}],n.mask=n.mask||!0,n.closeaction=function(){a.remove(o)},n.buttons[0].callback=function(){s.remove(),n.onOk&&n.onOk(),n.onHide&&n.onHide()},n.buttons[1].callback=function(){s.remove(),a.remove(o),n.onCancel&&n.onCancel(),n.onHide&&n.onHide()},n))},s.alert=function(e,t){var o,n;s.create(l,(o=r(e),(n=(n=t)||{}).buttons=n.buttons||[{txt:i.get("dialog","ok"),selected:!0}],n.mask=n.mask||!0,n.pos=n.pos||"center",n.closeaction=function(){a.remove(o)},n.buttons[0].callback=function(){s.remove(),n.onOk&&n.onOk()},n))},s}),function(){var e=zmail.Core.Namespaces,r=zmail.Utils.DOM,t=e.create("Dialog"),o={},n={center:"SC_cent"},a={black:"blk",white:"wht",none:"tra"},i={maskWrapper:function(e){var t=e.maskWrapperClass;return t+=" "+n[e.position],t+=" "+a[e.mask],r.element(zdom("div",{className:t}))},positionWrapper:function(e){return r.element(zdom("div",{className:e.positionWrapperClass}))},contentWrapper:function(e){return r.element(zdom("div",{className:e.contentWrapperClass}))},icon:function(e,t,o){var n=e.delimiter?o.iconDelimiterClass:"";return r.element(zdom("li",{className:n,"data-tooltip":e.dataTitle,"data-tooltip-pos":e.dataTitlePos||"bottom"},zdom("b",{className:o.iconSelectorClass,"data-id":t},zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:e.class})))))},iconGroup:function(e,n,a,i){var s=r.element(zdom("ul",null)),l=this;return _.isArray(e)||(e=[e]),_(e).each(function(e,t){var o=n+"."+a+"."+t;e.dataAttrib&&s.attr("data-attr",e.dataAttrib),r.mount(l.icon(e,o,i),s)}),s},iconGroupWrapper:function(){return r.element(zdom("div",{className:"SCmb"}))},closeIcon:function(e){var t=(e=e||{}).icons||{};if(t.closeIcon){var o=this.iconGroupWrapper();o.addClass("puClose");var n=r.element(zdom("ul",null));return r.mount(this.icon(t.closeIcon,"closeIcon",e),n),r.mount(n,o),o}},title:function(e){var t=r.element(zdom("h3",null));return t.text(e),t},leftHeader:function(o){var n,e=r.element(zdom("div",{className:"SC_flt"})),t=o.icons||{},a=this;return o.title&&r.mount(this.title(o.title),e),t.left&&(n=this.iconGroupWrapper(),_(t.left).each(function(e,t){r.mount(a.iconGroup(e,"left",t,o),n)}),r.mount(n,e)),e},rightHeader:function(o){var n,e=r.element(zdom("div",{className:"SC_frt"})),t=o.icons||{},a=this;return t.right&&(n=this.iconGroupWrapper(),_(t.right).each(function(e,t){r.mount(a.iconGroup(e,"right",t,o),n)}),r.mount(n,e)),e},header:function(e,t){e=e||{},t=t||{};var o=r.element(zdom("div",{className:e.headerClass}));return t.$leftHeader=this.leftHeader(e),r.mount(t.$leftHeader,o),t.$rightHeader=this.rightHeader(e),r.mount(t.$rightHeader,o),o},content:function(e){e=e||{};var t=r.element(zdom("div",{className:e.contentClass}));return r.setAttribute(t,"style",e.contentStyle||""),t},button:function(e,t,o){var n=e.isSelected?o.buttonSelectionClass:"",a=e.name;n+=" "+o.buttonSelectorClass;var i=r.element(zdom("span",{className:n,"data-id":t}));return e.isCancel&&r.setAttribute(i,"data-val","Cancel"),i.text(a),i},buttonContainer:function(o){var e=o.buttons,n=this;if(e&&e.length){var a=r.element(zdom("div",{className:o.buttonContainerClass}));return _(e).each(function(e,t){r.mount(n.button(e,t,o),a)}),a}return""}};o.templates=i,_.extend(t,o)}(),function(){var e=zmail.Core.Namespaces,r=zmail.Utils.DOM,t=e.create("Dialog"),o={};o.getDefaultNavigator=function(e){var t=new zmail.Navigator({onEscape:function(){e.remove()}});return function(o,n){var t=o.config,e=t.buttons,a=n.dom;if(e&&e.length){var i=function(e){e.$el&&e.$el.addClass(t.buttonSelectionClass)},s=function(e){e.$el&&e.$el.removeClass(t.buttonSelectionClass)},l=o.$els.$buttonContainer.children();_(e).each(function(e,t){n.focused<0&&(n.focused=e.isSelected?t:-1),a.push({isArrowKeyAllowed:!0,$el:r.element(l[t]),onFocus:i,onBlur:s,onEnter:function(){e.callback(o)}})})}}(e,t),t},_.extend(t,o)}(),function(){var o,e=zmail.Core.Namespaces,a=zmail.Utils.DOM,n=e.create("Dialog"),t={},i=n.templates,s={getConfig:function(){return{maskWrapperClass:"SC_Pop",positionWrapperClass:"SC_pe",contentWrapperClass:"SC_PU",headerClass:"SC_PUtt",contentClass:"SC_PUcen",buttonContainerClass:"SC_PUbtm",buttonSelectionClass:"sel",buttonSelectorClass:"js-button-selector",iconSelectorClass:"js-icon-selector",iconDelimiterClass:"SC_lbr",position:"center",mask:"white",defaultCloseIcon:!0,ignoreMouseDown:!0,avoidDeepCleanOnRemoval:!1,defaultNavigator:!0}},getCloseIcon:function(){return{class:"msi-close",callback:function(e){e.remove(),a.removeClass(document.body,"zmDialogOn")}}},extendDefaults:function(e){var t=s.getConfig();return _.extend(t,e),t.defaultCloseIcon&&(t.icons=t.icons||{},t.icons.closeIcon=s.getCloseIcon()),t}},l=function(e){var t=e.$els,o=e.config,n=e.templates||i;t.$maskWrapper=a.element(n.maskWrapper(o)),t.$positionWrapper=a.element(n.positionWrapper(o)),a.mount(t.$positionWrapper,t.$maskWrapper),t.$contentWrapper=a.element(n.contentWrapper(o)),a.mount(t.$contentWrapper,t.$positionWrapper),o.defaultCloseIcon&&(t.$closeIcon=a.element(n.closeIcon(o)),a.mount(t.$closeIcon,t.$contentWrapper)),(o.title||o.icons&&(o.icons.closeIcon||o.icons.left||o.icons.right))&&(t.$header=a.element(n.header(o,t)),a.mount(t.$header,t.$contentWrapper)),t.$content=a.element(n.content(o)),a.mount(t.$content,t.$contentWrapper),o.buttons&&o.buttons.length&&(t.$buttonContainer=a.element(n.buttonContainer(o)),a.mount(t.$buttonContainer,t.$contentWrapper))},r={buttonsCallbackInvoker:function(e,t,o){var n=e.config.buttons[t];n&&n.callback&&n.callback(e,o)},iconsCallbackInvoker:function(e,t,o){var n=e.config.icons||{},a=_zm.getProperty(n,t);a&&a.callback&&a.callback(e,o)},bindEvents:function(o){var n=o.config;o.$els.$buttonContainer&&o.$els.$buttonContainer.on("click","."+n.buttonSelectorClass,function(e){var t=a.element(e.target).closest("."+n.buttonSelectorClass).data("id");r.buttonsCallbackInvoker(o,t,e)});var e=function(e){var t=a.element(e.target).closest("."+n.iconSelectorClass).data("id");r.iconsCallbackInvoker(o,t,e)};o.$els.$closeIcon&&o.$els.$closeIcon.on("click","."+n.iconSelectorClass,e),o.$els.$header&&o.$els.$header.on("click","."+n.iconSelectorClass,e),o.config.ignoreMouseDown&&o.$els.$maskWrapper.on("mousedown",function(e){e.stopPropagation()})}},c={show:function(){this.$els.$maskWrapper.show(),a.addClass(document.body,"zmDialogOn"),this.config.navigator&&this.config.navigator.setThisAsCurrentNavigator()},hide:function(){a.removeClass(document.body,"zmDialogOn"),this.$els.$maskWrapper.hide(),this.config.hideAction&&this.config.hideAction(this)},remove:function(){o=void 0,a.removeClass(document.body,"zmDialogOn"),this.config.closeAction&&this.config.closeAction(this),this.$els.$maskWrapper.remove(),this.$els.$maskWrapper.remove(),this.config.navigator&&this.config.navigator.clearTrace(),this.config.avoidDeepCleanOnRemoval||(delete this.$els,delete this.config),$.publish&&$.publish("zm/framework/dialogClosed",{})}},m={init:function(e){return l(e),r.bindEvents(e),_.extend(e,c),this},dialogWillMount:function(e){return e.config.dialogWillMount&&e.config.dialogWillMount.call(e,e),this},_configureNavigator:function(e){var t=e.config;!t.navigator&&t.defaultNavigator&&(t.navigator=n.getDefaultNavigator(e)),t.navigator&&t.navigator.setThisAsCurrentNavigator()},mountDialog:function(e){var t=e.$dialogParent?a.element(e.config.$dialogParent):a.element(document.body),o=!0;if(e.config.hasOwnProperty("doesMountToDom")&&!e.config.doesMountToDom&&(o=!1),o&&a.mount(e.$els.$maskWrapper,t),e.config.$content){var n=e.config.$content;"string"==typeof n&&(n=a.__dangerouslyParseHTML(e.config.$content),zmail.isProduction||window.console.error("Pass the content as DOM")),n=a.element(n),a.mount(n,e.$els.$content),a.addClass(document.body,"zmDialogOn")}return this._configureNavigator(e),this},dialogDidMount:function(e){return e.config.dialogDidMount&&e.config.dialogDidMount.call(e,e),this}};t.new=function(e){e.removePreviousDialog&&o&&o.remove();var t={config:s.extendDefaults(e),$els:{}};return m.init(t).dialogWillMount(t).mountDialog(t).dialogDidMount(t),o=t},_.extend(n,t)}(),function(){var e=zmail.Core.Namespaces,n=zmail.Utils.DOM,a=e.create("Dialog"),t={};t.alert=function(e,o,t){return(t=t||{}).title=e,t.buttons=[{name:t.okButtonName||zmText.get("dialog","ok"),callback:function(e,t){o&&o(e,t),e.remove()}}],t.dialogDidMount=function(){n.blur(document.activeElement)},a.new(t)},_.extend(a,t)}(),function(){var a=zmail.Core.Namespaces.create("Dialog"),e={};e.confirm=function(e,o,n,t){return(t=t||{}).title=e,t.buttons=[{name:t.okButtonName||zmText.get("dialog","ok"),isSelected:!0,callback:function(e,t){o&&o(e,t),e.remove()}},{name:t.cancelButtonName||zmText.get("dialog","cancel"),callback:function(e,t){n&&n(e,t),e.remove()},isCancel:!0}],a.new(t)},_.extend(a,e)}(),function(){var e=zmail.Core.Namespaces,o=zmail.Utils.DOM,n=e.create("Dialog"),t={};t.tabDialog=function(t){return(t=t||{}).dialogDidMount=function(){o.blur(document.activeElement)},t.tabs.list.forEach(function(e){!0===e.isSelected&&(t.icons=e.icons)}),n.new(t)},_.extend(n,t)}();