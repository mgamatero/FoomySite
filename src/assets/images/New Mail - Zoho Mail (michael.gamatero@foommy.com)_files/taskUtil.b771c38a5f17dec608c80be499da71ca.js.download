"use strict";define([],function(e){window.zmTask=window.zmTask||{};var n=function(e,a){var t=a.tasks[0],s=zmsuite.getLeft().selId;if(e.id===s){var i=$.Deferred();$.isEmptyObject(e.tasklists)?zmail.projectsInteg.util.fetchAllTasklists(e).done(function(){i.resolve()}):i.resolve(),i.done(function(){t.tasklist=zmail.projectsInteg.util.getTasklistDetails(e.tasklists,t.tasklist_id),$.publish("/zm/zptask/addZPTask",[zmail.projectsInteg.util.constructList(a,e)])})}};return zmTask.Create=function(e,a){var t;if("projects"!==zmsuite.getLeft().selLayerId){if("addCTask"===e.action)if(zmTask.Util.isNewTaskEnabled)t=new zmTask.newCTask(e);else t=new zmTask.AddCTask(e);else if("addSTask"===e.action){t=new zmTask.AddSTask(e)}else if("addSCTask"===e.action){t=new zmTask.SCTask(e)}else if("addMTask"===e.action){t=new zmTask.addMTask(e)}return new zmTask.CreateTask({listObj:e,callback:a,viewObj:t})}var s=zmsuite.getLeft().selId;if(s){var i=$.q("div#"+s).data("zmsData"),o=i.rowObject[s].p?i.rowObject[s].p:s;zmail.projectsInteg.util.addTaskBugPopup({portalId:o},n)}},zmTask.TaskList=function(e,a,t,s){return zmTask.Util.isNewTaskEnabled?new zmTask.Listing.NewList(e,a,t,s):new zmTask.Listing.List(e,a,t,s)},{}}),function(){var D=zmText.get("taskUtil"),s={},L="inline-block";s.leftTreeContextMenu=[{htm:D.left.createProj,id:"zt_create_proj",cEdit:!0,data:{action:"createProj"}},{sep:!0,id:"zmLTMenu_lne1"},{htm:D.left.renameProj,id:"zt_rename_proj",cEdit:!0,data:{action:"editProj"}},{htm:D.center.deleteTask,cEdit:!1,data:{action:"deleteProj"}},{sep:!0,id:"zmLTMenu_lne1"},{htm:D.settings.taskSettings,cEdit:!1,data:{action:"taskSettings"}}],s.splitTask=function(){return zdom("div",{className:"zmListInfoBox"},D.center.splitTask,zdom("div",{className:"zmBtnWra"},zdom("span",{id:"splittask",className:"zmBtn thmBgBtn"}," ",D.common.yesbutton," "),zdom("span",{id:"donotsplittask",className:"zmBtn greyBgBtn"}," ",D.common.nobutton," ")))},s.emptyTask=function(){return zdom("center",{id:"notask",style:{height:"50px",padding:"30px 0"}},zdom("span",null,D.common.notask+" "),zdom("a",{href:"#",id:"addnewtask"},D.center.addTask))},s.noTaskTemplate=function(e){var a="today"===e?D.center.noDueTask:D.common.notask;return zdom("center",{id:"notask",style:{height:"50px",padding:"30px 0"}},a)},s.cheatSheetLink=function(){return zdom("ul",null,zdom("li",{className:"SCtxt zt_cheat",id:"cheatlink"},zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-cheatSheet"}),zdom("span",null,D.cheatsheet.cheatsheet)))))},s.getPtaskLinker=function(e){var a=zdom("div",{className:"zmPTaskLink"}),t=zdom("span",{className:"zmLink zmBold"});return e&&t.appendChild(zdom("i",{className:"msi-prevH"})),a.appendChild(t),a},s.newPreviewContent=function(e){var a=zdom("div",null);e.isPtaskLinkRequired&&a.appendChild(this.getPtaskLinker());var t="zmTaskWra ";t+="popup"!==e.opentype?"zmTaskPV":"";var s=zdom("div",{className:t},zdom("div",{className:"zmTaskHeader"},zdom("i",{className:"msi-startedTask zmTaskStatus zmThmClr"}),zdom("div",{className:"zmTaskAssignee"},zdom("div",{className:"zmTaskAssigneeWra"})),zdom("div",{className:"zmAMB"})),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmAMB"})),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmAMB"}),zdom("div",{className:"zmTaskTitle",style:{"min-height":"18px"},placeholder:D.common.addTask}),zdom("div",{className:"zmAMB"})),zdom("div",{className:"zmTaskRow",id:"3"}),zdom("div",{className:"zmTaskRow",id:"4"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-lcmnt"})),zdom("div",{className:"zmTaskDesc",contentEditable:"true",placeholder:D.center.desc})),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-label"})),zdom("div",{className:"zmLblGrp"},zdom("em",{className:"greyText cursorPointer"},D.common.addTag))));return a.appendChild(s),e.isPtaskLinkRequired?a:s},s.previewClose=function(){return zdom("div",{className:"zmAMB"})},s.getNewEmptySubTaskTemplate=function(){return zdom("div",{className:"zmSTLists staskTemplate"},zdom("div",{className:"zmTList zmTLCreate zmTLFocus prependHere",draggable:"false",style:{display:"none"}},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLChk zmHideV"},zdom("i",{className:"msi-uncheck"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-startedTask"}))),zdom("div",{className:"zmTLTD"},zdom("div",{className:"zmTLTitle"},zdom("div",{className:"zmTLTitleTxt",contentEditable:"true"})),zdom("div",{className:"zmTLAssignee"},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee zmDoubleIcon"}),zdom("div",{className:"zmTARBlk"},zdom("em",{className:"greyText"},D.center.unassigned)))),zdom("i",{className:"msi-close"}))),zdom("div",{className:"zmTList jsAddSubTask",draggable:"false"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLChk zmHideV"},zdom("i",{className:"msi-uncheck"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-plus greyText"}))),zdom("div",{className:"zmTLTD"},zdom("em",{className:"greyText"},D.listing.tooltip.addSubtask))))},s.createNewSubtask=function(e){var a=3===Number(e)?"msi-drag zmHideD":"msi-drag";return zdom("div",{className:"zmTList zmTLEditable"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr"},zdom("i",{className:a})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-startedTask"}))),zdom("div",{className:"zmTLTD"},zdom("div",{className:"zmTLTitle"},zdom("div",{className:"zmTLTitleTxt"}),zdom("div",{className:"zmAMB"}))),zdom("div",{className:"zmTLInfo"}),zdom("div",{className:"zmTLSInfo"}),zdom("div",{className:"zmTLAssignee"},zdom("div",{className:"zmTaskAssigneeWra"})),zdom("div",{className:"zmTLMAct"},zdom("div",{className:"zmAMB rightAlign"})))},s.newPreviewContent2=function(e){var a=zdom("div",null);e.isPtaskLinkRequired&&a.appendChild(this.getPtaskLinker(!0));var t=zdom("div",{className:"zmTaskWra zmTaskEditable zmTaskPV"},zdom("div",{className:"zmTaskRow infoRow"},zdom("div",{className:"zmTRiconWra"}),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmTaskAssignee"},zdom("div",{className:"zmTaskAssigneeWra",ref:"mainTaskAssignee"})),zdom("div",{className:"zmAMB",ref:"date"}),zdom("div",{className:"zmAMB",ref:"reminder"}),zdom("div",{className:"zmAMB",ref:"priority"}))),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmAMB",ref:"descIcon"}),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmTaskDesc",placeholder:D.center.desc,contentEditable:"false",ref:"description"}))),zdom("div",{className:"zmTaskRow groupRow"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-taskGroup"})),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmAMB",ref:"group"}))),zdom("div",{className:"zmTaskRow zmHideD"},zdom("div",{className:"zmTRiconWra zmHideD"},zdom("i",{className:"msi-taskGroup"})),zdom("div",{className:"zmTaskRData"})),zdom("div",{className:"zmTaskRow labelRow zmHideD"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:" msi-label"})),zdom("div",{className:"zmTaskRData",ref:"labels"},zdom("div",{className:"zmLblGrp zmViewLblName"}))),zdom("div",{className:"zmTaskRow",ref:"subtasks"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-subTasks"}))),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-timeline"})),zdom("div",{className:"zmTaskRData"})));return a.appendChild(t),e.isPtaskLinkRequired?a:t},s.newSubtaskWrapper=function(){return zdom("div",{className:"zmSTListWra"},zdom("div",{className:"zmSubTasksHeading zmHideD",ref:"subtaskHeader"},zdom("strong",{ref:"subtaskCount"})),zdom("div",{className:"zmSTLists staskContainer",ref:"subtaskWrapper"}),zdom("div",{className:"zmSTLists zmClosedSubtsk"}))},s.previewHeader=function(){return zdom("div",{className:"zmPVHeading"},zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmTRiconWra taskStatusIconWra"},zdom("i",{className:"msi-startedTask"})),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmTaskTitle",contentEditable:"false",ref:"taskTitle"}))))},s.printLink=function(){return zdom("ul",null,zdom("li",{className:"SCtxt",id:"printlink"},zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-print"}),zdom("span",null,D.common.print)))))},s.viewTaskStreams=function(e){var a="msi-uncheck zmtMAC",t="";"3"===e.status&&(a="msi-check zmtMAC",t="Stask_Complete");var s="";"2"===e.priority?s="SC_red":"4"===e.priority&&(s="SC_blue");var i=zdom("li",{className:t},zdom("i",{className:a}),zdom("strong",null," ",zmTask.Util.unescapeSpecialChar(e.title)),zdom("div",{className:"Stask_list_icon"}),zdom("div",{className:"Stask_list_desc"}," ",e.summary," ")),o=i.querySelector("strong");if("-1"!==e.attendees){var n=zmTask.Util.getContact(e.attendees,"").fn,d=zdom("span",{className:e.mentionClass,"data-zid":e.attendees},n);o.appendChild(d)}var r=i.querySelector("div.Stask_list_icon");if(e.duedate){var m=zdom("span",null,e.duedate);r.appendChild(m)}if(s.length){var l=zdom("i",{className:"msi-priority "+s});r.appendChild(l)}return i},s.viewTaskStreamsHolder=function(e){var a=zdom("div",{className:"Smsg",style:{"white-space":"normal"}},zdom("ul",{className:"mtask_list stask_list"}),zdom("ul",{className:"stask_list"}),zdom("ul",{className:"stask_list zmClosedSubtsk"}));if(e){var t=zdom("div",null,zdom("span",{className:"zmLink"}));$.e(a).prependDOM(t)}return a},s.addtaskStreams=function(e){return zdom("div",null,zdom("div",{className:"Stask_parent"},zdom("textarea",{className:"SC_w100 SC_nobdr ZT_prvTitle"}),zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,e?zdom("b",{className:"WDIcon streams"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"dropdown"},zdom("i",{className:"msi-attachment"}),zdom("i",{className:"msi-barrow"}))):zdom("b",null,zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"ztDateIp SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"ztDateIpTxt zmPlaceholder","data-placeholder":D.preview.tooltip.duedate}),zdom("input",{readOnly:"true",className:"ztDate SC_dyn"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"})))))),zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"})),zdom("div",{className:"sTaskContainer"}),zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("i",{className:"msi-add"}),zdom("div",{className:"zm_mention"},zdom("div",{className:"zm_mentionbg"}),zdom("textarea",{className:"add-sub",placeholder:D.preview.placeholder.subtask}))))},s.addSmartTask=function(){return zdom("div",null,zdom("div",{className:"Stask_parent Stask_update"},zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"ztDateIp SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"ztDateIpTxt zmPlaceholder","data-placeholder":D.preview.tooltip.duedate}),zdom("input",{readOnly:"true",className:"ztDate SC_dyn"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-watch"})))))),zdom("div",{className:"zmpr SC_disab"},zdom("div",{className:"Stask_reminder",id:"dtReminder"},zdom("label",{id:"labelRemind"},zdom("i",{id:"setRemind",className:"msi-uncheck"}),D.preview.display.setReminder),zdom("div",{className:"withBdr ztDateIp zmDisabled"},zdom("span",{className:"ztDateIpTxt","data-placeholder":D.preview.placeholder.selectDate}),zdom("input",{className:"ztRDate SC_tiput SC_dyn",type:"textbox",readOnly:"true"}),zdom("i",{className:"text msi-calendar"})),zdom("div",{className:"ztDateIp withBdr zmDisabled"},zdom("input",{className:"ztDateIpTxt ztTimeIpTxt",type:"textbox"}),zdom("i",{className:"msi-clock"}))),zdom("div",{id:"relReminder",className:"SC_dyn SC_dib"},zdom("label",{id:"labelRemind"},zdom("i",{id:"setRemind",style:{"margin-right":"5px"},className:"msi-uncheck"}),D.preview.display.setReminder),zdom("input",{className:"ztReDate",style:{height:"28px","margin-left":"15px"},type:"textbox",value:D.center.samedayReminder})),zdom("div",{className:"Stask_reminder"},zdom("div",{className:"Stask_remInput"},zdom("i",{className:"msi-uncheck",id:"cpopup"}),zdom("span",{id:"cpopupspan"},D.common.notify)),zdom("div",{className:"Stask_remInput"},zdom("i",{className:"msi-uncheck",id:"cemail"}),zdom("span",{id:"cemailspan"},D.common.mail)))),zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"})),zdom("div",{className:"Stask_subCont Stask_update"},zdom("div",{className:"sTaskContainer"}),zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("i",{className:"msi-add"}),zdom("div",{className:"zm_mention"},zdom("div",{className:"zm_mentionbg"}),zdom("textarea",{className:"add-sub",placeholder:D.preview.placeholder.subtask})))))},s.createTask=function(e){var a=zdom("div",{className:"zmTaskWra zmTaskEditable"},zdom("div",{className:"zmTaskHeader"},zdom("div",{className:"zmTaskAssignee"},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee zmDoubleIcon"}),zdom("div",{className:"zmTARBlk"},zdom("div",null,D.center.assignee),zdom("em",{className:"greyText"},D.center.unassigned)))),zdom("div",{className:"zmAMB",id:"headerIcons"})),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmSelect",id:"zt_ws"},zdom("span",null,D.common.labelgroup)),zdom("div",{className:"zmSelect",id:"ZT_prvProj"},zdom("span",null,D.common.labelproject))),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmAMB"}),zdom("div",{className:"zmTaskTitle",contentEditable:"true",style:{"min-height":"18px"},placeholder:D.center.tasktitowner}),zdom("div",{className:"zmAMB"},zdom("ul",{className:"zmAMG "},zdom("li",{className:"zmAMItem zmAMTextItem"},zdom("div",{className:"zmAMWra"},zdom("i",{className:"msi-attachment zmAMIcon"}),zdom("span",{className:"zmAMText"},D.common.attachFile))),zdom("li",{className:"zmAMItem  zmAMTextItem zmAMSepDot"},zdom("div",{className:"zmAMWra"},zdom("i",{className:"msi-date zmDoubleIcon zmAMIcon"}),zdom("span",{className:"zmAMText"},D.common.dueOn),zdom("input",{type:"text",id:"duedate",style:{display:"none"}})))))),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-lcmnt"})),zdom("div",{className:"zmTaskDesc",contentEditable:"true",placeholder:"Description"})));return e&&(a.appendChild(zdom("div",{className:"zmSTListWra sTaskContainer"})),a.appendChild(zdom("div",{className:"zmSTListWra"},zdom("div",{className:"zmTList jsAddSubTask"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-plus greyText"}))),zdom("div",{className:"zmTLTD",contentEditable:"true"},zdom("em",{className:"greyText"},D.listing.tooltip.addSubtask)))))),a},s.createSubtask=function(){return zdom("div",{className:"zmTList"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-startedTask"}))),zdom("div",{className:"zmTLTD"},zdom("div",{className:"zmTLTitle"},zdom("div",{className:"zmTLTitleTxt",contentEditable:"true"})),zdom("div",{className:"zmTLAssignee"},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee zmDoubleIcon"}),zdom("div",{className:"zmTARBlk"},zdom("span",{className:"greyText",style:{"overflow-wrap":"normal"}},D.center.unassigned)))),zdom("i",{className:"msi-close"})))},s.addtaskNew=function(e,a,t,s,i){var o=_zm.isTeamDriveEnabled(),n=zdom("div",null),d="Stask_action";if(t||(d+=" SC_dyn"),!a){var r=zdom("div",{className:"SC_lnk"},zdom("span",{id:"viewParent"}));n.appendChild(r)}var m=zdom("div",{className:"Stask_parent"});if(!t){var l=zdom("i",{className:"msi-check zmtMAC"});m.appendChild(l)}if(m.appendChild(zdom("textarea",{className:"SC_w100 SC_nobdr ZT_prvTitle"})),m.appendChild(zdom("div",{className:"Stask_act"},zdom("div",{className:"SCmb SC_dyn zmTaskAction"},zdom("ul",null,zdom("li",{className:"SC_dyn"},zdom("b",null,zdom("i",{className:"msi-reminder"}))))))),t){var c=i?zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-label"}))):"",u=zdom("div",{className:d},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null," ",zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"ztDateIp SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"ztDateIpTxt zmPlaceholder","data-placeholder":D.preview.tooltip.duedate}),zdom("input",{className:"ztDate SC_dyn",readOnly:"true"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,o?zdom("b",{className:"WDIcon"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"dropdown"},zdom("i",{className:"msi-attachment"}),zdom("i",{className:"msi-barrow"}))):zdom("b",null,zdom("i",{className:"msi-attachment"}))),c,zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"})))))),p=u.querySelector("ul").children[2];if(a){var z=zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-watch"})));$.e(z).insertDOMAfter(p)}if(!s){var g=zdom("li",null,zdom("b",null,zdom("i",{className:"msi-close"})));$.e(g).insertDOMAfter(p)}m.appendChild(u);var v=zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"});m.appendChild(v)}if(!t||i){var f=zdom("div",{className:"zmpdtl SC_dyn"},zdom("div",{className:"zmpr"},zdom("div",{className:"zm_lbl"},zdom("div",{className:"zmLblGrp zmViewLblName"}))));m.appendChild(f)}if(n.appendChild(m),a&&t){var N=zdom("div",{className:"sTaskContainer zmDrgbleSubtsk"});n.appendChild(N);var h=zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("i",{className:"msi-add"}),zdom("div",{className:"zm_mention"},zdom("div",{className:"zm_mentionbg"}),zdom("textarea",{className:"add-sub",placeholder:D.preview.placeholder.subtask})));n.appendChild(h)}else if(a){var T=zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("span",{className:"js-loading zmSpinLoader",style:{display:"none",position:"absolute",top:"19px",left:"-12px"}}),zdom("i",{className:"msi-add"}),zdom("textarea",{className:"add-sub",placeholder:D.preview.placeholder.subtask}));n.appendChild(T)}var k=zdom("div",null,zdom("div",{className:"SC_tdtl"},zdom("div",{className:"zmpr SC_disab"},zdom("i",{id:"setRemind",className:"msi-uncheck"}),zdom("span",{className:"sum",id:"remindLabel"},D.center.remindOn," "),zdom("div",{className:"SC_rblk"},zdom("div",{id:"dtReminder",className:"ztDateIpGrp"},zdom("div",{className:"withBdr ztDateIp zmDisabled"},zdom("span",{className:"ztDateIpTxt"}),zdom("input",{className:"ztRDate SC_tiput SC_dyn",type:"textbox",readOnly:"true"})),zdom("div",{className:"ztDateIp withBdr zmDisabled"},zdom("input",{className:"ztDateIpTxt ztTimeIpTxt",type:"textbox"}))),zdom("div",{id:"relReminder",className:"SC_dyn SC_dib"},zdom("input",{className:"SC_tiput ztReDate",type:"textbox",value:D.center.samedayReminder})),"  ",zdom("i",{className:"msi-uncheck",id:"cpopup"}),zdom("span",{id:"cpopupspan"}," ",D.common.notify),zdom("i",{id:"cemail",className:"msi-uncheck"}),zdom("span",{id:"cemailspan"}," ",D.common.mail," ")))),zdom("div",{className:"SC_tdtl"},zdom("div",{className:"zmODueNfy SC_disab"},zdom("i",{className:"msi-uncheck"}),zdom("span",{className:"sum"},D.center.sendOverdueNotification))));n.appendChild(k);var y=zdom("div",{className:"SC_tdtl"},zdom("div",{className:"SC_flt SC_fst",id:"zt_ws"},zdom("input",{placeholder:D.left.workspace,className:"SC_tiput",readOnly:"readonly"})),zdom("div",{className:"SC_flt",id:"ZT_prvProj"})),b=y.querySelector("#ZT_prvProj");if(a){var C={display:L,readOnly:"readonly"},S=zdom("span",{id:"clearproject",style:{display:"none",position:"absolute",top:"7px",right:"5px"}},zdom("i",{className:"msi-close"})),w=zdom("input",{className:"SC_tiput",placeholder:D.center.projName,style:C});b.appendChild(S),b.appendChild(w)}else{var I={display:L,readOnly:"readonly",disabled:"disabled"},_=zdom("input",{className:"SC_tiput",placeholder:D.center.projName,style:I});b.appendChild(_)}var A=zdom("div",{className:"SC_tdtl"},zdom("div",{className:"SC_tiput ZT_prvDescrip zt_edtDesc",contentEditable:"true"}));if(n.appendChild(y),n.appendChild(A),t){n.appendChild(zdom("div",{className:"SC_tdtl SC_dyn",style:{"padding-top":"10px"}},zdom("i",{className:"msi-check",id:"sharemail"}),zdom("span",{id:"sharemailspan"},D.common.sharemail,zdom("b",null))))}return n},s.addSubTaskNew=function(e,a,t){var s=_zm.isTeamDriveEnabled(),i=zdom("div",{className:"Stask_sub"});t||i.appendChild(zdom("i",{className:"msi-check zmtMAC"}));var o={width:"100%",border:"none"},n=zdom("li",null,s?zdom("b",{className:"WDIcon"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"dropdown"},zdom("i",{className:"msi-attachment"}),zdom("i",{className:"msi-barrow"}))):zdom("b",null,zdom("i",{className:"msi-attachment"}))),d=zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"}))),r=zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-label"})));t?i.appendChild(zdom("textarea",{rows:"1",className:"SC_w100 SC_nobdr ZT_prvTitle",style:o})):i.appendChild(zdom("div",{className:"zm_mention"},zdom("textarea",{rows:"1",className:"SC_w100 SC_nobdr ZT_prvTitle",style:o})));var m=zdom("div",{className:"Stask_act"},zdom("div",{className:"SCmb SC_dyn zmTaskAction"},zdom("ul",null,zdom("li",{className:"SC_dyn"},zdom("b",null,zdom("i",{className:"msi-reminder"}))),n)));if(i.appendChild(m),t){var l=zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"ztDateIp SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"ztDateIpTxt zmPlaceholder","data-placeholder":D.preview.tooltip.duedate}),zdom("input",{className:"ztDate SC_dyn",readOnly:"readonly"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,s?zdom("b",{className:"WDIcon"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"dropdown"},zdom("i",{className:"msi-attachment"}),zdom("i",{className:"msi-barrow"}))):zdom("b",null,zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"})))))),c=l.querySelector("ul");a&&c.appendChild(zdom("li",null,zdom("b",null,zdom("i",{className:"msi-trash"})))),i.appendChild(l),i.appendChild(zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"}))}else{var u=zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,n,r,d)));if(a){var p=u.querySelector("ul"),z=zdom("li",null,zdom("b",null,zdom("i",{className:"msi-trash"})));p.appendChild(z)}i.appendChild(u);var g=zdom("div",{className:"zmpdtl SC_dyn"},zdom("div",{className:"zmpr",style:{"padding-top":"10px"}},zdom("div",{className:"zm_lbl"},zdom("div",{className:"zmLblGrp zmViewLblName"}))));i.appendChild(g);var v=zdom("div",{className:"Stask_action zt_SAss"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("div",{className:"SC_cs SC_np SC_assignee"},zdom("span",{className:"SC_thm",placeholder:D.common.assignPlaceHolder}),zdom("i",{className:"msi-close SC_dyn"}))),zdom("li",null,zdom("b",{className:"SC_dyn"},zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"ztDateIp"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"ztDateIpTxt zmPlaceholder","data-placeholder":D.preview.tooltip.duedate}),zdom("input",{readOnly:"true",className:"ztDate SC_dyn"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("span",{className:"SC_lnk SC_vMore"},D.preview.display.viewmorelink)))));i.appendChild(v)}return i},s.createTaskNew=function(e){var a,t=D.center.tasktitowner;if(!e){var s=this.getPtaskLinker(e);a=zdom("div",{className:"zmTaskRow"},s),t=D.center.subtasktitowner}var i=zdom("div",{className:"zmTaskWra zmTaskEditable"},a,zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmTRiconWra taskStatusIconWra"},zdom("i",{className:"msi-startedTask"})),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmTaskTitle",contentEditable:"true",placeholder:t})),zdom("div",{className:"zmAMB"})),zdom("div",{className:"zmTaskRow infoRow"},zdom("div",{className:"zmTRiconWra"}),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmTaskAssignee",style:{"min-width":"96px","max-width":"150px"}},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee"}),zdom("div",{className:"zmTARBlk"},zdom("span",{className:"greyText"},D.center.unassigned)),zdom("span",{className:"zmTARemove SC_dyn"},zdom("i",{className:"msi-closeSmall"})))),zdom("div",{className:"zmAMB"},zdom("ul",{className:"zmAMG "},zdom("li",{className:"zmAMItem  zmAMTextItem"},zdom("div",{className:"zmAMWra"},zdom("i",{className:"msi-date zmAMIcon"}),zdom("span",{className:"zmAMText"},D.viewInfo.dueOn),zdom("input",{type:"text",id:"duedate",className:"SC_dyn"})),zdom("span",{className:"zmTARemove SC_dyn"},zdom("i",{className:"msi-closeSmall"}))))),zdom("div",{className:"zmAMB"}),zdom("div",{className:"zmAMB"}))),zdom("div",{className:"zmTaskRow SC_dyn"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-attachment"})),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmPAtt Snolpd zmCAt"}))),zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-lcmnt"})),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmTaskDesc",contentEditable:"true",placeholder:"Description"}))),zdom("div",{className:"zmTaskRow groupRow"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-taskGroup"})),zdom("div",{className:"zmTaskRData"},zdom("div",{className:"zmAMB"},zdom("ul",{className:"zmAMG "},zdom("li",{className:"zmAMItem  zmAMTextItem zmAMsmall"},zdom("div",{className:"zmAMWra"},zdom("span",{className:"zmAMText",id:"zt_ws"},D.common.labelgroup),zdom("i",{className:"msi-barrow"}))),zdom("li",{className:"zmAMItem  zmDisabled zmAMNPItem"},zdom("div",{className:"zmAMWra"},zdom("i",{className:"msi-rarrow zmAMIcon"}))),zdom("li",{className:"zmAMItem  zmAMTextItem zmAMsmall"},zdom("div",{className:"zmAMWra"},zdom("span",{className:"zmAMText",id:"ZT_prvProj"},D.common.labelproject),zdom("i",{className:"msi-barrow"}))))))));e&&i.appendChild(zdom("div",{className:"zmTaskRow"},zdom("div",{className:"zmTRiconWra"},zdom("i",{className:"msi-subTasks"})),zdom("div",{className:"zmSTListWra"},zdom("div",{className:"sTaskContainer"}),zdom("div",{className:"zmTList SC_dyn"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-startedTask"}))),zdom("div",{className:"zmTLTD"},zdom("div",{className:"zmTLTitle"},zdom("div",{className:"zmTLTitleTxt",contentEditable:"true","data-placeholder":D.center.subtasktitowner})),zdom("div",{className:"zmTLAssignee"},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee"}),zdom("div",{className:"zmTARBlk"},zdom("em",{className:"greyText"},D.center.unassigned)))),zdom("i",{className:"msi-close"}))),zdom("div",{className:"zmTList jsAddSubTask"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-plus greyText"}))),zdom("div",{className:"zmTLTD",contentEditable:"true"},zdom("em",{className:"greyText"},D.listing.tooltip.addSubtask))))));var o=zdom("div",{className:"zmTaskRow SC_dyn"},zdom("i",{className:"msi-check",id:"sharemail"}),zdom("span",{id:"sharemailspan"},D.common.sharemail,zdom("b",null)));return i.appendChild(o),i},s.addSubTaskStreams=function(e,a){return void 0===e.title&&(e.title=""),zdom("div",{className:"Stask_sub"},zdom("textarea",{className:"SC_w100 SC_nobdr ZT_prvTitle"},e.title),zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null," ",a?zdom("b",{className:"WDIcon streams"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"dropdown"},zdom("i",{className:"msi-attachment"}),zdom("i",{className:"msi-barrow"}))):zdom("b",null,zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"ztDateIp SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"ztDateIpTxt zmPlaceholder","data-placeholder":D.preview.tooltip.duedate}),zdom("input",{readOnly:"true",className:"ztDate SC_dyn"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"}))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-trash"})))))),zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"}))},s.getTaskListPrintHeader=function(e,a){var t=zdom("div",{id:"taskPrintDiv",className:"taskPrintDiv"}),s=zdom("h1",{className:"zm_prntTit"}," ",e," ");if(t.appendChild(s),a){var i=zdom("div",{className:"zm_prntGrp"},a.filterName,zdom("i",{className:"msi-rarrow"}),a.filterValue);t.appendChild(i)}return t.appendChild(zdom("table",{cellPadding:"0",cellSpacing:"0",className:"zm_prntTask"},zdom("tbody",null))),t},s.getTaskListPrintFooter=function(){var e={display:"none"};return zdom("div",{className:"rgtdiv",id:"navBar",style:e},zdom("div",{className:"SC_Pnav"},zdom("div",{className:"SC_ldr",id:"ldrDiv",style:e},zdom("div",{className:"SC_ldsld"},zdom("div",{className:"SC_llne"}),zdom("div",{className:"SC_lbrk SC_ldt1"}),zdom("div",{className:"SC_lbrk SC_ldt2"}),zdom("div",{className:"SC_lbrk SC_ldt3"}))),zdom("span",{className:"SC_PnavCount"},D.common.loadMore)))},s.cheatSheet=function(e){var a=zmText.applyArgs(D.cheatsheet.createtaskmailid,{userid:e.userid,dname:e.dname}),t=zmText.applyArgs(D.cheatsheet.createtaskdmfyid,{userid:e.userid,d:e.d,m:e.m,fy:e.fy,dname:e.dname}),s=zmText.applyArgs(D.cheatsheet.createtaskdmfyinfo,{d:e.d,m:e.m,fy:e.fy}),i=zmText.applyArgs(D.cheatsheet.createtaskdmid,{userid:e.userid,d:e.d,m:e.m,dname:e.dname}),o=zmText.applyArgs(D.cheatsheet.createtaskdminfo,{d:e.d,m:e.m,fy:e.fy,ny:e.ny}),n=zmText.applyArgs(D.cheatsheet.creategrouptaskmailid,{dname:e.dname}),d=zmText.applyArgs(D.cheatsheet.memberingroupmailid,{dname:e.dname}),r=zmText.applyArgs(D.cheatsheet.grouptaskdmid,{d:e.d,m:e.m,dname:e.dname}),m=zmText.applyArgs(D.cheatsheet.grouptaskdminfo,{d:e.d,m:e.m,fy:e.fy});return zdom("div",null,zdom("h2",{className:"cs_main_header SC_thm"},zdom("strong",null,D.cheatsheet.createtext),zdom("span",null,D.cheatsheet.emailtext)),zdom("div",{className:"zt_cheetsheet_tbl zt_main_tbl"},zdom("div",{className:"zt_tbl_row"},zdom("div",{className:"zt_cs_lft_img"},zdom("img",{src:zmResource.get("image","tasks/cheatsheet.png"),title:D.cheatsheet.cheatsheet,alt:D.cheatsheet.cheatsheet})),zdom("div",null,zdom("div",{className:"zt_cheetsheet_tbl zt_cs_tbl"},zdom("div",{className:"zt_tbl_row"},zdom("div",null,D.cheatsheet.emailto),zdom("div",null,D.cheatsheet.createdetails)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},a)),zdom("div",null,D.cheatsheet.createtask)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},t)),zdom("div",null,s)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},i)),zdom("div",null,o)),function(){if(_zm.isStreamsEnabled())return zdom("zmfrag",null,zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{id:"groupmail"},zdom("span",{className:"SC_lnk"},n),zdom("br",null),zdom("span",null,"cc "),zdom("span",{className:"SC_lnk"},d))),zdom("div",null,D.cheatsheet.grouptaskinfo)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},r)),zdom("div",null,m)))}())))))},s.addHeaderDOM=["DIV",{attrs:{class:"SC_phd"},child:[["text",D.center.addTask]]}],s.addtaskHeader={text:s.addHeaderDOM,rIcons:[[{tooltip:"Close",iconClass:"msi-close",data:"msi-close"}]]},s.previewHeaderDOM=function(e){var a=[["text",D.center.previewTask]];return e&&(a.push(["DIV",{attrs:{class:"SC_SLine"}}]),a.push(["I",{attrs:{class:"msi-mailopen"}}])),["DIV",{attrs:{class:"SC_phd"},child:a}]},s.previewHeaderDOMTemp=function(e){var a=[["LI",{child:[["DIV",{attrs:{class:"SC_cs SC_assignee"},child:[["IMG",{attrs:{src:zmResource.get("image","SC-Photo.png")}}],["SPAN",{attrs:{placeholder:D.common.assignPlaceHolder}}],["I",{attrs:{class:"msi-close SC_dyn"}}]]}]]}],["LI",{child:[["DIV",{attrs:{id:"ztDateOuter",class:"ztDateIp"},child:[["I",{attrs:{class:"msi-calendar"}}],["SPAN",{attrs:{class:"ztDateIpTxt zmPlaceholder","data-placeholder":D.preview.tooltip.duedate}}],["INPUT",{attrs:{class:"ztDate SC_dyn",readonly:!0}}],["SPAN",{attrs:{class:"SC_cls SC_dyn"},child:[["I",{attrs:{class:"msi-close"}}]]}]]}]]}],["LI",{child:[["B",{child:[["DIV",{attrs:{class:"SC_hd"}}],["SPAN",{attrs:{class:"dropdown"},child:[["I",{attrs:{class:"msi-attachment SC_flt zm_shrnk"}}],["I",{attrs:{class:"msi-barrow"}}]]}]]}]]}],["LI",{child:[["B",{child:[["DIV",{attrs:{class:"SC_hd"}}],["I",{attrs:{class:"msi-label"}}]]}]]}],["LI",{child:[["B",{child:[["DIV",{attrs:{class:"SC_hd"}}],["I",{attrs:{class:"msi-priority"}}]]}]]}]];if(!_zm.isTeamDriveEnabled()){delete a[2];a.splice(2,0,["LI",{child:[["B",{child:[["I",{attrs:{class:"msi-attachment"}}]]}]]}])}return"task"===e.type&&a.push(["LI",{child:[["B",{child:[["DIV",{attrs:{class:"SC_hd"}}],["I",{attrs:{class:"msi-watch"}}]]}]]}]),e.eid&&a.push(["LI",{attrs:{class:"SC_lbr"},child:[["B",{child:[["DIV",{attrs:{class:"SC_hd"}}],["SPAN",{child:[["I",{attrs:{class:"msi-mailopen"}}]]}]]}]]}]),a.push(["LI",{attrs:{class:"SCtxt zmTStatusMent"}}]),["DIV",{attrs:{class:"SC_phd"},child:[["DIV",{attrs:{class:"SCmb zmTaskAction"},child:[["UL",{child:a}]]}]]}]},s.getStatusLI=function(e,a){var t="background-color: "+a+";";return zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-uncheck zmLabelBox",style:t}),e))},s.previewtaskHeader=function(e){var a={text:s.previewHeaderDOM(e.eid),rIcons:[]};e.projectsView||e.error||(a={text:s.previewHeaderDOMTemp(e),rIcons:[]});var t;return zmail.isOrg&&zmUtil.isChatletEnabled()&&!e.error&&!e.projectsView&&a.rIcons.push([{tooltip:zmText.applyArgs(zmText.get("mailsuite").tooltips.chatlet,{entity:zmText.get("mailsuite").entity[3]}),html:(t=zdom("i",{className:"msi-cliqColor"},zdom("i",{className:"path1"}),zdom("i",{className:"path2"})),0<e.chatletData&&(t=zdom("fragment",null,zdom("span",{className:"zm_mct zmThmBG"},e.chatletData),t)),t),data:"chatlet"}]),e.projectsView||e.error||a.rIcons.push([{tooltip:D.center.moreactions,iconClass:"msi-action",data:"msi-action"}]),e.hidePrevNext||e.error||a.rIcons.push([{iconClass:"msi-prev",data:"msi-prev"},{iconClass:"msi-next",data:"msi-next"}]),e.opentype||a.rIcons.push([{tooltip:D.preview.tooltip.close,iconClass:"msi-close",data:"msi-close"}]),a},s.mailDateExtractedTaskNew=function(){var e={display:L};return zdom("li",null,zdom("div",{className:"zmcDatePost"},zdom("div",null,zdom("div",{className:"SC_floatLabel zmIconLabel",style:{color:"transparent",overflow:"hidden"}},zdom("input",{type:"text",placeholder:D.center.previewTitle,className:"ZT_prvTitle"}),zdom("i",{className:"msi-task SC_thm"})),zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel zmIconLabel"},zdom("input",{className:"hasDD",type:"text",required:"",id:"assgnInp",placeholder:D.center.assignee}),zdom("i",{className:"msi-user SC_thm"})),zdom("div",{id:"zt_ws",className:"SC_floatLabel zmIconLabel"},zdom("input",{className:"hasDD",type:"text",required:"",readOnly:"readonly",id:"grpInp",placeholder:D.preview.placeholder.group}),zdom("i",{className:"msi-stiNotes SC_thm"}))),zdom("div",{className:"SC_dyn",id:"optMore"},zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel zmIconLabel"},zdom("span",{className:"zmFloatLabelInput"}),zdom("input",{className:"hasDD SC_dyn",type:"text",required:"",id:"dtInp",readOnly:"readonly",placeholder:D.preview.tooltip.duedate,style:e}),zdom("i",{className:"msi-calendar SC_thm"})),zdom("div",{id:"ZT_prvProj",className:"SC_floatLabel zmIconLabel"},zdom("input",{className:"hasDD",id:"projInp",type:"text",required:"",readOnly:"readonly",placeholder:D.center.projName}),zdom("i",{className:"msi-stiNotes SC_thm"}))),zdom("div",{className:"SC_floatLabel zmIconLabel"},zdom("textarea",{className:"ZT_prvDescrip",placeholder:D.center.desc}),zdom("i",{className:"msi-rsvp SC_thm"})))),zdom("div",{className:"SC_frt zm_moreOpt",id:"moreOpt",style:{"margin-top":"15px"}},zdom("span",{className:"SC_dyn"},D.common.lessLabel,zdom("i",{className:"msi-prev"})),zdom("span",null,D.common.moreLabel,zdom("i",{className:"msi-next"}))),zdom("div",{className:"SC_PUbtm"},zdom("span",{id:"addTask"},D.common.save),zdom("span",{id:"cancelTask","data-val":"Cancel"},D.common.cancel))))},s.mailDateExtractedTask=function(){return zdom("li",null,zdom("div",{className:"zmcDatePost"},zdom("div",{className:"SC_floatLabel placeholder noBdr",style:{color:"transparent",overflow:"hidden"}},zdom("textarea",{placeholder:D.center.tasktitowner,value:"",className:"ZT_prvTitle"}),zdom("label",null,"Task Title")),zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel placeholder noBdr"},zdom("input",{className:"hasDD",type:"text",required:"",id:"dtInp",readOnly:"readonly",placeholder:D.preview.tooltip.duedate}),zdom("label",null,D.preview.tooltip.duedate)),zdom("div",{id:"zt_ws",className:"SC_floatLabel placeholder noBdr"},zdom("input",{className:"hasDD",type:"text",required:"",readOnly:"readonly",id:"grpInp",placeholder:D.preview.placeholder.group}),zdom("label",null,D.preview.placeholder.group," "))),zdom("div",{className:"SC_dyn",id:"optMore"},zdom("div",{className:"SC_floatLabelRow fLCol2"}),zdom("div",{className:"SC_floatLabel placeholder noBdr"},zdom("textarea",{className:"ZT_prvDescrip",placeholder:D.center.desc}),zdom("label",null," ",D.center.addDesc," "))),zdom("div",{className:"SC_frt zm_moreOpt",id:"moreOpt",style:{"margin-top":"15px"}},zdom("span",{className:"SC_gray SC_dyn"}," ",D.common.lessLabel,zdom("i",{className:"msi-prev SC_gray"})),zdom("span",{className:"SC_gray"},D.common.moreLabel,zdom("i",{className:"msi-next SC_gray"}))),zdom("div",{className:"SC_PUbtm"},zdom("span",{id:"addTask"},D.common.save," "),zdom("span",{id:"cancelTask","data-val":"Cancel"},D.common.cancel," "))))},s.quickTask=function(){return zdom("div",{id:"quickAdd",className:"zmL SC_mlst zt_quickAdd","data-ty":"lt"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmFlt"},zdom("i",{className:"msi-add"})),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmFrm"},zdom("textarea",{placeholder:D.center.quickTaskPlaceholder}))),zdom("div",{className:"zmFrt"},zdom("span",{className:"js-loading zmSpinLoader",style:{display:"none",position:"absolute",top:"13px"}}))))},s.quickTaskNew=function(){return zdom("div",{className:"zmTList zmTLCreate zmTLQCreate zmHideD"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-startedTask"}),zdom("div",{className:"zmSpinLoader zmHideD"}))),zdom("div",{className:"zmTLTD"},zdom("div",{className:"zmTLTitle","data-placeholder":D.center.quickTaskPlaceholder,contentEditable:"false"}),zdom("div",{className:"zmTLAssignee zmHideD"},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee zmDoubleIcon"}),zdom("div",{className:"zmTARBlk"},zdom("span",{className:"greyText"},D.center.unassigned))))))},s.newSTaskDiv=function(){return zdom("div",{className:"zmTList zmTLCreate zmTLFocus"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLChk zmHideV"},zdom("i",{className:"msi-uncheck"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-startedTask"}))),zdom("div",{className:"zmTLTD"},zdom("div",{className:"zmTLTitle"},zdom("div",{className:"zmTLTitleTxt",contentEditable:"true"},zdom("div",null," ",zdom("br",null)," "))),zdom("div",{className:"zmTLAssignee"},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee zmDoubleIcon"}),zdom("div",{className:"zmTARBlk"},zdom("em",{className:"greyText"}," unassigned ")))),zdom("i",{className:"msi-close"})))},s.sTaskTemplate=function(){return zdom("div",{className:"zmTList jsAddSubTask"},zdom("div",{className:"zmTLact"},zdom("div",{className:"zmTLOdr zmHideV"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmTLChk zmHideV"},zdom("i",{className:"msi-uncheck"})),zdom("div",{className:"zmTLSts"},zdom("i",{className:"msi-plus greyText"}))),zdom("div",{className:"zmTLTD"},zdom("em",{className:"greyText"},"Add subtask")))},s.moveTask=function(){return zdom("div",{id:"moveTask",className:"zm_postNew"},zdom("div",{className:"SC_floatLabel flFLabel flBox"},zdom("input",{type:"text",className:"tTitle",required:""}),zdom("label",null,D.center.taskTitle)),zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel flFLabel flBox"},zdom("input",{className:"groupId",readOnly:"readonly",placeholder:D.common.labelgroup}),zdom("label",null,D.preview.placeholder.group)),zdom("div",{className:"SC_floatLabel flFLabel flBox"},zdom("input",{className:"catId",readOnly:"readonly",placeholder:D.common.labelproject}),zdom("label",null,D.center.project))),zdom("div",{className:"zm_formLne SC_tp10"},zdom("div",{className:"SC_lne"})),zdom("div",{className:"zm_formFld SC_tp10"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-check"}),zdom("span",{className:"cmtId"},D.common.includecomments))))},s.unAssignedTask=function(){return zdom("ul",{className:"SC_P2r zmcDrpDwnMnu"},zdom("li",{className:"SC_lne"}),zdom("li",{className:"zmSingleLine zmUnassOpt",id:"unassigned"},zdom("div",{className:"zmUnassOptTitle"},D.center.unassigned),zdom("div",{className:"SC_avtr"},zdom("i",{className:"msi-user"}))),zdom("li",{className:"SC_lne"}))},s.getStatusDOM=function(){return zdom("div",null,zdom("h4",null,D.settings.taskStatus),zdom("div",{className:"zmTskStatus"},zdom("div",{className:"zmTskStsWrap"},zdom("div",{className:"zmTskStsRow"},zdom("div",{className:"zmTskStsTitle"},zdom("span",null,D.settings.defaultStatus)),zdom("div",{className:"zmTskSts"},zdom("div",{className:"zmLblGrp zmViewLblName",id:"defaultStatus"}))),zdom("div",{className:"zmTskStsRow"},zdom("div",{className:"zmTskStsTitle"},zdom("span",null,D.settings.customStatus)),zdom("div",{className:"zmTskSts"},zdom("div",{className:"zmLblGrp zmViewLblName",id:"customStatus"},zdom("div",{className:"zmNewLbl"},zdom("span",{className:"zmAddLblIco"},zdom("i",{className:"msi-plus zmThmClr"})),zdom("input",{type:"text",placeholder:D.settings.statusName}))))))))},s.customStatusDOM=function(e,a,t,s){var i=zdom("div",{title:a,className:"zmLbl","data-mid":e},zdom("span",{style:{"background-color":t}}),zdom("font",null,a));return s&&i.appendChild(zdom("div",{className:"zmLblIco"},zdom("i",{className:"msi-edit"}),zdom("i",{className:"msi-trash"}))),i},s.getSLASettings=function(e,a,t){var s,i={width:"40px","text-align":"center"},o={width:"56px"},n=zdom("div",{className:"zmTskSlaStatus"}),d=zdom("div",{className:"zmTskSla"},zdom("label",null,D.settings.sla));s=e?zdom("span",null,zdom("input",{type:"number",min:"0",max:"365",className:"zmTBinLine",value:a,style:i}),D.settings.days):zdom("span",null,zdom("input",{type:"number",min:"0",max:"365",className:"zmTBinLine",value:a,style:i,disabled:!0}),D.settings.days),d.appendChild(s);var r,m=zdom("div",{className:"zmTskSlaNoti zmTskSla"},zdom("label",null,D.center.sendOverdueNotification));return r=t?zdom("div",{className:"zmToggleBtn on",style:o},zdom("span",{className:"zmTBtxt"},D.settings.on),zdom("span",{className:"zmTBswitch",style:{left:"40px"}})):zdom("div",{className:"zmToggleBtn",style:o},zdom("span",{className:"zmTBtxt"},D.settings.off),zdom("span",{className:"zmTBswitch"})),m.appendChild(r),n.appendChild(d),n.appendChild(m),n},s.getTaskSettings=function(){return zdom("div",null,zdom("ul",{className:"SCS_tab tabSel"},zdom("li",{className:"task stSel"},D.settings.taskSettings)),zdom("div",{className:"zm_tabCont tabView task shw"}))},s.getStatusPalette=function(e){return zdom("div",{"data-id":"clrPal"},zdom("ul",{className:"SC_cp",style:{margin:"0 !important"}},zdom("li",{style:{padding:"0"}},e)))},s.getBoxWrapper=function(e){var a,t="zmTBDrag ";return e.bgcolor?a={"background-color":e.bgcolor}:t+=e.class,zdom("div",{className:"zmTBoard"},zdom("div",{className:t,style:a}),zdom("div",{className:"zmTBHeader"},zdom("span",{className:"zmTBTitle"},e.title),zdom("div",{className:"zmAMB"}),zdom("div",{className:"zmAMB rightAlign"})),s.addTaskCard(),e.elem)},s.addTaskCard=function(){return zdom("div",{className:"zmTBLCreate zmHideD"},zdom("div",{className:"zmTBLRow"},zdom("i",{className:"msi-plus zmHideD",ref:"plus"}),zdom("i",{className:"msi-startedTask",ref:"tick"}),zdom("div",{className:"zmTBLTitle",contentEditable:"false",ref:"title","data-placeholder":D.center.tasktitowner}),zdom("div",{className:"zmTBLAssignee",ref:"assigneePar"},zdom("div",{className:"zmTaskAssigneeWra"},zdom("i",{className:"msi-noAssignee"}),zdom("span",{className:"zmTARemove"},zdom("i",{className:"msi-closeSmall"}))))))},s.getListWrapper=function(e){return zdom("div",null,zdom("span",{className:"cursorPointer"},zdom("h5",{className:"zmTListHeader"},e.title)),e.elem)},s.getFilterHeader=function(e,a){return zdom("div",{className:"zmFilterCriteria zmHideD"},zdom("i",{className:e,style:a}),zdom("div",{className:"zmFCBWra"}),zdom("i",{className:"msi-plus zmFCClear"}))},s.getFilterItem=function(e,a){var t=zdom("div",{className:"zmFCBub"});return e&&t.appendChild(zdom("span",{className:"zmFCBubLabel"},e)),a&&t.appendChild(zdom("fragment",null,zdom("span",{className:"zmFCBubValue"},a),zdom("i",{className:"msi-close"}))),t},s.deleteCustomStatus=function(e,a){var t={};return e.statusColour&&(t["background-color"]=e.statusColour),zdom("div",null,zdom("span",null,a.displayText),zdom("div",{className:"zmTable zmTskStaMoveTbl"},zdom("div",{className:"zmTableRow"},zdom("div",{className:"zmTableTd"},zdom("b",null,a.currentStatus)),zdom("div",{className:"zmTskStaMoveIcoCol"}),zdom("div",{className:""},zdom("b",null,a.toStatus))),zdom("div",{className:"zmTableRow"},zdom("div",{className:""},zdom("div",{className:"zmTskDelSta"},zdom("i",{className:"msi-uncheck zmLabelBox",style:t}),zdom("span",null,e.statusName))),zdom("div",{className:"zmTskStaMoveIcoCol"},zdom("span",{className:"zmTskStaMoveIcon"},zdom("i",{className:"msi-forward"}))),zdom("div",{className:""},zdom("div",{className:"zmSelect"},zdom("span",null,a.selectStatus))))))},s.getReminderTemplate=function(){return zdom("div",{style:{padding:"20px"}},zdom("div",{className:"SC_PUcen"},zdom("div",null,zdom("table",{className:"SC_schd"},zdom("tbody",null,zdom("tr",{id:"remindOn"},zdom("td",{className:"ZM_SCType"},zdom("label",null,zdom("i",{id:"setRemind",className:"msi-uncheck"}),zdom("span",null,D.center.remindOn)))),zdom("tr",{id:"zmpr"},zdom("td",null,zdom("div",{id:"relReminder",className:"SC_dyn SC_dib"},zdom("input",{className:"SC_tiput ztReDate",type:"textbox",readOnly:"true",value:D.center.samedayReminder,style:{"min-width":"160px"}})),zdom("div",{id:"dtReminder",className:"SC_dib SC_disab"},zdom("div",{className:"SC_dib"},zdom("input",{className:"ztRDate SC_input",type:"textbox","data-type":"date",readOnly:"true"})),zdom("div",{className:"SC_dib"},zdom("input",{className:"ztRTime SC_input",style:{"min-width":"80px"},type:"textbox","data-type":"time",readOnly:"true"}))))),zdom("tr",null,zdom("td",null,zdom("div",{className:"SC_dib",style:{"padding-left":"5px"}},zdom("i",{className:"msi-uncheck",id:"cpopup"}),zdom("span",{id:"cpopupspan"}," ",D.common.notify,"  "),zdom("i",{id:"cemail",className:"msi-uncheck"}),zdom("span",{id:"cemailspan"}," ",D.common.mail," ")))),zdom("tr",null,zdom("td",null,zdom("div",{className:"SC_mt10 checkBox"},zdom("i",{className:"msi-uncheck"}),zdom("label",null,D.center.sendOverdueNotification)))))))))},s.getSubscriptionOption=function(e,a,t){var s=a?"msi-check zmThmClr":"msi-uncheck";return zdom("div",{className:a?"zmTaskSubsList subscribed":"zmTaskSubsList"},zdom("i",{className:"msi-drag"}),zdom("label",null,zdom("i",{className:s,"data-id":t}),zdom("span",{className:"zmTaskSubsListName"},e)))},s.getSubscriptionTemplate=function(){return zdom("div",{className:"zmTaskSubsLists"})},window.zmTask=window.zmTask||{},window.zmTask.template=s}(),window.zmTaskRestore=function(){var s={},i="zm_task",o={},n={};return s.saveState=function(e){if(zmsuite.getAppObj(i)){var a=zmsuite.getAppObj(i).obj.stateData.data;"preview"===e?a.preview=n:"listing"===e&&(a.listing=o);try{zmState.sendRequestToSaveState()}catch(e){}}},s.saveTabState=function(e){e.appId&&e.app&&e.appObj&&(zmState.saveTabState(e.appId,e),this.saveState())},s.restoreTab=function(e){e.data.opentype="tab",e.data.restore=!0,zmTask.Preview(e.data)},s.deleteState=function(e){if(zmsuite.getAppObj(i)){var a=zmsuite.getAppObj(i).obj.stateData.data;"preview"===e&&delete a.preview,zmState.sendRequestToSaveState()}},s.store=function(e,a,t){t&&("preview"===e?(n[a]="hashParams"===a?t.join(","):t,2===Object.keys(n).length&&s.saveState("preview")):"listing"===e&&(o[a]="hashParams"===a?t.join(","):t,2===Object.keys(o).length&&s.saveState("listing")))},s.restoreTaskSession=function(e,a){try{var t=$.Deferred();zmApp.selectedApp!==i&&(zmTask.restore(e.data,t),t.done(function(){a.deferred.resolve()}))}catch(e){a.deferred.resolve()}},s}(),function(){var e=zmail.Core.Namespaces.create("zmTask"),a=zmail.Components.AutoComplete.System.AbstractHTMLContentEditable,s="keydown",i="focus",o="focusout",n="click",d="paste",t=function(e){function t(){var e;return babelHelpers.classCallCheck(this,t),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this))).contenteditable=!0,e}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"init",value:function(e){var a=$.e(e.element);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"init",this).call(this,e.element),a.on(s,e.keydown),a.on(i,e.focus),a.on(o,e.focusout),"function"==typeof e.afterload&&e.afterload(),"function"==typeof e.onclick&&a.on(n,e.onclick),e.triggerOnPaste&&a.on(d,this.onpaste.bind(this)),this.args=e}},{key:"getListAnchorBounds",value:function(){var e=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"getListAnchorBounds",this).call(this);return $.extend({},e)}},{key:"replaceContent",value:function(e){var a=this.getCurrentTypingWord(),t=this._element.innerText.indexOf(a),s=this.getSelectionRange();s.setStart(s.startContainer,s.startOffset-a.length);for(var i,o=document.createDocumentFragment();i=e.firstChild;)o.appendChild(i);s.insertNode(o);for(var n,d=document.createNodeIterator(this._element,NodeFilter.SHOW_TEXT,null,!1);n=d.nextNode();)n.textContent===a&&"A"!==n.parentElement.nodeName&&n.remove();return t}},{key:"setContent",value:function(e){$.e(this._element).dangerouslySetInnerHTML(DOMPurify.sanitize(e))}},{key:"replaceMentions",value:function(e){var i,o,n=this;0<e.length&&_.each(e,function(e,a){if(zmail.ContactBook.isGroup(e))i=zmTask.Util.getGroupName(e),o=zdom("div",null,zdom("a",{ref:"link",href:"#",className:"zms_mention","data-zid":e,"data-name":i},i));else{var t=zmTask.Util.getContact(e),s="mailto:"+t.eid;o=zdom("div",null,zdom("a",{ref:"link",className:"zms_mention","data-zid":e,"data-name":t.fn,href:s},t.fn)),i=t.fn}i&&n.replaceMentionFunction(i,o)})}},{key:"replaceMentionFunction",value:function(e,a){for(var t,s=document.createNodeIterator(this._element,NodeFilter.SHOW_TEXT,function(e){return"A"!==e.parentNode.nodeName?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1);t=s.nextNode();){var i=t.textContent.trim(),o=t.parentNode;i===e&&(o.insertBefore(a,t),o.removeChild(t))}}},{key:"checkNodeRemove",value:function(){var e={},a=this.getSelectionRange().startContainer;if(3===a.nodeType){var t=a.parentNode;if("A"===t.nodeName&&t.hasAttribute("data-name")&&t.textContent.trim()!==t.getAttribute("data-name"))e.zid=a.parentNode.getAttribute("data-zid"),e.name=a.parentNode.innerText,a.parentNode.remove();else if("A"===t.nodeName&&t.hasAttribute("href")&&t.parentNode&&t.hasAttribute("target")){var s=t.parentNode,i=document.createDocumentFragment(),o=document.createRange().createContextualFragment(this.getCurrentTypingWord());i.appendChild(o),s.insertBefore(i,t),s.removeChild(t),e="link"}else"SPAN"===t.nodeName&&t.dataset.zid&&0===t.textContent.length&&(e.zid=t.dataset.zid,e.name=t.nodeName)}return e}},{key:"checkNodeChange",value:function(a,e){for(var t,s=document.createNodeIterator(this._element,NodeFilter.SHOW_ELEMENT,function(e){return"A"===e.nodeName&&e.getAttribute("data-zid")===a?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1);t=s.nextNode();){var i=t.textContent.trim(),o=this._element.innerText.indexOf(i);if(o!==e)return{offsetStart:o,offsetEnd:o+i.length}}return!1}},{key:"replaceURLToLinks",value:function(){for(var e,a=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,t=new RegExp(a),s=/(<([^>]+)>)/gi,i=document.createNodeIterator(this._element,NodeFilter.SHOW_TEXT,function(e){return"A"!==e.parentNode.nodeName?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1);e=i.nextNode();){var o=e.textContent.trim(),n=e.parentNode;if(o.match(t)&&!s.test(o)){var d=this.constructLinkNode(o,a);d&&(n.insertBefore(d,e),n.removeChild(e))}}}},{key:"constructLinkNode",value:function(e,a){var t=a.exec(e);if(!t[2])return t[3]?zdom("a",{href:t[0],target:"_blank",rel:"noopener noreferrer"},t[0]):zdom("a",{href:window.location.protocol+"//"+t[0],target:"_blank",rel:"noopener noreferrer"},t[0]);window.console.log(t[0])}},{key:"replaceCurrentWordToLink",value:function(){var e=new RegExp(/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi),a=this.getCurrentTypingWord().trim(),t=this.getSelectionRange(),s=t.startContainer;if(a.match(e)&&!/(<([^>]+)>)/gi.test(a)&&3===s.nodeType&&"A"!==s.parentNode.nodeName){var i=zmTask.Util.linkify(a);t.setStart(s,t.startOffset-a.length);var o=document.createDocumentFragment(),n=document.createRange().createContextualFragment(i);o.appendChild(n),t.insertNode(o);for(var d,r=document.createNodeIterator(this._element,NodeFilter.SHOW_TEXT,function(e){return"A"!==e.parentElement.nodeName?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1);d=r.nextNode();)if(d.textContent===a){d.remove();break}}}},{key:"onpaste",value:function(e){if(!this.args.returnOnPaste){var a="";e.clipboardData||e.originalEvent.clipboardData?a=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(a=window.clipboardData.getData("Text")),0<a.length&&(e.preventDefault(),document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,a):document.execCommand("paste",!1,a),this.replaceCurrentWordToLink())}}}]),t}(a);e.ZMContentEditableAutoComplete=t}(),define([],function(s){var e,d,n,i,o,t,f,u=s("zmText"),p=s("zmMention"),r=s("zmsDialog"),m=s("zmlab"),l=s("zmTaskRestore"),c=s("zmAutoFill"),a=s("zmComponent"),z=s("zmResource"),b=s("zmail.Utils.DOM"),g=s("_zm"),v=zmTask.template,N={},h={},T={},k={},y={},C=[],S={},w={},I={2:"#ff4e67",3:"#10bc83"},A=0,D=function(){},L=!1,x=zmail.iamDateFormat||zmail.userDateFormat,R=u.get("taskUtil"),E=Boolean(g.isStreamsEnabled()),M={addTask:"/zm/task/addTask",deleteTask:"/zm/task/deleteTask",taskDelete:"/zm/task/taskDelete",changeAssignee:"/zm/task/changeAssignee",changeDueDate:"/zm/task/setDueDate",changeStatus:"/zm/task/changeStatus",changePriority:"/zm/task/changePriority",changeCategory:"/zm/task/changeCategory",changeTitle:"/zm/task/changeTitle",changeSummary:"/zm/task/changeSummary",previewMousedown:"task/previewMousedown"},P="i.msi-priority",O="i.msi-trash",B="div.zmLbl.zmViewLblName",U=function(){var e=zmsuite.getLeft("zm_task");return e.selId||(e.selId=""),e.selLayerId||(e.selLayerId=""),e},V={send:function(e){var a={t:"POST",u:zmail.conPath+(e.writeReq?"/taskAction.do":"/taskView.do"),p:e.param,fn:e.callBack||V.defaultHandler,ep:e.eparam||"",h:!0,onerror:e.fallback||V.defaultError,onnetfailure:e.fallback||V.defaultError};zmail.showFeature&&(a.setSessionId=!0),zmAjq.XHR(a)},taskGet:function(e,a,t,s,i){var o={u:zmail.conPath+"/taskGet.do",p:e,fn:t||V.defaultHandler,ep:a||"",onerror:s||V.defaultError,onnetfailure:s||V.defaultError};o.t=i?"POST":"GET",i?o.h=!0:o.isXHRNeeded=!1,zmAjq.XHR(o)},searchReq:function(e,a,t){var s={mode:"searchStreams",grid:!1,range:5,entityType:3,streamsView:!0,actionType:"viewSelfData",start:0,appView:!0};$.extend(s,e);var i={t:"POST",u:zmail.conPath+"/stream.do",p:s,fn:a,ep:"",h:!0,onerror:t,csr:"s"};zmAjq.XHR(i)},changeCategoryReq:function(e){e.taction="changeCategory",e.actionType="changeEntity";var a=e;V.taskReq(e,a,V.callBack,!0)},taskReq:function(e,a,t,s,i){if(""===a&&(a={}),e.title&&e.title.length<=0)return zmUtil.succErrMsg("e",R.errorMsg.enterTitle),!1;var o={streamsView:!0,entityType:3};$.extend(o,e);var n=a||"",d=!1;s&&(d=s),V.send({param:o,eparam:n,callBack:t,fallback:i,writeReq:d})},streamReq:function(e,a,t,s,i){var o={streamsView:!0,entityType:3};$.extend(o,e);var n={t:"POST",u:zmail.conPath+"/stream.do",p:o,fn:t||V.defaultHandler,ep:a||"",h:!0,onerror:i||V.defaultError};zmAjq.XHR(n)},labReq:function(e,a,t,s,i){var o={t:"POST",u:zmail.conPath+"/lA.do",p:e,fn:t||V.defaultHandler,ep:a||"",h:!0,onerror:i||V.defaultError};zmAjq.XHR(o)},postReq:function(e,a,t,s,i){var o={streamsView:!0,entityType:3};$.extend(o,e);var n={t:"POST",u:zmail.conPath+"/post.do",p:o,fn:t||V.defaultHandler,ep:a||"",h:!0,onerror:i||V.defaultError};zmAjq.XHR(n)},removeAttachmentReq:function(s,i){var e={actionType:"changeEntity"},a={pTaskId:s.pTaskId};e.taction=a.taction="removeAttachment",e.entityId=a.entityId=s.entityId,e.groupId=a.groupId=s.groupId,e.attachId=a.attachId=s.attachId;V.taskReq(e,a,function(e,a){if(V.callBack(e,a),i&&i(),zmTask.Util.isNewTaskEnabled){var t=s.entityId;$.publish("/zm/task/updateAttachments",[{entityId:t,add:!1}])}},!0)},addDeleteLabelReq:function(e,a){var t={unread:!1},s={pTaskId:e.pTaskId};t.mode=s.mode="tag",t.actionType=s.actionType=e.checked?"addLabel":"deleteLabel",t.entityId=s.entityId=e.entityId,t.groupId=s.groupId=e.groupId,t.labelId=s.labelId=e.labelId,V.postReq(t,s,a,!0)},changeAssigneeReq:function(e,a){var t={actionType:"changeEntity"},s={pTaskId:e.pTaskId};t.taction=s.taction="changeAssignee",t.entityId=s.entityId=e.entityId,t.groupId=s.groupId=e.groupId,t.assignee=s.assignee=e.assignee,V.taskReq(t,s,a,!0)},deleteTaskReq:function(e,s){var a={actionType:"delEntity",forceDelete:!0},t={};a.taction=t.taction="deleteTask",a.entityId=t.entityId=e.entityId,a.groupId=t.groupId=e.groupId,e.pTaskId&&(t.pTaskId=e.pTaskId);var i=V.callBack;s&&(i=function(e,a){V.callBack(e,a);var t={entityId:a.entityId,pTaskId:a.pTaskId,groupId:a.groupId};$.publish(M.taskDelete,t),s(a)}),V.taskReq(a,t,i,!0)},addEditProjReq:function(e,a,t,s){var i={streamsView:!0,entityType:3};$.extend(i,e);var o=a||"";V.send({param:i,eparam:o,callBack:function(e,a){V.callBack(e,a),"function"==typeof t&&t(e,a)},fallback:s,writeReq:!0})},getAllProjects:function(e,a,t,s){var i={actionType:"appView",streamsView:!0,entityType:3,groupId:zmail.zuid,taction:"getAllProjects",includeDashBoard:!0};$.extend(i,e);var o=a||"";V.send({param:i,eparam:o,callBack:t,fallback:s,writeReq:!1})},sendAddAttachmentRequest:function(e,a){var t={taction:"addAttachment",entityType:"3",actionType:"addEntity",streamsView:!0};$.extend(t,e),V.send({param:t,eparam:e,callBack:a,writeReq:!0})},sendMoveTaskRequest:function(e,a,t,s){V.send({param:e,eparam:a,callBack:t,fallback:s,writeReq:!0})},sendReorderRequest:function(e,a,t,s){e.taction="reorderSubtasks",V.send({param:e,eparam:a,callBack:t,fallback:s,writeReq:!0})},defaultHandler:function(){zmUtil.succErrMsg("s",R.common.success)},defaultError:function(e,a){a.fallback&&a.fallback(e),e&&zmUtil.succErrMsg("e",e.msg)},reqSetProjectValue:function(e,a){var t=$.Deferred(),s={groupId:a};s.categoryName=e.trim(),s.taction="addCategory",s.actionType="addCommonLabel";var i=s;return this.addEditProjReq(s,i,function(e,a){t.resolve(e,a)}),t.promise()},sendNewLabReq:function(e,a){var t={fn:f.tagResponse},s={name:e,color:a,accId:zmail.accId,mode:"a"},i={name:e,mode:"a"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:t.fn,p:s,ep:i})},migrateTask:function(){var e={onOk:function(){zmAjq.XHR({u:zmail.conPath+"/tasks/TaskMigration.do",t:"POST",fn:V.defaultHandler,p:{dateformat:"dd/MM/yyyy"}})},stopPropagation:!0},a=u.applyArgs(R.common.migrateTask,{companyname:zmail.globalI18N.companyName});r.confirm(a,e)},getTaskList:function(e,a,t){var s={actionType:"appView",isPrev:!1,taction:"getMyTasks",limit:20,streamsView:!0,entityType:3,groupId:zmail.zuid};"delayed"!==e.mode&&"upcoming"!==e.mode&&"week"!==e.mode&&"month"!==e.mode||(s.isPrev=!0),$.extend(s,e),a=a||"",V.send({param:s,eparam:a,callBack:t,writeReq:!1}),l.store("listing","param",s),l.store("listing","eparam",a)},addEditTask:function(e,a,t){var s={streamsView:!0,entityType:3};$.extend(s,e),a=a||"",V.send({param:s,eparam:a,callBack:t,writeReq:!0})},sendSortReq:function(e,a,t){var s={actionType:"appView",limit:20,streamsView:!0,entityType:3};$.extend(s,e),V.send({param:s,eparam:a,callBack:t,writeReq:!1})},sendCategoryReorderReq:function(e,a,t){var s={taction:"reorderCategory"};$.extend(s,e),V.send({param:s,eparam:a,callBack:t,writeReq:!0})},fetchSubtasks:function(e,a){var t={taction:"getSubTasks",actionType:"appView",entityType:"3",streamsView:!0};$.extend(t,e),V.send({param:t,callBack:a,writeReq:!1})},sendAssigneeFilterReq:function(e,a,t){var s={taction:"getGroupTasks",actionType:"appView",entityType:"3",streamsView:!0,limit:20,isPrev:!1};$.extend(s,e),V.send({param:s,eparam:a,callBack:t,writeReq:!1})},sendCreatedByFilterReq:function(e,a,t){V.getTaskList(e,a,t)},sendEditLabReq:function(e,a){var t=$.trim(e.val()),s=m.convertRGBtoHex($.q("#zm_createlabelpopup").find("div.sel").css("background-color")),i={name:t,color:s,accId:zmail.accId,labId:m.labelId,mode:"e"},o={name:t,color:s,labId:m.labelId,mode:"e"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:a.fn,p:i,ep:o})},sendDeleteLabReq:function(e,a){var t={labId:e,mode:"d",accId:zmail.accId},s={labId:e,mode:"d"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:f.tagResponse,p:t,ep:s})},sendMoveSubtaskReq:function(e,a){var t={taction:"moveSubtask",streamsView:!0};$.extend(t,e);V.send({param:t,eparam:t,callBack:function(e){$.publish(M.addTask,[e,{entityId:a.entityId,pTaskId:a.toParentId}]),$.publish(M.deleteTask,[e,{entityId:a.entityId,pTaskId:a.pTaskId,groupId:a.groupId}])},writeReq:!0})},sendCustomStatusReq:function(e,a,t){var s={taction:"editCustomStatus",actionType:"changeEntity"};$.extend(s,e),V.send({param:s,eparam:s,callBack:a,fallback:t,writeReq:!0})},getGroupSettings:function(s){return new Promise(function(a,t){if(y[s])a(y[s]);else{var e={taction:"getGroupSettings",groupId:s,actionType:"appView",streamsView:!0,entityType:3};V.send({param:e,eparam:e,callBack:function(e){y[s]=e,a(y[s])},fallback:function(e){t(e)},writeReq:!1})}})},editGroupSettings:function(a,e,t,s){var i={taction:"editGroupSettings",groupId:a,dueDateAfter:e,overDueReminder:t};V.send({param:i,eparam:i,callBack:function(e){e&&(y[a].dueAfter=i.dueDateAfter,y[a].remindOnOverdue=String(i.overDueReminder)),zmUtil.succErrMsg("s",R.settings.successMsg),"function"==typeof s&&s()},fallback:function(e){zmUtil.succErrMsg("e",e.msg)},writeReq:!0})},getDashBoard:function(i){return new Promise(function(a,t){var e=zmTask.Util.getGroupStatsCount(i);if(e&&0<$.e(e).length)a(e);else{var s={taction:"getDashboard",groupId:i,actionType:"appView",streamsView:!0,entityType:3};V.send({param:s,eparam:s,callBack:function(e){zmTask.Util.setGroupStats(i,e),a(e)},fallback:function(e){zmUtil.succErrMsg("e",e.msg),t(e)},writeReq:!1})}})},getUserViewSettingsPreference:function(e,a){V.taskGet({action:"getUserViewSettingsPreference"},{},e,a,!1)},getUserViewSettings:function(e,a,t){V.taskGet({action:"getUserGroupSettingsPreference",groupId:e},{},a,t,!1)},setUserViewSettings:function(a,e,t,s){var i={};zmTask.Util.isGroupBasedView(a,e)?("getMyTasks"===e.taction||e.assigneeId===zmail.zuid?a.viewLabel=i.viewLabel="TOME":a.viewLabel=i.viewLabel="BYME",i.viewPref=a.ViewId,i.sortDate=a.sortDate,i.taction="saveUserViewPreference",a.user=zmail.zuid,a[i.viewLabel+"_PREFERENCE"]={CurrentViewId:a.ViewId,CurrentView:a.ViewId},"GROUP"===a.ViewId&&a.Order&&(i.groupIds=a.groupIds=JSON.stringify(a.Order))):(i.groupId=a.group=a.groupId=e.groupId,"LIST"===a.ViewId?(i.taction="saveListPreference",i.sortDate=a.sortDate,i.isAscending=a.isAscending):"SECTION"===a.ViewId||"CATEGORY"===a.ViewId?(i.taction="saveCategoryPreference",i.categoryIds=JSON.stringify(a.Order)):"STATUS"===a.ViewId?(i.taction="saveStatusPreference",i.statusIds=JSON.stringify(a.Order)):"ASSIGNEE"===a.ViewId?(i.taction="saveAssigneePreference",i.assigneeIds=JSON.stringify(a.Order)):"PRIORITY"===a.ViewId?i.taction="savePriorityPreference":"DUE_DATE"===a.ViewId&&(i.taction="saveDueDatePreference",i.isAscending=a.isAscending)),V.send({param:i,eparam:i,callBack:function(e){zmTask.Util.setGroupViewSettings(a),t&&t(a)},fallback:function(e){zmUtil.succErrMsg("e",e.msg),s&&s(e)},writeReq:!0})},sendBulkActionRequest:function(){var e={entityIds:arguments.length<=0?void 0:arguments[0],streamsView:!0,taction:"bulkActions",mode:arguments.length<=3?void 0:arguments[3]};(arguments.length<=1?void 0:arguments[1])&&(e.groupIds=arguments.length<=1?void 0:arguments[1]),(arguments.length<=2?void 0:arguments[2])&&(e.groupId=arguments.length<=2?void 0:arguments[2]),(arguments.length<=4?void 0:arguments[4])&&(e.value=arguments.length<=4?void 0:arguments[4]),V.send({param:e,eparam:e,callBack:arguments.length<=5?void 0:arguments[5],fallback:arguments.length<=6?void 0:arguments[6],writeReq:!0})},imTask:function(e,a){var t={};t.groupId=a,t.actionType="addEntity",t.entityType="3",t.taction="importTask",t.fP=e.fP,t.sN=e.sN,V.addEditTask(t,{},function(e){zmUtil.succErrMsg("s",e.msg)})},fetchAssigneeStatsReq:function(e,s,a){V.taskGet(e,e,function(a){var t=T[e.groupId];t&&(void 0===t.assigneeStats&&(t.assigneeStats={}),_.each(e.assigneeIds,function(e){t.assigneeStats[e]=a[e]})),s(a)},function(){a()},!0)},callBack:function(e,a){var t=a.taction||a.actionType;"addTaskSubtask"===t?$.publish(M.addTask,[e,a]):"editTask"===t?$.publish("/zm/task/editTask",[e,a]):"changeCategory"===t?$.publish("/zm/task/changeCategory",[e,a]):"changeAssignee"===t?$.publish(M.changeAssignee,[e,a]):"changeTitle"===t?$.publish("/zm/task/changeTitle",[e,a]):"changePriority"===t?$.publish("/zm/task/changePriority",[e,a]):"changeSummary"===t?$.publish("/zm/task/changeSummary",[e,a]):"setDueDate"===t?$.publish("/zm/task/setDueDate",[e,a]):"changeStatus"===t?$.publish("/zm/task/changeStatus",[e,a]):"addCategory"===t?$.publish("/zm/task/addCategory",[e,a]):"editCategory"===t?$.publish("/zm/task/editCategory",[e,a]):"deleteCategory"===t?$.publish("/zm/task/deleteCategory",[e,a]):"deleteTask"===t?$.publish(M.deleteTask,[e,a]):"deleteLabel"===t?$.publish("/zm/task/removeLabel",[e,a]):"copyTask"===t?$.publish("/zm/task/copyTask",[e,a]):"moveSubtask"===t&&(a.pTaskId=a.toParentId,$.publish(M.addTask,[e,a]))}};f={toolTip:function(e,a){$.e(e).attr({"data-tooltip":a})},loadGroups:function(){return e=$.Deferred(),d?e.resolve():zmail.ContactBook.groupsFetched.done(function(){zmail.ContactBook.fetchProcess.done(function(){d=$.extend({},zmail.ContactBook.getGroupsIDMap()),L=!0,e.resolve()})}).fail(function(){d=[],e.resolve()}),e.promise()},getDateObject:function(e,a){var t,s;return"dd/MM/yyyy"===a?(t=e.split("/"),s=new Date(t[2],t[1]-1,t[0])):"MM/dd/yyyy"===a&&(t=e.split("/"),s=new Date(t[2],t[0]-1,t[1])),s},formatTwoDigits:function(e){return e<10?"0"+e.toString():e.toString()},currentSubMenus:[],CONSTS:{status:{2:"inprogress",3:"complete"},statusClassMap:{2:"msi-uncheck",3:"msi-check"},priClassMap:{1:"SC_red",2:"SC_red",4:"SC_blue",5:"SC_blue"},titleValidate:{maxLength:500,minLength:1},summaryValidate:{maxLength:65e3,minLength:0},priActivityLogMap:{1:R.center.high,2:R.center.high,3:R.center.medium,4:R.center.low,5:R.center.low},statusActivityLogMap:{2:R.common.activityReopened,3:R.common.activityComplete},relativeReminders:[{htm:R.center.samedayReminder,data:{interval:0}},{htm:R.center["1dayBefore"],data:{interval:1}},{htm:u.applyArgs(R.center.ndaysBefore,{n:2}),data:{interval:2}},{htm:u.applyArgs(R.center.ndaysBefore,{n:3}),data:{interval:3}},{htm:u.applyArgs(R.center.ndaysBefore,{n:4}),data:{interval:4}},{htm:u.applyArgs(R.center.ndaysBefore,{n:5}),data:{interval:5}},{htm:u.applyArgs(R.center.ndaysBefore,{n:6}),data:{interval:6}},{htm:u.applyArgs(R.center.ndaysBefore,{n:10}),data:{interval:10}},{htm:u.applyArgs(R.center.ndaysBefore,{n:20}),data:{interval:20}},{htm:u.applyArgs(R.center.ndaysBefore,{n:30}),data:{interval:30}}],repeatType:{1:"Daily",2:"Weekly",3:"Monthly",4:"Yearly"},stringDateFormat:"dd MMM yyyy",defaultDateFormat:"MM/dd/yyyy"},extendMention:function(e,a,t,s){var i,o,n;return s&&s.fromMail?(i=s.pos,n=(o=s.mentionObj.offset)?o.from[0]:void 0):p.getMentions(e)&&p.getMentions(e).length&&(i=p.getCaretPosition(e),n=(o=c.mentionData(e))?o.from[0]:void 0),i&&n&&n<i&&(0===a.which||t||8===a.which||a.ctrlKey||a.metaKey||a.altKey||32===a.which||13===a.which||(a.preventDefault(),zmUtil.succErrMsg("e",R.errorMsg.beforeAssignee)),13===a.which||32===a.which)?(a.preventDefault(),!1):1<=p.getMentions(e).length&&(64===a.keyCode||64===a.which)?(a.preventDefault(),!1):void 0},tagResponse:function(e,a){var t=e.labelId,s={};if(s[t]={color:e.color,id:e.labelId,label:e.displayName,dispName:e.displayName,fav:"true"},zmsuite.isWorkspaceAvailable("zm_task")){var i,o=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("zmllabelH");"a"===a.mode?(o.appendNode(s,o.mapObject),$.publish("/zm/task/label/add",[e])):"e"===a.mode?((i=o.getRowObjfromId(t))[t].dispName=i[t].label=e.displayName,i[t].color=e.color,o.editNode(i,o.mapObject),$.publish("/zm/task/label/rename",[e])):"d"===a.mode&&(i=o.getRowObjfromId(a.labId),o.deleteNode(i),$.publish("/zm/task/label/delete",[e])),zmail.zohoAccLabInfo=$.extend({},o.getListObject()),zmail.accId===zmail.defAccId&&(zmail.labInfo=o.getListObject())}else"a"===a.mode&&(zmUtil.getTagList("default")[t]=s[t])},popupClick:function(e,a,t){t.parent("b").removeClass("SC_ddn"),t.removeClass("SC_red SC_blue"),$.q("#zm_dropDown").remove(),"4"===e.val?t.addClass("SC_blue"):"2"===e.val&&t.addClass("SC_red")},getCaretCharOffset:function(e){var a=0;if(void 0!==window.getSelection){var t=window.getSelection().getRangeAt(0),s=t.cloneRange();s.selectNodeContents(e),s.setEnd(t.endContainer,t.endOffset),a=s.toString().length}else if(void 0!==document.selection&&"Control"!==document.selection.type){var i=document.selection.createRange(),o=document.body.createTextRange();o.moveToElementText(e),o.setEndPoint("EndToEnd",i),a=o.text.length}return a}};var H={Req:V,isNewTaskEnabled:zmail.isTaskNewUIEnabled||zmail.showFeature,isUnifiedViewEnabled:zmail.showFeature,CONSTS:f.CONSTS,extendMention:f.extendMention,toolTip:f.toolTip,getLeft:U,BULK_ACTION_COUNT:50,TOMEID:"tome"+zmail.zuid,BYMEID:"by"+zmail.zuid,SECTIONTYPES:{LIST:"list",DUEDATE:"duedate",CATEGORY:"category",STATUS:"status",PRIORITY:"priority",SINGLE:"single",ASSIGNEE:"assignee",GROUP:"group"},SECTIONKEYS:{category:"categoryId",group:"groupId",status:"status",priority:"priority",assignee:"assigneeId"},isDisabledGroup:function(e){var a=zmTask.Util.getGroup(e);return!!(zmUtil.isNewGroupUser()&&a&&a.length&&a[0].attrs.disabled)},isHiddenGroup:function(e){var a=zmTask.Util.getGroup(e);return!!(zmUtil.isNewGroupUser()&&a.length&&a[0].attrs.hidden)},getGroup:function(e){var a;return void 0!==e&&(a=zmail.ContactBook.getGroups(String(e),{includeAllGroups:!0})),a},isGroupOwner:function(e){if(e===zmail.zuid)return!0;var a=zmTask.Util.getGroup(e);return!!a.length&&a[0].attrs.isOwner},isGroupModerator:function(e){if(e===zmail.zuid)return!0;var a=zmTask.Util.getGroup(e);return!!a.length&&-1!==a[0].attrs.moderator.indexOf(zmail.zuid)},unescapeSpecialChar:function(e){return e=e?e.replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&#39;/gi,"'").replace(/&quot;/gi,'"').replace(/&apos;/gi,"'"):""},escapeSpecialChar:function(e){return e=e?e.replace(/&/gi,"&amp;").replace(/"/gi,"&quot;").replace(/'/gi,"&#39;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;"):""},setRowData:function(e){S=e},getCurRow:function(){return S},Categories:function(){return n},Groups:function(a,e){if(e&&a){var t={};return _.each(d,function(e){a!==e.attrs.id&&e.attrs.id!==zmail.zuid&&(t[e.attrs.id]=e)}),t}return a?d[a]:d},getTaskfromStream:function(e,a){var t,s=$.Deferred(),i={};t=a?$.extend({},a):{},i.mode="singlePost",i.actionType="viewGroupEntity",i.groupId=t.groupId=e.groupId,i.entityId=t.entityId=e.entityId,i.allComments=!0;return V.streamReq(i,t,function(e){s.resolve(e)},!1,function(e){s.resolve(e)}),s.promise()},Init:function(){var t=$.Deferred();return f.loadGroups().done(function(){n?t.resolve():V.getAllProjects({},{taction:"getAllProjects",curEle:this},function(e){n=$.extend(!0,{},e.categories),e.groupOrder&&!zmail.ContactBook.UsageRestricted.GROUPS?(i=e.groupOrder,o=e.grptaskcount):(n=o={},i=[]),T=e.dashboard,_.each(e.dashboard,function(e,t){w[t]={mycount:e.statusCount[2]},_.each(e.catCount,function(e,a){w[t][a]=e.statusCount[2].assignedToMe})});var a=parseInt(zmail.zuid);i.push(a),o[a]=e.personaltaskcount,n[a]=e.personalCategories,h=e.statusDetails,zmTask.Util.initGroupArr(),t.resolve()},function(e){n=o={},i=[],t.resolve()})}),function(){if(!A&&void 0!==window.ZCL_getWeekStart)try{ZCL_getWeekStart().done(function(e){A=e})}catch(e){}}(),t.promise()},getGroupTaskOrder:function(){return{order:i,count:o}},setGroupTaskOrder:function(e){i.push(Number(e))},isPrivateTask:function(e){return e!==zmail.zuid&&!d[e]},isGroupMember:function(e,a){var t=d[a],s=t?t.attrs.members:void 0;return!!(e===a||t&&s&&-1!==s.indexOf(e))},getGroupMembers:function(e){return!!d[e]&&d[e].attrs.members},showPreviewToolTips:function(e){e.find("i.msi-label").length&&f.toolTip(e.find("i.msi-label")[0],R.preview.tooltip.tag),e.find("i.msi-calendar").length&&f.toolTip(e.find("i.msi-calendar")[0],R.preview.tooltip.duedate),e.find(P).length&&f.toolTip(e.find(P)[0],R.preview.tooltip.priority),e.find("i.msi-attachment").length&&f.toolTip(e.find("i.msi-attachment").parent()[0],R.preview.tooltip.attachment),e.find("i.msi-watch").length&&f.toolTip(e.find("i.msi-watch").parent()[0],R.preview.tooltip.recurring),e.find(O).length&&f.toolTip(e.find(O).parent()[0],R.center.deleteTask),e.find("i.msi-reminder").length&&f.toolTip(e.find("i.msi-reminder")[0],R.preview.tooltip.reminder),e.find("li.SCtxt.zmTStatusMent").length&&f.toolTip(e.find("li.SCtxt.zmTStatusMent")[0],R.listing.tooltip.changeStatus)},showLoadingBand:function(){var e=zmsuite.getCenter("zm_task")[0].getNodes()[2].getListElem();ReactDOM.unmountComponentAtNode(e[0])||e.clearHTML(),D=a.loadingBand({container:e[0],type:"loading"})},removeLoadingBand:function(){D()},showToolTip:function(e){e.find(O).attr({"data-tooltip":R.center.deleteTask}),e.find("i.msi-archive").attr({"data-tooltip":R.center.archiveTask}),e.find("i.msi-unarchive").attr({"data-tooltip":R.center.unarchiveTask}),e.find("i.msi-link").attr({"data-tooltip":R.center.copyPermalink}),e.find("i.msi-undo").attr({"data-tooltip":R.center.deleteTask}),e.find("i.msi-markcomplete").attr({"data-tooltip":R.listing.tooltip.changeStatus}),e.find("i.msi-subtask").attr({"data-tooltip":R.listing.tooltip.addSubtask}),e.find(".zmtCt").attr({"data-tooltip":R.listing.tooltip.showSubtask}),e.find("i.msi-mail").attr({"data-tooltip":R.center.previewMail}),e.find("i.msi-nmore").attr({"data-tooltip":R.center.moreactions}),e.find("i.msi-lcmnt").attr({"data-tooltip":R.center.commentsAvailable})},setAssignee:function(e,a,t){a=this.unescapeSpecialChar(a).trim();var s="task",i=e.closest("div.zt_pv"),o=i.find("div.SC_ptit div.SC_assignee");e.closest("div.Stask_sub").length&&(s="subtask",o=(i=e.closest("div.Stask_sub")).find("div.SC_assignee"));var n=a,d=e.closest("div.zm_mention"),r=o.find("span"),m="",l=z.get("image","SC-Photo.png");if(t&&"-1"!==t){var c=H.getContact(t);c&&(m=c.fn,l=c.photo)}"subtask"!==s&&"-1"!==t&&t?(n+=" "+m+"\ufeff",d.find("div.zm_mentionbg").removeClass("SC_dyn"),e.data("mentions",[{fn:m,zid:t,id:t}]),e.val(n),p.updateElements(e[0])):(e.val(a),e.removeData("mentions"),d.find("b.zm_groupMember").length&&d.find("b.zm_groupMember").remove()),r&&(r.text(m),o.find("img").attr("src",l))},getDate:function(e,a){if(!e)return e;a=a||f.CONSTS.stringDateFormat;try{var t=new Date(e);if(!isNaN(t)||"Invalid Date"!==t){if(!t.getDateBy){if(a===f.CONSTS.defaultDateFormat)return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear();if(a===f.CONSTS.stringDateFormat)return e}e=t.getDateBy(a)}}catch(e){}return e},getRailTime:function(e){if("object"===babelHelpers.typeof(e)){var a=e.getHours(),t=e.getMinutes();return a=a<10?"0".concat(a):a,t=t<10?"0".concat(t):t,"".concat(a,":").concat(t,":00")}if(e.match(/^(\d+)/)&&e.match(/:(\d+)/)){var s=Number(e.match(/^(\d+)/)[1]),i=Number(e.match(/:(\d+)/)[1]),o=e.match(/\s(.*)$/),n=o?o[1]:"";"pm"===n&&s<12&&(s+=12),"am"===n&&12===s&&(s-=12);var d=s.toString(),r=i.toString();return s<10&&(d="0"+d),i<10&&(r="0"+r),d+":"+r+":00"}},bindStreamTime:function(e,a){var t=zmail.userOptions.isRailTime?"hh:mm":"hh:mm a";"undefined"!=typeof ZEVENTS&&ZEVENTS(e).picker("time",{tform:t,refer:e}).on("change",function(e){"function"==typeof a&&a()}).bind()},bindStreamCal:function(e,a,t,s){try{"undefined"!=typeof ZEVENTS&&ZEVENTS(e).picker("date",{dform:zmail.userDateFormat,range:[zmail.userDateVal,""],today:zmail.userDateVal,wkst:A,mode:"popup",refer:a,update:"yes",minhgt:251,fullDtclk:1}).on("dateclick",function(){$.e(a).parent().removeClass("SC_dyn");var e=this.getDate();t(e)}).bind()}catch(e){}},getComputedTime:function(){var e=new Date,a=e.getHours(),t=e.getMinutes(),s=e.getSeconds(),i=30*Math.round(t/30)%60,o={};i=0<i?"30":"00";var n=23===a?0:++a,d=45<t?n:a;return 23<=d+2?(d=0,o.tomorrow=!0):(d+=2,o.tomorrow=!1),o.time=f.formatTwoDigits(d)+":"+i+":"+f.formatTwoDigits(s),o},convertToTwelveHourFormat:function(e){if(void 0===e&&(e=zmTask.Util.getComputedTime().time),"object"===babelHelpers.typeof(e)){var a=e.getHours(),t=e.getMinutes();t=t<10?"0".concat(t):t;var s=a<12?"am":"pm";return"".concat(a=a%12||12,":").concat(t," ").concat(s)}if(1<(e=(e=e.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[e]).slice(0,4)).length){if(e=e.slice(1),zmail.userOptions.isRailTime)return e.join("");e[3]=" ",e[4]=Number(e[0])<12?"am":"pm";var i=Number(e[0])%12||12;e[0]=i<10?"0".concat(i):i}return e.join("")},getReminderInterval:function(t){var s=f.CONSTS.relativeReminders[0].htm;return $.each(f.CONSTS.relativeReminders,function(e,a){if(a.data.interval===t)return s=a.htm,!1}),s},validateParams:function(e,a){var t=this;if(_.isEmpty(e))return!1;var s=a.titleEl,i=a.summaryEl;if(void 0!==e.title&&0<s.length){var o=this.validateTitle(e.title);if(!o)return setTimeout(function(){s.focus(),t.moveCursorToEnd(s[0])},100),o}return!(void 0!==babelHelpers.typeof(e.summary)&&i&&0<i.length&&e.summary.length>f.CONSTS.summaryValidate.maxLength)||(i.focus(),zmUtil.succErrMsg("e",R.errorMsg.summaryLen),!1)},validateTitle:function(e,a){var t=!0;return!e||e.trim().length<f.CONSTS.titleValidate.minLength?(zmUtil.succErrMsg("e",R.errorMsg.enterTitle),t=!1):e&&e.length>f.CONSTS.titleValidate.maxLength&&(zmUtil.succErrMsg("e",R.errorMsg.titleLen),t=!1),t||"function"!=typeof a||a(),t},initAttachComponentPreview:function(a,e,t){var s=zmTask.Util.isNewTaskEnabled?t.get("attachEle"):t.get("bEle"),i={componentId:"task",isNewImp:!0,autoLaunch:!1,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],eleId:a.id,renameSupport:!0};g.isTeamDriveEnabled()&&(i.$actionEle=s,i.autoLaunch=!1),"popup"===a.openType&&(i.appTypePopup=!0),i.onAllUploadFinish={handler:function(e){if(e.tempLocation&&e.tempLocation.error)return 11===e.tempLocation.errorCode?g.succErrMsg("e",R.errorMsg.virusFound):12===e.tempLocation.errorCode?g.succErrMsg("i",R.errorMsg.virusPending):13===e.tempLocation.errorCode&&g.succErrMsg("e",R.errorMsg.uploadFailed),!1;a.clbkfn(e)},removeAttachDOM:!0,resetData:!0},zmUtil.initAttachComponent(i,function(e){t&&t.set("attref",e)})},initAttachComponent:function(s,i){var e=s,o=$.q("#"+s.id),a={componentId:"task",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],eleId:e.id,renameSupport:!0,autoLaunch:!1,onAddAttachment:function(e){var a,t;(a=e.Id,t=i.get("attach"),_.find(t,function(e){return e.id===a}))||(i.get("attach")?i.get("attach").push(e):i.set("attach",[e]),o.removeClass("SC_dyn"),"function"==typeof s.clbkfn&&s.clbkfn())},onRemoveAttachment:function(e){for(var a=e.uniqueId||e.fP,t=i.get("attach"),s=0;s<t.length;s++){if((t[s].uniqueId||t[s].fP)===a){t.splice(s,1);break}}0===o.children().length&&o.addClass("SC_dyn")}};e.preAttachedFile&&(a.preAttachedFile=e.preAttachedFile),g.isTeamDriveEnabled()&&(a.$actionEle=i.get("actionEl")||i.get("bEle"),s.appTypePopup&&(a.appTypePopup=!0)),zmUtil.initAttachComponent(a,function(e){i&&i.set("attref",e)})},copyNewProps:function(e,a){for(var t in a)e.hasOwnProperty(t)||(e[t]=a[t]);return e},bindPriority:function(e,a,t){a.stopPropagation();for(var s=[],i=$.e(e).find(P),o=$.e(i).attr("class"),n=[{cls:"SC_red",text:R.center.high,val:"2"},{text:R.center.medium,val:"3"},{cls:"SC_blue",text:R.center.low,val:"4"}],d=0;d<3;d++)o.split(" ")[1]===n[d].cls?s.push({dom:zdom("fragment",null,zdom("i",{className:"msi-none msi-tick"}),n[d].text),data:{action:n[d].text,val:n[d].val}}):s.push({dom:zdom("fragment",null,zdom("i",{className:"msi-none"}),n[d].text),data:{action:n[d].text,val:n[d].val}});var r=$.e(i),m={par:e,list:s,align:"pright",clk:function(e,a){f.popupClick(e,a,r),t&&t(e,a,r)},container:$.e(e).closest("div.SC_PU")[0]},l=zmsuite.showMenu(m);this.checkDropPosition(e,l.$el),this.addRemoveMenu("add",l)},checkDropPosition:function(e,a){var t=$.e(e).offset(),s=$.e(a).offset(),i=$.e(e).find("b");t.top>s.top?i.addClass("SC_ddnB"):i.addClass("SC_ddn")},addRemoveMenu:function(e,a){"add"===e&&a?t=a:"remove"===e&&t&&("function"==typeof t.remove?($.e(t.dropObj.par).find(".SC_ddn").removeClass("SC_ddn"),t.remove()):t.hide())},getProjectAutofillArray:function(e){var a=[],t=n[e];for(var s in t){var i={id:t[s].categoryId};i.name=t[s].categoryName,i.display_text=t[s].categoryName,i.tooltip=t[s].categoryName,a.push(i)}return a},folderlabelComp:function(e,a){var t=zmUtil.createFLComp(e,a);t.show(),H.addRemoveMenu("add",t)},showDropdownListing:function(e){var a={display:"name",displayAs:"dropdown"};a.parentDOM=e.parentDOM,a.onSelect=e.selectCallback,a.parWidth=!0,a.dataCallback=function(){return e.listing},"function"==typeof e.createCallback&&(a.onCreate=e.createCallback),e.container&&(a.container=e.container),this.folderlabelComp("task",a)},getGroupName:function(e){return void 0===e&&(e=zmail.zuid),String(e)===zmail.zuid?R.left.mytask:d[e]?d[e].attrs.name:R.center.privateTask},getProjectName:function(e,a){if(a&&n&&n[e])for(var t=n[e],s=0,i=t.length;s<i;s++)if(a===t[s].categoryId)return t[s].categoryName;return""},highlight:function(e){e.addClass("highlightClass"),setTimeout(function(){e.removeClass("highlightClass")},5e3)},openMailPreview:function(e){var a={},t=s("zmList");e.accid!==zmail.accId&&(a={actionType:"viewGroupMailEntity",entityId:e.msgid,entityType:"1",streamsView:"true",groupId:e.mailOwner,accId:e.accid}),t.getMailData({msgId:e.msgid,opentype:2,type:"lt",src:"external",eprm:a})},createGroupDD:function(e,t){var s=[],a={id:zmail.zuid,name:R.left.mytask},i=this.getContact(zmail.zuid);zmail.zuid!==t&&(i&&(a.photo=i.photo),s.push(a));var o=zmTask.Util.Groups();_.each(o,function(e,a){e&&a!==t&&a!==zmail.zuid&&s.push({name:e.attrs.name,id:a,photo:e.attrs.photo})});var n=zmUtil.createFLComp("groups",{data:s,search:"name",display:"name",displayAs:"dropdown",onSelect:function(e){n.hide(),$.q("#"+e.id).trigger("click")},showCheckbox:!1,showCreate:!1,parentDOM:$.e(e.target).closest("li"),removehandler:!0,showUnread:!1});$.publish("/mail/menuCreated",{menuHandler:function(){}}),n.show()},createCategDD:function(e,a){var t=zmTask.Util.getProjectAutofillArray(a),s=zmUtil.createFLComp("categories",{data:t,search:"name",displayAs:"dropdown",display:"name",showCheckbox:!1,showCreate:!1,parentDOM:$(e.target).closest("li"),removehandler:!0,showUnread:!1,onSelect:function(e){s.hide(),$.q("#"+e.id).trigger("click")}});$.publish("/mail/menuCreated",{menuHandler:function(){}}),s.show()},validateTaskTitle:function(e,a){var t=e.innerText.trim(),s=$.e(e).find("a"),i=0<s.length?s.data("zid"):void 0,o=0<s.length?s.data("name"):void 0;return i&&(t=t.substring(0,t.indexOf(o))),a&&t.length<=0?(zmUtil.succErrMsg("e",R.errorMsg.enterTitle),!1):a&&500<t.length?(zmUtil.succErrMsg("e",R.errorMsg.titleLen),!1):t},bindAutoComplete:function(e){var o,n,d,i,r=e.elem,m=e.eprm,l=this,c="create"===e._create$EditTask;if(m&&m.$el){var a=m.$el;d=a.find("div.zmTaskAssigneeWra")}var u=function(){n=o=void 0,i=!1},p=!0,t=new zmTask.ZMContentEditableAutoComplete,s={element:r,keydown:function(e){if(8===e.which){var a=!1;d&&o&&d.text().length!==o.length&&(a=!0,u());var t=$.e(this).find("a.zms_mention");if(t&&o&&t.text().length!==o.length&&(u(),a=!0),a)return"updateAssignee"in m&&m.updateAssignee({zid:n}),d&&!m.donotreplace&&l.setTaskAssignee(d[0],m),!1}if(13===e.which&&p&&c){u();var s=l.validateTaskTitle(r,!0);if(s){var i=$.e(r).find("a");if(0<i.length&&(n=i.data("zid")),"preview"===m.actionSrc)return m.callback(s,n),!1;m.sendParams.title=s,m.sendParams.assignee=n,l.addTaskFunction(m)}return!1}},triggerOnPaste:!e._returnOnPaste,returnOnPaste:e._returnOnPaste};m.focusout&&"function"==typeof m.focusout&&(s.focusout=function(e){var a=l.validateTaskTitle(r,m.validate);"string"==typeof a&&m.focusout(a,n)}),"function"==typeof m.onclick&&(s.onclick=m.onclick),$.e(r).on("keypress",function(e){if(13===e.which||8===e.which)return!1;if(n&&i&&f.getCaretCharOffset(this)>=this.textContent.length)return e.preventDefault(),zmUtil.succErrMsg("e",R.errorMsg.beforeAssignee),!1;var a=t.getSelectionRange();return(a.startContainer.previousElementSibling&&"A"===a.startContainer.previousElementSibling.nodeName||"A"===a.startContainer.parentNode.nodeName)&&8!==e.keyCode&&0<a.startOffset?(zmUtil.succErrMsg("e",R.errorMsg.beforeAssignee),e.preventDefault(),!1):void 0}),setTimeout(function(){t.init(s)},0);var z={input:t,onSelect:function(e,a){var t=a.item.attributes;n=t.zid,o=t.firstName;var s=zdom("div",null," ",zdom("a",{ref:"link",className:"zms_mention","data-zid":n,"data-name":o},o)," ");i=!0,this.userInput.replaceContent(s),d&&!m.donotreplace&&l.setTaskAssignee(d[0],m,n,o,t.profileImage),"updateAssignee"in m&&m.updateAssignee({zid:n,name:o,img:t.profileImage,type:"subtask",eid:t.id})},listShown:function(){p=!1,"function"==typeof m.positionCbk&&m.positionCbk(this.listComponent.dom)},listHidden:function(){p=!0},setDebounce:0,contactType:"org"},g=zmContactsAutoComplete.autoComplete(z);if(m.textChangeAction){var v=/(?:(([^\s]+[\s]?)*))/i;g.trigger.textChangeAction=function(e){if(13!==e.event.which){var a,t=this;a=t._input.editor||t._input.contenteditable?t._input.getCurrentTypingWord(!0):t.getCurrentWord(),t.currentText=a,v.lastIndex=0;var s=v.exec(a);if(s){var i=s[1]||"";t.publishTriggerEvent({searchToken:i})}else t.publishNegativeTriggerEvent()}}}return u},addTaskFunction:function(t){var s=this,i=$.extend({},t.sendParams),o=$.extend({},t.sendParams);i.taction=o.taction="addTaskSubtask",i.actionType="addEntity",o.fromAction="leftClick","quicktask"===i.actionSrc?(i.lockinvites=!1,i.invitees=o.invitees=i.groupId===zmail.zuid?i.assignee:void 0,"function"==typeof t.toggleLoading&&t.toggleLoading(!0)):"preview"===i.actionSrc&&(i.streamsView=!0,i.entityType=3),i.pTaskId||(o.type="ptask");zmTask.Util.Req.taskReq(i,o,function(e,a){"preview"===i.actionSrc&&i.pTaskId&&s._updateListingModels({data:o}),t.callback(e,a)},!0,t.fallback)},_updateListingModels:function(e){var a=e.data,t=a.taction,s=a.pTaskId,i=a.entityId,o=zmTask.getCollectionType();if(o){var n=zmTask.getActiveList(o);if("addTaskSubtask"!==t||s){var d=s||i,r=n.getModel(d);if(r)if("changeTitle"===t){var m=a.title;r.set("TITLE",m.trim())}else if("changeAssignee"===t){var l=a.assignee;r.set("ATTENDEEIDS",l)}else if("addTaskSubtask"===t){var c=r.get("SUBTASKCOUNT")+1;r.set("SUBTASKCOUNT",c)}else if("addAttachment"===t){var u=a.length;r.set("ATTACHMENTSCOUNT",u)}else if("removeAttachment"===t){var p=r.get("ATTACHMENTSCOUNT")-1;p=Math.max(p,0),r.set("ATTACHMENTSCOUNT",p)}}}},bindMention:function(a){var e=function(){this.titleEl=$.e(a.titleEl),this.titleEl&&(this.groupId=a.groupId===zmail.zuid?"org":a.groupId,this.initEvents())};return e.prototype={setAutofillToTitle:function(){var e={contentArray:"org",compare:["fn","ln","nn","eid"],LType:"3",OType:"3",initialHeight:!1,oneMention:!0,excludeMe:!1};this.groupId&&(e.groupId=this.groupId,this.titleEl.data("gid",this.groupId)),c.setAutofill(e,this.titleEl)},initEvents:function(){this.setAutofillToTitle(),a.keypress||this.titleEl.off("keypress").on("keypress",function(e){if($.e(this).val().length>=f.CONSTS.titleValidate.maxLength)return!1;f.extendMention(this,e,a.addEl)})}},new e},initGroupArray:function(){var t=this;return new Promise(function(e,a){zmail.ContactBook.groupsFetched.done(function(){zmail.ContactBook.fetchProcess.done(function(){d=$.extend({},zmail.ContactBook.getGroupsIDMap()),L=!0,zmTask.Util.initGroupArr(),e(C)})}).fail(function(){d=[],a([t.defaultGroupList])})})},defaultGroupList:{id:zmail.zuid,name:R.left.mytask,display_text:R.left.mytask,tooltip:R.left.mytask},groupDropdown:function(o){var n=[],e=0<i.length?i:zmail.ContactBook.getGroupOrder(),a=function(){var i=R.left.mytask;return E?e.forEach(function(e){if(!H.isDisabledGroup(e)&&o!==e){var a=d[e],t=a.attrs.name,s=a.id;t=s===zmail.zuid?i:t,n.push({id:s,name:t,display_text:t})}}):n=[{id:zmail.zuid,name:i,display_text:i}],n};if(L)return a();H.initGroupArray().then(function(){return a()})},categoryDropDown:function(a,i){var e=function(){var e=n[a],s=[];return e.forEach(function(e){var a=e.categoryId,t=e.categoryName;a!==i&&s.push({id:a,name:t,display_text:t})}),s};if(L)return e();H.initGroupArray().then(function(){return e()})},initGroupArr:function(e){C=[];var a=i&&0<i.length?i:zmail.ContactBook.getGroupOrder();E&&0<a.length?_.each(a,function(e){if(!H.isDisabledGroup(e)){var a={},t=d[e]||{attrs:{}};a.id=String(e),a.name=a.id===zmail.zuid?R.left.mytask:t.attrs.name,a.display_text=t.attrs.name||a.name,a.tooltip=t.attrs.name||a.name,C.push(a)}}):C.push(this.defaultGroupList)},getGroupArr:function(){return C},bindAssignEvents:function(i,o,n){var d,r,m=i.data(),l=i.data("assignee"),c="",e={zuid:zmail.zuid,promise:!1};e.type=zmail.isOrg?"org":void 0;var u,a=$.extend({attrs:{fn:"Me",zid:zmail.zuid}},zmail.ContactBook.get(e)[0]),p=[],s=[];p.push(a);var z=function(e){m.assignee!==e.zid&&(m.groupId!==zmail.zuid||"-1"!==e.zid?(V.changeAssigneeReq({entityId:m.entityId,groupId:m.groupId,assignee:e.zid,pTaskId:m.pTaskId},function(e,a){$.publish(M.changeAssignee,[e,a])}),r.$el.hide()):i.text(c))},g=function(e){e.length?(u.empty(),$.each(e,function(e,a){var t=zdom("li",null,zdom("span",{title:a.attrs.eid},a.attrs.fn),zdom("img",{alt:"SL",ref:"photo",src:a.attrs.photo}));$.e(t).data(a.attrs),b.mount(t,u)})):r.$el.hide()};if(m.groupId&&m.groupId!==zmail.zuid){var t=zmail.ContactBook.getGroups(m.groupId);if(t.length){var v=t[0].attrs.members.slice(0),f=v.indexOf(zmail.zuid);0<=f&&v.splice(f,1);var N=zmail.ContactBook.get({zuid:v,type:["org"],promise:!1});p=p.concat(N)}}function h(e){r&&r.$el&&r.$el.hide(),e.stopPropagation(),o&&o.removeAttr("style"),window.getSelection().removeAllRanges(),i.text(c),$.e(document.body).unbind("click",h)}function T(){var e;return s=[],e=p,$.each(e,function(e,a){var t=zdom("fragment",null,zdom("span",{title:a.attrs.eid},a.attrs.fn),zdom("img",{ref:"photo",src:a.attrs.photo}));s.push({dom:t,data:a.attrs})}),{list:s,clk:function(e,a,t){l=e.zid,c=e.fn,"function"==typeof n?n(e,r):z(e),o&&o.removeAttr("style"),$.e(document.body).unbind("click",h),window.getSelection().removeAllRanges(),t.stopPropagation()},ulClass:"SC_Pr"}}var k={"min-width":"200px","max-width":"300px"},y={width:"200px"};m.fromDateExtraction&&(y.width=""),i.off("click").on("click",function(e){var a,t;e.stopPropagation(),m.fromDateExtraction||(window.getSelection&&document.createRange?(t=window.getSelection(),(a=document.createRange()).selectNodeContents($.e(this)[0]),t.removeAllRanges(),t.addRange(a)):document.selection&&document.body.createTextRange&&((a=document.body.createTextRange()).moveToElementText($.e(this)[0]),a.select())),c=$.e(this).text();var s=T();o&&(s.align="pleft",(s.par=o).css(y)),r=zmsuite.showMenu(s),d=r.$el,u=d.find("ul");var i=$.e(d.find("div")[0]);i.addClass("content-wrapper"),i.css(k),d.addClass("SC_dd SC_zi900 shw"),r.$el.show(),$.e(r.$el).on("click",function(e){e.stopPropagation()}),$.e(document.body).on("click",h)}),i.off("keyup").on("keyup",function(e){var a=d.find("li.sel");if(0<a.length){if(40===e.keyCode)return a.removeClass("sel"),a.next("li").addClass("sel"),!1;if(38===e.keyCode)return a.removeClass("sel"),a.prev("li").addClass("sel"),!1}else if(38===e.keyCode||40===e.keyCode)return $.q(d.find("li")[0]).addClass("sel"),!1;if(13===e.keyCode){window.getSelection().removeAllRanges();var t=d.find("li.sel").data();return t?("function"==typeof n?n(t,r):(t.fn="",z(t)),o&&o.removeAttr("style"),document.activeElement.blur(),$.e(document.body).unbind("click",h),l=t.zid,c=t.fn,r.$el.hide(),!1):($.e(this).text(c),o&&o.removeAttr("style"),document.activeElement.blur(),void r.$el.hide())}r.$el.show(),r.$el.offset({left:r.dropObj.par.offset().left});var s=i.is("SPAN")||i.is("EM")?i.text().trim():i.is("INPUT")?i.val().trim():void 0;u.closest("div.content-wrapper").css("height",""),0<s.length?zmail.ContactBook.get({str:s,type:"org",exclude:[l]}).done(function(e){g(e)}):g(p)})},deleteTaskAttachment:function(e,a){var t={attachId:e.Id,entityId:e.e,groupId:e.gId,pTaskId:e.pTaskId};V.removeAttachmentReq(t,a)},mousedownHandler:function(e){zmUtil.stopEvents(e,!0),this.addRemoveMenu("remove"),$.q("#zmCntxtMenu").remove(),$.q("#zm_dropDown").remove(),$.q("b.SC_ddn").removeClass("SC_ddn"),$.q(".zcal_cn").remove(),$.q(".zcal_tilst").remove()},editProjectValue:function(e,a){if("addCategory"===a.taction){var t=!1;for(var s in n[a.groupId])if(n[a.groupId][s].categoryId===e.categoryId){t=!0;break}t||n[a.groupId].push(e)}else if("editCategory"===a.taction){for(var i in n[a.groupId])if(n[a.groupId][i].categoryId===e.categoryId){n[a.groupId][i]=e;break}}else if("deleteCategory"===a.taction)for(var o in n[a.groupId])if(n[a.groupId][o].categoryId===e.categoryId){n[a.groupId].splice(o,1);break}},moveTask:function(a,o){var e=o?R.common.postnew:R.common.moveTask,t=this,n=!0,s=v.moveTask(),d=s.getElementsByClassName("groupId")[0],r=s.getElementsByClassName("catId")[0],m=s.getElementsByClassName("tTitle")[0],i=s.getElementsByClassName("msi-check")[0],l=s.getElementsByClassName("cmtId")[0],c=t.getGroupArr();$.e(m).val(a.TITLE),$.e(d).data({id:a.NMSPID,name:H.getGroupName(a.NMSPID)}),$.e(d).on("click",function(){t.showDropdownListing({listing:c,selectCallback:function(e,a){$.e(d).val(a.name),$.e(d).data(a),$.e(r).val(""),$.e(r).data(),H.addRemoveMenu("remove")},parentDOM:this})}),$.e(r).off("click").on("click",function(){var e=$.e(d).data(),a=t.getProjectAutofillArray(e.id);t.showDropdownListing({listing:a,selectCallback:function(e,a){$.e(r).val(a.name),$.e(r).data(a),H.addRemoveMenu("remove")},parentDOM:this})});var u=function(e){$.e(i).toggleClass("msi-check msi-uncheck"),n=$.e(i).hasClass("msi-check")};$.e(i).on("click",u),$.e(l).on("click",u);var p={taction:"copyTask",copy:o,groupId:a.NMSPID,entityId:a.TASKID,toGroupId:a.NMSPID},z={title:e,$content:$.e(s),defaultCloseIcon:!0,buttons:[{name:R.common.save,callback:function(s){var e,i=String($.e(d).data().id);if(o||!o&&(e=i,a.NMSPID!==e||(zmUtil.succErrMsg("e",R.errorMsg.moveError),0))){var t=s.$els.$buttonContainer.find(".js-button-selector")[0];t.innerText=R.common.saving,p.toGroupId=i,$.e(r).data().id&&(p.toCatId=String($.e(r).data().id)),p.title=$.e(m).val(),p.includeComments=n,V.sendMoveTaskRequest(p,p,function(e,a){V.callBack(e,a),a.copy||($.publish("task/deleteTask",[{pid:a.entityId,gid:a.groupId}]),$.publish("/zm/task/deleteTask",[e,a]),$.publish("/streams/closePopOut",[e,a])),s.remove();var t=R.common.mveTask;a.copy&&(t=R.common.cpyTask),t+=H.getGroupName(i),zmUtil.succErrMsg("s",t)},function(e,a){t.innerText=R.common.save,zmUtil.succErrMsg("e",e.msg),s.remove()})}}},{isCancel:!0,name:R.common.cancel,callback:function(e){e.remove()}}],dialogDidMount:function(e){$.e(d).val(H.getGroupName(a.NMSPID)),$.e(d).data("id",a.NMSPID),e.$els.$contentWrapper.mousedown(function(e){zmUtil.stopEvents(e,!0),zmTask.Util.addRemoveMenu("remove")})}};Dialog.new(z)},handleURLChange:function(e,a){if(e){-1!==e.indexOf("t")||-1!==e.indexOf("s")?l.store("preview","hashParams",e):l.store("listing","hashParams",e);var t=zmsuite.getAppRouter("zm_task");if(!t)return!1;var s=t._hashParams;if(-1!==s.indexOf("t")?s.splice(s.indexOf("t"),s.length):-1!==s.indexOf("s")&&s.splice(s.indexOf("s"),s.length),-1===s.indexOf("views")&&-1===s.indexOf("tags")||!a?"mytask"===s[0]&&a?(s.splice(1,s.length),e=[a].concat(e)):a&&(s[0]=a):(s.splice(2,1),e=[a].concat(e)),-1!==e.indexOf("t"))return s.push.apply(s,e),void t.update();t.setParams(e),t.update()}},_updateNewTaskPriority:function(t,s,e){for(var a=$.e(t.target).find("i").attr("class"),i=[{cls:"highPriority",text:R.center.high,val:"2"},{cls:"noPriority",text:R.center.medium,val:"3"},{cls:"lowPriority",text:R.center.low,val:"4"}],o=[],n=0;n<3;n++)0<=a.indexOf(i[n].cls)?o.push({dom:zdom("fragment",null,zdom("i",{className:"msi-tick"}),i[n].text),data:i[n]}):o.push({dom:zdom("fragment",null,zdom("i",{className:"msi-none"}),i[n].text),data:i[n]});var d={list:o,par:$.e(t.target).closest("li"),align:"pright",clk:function(e,a){$.e(t.target).find("i").removeClass("highPriority lowPriority noPriority").addClass(e.cls),zmUtil.hideMenu(),s(e)}};e&&(d.container=e),zmsuite.showMenu(d)},getPriorityByValue:function(e){return f.CONSTS.priActivityLogMap[e]},getStatusByValue:function(e,a){var t=f.CONSTS.statusActivityLogMap[e];return t||(t=this.getStatusName(a,e)),t},addTaskPopup:function(e,a){$.e(e).find("#addnewtask").on("click",function(){zmUtil.requireTaskModule("taskCreate").done(function(){zmTask.Create({groupId:zmail.zuid,listInfo:a})})})},moveArrayElementPosition:function(e,a,t){var s=e.splice(a,1)[0];e.splice(t,0,s)},handleCloseTask:function(){var e=zmsuite.getAppRouter("zm_task");if(!e)return!1;var a=e._hashParams;if(-1!==a.indexOf("t")){var t=a.indexOf("t");"views"===U().selLayerId&&t--,a.splice(t)}e.setParams(a),e.update(),l.deleteState("preview")},getContact:function(e,a,t){var s={zuid:String(e),promise:!1};s.type=zmail.isOrg?"org":void 0;var i=zmail.ContactBook.get(s),o={fn:a,photo:z.get("image","SC-Photo.png")};return i[0]?$.extend(o,i[0].attrs):e===zmail.zuid&&$.extend(o,{fn:zmail.IAMFullName}),t?i[0]:o},getHeaderBandValues:function(e){var a,t,s,i="";return e.categoryId?i=H.getProjectName(e.groupId,e.categoryId):e.groupId&&(i=H.getGroupName(e.groupId)),!e.priority||"getTasksByPriority"!==e.taction&&"getPersonalTasks"!==e.taction?e.status&&"getTasksByStatus"===e.taction||"getPersonalTasks"===e.taction?(s=2===Number(e.status)?R.center.inprogress:3===Number(e.status)?R.center.completed:zmTask.Util.getStatusName(e.groupId,e.status),t=u.applyArgs(R.center.filterBy,{filter:R.center.status})):e.labelName&&"getTasksByLabel"===e.taction?(t=R.center.labeledTasks,s=e.labelName?e.labelName:void 0):("getArchivedTasks"===e.taction||"getTasks"===e.action&&e.archive)&&(t=void 0,s=R.center.archivedTasks):(3===Number(e.priority)?s=R.center.medium:2===Number(e.priority)?s=R.center.high:4===Number(e.priority)&&(s=R.center.low),t=u.applyArgs(R.center.filterBy,{filter:R.center.priority})),e.assigneeId&&(t=u.applyArgs(R.center.filterBy,{filter:R.center.assignee}),s=-1===Number(e.assigneeId)?R.center.unassigned:H.getContact(e.assigneeId).fn),e.userId&&(t=R.center.createdby,s=H.getContact(e.userId).fn),(s||t)&&(a=H.getFilterHeader({filtername:t,filtervalue:s,zuid:e.assigneeId,status:e.status})),{headerValue:i,filterData:a,filterName:t,filterValue:s}},getFilterHeader:function(e){var a="SC_rwToggle SC_tskToggle";3===Number(e.status)&&(a+=" SC_rwWrite");var t=zdom("div",{className:"zmHdrFilt SC_ldot"},e.filtername?zdom("span",{className:"zmHdrFiltLbl"},e.filtername):"",zdom("span",{id:"assigneeFilter",className:"zmHdrFiltVal",contentEditable:"true",style:{width:"auto"}},e.filtervalue),zdom("span",{className:"zmHdrFiltIco"},zdom("i",{id:"clrFilter",className:"msi-close"}))),s=zdom("div",null);if(s.appendChild(t),e.zuid){var i=zdom("div",{"data-readval":"read","data-read":R.center.inprogress,"data-write":R.center.completed,className:a,"data-zuid":e.zuid});s.appendChild(i)}return s},linkify:function(e){var a;return H.checkURLPattern(e)?(a=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,e.replace(a,function(e,a){return arguments[2]?e:arguments[3]?zdom("a",{href:e,target:"_blank",rel:"noopener noreferrer"},e).outerHTML:zdom("a",{href:window.location.protocol+"//"+e,target:"_blank",rel:"noopener noreferrer"},e).outerHTML})):e},checkURLPattern:function(e){if(e){return/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi.test(e)}return!1},getCategory:function(e){return n[e]},getCategoryName:function(e,a){var t=_.find(n[e],function(e){if(e.categoryId===a)return e.categoryName});return t?t.categoryName:""},getRepeatType:function(e){return f.CONSTS.repeatType[e]},getCategoryInfo:function(e,a){var t=_.find(n[e],function(e){if(e.categoryId===a)return e.categoryName});if(t)return{name:t.categoryName}},getStatsHtml:function(e,a){var t=N[e],s=0;s=a?t&&t.mycount.catcount[a]?t.mycount.catcount[a][2]:"0":t&&t.mycount.totalcount?t.mycount.totalcount[2]:"0";var i=R.stats.myOpen+" - ";return zdom("fragment",null,i,zdom("strong",null,s),zdom("i",{className:"msi-barrow"}))},getGroupStats:function(e,a){var t=N[e];return a?!!t&&{mycount:t.mycount.catcount[a],groupcount:t.groupcount.catcount[a]}:!!t&&{mycount:t.mycount.totalcount,groupcount:t.groupcount.totalcount}},bindResizeEvent:function(){$.e(window).on("resize",function(){var e=zmsuite.getCenter("zm_task")[1],a=e?e.$el:void 0;if(a&&a.length&&a.find("div.SC_phd").length){var t=a.find("div.SC_phd").get(0).getBoundingClientRect().height,s=a.find("div.SC_Twpr");s.length&&s.css("top",t+"px")}})},isValidLabel:function(e){var a=u.get("zmTags","tags");return zmUtil.hasSpecialChars(e,"labelName")?(zmUtil.succErrMsg("e",a.errors.specialCharacters),!1):25<e.length?(zmUtil.succErrMsg("e",a.errors.lengthExceeded),!1):"info"===e||"important"===e||"follow-up"===e?(zmUtil.succErrMsg("e",a.errors.retrictedWord),!1):!!e||(zmUtil.succErrMsg("e",a.errors.empty),!1)},moveCursorToEnd:function(e){if(document.createRange){var a=document.createRange();a.selectNodeContents(e),a.collapse(!1);var t=window.getSelection();t.removeAllRanges(),t.addRange(a)}else if(document.selection){var s=document.body.createTextRange();s.moveToElementText(e),s.collapse(!1),s.select()}},getCurrDate:function(){var e=new Date,a=zmTask.Util.getComputedTime();a.tomorrow&&e.setDate(e.getDate()+1);var t=zmTask.Util.convertTimeToMilliseconds(a.time);e.setTime(t);var s=e.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return{dateVal:e,date:s,iamDateFormat:zmTask.Util.getDate(e,x),userFormatDate:zmTask.Util.getDate(e,zmail.userDateFormat),time:zmTask.Util.convertToTwelveHourFormat(a.time)}},setGroupStats:function(e,a){N[e]=a},getMyStats:function(e,a){return e&&a?w[e][a]:e?w[e]:w},setTaskAssignee:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=2<arguments.length?arguments[2]:void 0,s=3<arguments.length?arguments[3]:void 0,i=4<arguments.length?arguments[4]:void 0;if(e){$.e(e).empty();var o,n="ptask"===a.type||"task"===a.type,d=zdom("div",{className:"zmTARBlk"});if(t)if(n){o=zdom("div",{className:"SC_avtr avtrBg"},zdom("img",{src:i})),d.appendChild(zdom("div",null,R.center.assignee));var r=n?"zmTaskAssignee zms_mention zmTaskTitle":"zmTaskAssignee";d.appendChild(zdom("span",{className:r},s))}else o=zdom("div",{className:"SC_avtr avtrBg"},zdom("img",{src:i})),d.appendChild(zdom("span",{className:"zmTaskAssignee"},s));else o=zdom("i",{className:"msi-noAssignee zmDoubleIcon"}),n&&d.appendChild(zdom("div",null,R.center.assignee)),d.appendChild(zdom("em",{className:"greyText"},R.center.unassigned));e.appendChild(o),"assigneeIconOnly"in a||e.appendChild(d)}},updateStats:function(e,a,t,s){var i,o,n,d,r=N[t];if("status"===e&&r.mycount&&r.mycount.totalcount&&r.mycount.catcount)return n=r.mycount.totalcount[2],d=r.mycount.totalcount[3],3===Number(a)?(r.mycount.totalcount[2]=0<n?--n:0,r.mycount.totalcount[3]=++d,"-1"!==s&&r.mycount.catcount[s]&&(i=r.mycount.catcount[s][2],o=r.mycount.catcount[s][3],r.mycount.catcount[s][2]=0<i?--i:0,r.mycount.catcount[s][3]=++o)):(r.mycount.totalcount[2]=++n,r.mycount.totalcount[3]=0<d?--d:0,"-1"!==s&&r.mycount.catcount[s]&&(i=r.mycount.catcount[s][2],o=r.mycount.catcount[s][3],r.mycount.catcount[s][2]=++i,r.mycount.catcount[s][3]=0<o?--o:0)),{group:n,category:i}},getStatusIdList:function(e){var a=[2,3],t=this.getGroupStatus(e);return _.each(t,function(e){a.push(Number(e.statusId))}),a},getGroupStatus:function(e){var a=h[e]||[],t=[];return _.each(a,function(e){e.statusName&&e.statusName.trim().length&&t.push(e)}),t},setGroupStatus:function(e,a){h[e]||(h[e]=[]),h[e].push(a),zmTask.Util.updateStatusOrderToUserSettings(e,a,!0)},getAllDashBoardData:function(){return T},updateStatusOrderToUserSettings:function(s,i,o){zmTask.Util.Req.getUserViewSettings(s,function(e){var a=e.UserGroupSettings||e.CategorySettings,t=_.reject(a,function(e){return"object"!==babelHelpers.typeof(e)});_.each(t,function(e){if("STATUS"===e.ViewId)if(o)e.Order.push(i.statusId),zmTask.Util.Req.setUserViewSettings({ViewId:"STATUS",Order:e.Order},{groupId:s});else{var a=_.map(e.Order,Number).indexOf(Number(i.statusId));0<=a&&(e.Order.splice(a,1),zmTask.Util.Req.setUserViewSettings({ViewId:"STATUS",Order:e.Order},{groupId:s}))}})})},getDefaultStatusList:function(){return[{statusName:R.stats.open,statusId:"2",statusColour:I[2]},{statusName:R.stats.closed,statusId:"3",statusColour:I[3]}]},getGroupStatsCount:function(e){return N[e]},getStatusName:function(e,a){if(2===Number(a))return R.stats.open;if(3===Number(a))return R.stats.closed;if(h[e]){var t=h[e],s=_.find(t,function(e){if(Number(a)===Number(e.statusId))return e.statusName});return s?s.statusName:""}},deleteGroupStatus:function(e,a){var t=h[e];if(t){var s=_.find(t,function(e){if(Number(a)===Number(e.statusId))return e}),i=t.indexOf(s);t.splice(i,1)}},editGroupStatus:function(e,a){var t=h[e];if(t){var s=_.find(t,function(e){if(Number(e.statusId)===Number(a.statusId))return e});s.statusName=a.statusName,s.statusColour=a.statusColour}},getStatusObject:function(e,a){if(2===Number(a))return{statusName:R.stats.open,statusId:2,statusColour:I[a]};if(3===Number(a))return{statusName:R.stats.closed,statusId:3,statusColour:I[a]};if(h[e]){var t=h[e];return _.find(t,function(e){if(Number(a)===Number(e.statusId))return e})}},getCategoryDropDown:function(s){var e=s.groupId,a=zmTask.Util.getCategory(e),t=[];_.each(a,function(e){var a;s.exclude!==e.categoryId&&t.push({dom:(a=e,zdom("div",{className:"zmLbl zmViewLblName","data-cid":a.categoryId},zdom("font",null,a.categoryName))),data:e})});var i={par:s.targetEl,showArrow:s.showArrow,list:t,clk:function(e,a){var t=$.e(a);"LI"===a.nodeName?t=t.find(B):"FONT"!==a.nodeName&&"I"!==a.nodeName||(t=t.closest(B)),t.closest(B).find("i").hasClass("msi-check")||s.callback(e,t)},parWidth:!0};return zmsuite.showMenu(i)},getCustomStatusDropDown:function(i){var e=i.groupId,a=zmTask.Util.getDefaultStatusList(),t=a.concat(zmTask.Util.getGroupStatus(e));t.concat(a);var o=[];_.each(t,function(e){var a,t,s;Number(i.exclude)!==Number(e.statusId)&&o.push({dom:(a=e,t=Number(i.status)===Number(a.statusId)?"msi-check zmLabelBox":"msi-uncheck zmLabelBox",s="background-color:"+a.statusColour.replace("0x","#")+";display: inline-block;width: 15px;height: 15px;margin-right: 7px;vertical-align: middle;",zdom("div",{className:"zmLbl zmViewLblName","data-sid":a.statusId},zdom("i",{className:t,style:s}),zdom("font",null,a.statusName))),data:e})});var s={par:i.targetEl,showArrow:i.showArrow,list:o,clk:function(e,a){var t=$.e(a);"LI"===a.nodeName?t=t.find(B):"FONT"!==a.nodeName&&"I"!==a.nodeName||(t=t.closest(B)),t.closest(B).find("i").hasClass("msi-check")||i.callback(e,t)},parWidth:!0};return zmsuite.showMenu(s)},getCurrentRowObj:function(){var e,a=U(),t=a.selId,s=a.selLayerId,i=a.getNodes()[0].getLayer(s);(i.getListObject()[t]?e=i.getListObject()[t]:_.isEmpty(i.getRowObj(t))||(e=i.getRowObj(t)[t]),e)||(e={type:zmTask.getCurrentList("taskList").listInfo.taction});return e},updateFilterURL:function(e){var a=H.getCurrentRowObj(),t=U().selId,s=zmsuite.getAppRouter("zm_task"),i=[];if("getMyTasks"===a.type?i.push("views","tome"):"getTasksByMe"===a.type?i.push("views","byme"):"getGroupTasks"===a.type&&a.p?i.push(a.p,"category",t):"getGroupTasks"===a.type?i.push(t):"getPersonalTasks"===a.type&&i.push("mytask"),e&&-1!==e.indexOf("t")){var o=s._hashParams;return o.push.apply(o,e),void s.update()}e&&i.push.apply(i,e),s.setParams(i),s.update()},setGroupViewSettings:function(e){var a;if(e.user?k.TOME_PREFERENCE?e.viewLabel&&(a=k[e.viewLabel+"_PREFERENCE"]):(k.TOME_PREFERENCE=e.TOME_PREFERENCE,k.BYME_PREFERENCE=e.BYME_PREFERENCE):e.UserGroupSettings||e.CategorySettings?k[e.group]=e.UserGroupSettings||e.CategorySettings:a=k[e.group],a){a.CurrentView=e.CurrentView||e.ViewId;var t={};_.each(a,function(e,a){_.isObject(e)&&(t[a]=e)});var s=_.keys(t),i=!0,o=!1,n=void 0;try{for(var d,r=s[Symbol.iterator]();!(i=(d=r.next()).done);i=!0){var m=d.value;if(t[m].ViewId===a.CurrentView){a.CurrentViewId=m;break}}}catch(e){o=!0,n=e}finally{try{i||null==r.return||r.return()}finally{if(o)throw n}}if(a.CurrentViewId&&t[a.CurrentViewId].ViewId!==a.CurrentView){var l=1<s.length?Number(s[s.length-1]):Number(s[0]);a[l+1]={Order:e.Order||[],IsAscending:!1,ViewId:a.CurrentView},a.CurrentViewId=l+1}a.CurrentViewId&&a[a.CurrentViewId].ViewId===a.CurrentView&&(a[a.CurrentViewId].Order=e.Order)}},getGroupViewSettings:function(e,a){var t;"category"===a?a="section":"duedate"===a&&(a="due_date");var s,i=U().selId;if(-1!==i.indexOf(H.TOMEID))t=k.TOME_PREFERENCE;else if(-1!==i.indexOf(H.BYMEID))t=k.BYME_PREFERENCE;else{var o=e.groupId;t=k[o]}return!a&&t&&t.CurrentViewId?(s=t[t.CurrentViewId],s=e.categoryId&&"1"===t.CurrentViewId?t[6]:s):(_.each(t,function(e){"object"===babelHelpers.typeof(e)&&(e.ViewId.toLowerCase()===a.toLowerCase()&&(s=e))}),s)},getStoredUserViewPreference:function(e){return"getMyTasks"===e?k.TOME_PREFERENCE:k.BYME_PREFERENCE},isGroup:function(e){return!!zmTask.Util.Groups(e)},isPermitted:function(e,a){var t=e.NMSPID||e.groupId;if(zmTask.Util.isDisabledGroup(t))return!1;if("delete"===a){if(e.OWNERID===zmail.zuid||zmTask.Util.isGroup(t)&&zmTask.Util.isGroupOwner(t))return!0}else if("complete"===a){if(e.OWNERID===zmail.zuid||e.ATTENDEEIDS===zmail.zuid||e.ISSUBTASK&&e.PTASKATTENDEE===zmail.zuid)return!0}else if("addsub"===a){if(!e.ISSUBTASK&&!zmTask.Util.isPrivateTask(e.NMSPID))return!0}else if("changeCategory"===a){if(e.assignee===zmail.zuid||e.owner===zmail.zuid)return!0}else if("editStatus"===a)return zmTask.Util.isGroupOwner(t);return!1},isValidProject:function(e,a){var t=e;if(t=t.trim(),zmUtil.hasSpecialChars(t))return zmUtil.succErrMsg("e",R.errorMsg.splChar),!1;if("null"===t||""===t)return zmUtil.succErrMsg("e",R.errorMsg.nullChar),!1;for(var s=n[a],i=0,o=s.length;i<o;i++)if(s[i].categoryName===t)return zmUtil.succErrMsg("e",R.errorMsg.nameExits),!1;return!0},addEditProject:function(e,a,t){var s={},i={};"deleteCategory"===a?(s={groupId:e.wsId,taction:a,actionType:"deleteCommonLabel"},i={taction:a,groupId:e.wsId},s.categoryId=i.categoryId=e.rowObj.id,zmTask.Util.Req.addEditProjReq(s,i)):zmTask.Util.isValidProject(t,e.wsId)&&(s={groupId:e.wsId,categoryName:t,taction:a,actionType:"addCommonLabel"},i={taction:a,groupId:e.wsId,categoryName:t},"editCategory"===a&&(s.categoryId=i.categoryId=e.rowObj.id,s.actionType="editCommonLabel"),zmTask.Util.Req.addEditProjReq(s,i))},getGeneralCategory:function(e){return _.find(n[e],function(e){return"General"===e.categoryName})},bindReorder:function(a){var t={groupId:a.groupId},s={entityId:a.entityId,source:a.source,groupId:a.groupId};(new zmail.dndComp.SortableDND).init(a.container,{sortableIdentifier:a.identifier,onDropOver:function(){var e=a.callback();t.posArray=s.posArray=e.join(","),zmTask.Util.Req.sendReorderRequest(t,s,function(e,a){$.publish("/zm/task/reorder",[e,a])},function(e,a){})},sortType:"vertical"})},isStatusAlreadyExists:function(e,a){var t=h[e]||[];return!!_.find(t,function(e){return e.statusName===a})},isGroupStatus:function(e,a){var t=h[e]||[];return!!_.find(t,function(e){return Number(e.statusId)===Number(a)})},checkCategoryNameChange:function(e,a){zmTask.Util.addEditProject({wsId:e.data.groupId},e.action,a)},exportTask:function(){for(var e=arguments.length,a=new Array(e),t=0;t<e;t++)a[t]=arguments[t];var s={entityId:a[0],taction:"exportTask"};a[1]&&(s.groupIds=a[1]),a[2]&&(s.groupId=a[2]),zmUtil.secureDownloader().then(function(e){e.password&&(s.password=e.password),zmUtil.isAnyMenuOpen()&&zmUtil.hideMenu(),zmTask.Util.Req.getAllProjects(s,void 0,function(e){zmUtil.succErrMsg("s",R.center.exportTaskNotif),"function"==typeof a[3]&&a[3](e)},function(e){zmUtil.succErrMsg("e",e.msg),"function"==typeof a[3]&&a[3](e)})})},isGroupBasedView:function(e,a){return"getMyTasks"===a.taction||"getTasksByMe"===a.taction||"GROUP"===e.ViewId},getSelectedListing:function(){var e=H.getCurrentRowObj(),a=U(),t={taction:e.type};return e.p?(t.groupId=e.p,t.categoryId=e.id):-1===String(e.id).indexOf(H.TOMEID)&&-1===String(e.id).indexOf(H.BYMEID)&&(t.groupId=e.id),"zmllabelH"===a.selLayerId&&(t.taction="getTasksByLabel",t.labelId=e.labelId,t.groupId=zmail.zuid),{param:t,eparam:$.extend({selRow:a.selId,layerId:a.layerId},t)}},isIntegrationEnabled:function(t){return new Promise(function(e,a){zmAppLoader.load("taskIntegration").done(function(){zmTask.AppsIntegration.isIntegrationEnabled(t)?e():a()})})},getRelativeReminderInfo:function(a){var t={htm:""};return _.each(f.CONSTS.relativeReminders,function(e){e.data.interval===a&&(t=e)}),t},appTypes:{mail:"zohomail",projects:"zohoprojects",crm:"zohocrm",connect:"zohoconnect"},appSectionTypes:{allview:"allappsview",appview:"appview"},convertTimeToMilliseconds:function(e){var a=this.getRailTime(e).split(":"),t=new Date;return t.setHours(a[0]),t.setMinutes(a[1]),t.setSeconds(a[2]),t.getTime()},deleteCustomStatus:function(e){var i=e.grpId,o=e.statusId,s=e.callback,n=e.fallback,a=zmTask.Util.getStatusObject(i,o);if(a){var d,t=u.applyArgs(R.settings.deleteStatusInfo,{status:a.statusName}),r={currentStatus:R.settings.deleteStatus,displayText:t,toStatus:R.settings.moveStatus,selectStatus:R.settings.selectStatus},m=v.deleteCustomStatus(a,r),l=$.e(m).find("div.zmSelect");l.click(function(){var s=this;d=zmTask.Util.getCustomStatusDropDown({groupId:i,targetEl:this,callback:function(e,a){$.e(s).empty(),$.e(s).data("sid",e.statusId);var t={"background-color":e.statusColour};s.appendChild(zdom("span",null,zdom("i",{className:"msi-uncheck zmLabelBox",style:t}),e.statusName)),d.hide()},exclude:o})});var c={title:R.settings.deleteCustomStatus,$content:m,defaultCloseIcon:!1,buttons:[{name:R.settings.delete,callback:function(e){var a=l.data("sid");e.remove(),void 0!==d&&d.hide();var t={taction:"deleteCustomStatus",groupId:i,newstatus:a,status:o};zmTask.Util.Req.sendCustomStatusReq(t,function(e){zmTask.Util.deleteGroupStatus(i,o),$.publish("/zm/task/deleteStatus",[t]),"function"==typeof s&&s()},function(e){zmUtil.succErrMsg("e",e.msg),"function"==typeof n&&n()})}},{isCancel:!0,name:R.common.cancel,callback:function(e){"function"==typeof n&&n(),void 0!==d&&d.hide(),e.remove()}}]};Dialog.new(c).$els.$contentWrapper.click(function(e){var a=$.e(e.target);void 0!==d&&0===a.closest("div.zmSelect").length&&d.hide()})}else"function"==typeof n&&n()},taskEvents:M,getFormattedDate:function(e){if(!e)return"";var a=new Date(Number(e)),t=new Date,s=a.getFullYear()===t.getFullYear()?"dd MMM":"dd MMM YY";return zmTask.Util.getDate(a,s)},taskDateFormat:x};return window.zmTask=window.zmTask||{},window.zmTask.Util=H}),define([],function(){var e=zmail.Core.Namespaces.get("zmail.DataLayer").Adapter.HTTPAdapter;zmTask.Adapter=zmTask.Adapter||{};var a=function(e){function a(){return babelHelpers.classCallCheck(this,a),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).apply(this,arguments))}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"getUrl",value:function(){return zmail.conPath+"/taskView.do"}},{key:"getDefaultRequestMethods",value:function(){return{create:"POST",update:"POST",patch:"POST",delete:"POST",read:"GET"}}},{key:"serialize",value:function(e,a,t){var s={streamsView:!0,entityType:3};return"fetchSubtask"===e?(s.taction="getSubTasks",s.actionType="appView",$.extend(s,t.param)):"scrollList"===e?(s.actionType="appView",zmTask.Models.Listing.Collection&&a instanceof zmTask.Models.Listing.Collection&&a.getScrollParams(s),$.extend(s,t.param)):"fetchTaskList"===e?(s.actionType="appView",s.isPrev=!1,s.limit=20,$.extend(s,t.param)):"update"===e||"deleteTask"===e||"restoreTask"===e||"bulkActions"===e||"delete"===e||"archiveTask"===e||"changeStatus"===e||"unArchiveTask"===e||"reorderSubtasks"===e||"saveTitle"===e?s=t.param:"duedateList"===e?($.extend(s,t.param),s.taction="getTasksSortedByDueDate",s.isPrev=!0,s.limit=20,s.actionType="appView",t.scroll&&("1"===t.page.showNextPage&&(s.start=t.page.endTime?t.page.endTime:t.length),s.next=20)):$.extend(s,t.param),t.url&&-1!==t.url.indexOf("taskGet.do")&&(s.action=s.taction,delete s.taction),s}},{key:"normalize",value:function(e,a,t){return{}}}]),a}(e);return zmTask.Adapter.HTTPAdapter=a}),define([],function(){var a;zmTask.Models=zmTask.Models||{};return zmTask.taskListCollection=function(e){if(zmTask.Models.Listing){var a=zmTask.Models.Listing.Collection,t={adapters:[{id:"http-adapter",type:"default",classObj:zmTask.Adapter.HTTPAdapter}],default:"http-adapter"},s=ZMStore.getInstance(e);return s?s.resetCollection():s=ZMStore.createInstance(e,a,{adapterConfig:t}),s}},zmTask.newListCollection=function(e){var a=zmTask.Models.Listing.ListCollection,t={adapters:[{id:"http-adapter",type:"default",classObj:zmTask.Adapter.HTTPAdapter}],default:"http-adapter"},s=ZMStore.getInstance(e);return s?s.resetCollection():s=ZMStore.createInstance(e,a,{adapterConfig:t}),s},zmTask.taskBoardCollection=function(e){var a=zmTask.Models.Listing.BoardCollection,t={adapters:[{id:"http-adapter",type:"default",classObj:zmTask.Adapter.HTTPAdapter}],default:"http-adapter"},s=ZMStore.getInstance(e);return s?s.resetCollection():s=ZMStore.createInstance(e,a,{adapterConfig:t}),s},zmTask.getCollectionType=function(){return a},zmTask.setCollectionType=function(e){a=e},zmTask.getActiveList=function(e){return ZMStore.getInstance(e)},zmTask.getCurrentList=function(e){var a=ZMStore.getInstance(e);return a||("newtasklist"===e?zmTask.newListCollection(e):"boardView"===e?zmTask.taskBoardCollection(e):zmTask.taskListCollection(e))},zmTask.previewCollection=function(){var e=zmTask.Models.PreviewCollection,a={adapters:[{id:"http-adapter",type:"default",classObj:zmTask.Adapter.HTTPAdapter}],default:"http-adapter"},t=ZMStore.getInstance("preview");return t?t.resetCollection():t=ZMStore.createInstance("preview",e,{adapterConfig:a}),t.initialize(),t},zmTask.deleteCollection=function(e){ZMStore.deleteInstance(e)},{}});var parentCls=zmail.dndComp.SortableDND,TaskSorting=function(e){function t(){var e;babelHelpers.classCallCheck(this,t),e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));var a=babelHelpers.assertThisInitialized(e);return a.allowSortableInsideParent=!0,a.parentNode=null,a.copyNode=null,a.sourceNode=null,e}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"initialize",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};a.hasOwnProperty("allowSortableInsideParent")&&(this.allowSortableInsideParent=a.allowSortableInsideParent),this.init(e,a)}},{key:"setDragInstance",value:function(e){var a=this;if("function"!=typeof a.getDragInstance)return{setDrag:!0,element:$(e.target).closest(".".concat(a.sortableIdentifier))[0],draggedClassName:a.sortableIdentifier};var t=a.getDragInstance(e);return t.allowDrag?(a.placeHolderRef=t.placeHolderRef,a.sortableIdentifier=t.sortableIdentifier,{setDrag:!0,element:t.element,draggedClassName:a.sortableIdentifier}):{setDrag:!1}}},{key:"dragStart",value:function(e){var a=this,t={node:a.element,target:e};a.setDragInstance(t),"function"==typeof a.sortDragStart&&a.sortDragStart(e);var s=a.sortableIdentifier.split(" ")[0],i=$(e).closest(".".concat(s));return a.draggedNode=i,setTimeout(function(){a.draggedNode[0].style.visibility="hidden"},0),{disableGhostImage:!0,allowDrag:!0,ghostImage:!0,type:"type",id:"Sortable"}}},{key:"dragoverDetailsVertical",value:function(e,a,t){var s,i=this;if(i.parentNode=e.parent,i.sourceNode=e.sourceElem,"Sortable"!==e.id||"horizontal"===a.dragType)return!1;if("function"==typeof i.sortableDragOverDetails&&i.sortableDragOverDetails(e,a,t),$.e(a.target).closest(".".concat(i.sortableIdentifier))[0]&&(s=$.e(a.target).closest(".".concat(i.sortableIdentifier)),i.draggedNode[0]===s[0]))return!1;if(void 0!==s&&s&&s!==i.draggedNode[0]){if(!i.allowSortableInsideParent&&e.parent===s[0].parentElement)return!0;i.draggedNode[0].getBoundingClientRect().top<a.clientY?i.placeHolderRefPos!==$.e(s).prevAll().length+1&&($.e(i.placeHolderRef).insertAfter(s),i.placeHolderRefPos=$.e(i.placeHolderRef).prevAll().length,$.e(s).insertBefore(i.draggedNode),i.afterSortable&&i.afterSortable(s[0],i.draggedNode[0])):i.placeHolderRefPos!==$.e(s).prevAll().length-1&&($.e(i.placeHolderRef).insertBefore(s),$.e(s).insertAfter(i.draggedNode),i.placeHolderRefPos=$.e(i.placeHolderRef).prevAll().length,i.afterSortable&&i.afterSortable(i.draggedNode[0],s[0]))}}},{key:"dragoverDetailsHorizontal",value:function(e,a,t){var s,i=this;if(i.copyNode=document.createElement("div"),i.copyNode.id="copyNode",i.parentNode=e.parent,i.sourceNode=e.sourceElem,i.copyNode.style.width=e.width+"px",i.copyNode.style.height=e.height+"px",i.copyNode.style.border="2px dotted blue","Sortable"!==e.id)return!1;if("function"==typeof i.sortableDragOverDetails&&i.sortableDragOverDetails(e,a,t),$.e(a.target).closest(".".concat(i.sortableIdentifier))[0]&&(s=$.e(a.target).closest(".".concat(i.sortableIdentifier)),i.draggedNode[0]===s[0]))return!1;if(void 0!==s&&s&&s!==i.draggedNode[0]){if(!i.allowSortableInsideParent&&e.parent===s[0].parentElement)return!0;if(!i.allowSortableInsideParent)if(!$.e(e.parent).find("#copyNode")[0]){var o=e.parent.children[e.index];o.parentNode.insertBefore(i.copyNode,o)}i.draggedNode[0].getBoundingClientRect().left<a.clientX?$.e(i.draggedNode).insertAfter(s):$.e(i.draggedNode).insertBefore(s)}}},{key:"dragover",value:function(e){var a=this;if("function"!=typeof a.dragOverDecider)return{allowDragOver:!0};var t=a.dragOverDecider(a.draggedNode[0],e);t.hasOwnProperty("allowSortableInsideParent")?a.allowSortableInsideParent=t.allowSortableInsideParent:a.allowSortableInsideParent=!0,a.parentNode=a.draggedNode[0].parentElement;var s=t.dragOverDirection,i=a.dragoverDetailsVertical.bind(a);return"horizontal"===s&&(i=a.dragoverDetailsHorizontal.bind(a)),{allowDragOver:!0,dragoverCallback:i}}},{key:"onDrop",value:function(e){var a=this;if(a.draggedNode&&a.draggedNode[0].style.removeProperty("visibility"),a.onDropOver&&a.onDropOver(e),$.q("#".concat(a.placeHolderId)).remove(),(e.target===a.parentNode||e.target.parentElement===a.parentNode)&&!a.allowSortableInsideParent){var t=a.parentNode.children[e.dragObj.index];t.parentNode.insertBefore(a.sourceNode,t)}var s=$.e(a.parentNode).find("#copyNode");$.e(s).remove()}}]),t}(parentCls);window.zmTask=window.zmTask||{},window.zmTask.Sorting=TaskSorting;