"use strict";!function(){var e=zmail.Core.Namespaces,v=zmail.Utils.DOM,p=e.create("zmlab"),h=zmText.get("zmTags","tags"),z="#96ccf5",g="#zm_createlabelpopup",o=function(e,l){var a=zmInit.getListingDetObj();!function(e,l){var a,t,i=zmUtil.getMailCollection();for(t in i){a=zmUtil.getMailObj(t);var o=$.inArray(String(e),a.TAG||[]),r=$.inArray(String(e),a.TTAGS||[]);-1!==o&&("del"===l&&a.TAG.splice(o,1),zmPreviewTemplate.refreshLabelsForMail(t)),-1!==r&&("del"===l&&a.TTAGS.splice(o,1),zmPreviewTemplate.refreshLabelsForMail(t))}}(e,l),a.label===e&&("del"===l&&(""!==a.fId?zmInit.foldView({folId:a.fId,reInitialize:!0}):(zmInit.foldView({folId:zmail.folId.iId,reInitialize:!0}),zmail.mailLeft.selRow(String(zmail.folId.iId),"zmlTreeH"))),ZMail.topbar.header.renovate())},m=function(e){if(e&&e.id){var l,a,t=e.id,i="zmllabelH";l=zmail.mailLeft.getNodes()[0].getLayer(i),a=zmList.getRowInfo(t,i),o(t,"del"),$.publish("label/deleted",{labelID:t,info:{labelId:t},mode:"d"}),l.deleteNode(a)}else e.e&&zmUtil.succErrMsg("e",h.errors.processError)},s=function(e,l){var a,t,i,o,r,c,n,d,m="zmllabelH",s=zmail.labInfo,b="",f="";if("default"===l.accType&&zmail.accId!==zmail.defAccId&&(s=zmUtil.getTagList(l.accType)),e.e)zmUtil.succErrMsg("e",h.errors.processError);else{n=e.labelId||e.id,"a"===l.mode&&($.isEmptyObject(s)&&v.show(v.selector("#zmllabelH .SC_ltl .SC_frt")),s[n]={}),i=s[n].system||"0",o=s[n].shId||"-1";var u=s[n]?s[n].se:Object.keys(s).length;if(s[n]={color:e.color||e.c,id:e.labelId||e.id,label:e.displayName||e.n,dispName:e.displayName||e.n,fav:"true",system:i,shId:o},"a"===l.mode&&$.publish("label/added",{label:s[n],labId:e.id,mode:"a",info:e,accType:l.accType}),zmail.mailLeft){if(a=zmail.mailLeft.getNodes()[0].getLayer(m),(t=zmList.getRowInfo(n,m))[n]||"default"!==l.accType||(t={}),1!==(c=e.sequence||e.seq)){var p=v.selector("#zmllabel #".concat(n)).prev();p.length&&(f=p.attr("id"))}if("e"===l.mode)if(c=u,$.publish("label/renamed",{label:s[n],info:e,labId:n,mode:l.mode}),"m"===zmApp.currentApp){var z=zmLHS.getModel("zmllabelH",e.labelId).attributes;c=(z=$.extend({},z)).seq,z.color=e.color,z.text=e.displayName||e.n,z.title=e.displayName||e.n,zmLHS.updateCollection("zmllabelH","update",z)}else a.deleteNode(t)}try{for(r in t){t[r].label=e.displayName||e.n,t[r].color=e.color||e.c,t[r].dispName=e.displayName||e.n;break}}catch(e){}for(d=Object.keys(s),r=0;r<d.length;r++)if(d[r]===(e.labelId||e.id)){c=r+1;break}var g=e.sequence||e.seq;"a"===l.mode&&g<c&&(c=g);var I="#zmllabel .zmTreeNode";if("undefined"!=typeof zmApp&&"m"===zmApp.currentApp){if(c||(c=1),"e"===l.mode&&(c=u),("default"!==l.accType||zmail.accId===zmail.defAccId)&&"a"===l.mode){var L={color:e.color||e.c,id:e.labelId||e.id,seq:c,text:e.displayName||e.n,title:e.displayName||e.n,visible:!0};zmLHS.updateCollection("zmllabelH","add",L)}}else zmail.mailLeft&&!$.isEmptyObject(t)&&(1!==c||v.selector(I).length?1===c?(b=v.selector(I).eq(0).attr("id"),a.insertNodeBefore(t,a.mapObject,b)):((b=v.selector(I).eq(c-2).attr("id"))||(b=f),b?a.insertNodeAfter(t,a.mapObject,b):a.prependNode(t,a.mapObject)):(b="zmllabel",a.appendNode(t,a.mapObject)));s[n].se=c,zmail.accId===zmail.defAccId&&(zmail.labInfo=s,zmail.zohoAccLabInfo=$.extend({},s))}l.reqDoneClbk&&l.reqDoneClbk(!e.e,n)},I=function(e,l,a,t){var i,o,r={mode:e,accType:a},c={accId:zmail.accId,mode:e},n=zmail.labInfo,d=s;"default"===a&&(n=zmUtil.getTagList(a),void 0!==zmail.defAccId?c.accId=zmail.defAccId:c.accId=(o=zmail.aInfo,Object.keys(o).forEach(function(e){"1"===o[e].accountType&&(i=e)}),i)),"d"!==e&&"m"!==e&&(c.name=l,c.color="e"!==e?t.color||z:n[p.labelId].color),"a"!==e&&"m"!==e&&(c.labId=p.labelId),"d"===e?d=m:"m"===e&&(c.labIdArr=t.labIdArr,d=""),t&&"function"==typeof t.reqDoneClbk&&(r.reqDoneClbk=t.reqDoneClbk),zmAjq.XHR({u:"".concat(zmail.conPath,"/lA.do"),t:"POST",fn:d,p:c,csr:"s",ep:r})},L=function(e){var l,a,t,i=document.createDocumentFragment();for(e=e||{},t=(l=["#e5e5e5","#f9baab","#f9d3a2","#fef86a","#d7f3b0","#c8e5fb","#e0ceef","#f6d0e6","#c4c4c4","#e07861","#ecb772","#f6e565","#badf88","#96ccf5","#b99fce","#e099c2","#808080","#ce232c","#dd902f","#d0c04b","#90ca40","#70abec","#a97ac6","#c26a9d","#000000","#9d1812","#a56016","#a69646","#5b8828","#4c76a2","#8343a0","#ba3682"]).length,a=0;a<t;a++){var o=[];l[a]===e.selColor&&o.push("sel"),"#000000"===l[a]&&o.push("black"),o=o.join(" "),v.mount(zdom("div",{className:o,style:{backgroundColor:l[a]}}),i)}return i},t={DEFAULT_COLOR:z,labelId:"",labelmov:function(e,l,a){var t,i,o,r,c,n=[];if(0===zmail.mailOpt.labSort){if(!a.id||"zmllabelH"!==a.id)for(i in a)c=i;for((r=zmail.mailLeft.getNodes()[0].getLayer("zmllabelH")).moveNode(l,r.mapObject,c),o=(t=v.selector(".zmTreeNode",v.selector("#zmllabel"))).length,i=0;i<o;i++)n.push(t[i].id);I(e,"","",{labIdArr:n})}},labelCreate:function(e,l,a){I("a",e,l,a)},labelreq:function(e,l,a){var t="",i=v.selector("#".concat(l));"d"!==e&&(t=$.trim(v.getText(i))),(t.length||"d"===e)&&I(e,t),"e"!==e||a||(v.clearHTML(i),v.setText(i,h.labels.editTag),v.setAttribute(i,"contentEditable",!1))},isValidLabel:function(e,l){var a=$.trim(v.getText(v.selector("#".concat(e))).toLowerCase());return!!t.isValidName(a,l)||(v.focus(v.selector("#".concat(e))),!1)},isValidName:function(e,l,a,t){var i,o=zmail.labInfo;if("default"===a&&(o=zmUtil.getTagList(a)),!(e=$.trim(e.toLowerCase())).length)return zmUtil.succErrMsg("e",h.errors.empty,t),!1;if(zmUtil.hasSpecialChars(e,"labelName"))return zmUtil.succErrMsg("e",h.errors.specialCharacters,t),!1;if(25<e.length)return zmUtil.succErrMsg("e",h.errors.lengthExceeded,t),!1;if("info"===e||"important"===e||"follow-up"===e)return zmUtil.succErrMsg("e",h.errors.retrictedWord,t),!1;for(i in o)if(("rename"!==l||p.labelId!==i)&&o[i].label.toLowerCase()===e)return zmUtil.succErrMsg("e",h.errors.exists,t),!1;return!0},createColorPicker:function(e,l){var a;if(a=L(),void 0!==l&&l.getSkeleton)return a;p.labelId=e.parent()[0].id,zmsuite.showMenu({par:e,list:[{htm:a}],align:"colorpicker",ulClass:"SC_cp",clk:function(e,l){"DIV"===l.tagName&&(p.updateLabColor(e,l),zmUtil.hideMenu())}})},updateLabColor:function(e,l){var a=v.element(l);zmail.labInfo[p.labelId].color=p.convertRGBtoHex(v.getStyle(a,"background-color")),zmail.zohoAccLabInfo[p.labelId]&&(zmail.zohoAccLabInfo[p.labelId].color=zmail.labInfo[p.labelId].color),p.labelreq("e",p.labelId,!0)},convertRGBtoHex:function(e){var l;if(e.includes("rgb")){l=(e=e.replace(/rgb\(|\)/g,"").split(",")).length;for(var a=0;a<l;a++)e[a]=parseInt(e[a]).toString(16),e[a]=1===e[a].length?"0".concat(e[a]):e[a];e="#".concat(e.join(""))}return e},labelSelectionInfo:function(e){var l=e.type,a=e.list,t=[],i={},o=[];if("selected"===l)(o=zmUtil.getSelectedMails())[0].forEach(function(e){t.push({id:e,ttag:!1})}),o[1].forEach(function(e){t.push({id:e,ttag:!0})});else{if("list"!==l)return;t=a}if(1<=t.length){var r,c=(t[0].ttag?zmUtil.getMailObj(t[0].id,"TTAGS"):zmUtil.getMailObj(t[0].id,"TAG"))||[];for(r in zmail.labInfo)-1!==$.inArray(r,c)&&(i[r]="check");if(1<t.length)for(var n=1,d=t.length;n<d;n++)for(r in c=(t[n].ttag?zmUtil.getMailObj(t[n].id,"TTAGS"):zmUtil.getMailObj(t[n].id,"TAG"))||[],zmail.labInfo)-1!==$.inArray(r,c)?i[r]||(i[r]="partial"):i[r]&&(i[r]="partial")}return i},labelMenuHadler:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"a",l=v.element(this.activeMenu.activeMenuElement),a=l[0].id;return p.isValidLabel(a,"add")?(p.labelreq(e,a),!0):(l.focus(),!1)},showCreateTagPopUp:function(l){var e,a,t,i,o,r,c,n,d,m,s,b,f,u="";n=(l=l||{}).accType||"",m=zmUtil.getTagList(n),i=l.mode||"new",s=zmsuite.getAppLeft().getNodes()[0].getLayer("zmllabelH").el,b=(d=v.selector(".zmLHSWra")).offset().left+d.width(),0<(o=(f=s.position().top<0?v.selector(".zmNewBtn").offset().top:s.offset().top)+350-v.element(document.body).height())&&(f-=o),"rename"===i?(t=h.labels.editTag,u=m[p.labelId].label,c=m[p.labelId].color):"new"===i&&(t=h.labels.createTag,c=z),e={title:t,style:{width:"".concat(200,"px"),"min-width":"168px","max-width":"168px"},posParent:{top:"".concat(f,"px"),left:"".concat(b,"px")},customClass:"noanim",buttons:[{txt:h.labels.save,selected:!0,callback:function(){var e;e=$.q(g).find("input:first").val(),l.callback?l.callback("a",e,c):p.isValidName(e,i,n,{parElem:v.element(v.selector(g),!0)})&&("new"===i?I("a",e,n,{color:c}):"rename"===i&&(m[p.labelId].color=c,I("e",e,n,{color:c})),zmsDialog.remove())}},{isCancel:!0,txt:h.labels.cancel,callback:function(){zmsDialog.remove()}}],closeaction:function(){v.unmount(v.selector(g),!0)},afterDisplay:function(){v.focus(v.selector("input",v.selector(g)))}},r=L({selColor:c}),a=v.element(zdom("div",{id:"zm_createlabelpopup"},zdom("ul",{className:"tempFormList"},zdom("li",null,zdom("input",{type:"text",maxLength:"25",className:"SC_tiput","data-enableshortcuts":"true",placeholder:h.labels.tagName})),zdom("li",null,zdom("div",null,h.labels.tagColor),zdom("ul",{className:"SC_cp"},zdom("li",null)))))),v.mount(r,v.selector("ul.SC_cp li",a)),a.find("input").val(u),a.find(".SC_cp").on("click","div",function(e){var l;zmUtil.stopEvents(e,!0),l=e.target||e.srcElement,l=v.element(l),c=l.css("background-color"),c=p.convertRGBtoHex(c),v.selector(g).find(".sel").removeClass("sel black"),l.addClass("sel"),"#000000"===c&&l.addClass("black")}),v.selector(g).length||v.mount(a,document.body),"fr"===zmail.user.lang&&(e.style["max-width"]="200px"),zmsDialog.create("zm_createlabelpopup",e),v.selector("#zmsdialog_zm_createlabelpopup").mousedown(function(e){zmUtil.stopEvents(e,!0)}),v.selector("#zmsdialog_zm_createlabelpopup").click(function(){zmUtil.hideMenu(!1,!0)})}};zmComponent&&zmComponent.notifier&&!1===zmUtil.isChildWindow()&&zmComponent.notifier.addHandler("mail",function(e,l){var a=_zm.getProperty(l,"data.act"),t=_zm.getProperty(l,"data.data");if(a&&t){if("ADD_LABEL"!==a&&"UPDATE_LABEL"!==a||t.AID!==zmail.accId)"DELETE_LABEL"===a&&_zm.getProperty(l,"data.AID")===zmail.accId&&m({id:t.LID});else{var i={color:t.LC,id:t.LID,label:t.LN,dispName:t.LN,fav:"true",displayName:t.LN,labelId:t.LID,seq:parseInt(t.SQ),sequence:parseInt(t.SQ)};s(i,{mode:{ADD_LABEL:"a",UPDATE_LABEL:"e"}[a]})}}}),p.showCreateTagPopUp=t.showCreateTagPopUp,p.createLabel=I,$.extend(!0,p,t);var i,r=zmText.get("zmTags"),l=function(e,l){var a=l.mode,t=l.accType,i=(l=l.info).labelId,o={};if(o[i]={color:l.color,id:l.labelId,label:l.displayName,dispName:l.displayName,fav:"true",se:l.sequence},"undefined"==typeof zmLHS||zmLHS.currentList&&!zmLHS.currentList.zmllabelH)return!1;if("a"===a){if("default"===t&&zmail.accId!==zmail.defAccId)return 0;var r=0;if(l.sequence&&(r=l.sequence-1),1<zmLHS.currentList.zmllabelH.models.length&&!l.sequence)r=zmLHS.currentList.zmllabelH.models[zmLHS.currentList.zmllabelH.models.length-1].attributes.seq+1;var c={id:i,color:o[i].color,text:o[i].dispName,title:o[i].dispName,seq:r};zmLHS.updateCollection("zmllabelH","add",c)}else if("e"===a){var n={};Object.assign(n,zmLHS.getModel("zmllabelH",i).attributes,{color:o[i].color,text:o[i].dispName,title:o[i].dispName}),zmLHS.updateCollection("zmllabelH","update",n)}else"d"===a&&zmLHS.updateCollection("zmllabelH","remove",{id:i})},c=[{txt:r.tags.labels.editTag,id:"zmLHS-editLabel",data:{action:"EditLabel"}},{txt:r.tags.labels.deleteTag,id:"zmLHS-deleteLabel",data:{action:"DelLabel"}}],n=function(e,l){zmUtil.hideMenu(),zmlab.labelId=i,"EditLabel"===l.action?zmlab.showCreateTagPopUp({mode:"rename",accType:"default"}):"DelLabel"===l.action&&Dialog.confirm(r.tags.labels.deleteConfirmText,function(){zmlab.createLabel("d",{},"default")})};$.subscribe("label/renamed",l),$.subscribe("label/deleted",l),$.subscribe("label/added",l);var a=function(){zmlab.showCreateTagPopUp({mode:"new",accType:"default"})};window.zmTags={handleRightClick:function(e){if("header"!==e.zmsData.rowInfo.type){for(var l in e.zmsData.rowObject){i=e.zmsData.rowObject[l].id;break}if(zmUtil.isSystemLabel(i))return!1;var a={clk:n,divId:"znCntxtMenu",conArr:c};zmsuite.showContextMenu(e.event,a)}},createTagLayer:function(e){var l=e.accType;l=l||"default";var a={name:r.tags.labels.tag,showList:!0},t=new ZMLayer,i={type:"2",mapObject:{name:"dispName",id:"id",count:"c",parentId:"p",color:"color",sequence:"se",infoObject:"l"},listId:"zmllabel",id:"zmllabelH",showList:!0,dataObject:{headerObject:a,listObject:zmUtil.getTagList(l)}};return t.setHeaderObject(a),t.push(i),t},addTag:a},$.extend(!0,zmlab,t)}(),window.__rollupModule=void 0;