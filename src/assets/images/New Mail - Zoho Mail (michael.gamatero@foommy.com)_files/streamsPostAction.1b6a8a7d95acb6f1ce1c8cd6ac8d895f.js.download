"use strict";!function(){var d=zmText.get("streams"),i=function(e){var t,i=String(e.by),s=e.likes,a=e.shGroup;t=s,t=parseInt(t),s=t=!isNaN(t)&&0<t?t:"";var n="msi-love zmAMIcon";e.like&&(n+=" zmThmClr");var r="msi-Ainvitee zmAMIcon zmInviteeClr";e.lockInvites&&(r="msi-Dinvitee zmAMIcon");var l=d.common.labels.sendPrivateOwner,o=e.pvtcmts&&e.pvtcmts.privateToPost,m=d.common.labels.showPrivateComments,c=e.inviteeList;c&&!_.isArray(c)&&(c=Object.keys(c));var p=c.length,u=!1===e.lockInvites||e.isOwner||zmail.zuid===e.by;return zdom("div",{className:"SCSpostAct"},zdom("div",{className:"zmPostActions"},zdom("div",{className:"zmAMB"},zdom("ul",{className:"zmAMG "},zdom("li",{className:"zmAMItem zmAMsmall"},zdom("div",{className:"zmAMWra"},zdom("i",{className:n})),0<s&&zdom("div",{className:"zmAMmWra zmThmClr"},s)),zdom("li",{className:"zmAMItem zmAMsmall zmAMSepDot"},zdom("div",{className:"zmAMWra"},zdom("i",{className:r}))))),0<p&&!e.isPrint&&zdom("zmfrag",null,zdom("span",{className:"zmSDot"}),function(e,t){var i,s,a,n=[],r=0,l=zmStreamsApp.util.getContactDetails(e);for(var o in t&&!$.isEmptyObject(t)&&(n=_.pluck(t,"id")),i=(s=zdom("ul",{className:"zmInvitedList"},zdom("li",null))).children[0],l)if((a=l[o]).isDummyObj&&-1!==n.indexOf(o)&&(a.avatar=zmStreamsApp.util.generateAvatarTemp(l[o].fn)),i.appendChild(a.avatar),3==++r)break;return s}(c,a)),(u||0<p||e.isPrint)&&zdom("div",{className:"zmAMB"},zdom("ul",{className:"zmAMG "},zdom("li",{className:"zmAMItem zmAMTextItem zmAMsmall zmThmClr"},zdom("div",{className:"zmAMWra"},u&&!e.isPrint&&zdom("i",{className:"msi-plus zmAMIcon"}),(3<p||e.isPrint)&&zdom("div",{className:"zmAMText"},e.isPrint?p:p-3))))),_zm.isStreamsEnabled()&&"13"!==e.etype&&!e.isPrint&&zdom("span",{className:"zmLink zmPvtReply"},o?zdom("zmfrag",null,zdom("i",{className:"msi-comment"}),m):i!==zmail.zuid&&!e.disableComment&&l)))},l=zmText.get("streams"),s=function(e){function i(e){var t;return babelHelpers.classCallCheck(this,i),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e))).state={like:e.model.get("like"),likeCount:e.model.get("likes")},_zm.autoBind(babelHelpers.assertThisInitialized(t),["changeLike","changeLikeCount","updateLike","updateLikeCount"]),t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"changeLike",value:function(){this.setState(function(e,t){return{like:t.model.get("like")}})}},{key:"changeLikeCount",value:function(){this.setState(function(e,t){return{likeCount:t.model.get("likes")}})}},{key:"updateLike",value:function(e){var t=$.e(e.currentTarget);if(!t.hasClass("pointerEventsNone")){var i=this.props.model,s=i.get("like"),a=i.get("likes")||0,n=i.get("userLike")||{},r=i.get("likeList")||[];if(a=parseInt(a),s)a-=1,_.size(n)&&(delete n[zmail.zuid],r=_.without(r,zmail.zuid));else{a+=1;var l=zmStreamsApp.util.getContactDetails([zmail.zuid])[zmail.zuid];n[zmail.zuid]=l.fn,r.unshift(zmail.zuid)}a<0&&(a=0),i.updateUserLike(!s),i.updateLikeCount(a),i.updateLikeList(r),i.updateUserList(n),i.like(t)}}},{key:"updateLikeCount",value:function(e){var t=this,i=t.props.model,s=i.get("userLike")||{},a=e.currentTarget,n=_.size(s);n&&i.get("likes")===n?t.showLikeDropDown(a):i.getLikes(a).then(function(){t.showLikeDropDown(a)})}},{key:"showLikeDropDown",value:function(e){var t,i=this.props.model.get("userLike")||{},s=[];for(var a in i)(t=zmStreamsApp.util.getContactDetails([a])[a]).isDummyObj&&(t.fn=i[a]),s.push(t);s.length&&zmStreamsApp.util.createPopup({items:s,parent:e,ulclass:"SC_Pr",parentClass:"SC_Slke",type:"oneLine"})}},{key:"componentDidMount",value:function(){this.props.model.on("change:like",this.changeLike),this.props.model.on("change:likes",this.changeLikeCount)}},{key:"componentWillUnmount",value:function(){this.props.model.off("change:like",this.changeLike),this.props.model.off("change:likes",this.changeLikeCount)}},{key:"render",value:function(){var e=l.streams.tooltip.likePost,t="zmAMItem zmAMsmall";this.state.like&&(e=l.streams.tooltip.unlikePost,t+=" zmThmClr"),0<this.state.likeCount&&(t+=" zmAMTextItem");var i="zmAMWra";return!1!==this.props.model.get("streamsEnabled")&&_zm.isStreamsEnabled()||(i+=" pointerEventsNone"),React.createElement("li",{className:t},React.createElement("div",{className:i,"data-tooltip":e,onClick:this.updateLike},React.createElement("i",{className:"msi-love zmAMIcon"})),0<this.state.likeCount&&React.createElement("div",{className:"zmAMmWra zmThmClr",onClick:this.updateLikeCount},this.state.likeCount))}}]),i}(React.Component),a=function(e){function i(e){var t;return babelHelpers.classCallCheck(this,i),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e))).state={lockValue:e.model.get("lockInvites")},_zm.autoBind(babelHelpers.assertThisInitialized(t),["changeLockIcon","updateLockIcon"]),t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"changeLockIcon",value:function(){var e=this.props.model,t=e.get("id");this.setState({lockValue:e.get("lockInvites")});var i=zmStreamsApp.PostApp?zmStreamsApp.PostApp.models.posts:[];if(_.size(i)&&(i=i.get(t)||{},_.size(i))){i.get("myact").showinvite=e.get("showinvite");var s=i.get("inviteeList")||[];if(Array.isArray(s)||(s=Object.keys(s)),i.get("myact").showinvite)zmStreamsApp.CommentModule.setMentions(t,"org");else{var a=i.get("gnrl");zmStreamsApp.util.getMentionList({group:a.group,inviteeList:s,shGroup:a.shgrp,id:i.get("id"),type:a.type}).then(function(e){zmStreamsApp.CommentModule.setMentions(t,e)})}}e.trigger("change:inviteeList")}},{key:"updateLockIcon",value:function(e){$.e(e.currentTarget).hasClass("zmAMNoHvr")||this.props.model.lockInvites()}},{key:"componentDidMount",value:function(){this.props.model.on("change:lockInvites",this.changeLockIcon)}},{key:"componentWillUnmount",value:function(){this.props.model.off("change:lockInvites",this.changeLockIcon)}},{key:"render",value:function(){var e="msi-Ainvitee zmAMIcon zmInviteeClr",t="zmAMItem zmAMsmall zmAMSepDot";this.state.lockValue&&(e="msi-Dinvitee zmAMIcon");var i="",s=this.props.model;if(!1!==s.get("streamsEnabled")&&_zm.isStreamsEnabled()){var a=s.get("groupId"),n=zmStreamsApp.util.getGroupDetails(a),r=n&&n.moderator&&-1!==n.moderator.indexOf(zmail.zuid);s.get("isOwner")||r||zmail.zuid===s.get("by")?i=this.state.lockValue?l.common.labels.allowInvites:l.common.labels.denyInvites:(t+=" zmAMNoHvr zmAMDCursor",this.state.lockValue&&(i=l.streams.tooltip.ownerdeny))}else t+=" zmAMNoHvr zmAMDCursor",this.state.lockValue&&(i=l.streams.tooltip.ownerdeny);return React.createElement("li",{className:t,onClick:this.updateLockIcon,"data-tooltip":i},React.createElement("div",{className:"zmAMWra"},React.createElement("i",{className:e})))}}]),i}(React.Component),n=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"zmAMB"},React.createElement("ul",{className:"zmAMG "},React.createElement(s,this.props),React.createElement(a,this.props)))}}]),t}(React.Component),m=zmText.get("streams"),r=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"render",value:function(){var e=this.props.model,t=e.get("invitee")||0,i=e.get("showinvite")?m.streams.tooltip.addviewinvite:m.streams.tooltip.viewinvite,s="zmAMItem zmAMsmall zmThmClr";return 3<t&&(s+=" zmAMTextItem"),React.createElement("div",{className:"zmAMB"},React.createElement("ul",{className:"zmAMG "},React.createElement("li",{className:s},React.createElement("div",{className:"zmAMWra","data-tooltip":i,onClick:this.props.onChange},React.createElement("i",{className:"msi-plus zmAMIcon"}),3<t&&React.createElement("div",{className:"zmAMText"},t-3)))))}}]),t}(React.Component),o=function(e){function i(e){var t;return babelHelpers.classCallCheck(this,i),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e))).avatarImg=React.createRef(),_zm.autoBind(babelHelpers.assertThisInitialized(t),["setImage"]),t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"setImage",value:function(){$.e(this.avatarImg.current).clearHTML().appendDOM(this.props.avatar)}},{key:"componentDidUpdate",value:function(){this.setImage()}},{key:"componentDidMount",value:function(){this.setImage()}},{key:"render",value:function(){return React.createElement("li",{ref:this.avatarImg,"data-tooltip":this.props.name})}}]),i}(React.Component),c=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getList",value:function(e){return e.map(function(e){return React.createElement(o,{key:e.zid||e.id,name:e.fn||e.name,avatar:e.avatar})})}},{key:"render",value:function(){var e=this.props.model;if(e.get("invitee")){var t,i=e.get("inviteeList")||[],s=e.get("shGroup"),a=[],n=[],r=[];Array.isArray(i)||(i=Object.keys(i)),i=(i=_zm.copyOf(i)).splice(0,3);var l=zmStreamsApp.util.getContactDetails(i);for(var o in s&&!$.isEmptyObject(s)&&(n=_.pluck(s,"id"),r=_.pluck(s,"name")),l)l[o].isDummyObj&&(-1!==(t=n.indexOf(o))&&(l[o].fn=r[t],l[o].avatar=zmStreamsApp.util.generateAvatarTemp(l[o].fn)),l[o].id=o),a.push(l[o]);return React.createElement(React.Fragment,null,React.createElement("span",{className:"zmSDot"}),React.createElement("ul",{className:"zmInvitedList",onClick:this.props.onChange},this.getList(a)))}}}]),t}(React.Component),p=function(e){function i(e){var t;return babelHelpers.classCallCheck(this,i),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e))).state={inviteeList:e.model.get("inviteeList")},_zm.autoBind(babelHelpers.assertThisInitialized(t),["changeInviteeList","addViewInvitees","bindInvitee"]),t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"addViewInvitees",value:function(e){var t=$.e(e.currentTarget),l=this,o=l.props.model,i=o.get("isDeleted"),s=o.get("streamsEnabled")&&_zm.isStreamsEnabled();if(t.hasClass("locked")||i)i&&_zm.succErrMsg("e",m.common.messages.deletedPost);else{t.addClass("locked");var a={items:o.get("inviteeList"),shGroup:o.get("shGroup"),parent:t[0],isOwner:o.get("isOwner"),type:"invitee_popup",invite:!0,streamsEnabled:s,showInvite:o.get("showinvite")&&s};o.triggerAction("getInvitees").then(function(e){if(e=e.resp,$.isEmptyObject(e)||o.fetchInvitees(e),!_.size(e.list)&&!s)return!1;a.items=e.list,a.shGroup=e.shgroup,a.users=e.users,a.dialogDidMount=function(e){l.bindInvitee(e.$els.$contentWrapper)},a.closeAction=function(){zmStreamsApp.util.hideMenu(),l.inviteeAutofill&&(l.inviteeAutofill.destroy(),l.inviteeAutofill=void 0),l.inviteeTokens&&(l.inviteeTokens.destroy(),l.inviteeTokens=void 0)},a.showInvite&&(a.buttons=[{name:m.common.labels.invite,callback:function(e){for(var t=$.e(e.$els.$contentWrapper).find("input"),i=l.inviteeTokens.model.attributes.tokens.models,s=[],a=i.length,n=0;n<a;n++)s.push(i[n].attributes.zid);if(s.length)o.addRemoveInvite(s,!0),e.remove();else{var r=t.val().trim();_zm.succErrMsg("e",r.length?m.common.messages.addInvitee:m.common.messages.emptyInvite)}}},{name:m.common.labels.cancel,callback:function(e){e.remove()},isCancel:!0}]),zmStreamsApp.util.createDialog(a),t.removeClass("locked")})}}},{key:"bindInvitee",value:function(s){var a=this,n=a.props.model,r=s.find(".addInv"),l=n.get("inviteeList"),o=n.get("groupId"),m=n.get("mentionList"),t=function(){var i=[];l&&!_.isArray(l)&&(i=Object.keys(l));var e=n.get("by");if(zmUtil.isGroupMember(e,o)&&i.push(e),m&&!_.isArray(m)&&(m=Object.keys(m)),i=_.union(i,m),n.get("showinvite")){var t={tokenInput:r[0],autofillInput:s[0],exclude:function(){return i},onAdd:function(e){i.push(e.attributes.zid)},onRemove:function(e){i=_.without(i,e.attributes.zid)}};n.get("groupsMention")&&(t.includeAllGroups=!0),zmStreamsApp.util.bindInviteeDialogAutofill(t).then(function(e){a.inviteeTokens=e.tokenComponent,a.inviteeAutofill=e.autoComplete})}s.find(".SC_cs .msi-close").click(function(){var e=$.e(this).parent(),t=e.data("uid");e.parent().remove(),n.addRemoveInvite(t),i=_.without(i,String(t))})};if(m)t();else{var e=n.get("inviteeList")||[];Array.isArray(e)||(e=Object.keys(e)),zmStreamsApp.util.getMentionList({shGroup:n.get("shGroup"),id:n.get("id"),type:n.get("etype"),inviteeList:e,group:n.get("group")}).then(function(e){m=e,n.set("mentionList",e),t()})}}},{key:"changeInviteeList",value:function(){this.setState(function(e,t){return{inviteeList:t.model.get("inviteeList")}})}},{key:"componentDidMount",value:function(){this.props.model.on("change:inviteeList",this.changeInviteeList)}},{key:"componentWillUnmount",value:function(){this.props.model.off("change:inviteeList",this.changeInviteeList)}},{key:"render",value:function(){var e=this.props.model,t=e.get("invitee"),i=(!1===e.get("lockInvites")||e.get("isOwner")||zmail.zuid===e.get("by"))&&_zm.isStreamsEnabled()&&e.get("streamsEnabled");return React.createElement(React.Fragment,null,0<t&&React.createElement(c,babelHelpers.extends({},this.props,{onChange:this.addViewInvitees})),(i||3<t)&&React.createElement(r,babelHelpers.extends({},this.props,{onChange:this.addViewInvitees})))}}]),i}(React.Component),u=zmText.get("streams"),v=function(e){function a(e){var t;babelHelpers.classCallCheck(this,a),t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this,e));var i=e.model.get("pvtcmts"),s="input";return i&&i.privateToPost?s="hide":String(e.model.get("by"))===zmail.zuid||e.model.get("disableComment")||(s="new"),t.state={comments:s},_zm.autoBind(babelHelpers.assertThisInitialized(t),["addPrivateComment","resetPrivateComment","showHidePrivateComment"]),t}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"addPrivateComment",value:function(e){var t=$.e(e.currentTarget),i=t.parents(".SCS_postWra"),s=i.siblings(".sc_cmdv");if(s.length||(s=i.children(".sc_cmdv").length?i.children(".sc_cmdv"):t.parents(".SCS-post").children(".sc_cmdv")).length||(s=(i=t.parents(".zmPostActions")).siblings(".sc_cmdv")),"new"===this.state.comments)this.setState({comments:"input"}),zmStreamsApp.CommentModule.sendPrivateToOwner(this.props.model.id,s);else if("show"===this.state.comments||"hide"===this.state.comments){var a=s.find("ul.pvtOwn")[0];a&&("none"===a.style.display?(a.style.display="",this.setState({comments:"show"})):(a.style.display="none",this.setState({comments:"hide"})))}}},{key:"showHidePrivateComment",value:function(){"input"!==this.state.comments&&"new"!==this.state.comments||this.setState({comments:"show"})}},{key:"resetPrivateComment",value:function(){var e=this.props.model;this.setState({comments:String(e.get("by"))===zmail.zuid||e.get("disableComment")?"input":"new"})}},{key:"componentDidMount",value:function(){this.props.model.on("privateComment/added",this.showHidePrivateComment),this.props.model.on("privateComment/deleted",this.resetPrivateComment)}},{key:"componentWillUnmount",value:function(){this.props.model.off("privateComment/added",this.showHidePrivateComment),this.props.model.off("privateComment/deleted",this.resetPrivateComment)}},{key:"render",value:function(){var e="";switch(this.state.comments){case"new":e=u.common.labels.sendPrivateOwner;break;case"show":e=u.common.labels.hidePrivateComments;break;case"hide":e=u.common.labels.showPrivateComments}if("input"===this.state.comments)return null;var t="zmLink zmPvtReply";return"show"!==this.state.comments&&"hide"!==this.state.comments||(t="zmLink zmPvtReplyToggle"),React.createElement("span",{className:t,onClick:this.addPrivateComment},"new"===this.state.comments?e:React.createElement(React.Fragment,null,React.createElement("i",{className:"msi-comment"}),e))}}]),a}(React.Component),h=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"componentDidMount",value:function(){this.props.model.setView()}},{key:"componentWillUnmount",value:function(){this.props.model.removeView()}},{key:"render",value:function(){var e=this.props.model,t=e.get("id"),i=e.get("etype");return React.createElement("div",{className:"zmPostActions","data-id":t},React.createElement(n,this.props),React.createElement(p,this.props),_zm.isStreamsEnabled()&&"13"!==i&&React.createElement(v,this.props))}}]),t}(React.Component),g=zmText.get("streams"),z=function(e){function i(e){var t;return babelHelpers.classCallCheck(this,i),t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e)),_zm.autoBind(babelHelpers.assertThisInitialized(t),["inviteeLists","showSharedLists"]),t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"inviteeLists",value:function(){var e=this.props.list;_.isArray(e)||(e=Object.keys(e));var t=zmStreamsApp.util.getContactDetails(e);return(t=Object.values(t)).map(function(e){return React.createElement("img",{src:e.photo,"data-tooltip":e.fn||e.name,key:e.zid||e.id})})}},{key:"showSharedLists",value:function(){var e=this.props.list;_.isArray(e)||(e=Object.keys(e));var t={$content:function(e){var t,i,s;e=_.isArray(e)?e:e.split(","),t=zmStreamsApp.util.getContactDetails(e);var a=zdom("ul",{className:"SC_P2r",id:"zms_memView"});for(var n in t)(i=(s=t[n]).fn||s.name)&&a.appendChild(zdom("li",null,zdom("div",null,i,zdom("span",null,s.eid||"")),zdom("img",{src:s.photo})));return a}(e),title:g.common.labels.folderShareList,dialogDidMount:function(e){e.$els.$content.css("max-height",.6*$.e(window).height())}};Dialog.new(t)}},{key:"render",value:function(){var e=_.size(this.props.list),t=1===e?g.common.labels.viewShare:zmText.applyArgs(g.common.labels.viewShares,{count:e});return React.createElement("div",{className:"mailSLWra","data-id":this.props.id},React.createElement("div",{className:"mailSharedList",onClick:this.showSharedLists},React.createElement("ul",null,React.createElement("li",null,e&&this.inviteeLists())),React.createElement("span",{className:"SC_lnk SCShowinvite"},t)))}}]),i}(React.Component),e=zmail.Core.Namespaces.get("zmail.DataLayer"),t=e.DSModel,f=e.DSCollection,k=e.Adapter.HTTPAdapter,b=zmText.get("streams"),y=null,C="1",A=function(e,t){e.get("isDeleted")?_zm.succErrMsg("e",b.common.messages.deletedPost):t.err&&t.err.errCode===C?_zm.succErrMsg("e",b.common.messages.networkUnreachable):t.resp?_zm.succErrMsg("e",t.resp):_zm.succErrMsg("e",b.common.messages.errRequest)},I=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getDefaults",value:function(){return{likes:0,like:!1}}},{key:"getActivity",value:function(){var s=this;return new Promise(function(i){s.triggerAction("getActivity").then(function(e){e=e.resp;var t=zmStreamsApp.util.orderComments(e.list,e.order);s.set("activityLog",t),i()})})}},{key:"getView",value:function(){return this.views||0}},{key:"setView",value:function(){var e=this.getView();e+=1,this.views=e}},{key:"removeView",value:function(){var e=this.getView();e-=1,this.views=e}},{key:"updateLikeCount",value:function(e){this.set("likes",e)}},{key:"updateLikeList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.set("likeList",e)}},{key:"updateUserLike",value:function(e){this.set("like",e)}},{key:"updateUserList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.set("userLike",e)}},{key:"updateInviteeList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.set("invitee",_.size(e)),this.set("inviteeList",e)}},{key:"like",value:function(){var l=this;l.triggerAction("like").then(function(){},function(e){A(l,e);var t=l.get("like"),i=l.get("likes"),s=l.get("userLike")||{},a=l.get("likeList")||[],n=s.hasOwnProperty(zmail.zuid);if(t&&n||!t&&!n){if(i=t?i-1:i+1,t)delete s[zmail.zuid],a=_.without(a,zmail.zuid);else{var r=zmStreamsApp.util.getContactDetails([zmail.zuid])[zmail.zuid];s[zmail.zuid]=r.fn,a.unshift(zmail.zuid)}l.updateLikeCount(i),l.updateUserList(s),l.updateLikeList(a),l.updateUserLike(!t)}})}},{key:"getLikes",value:function(){var a=this;return new Promise(function(s,t){a.triggerAction("getLikes").then(function(e){e=e.resp;var t=a.get("userLike"),i=e.users;i&&_.size(i)&&$.extend(i,t),a.updateLikeList(e.list),a.updateUserList(i),a.updateLikeCount(_.size(i)),s()},function(e){A(a,e),t()})})}},{key:"lockInvites",value:function(){var t=this;t.triggerAction("lockInvites").then(function(){var e=t.get("lockInvites");t.get("by")!==zmail.zuid&&t.set("showinvite",e),t.set("lockInvites",!e)},function(e){A(t,e)})}},{key:"addRemoveInvite",value:function(e,t){var a=this,n=String(e).split(","),r=t?"addInvitee":"unInvite";a.triggerAction("invitee",{zuids:e,atype:r}).then(function(){var e="addInvitee"===r,t=_zm.copyOf(a.get("inviteeList")||{});if(e){var i,s=n.length;for(i=0;i<s;i++)t[n[i]]=zmail.zuid}else delete t[n[0]];a.updateInviteeList(t),"1"===String(a.get("etype"))&&zmStreamsApp.CommentModule.updateInvitees({eid:a.id,type:r,inviteeList:n.join(",")})},function(e){A(a,e)})}},{key:"fetchInvitees",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.list?(this.updateInviteeList(e.list),this.set({shGroup:e.shgroup,inviteeUsers:e.users})):this.triggerAction("getInvitees")}}]),t}(t),L=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getBaseModelClass",value:function(){return I}}]),t}(f),w={adapters:[{id:"http-adapter",type:"default",classObj:function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"getUrl",value:function(){return zmail.conPath+"/post.do"}},{key:"serialize",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s={entityId:t.id,entityType:t.get("etype"),streamsView:!0,groupId:t.get("groupId")};i.extraParam={elem:i.elem,isSeeMore:i.isSeeMore},"like"===e?(s.mode="like",s.like=t.get("like"),s.actionType=s.like?"like":"unlike",s.authorZuid=t.get("by"),i.setSessionId=!0):"getLikes"===e?(s.mode="like",s.actionType=t.get("actionType")):"invitee"===e?(s.mode="invite",s.actionType=i.atype,s.fZuid=i.zuids,i.setSessionId=!0):"getInvitees"===e?(s.mode="invite",s.actionType=t.get("actionType")):"lockInvites"===e?(s.mode="lockinvites",s.actionType=t.get("lockInvites")?"unlockInvites":"lockInvites",i.setSessionId=!0):"getActivity"===e&&(s.mode="activity",s.actionType=t.get("groupId")===zmail.zuid?"viewSelfData":"viewGroupEntity");var a=s.entityId;return a&&-1!==a.indexOf("#")&&(s.entityId=a.substring(a.indexOf("#")+1,a.length)),s}},{key:"normalize",value:function(e,t){return t}}]),t}(k)}],default:"http-adapter"};y=ZMStore.createInstance("postaction",L,{adapterConfig:w,metaInfo:{}});var S=zmText.get("streams"),M=zmStreamsApp.i18ntext.streams.activitylog,R=S.common.labels,T={1:M.invited,2:M.removed,12:M.moveTask,13:M.archived,14:M.unarchived,100:M.sharedemail,200:M.createnote,300:M.createtask,400:M.createevent,600:M.poststatus,1e3:M.postlink,202:M.changetitle,203:M.modifycontent,204:M.addattach,205:M.removeattach,206:M.changebackground,301:M.changetitle,302:M.changedesc,303:M.changepriority,305:M.assigntask,306:M.changecategory,307:M.setduedt,308:M.setstart,309:M.setremind,311:M.addattach,312:M.removeattach,313:M.subtask,sharedDraft:M.shareddraft,sentEmail:M.sentemail,207:M.changecategory},H={0:R.herself,1:R.himself,2:R.self},E=function(e){function i(e){var t;return babelHelpers.classCallCheck(this,i),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e))).container=React.createRef(),t.expandIcon=React.createRef(),t.state={viewAll:!1},_zm.autoBind(babelHelpers.assertThisInitialized(t),["activityLogDetails","expandCollapse","viewAllActivities"]),t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"activityLogDetails",value:function(){var e,t,i,s=this.props.data,a=s.groupId,n=[],r="";for(var l in s.activityData){switch(t=s.activityData[l],s.shGroup=t.invitees,i=zmStreamsApp.util.getNameOfInvitee(t.by,s.shGroup,t.name),r=void 0===(r=s.isDraft&&100===t.activityType?T.sharedDraft:s.etype!==zmStreamsApp.constants.streamTypeName.mail||s.shared||100!==t.activityType?13===t.activityType||14===t.activityType?zmText.applyArgs(T[t.activityType],{type:S.streams.entityName[zmStreamsApp.constants.streamTypeInfo[s.etype]]}):T[t.activityType]:T.sentEmail)?" ":" "+r+" ",t.activityType){case 305:e=t.activityMessage.split(",");var o=zmStreamsApp.util.getContactDetails([e[0]])[e[0]],m=void 0;"-1"===e[1]?(m=t.by!==e[0]?zmStreamsApp.util.getNameOfInvitee(e[0],s.shGroup,t.name):o&&""!==o.g?H[o.g]:H[2],r=" "+zmText.applyArgs(M.removedAssignee,{name:m})):e[1]===t.by?(m=(o=zmStreamsApp.util.getContactDetails([e[1]])[e[1]])&&""!==o.g?H[o.g]:H[2],r=" "+zmText.applyArgs(M.selfAssignee,{name:m})):r+=zmStreamsApp.util.getNameOfInvitee(e[1],s.shGroup,t.name);break;case 1:case 2:e=t.activityMessage,r+=zmStreamsApp.util.getNameOfInvitee(e,s.shGroup,t.name);break;case 301:r+=t.activityMessage.split(",")[1];break;case 202:r+=t.activityMessage;break;case 206:r+={0:"Blue",1:"Green",2:"Yellow",3:"Red"}[t.activityMessage];break;case 308:case 307:var c=t.activityMessage.split(",");r=c[1]?r+c[1]:M.remduedt;break;case 306:var p=zmTask.Util.getProjectName(a,t.activityMessage.split(",")[1]);p?r+=p:r=" "+M.removecategory;break;case 303:r+=zmTask.Util.getPriorityByValue(parseInt(t.activityMessage.split(",")[1]));break;case 304:var u=t.activityMessage.split(","),d=zmTask.Util.getStatusByValue(u[1],a);"2"===u[0]&&"3"===u[1]?r+=zmText.applyArgs(M.taskcomp,{status:d}):"3"===u[0]&&"2"===u[1]?r+=zmText.applyArgs(M.taskreop,{status:d}):r+=zmText.applyArgs(M.customStatus,{status:d});break;case 316:var v=t.activityMessage.split(","),h=zmTask.Util.getStatusByValue(v[1]),g=v[2];"2"===v[0]&&"3"===v[1]?r+=zmText.applyArgs(M.subtaskcomp,{status:h,name:g}):r+=zmText.applyArgs(M.subtaskreop,{status:h,name:g});break;case 207:r+=t.activityMessage}var z=new Date(t.on),f=Date.parse(z)?zmStreamsApp.util.getHourAndTime(parseInt(t.time)):"";if(n.push({id:l,owner:i,msg:r,on:t.on+" "+f}),"4"===l&&!this.state.viewAll)break}return n.map(function(e){return React.createElement("li",{className:"zmTlList",key:e.id},React.createElement("span",{className:"zmTlLUser"},e.owner),e.msg,React.createElement("span",{className:"zmTlLTime zmGreyClr"},e.on))})}},{key:"expandCollapse",value:function(){$.e(this.expandIcon.current).toggleClass("msi-zmPle msi-zmPme"),$.e(this.container.current).slideToggle()}},{key:"viewAllActivities",value:function(){this.setState({viewAll:!0})}},{key:"render",value:function(){var e=this.props.data,t=e.collapsed,i=t?"msi-zmPme":"msi-zmPle";return React.createElement("div",{className:"zmTimeline"},React.createElement("div",{className:"zmTimelineHeading"},React.createElement("strong",{className:"timeline",onClick:this.expandCollapse},M.timeline,React.createElement("i",{className:i,ref:this.expandIcon}))),React.createElement("div",{className:"zmTimelineWra",ref:this.container,style:t&&{display:"none"}},React.createElement("ul",{className:"zmTimelineList"},this.activityLogDetails()),5<e.activityData.length&&!this.state.viewAll&&React.createElement("span",{className:"SC_lnk SC_seemore",onClick:this.viewAllActivities},M.seeall)))}}]),i}(React.Component),N=zmStreamsApp.constants.notifications,P=function(e){return e.eid&&-1===e.eid.indexOf("#")&&e.group&&e.group.id&&"1"!==e.entityId&&(e.eid=e.group.id+"#"+e.eid),ZMStore.peekRecord("postaction",e.eid)},D=function(e,t){if(void 0===e.streamsEnabled&&(e.streamsEnabled=!0),-1===e.id.indexOf("#")){var i=e.groupId?e.groupId:zmail.zuid;e.id=i+"#"+e.id}void 0===e.lockInvites&&(e.lockInvites=zmStreamsApp.CommentModule.getLockValue(e.id));var s=new I({attrs:e});y.add(s);var a=(s=P({eid:e.id})).get("isSharedFolder")?React.createElement(z,{id:e.id,list:s.get("sharedUsers")}):React.createElement(h,{model:s});ReactDOM.render(a,t)};"undefined"!=typeof zmComponent&&zmComponent.notifier&&zmComponent.notifier.addHandler("streams",function(e,t){var i=(t=t.data||{}).ntype;if(i!==N.bulk_delete){"string"==typeof(t=_zm.copyOf(t)).group&&(t.group=$.parseJSON(t.group));var s=P(t);if(!_.isEmpty(s))switch(i){case N.like:case N.unlike:var a=i===N.like,n=i===N.unlike,r=s.get("likes");r=a?r+1:r-1;var l,o=s.get("userLike")||{},m=s.get("likeList")||[];if(l=o.hasOwnProperty(t.nby),a)if(l)_.size(o)&&(r-=1);else{var c=(_.isArray(t.nBy)?t.nBy[0]:JSON.parse(t.nBy)[0])[t.nby]||"";o[t.nby]=c,m.unshift(t.nby)}else n&&(!l&&_.size(o)?r+=1:(delete o[t.nby],m=_.without(m,t.nby)));if(t.nby===zmail.zuid)s.get("like")!==a&&s.updateUserLike(a);s.updateUserList(o),s.updateLikeList(m),s.updateLikeCount(r);break;case N.delete_post:s.get("isDeleted")||s.set("isDeleted",!0);break;case N.invite:case N.unshared:case N.add_comment:case N.comment_group_mention:case N.comment_mention:var p=s.get("invitee");if(t.followList=t.followList||"",t.followList){var u=t.followList.split(",");if(p!==u.length&&(s.updateInviteeList(u),"1"===String(s.get("etype")))){var d=i===N.unshared?"unInvite":"addInvitee";zmStreamsApp.CommentModule.updateInvitees({eid:s.id,type:d,inviteeList:u.join(",")})}}break;case N.lock_invites:case N.unlock_invites:var v=s.get("lockInvites"),h=i===N.lock_invites;if(h!==v){if(s.get("by")!==zmail.zuid){var g=s.get("showinvite");s.set("showinvite",!g)}s.set("lockInvites",h)}}}}),window.zmStreamsApp=window.zmStreamsApp||{},window.zmStreamsApp.PostActions=window.zmStreamsApp.PostActions||{};var O=window.zmStreamsApp.PostActions;O.template={getFontDOM:function(e,t,i,s){var a="",n=3<e?e-3:"";return(t||n)&&(a="+"+n),i&&(a=e||""),s="clicktoLoad fontClass SC_thm zm_shrnk "+(s=s||""),zdom("font",{className:s},a)},actionData:i},O.init=D,O.removeViews=function(e){var i;_.each(e,function(e){i=$.e(e).data(),ReactDOM.unmountComponentAtNode($.e(e).parent()[0]);var t=P({eid:i.id});t&&t.getView()<=0&&y.remove(t.id)})},O.getActivityLogs=function(i,s){var e={eid:i.id,group:i.gnrl?i.gnrl.group:i.groupId},a=P(e);a&&a.getActivity().then(function(){var e=a.get("activityLog");if(e.length){ReactDOM.unmountComponentAtNode(s);var t={collapsed:i.collapsed,activityData:e,groupId:a.get("groupId"),shGroup:a.get("shGroup"),isDraft:a.get("isDraft"),etype:a.get("etype"),shared:a.get("shared")};ReactDOM.render(React.createElement(E,{data:t}),s)}})},O.updateInviteeForMail=function(e){var t=P(e);t&&t.addRemoveInvite(e.inviteeList,"addInvitee"===e.type)},O.getPostTemplate=function(e){e.isPrint=!0;var t=i(e);$.e(e.elm).appendDOM(t)},O.getSharedMail=function(e,t,i){i.comment.id=e;var s,a,n=i.commentuuid;n instanceof Array&&(n=n[0]),i.elm=(s=t,a=zdom("div",{className:"SCS_postWra",id:"zms_"+e}),s.appendChild(a),a);var r={shId:i.shId,shOwner:i.comment.shOwner,isSharedFolder:!0,id:e,groupId:i.comment.shOwner,etype:zmStreamsApp.constants.streamTypeName.mail,sharedUsers:i.sharedUsers};D(r,i.elm);var l={comments:i.comment,shId:i.shId,shOwner:i.comment.shOwner,isSharedFolder:!0,id:e,disableComment:!1,groupId:i.comment.shOwner,etype:zmStreamsApp.constants.streamTypeName.mail,sharedUsers:i.sharedUsers,sharedToMe:i.sharedToMe};i.fixedComment&&"zmncenter"!==zmTab.currentTab&&(l.fixedComment=!0),i.fixedComment||(l.isNewCollabUser=!0,l.fixedComment=!0,l.fixedElement=t),zmStreamsApp.CommentModule.init(l,$.e(i.elm),n),$.e(i.elm).find(".zms_fixed").addClass("SCS_cmnt zms_fixed zmCmntFixed inputFocus")},O.fetchModel=P}(),window.__rollupModule=void 0;