"use strict";!function(t){var e,a,i,n,o,d=(e={},$.extend(e,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),e);i=Boolean(window.chrome)&&Boolean(window.chrome.webstore),n=Boolean(window.opr)&&Boolean(window.opr.addons)||Boolean(window.opera)||0<=navigator.userAgent.indexOf(" OPR/"),o=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),a=i||n||o?zmText.applyArgs(d.desktopMsg,{command:"ctrl+v"}):d.desktopMsgWithoutPaste,t.templates=t.templates||{};var s={backgroundColor:"#ce232c"};$.extend(t.templates,{docsOption:function(){return zdom("div",{className:"SC_frt"},d.label.insertAs,zdom("div",{"data-readval":"write","data-read":d.button.asAttach,"data-write":d.button.asLink,className:"SC_rwToggle attToggTemp"}))},dragdropArea:function(){return zdom("div",{className:"SC_drop SC_dropW100"},zdom("div",{className:"SC_drag wht",style:{height:"100%",top:"0"}},zdom("span",null,a)))},dropMsgTemplate:function(){return zdom("div",{className:"SC_drag SC_thmDrag",style:{height:"100%",display:"none"}},zdom("span",null,d.dropMsg))},browseInputEle:function(t,e){return zdom("input",{type:"file",id:t,name:e,style:{visibility:"hidden",width:"1px",height:"1px"}})},colorPallete:function(){return zdom("div",{id:"zmAnnonate_Color",className:"SC_dd shw",style:{display:"none"}},zdom("div",null,zdom("ul",{className:"SC_cp",style:{paddingLeft:"10px",marginTop:"-5px !important"}},zdom("li",{style:{padding:"0"}},zdom("div",{style:{backgroundColor:"#e5e5e5"}}),zdom("div",{style:{backgroundColor:"#f9baab"}}),zdom("div",{style:{backgroundColor:"#f9d3a2"}}),zdom("div",{style:{backgroundColor:"#fef86a"}}),zdom("div",{style:{backgroundColor:"#d7f3b0"}}),zdom("div",{style:{backgroundColor:"#c8e5fb"}}),zdom("div",{style:{backgroundColor:"#e0ceef"}}),zdom("div",{style:{backgroundColor:"#f6d0e6"}}),zdom("div",{style:{backgroundColor:"#c4c4c4"}}),zdom("div",{style:{backgroundColor:"#e07861"}}),zdom("div",{style:{backgroundColor:"#ecb772"}}),zdom("div",{style:{backgroundColor:"#f6e565"}}),zdom("div",{style:{backgroundColor:"#badf88"}}),zdom("div",{style:{backgroundColor:"#96ccf5"}}),zdom("div",{style:{backgroundColor:"#b99fce"}}),zdom("div",{style:{backgroundColor:"#e099c2"}}),zdom("div",{style:{backgroundColor:"#808080"}}),zdom("div",{id:"zmAnnotate_selColor",className:"sel",style:s}),zdom("div",{style:{backgroundColor:"#dd902f"}}),zdom("div",{style:{backgroundColor:"#d0c04b"}}),zdom("div",{style:{backgroundColor:"#90ca40"}}),zdom("div",{style:{backgroundColor:"#70abec"}}),zdom("div",{style:{backgroundColor:"#a97ac6"}}),zdom("div",{style:{backgroundColor:"#c26a9d"}}),zdom("div",{style:{backgroundColor:"#000000"}}),zdom("div",{style:{backgroundColor:"#9d1812"}}),zdom("div",{style:{backgroundColor:"#a56016"}}),zdom("div",{style:{backgroundColor:"#a69646"}}),zdom("div",{style:{backgroundColor:"#5b8828"}}),zdom("div",{style:{backgroundColor:"#4c76a2"}}),zdom("div",{style:{backgroundColor:"#8343a0"}}),zdom("div",{style:{backgroundColor:"#ba3682"}})))))},dragtheme:zdom("div",{style:{height:"3px"},className:"dragtheme"}),desktopListTemplate:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return zdom("div",{className:"zmL zmAch SC_mlst"},zdom("div",{className:"zmLst"},zdom("div",{draggable:"true",className:"zmFlt"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmDate"},zdom("span",null)),zdom("div",{className:"zmImg"},t.image),zdom("div",{className:"zmFdr"},zdom("span",null)),zdom("div",{className:"zmFrm editName"},zdom("span",{contentEditable:"true",id:"listView"},zmUtil.getSubString(60,t.name))),zdom("div",{className:"zmSze"},zdom("span",{className:"sum Sc_lnk"},t.size)),zdom("div",{className:"zmSub"},zdom("span",{id:"zmSubView",className:"sum SC_ldot SC_thm"},d.attachTemplateText.view),zdom("span",{id:"zmSubAnnotate",className:"sum SC_ldot SC_thm"},d.attachTemplateText.annotate),zdom("span",{id:"zmSubDownload",className:"sum SC_ldot SC_thm"},d.attachTemplateText.download),zdom("span",{id:"zmSubRemove",className:"sum SC_ldot SC_thm"},d.attachTemplateText.remove),zdom("span",{id:"zmWrnMsg",className:"sum"})),zdom("div",{className:"SC_icn"}),zdom("div",{className:"zm_lbl"})),zdom("div",{className:"zmFrt"})))},annonateBox:function(){var t=d.annotatebox.title;return zdom("div",{id:"zmAnnonateBox",className:"SC_Pop blk SC_cent tempAttPop"},zdom("div",{className:"SC_pe"},zdom("div",{id:"sand",className:"SC_oh"},zdom("div",{id:"zmCanvasCont",style:{overflow:"auto",position:"relative"}},zdom("canvas",{id:"zmCanvas"}),zdom("canvas",{id:"zmtempCanvas",style:{position:"absolute",top:"0px",left:"0px"}})),zdom("div",{className:"SC_PUbtm",id:"gpcrt",style:{display:"none"}},zdom("span",{id:"zmImgEditDone",className:"sel"},d.button.done),zdom("span",{id:"zmImgEditCancel",className:"sel","data-val":"Cancel"},d.button.cancel))),zdom("div",{id:"lightnav"},zdom("div",{className:"At_nme"}))),zdom("div",{className:"SC_tool",style:{left:"-40px"}},zdom("ul",null,zdom("li",{className:"sc_tb_hd"}),zdom("li",{id:"zmAttUndo",title:t.undo},zdom("i",{className:"msi-undo"})),zdom("li",{id:"zmAttRedo",title:t.redo},zdom("i",{className:"msi-redo"}))),zdom("ul",null,zdom("li",{id:"zmAttSquare",title:t.square},zdom("i",{className:"msi-box"})),zdom("li",{id:"zmAttHide",title:t.mask},zdom("i",{className:"msi-mask"}))),zdom("ul",null,zdom("li",{id:"zmAttCircle",title:t.circle},zdom("i",{className:"msi-ellipse"})),zdom("li",{id:"zmAttLine",title:t.line},zdom("i",{className:"msi-line"})),zdom("li",{id:"zmAttPen",title:t.pen},zdom("i",{className:"msi-pen"}))),zdom("ul",null,zdom("li",{id:"zmRotateACW",title:t.rotateacw},zdom("i",{className:"msi-rotateACW"})),zdom("li",{id:"zmRotateCW",title:t.rotatecw},zdom("i",{className:"msi-rotateCW"}))),zdom("ul",null,zdom("li",{id:"zmAttCrop",title:t.crop},zdom("i",{className:"msi-crop"})),zdom("li",{id:"zmAttText",title:t.text},zdom("i",{className:"msi-text"})),zdom("li",{id:"zmAttColor",title:t.color},zdom("i",{className:"msi-colorPalette"})),zdom("li",{className:"sc_tb_hd"}))))},cloudAttTempLoadingBox:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.image||zdom("i",{className:"msi-attothers zm-attIcn"});t.name=t.name||"",t.offline=t.offline||!1;var a="",i="attloading";return t.offline&&(i=t.offAttId),t.offline||(a=zdom("div",{className:"zmSub"},zdom("span",{"data-name":"rename"},d.UserMsg.rename),zdom("span",{"data-name":"download"},d.UserMsg.download),zdom("i",{className:"msi-action",title:d.UserMsg.more,"data-name":"showMore"}))),zdom("div",{className:"zmL SC_Pbar",id:i,title:t.name},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze"},zdom("span",{className:"attSize sum"},"Â ")),a,zdom("div",{className:"zmFrm"},zdom("span",{"data-name":"filename"},zmUtil.getSubString(20,t.name))),zdom("div",{className:"zmImg"},e),zdom("div",{className:"SC_icn"},zdom("i",{className:"msi-close"})),zdom("div",{className:"zm_lbl zmProgBar"},zdom("div",{id:"progressbar",style:{width:"0%"}})))))},cloudAttTempLoadingBoxNotes:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return zdom("div",{className:"zmNoteAttItem loadingAttItem"},t.image,zdom("div",{className:"zmNoteAttLoading"},zdom("span",{id:"progressbar",style:{width:"0%"}})),zdom("div",{className:"zmNoteAttItemClose"},zdom("i",{className:"msi-close"})))},insertImageMaskBtn:function(){return zdom("div",{id:"blkMaskWthBtn",className:"blkMask",style:{opacity:"0",display:"none"}},zdom("div",{className:"blkMaskBtn",style:{left:"38%"}},d.attachTemplateText.annotate),zdom("div",{className:"blkMaskBtn",style:{left:"48%"}},d.attachTemplateText.remove))},blackMask:function(){return zdom("div",{id:"uploadMask",style:{display:"none"},className:"blkMask"},zdom("div",{className:"upldProgBar"},zdom("div",{id:"progressIndicator"})))},selectedFile:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t.name=t.name||"",zdom("span",{className:"SC_fileSel",title:t.name,"data-attid":t.attId},zdom("span",{"data-name":"filename"},zmUtil.getSubString(10,t.name)),zdom("i",{className:"msi-close"}))},hugeAttachmentTemplate:function(t){var e=t.fn,a=zmUtil.getSubString(20,e),i=t.cls+" zm-attIcn",n=t.isOwner?"":"SC_dyn";return zdom("div",{className:"zmL SC_Pbar noHvr hugeAttTemp"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze zmOpt showOpt SC_dyn"},zdom("div",{className:"SCmb"},zdom("ul",null,zdom("li",{className:"SCtxt"},zdom("b",null,zdom("span",{className:"sum fileSize"}))),zdom("li",{className:"SCtxt SC_ldot optParent "+n},zdom("b",{className:"zmcDrpDwnOpn selOpt","data-val":"private"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"sum SC_thm changeOpt","data-tooltip":d.hugeAttach.permissionDialog.settingTooltip},d.hugeAttach.hugeOpts.recOpt)))))),zdom("div",{className:"zmFrm"},zdom("span",{"data-name":"filename",className:"attachTitle","data-tooltip":e},a)),zdom("div",{className:"zmImg"},zdom("i",{className:i})),zdom("div",{className:"SC_icn closeIcon"},zdom("i",{className:"msi-close"})),zdom("div",{className:"zm_lbl zmProgBar"},zdom("div",{id:"progressbar"})))))},mailHugeTemplate:function(t,e){var a=e.showToggleOpt?zdom("i",{className:"msi-zmPle expandCollapse"}):[];return zdom("div",{className:"zmAttHdr"},a,zdom("b",null,zdom("span",{className:"hugeHeader"},t)))},mailListTemplate:function(t){var e=t.fn,a=e.lastIndexOf("."),i=e,n="",o=t.className||"zmAch";-1!==a&&(i=e.substring(0,a),n=e.substring(a,e.length));var s=!zmUtil.isChildWindow()&&t.isOwner?zdom("i",{"data-tooltip":d.UserMsg.more,className:"msi-action moreAction"}):"";return zdom("div",{className:"zmL "+o},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg"},zdom("i",{className:t.cls+" zm-attIcn"})),zdom("div",{className:"zmFrm"},zdom("span",{"data-tooltip":t.fn,className:"attachTitle zmAttTitle"},zdom("span",null,i),zdom("span",null,n))),zdom("div",{className:"zmSze"},zdom("span",{className:"sum fileSize"},t.size)),zdom("div",{className:"zmSub"},zdom("span",{className:"download"},d.attachTemplateText.download),zdom("span",{className:"copyLink"},d.attachTemplateText.copylink),s))))},getNumberAvatar:function(t){var e="SC_avtr"+zmail.ContactBook.Utils.colorClasses();return zdom("div",{className:"SC_cs myInv plusNum"},zdom("div",{className:e},zdom("span",null,t)))},getPlusIcon:function(){return zdom("i",{className:"msi-plus SC_thm borderPlus plusIcon","data-tooltip":"Add members"})},getUserImageList:function(t,e){for(var a,i,n,o=[],s=0,l=0;l<t.length&&++s<6;l++)n=t[l],i=(a=zmail.ContactBook.get({str:n,promise:!1})).length?a[0].avatar()[0]:zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(n),avatarBgColor:zmail.ContactBook.Utils.colorClasses()})[0],o.push(zdom("div",{className:"SC_cs","data-tooltip":n},i,zdom("span",null,n)));if(s<6)for(var r=0;r<e.length&&++s<6;r++)(a=zmail.ContactBook.getGroups(e[r])).length&&(n=a[0].name,i=zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(n),avatarBgColor:zmail.ContactBook.Utils.colorClasses()})[0],o.push(zdom("div",{className:"SC_cs","data-tooltip":n},i,zdom("span",null,n))));return o},expandCollapse:function(t){var e=t.sharedUsers||[],a=t.sharedGroups||[],i=e.length+a.length,n=[],o=i?"":"edit_parti",s=d.hugeAttach.permissionDialog.inputTitle;if(i){var l=this.getUserImageList(e,a),r=this.getPlusIcon(),c=0<i-5?this.getNumberAvatar(i-5):[];n=zdom("div",{className:"addInvList expandMem"},l,c,r)}return zdom("div",{className:"zmPrivateMem zmChatlet privateField"},zdom("div",{className:"addInv expand SC_floatLabel flFLabel flBox "+o},n,zdom("label",null,s)))},constructPermission:function(t,e){var a=d.hugeAttach.permissionDialog,i=[],n=[],o=[],s=[],l=zmAttachUtility.constants,r=[];return o.push(zdom("div",{className:"zmRadioEle permElem publicElm","data-val":l.share_public},zdom("input",{type:"radio"}),zdom("label",null,zdom("i",{className:"msi-tick"}),a.publicHeader),zdom("div",null,zdom("p",{className:"sum"},a.publicDesc)))),t&&(r=this.expandCollapse(e),zmail.isOrg&&s.push(zdom("div",{className:"zmRadioEle permElem orgElm","data-val":l.share_org},zdom("input",{type:"radio"}),zdom("label",null,zdom("i",{className:"msi-tick"}),a.orgHeader),zdom("div",null,zdom("p",{className:"sum"},a.orgDesc))))),n.push(zdom("div",{className:"zmRadioEle permElem pvtElm","data-val":l.share_private},zdom("input",{type:"radio"}),zdom("label",null,zdom("i",{className:"msi-tick"}),a.pvtHeader),zdom("div",null,zdom("p",{className:"sum"},a.pvtDesc)),r)),i.push(zdom("div",{className:"zmRadioBlock zmBdrRadio permissionDialog"},n,s,o)),i},showCopyLink:function(t){var e=[];return e.push(zdom("div",null,zdom("br",null),zdom("div",null,zdom("input",{type:"text",value:t,className:"SC_tiput",readOnly:"readonly"})))),e},hugeAttLink:function(t,e){var a=zmResource.get("image","smileys/attachment.png");return zdom("fragment",null,zdom("a",{style:{"text-decoration":"none",color:"#1a73e8",display:"block",padding:"0",border:"solid 1px #e6eff5","border-radius":"5px",background:"#fff",overflow:"hidden","margin-bottom":"10px"},target:"_blank",rel:"noopener noreferrer",href:t},zdom("span",{style:{background:"#1a73e8",display:"inline-block",width:"30px","min-height":"30px","vertical-align":"middle","margin-right":"8px","text-align":"center","line-height":"30px"}},zdom("img",{src:a})),e))},hugeAttOnboarding:function(){var t=zmUtil.sizeConv(zmAttachUtility.constants.HUGE_ATT_UPER_LIMIT),e=d.hugeOnboarding,a=[],i=[];return zmAttachUtility.constants.HUGE_ATT_UPER_LIMIT&&(a=zdom("sup",null,"*"),i=zdom("div",{className:"zmOBHugeAttNoteTxt"},zdom("small",null,zdom("i",null,"*"+e.sub5+" ",zdom("b",null,t),".")))),zdom("fragment",null,zdom("ul",{className:"zmListReset"},zdom("li",null,zdom("div",{className:"zmHugeAttOnboard"},zdom("div",{className:"zmOBHugeAttImg"},zdom("div",{className:"zmHugeAttImg"}),zdom("div",{className:"zmWelAttImg"},zdom("span",{className:"zmSmallAttImg"}),zdom("span",{className:"zmWelAttBoard"},zdom("span",{className:"zmWelBoardLft"}),zdom("span",{className:"zmWelBoardRgt"}),zdom("span",{className:"zmWelAttTxt"},e.welcome)))),zdom("div",{className:"zmOBHugeAttTxt"},zdom("p",null,e.sub1),zdom("p",{className:"zmOBHugeAttMTxt"},e.sub2+" ",zdom("b",null,e.sub3),a),zdom("p",null,e.sub4),zdom("div",{className:"zmBtnWra"},zdom("span",{className:"zmLink lrnBtn"},e.lrnmre),zdom("div",{className:"zmBtnGroup rightAlign"},zdom("div",{className:"zmBtn thmBgBtn bigBtn saveBtn"},e.gotit))))),i)),this.closeIcon())},transparentMask:function(){return zdom("div",{className:"zmBlkTransMask transMask",tabIndex:"0"})},closeIcon:function(){return zdom("div",{className:"SCmb puClose closeIcon"},zdom("ul",null,zdom("li",null,zdom("b",{"data-tooltip":d.close},zdom("div",{className:"SC_hd"}),zdom("span",{className:"SC_ttip ttr"},zdom("i",{className:"msi-close"}))))))},blockedContentHtml:function(){var t=zmail.urls.helpURL+"secure-attachment-policy.html";return zdom("fragment",null,zdom("i",{className:"msi-warning dRedBg"}),zdom("span",{className:"zmDRedClr"},d.resError),zdom("span",{className:"zmSLine"}),zdom("a",{className:"zmLink",target:"_blank",rel:"noopener noreferrer",href:t},d.hugeOnboarding.lrnmre))}},!0)}(window.zmAttachment=window.zmAttachment||{}),function(l){l.utility=l.utility||{};var t,o=(t={},$.extend(t,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),t);l.utility.setDragDrop=function(){function e(t){this.$centerEle=t.$centerEle,this.$dropMsgEle=t.$dropMsgEle,this.onDrop=t.onDrop,this.onDragover=t.onDragover,this.onDragLeave=t.onDragLeave,this.isDragOver=!1,this.eventIdentifier="",t.eventIdentifier&&(this.eventIdentifier="."+t.eventIdentifier),t.preventDefaultErrorHandler&&(this.preventDefaultErrorHandler=!0)}return e.prototype.init=function(){this.bindDropListener(),this.bindDragOver(),this.bindDragLeave()},e.prototype.getFiles=function(){var t,e,a,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=[],o=[],s=i.items;if(s)if((e=s.length)&&"function"==typeof s[0].webkitGetAsEntry)for(a=0;a<e;a++)(t=s[a].webkitGetAsEntry())&&(t.isFile?n.push(s[a].getAsFile()):o.push(s[a].getAsFile().name));else i.files&&(n=i.files);else i.files&&(n=i.files);return{files:n,directories:o}},e.prototype.bindDropListener=function(){var n=this;this.$centerEle.on("drop"+this.eventIdentifier,function(t){var e,a,i;return t.preventDefault(),n.isDragOver=!1,(e=t.originalEvent.dataTransfer)&&e.files,i=(a=n.getFiles(e)).files,!n.preventDefaultErrorHandler&&a.directories.length&&function(t){var e,a,i;if(Array.isArray(t)){a=1===(i=t.length)?(e=t[0],zdom("div",{className:"SC_PUmsg"},zmText.applyArgs(o.desktop.folderDropErr1,{folderName:e}))):2===i?zdom("div",{className:"SC_PUmsg"},zmText.applyArgs(o.desktop.folderDropErr2,{folderName1:t[0],folderName2:t[1]})):zdom("div",{className:"SC_PUmsg"},zmText.applyArgs(o.desktop.folderDropErrN,{folderName1:t[0],number:i-1}));var n={title:o.desktop.folderDropDialogTitle,$content:a,buttons:[{name:o.button.ok,callback:function(t){t.remove()}}]};Dialog.new(n)}}(a.directories),i&&i.length?n.onDrop(i,n.$centerEle):"function"==typeof n.onDragLeave&&n.onDragLeave(),!1})},e.prototype.bindDragOver=function(){var a=this;this.$centerEle.on("dragover"+this.eventIdentifier+" dragenter"+this.eventIdentifier,function(t){var e=t.originalEvent.dataTransfer;if(t.preventDefault(),!a.isDragOver)return t&&"dragover"===t.type&&(a.isDragOver=!0),(null!==e.types||e.files&&0<e.files.length)&&(e.files&&0<e.files.length||(e.types.indexOf?-1!==e.types.indexOf("Files"):e.types.contains("application/x-moz-file"))||e.types.length&&"Files"===e.types[0])&&(e.dropEffect="copy","function"==typeof a.onDragover?a.onDragover():a.$dropMsgEle.hasClass("SC_dropW100")||a.$dropMsgEle.addClass("SC_dropW100").attr("centerover",!0)),!1})},e.prototype.bindDragLeave=function(){var e=this;this.$dropMsgEle.on("dragleave"+this.eventIdentifier,function(t){return t.preventDefault(),"function"==typeof e.onDragLeave&&e.isDragOver&&(e.isDragOver=!1,e.onDragLeave()),!1})},function(t){new e(t).init()}}(),l.utility.createObjectURL=function(t,e){var a;if(window.URL=window.URL||window.webkitURL,window.URL&&t)return a=window.URL.createObjectURL(t),e&&window.setTimeout(function(){l.utility.revokeObjectURL(a)},e),a},l.utility.revokeObjectURL=function(t){window.URL=window.URL||window.webkitURL,window.URL&&t&&window.URL.revokeObjectURL(t)},l.utility.isFunction=function(t){return"function"==typeof t},l.utility.isChrome=function(){return Boolean(window.chrome)&&Boolean(window.chrome.webstore)},l.utility.isOpera=function(){return Boolean(window.opr)&&Boolean(window.opr.addons)||Boolean(window.opera)||0<=navigator.userAgent.indexOf(" OPR/")},l.utility.isFirefox=function(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")},l.utility.filterMyAttachmentKey=function(t){var e={};return e.e=t.e,e.et=t.et,e.Id=t.Id,e.ft=t.ft,t.n&&(e.n=t.n),t.sid?e.groupId=t.sid:t.gId&&(e.groupId=t.gId),t.shId&&(e.shId=t.shId),(t.sid||t.gId&&t.gId!==zmail.zuid)&&(e.streamsView=!0),e},l.utility.renameHelper=function(){function e(){var t=this.config.$ele;t.on("keypress",function(t){var e=this.config;60===t.which||62===t.which?t.preventDefault():13===t.which&&(t.preventDefault(),e.$ele.trigger("blur")),l.utility.isFunction(e.onKeypress)&&e.onKeypress(t)}.bind(this)),t.on("keyup",function(t){var e,a=this.config,i=a.$ele,n=i.closest("."+a.parentClass),o=a.orginalFileName,s=o.lastIndexOf(".");27===t.which?(t.preventDefault(),e=-1!==s?o.substring(0,s):o,i.text(e),i.blur()):e=i.text(),e&&e.length&&(-1!==s&&(e+=o.substring(s,o.length)),n.attr("title",e),l.utility.isFunction(a.onChange)&&a.onChange.call(a.context||null,e,a.handbackData)),l.utility.isFunction(a.onKeyup)&&a.onKeyup(t)}.bind(this)),t.blur(function(t){var e,a=this.config,i=a.$ele,n=a.orginalFileName,o=n.lastIndexOf(".");"true"===i.attr("contenteditable")&&((e=i.text())&&e.length?-1!==o&&(e+=n.substring(o,n.length)):e=n,i.text(zmUtil.getSubString(20,e)).attr("contenteditable",!1),i.parent(".zmFrm").removeClass("editName"),this.config.orginalFileName=e,l.utility.isFunction(a.onBlur)&&a.onBlur(t))}.bind(this))}function a(t){t&&t.constructor===Object?(this.config=t,e.call(this)):zmUtil.debugLog("Rename attachment: Invalid config")}return{init:function(t){return new a(t)},onRenameAction:function(n,o){"true"!==n.attr("contenteditable")&&(n.attr("contenteditable",!0),n.parent(".zmFrm").addClass("editName"),window.setTimeout(function(){var t,e,a,i;n.focus(),-1!==(i=(a=o.attr("title")).lastIndexOf("."))&&n.text(a.substring(0,i)),document.createRange?((t=document.createRange()).selectNodeContents(n[0]),t.collapse(!1),(e=window.getSelection()).removeAllRanges(),e.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(n[0]),t.collapse(!1),t.select())},10))}}}()}(window.zmAttachComponent=window.zmAttachComponent||{}),function(m){var n,o=15,z={startX:0,startY:0,stopX:0,stopY:0,isDragging:!1,undoList:[],redoList:[],selectedColor:"#ce232c"},c={};m.imageEditTool={},m.utility=m.utility||{},m.utility.dataURItoBlob=function(t){var e,a,i,n;for(e=0<=t.split(",")[0].indexOf("base64")?atob(t.split(",")[1]):unescape(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],i=new window.Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return new Blob([i],{type:a})};var d=function(){$.q("#zmAnnonateBox").remove(),z.undoList=[],z.redoList=[],c.onClose&&c.onClose(),n&&zmComponent.keybindings.setScope(n)};function A(t,e){var a=e.offset(),i=e.position(),n=t.clientX,o=t.clientY,s=n-a.left+i.left,l=o-a.top+i.top,r=$.q("#zmAnnonateBox #zmCanvasCont");return{realX:s+=r.scrollLeft(),realY:l+=r.scrollTop()}}function h(){z.undoList.length?$.q("#zmAttUndo").addClass("sel"):$.q("#zmAttUndo").removeClass("sel"),z.redoList.length?$.q("#zmAttRedo").addClass("sel"):$.q("#zmAttRedo").removeClass("sel")}function u(t){var e=zdom("canvas",null),a=$.q("#zmCanvas")[0];e.height=a.height,e.width=a.width,e.getContext("2d").drawImage(a,0,0),t.push(e),h()}function C(t){z.isDragging=!1;var e,a,i=$.q("#zmtempCanvas"),n=$.q("#zmCanvas")[0];i.off("mousemove.zmAttWidget"),i.off("mouseup.zmAttWidget"),i.off("mouseleave.zmAttWidget"),u(z.undoList),t&&t(),e=n,a=i[0],e.getContext("2d").drawImage(a,0,0),a.getContext("2d").clearRect(0,0,a.width,a.height)}function f(t){var e=$.q("#zmCanvas")[0],a=e.getContext("2d"),i=$.q("#zmtempCanvas")[0],n=i.getContext("2d");a.beginPath(),a.clearRect(0,0,e.width,e.height),e.width=t.width,e.height=t.height,n.clearRect(0,0,i.width,i.height),i.width=t.width,i.height=t.height,a.drawImage(t,0,0)}function p(t,e){var a,i,n,o,s=A(t,e),l=s.realY,r=s.realX,c=$.q("#zmAnnonateBox"),d=c.find("#zmtempCanvas"),m=d.height(),h=d.width(),u="bold 14px sans-serif";60<=m&&m<l+50&&(l=m-60),210<=h&&h<r+200&&(r=h-210),i=h-r-20,n=m-l-20;var f,p,g,v;$.q("#zmCanvTxtArea").length?((o=(a=$.q("#zmCanvTxtArea")).val()).length&&(f=o,p=d[0].getContext("2d"),g=parseFloat(a.css("left")),v=parseFloat(a.css("top"))+15,p.beginPath(),p.fillStyle=z.selectedColor,p.font=u,p.textBaseline="bottom",function(t,e,a,i,n,o){for(var s=e.split("\n"),l=0,r=s.length;l<r;l++){for(var c="",d=s[l].split(" "),m=0,h=d.length;m<h;m++){var u=c+d[m]+" ";n<t.measureText(u).width?(t.fillText(c,a,i),c=d[m]+" ",i+=o):c=u}t.fillText(c,a,i),i+=o}}(p,f,g,v,i,16),p.closePath(),C()),$.q("#zmCanvTxtArea").remove()):((a=$.e(zdom("textarea",{style:{width:"200px",position:"absolute"}}))).attr("id","zmCanvTxtArea").css({top:l,left:r}),a.css({"max-width":i,"max-height":n,border:"none",color:z.selectedColor,font:u}),c.find("#zmCanvasCont").appendDOM(a),a.focus(),a.on("change keyup",function(){zmail.Utils.TextAreaResizer.resize(this,{maxHeight:n,maxWidth:i})}))}function g(t,e){e.find(".SC_tool").find("li").removeClass("sel"),t.addClass("sel")}function v(e){var a=$.q("#zmAnnonateBox"),t=a.find("#zmtempCanvas");e.cursorType&&t.css("cursor",e.cursorType),e.offEvents&&t.off(e.offEvents),e.onEvents&&t.on(e.onEvents,function(t){t.preventDefault(),a.find("#zmAnnonate_Color").hide(),e.onCallback&&e.onCallback(t,$.e(this))})}function s(t){z.startX=t.realX,z.startY=t.realY,z.stopX=z.startX,z.stopY=z.startY,z.isDragging=!0}function l(t){z.stopX=t.realX,z.stopY=t.realY}function i(t){var e=$.q("#zmtempCanvas"),a=e[0].getContext("2d"),i=z.stopX-z.startX,n=z.stopY-z.startY;a.clearRect(0,0,e[0].width,e[0].height),a.beginPath(),a.rect(z.startX,z.startY,i,n),a.lineWidth=5,t?(t.lineWidth&&(a.lineWidth=t.lineWidth),t.strokeStyle&&(a.strokeStyle=t.strokeStyle),t.fillStyle&&(a.fillStyle=t.fillStyle,a.fill()),t.setLineDash&&a.setLineDash&&(a.setLineDash(t.setLineDash),a.lineDashOffset=2)):a.strokeStyle=z.selectedColor,a.stroke()}function r(t){var e={};e.strokeStyle=t,e.fillStyle=t,i(e)}function y(t,e){var a=$.q("#zmtempCanvas");a.on("mousemove.zmAttWidget",function(t){var e,a;t.preventDefault(),e=t,a=$.e(this),e.preventDefault(),z.isDragging&&(l(A(e,a)),i())}),a.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(t){t.preventDefault(),C()}),s(A(t,e)),i()}function b(t,e){var a=$.q("#zmtempCanvas");a.on("mousemove.zmAttWidget",function(t){var e,a;t.preventDefault(),e=t,a=$.e(this),z.isDragging&&(l(A(e,a)),r(z.selectedColor))}),a.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(t){t.preventDefault(),C()}),s(A(t,e)),r(z.selectedColor)}function S(){var t,e,a,i,n=$.q("#zmtempCanvas"),o=n[0].getContext("2d"),s=Math.abs(z.stopX-z.startX),l=Math.abs(z.stopY-z.startY);o.clearRect(0,0,n[0].width,n[0].height),o.beginPath(),o.ellipse?o.ellipse(z.stopX,z.stopY,s,l,0,0,2*Math.PI):(a=s/(e=Math.max(s,l)),i=l/e,t=l<s?s:l,o.save(),o.translate(z.stopX,z.stopY),o.scale(a,i),o.beginPath(),o.arc(0,0,t,0,2*Math.PI,!1),o.restore()),o.lineWidth=5,o.strokeStyle=z.selectedColor,o.stroke()}function k(t,e){var a=$.q("#zmtempCanvas");a.on("mousemove.zmAttWidget",function(t){var e,a;t.preventDefault(),e=t,a=$.e(this),z.isDragging&&(l(A(e,a)),S())}),a.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(t){t.preventDefault(),C()}),s(A(t,e)),S()}function w(){var t=$.q("#zmtempCanvas")[0];if(t.getContext){var e=t.getContext("2d");e.beginPath(),e.strokeStyle=z.selectedColor,e.clearRect(0,0,t.width,t.height),e.moveTo(Math.floor(z.startX),Math.floor(z.startY)),e.lineTo(Math.floor(z.stopX),Math.floor(z.stopY)),e.lineWidth=5,e.lineJoin="round",e.lineCap="round",e.fillStyle=z.selectedColor,e.stroke(),e.closePath()}}function O(t,e){var a=$.q("#zmtempCanvas");a.on("mousemove.zmAttWidget",function(t){var e,a;t.preventDefault(),e=t,a=$.e(this),z.isDragging&&(l(A(e,a)),w())}),a.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(t){t.preventDefault(),C()}),s(A(t,e)),w()}function T(t,e){var a,i=$.q("#zmtempCanvas"),n=i[0].getContext("2d");i.on("mousemove.zmAttWidget",function(t){t.preventDefault(),function(t,e){if(z.isDragging){var a=$.q("#zmtempCanvas")[0].getContext("2d"),i=A(t,e);i.realY+=o,l(i),a.lineTo(z.stopX,z.stopY),a.stroke()}}(t,$.e(this))}),i.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(t){t.preventDefault(),n.closePath(),C()}),(a=A(t,e)).realY+=o,n.beginPath(),n.lineWidth=2,n.shadowBlur=1,n.strokeStyle=z.selectedColor,s(a),n.moveTo(z.startX,z.startY)}function x(t,e){var o=$.q("#zmtempCanvas");o.on("mousemove.zmAttWidget",function(t){var e,a;t.preventDefault(),e=t,a=$.e(this),z.isDragging&&(l(A(e,a)),i({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2}))}),o.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(t){var e,a,i,n;t.preventDefault(),Math.abs(z.startX-z.stopX)?(e=$.q("#zmtempCanvas"),a=e[0].getContext("2d"),i={},n={},z.startX<z.stopX?(i.startX=z.startX,i.stopX=z.stopX):(i.startX=z.stopX,i.stopX=z.startX),z.startY<z.stopY?(n.startY=z.startY,n.stopY=z.stopY):(n.startY=z.stopY,n.stopY=z.startX),a.clearRect(0,0,e[0].width,e[0].height),e[0].width=Math.abs(z.startX-z.stopX),e[0].height=Math.abs(z.startY-z.stopY),a.drawImage($.q("#zmCanvas")[0],i.startX,n.startY,Math.abs(i.startX-i.stopX),Math.abs(n.startY-n.stopY),0,0,Math.abs(i.startX-i.stopX),Math.abs(n.startY-n.stopY)),C(function(){$.q("#zmCanvas")[0].getContext("2d").clearRect(0,0,$.q("#zmCanvas")[0].width,$.q("#zmCanvas")[0].height),$.q("#zmCanvas")[0].width=Math.abs(z.startX-z.stopX),$.q("#zmCanvas")[0].height=Math.abs(z.startY-z.stopY)})):(o.off("mousemove.zmAttWidget"),o.off("mouseup.zmAttWidget"),o.off("mouseleave.zmAttWidget"))}),s(A(t,e)),i({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2})}function N(t){var e=$.q("#zmtempCanvas")[0],a=e.getContext("2d"),i=$.q("#zmCanvas")[0];t=t||270,a.clearRect(0,0,e.width,e.height),90===t||270===t?(e.width=i.height,e.height=i.width,a.save(),a.translate(i.height/2,i.width/2)):(e.width=i.width,e.height=i.height,a.save(),a.translate(i.width/2,i.height/2)),a.rotate(t*Math.PI/180),a.drawImage(i,-i.width/2,-i.height/2),u(z.undoList),i.height=e.height,i.width=e.width,i.getContext("2d").clearRect(0,0,i.width,i.height),i.getContext("2d").drawImage(e,0,0),a.restore(),a.clearRect(0,0,e.width,e.height)}function D(t){var e=t.target||t.srcElement,a=e.className,i=$.q("#zmAnnonateBox"),n=$.e(e),o=n.parent(),s={cursorType:"crosshair",offEvents:"mousedown click",onEvents:"mousedown"},l="annotate/";switch(a){case"msi-undo":!function(){if(z.undoList.length){var t=z.undoList[z.undoList.length-1];u(z.redoList),f(t),z.undoList.pop(),h()}}();break;case"msi-redo":!function(){if(z.redoList.length){var t=z.redoList[z.redoList.length-1];u(z.undoList),f(t),z.redoList.pop(),h()}}();break;case"msi-box":g(o,i),s.onCallback=y,s.cursorType="url("+zmResource.get("image",l+"rectangle.png")+"), crosshair",v(s);break;case"msi-mask":g(o,i),s.onCallback=b,s.cursorType="url("+zmResource.get("image",l+"blackout.png")+"), crosshair",v(s);break;case"msi-ellipse":g(o,i),s.onCallback=k,s.cursorType="url("+zmResource.get("image",l+"circle.png")+"), crosshair",v(s);break;case"msi-line":g(o,i),s.onCallback=O,s.cursorType="url("+zmResource.get("image",l+"line.png")+"), crosshair",v(s);break;case"msi-pen":g(o,i),s.onCallback=T,s.cursorType="url("+zmResource.get("image",l+"pen.png")+"), auto",v(s);break;case"msi-crop":g(o,i),s.onCallback=x,s.cursorType="url("+zmResource.get("image",l+"crop.png")+"), crosshair",v(s);break;case"msi-text":g(o,i),s.onCallback=p,s.offEvents="mousedown mousemove mouseup",s.onEvents="click",s.cursorType="auto",v(s);break;case"msi-colorPalette":var r=i.find("#zmAnnonate_Color"),c=n.offset().top-r.outerHeight()/2;r.show().css("top",c);break;case"msi-rotateACW":N(270);break;case"msi-rotateCW":N(90);break;default:g($.q("#zmAttSquare"),i),s.onCallback=y,s.cursorType="url("+zmResource.get("image",l+"rectangle.png")+"), crosshair",v(s)}h()}function U(t){window.URL=window.URL||window.webkitURL;var l,r=new Image,c=$.q("#zmAnnonateBox"),d=c.find("#zmCanvasCont");$.e(r).css({visibility:"hidden"}),$.e(document.body).appendDOM(r),l=t.source?t.source:m.utility.createObjectURL(t),r.onload=function(){var t,e,a,i,n,o,s;t=r,e=$.q("#zmCanvasCont"),a=e.find("#zmCanvas")[0],i=e.find("#zmtempCanvas")[0],n=$.e(t).height(),o=$.e(t).width(),s=a.getContext("2d"),e.css("overflow","auto"),a.width=o,a.height=n,i.height=n,i.width=o,s.clearRect(0,0,o,n),s.drawImage(t,0,0,o,n),$.e(t).remove(),c.find(".SC_PUbtm").show(),d.find(".At_load").remove(),m.utility.revokeObjectURL(l)},d.appendDOM(zmAttachment.templates.loadingTemplate()),r.crossOrigin="",zmUtil.isNettyViewEnabled()&&(r.crossOrigin="use-credentials"),r.src=l}function I(){var t=$.q("#zmAnnonateBox");t.find("#zmCanvasCont, .SC_pe").css({"max-height":t.height()-5,"max-width":t.width()-5})}m.imageEditTool.init=function(s){var l,t,e,a,i=s.file,r=s.handBckObj;c=s,$.e(document.body).appendDOM(zmAttachment.templates.annonateBox()),(l=$.q("#zmAnnonateBox")).appendDOM(zmAttachment.templates.colorPallete()),t={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){d()}]}],scope:"imageAnnotate"},n=zmComponent.keybindings.getScope(),zmComponent.keybindings.registerAll(t),zmComponent.keybindings.setScope("imageAnnotate"),$.q("#zmAnnonateBox").on("mousedown mouseup",function(t){zmUtil.stopEvents(t,!0)}),I(),s.file?i=s.file:s.source&&(i={source:s.source}),l.find(".At_nme").text(i.name||" "),l.find(".At_cls,#zmImgEditCancel").off("click").on("click",function(){d()}),l.find("#zmImgEditDone").off("click").on("click",function(){var t,e,a;if(z.undoList[0]||!c.file){var i,n;if(t=l.find("#zmCanvas"),c.file?n=c.file.type:"temp"===c.handBckObj.from?i=c.handBckObj.attObj.name:"myAttachment"===c.handBckObj.from&&(i=c.handBckObj.attObj.fn),i&&!n){var o=zmUtil.fileTyp(i);"jpg"!==o[2]&&"jpeg"!==o[2]||(n="image/jpeg")}e=t[0].toDataURL(n),a=m.utility.dataURItoBlob(e)}else a=c.file;l.remove(),s.onAttach&&s.onAttach({blob:a,handBckObj:r}),z.undoList=[],z.redoList=[]}),$.e(zmail.win).resize(function(){$.q("#zmAnnonateBox").length&&I()}),e=$.q("#zmAnnonateBox"),a=e.find(".SC_tool"),z.selectedColor=e.find("#zmAnnotate_selColor")[0].style.backgroundColor,a.on("click",D),e.find("#zmAnnonate_Color .SC_cp").find("div").on("click",function(){e.find("#zmAnnotate_selColor").removeAttr("id").removeClass("sel"),$.e(this).addClass("sel").attr("id","zmAnnotate_selColor"),z.selectedColor=$.e(this)[0].style.backgroundColor}),a.click(),U(i)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(v){var t,l=function(){},o={},a=10485760,i=0,n={},s=!1,r={},c="/attach.do",d="#progressbar",z="msi-attimg",m=".zm_attFltr",h="#zmMyAttachments",u=".SC_PUsel_files",f="#zmpastefirefox",p="attachment/cloudUpload",g="attachment/cloudClose",A=".zmFrm span",C=(t={},$.extend(t,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),t);function y(){return _zm.isOfflineSyncActive()}function b(){return zmUtil.isNettyUploadEnabled()}function e(){var t=this.componentId||"";return"mail"===t||0<=t.indexOf("zmEdi_")}function S(){return this.configJSON&&this.configJSON.attachmentSection}function k(t,e){return t.filter(function(t){return t!==e})}function w(t,e,a){"function"==typeof this.onAddAttachment&&this.onAddAttachment(t,e,a)}function O(t){"function"==typeof this.onRemoveAttachment&&this.onRemoveAttachment(t)}function T(t){"function"==typeof this.updateAttachment&&this.updateAttachment(t)}function x(t){"function"==typeof this.updateVirus&&this.updateVirus(t)}function N(a){var i;!function t(){var e;if(a.find(d)[0]){if(e=parseInt(a.find(d)[0].style.width),i&&window.clearTimeout(i),90<=e)return;a.find(d)[0].style.width="".concat(e+10,"%"),i=window.setTimeout(t,1e3)}}()}function D(){var t,e,a,i=this;e=function(){0<=(t=i.configJSON.attachFrom.indexOf("otherCloud"))&&i.configJSON.attachFrom.splice(t,1)},a=function(){0<=(t=i.configJSON.attachFrom.indexOf("zDocs"))&&i.configJSON.attachFrom.splice(t,1)},("false"===zmail.isCloudServiceEnabled||zmail.isBaihui)&&e(),zmAttachUtility.isDocsCompAllowed()&&_zm.isZohoDocsEnabled()||a(),t=this.configJSON.attachFrom.indexOf("myAttachchment"),zmUtil.isZohoAccount(zmail.accId)?-1!==t||this.configJSON.attachFrom.includes("insertImage")||this.configJSON.attachFrom.splice(1,0,"myAttachchment"):0<=t&&this.configJSON.attachFrom.splice(t,1)}function U(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.attachUtil,a=e.groupId,i=e.prvFltr.lblId,n=e.fileType,o=e.entity;if(t.hasOwnProperty("group")&&(a=t.group),t.hasOwnProperty("label")&&(i=t.label),t.hasOwnProperty("type")&&(n=t.type),t.hasOwnProperty("from")&&(o=t.from),a!==e.groupId||i!==e.prvFltr.lblId||n!==e.fileType||o!==e.entity){if(a===zmail.zuid&&" "===i&&0===n&&"all"===o){var s=this.dialog;return s.$el.find(".".concat(s.headerClass)).find(".zmFilterCriteria").remove(),void e.getAttLst({groupId:zmail.zuid,dType:e.dType,st:1,eType:"all",fType:0,prvFltr:e.prvFltr,isNew:"y",lstngObj:!0})}if(" "!==i){var l={lblId:i,mthd:"f"===i?"listFavourite":"labelListing"};e.getAttLst({groupId:a,dType:e.dType,st:1,eType:o,fType:n,prvFltr:e.prvFltr,isNew:"y",lstngObj:l})}else e.getAttLst({groupId:a,dType:e.dType,st:1,eType:o,fType:n,prvFltr:e.prvFltr,isNew:"y",lstngObj:!0})}}function I(){if(this.attachUtil){if(void 0===this.dialog||"myAttachment"!==this.dialog.currentTab())return;(function(){var t=this,e=this,a=e.dialog,i=e.attachUtil,n=a.$el.find(".".concat(a.contentWrapperClass)),o=i.prvFltr.lblId,s=n.find(".zmFilterCriteria");if(i.groupId===zmail.zuid&&"all"===i.entity&&0===i.fileType&&" "===o)s.remove();else{s.length&&s.remove(),s=zdom("div",{className:"zmFilterCriteria"},zdom("i",{className:"msi-filter"}),zdom("div",{className:"zmFCBWra"}),zdom("i",{className:"msi-plus zmFCClear","data-tooltip":C.common.clearFilter})),$.e(s).find(".msi-plus").click(function(){U.call(e,{label:" ",group:zmail.zuid,type:0,from:"all"})});var l,r=$.e(s).find(".zmFCBWra"),c=null,d=function(t,e){var a=zdom("div",{className:"zmFCBub"},zdom("span",{className:"zmFCBubLabel"},t.text),zdom("span",{className:"zmFCBubValue"},t.value),zdom("i",{className:"msi-close"}));return $.e(a).find(".".concat("msi-close")).click(function(){$.e(a).remove(),e()}),a};if(i.groupId!==zmail.zuid){var m=zmail.ContactBook.getGroups(i.groupId)[0];c=d({text:C.filterMenu.group,value:m?m.attrs.name:""},function(){U.call(e,{group:zmail.zuid})}),r.appendDOM(c)}"all"!==i.entity&&(c=d({text:C.filterMenu.from,value:zmAttachUtility.entDrpTxtChange(i.entity)},function(){U.call(e,{from:"all"})}),r.appendDOM(c)),0!==i.fileType&&(c=d({text:C.filterMenu.type,value:C.fType[i.fileType]},function(){U.call(e,{type:0})}),r.appendDOM(c))," "!==o&&(l="f"===o?C.menuText.favourites:zmail.labInfo[o].dispName,c=d({text:C.filterMenu.tags,value:l},function(){U.call(t,{label:" "})}),r.appendDOM(c)),$.e(s).insertDOMAfter(a.$el.find(".".concat(a.headerClass))[0])}}).call(this)}}function E(t){var e,n=this;return{id:"myAttachments",text:C.common.me,selected:t,tabName:"myAttachment",onClk:function(t,e,a){if(y()){var i=t.getCenterElem().find(".SC_mclst");return _zm.clearHTML(i),i.text(C.offlineError),!1}a?I.call(n):(n.attachUtil=new zmAttachUtility.AttachmentListing({appName:"attComp",listElem:t.getCenterElem().find(".SC_mclst"),headerElem:t.$el,thumbWidth:95,onFilterAction:I.bind(n),onListingUpdate:v.myAttachment.onListingUpdate.bind(n),cache:_zm._isPrivilegedUser()}),n.attachUtil.initAttachViewComp()),t.$el.find(u).show()},forceCall:!0,listingArea:{id:"zmattView",classes:"SC_mclst",styles:{"overflow-y":"scroll"},parEle:$.e(zdom("div",{className:"SCmc SC_attachviewer"}))},icons:y()?"":(e=[],e.push({iconClass:"msi-filter",onClk:function(){(function(){this.dialog.$el.find(m).toggleClass("shw"),this.attachUtil.restoreOptions(this.dialog.$el)}).call(n)},attr:{"data-tooltip":C.common.filter}},{iconClass:"msi-thumbview",selected:!0,onClk:function(){(function(){var t=this.attachUtil,e=!1;this.dialog.$el.find(m).removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-thumbview").closest("b").addClass("SC_sel"),t.restoreOptions(this.dialog.$el)," "!==t.prvFltr.lblId&&(e=t.prvFltr),t.getAttLst({groupId:t.groupId,dType:"t",st:1,eType:t.entity,fType:t.fileType,prvFltr:t.prvFltr,isNew:"y",lstngObj:e})}).call(n)},attr:{"data-tooltip":C.common.thumbView}},{iconClass:"msi-listview",onClk:function(){(function(){var t=this.attachUtil,e=!1;this.dialog.$el.find(m).removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-listview").closest("b").addClass("SC_sel"),t.restoreOptions(this.dialog.$el)," "!==t.prvFltr.lblId&&(e=t.prvFltr),t.getAttLst({groupId:t.groupId,dType:"l",st:1,eType:t.entity,fType:t.fileType,prvFltr:t.prvFltr,isNew:"y",lstngObj:e})}).call(n)},attr:{"data-tooltip":C.common.listView}}),e),buttons:[{text:C.button.attach,onClk:function(){v.myAttachment.onAttachHandler.call(n)}}],hideButtons:y()}}function M(t,e){return"myAttachchment"===t?E.call(this,e):"zDocs"===t?function(t){var e,n=this;return e={id:"attachFromDocs",text:zmail.isRebranded?C.cloudServiceName.docs:C.cloudServiceName.zDocs,tabName:"zDocs",selected:t,onClk:function(t,e,a){if(t.$el.find(h).hide(),t.$el.find(u).hide(),y()){var i=t.getCenterElem();return _zm.clearHTML(i),i.text(C.offlineError),!1}a||v.zDocs.invokeZDocsComponent.call(n,t.getCenterElem())},forceCall:!0,listingArea:{id:"zmMyDocs",classes:"SCmc SC_attachviewer"},buttons:[],hideButtons:y()},this.configJSON.showZDocsAsLinkOption?e.buttons.push({text:C.button.insert,onClk:function(){v.zDocs.attachZDocsDocument.call(n)}}):e.buttons.push({text:C.button.attach,onClk:function(){v.zDocs.attachZDocsDocument.call(n)}}),e}.call(this,e):"otherCloud"===t?function(t){var n=this;return{id:"attachFromCloud",text:C.cloudServiceName.otherCloud,tabName:"oCloud",selected:t,onClk:function(t,e,a){if(t.$el.find(h).hide(),t.$el.find(u).hide(),y()){var i=t.getCenterElem();return _zm.clearHTML(i),i.text(C.offlineError),!1}a||v.gagets.invokeGadgetComponent.call(n,t)},forceCall:!0,listingArea:{classes:"SCmc SC_attachviewer"},hideButtons:!0}}.call(this,e):"desktop"===t?function(t){var e=this;return{id:"zmDesktop",text:C.cloudServiceName.desktop,tabName:"zDesktop",selected:t,onClk:function(t){t.$el.find(h).hide(),t.$el.find(u).hide(),void 0===e.dialog&&0===e.configJSON.attachFrom.indexOf("desktop")||v.desktop.onTabSelection.call(e)},forceCall:!0,listingArea:{classes:"SC_mclst SC_ren",parEle:$.e(zdom("div",{className:"SCmc SC_attachviewer"}))},buttons:[{text:C.button.attach,onClk:function(){v.desktop.attachButtonHandler.call(e)}}]}}.call(this,e):"insertImage"===t?function(t){return v.insertImage.getTabConfig.call(this,t)}.call(this,e):void 0}function L(t){var e=this;t.getCenterElem("myAttachment").on("click",".zmAch",function(t){v.myAttachment.toggleSelectedStatus.call(e,t,this)}),function(n){var o=this,e=this,s=n.find("#zmAttGrp"),l=n.find("#zmAttLbl"),r=n.find("#zmAttEntity"),c=n.find("#zmAttFilTyp");l.text(C.menuText.none).data({dataIndex:"all"}),s.text(C.menuText.me).data({dataIndex:zmail.zuid}),r.text(C.menuText.all).data({dataIndex:"all"}),c.text(C.menuText.all).data({dataIndex:0}),n.find(".SC_frt").find(".msi-thumbview").closest("b").addClass("SC_sel"),n.find("#zmAttGrp").off("click").on("click",function(){zmAttachUtility.attDropDown("grp",s)}),n.find("#zmAttEntity").on("click",function(){zmAttachUtility.attDropDown("ent",r,void 0,e.componentId)}),n.find("#zmAttFilTyp").on("click",function(){zmAttachUtility.attDropDown("tfil",c)}),n.find("#zmAttLbl").on("click",function(){zmAttachUtility.attDropDown("lbl",l)}),n.find("#zmDfltAttView").off("click").on("click",function(){var t=e.attachUtil;n.find(".msi-filter").closest("b").removeClass("SC_sel"),n.find(m).removeClass("shw"),t.prvFltr.lblId=" ",t.getAttLst({groupId:zmail.zuid,dType:t.dType,st:1,eType:"all",fType:0,prvFltr:t.prvFltr,isNew:"y",lstngObj:!0})}),n.find("#attFilter").on("click",function(){n.find(m).removeClass("shw");var t=_zm.isStreamsEnabled()?s.data().dataIndex:zmail.zuid,e=r.data().dataIndex,a=c.data().dataIndex,i=l.data().dataIndex;"all"===i&&(i=" "),U.call(o,{group:t,from:e,type:a,label:i})}),n.find("#filterCncl").on("click",function(){var t=e.attachUtil;n.find(m).removeClass("shw"),t.restoreOptions(n)})}.call(this,t.$el)}function F(t){var e=this.configJSON.attachFrom.indexOf("desktop"),a=this.configJSON.attachFrom.indexOf("insertImage");0<=this.configJSON.attachFrom.indexOf("myAttachchment")&&L.call(this,t),(0<=e||0<=a)&&document.body.addEventListener("paste",l),0<=e&&function(n){var o=this;n.getCenterElem("zDesktop").find(".SC_drop").click(function(){v.desktop.attachFromDesktopTab.call(o)}),v.utility.setDragDrop({onDrop:function(t){var e=n.getCenterElem("zDesktop").find(".SC_drop");e.removeClass("SC_dropW100");for(var a=function(e){v.desktop.validateFile.call(o,e,e.name,function(t){t.status&&v.desktop.addAttachmentInDesktopTab.call(o,{file:e,isHuge:t.isHuge,isDocs:t.isDocs})})},i=0;i<t.length;i++)a(t[i]);0===o.desktopObj.length&&e.addClass("SC_dropW100")},onDragLeave:function(){o.desktopObj.length&&n.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100").removeAttr("centerover")},$centerEle:n.getCenterElem("zDesktop"),$dropMsgEle:n.getCenterElem("zDesktop").find(".SC_drop")})}.call(this,t),0<=a&&v.insertImage.bindEventsToTab.call(this,t),function(e){var a=this,t=e.$el;v.utility.setDragDrop({onDrop:function(){a.desktopObj.length&&e.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")},onDragover:function(){"zDesktop"===e.currentTab()&&e.getCenterElem("zDesktop").find(".SC_drop").addClass("SC_dropW100")},onDragLeave:function(){var t=e.getCenterElem("zDesktop").find(".SC_drop");a.desktopObj.length&&!t.attr("centerover")&&t.removeClass("SC_dropW100")},$centerEle:t,$dropMsgEle:t,eventIdentifier:"zmAttComp",preventDefaultErrorHandler:!0})}.call(this,t)}function P(e){var a,i=this,t=e.$el.find(".".concat(e.contentClass)),n=this.configJSON.attachFrom,o="none",s=n.indexOf("desktop");this.dialog=e,(window.ActiveXObject||"ActiveXObject"in window)&&e.$el.find(".".concat(e.contentWrapperClass)).css({opacity:1}),0<=s&&e.getCenterElem("zDesktop").appendDOM($.e(zmAttachment.templates.dragdropArea()));(0<=n.indexOf("myAttachchment")&&($.e(zdom("div",{id:"zmMyAttachments",style:{display:"none",position:"absolute",marginTop:"-17px",paddingLeft:"10px"}},"".concat(C.filterMenu.filterBy,":"),zdom("b",null),zdom("font",{className:"SC_lnk",id:"zmDfltAttView"},"(".concat(C.common.clearFilter,")")))).insertDOMAfter(e.$el.find(".".concat(e.headerClass))),"myAttachment"===e.currentTab()&&(o="block"),$.e(zdom("div",{style:{display:o},className:"SC_PUsel_files"},zdom("label",null,C.common.selectedfiles))).insertDOMAfter(e.$el.find(".".concat(e.contentClass))),e.getCenterElem("myAttachment").appendDOM(zmAttachUtility.getFilterDropTemplate())),e.$el.find(".".concat(e.contentClass)).css({overflow:"hidden",width:""}),e.$el.find(".SCmc.SC_attachviewer").css({"max-height":t.css("max-height"),"max-width":t.css("max-width")}),this.configJSON.showZDocsAsLinkOption&&0<=n.indexOf("zDocs"))&&(e.getButtonContainer("zDocs").appendDOM($.e(zmAttachment.templates.docsOption())),e.getButtonContainer("zDocs").find(".SC_frt div").click(function(){var t=$.e(this);t.hasClass("SC_rwWrite")?(i.asLink=!1,ATTACHDIALOG.asAttachment(),e.hideSuccErrMsg("zDocs")):(i.asLink=!0,ATTACHDIALOG.asLink(),e.showSuccErrMsg("w",C.zohoDocs.aslinkwmsg,"zDocs")),t.toggleClass("SC_rwWrite")}));0<=n.indexOf("insertImage")&&v.insertImage.dialogDidMount(e),a=-1<window.navigator.userAgent.toLowerCase().indexOf("firefox"),l=function(t){i.dialog&&(a?$.q(f).clearHTML().focus():(t.preventDefault(),"zDesktop"===i.dialog.currentTab()?v.desktop.onPaste.call(i,t):"insertImage"===i.dialog.currentTab()&&v.insertImage.pasteHandler(t,e)))},a&&function(i){var n,o=this;$.e(document.body).appendDOM(zdom("div",{style:{maxHeight:"1px",maxWidth:"1px"},id:"zmpastefirefox",contentEditable:"true"})),new window.MutationObserver(function(t){t.forEach(function(t){"childList"===t.type&&t.addedNodes&&t.addedNodes.length&&Array.prototype.forEach.call(t.addedNodes,function(t){if("IMG"===t.tagName){var e=$.e(t),a=v.utility.dataURItoBlob(e.attr("src"));n="ScreenShot_".concat((new Date).getMilliseconds(),".png"),e.remove(),v.desktop.validateFile.call(o,a,n,function(t){t.status&&("zDesktop"===i.currentTab()?v.desktop.addAttachmentInDesktopTab.call(o,{file:a,name:n,isHuge:t.isHuge}):"insertImage"===i.currentTab()&&v.insertImage.pasteHandler(a,i))})}})})}).observe($.q(f)[0],{childList:!0})}.call(this,e),F.call(this,e),0<=s&&v.desktop.dialogDidMount.call(this,e,s)}function R(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(b()){var e=_zm.isWSActive();return void 0!==t.virusCheck&&(e=t.virusCheck),"https://".concat(zmail.urls.uploadurl,"/uploadTemp?mode=uploadTemp")+"&checkOffline=".concat(e,"&zmudrcsr=").concat(zmAjq.getCookie("zmudcsr"))}return"/zm".concat(c,"?mode=temp")}function H(){return b()?{}:{type:"f",accId:this.accId,tSize:0}}function B(t){return t instanceof $?t:$.q("#".concat(t))}function j(){void 0!==this.$ele&&this.$ele.length||(this.$ele=B(this.configJSON.eleId))}function J(t,e){var a,i,n={},o={},s=e.from,l=e.uuid;if("temp"===s)a=this.attachTempArr.tempLocation,o=n={fP:l};else{if("myAttachment"!==s)return;a=this.attachTempArr.myAttachment,n={uniqueId:l},o={uuid:l}}0<=(i=a.indexOf(_.findWhere(a,n)))&&(a[i].n=t),0<=(i=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,o)))&&(this.orderedListOfAttachedFile[i].n=t),T.call(this,a[i])}function q(t,e,a){var i;if(e)i=e;else for(var n=this.$ele,o=$.e(n).find("div:data(uniqueId)"),s=0,l=o.length;s<l;s++)if($.e(o[s]).data("uniqueId")===t){i=o[s];break}if(i){var r=$.e(i).find(".attSize"),c=".SC_orange";if("pending"===a)$.e(i).addClass("noHvr"),$.e(i).find(".zmSub").hide(),$.e(r).hide(),$.e(r).siblings(c).remove(),$.e(zdom("i",{className:"msi-refresh zmDoubleIcon zmAniRotate SC_orange"})).insertDOMBefore(r),$.e(zdom("span",{className:"SC_orange"},C.common.virusScanning)).insertDOMBefore(r);else if(!1===a||"failed"===a){var d="failed"===a?"zmVirusFile zmViChkFail":"zmVirusFile",m="failed"===a?C.common.virusFailed:C.common.virusDetected;$.e(i).addClass(d),$.e(i).removeClass("noHvr"),$.e(i).find(".zmSub").remove(),$.e(r).siblings(c).remove(),$.e(r).siblings(".SC_red").remove(),$.e(r).siblings(".msi-fail").remove(),$.e(zdom("i",{className:"msi-fail zmDoubleIcon"})).insertDOMBefore(r),$.e(zdom("span",{className:"SC_red"},m)).insertDOMBefore(r)}else!0===a&&($.e(r).show(),$.e(i).removeClass("noHvr"),$.e(i).find(".zmSub")[0].style.display="",$.e(r).siblings(c).remove())}}function W(t){zmAppLoader.load("download");var e,a,i,n,o,s,l,r,c=t.success,d=c.length,m=t.failure||[];j.call(this),o=this.$ele;for(var h=0;h<d;h++)n=void 0,a=zmUtil.getDummyFilename(c[h].name),i=zmUtil.isPreviewAvailable(a),(r=(l=zmUtil.fileTyp(c[h].name))[1])===z&&(c[h].src?n=c[h].src:zmUtil.isNettyViewEnabled()?n=zmDownload.viewDocument({returnUrl:!0,mode:"tmpview"},{fP:c[h].fP,name:c[h].name,size:c[h].size}):(n="".concat(zmail.conPath,"/").concat(i.apiName),n+="?mode=tmpview&entityType=1&accId=".concat(this.accId,"&fpath=").concat(c[h].fP,"&fstorename=").concat(c[h].sN))),e=$.e(zmAttachment.templates.attListingTemplate({size:zmUtil.sizeConv(c[h].size),name:c[h].name,image:zmAttachment.templates.attPrevInr({fn:c[h].name,thn:n})})),this.configJSON.renameSupport?r!==z&&zmAttachUtility.annotateImage[l[2]]||e.find('.zmSub i[data-name="showMore"]').remove():(s=e.find('.zmSub span[data-name="rename"]'),r===z&&zmAttachUtility.annotateImage[l[2]]?s.attr("data-name","showMore").text(C.attachTemplateText.annotate):s.remove(),e.find('.zmSub i[data-name="showMore"]').remove()),v.core.attachmentSection.call(this)?zmAttachUtility.appendAttachments(e,o,"common",this):o.appendDOM(e),!1!==c[h].virusFree&&"failed"!==c[h].virusFree||!zmUtil.isNettyUploadEnabled()||v.virusAttachmentUpdate.call(this,"",e,c[h].virusFree),v.core.storeTempAttachments.call(this,c[h],e,this.fromDesktopCount++,this.slideListCount++);for(var u,f,p=function(t){S.call(this)?zmAttachUtility.removeAttachments(t,"common"):t.remove(),v.core.addRemoveClassToParentDom.call(this),v.core.onRemove.call(this)},g=0;g<m.length;g++)u=(f=m[g]).fileName,this,"File violates secure attachment policy."!==f.msg&&f.errorCode!==zmAttachUtility.errorConstants.errContType||(e=$.e(zmAttachment.templates.attListingTemplate({name:u,image:zmAttachment.templates.attPrevInr({fn:u,image:zmAttachment.templates.attPrevInr({fn:u,thn:void 0})})})),v.core.attachmentSection.call(this)?zmAttachUtility.appendAttachments(e,o,"common",this):o.appendDOM(e),v.core.highlightRestrictedFile.call(this,e),e.find(".SC_icn").off("click").on("click",p.bind(this,e)));v.core.resolveDeferred.call(this),v.core.onAppend.call(this)}function X(i,n,r,o){var c=this,d={},t=i.find(A),m=n.name||n.fn;function s(t){var e=t.blob,a=t.handBckObj;e.name=i.attr("title"),c.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(n.fs||n.size||0),v.desktop.fileUpload.call(c,{file:e,name:e.name,$replaceEle:i,dIndex:a.attachTempArrIndex,sIndex:a.slideArrIndex,from:a.from,onerror:function(t){i.insertDOMAfter(t),t.remove(),c.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(n.fs||n.size||0),X.call(c,i,n,r,o)},onsuccess:function(){if("temp"!==r){var t=c.attachTempArr.myAttachment,e=t.indexOf(_.findWhere(t,{uniqueId:n.uuid}));0<=e&&(t[e]&&t[e].streamsView&&c.streaViewCount--,t.splice(e,1))}},beforeStoreTempUpdate:function(){if(a.from&&"temp"!==a.from){var t=function(t){var e,a,i=this.attachTempArr.tempLocation,n=i.length;for(e=0;e<n&&(a=i[e],!(t<this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,{fP:a.fP}))));e++);return e<n?e:-1}.call(c,a.slideArrIndex);if(0<=t)return function(t){var e=this.attachTempArr.tempLocation,a=e.length,i=a-1;if(!(t<0||a<t))for(i=a-1;t<=i;i--)e[i+1]=e[i]}.call(c,t),t}}})}function h(){var t,e,a,i="";e=c.orderedListOfAttachedFile.indexOf(_.findWhere(c.orderedListOfAttachedFile,d)),a=c.orderedListOfAttachedFile[e],"temp"===r?(i=zmUtil.getSrcForTempAtt(a),t=c.attachTempArr.tempLocation.indexOf(_.findWhere(c.attachTempArr.tempLocation,d))):i=zmUtil.getTheSrc("FileDownload",a),v.imageEditTool.init({source:i,handBckObj:{attObj:a,from:r,attachTempArrIndex:t,slideArrIndex:e,searchObj:d},onAttach:s})}"temp"===r?(o=n.fP,d={fP:o}):"myAttachment"===r&&o&&(d={uuid:o}),i.on("click",function(t){var e,a,i,n=$.e(t.target||t.srcElement),o=zmUtil.isPreviewAvailable(m);if("filename"===n.attr("data-name")&&c.configJSON.renameSupport)v.utility.renameHelper.onRenameAction(n,n.closest(".zmL"));else if(n.hasClass("zmFrm")&&c.configJSON.renameSupport)n=n.find("span"),v.utility.renameHelper.onRenameAction(n,n.closest(".zmL"));else if("rename"===n.attr("data-name")&&c.configJSON.renameSupport)n=n.closest(".zmL").find(A),v.utility.renameHelper.onRenameAction(n,n.closest(".zmL"));else if("download"!==n.attr("data-name")&&o.isPrev)if("showMore"===n.attr("data-name"))if("SPAN"===n[0].nodeName)h();else{var s={par:n,parWidth:!0},l=[{txt:C.attachTemplateText.annotate,data:{action:"annotate"}}];n.find("b").addClass("SC_ddn"),n.closest(".zmL").addClass("sel"),s.list=l,s.divId="zmAtt_dropDown",s.clk=function(t){"annotate"===t.action&&(zmUtil.hideMenu(),h())},s.onHide=function(){n.find("b").removeClass("SC_ddn"),n.closest(".zmL").removeClass("sel")},s.showArrow=!0,zmUtil.isChildWindow()?((a=new zmDropDownMenu).setDropObj(s),a.paint()):zmUtil.showMenu(s)}else v.utility.initSlideshow.call(c,d);else 0<=(e=c.orderedListOfAttachedFile.indexOf(_.findWhere(c.orderedListOfAttachedFile,d)))&&(i=c.orderedListOfAttachedFile[e],"temp"===r?zmUtil.downloadTempAttachment({accId:c.accId,fP:i.fP,sN:i.sN,name:i.n||i.name,size:i.size}):zmUtil.downloadAttachment(i))}),v.utility.renameHelper.init({context:this,$ele:t,onChange:J,handbackData:{from:r,uuid:o||n.fP},orginalFileName:m,parentClass:"zmL"})}v.core={},v.utility=v.utility||{},v.virusCheckStatus={},v.utility.isAttachmentSelected=function(t){return!!t||(zmUtil.succErrMsg("e",C.selectAttach),!1)};var V={initDragDropArea:function(){var i=$.e(zmAttachment.templates.dropMsgTemplate()),n=this;if(this.$dropCenter instanceof $){this.$dropCenter.appendDOM(i),v.utility.setDragDrop({onDrop:function(t){var e,a;if(n.isUploadAllowed()&&(a=function(e){v.desktop.validateFile.call(n,e,e.name,function(t){t.status&&v.desktop.uploadFiles.call(n,[{file:e,fileName:t.name,isHuge:t.isHuge,isDocs:t.isDocs}])})},i.hide(),t))for(e=0;e<t.length;e++)a(t[e])},onDragLeave:function(){return n.isUploadAllowed()&&i.hide(),!1},onDragover:function(){n.isUploadAllowed()&&i.show()},$centerEle:this.$dropCenter,$dropMsgEle:i})}},initCloudApps:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(y()&&!i.prependAttach)return zmUtil.succErrMsg("e",C.offlineError),!1;var t=this.cloudAttRef,n=this;i.onRemove=function(){v.core.addRemoveClassToParentDom.call(n),v.core.onRemove.call(n),O.call(n,i)},i.onAddAtt=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length?arguments[1]:void 0,a=2<arguments.length?arguments[2]:void 0;v.core.addRemoveClassToParentDom.call(n),v.core.onAppend.call(n),v.core.onAllUploadFinish.call(n),_.size(t)?w.call(n,t,e,a):w.call(n,i)},zmCloudAtt&&(t||(t=zmCloudAtt.init(i.appName,this),this.cloudAttRef=t),t.init(i))},createActionMenu:function(){var t=this.$actionEle,a=this,e=t,i={par:e,parWidth:!0},n=[{txt:C.attachDropMenu.addWD,data:{action:"addToWD"}}],o=e.hasClass("zmAMItem");i.list=n,i.divId="zmAtt_dropDown",this.container&&(i.container=this.container),i.clk=function(t){if(zmUtil.hideMenu(),"addToWD"===t.action){var e=zmail.Settings.MailSuite.Settings.Integration.Constants;V.initCloudApps.call(a,{appName:e.ZOHOTEAMDRIVE,prependAttach:!1,composeApp:v.core.attachmentSection.call(this)})}},i.onHide=function(){$.e(e).removeClass("SC_ddnB SC_ddn"),a.onOpenClose({type:"hide"})},i.align="pleft",o&&(i.addParentClass=!0);var s=new zmDropDownMenu;if(s.setDropObj(i),s.paint(),$.subscribe("attachMenu/Remove",function(){$.e(e).removeClass("SC_ddnB SC_ddn")}),!o&&s&&s.dropObj){var l="SC_ddn";"bottom"===s.dropObj.mountPosition?l="SC_ddnB":"top"===s.dropObj.mountPosition&&(l="SC_ddn"),$.e(e).addClass(l)}a.onOpenClose({type:"select"})},bindClickEventToActionEle:function(){var a=this;this.$actionEle.click(function(t){var e=t.target||t.srcElement;a.isUploadAllowed()&&(zmUtil.hideMenu(),0===a.actionMode?$.e(e).hasClass("msi-barrow")||$.e(e).find(".msi-barrow").length?V.createActionMenu.call(a):a.init():1===a.actionMode?a.browseDesktop():a.init(),t.stopPropagation())})},addTempLocationAttachment:function(t){W.call(this,{success:[t]})},appendPreAttachedFile:function(t,e){var a=zmail.Settings&&zmail.Settings.MailSuite.Settings.Integration.Constants;a&&a.ZOHOTEAMDRIVE===String(t.appType)||t.attType===zmCloudAtt.attConst.ZOHOTEAMDRIVE?V.initCloudApps.call(this,{appName:a.ZOHOTEAMDRIVE,prependAttach:!0,files:t,attachmentSection:v.core.attachmentSection.call(this)}):t.fP?V.addTempLocationAttachment.call(this,t):v.myAttachment.appendAttachment.call(this,t,e)},processPreAttachedFile:function(a){var i=this,t=function(){var e,t;a?(e=!1,t=a):i.configJSON.preAttachedFile&&(t=i.configJSON.preAttachedFile,e=!0),t instanceof Array&&t.forEach(function(t){V.appendPreAttachedFile.call(i,t,e)},i)};zmail.isComposeMail?zmAppLoader.load("zm-settings-app-integrationsettings-apps-model").then(t):t()},doInitialAction:function(){this.$dropCenter instanceof $&&V.initDragDropArea.call(this),this.autoLaunch?this.init():this.$actionEle instanceof $?V.bindClickEventToActionEle.call(this):1===this.actionMode&&this.browseDesktop(),this.configJSON.preAttachedFile&&V.processPreAttachedFile.call(this)}};function Y(){var t,e=this.configJSON;this.actionMode=e.actionMode||0,e.$actionEle&&(this.$actionEle=e.$actionEle),e.container&&(this.container=e.container),e.appTypePopup&&(this.appTypePopup=e.appTypePopup),this.onOpenClose=e.onOpenClose||function(){},e.classToRemove&&(this.classToRemove=e.classToRemove),e.classToAdd&&(this.classToAdd=e.classToAdd),"function"==typeof e.onRemoveAttachment&&(this.onRemoveAttachment=e.onRemoveAttachment),"function"==typeof e.onAddAttachment&&(this.onAddAttachment=e.onAddAttachment),"function"==typeof e.onRemoveElement&&(this.onRemoveElement=e.onRemoveElement),"function"==typeof e.onAddElement&&(this.onAddElement=e.onAddElement),"function"==typeof e.updateAttachment&&(this.updateAttachment=e.updateAttachment),"function"==typeof e.updateVirus&&(this.updateVirus=e.updateVirus),e.$dropCenter&&(this.$dropCenter=e.$dropCenter),e.insertImage&&e.insertImage.constructor===Object&&(this.insertImage=e.insertImage),(t=e.myAttachment)&&t.constructor===Object&&"string"==typeof t.url&&t.params&&t.params.constructor===Object&&(this.myAttachment=e.myAttachment),void 0===e.maxAttachedSize&&(this.configJSON.maxAttachedSize=a),void 0===e.currentAttachedSize&&(this.configJSON.currentAttachedSize=i),this.hugeAttachment={attachedFiles:[],name:{},cloudLink:{},storeTempAttachment:[],isHugeUploadInProgress:0},v.hugeAttachment.setHugeMaxAttSize.call(this)}function G(t){this.dialog=void 0,this.isAttachingCount=0,this.fromDesktopCount=0,this.slideListCount=0,this.attachTempArr={tempLocation:[],myAttachment:[],offlineAttachment:[]},this.attachUtil=null,this.selectedattachUtilectsArr=[],this.asLink=!1,this.orderedListOfAttachedFile=[],this.streaViewCount=0,this.cloudAttRef="",this.desktopObj=[],this.filenameCountMap={},this.updateConfig(t);zmail.isZMOfflineEnabled&&_zm.isOfflineLockAvailable()&&t.offlineEnabled&&v.core.initOfflineData(this,t)}v.core.onAllUploadFinish=function(){var t,e,a=this.configJSON.onAllUploadFinish;this.isUploadCompleted()&&"object"===babelHelpers.typeof(a)&&"function"==typeof a.handler&&(t=this.attachTempArr,e=$.extend(!0,{},t),this.cloudAttRef?e.cloudAttList=this.cloudAttRef.getCloudAttachments():e.cloudAttList=[],a.resetData&&this.clearStoreAttachments(),a.removeAttachDOM&&this.$ele.find(".zmL.SC_Pbar").remove(),Array.isArray(e.myAttachment)&&e.myAttachment.filter(function(t){return delete t.uniqueId}),a.handler(e))},v.core.incrementAttachCount=function(){++this.isAttachingCount},v.core.decrementAttachCount=function(){0<this.isAttachingCount&&--this.isAttachingCount},v.core.addRemoveClassToParentDom=function(){var t=this.attachTempArr.myAttachment,e=this.attachTempArr.tempLocation;this.isAttachingCount||e.length||t.length?(this.classToAdd&&this.$ele.addClass(this.classToAdd),this.classToRemove&&this.$ele.removeClass(this.classToRemove)):this.classToRemove&&this.$ele.addClass(this.classToRemove)},v.core.onAppend=function(t){"function"==typeof this.onAddElement&&this.onAddElement(t)},v.core.onRemove=function(t){"function"==typeof this.onRemoveElement&&this.onRemoveElement(t)},v.core.resolveDeferred=function(){var e=this.deferred;e&&this.isUploadCompleted()&&this.isDeferredUploadEnable()&&this.getStoreAttachments().done(function(t){e.resolve(t)})},v.core.storeTempAttachments=function(i,n,t,e){var o=this,a=this.attachTempArr.tempLocation,s=a.length;if(s<t)for(;s<t;)a[s]=void 0,s++;this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(i.size||0),a.splice(t,1,i);n&&(n.data({uniqueId:i.fP}),n.find(".SC_icn").off("click").on("click",function(){if(!o.deferred){var t,e=o.attachTempArr.tempLocation,a=e.indexOf(_.findWhere(e,{fP:i.fP}))||0;0<=a&&(delete v.virusCheckStatus[i.fP],S.call(o)?zmAttachUtility.removeAttachments(n,"common"):n.remove(),t=e[a],o.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(i.size),e.splice(a,1),o.fromDesktopCount--,v.core.addRemoveClassToParentDom.call(o),function(t){var e={};t.sN&&(e.aId=this.accId,e.sN=t.sN,e.fP=window.encodeURIComponent(t.fP),e.mode="d",zmAjq.XHR({u:zmail.conPath+c,t:"POST",p:e}))}.call(o,t),v.core.onRemove.call(o)),v.utility.modifySlideshowArray.call(o,{fP:i.fP})}}),X.call(this,n,i,"temp"),v.utility.storeAttListForSlideshow.call(this,i,e,"tempAttachment",n))},v.core.initOfflineData=function(t,e){t.offlineRef=new zmail.Attachment.offline({componentId:e.storeAttachmentId}),function(){var a,i=[],n=this,o=[];n.offlineRef.getSavedFiles().then(function(t){if(n.offlineGetAttachDeferred&&n.offlineGetAttachDeferred.resolve(t.length),t&&t.length)for(var e=0;e<t.length;e++)t[e].fileMeta?o.push(t[e].fileMeta):(a={attachId:t[e].attachId,name:t[e].file.name,componentId:n.storeAttachmentId,size:t[e].file.size},i.push(a),v.desktop.addOfflineElement(n,a));o.length&&n.addFiles(o),n.attachTempArr.offlineAttachment=i},function(){n.offlineGetAttachDeferred&&n.offlineGetAttachDeferred.resolve(0)})}.call(t),t.isOfflineUploadInProgress=0,e.offlineUpload&&(t.offlineGetAttachDeferred=$.Deferred())},v.core.highlightRestrictedFile=function(t){var e=$.e(t).find(".zmSze"),a=zmAttachment.templates.blockedContentHtml();e.appendDOM(a),e.find(".attSize").hide(),t.addClass("zmBlockedFile"),t.find(".zmSub").remove(),t.find(".zmProgBar").remove()},G.prototype={init:function(t){if(t){var e=zmail.Settings&&zmail.Settings.MailSuite.Settings.Integration.Constants;e&&V.initCloudApps.call(this,{appName:e.ZOHOTEAMDRIVE,prependAttach:!1,attachmentSection:v.core.attachmentSection.call(this)})}else 1===this.actionMode?this.browseDesktop():(D.call(this),function(){this.asLink=!1}.call(this),function(){for(var t={id:"zmAttachCompWhtPopup",tabs:[]},e=this.configJSON.attachFrom,a=!1,i=0,n=e.length;i<n;i++)a=0===i,t.tabs.push(M.call(this,e[i],a));t.onClose=this.closeThisAppView.bind(this,!0),t.dialogDidMount=P.bind(this),t.dialogWillMount=function(t){t&&(this.dialog=t)}.bind(this),t.onMouseDown=function(){zmUtil.hideMenu()},t.classes="SC_add",this.dialog=zmsDialog.createTabPopupDialog(t)}.call(this),function(){var o=this;$.subscribe(p,function t(e,a,i,n){$.unsubscribe(p,t),o.cloudUpload(a,i,n)}),$.subscribe(g,function t(){$.unsubscribe(g,t),o.closeThisAppView()})}.call(this))},updateConfig:function(t){var e,a=this;null!==t&&"object"===babelHelpers.typeof(t)&&("object"===babelHelpers.typeof(this.configJSON)?(e=this.configJSON.componentId,$.extend(!0,this.configJSON,t)):this.configJSON=t,Array.isArray(t.attachFrom)&&(this.configJSON.attachFrom=t.attachFrom),t.componentId&&e&&t.componentId!==e&&(this.configJSON.maxAttachedSize=void 0),this.componentId=this.configJSON.componentId,t.offlineUpload||(this.autoLaunch=void 0===this.configJSON.autoLaunch||this.configJSON.autoLaunch,this.$ele=B(this.configJSON.eleId)),this.accId=this.configJSON.accId||zmUtil.getZohoAccId(),this.desktop=function(){var t={hugeFileCount:0},e=this.configJSON.desktop;return e?(t.uploadAPI=e.uploadAPI||R(),t.requireParamToUpload=e.requireParamToUpload||H.call(this),t.uploadCallBack=e.uploadCallBack,t.autoBrowse=e.autoBrowse,e.allowedType&&(t.allowedFileType=e.allowedType.type,t.fileTypeErr=e.allowedType.error||C.desktop.invalidFormat),"boolean"==typeof e.multiple?t.multiple=e.multiple:t.multiple="true",e.excludeType instanceof Object&&(t.excludeType=e.excludeType)):(t.uploadAPI=R(),t.requireParamToUpload=H.call(this),t.multiple="true"),t}.call(this),this.desktop&&!this.desktop.excludeType&&function(){var a=this,t=["ade","adp","bat","chm","cmd","com","cpl","exe","hta","ins","isp","jar","jse","lib","lnk","mde","msc","msp","mst","pif","scr","sct","shb","sys","vb","vbe","vbs","vxd","wsc","wsf","wsh","terminal"];n.extension?a.desktop.excludeType=n:s?a.desktop.excludeType={extension:t}:(s=!0,$.ajax({url:zmail.conPath+c,type:"GET",data:{mode:"blockAttType"},success:function(t){if(t){"string"==typeof t&&(t=JSON.parse(t));var e=t?t.types:[];n.extension=e,a.desktop.excludeType=n}},error:function(){n.extension=t,a.desktop.excludeType=n}}))}.call(this),void 0===this.maxAttachedSize&&function(e,a){var i,t={streams:"p",notes:"n",task:"t",bookmark:"l",mail:"m"},n=0<=e.indexOf("zmEdi_");if("number"!=typeof o[e])if(n&&"number"==typeof o.mail)"function"==typeof a&&a(o.mail);else{if(t[e])i=t[e];else{if(!n)return;i="m"}r[i]||(r[i]=!0,$.ajax({url:zmail.conPath+c,type:"POST",success:function(t){r[i]=!1,"number"==typeof(t=JSON.parse(t)).maxsize&&(n?o.mail=t.maxsize:o[e]=t.maxsize,"function"==typeof a&&a(t.maxsize))},error:function(){r[i]=!1},data:{entity:i,mode:"maxsize",zmrcsr:zmAjq.getCookie("zmcsr")}}))}else"function"==typeof a&&a(o[e])}(this.componentId,function(t){a.configJSON.maxAttachedSize=t}),Y.call(this))},isHugeAttachmentUploadEnabled:function(){return zmUtil.isHugeAttachmentUploadEnabled()&&e.call(this)},browseDesktop:function(){this.isUploadAllowed()&&v.desktop.browseDesktop.call(this)},uploadFiles:function(t){var e,a,i=this;if(this.isUploadAllowed()){var n=function(e){v.desktop.validateFile.call(i,e,e.name,function(t){t.status&&v.desktop.uploadFiles.call(i,[{file:e,fileName:t.name,isHuge:t.isHuge,isDocs:t.isDocs}])})};if(t instanceof window.File)n(t);else if(t.length)for(e=0,a=t.length;e<a;e++)n(t[e])}},addFiles:function(t){this.isUploadAllowed()&&t instanceof Array&&t.length&&V.processPreAttachedFile.call(this,t)},isStreamView:function(){return 0<this.streaViewCount},closeThisAppView:function(t){this.dialog&&(t||this.dialog.close(),$.unsubscribe(g),$.unsubscribe(p),document.body.removeEventListener("paste",l),function(){var t;this.desktopAttachedSize=void 0,this.dialog=void 0,this.selectedattachUtilectsArr=[],this.desktopObj=[],this.desktop.hugeFileCount=0,this.filenameCountMap={},this.attachUtil&&(t=this.attachUtil.cache,"object"===babelHelpers.typeof(t)&&t.flushExcept(this.attachUtil.appName,["l".concat(zmail.zuid,"all0 "),"t".concat(zmail.zuid,"all0 ")]),this.attachUtil=null)}.call(this),this.configJSON.onClose&&this.configJSON.onClose(),v.insertImage.clear(),$.q(f).remove())},getOfflineDeferred:function(){var t=$.Deferred();return this.offlineSendDeferred=t},cloudUpload:function(t,e,a,i){var n,o,h,s,u=this;(h=$.e(zmAttachment.templates.cloudAttTempLoadingBox())).find(".zmSub").clearHTML(),this.closeThisAppView(),v.core.incrementAttachCount.call(this),j.call(this),s=function(t){if(v.core.attachmentSection.call(u)?zmAttachUtility.removeAttachments(h,"common"):h.remove(),v.core.decrementAttachCount.call(u),t.success&&t.success.length){var e,a,i,n=u.configJSON.maxAttachedSize,o=u.configJSON.currentAttachedSize,s=C;for(e=0,a=t.success.length;e<a;e++)if(n<(o+=zmAttachUtility.parseToNumber(t.success[e].size||0))){t.success=t.success.splice(0,e);var l=n/1048576,r=a-e;i=zmText.applyArgs(s.maxsizeerr,{size:"".concat(l,"MB"),leftfiles:r}),zmUtil.succErrMsg("e",i);break}if(t.failure&&t.failure.length){var c=t.failure,d=c.length,m="";for(i=C.ajaxErr,e=0;e<d;e++)m+=m?", ".concat(c[0].fileName):c[0].fileName;_zm.succErrMsg("e",zmText.applyArgs(i.attFromCloudPartialErr,{filelist:m})),u.onUploadError()}W.call(u,t)}else t.failure&&t.failure.length&&("object"===babelHelpers.typeof(t.failure[0])&&"string"==typeof t.failure[0].msg?_zm.succErrMsg("e",t.failure[0].msg):_zm.succErrMsg("e",C.ajaxErr.attFromCloud),v.core.onRemove.call(u),u.onUploadError(),W.call(u,t));v.core.onAllUploadFinish.call(u)},h.find(".msi-close").on("click",function(){u.deferred||(n.abort(),v.core.decrementAttachCount.call(u),v.core.addRemoveClassToParentDom.call(u),v.core.onRemove.call(u))}),i="z"!==i?C.cloudServiceName.otherCloud:C.cloudServiceName.zDocs,o=zmText.applyArgs(C.attachingfrom,{filecount:e,servicename:i}),h.find(A).text(o),v.core.attachmentSection.call(this)?zmAttachUtility.appendAttachments(h,this.$ele,"common"):this.$ele.appendDOM(h),v.core.addRemoveClassToParentDom.call(this),v.core.onAppend.call(this);var l={docs:t,method:"attachFromCloud",groupId:zmail.zuid,entityType:1,accId:u.accId},r={u:"".concat(zmail.conPath,"/postAttach.do"),t:"POST",fn:s,p:l,csr:"s",efn:function(t,e,a){v.core.attachmentSection.call(u)?zmAttachUtility.removeAttachments(h,"common"):h.remove(),v.core.onRemove.call(u),"abort"!==a.statusText&&_zm.succErrMsg("e",C.ajaxErr.attFromCloud)}};"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){n=zmAjq.XHR(r),N(h)}):(n=zmAjq.XHR(r),N(h))},rejectDeferredOnError:function(){var t;this.deferred&&(t=this.deferred,this.deferred=void 0,t.reject({error:!0,handBckObj:this.configJSON.handBckObj}))},onUploadError:function(){this.rejectDeferredOnError()},isUploadAllowed:function(){return!this.deferred},isDeferredUploadEnable:function(){return this.configJSON.deferredUpload},isUploadCompleted:function(){return 0===this.isAttachingCount},isUploadInProgress:function(){return!this.isUploadCompleted()},isHugeFileUploadInProgress:function(){return 1===this.hugeAttachment.isHugeUploadInProgress},isOfflineFilesUploadInProgress:function(){return 1===this.isOfflineUploadInProgress},removeHugeFiles:function(t){v.hugeAttachment.removeHugeAttFiles.call(this,t)},getHugeLinkHTML:function(){return v.hugeAttachment.getHugeLinkHTML.call(this)},getCloudLinkHTML:function(){if(this.cloudAttRef)return this.cloudAttRef.getCloudLinkHTML()},removeCloudFiles:function(){this.cloudAttRef&&this.cloudAttRef.removeAllCloudAtt()},uploadOfflineAttachments:function(){if(0===this.isOfflineUploadInProgress){var e=this;e.isOfflineUploadInProgress=1,e.offlineRef.getSavedFiles().then(function(t){t.length&&v.desktop.uploadAllFiles.call(e,t)})}},clearAllOfflineFiles:function(){var a=this;a.offlineRef.getSavedFiles().then(function(t){if(t.length)for(var e=0;e<t.length;e++)a.offlineRef.removeFile(t[e].attachId)})},hasOfflineFiles:function(){return 0<this.attachTempArr.offlineAttachment.length},getStoreAttachments:function(t){var e=$.Deferred(),a={},i=this;if(_zm.isOfflineEnabled()&&!_zm.isOfflineSyncActive()&&this.attachTempArr.offlineAttachment.length&&i.uploadOfflineAttachments.call(this),i.isUploadCompleted()||t){var n=0;(function(){this.isUploadCompleted()&&(this.attachTempArr.tempLocation=k(this.attachTempArr.tempLocation,void 0))}).call(i);var o=function(){a.tempLocation=function(){var t,e,a=this.attachTempArr.tempLocation,i=a.length,n={fP:!0,sN:!0,size:!0,n:!0},o={},s=[];for(t=0;t<i;t++){if(o={},zmUtil.isNettyUploadEnabled()&&a[t]){if(!1===a[t].virusFree){s={error:!0,errorCode:11};break}if("pending"===a[t].virusFree){s={error:!0,errorCode:12};break}if("failed"===a[t].virusFree){s={error:!0,errorCode:13};break}}for(e in a[t])n[e]?o[e]=a[t][e]:"name"!==e||a[t].n||(o.n=a[t][e]);$.isEmptyObject(o)||s.push(o)}return s}.call(i),a.myAttachment=function(){var t,e,a=this.attachTempArr.myAttachment,i=a.length,n={},o=[];for(t=0;t<i;t++){for(e in n={},a[t])"uniqueId"!==e&&(n[e]=a[t][e]);o.push(n)}return o}.call(i);var t=i.attachTempArr.tempLocation.filter(function(t){return t});return n+=t.length,n+=i.attachTempArr.myAttachment.length,i.hugeAttachment&&Array.isArray(i.hugeAttachment.attachedFiles)&&i.hugeAttachment.attachedFiles.length&&(a.hugeAttachment=i.hugeAttachment.attachedFiles,n+=a.hugeAttachment.length),i.cloudAttRef?a.cloudAttList=i.cloudAttRef.getCloudAttachments():a.cloudAttList=[],_.isArray(a.cloudAttList)&&(n+=a.cloudAttList.length),a.attachmentCount=n,a};if(!i.isDeferredUploadEnable())return o();i.deferred=void 0,v.core.updatePendingVirusState.call(i,!0).then(function(){e.resolve(o())})}else i.isDeferredUploadEnable()&&(i.deferred=e);return!!i.isDeferredUploadEnable()&&e.promise()},getAllAttachedList:function(t){var e=this,a=k(e.orderedListOfAttachedFile,void 0);return t&&(e.hugeAttachment&&Array.isArray(e.hugeAttachment.storeTempAttachment)&&e.hugeAttachment.storeTempAttachment.length&&(a=a.concat(e.hugeAttachment.storeTempAttachment)),e.cloudAttRef&&(a=a.concat(e.cloudAttRef.getCloudAttachments()))),a},insertExtFiles:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length?arguments[1]:void 0,a=t.type,i=this,n=zdom("i",{className:"".concat({eml:"msi-atteml",writer:"msi-attdoc",sheet:"msi-attsheet",show:"msi-attppt",others:"msi-attothers"}[a]," zm-attIcn")}),o="";"eml"===a&&(o=t.thrd?"thread":"mail");var s=zmAttachment.templates.attListingTemplate({name:t.fname,image:n,size:o});$.e(s).addClass("noHvr"),$.e(_zm(".","zmSub",s)[0]).remove(),_zm(".","SC_icn",s)[0].onclick=function(){S.call(i)?zmAttachUtility.removeAttachments(s,"common"):$.e(s).remove(),i.onRemoveElement(),"function"==typeof e&&e(t)},S.call(i)?zmAttachUtility.appendAttachments(s,i.$ele,"common"):i.$ele.appendDOM(s),i.onAddElement()},clearStoreAttachments:function(){this.attachTempArr.tempLocation=[],this.attachTempArr.myAttachment=[],this.orderedListOfAttachedFile=[],this.configJSON.currentAttachedSize=0,this.fromDesktopCount=0,this.slideListCount=0,this.streaViewCount=0,this.cloudAttRef&&(this.cloudAttRef.clearCloudAttachments(),this.cloudAttRef="")}},v.init=function(t,e){var a;return a=e||new G(t),t.offlineUpload||V.doInitialAction.call(a),a},v.cloudUpload=function(t,e,a){$.publish(p,[t,e,a])},v.closeThisAppView=function(t){$.publish(g,[t])},v.core.bindTempListedAttachment=X,v.core.checkAppendElePresence=j,v.core.showDummyProgress=N,v.core.showProgressReq=function(t,e){var a=Math.round(100*e.loaded/e.total);t.find(d).width("".concat(a,"%"))},v.core.isNettyUploadEnabled=b,v.core.isComposeApp=e,v.core.attachmentSection=S,v.core.setOfflineAttachment=function(t){this.attachTempArr.offlineAttachment.push(t)},v.core.removeOfflineAttachment=function(e){var t=this.attachTempArr.offlineAttachment,a=t.findIndex(function(t){return t.attachId===e});t.splice(a,1),this.attachTempArr.offlineAttachment=t},v.core.getOfflinedataInfo=function(t,a){var i;return t.find(function(t,e){if(t.attachId===a)return i=e}),i},v.getAttachComponent=G,v._i18N=C,v.virusCheckStatusUpdate=function(t){var e=t.STATUS,a=this.attachTempArr.tempLocation,i={fP:t.FILEPATH},n=a.indexOf(_.findWhere(a,i));e===zmAttachUtility.errorConstants.virusFound?e=!1:e===zmAttachUtility.errorConstants.virusFailed||e===zmAttachUtility.errorConstants.virusError?e="failed":e===zmAttachUtility.errorConstants.pending&&(e="pending"),0<=n&&(a[n].virusFree=e,q.call(this,t.FILEPATH,void 0,e)),x.call(this,{fp:t.FILEPATH,value:e})},v.virusAttachmentUpdate=q,v.getDefaultUploadAPIPath=R,v.utility.getElementReference=B,v.utility.initSlideshow=function(t){var e,a=[],i=[];e=(i=k(this.orderedListOfAttachedFile,void 0)).indexOf(_.findWhere(this.orderedListOfAttachedFile,t)),i.forEach(function(t){var e=zmUtil.fileTyp(t.fn||t.name)[1]===z?101:103;a.push({ft:e,fn:t.n||t.fn||t.name,src:t.src})}),zmUtil.initAttSlideShow({startIndex:e||0,attObjList:a,hideAllOptions:!0,ignoreEMLParsing:!0})},v.utility.modifySlideshowArray=function(t){var e,a=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,t));return 0<=a&&(this.slideListCount--,e=this.orderedListOfAttachedFile[a],this.orderedListOfAttachedFile.splice(a,1),O.call(this,e)),a},v.utility.storeAttListForSlideshow=function(t,e,a,i){var n,o=zmUtil.isPreviewAvailable(t.fn||t.name);if(o.isPrev&&(t.src="myAttachment"===a?zmUtil.getTheSrc(o.apiName,t):zmUtil.getSrcForTempAtt(t,this.accId)),(n=this.orderedListOfAttachedFile.length)<e)for(;n<e;)this.orderedListOfAttachedFile[n]=void 0,n++;this.orderedListOfAttachedFile.splice(e,1,t),w.call(this,t,i,a)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(t){var o,s={},l=!1;function e(t,e){var a,i,n=this.desktopObj;t<e?n.splice(e,0,n.splice(t,1)[0]):e<t&&(0===e?(a=n.splice(t,1),this.desktopObj=a.concat(n)):(a=n.splice(0,e),i=n.splice(t-e,1),this.desktopObj=a.concat(i.concat(n))))}t.utility=t.utility||{},t.utility.fileReorder={},t.utility.fileReorder.handleDragStart=function(t){var e=t.target||t.srcElement,a=$.e(e).closest(".zmL"),i=this.desktopObj[a.index()].fileName;if(i=zmUtil.getSubString(20,i),-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&t.originalEvent.dataTransfer.setData("text/plain",i),"function"==typeof t.originalEvent.dataTransfer.setDragImage){$.q("#zacdummydrag").remove();var n=zdom("div",{id:"zacdummydrag",className:"SC_dg",style:{top:"0px",left:"-1000px"}},i);document.body.appendChild(n),t.originalEvent.dataTransfer.setDragImage(n,0,0)}l=!0,o=this.dialog.$el,s.dragElement=a,s.dragElementIndex=a.index()},t.utility.fileReorder.handleDragOver=function(t){var e,a;l&&(e=t.target||t.srcElement,a=$.e(e).closest(".zmL"),o.find(".dragtheme").remove(),s.dragOverElement=a,s.dragOverElementIndex=a.index(),s.dragElementIndex<s.dragOverElementIndex?$.e(zmAttachment.templates.dragtheme).insertDOMAfter(a):s.dragElementIndex>s.dragOverElementIndex&&$.e(zmAttachment.templates.dragtheme).insertDOMBefore(a))},t.utility.fileReorder.handleDragEnd=function(){o.find(".dragtheme").remove(),s.dragElementIndex<s.dragOverElementIndex?(s.dragElement.detach().insertDOMAfter(s.dragOverElement),e.call(this,s.dragElementIndex,s.dragOverElementIndex)):s.dragElementIndex>s.dragOverElementIndex&&(s.dragElement.detach().insertDOMBefore(s.dragOverElement),e.call(this,s.dragElementIndex,s.dragOverElementIndex))}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(k){var w=k._i18N,O="msi-attimg";k.desktop={},k.utility=k.utility||{};var m={doc:!0,docx:!0,rtf:!0,odt:!0,xls:!0,xlsx:!0,csv:!0,ods:!0,ppt:!0,pptx:!0,odp:!0};function p(o){var s=this.desktopObj[o.index()],t=s.file,l=this;k.imageEditTool.init({file:t,handBckObj:s,onAttach:function(t){var e,a,i,n=t.blob;n.name=o.find("#listView").text(),l.desktopObj[o.index()]={file:n,fileName:s.fileName},e=o,a=n,i=k.utility.createObjectURL(a,4e3),e.find(".zmImg img").attr("src",i)}})}function g(t){var e,a,i=0,n=this.filenameCountMap,o=t.lastIndexOf(".");return n[t]?(i=n[t],n[t]+=1):n[t]=1,0<i&&(a=zmUtil.fileTyp(t)[2],e=-1!==o?t.substr(0,o):t,1===i?e+="_(copy)":e="".concat(e,"_(copy").concat(i-1,")"),t=a.length?"".concat(e,".").concat(a):e),t}function h(t){return Math.ceil(1024*t)}function s(t,e){var a,i=this.configJSON.currentAttachedSize,n=zmAttachUtility.parseToNumber(t.size||0);if(i+=n,t.size<=0)return e&&zmUtil.succErrMsg("e",zmText.applyArgs(w.desktop.zero_size,{name:t.name})),{status:!1};if(i>this.configJSON.maxAttachedSize){var o=zmail.usageDetails||{},s=parseInt(o.allotedUsage),l=parseInt(o.curUsage);zmail.RefusageDetails&&(s=h((o=zmail.RefusageDetails||{}).allotedSpace),l=h(o.curUsage));var r,c=s-l,d=zmAttachUtility.constants.HUGE_ATT_UPER_LIMIT;if(n>this.configJSON.maxAttachedSize&&n<=d&&this.isHugeAttachmentUploadEnabled()&&n<=c&&!_zm.isOfflineSyncActive())return{status:!0,isHuge:!0};if(e)n>this.configJSON.maxAttachedSize&&n<=d&&this.isHugeAttachmentUploadEnabled()&&n<=c&&_zm.isOfflineSyncActive()?zmUtil.succErrMsg("e",w.hugeAttach.errMsg.offlinehuge):this.isHugeAttachmentUploadEnabled()&&d<n?(r=zmText.applyArgs(w.hugeAttach.errMsg.sizeExceed,{size:zmUtil.sizeConv(d)}),zmUtil.succErrMsg("e",r)):c<n?(r=zmText.applyArgs(w.hugeAttach.errMsg.storageExceed,{size:zmUtil.sizeConv(s)}),zmUtil.succErrMsg("e",r)):zmUtil.succErrMsg("e","".concat(w.maxSizeErr1," ").concat(zmUtil.sizeConv(this.configJSON.maxAttachedSize)));return{status:!1}}return{status:!0,isDocs:(a=t.name,m[zmUtil.fileTyp(a)[2]]&&zmail.showFeature)}}function t(){try{return new window.XMLHttpRequest}catch(t){}}function e(){return t()||function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}()}function l(){if(window.FormData)return new window.FormData;zmUtil.succErrMsg("e",w.desktop.upload_unsupport_browser)}k.utility.createXHR=function(){return window.ActiveXObject?e():t()},k.desktop.dialogDidMount=function(t,e){this.desktop.autoBrowse&&(t.$el.hide(),k.desktop.attachFromDesktopTab.call(this,!0))},k.desktop.onTabSelection=function(){this.desktopObj.length||this.desktop.autoBrowse||k.desktop.attachFromDesktopTab.call(this)},k.desktop.onPaste=function(t){var e,a,i,n,o=t.clipboardData.items,s=this;for(n=function(t){k.desktop.validateFile.call(s,t,t.name,function(t){e="ScreenShot_".concat((new Date).getMilliseconds(),".png"),t.status&&k.desktop.addAttachmentInDesktopTab.call(s,{file:a,name:e,isHuge:t.isHuge})})},i=0;i<o.length;++i)"file"===o[i].kind&&-1!==o[i].type.indexOf("image/")&&(a=o[i].getAsFile())&&(a.name||(a.name="ScreenShot_".concat((new Date).getMilliseconds(),".png")),n(a))},k.desktop.getFormData=function(t){var e=l(),a=zmAjq.getCookie("zmcsr"),i=t.file,n=t.name||i.name,o=encodeURIComponent(n);for(var s in e.append("attach",i,o),k.core.isNettyUploadEnabled()||(e.append("fileName",o),e.append("zmrcsr",a)),this.desktop.requireParamToUpload)e.append(s,this.desktop.requireParamToUpload[s]);return e},k.desktop.removeOfflineIndex=function(t,e){var a=k.core.getOfflinedataInfo(this.attachTempArr.offlineAttachment,t);-1!==a&&this.attachTempArr.offlineAttachment.splice(a,1),this.offlineRef.removeFile(t);var i={offline:!0,count:this.attachTempArr.offlineAttachment.length};k.core.onRemove.call(this,i),"function"==typeof this.onRemoveAttachment&&this.onRemoveAttachment(i),0===this.attachTempArr.offlineAttachment.length&&(this.isOfflineUploadInProgress=0,this.offlineSendDeferred&&(e?this.offlineSendDeferred.reject(e.errorMsg):this.offlineSendDeferred.resolve()))},k.desktop.uploadAllFiles=function(s,t){if(s.length){var l=this,r=function(t){k.desktop.removeOfflineIndex.call(l,t)};!function t(){for(var e,a,i,n=5<s.length?s.splice(0,5):s.splice(0,s.length),o=0;o<n.length;o++)e=n[o].name,a=n[o],i=n[o].attachId,a.fileMeta?l.addFiles(a.fileMeta):k.desktop.fileUpload.call(l,{name:e,file:a.file,attId:i,offlineAttachId:i,onStoreTempUpdate:r,offlineUpload:!0});s.length&&setTimeout(function(){t()},200)}()}},k.desktop.saveOnlineFileMeta=function(t,e){for(var a=e.hugeAttachment&&e.hugeAttachment.length?e.hugeAttachment:[],i=t.attachTempArr.tempLocation.concat(a,e.cloudAttList,e.myAttachment),n=0;n<i.length;n++)t.offlineRef.saveFile(i[n])},k.desktop.addOfflineElement=function(t,e,a){var i=e.name||e.file.name,n=$.e(zmAttachment.templates.cloudAttTempLoadingBox({name:i,offAttId:e.attachId,offline:!0,image:zmAttachment.templates.attPrevInr({fn:i})}));t.$ele&&zmAttachUtility.appendAttachments(n,t.$ele,"common"),k.core.setOfflineAttachment.call(t,{attachId:e.attachId,name:i}),$.e(n).find(".attSize").text(zmUtil.sizeConv(e.size)),$.e(n).find(".SC_icn").click(function(){k.desktop.removeOfflineIndex.call(t,e.attachId),$.e(n).remove()}),k.core.onAppend.call(t,{offline:!0,count:t.attachTempArr.offlineAttachment.length}),a&&"function"==typeof t.configJSON.onAddAttachment&&t.configJSON.onAddAttachment({offline:!0,count:t.attachTempArr.offlineAttachment.length})},k.core.errorMessageHandling=function(t){var e,a,i=zmAttachUtility.statusCodes,n=t.responseText||"",o="";switch(a=k.core.isNettyUploadEnabled()&&n?(a=JSON.parse(t.responseText))[0]&&a[0].resData?a[0].resData[0]:a[0].errorCode:n?JSON.parse(n):"",t.status){case i.BAD_REQUEST:case i.FORBIDDEN:e=zmAttachUtility.errorMsgs[a],o=a;break;case i.UNAUTHORISED:case i.INTERNAL_SERVER_ERROR:e=zmAttachUtility.errorMsgs[10002];break;case i.NOT_FOUND:e=zmAttachUtility.errorMsgs[10017];break;case i.PAYLOAD_LARGE:e=zmAttachUtility.errorMsgs[10018];break;case i.TOO_MANY_REQ:e=zmAttachUtility.errorMsgs[10012]}return{errorMsg:e,errorCode:o}},k.desktop.fileUpload=function(l){if(this.configJSON.offlineEnabled&&_zm.isOfflineSyncActive()){var a=this;return this.offlineRef||k.core.initOfflineData(this,a.configJSON),void k.desktop.validateFile.call(a,l.file,l.name,function(t){t.status&&a.offlineRef.saveFile(l).then(function(t){var e=a.getStoreAttachments();e&&e.attachmentCount&&k.desktop.saveOnlineFileMeta(a,e),k.desktop.addOfflineElement(a,t,!0)})})}var r,t,n,o,s,e,i,c,d=k.utility.createXHR(),m=k.desktop.getFormData.call(this,l),h=l.file,u=h.size,f=l.name||h.name,p=encodeURIComponent(f),g=k.core.isNettyUploadEnabled(),v=this,z=!1;if(g&&-1!==this.desktop.uploadAPI.indexOf("checkOffline")){c=_zm.isWSActive();var A={};l.offlineUpload&&(A.virusCheck=!1),this.desktop.uploadAPI=zmAttachComponent.getDefaultUploadAPIPath(A)}if(void 0===m)return!1;if(!function(t){return this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(t||0),!(this.configJSON.currentAttachedSize>this.configJSON.maxAttachedSize&&(zmUtil.succErrMsg("e","".concat(w.maxSizeErr1," ").concat(zmUtil.sizeConv(this.configJSON.maxAttachedSize))),this.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(t||0),1))}.call(this,u))return!1;if(k.core.incrementAttachCount.call(this),k.core.checkAppendElePresence.call(this),g&&(d.withCredentials=!0),v.configJSON.eleId){var C=zmUtil.fileTyp(f);if((e=C[1])===O&&(t=k.utility.createObjectURL(h,4e3)),r="notes"!==v.configJSON.componentId||v.configJSON.smartCompose?$.e(zmAttachment.templates.cloudAttTempLoadingBox({name:f,image:zmAttachment.templates.attPrevInr({fn:f,thn:t})})):$.e(zmAttachment.templates.cloudAttTempLoadingBoxNotes({name:f,image:zmAttachment.templates.attPrevInr({fn:f,thn:t})})),n="number"==typeof l.dIndex?l.dIndex:this.fromDesktopCount++,o="number"==typeof l.sIndex?l.sIndex:this.slideListCount++,r){var y="SC_icn";"notes"!==v.configJSON.componentId||v.configJSON.smartCompose||(y="zmNoteAttItemClose"),r.find(".".concat(y)).on("click",function(){v.deferred||(d.abort(),v.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(u||0),k.core.decrementAttachCount.call(v),k.core.addRemoveClassToParentDom.call(v),k.core.attachmentSection.call(v)?zmAttachUtility.removeAttachments(r,"common"):r&&r.remove(),k.core.onRemove.call(v))})}"notes"===v.configJSON.componentId||v.configJSON.smartCompose||(v.configJSON.renameSupport?e===O&&zmAttachUtility.annotateImage[C[2]]||r.find('.zmSub i[data-name="showMore"]').remove():(i=r.find('.zmSub span[data-name="rename"]'),e===O&&zmAttachUtility.annotateImage[C[2]]?i.attr("data-name","showMore").text(w.attachTemplateText.annotate):i.remove(),r.find('.zmSub i[data-name="showMore"]').remove()),r.find(".zmSub").addClass("SC_vh"));var b=function(){var t=!1;if(v.configJSON.offlineEnabled&&l.offlineAttachId){var e=v.$ele.find("#".concat(l.offlineAttachId));r.insertDOMAfter(e),e.remove()}else l.$replaceEle instanceof $?(r.insertDOMAfter(l.$replaceEle),l.$replaceEle.remove(),t=!0):k.core.attachmentSection.call(v)?(zmAttachUtility.appendAttachments(r,v.$ele,"common"),r[0].scrollIntoView()):"notes"!==v.configJSON.componentId||v.configJSON.smartCompose?v.$ele.appendDOM(r):v.$ele.find(".zmNoteAttItemWra").appendDOM(r);k.core.addRemoveClassToParentDom.call(v),t||k.core.onAppend.call(v)};g?d.onloadstart=function(){b()}:d.upload.addEventListener("loadstart",function(){b()},!1),d.upload.addEventListener("progress",function(t){k.core.showProgressReq(r,t)},!1)}var S=function(t){if(!z){var e;z=!0;var a,i,n=t.responseText||"";e=g&&n?(e=JSON.parse(d.responseText))[0]&&e[0].resData?e[0].resData[0]:e[0].errorCode:n?JSON.parse(n):"",d.status?a=(i=k.core.errorMessageHandling(d)).errorMsg:e&&e.emsg?a=e.emsg:zmAttachUtility.errorMsgs[e]&&(a=zmAttachUtility.errorMsgs[e]),a=a||w.ajaxErr.attFromDesktop;var o=i.errorCode===zmAttachUtility.errorConstants.errContType,s="function"==typeof l.onerror;!i||i&&!i.errorCode||s?_zm.succErrMsg("e",a):o&&k.core.highlightRestrictedFile.call(v,r),v.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(u||0),k.core.decrementAttachCount.call(v),s?l.onerror.call(v,r):k.core.attachmentSection.call(v)&&!o?zmAttachUtility.removeAttachments(r,"common"):r&&!o&&r.remove(),o||k.core.onRemove.call(v),k.core.onAllUploadFinish.call(v),v.onUploadError(),v.configJSON.offlineEnabled&&l.offlineUpload&&v.offlineSendDeferred&&k.desktop.removeOfflineIndex.call(v,l.offlineAttachId,{rejectCall:!0,errorMsg:a})}};d.onreadystatechange=function(){if(4===d.readyState)if(d.status===zmAttachUtility.statusCodes.SUCCESS){var t=JSON.parse(d.responseText);if(g&&(t=t[0].resData?t[0].resData[0]:t[0].errorCode),v.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(u||0),k.core.decrementAttachCount.call(v),t.fP||1===t[0]){if(v.configJSON.eleId){if(r.data({uniqueId:t.fP}),r.find("#progressbar").parent(".zm_lbl").remove(),r.find(".zmSub").removeClass("SC_vh"),r.find(".attSize").text(zmUtil.sizeConv(u)),g)if(t.virusCheckOnline)t.virusFree=!0;else{var e=k.virusCheckStatus[t.fP]||{};void 0===e.value?(t.virusFree="pending",k.virusCheckStatus[t.fP]={reference:v},k.virusAttachmentUpdate.call(v,t.fP,void 0,"pending")):(e.value===zmAttachUtility.errorConstants.virusFound?e.value=!1:e.value===zmAttachUtility.errorConstants.virusFailed&&(e.value="failed"),t.virusFree=e.value,k.virusAttachmentUpdate.call(v,t.fP,void 0,e.value),delete k.virusCheckStatus[t.fP]),v.isUploadCompleted()&&setTimeout(function(){k.core.updatePendingVirusState.call(v)},1e4)}"function"==typeof l.beforeStoreTempUpdate&&"number"==typeof(s=l.beforeStoreTempUpdate(n,o))&&(n=s),k.core.storeTempAttachments.call(v,t,r,n,o),k.core.resolveDeferred.call(v)}if("function"==typeof l.onsuccess&&l.onsuccess.call(v),"function"==typeof l.onStoreTempUpdate&&v.configJSON.offlineEnabled){var a=v.attachTempArr.tempLocation.length;k.core.storeTempAttachments.call(v,t,"",a),l.onStoreTempUpdate.call(v,l.offlineAttachId)}v.desktop.uploadCallBack&&v.desktop.uploadCallBack(t,r)}else{var i=w.ajaxErr.attFromDesktop;0===t[0]?i=w.ajaxErr.attFromDesktop:t.emsg&&"string"==typeof t.emsg?i=t.emsg.replace(/\\x20/g," "):g&&t&&(i=zmAttachUtility.errorMsgs[t]?zmAttachUtility.errorMsgs[t]:w.ajaxErr.attFromDesktop),_zm.succErrMsg("e",i),"function"==typeof l.onerror?l.onerror.call(v,r):(k.core.attachmentSection.call(v)?zmAttachUtility.removeAttachments(r,"common"):r&&r.remove(),k.core.onRemove.call(v)),v.onUploadError(),v.configJSON.offlineEnabled&&l.offlineUpload&&v.offlineSendDeferred&&k.desktop.removeOfflineIndex.call(v,l.offlineAttachId,{rejectCall:!0,errorMsg:i})}k.core.onAllUploadFinish.call(v)}else S(d)},d.onerror=function(){var t=arguments.length<=0?void 0:arguments[0],e="";t&&t.target&&(e=t.responseText||""),S(e)},d.open("POST",this.desktop.uploadAPI,!0),g&&(d.setRequestHeader("x-filename",p),d.setRequestHeader("zuid",zmail.zuid),c&&zmail.isWSEnabled&&zmail._ws&&zmail._ws.getSessionId()&&d.setRequestHeader("sId",zmail._ws.getSessionId())),d.send(m)},k.desktop.attachFromDesktopTab=function(e){var t,a=this;$.q("#zmAttach_file_Desktop").remove(),$.e(document.body).appendDOM(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),t=$.q("#zmAttach_file_Desktop"),this.desktop.multiple&&t.attr("multiple","true"),this.desktop.allowedFileType&&t.attr("accept",this.desktop.allowedFileType),t.off("change").on("change",function(t){return function(t,e){var a,i,n=(t.target||t.srcElement).files,o=n.length,s=this;for("function"!=typeof e&&(e=k.desktop.addAttachmentInDesktopTab.bind(this)),i=function(t){k.desktop.validateFile.call(s,t,t.name,function(t){t.status&&e({file:t.file,name:t.name,isHuge:t.isHuge,isDocs:t.isDocs})})},a=0;a<o;a++)i(n[a])}.call(a,t,e),a.desktopObj.length&&a.desktop.autoBrowse&&"boolean"==typeof e&&a.dialog.$el.show(),this.value="",!1}),this.desktop.autoBrowse&&function(){var t=this,e="mousedown.attCmp";$.e(document.body).off(e).on(e,function(){$.e(document.body).off(e),t.dialog&&"none"===t.dialog.$el.css("display")&&t.closeThisAppView()})}.call(this),t.click()},k.desktop.addAttachmentInDesktopTab=function(o){var s,r,c=this,d=o.file,m=o.name||d.name,t=zmAttachUtility.parseToNumber(d.size||0),h=zmUtil.isPreviewAvailable(m),u=zmUtil.fileTyp(m,o.isHuge?zmAttachUtility.fileType.hugeAttachment:""),f=this.dialog.getCenterElem("zDesktop").find(".SC_mclst"),e=this.configJSON.maxAttachedSize,a=function(){if(m=m.replace(/[<>]/g,""),m=g.call(this,m),this.desktopObj.push({file:d,fileName:m,isHuge:o.isHuge,userPreferenceForHA:o.isHuge,isDocs:o.isDocs}),-1!==d.type.indexOf("image/")){var t=k.utility.createObjectURL(d,4e3);s=zdom("img",{src:t})}else s=zdom("i",{className:"".concat(u[1]," zm-attIcn")});var l=$.e(zmAttachment.templates.desktopListTemplate({name:m,size:zmUtil.sizeConv(d.size),image:s}));f.appendDOM(l),function(t){var e=this;t.find(".zmFlt").on("drag",function(t){zmUtil.stopEvents(t,!0)}),t.find(".zmFlt").on("dragstart",function(t){zmUtil.stopEvents(t,!0),k.utility.fileReorder.handleDragStart.call(e,t)}),t.on("dragover",function(t){zmUtil.stopEvents(t),k.utility.fileReorder.handleDragOver.call(e,t)}),t.on("dragend",function(t){zmUtil.stopEvents(t),k.utility.fileReorder.handleDragEnd.call(e,t)})}.call(this,l),1===f.children().length&&(l.find(".zmFrm").find("span").addClass("sel"),this.dialog.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")),r=l.find(".zmSub").find("span"),h.isPrev&&"FileDownload"===h.apiName&&"html"!==u[2]&&"htm"!==u[2]||r.eq(0).remove();var e=zmUtil.fileTyp(m);e[1]===O&&zmAttachUtility.annotateImage[e[2]]||r.eq(1).remove(),l.click(function(t){var e,a,s,i,n,o;switch((t.target||t.srcElement).id){case"zmSubDownload":i=c.desktopObj[l.index()],n=k.utility.createObjectURL(i.file,5e3),o=zdom("a",{href:n,download:i.fileName}),document.body.appendChild(o),o.click(),$.e(o).remove();break;case"zmSubView":e=c.desktopObj,a=l.index(),s={startIndex:a||0,attObjList:[],hideAllOptions:!0,ignoreThumb:!0,ignoreEMLParsing:!0,isDataURL:!0,onCancel:function(){s.attObjList.forEach(function(t){t.src&&k.utility.revokeObjectURL(t.src)})}},Array.isArray(e)&&e.forEach(function(t,e){var a,i=t.file,n=zmUtil.fileTyp(i.name),o=zmUtil.isPreviewAvailable(i.name);o.isPrev&&"FileDownload"===o.apiName?({pdf:1,html:1,htm:1}[n[2]]||"text/plain"===i.type||n[1]===O||(i=new Blob([i],{type:"text/plain"})),a=k.utility.createObjectURL(i),s.attObjList.push({ft:"msi-attimg"===n[1]?101:103,fn:t.fileName,src:a})):e<=s.startIndex&&(s.startIndex-=1)}),zmUtil.initAttSlideShow(s);break;case"zmSubAnnotate":p.call(c,l);break;case"zmSubRemove":(function(t){var e=this.dialog.getCenterElem("zDesktop").find(".SC_mclst"),a=t.index(),i=this.desktopObj[a];this.desktopAttachedSize-=zmAttachUtility.parseToNumber(this.desktopObj[a].file.size||0),i.isHuge&&this.desktop.hugeFileCount--,this.desktopObj.splice(a,1),1===e.children().length?this.dialog.getCenterElem("zDesktop").find(".SC_drop").addClass("SC_dropW100"):0===a&&t.next().find(".zmFrm").find("span").addClass("sel"),t.remove()}).call(c,l)}});var a,i,n=l.find("#listView");n.focus(function(){var t=$.e(this);a=t.text(),-1!==(i=a.lastIndexOf("."))&&t.text(a.substring(0,i)),t.addClass("sel")}),n.keypress(function(t){13===t.which&&(t.preventDefault(),$.e(this).blur())}),n.keyup(function(t){var e;27===t.which&&(t.preventDefault(),e=-1!==i?a.substring(0,a.lastIndexOf(".")):a,n.text(e),n.blur())}),n.blur(function(){var t=$.e(this);-1!==i&&t.text(t.text()+a.substring(i,a.length)),l.index()&&t.removeClass("sel"),a!==t.text()&&function(a,i,t){var e=w.desktop,n=a.text(),o=function(t,e){a.text(t),i.find(".zmSub").find("#zmWrnMsg").text(e),i.addClass("SC_renErr"),window.setTimeout(function(){i.removeClass("SC_renErr")},2e3)};0<=n.indexOf(">")||0<=n.indexOf("<")?o(t,w.desktop.charnotallowed):n.length?(n=g.call(this,n),a.text(n),this.desktopObj[i.index()].fileName=n):o(t,e.fileNameErr)}.call(c,t,l,a)}),$.e(n).on("paste",function(t){t.stopPropagation()})};if(!o.isHuge||o.isHuge&&_zm.isOfflineSyncActive()){if(void 0===this.desktopAttachedSize&&(this.desktopAttachedSize=this.configJSON.currentAttachedSize),this.desktopAttachedSize+=t,this.desktopAttachedSize>e)return zmUtil.succErrMsg("e","".concat(w.maxSizeErr1," ").concat(zmUtil.sizeConv(e))),this.desktopAttachedSize-=zmAttachUtility.parseToNumber(d.size||0),!0;a.call(this)}else this.desktop.hugeFileCount<k.hugeAttachment.getHugeFileUploadLimit()?(this.desktop.hugeFileCount++,k.hugeAttachment.showHugeAttachmentMsgDialog.call(this,{filename:m,maxSize:e}).done(a.bind(this)).fail(function(){c.desktop.hugeFileCount--})):k.hugeAttachment.showHugeUploadLimitMessage()};var o=function(e,t){var a=e.file,i=e.fileName||a.name,n=this,o=function(){var t={file:a,name:i};e.isHuge?k.hugeAttachment.upload.call(n,t):e.isDocs?k.zDocs.FileUploader.call(n,t):k.desktop.fileUpload.call(n,t)};t||!e.isHuge?o():k.hugeAttachment.showHugeAttachmentMsgDialog.call(this,{filename:i,maxSize:n.configJSON.maxAttachedSize}).done(o).fail(function(){})};k.core.updatePendingVirusState=function(t){var s=this;return new Promise(function(n){var t=s.attachTempArr.tempLocation||[],e=[];if(t.forEach(function(t){"pending"===t.virusFree&&e.push(encodeURIComponent(t.fP))}),e.length){e=e.join(",");var o=new XMLHttpRequest;o.open("GET","https://".concat(zmail.urls.uploadurl,"/getVirusCheckStatus?filePaths=").concat(e),!0),o.withCredentials=!0,o.onreadystatechange=function(){if(4===o.readyState&&o.status===zmAttachUtility.statusCodes.SUCCESS){for(var t=JSON.parse(o.responseText)[0].resData,e=t.length,a=0;a<e;a++)t[a].FILEPATH=decodeURIComponent(t[a].FILEPATH),zmAttachComponent.virusCheckStatusUpdate.call(s,t[a]);var i=t.find(function(t){return t.STATUS===zmAttachUtility.errorConstants.pending&&t.FILEPATH})||{};_.size(i)?setTimeout(function(){k.core.updatePendingVirusState.call(s)},3e4):n()}},o.send()}else n()})},k.desktop.uploadFiles=function(t){var e,a,i,n=!0;if(t&&(n=!1),i=(t=t||this.desktopObj).length)for(a=0;a<i;a++)window.FormData?(e=t[a],o.call(this,e,n)):zmUtil.succErrMsg("e",w.desktop.upload_unsupport_browser);else zmUtil.succErrMsg("e",w.desktop.pleaseattach)},k.desktop.browseDesktop=function(){var e=this;k.desktop.attachFromDesktopTab.call(this,function(t){"function"==typeof e.configJSON.beforeAttach&&1===e.actionMode?e.configJSON.beforeAttach(function(){k.desktop.uploadFiles.call(e,[t])}):k.desktop.uploadFiles.call(e,[t])})},k.desktop.attachButtonHandler=function(){var t=this;this.desktopObj&&this.desktopObj.length?"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){k.desktop.uploadFiles.call(t),t.closeThisAppView()}):(k.desktop.uploadFiles.call(this),this.closeThisAppView()):zmUtil.succErrMsg("e",w.desktop.pleaseattach)},k.desktop.validateFile=function(t,e,a){var i=function(t){var e,a,i,n=!1;return t&&t.name?(i=zmUtil.fileTyp(t.name)[2],this.desktop.allowedFileType&&(a=this.desktop.allowedFileType.split(",")),void 0!==a?(e="".concat(t.type.substr(0,t.type.lastIndexOf("/")+1),"*"),0<=a.indexOf(t.type)||0<=a.indexOf(e)||0<=a.indexOf(".".concat(i))?n=!0:zmUtil.succErrMsg("e",this.desktop.fileTypeErr)):this.desktop.excludeType&&(this.desktop.excludeType.extension.indexOf(i)<0?n=!0:zmUtil.succErrMsg("e",zmText.applyArgs(w.desktop.attachmentPolicyErr,{filename:t.name}))),n):(zmUtil.debugLog("File name empty"),!1)}.call(this,t),n=s.call(this,t,i),o={name:e,file:t,isHuge:n.isHuge};k.core.isComposeApp.call(this)&&(o.isDocs=n.isDocs),i&&n.status?(e=e.replace(/[<>]/g,""),o.status=!0):(o.status=!1,o.continue=n.status),a(o)},k.utility.createFormInstance=l}(window.zmAttachComponent=window.zmAttachComponent||{}),function(h){var u=h._i18N;h.myAttachment={};var f=function(e,a){var i=this,n=this.attachTempArr.myAttachment,o=h.utility.filterMyAttachmentKey(e);o.streamsView&&(o.streamsView=!0,this.streaViewCount++),e.uuid=o.uniqueId="xxxxxxxx-xxxy-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.floor(16*Math.random());return"x"!==t&&(e=3&e|8),e.toString(16)}),n.push(o),this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(e.fs);a.data({uniqueId:o.uniqueId}),a.find(".SC_icn").off("click").on("click",function(){if(!i.deferred){var t=n.indexOf(_.findWhere(n,{uniqueId:o.uniqueId}))||0;0<=t&&(h.core.attachmentSection.call(i)?zmAttachUtility.removeAttachments(a,"common"):a.remove(),i.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(e.fs),n.splice(t,1),o.streamsView&&i.streaViewCount--,h.core.addRemoveClassToParentDom.call(i),h.core.onRemove.call(i),h.utility.modifySlideshowArray.call(i,{uuid:o.uniqueId}))}}),h.core.bindTempListedAttachment.call(this,a,e,"myAttachment",o.uniqueId),h.utility.storeAttListForSlideshow.call(this,e,this.slideListCount++,"myAttachment",a)},p=function(t,e){var a=e._self;"function"==typeof a.myAttachment.onUploadSuccess&&a.myAttachment.onUploadSuccess(t,e.templateList)},g=function(t,e){var a=e._self;e.templateList.forEach(function(t){t.remove()}),"function"==typeof a.myAttachment.onUploadFailure&&a.myAttachment.onUploadFailure.apply(a,arguments)},n=function(t,e){var a,i,n,o=t.length,s=0,l=[];h.core.checkAppendElePresence.call(this),i=this.$ele;var r=h.core.attachmentSection.call(this);for(s=0;s<o;s++)if((n=t[s]).attType===zmAttachUtility.fileType.hugeAttachment||!n.attType&&n.digest){var c=n.fn||n.fName,d=void 0!==n.shType?n.shType:n.shT;a=h.hugeAttachment.constructHugeAtt(c,{isUpload:!1,shType:d,self:this,isOwner:void 0===n.isOwner||n.isOwner}),r?(zmAttachUtility.appendAttachments(a,i,"huge",this),e||a[0].scrollIntoView()):i.appendDOM(a),h.hugeAttachment.hugeUploadBindAndShow(a,{size:n.size||n.fs,self:this,resp:{digest:n.digest,shType:d,fName:c,cloudLink:n.cloudLink},name:c})}else{if(a=$.e(zmAttachment.templates.attListingTemplate({size:zmUtil.sizeConv(n.fs),name:n.n||n.fn,image:zmAttachment.templates.attPrevInr(n)})),this.configJSON.renameSupport)101!==n.ft&&a.find('.zmSub i[data-name="showMore"]').remove();else{var m=a.find('.zmSub span[data-name="rename"]');101===n.ft?m.attr("data-name","showMore").text(u.attachTemplateText.annotate):m.remove(),a.find('.zmSub i[data-name="showMore"]').remove()}r?(zmAttachUtility.appendAttachments(a,i,"common",this),e||a[0].scrollIntoView()):i.appendDOM(a),f.call(this,n,a),this.myAttachment&&l.push(a)}this.myAttachment&&function(t,e){var a=[],i=this.myAttachment.params;t.forEach(function(t){a.push(h.utility.filterMyAttachmentKey(t))},this),i.attEntObj=a,zmAjq.XHR({u:this.myAttachment.url,t:"POST",fn:p,efn:g,p:i,ep:{_self:this,templateList:e}})}.call(this,t,l),h.core.addRemoveClassToParentDom.call(this),h.core.onAppend.call(this),h.core.onAllUploadFinish.call(this)},o=function(t,e){var a,i=e.attachmentID;0<=(a=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:i})))&&(this.selectedattachUtilectsArr[a].n=t),0<=(a=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,{uuid:i})))&&(this.orderedListOfAttachedFile[a].n=t)},i=function(t){var e=this.attachUtil.attDet[t].fn,a=$.e(zmAttachment.templates.selectedFile({name:e,attId:t})),i=a.find('span[data-name="filename"]');this.dialog.$el.find(".SC_PUsel_files").appendDOM(a),a.click(function(t){var e=$.e(t.target||t.srcElement);e.hasClass("msi-close")?h.myAttachment.modifyCheckedAttachmentArray.call(this,e.closest(".SC_fileSel").attr("data-attid")):this.configJSON.renameSupport&&h.utility.renameHelper.onRenameAction(e,e.closest(".SC_fileSel"))}.bind(this)),h.utility.renameHelper.init({context:this,$ele:i,onChange:o,handbackData:{attachmentID:t},orginalFileName:e,parentClass:"SC_fileSel"})};h.myAttachment.toggleSelectedStatus=function(t,e){var a,i=$.e(e),n=$.e(t.target||t.srcElement),o=!0,s=n.attr("id");"thumbView"!==s&&"listView"!==s||(o=!1),o?(i.toggleClass("SC_check"),this.dialog.$el.find(".zm_attFltr").removeClass("shw"),h.myAttachment.modifyCheckedAttachmentArray.call(this,i.attr("data-atid"))):(a=this.attachUtil.attDet[n.closest(".zmL").attr("data-atid")])&&a.constructor===Object&&zmUtil.initAttSlideShow({attObjList:[a],startIndex:0,hideAllOptions:!0})},h.myAttachment.appendAttachment=function(t,e){var a,i=this;a=Array.isArray(t)?t:[t],"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){n.call(i,a,e)}):n.call(i,a,e)},h.myAttachment.modifyCheckedAttachmentArray=function(t){var e=t,a=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:e}));0<=a?(this.selectedattachUtilectsArr.splice(a,1),function(t){this.dialog.$el.find('.SC_PUsel_files span[data-attid="'+t+'"]').remove(),this.dialog.getCenterElem("myAttachment").find('.zmL[data-atid="'+t+'"]').removeClass("SC_check")}.call(this,e)):(this.selectedattachUtilectsArr.push(this.attachUtil.attDet[e]),i.call(this,e))},h.myAttachment.onAttachHandler=function(){var t,e,a,i,n,o,s,l;if(h.utility.isAttachmentSelected(this.selectedattachUtilectsArr.length)){t=this.selectedattachUtilectsArr,e=this.configJSON.maxAttachedSize,a=this.configJSON.currentAttachedSize,i=u;var r,c=zmUtil.isHugeAttachmentUploadEnabled()&&h.core.isComposeApp.call(this),d=!1;for(s=0,l=t.length;s<l;s++){if(r=t[s].attType===zmAttachUtility.fileType.hugeAttachment,c&&r&&!h.hugeAttachment.isRichTextMode.call(this)){zmUtil.succErrMsg("e",u.hugeAttach.errMsg.plainTextErr),d=!0;break}if(c&&t[s].attType===zmAttachUtility.fileType.hugeAttachment&&!h.hugeAttachment.isNewHugeFileUploadAllowed.call(this)){h.hugeAttachment.showHugeUploadLimitMessage(),d=!0;break}if((!c||t[s].attType!==zmAttachUtility.fileType.hugeAttachment)&&e<(a+=zmAttachUtility.parseToNumber(t[s].fs||0))){a-=zmAttachUtility.parseToNumber(t[s].fs||0),t=t.splice(0,s),n=e/1048576,o=l-s,zmUtil.succErrMsg("e",i.maxSizeErr1+" "+n+" "+i.maxSizeErr2+" ,"+o+" "+i.maxSizeErr3,void 0,5e3),d=!0;break}}d||(this.closeThisAppView(),h.myAttachment.appendAttachment.call(this,t))}},h.myAttachment.onListingUpdate=function(){(function(){var t,e,a,i;for(a=0,i=this.selectedattachUtilectsArr.length;a<i;a++)t=this.selectedattachUtilectsArr[a].uniqueId,(e=this.dialog.$el.find("div[data-atid='"+t+"']")).length&&e.addClass("SC_check")}).call(this)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(r){r.zDocs={},r.zDocs.invokeZDocsComponent=function(t){var e=t.attr("id"),a=zmComponent.loadingBand({container:t[0],type:"pagination"}),i={servicename:"zmail",docsURL:"//"+zmail.urls.docsURL,container_id:e,isnewui:!0};ZDDialog.closePopUp("zdattachcontainer"),i.height=t.height()+100,i.width=t.width();var n=new MutationObserver(function(t){a(),t.forEach(function(t){"childList"===t.type&&t.addedNodes&&t.addedNodes.length&&Array.prototype.forEach.call(t.addedNodes,function(t){"zdattachcontainer"===$.e(t).attr("id")&&($.e(t).find("#mainPanelforservicefiles").css("margin","0px"),n.disconnect())})})});n.observe(t[0],{childList:!0}),ATTACHDIALOG.showAttachFileDialog(i)},r.zDocs.attachZDocsDocument=function(){var t=ATTACHDIALOG.getSelectedDocs(),e=[],a={},i=t.length;if(r.utility.isAttachmentSelected(i)){ZDDialog.closePopUp("zdattachcontainer"),this.closeThisAppView();for(var n=0;n<i;n++){var o=t[n],s={};s.docId=o.docId,s.docName=o.docName,s.docType="zw"!==o.service?o.service:"writer",e.push(s)}if(a.zohodocs=e,a=JSON.stringify(a),this.asLink){var l={};l.docObj=a,l.eprm={cmpId:zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),tol:i},l.loadType="link",this.configJSON.insertDocsLink(l)}else this.cloudUpload(a,i,zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),"z")}}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(t){t.gagets={},t.gagets.invokeGadgetComponent=function(t){var e,a=t.getCenterElem(),i=location.protocol+"//"+window.location.hostname,n=i,o=i,s=zmComponent.loadingBand({container:a[0],type:"pagination"}),l=zmUtil.getUrlParams(location.href).frameorigin;l&&l!==i&&(n=l+","+i);var r=[],c=zmail.IntegrationStatus;_zm.isCloudServiceIntegEnabled&&c?(c.gDrive&&r.push("gdrive"),c.dropBox&&r.push("dropbox"),c.oneDrive&&r.push("skydrive"),c.box&&r.push("box"),r=r.length?r.join(",")+",":"",r+="evernote"):r="gdrive,dropbox,skydrive,box,evernote",e=zmail.urls.gadURL+"/CloudPicker?sources="+r+"&purpose=mailView&zservice=zmail&disableSync="+r+"&serURL=",e+=i+zmail.conPath+"/jsp/cloudPicker.jsp?cmpId=Cmp1&frameorigin="+n+"&originUrl="+o;var d=$.e(zmAttachment.templates.cloudFrame(e));d.on("load",function(){s()}),a.appendDOM(d)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(r){r.insertImage={};var c,d={MAX_SIZE:3145728,TYPE:".png,.jpg,.jpeg,.gif",filename:"inline"},m=zmText.get("attachComponent"),h=!1;function i(t){return e=t,n=!1,i=d.TYPE.split(","),a=e.type.substr(0,e.type.lastIndexOf("/")+1)+"*",(0<=i.indexOf(e.type)||0<=i.indexOf(a)||0<=i.indexOf("."+zmUtil.fileTyp(e.name)[2]))&&(n=!0),n;var e,a,i,n}function u(t){t.find("#blkMaskWthBtn").show(),t.on("mouseover",function(){t.find("#blkMaskWthBtn").css("opacity",1)}),t.on("mouseleave",function(){t.find("#blkMaskWthBtn").css("opacity",0)})}function f(t){t.off("mouseover mouseleave")}function n(t,e){var a,i,n=$.e(zdom("img",null)),o=r.utility.createObjectURL(t);c=t,i=(a=e instanceof $?e:e.getCenterElem("insertImage")).find(".SC_mclst"),n[0].onload=function(){a.find(".SC_drop.SC_dropW100").hide(),u(a),r.utility.revokeObjectURL(o)},n.attr("src",o).css({maxWidth:i.width()-15,maxHeight:i.height()-15}).addClass("upldIMG"),i.appendDOM(n)}function o(t,e){var a;i(t)?t.size<=d.MAX_SIZE?n(t,e):(a=m.maxSizeErr1+zmUtil.sizeConv(d.MAX_SIZE),zmUtil.succErrMsg("e",a)):(a=zmText.applyArgs(m.insertImage.typeerror,{ftype:"[JPG/JPEG/PNG/GIF]"}),zmUtil.succErrMsg("e",a))}r.insertImage.clear=function(){c=void 0,h=!1},r.insertImage.getTabConfig=function(t){var e=this;return{id:"insertImage",text:m.cloudServiceName.insertImage,tabName:"insertImage",selected:t,listingArea:{classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$.e(zdom("div",{className:"SCmc SC_attachviewer"}))},buttons:[{text:m.button.insert,onClk:function(){h||(c?function(){var e,t,a=this,i=r.utility.createXHR(),n=new window.FormData,o=zmAjq.getCookie("zmcsr"),s=d.filename+"."+zmUtil.fileTyp(c.name)[2],l=this.insertImage.requireParamToUpload||{};for(t in this.insertImage.ignoreFileNameParam||n.append(this.insertImage.fileNameParam||"fileName",encodeURIComponent(s)),n.append(this.insertImage.imgFileParamName||"attach",c,s),n.append("zmrcsr",o),l)l.hasOwnProperty(t)&&n.append(t,l[t]);e=function(){var t=a.dialog.getCenterElem("insertImage");t.find("#uploadMask").hide(),u(t)},i.upload.addEventListener("loadstart",function(){var t=a.dialog.getCenterElem("insertImage");h=!0,t.find("#uploadMask").show(),t.find("#progressIndicator").width("1%"),f(t)},!1),i.upload.addEventListener("progress",function(t){var e=Math.round(100*t.loaded/t.total);a.dialog.getCenterElem("insertImage").find("#progressIndicator").width(e+"%")},!1),i.onreadystatechange=function(){if(4===i.readyState){if(200===i.status){var t=$.parseJSON(i.responseText);h=!1,t.fP||t.storeName||1===t[0]?(a.insertImage.onUpload(t),a.closeThisAppView()):("string"==typeof t.emsg?a.dialog.showSuccErrMsg("e",t.emsg.replace(/\\x20/g," ")):a.dialog.showSuccErrMsg("e",m.insertImage.inserterror),e())}}else 500!==i.status&&400!==i.status||(h=!1,a.dialog.showSuccErrMsg("e",m.insertImage.inserterror),e())},i.open("POST",this.insertImage.uploadAPI,!0),i.send(n)}.call(e):zmUtil.succErrMsg("e",m.insertImage.pleaseattach))}}]}},r.insertImage.dialogDidMount=function(t){var e=t.getCenterElem("insertImage");e.appendDOM(zmAttachment.templates.dragdropArea()),e.find(".SC_mclst").appendDOM(zmAttachment.templates.insertImageMaskBtn(),zmAttachment.templates.blackMask())},r.insertImage.pasteHandler=function(){var t;arguments[0]instanceof window.Blob?((t=arguments[0]).name||(t.name=d.filename+".png"),o(t,arguments[1])):function(t,e){var a,i,n=t.clipboardData.items;for(i=0;i<n.length;++i)"file"===n[i].kind&&-1!==n[i].type.indexOf("image/")&&(a=n[i].getAsFile())&&(a.name||(a.name=d.filename+".png"),o(a,e))}(arguments[0],arguments[1])},r.insertImage.bindEventsToTab=function(a){var t,e=a.getCenterElem("insertImage");e.find(".SC_drop").click(function(){var e,t;e=a,$.q("#zmAttach_file_Desktop").remove(),$.e(document.body).appendDOM(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),(t=$.q("#zmAttach_file_Desktop")).attr("accept",d.TYPE),t.off("change").on("change",function(t){return o((t.target||t.srcElement).files[0],e),this.value="",!1}),t.click()}),r.utility.setDragDrop({onDrop:function(t){o(t[0],a)},onDragLeave:function(){},onDragover:function(){},$centerEle:a.getCenterElem("insertImage"),$dropMsgEle:a.getCenterElem("insertImage")}),(t=e.find("#blkMaskWthBtn .blkMaskBtn")).eq(0).on("click",function(){var a=this;r.imageEditTool.init.call(this,{file:c,onAttach:function(t){var e=a.dialog.getCenterElem("insertImage");t.blob.name||(t.blob.name=c.name),c=t.blob,e.find(".SC_mclst img").remove(),n(c,e)}})}.bind(this)),t.eq(1).on("click",function(){var t=this.dialog.getCenterElem("insertImage");t.find(".SC_mclst img").remove(),t.find("#blkMaskWthBtn").hide(),t.find(".SC_drop.SC_dropW100").show(),f(t)}.bind(this)),this.insertImage.type&&(d.TYPE=this.insertImage.type),this.insertImage.maxSize&&(d.MAX_SIZE=this.insertImage.maxSize)},r.insertImage.isUploading=function(){return!0}}(window.zmAttachComponent=window.zmAttachComponent||{}),define([],function(h){var s,C=h("zmAttachComponent._i18N"),u=h("_zm"),y=h("zmUtil"),f=h("zmAttachComponent.utility"),p=h("zmAttachComponent.core"),t=h("zmail.Core.Namespaces"),d=h("zmAdHocSettings"),m=t.create("zmAttachComponent.hugeAttachment"),b=[],S=[],k=[],w=[],g=[],i=!1,O=function(){b=[],S=[],k=[],w=[],g=[]};$.subscribe("hugeAtt/dropRemove",function(){s&&s.remove()});var v={push:function(t,e){if(t&&t.digest){var a,i=t.digest;t.cloudLink?(a=t.cloudLink,delete t.cloudLink):a="https://"+zmail.urls.downloadurl+"/download?mode=download&digest="+i,this.hugeAttachment.attachedFiles.push(t),this.hugeAttachment.storeTempAttachment.push(u.copyOf(t)),this.hugeAttachment.name[i]=e,this.hugeAttachment.cloudLink[i]=a}},delete:function(t){var e=this.hugeAttachment.attachedFiles.indexOf(h("_").findWhere(this.hugeAttachment.attachedFiles,{digest:t}));0<=e&&(delete this.hugeAttachment.name[t],delete this.hugeAttachment.cloudLink[t],this.hugeAttachment.attachedFiles.splice(e,1),p.addRemoveClassToParentDom.call(this),p.onRemove.call(this))},get:function(){return this.hugeAttachment.attachedFiles},updateShType:function(t,e){var a=this.hugeAttachment.attachedFiles.indexOf(h("_").findWhere(this.hugeAttachment.attachedFiles,{digest:t}));0<=a&&(this.hugeAttachment.attachedFiles[a].shType=e)},updateTempAttSize:function(t,e){var a=this.hugeAttachment.storeTempAttachment.indexOf(h("_").findWhere(this.hugeAttachment.storeTempAttachment,{digest:t}));0<=a&&(this.hugeAttachment.storeTempAttachment[a].size=e)},updateTempName:function(t,e){var a=this.hugeAttachment.storeTempAttachment.indexOf(h("_").findWhere(this.hugeAttachment.storeTempAttachment,{digest:t}));0<=a&&(this.hugeAttachment.storeTempAttachment[a].fName=e)}},l=function(t){var e=t.cloudLink?t.cloudLink:"https://"+zmail.urls.downloadurl+"/download?mode=download&digest="+t.digest;e=e+"&pd="+location.host;var a=document.getElementById("zmhgdwnldfile");a&&a.parentElement.removeChild(a),(a=zdom("iframe",null)).id="zmhgdwnldfile",a.style.display="none",a.src=e,document.getElementsByTagName("body")[0].appendChild(a)},r=function(t,o,s,l){var r=this,e={digest:o};t&&(e.attachId=t);var a={type:"POST",xhrFields:{withCredentials:!0},url:"https://"+zmail.urls.downloadurl+"/delete?zmudrcsr="+zmAjq.getCookie("zmudcsr"),data:e,success:function(t){var e=t,a=h("zmAttachUtility");if(e[0]&&e[0].errorCode){var i=e[0].errorCode,n=a.errorMsgs[i];return u.succErrMsg("e",n||C.hugeAttach.errMsg.errSize),"error"}s&&(p.attachmentSection.call(r)?a.removeAttachments(s,"huge"):s.remove(),v.delete.call(r,o)),l&&(l.fn("success",l.eprm),y.succErrMsg("s",C.hugeAttach.errMsg.delSucc))},error:function(t){var e,a,i=t.responseText||"",n=h("zmAttachUtility");(e&&(e=(e=JSON.parse(i))[0]&&e[0].resData?e[0].resData[0]:e[0].errorCode),t.status)?a=p.errorMessageHandling(t).errorMsg:e&&e.emsg?a=e.emsg:n.errorMsgs[e]&&(a=n.errorMsgs[e]);return a=a||C.hugeAttach.errMsg.errSize,u.succErrMsg("e",a),"error"}};$.ajax(a)},o=function(t){var o=this;t.find(".SC_icn").off("click"),t.off("click").on("click",function(t){var e=$.e(t.target),a=e.closest(".zmL"),i=a.data("digest"),n=a.data("cloudLink");e.hasClass("msi-close")||e.hasClass("SC_icn")?!0===e.data("isDel")?r.call(o,a.data("attachId"),i,a):(p.attachmentSection.call(o)?h("zmAttachUtility").removeAttachments(a,"huge"):a.remove(),v.delete.call(o,i)):e.hasClass("selOpt")||e.parents().hasClass("selOpt")?function(l,r){var c=this,t={title:C.hugeAttach.permissionDialog.changePermission,$content:h("zmAttachment").templates.constructPermission(!1),buttons:[{name:C.button.ok,callback:function(t){var e=t.$els.$content,a="",i="",n=C.hugeAttach,o=e.find(".permElem").find("input[checked]").parent();o.hasClass("publicElm")?(v.updateShType.call(c,l,1),a="public",i=n.hugeOpts.anyone):o.hasClass("pvtElm")&&(v.updateShType.call(c,l,0),a="private",i=n.hugeOpts.recOpt);var s=r.find(".changeOpt");s[0].childNodes[0].textContent=i,s.parents("b").data("val",a),t.remove()}},{name:C.button.cancel,isCancel:!0,callback:function(t){t.remove()}}],dialogDidMount:function(t){var e=t.$els.$content,a=r.find(".optParent").find("b").data("val"),i=e.find(".permElem");i.find("input").removeAttr("checked"),"private"===a?e.find(".pvtElm > input").attr("checked",!0):"public"===a&&e.find(".publicElm > input").attr("checked",!0),i.bind("click",function(){i.find("input").removeAttr("checked"),$.e(this).find("input").attr("checked",!0)})}};h("Dialog").new(t)}.call(o,i,a):l({digest:i,cloudLink:n})})},z=function(t){var e=d.getAttachComp();e&&e.hugeAttPref!==t&&d.setAttachComp({hugeAttPref:t})},A=function(t,e){var a,i=y.fileTyp(t,h("zmAttachUtility").fileType.hugeAttachment),n=$.e((a={fn:t,cls:i[1],isOwner:e.isOwner},h("zmAttachment").templates.hugeAttachmentTemplate(a))),o=e.self,s=p.attachmentSection.call(o);if(s||n.addClass("zmAch attachment"),n.find(".closeIcon").on("click",function(){(s?h("zmAttachUtility").removeAttachments(n,"huge"):n.remove(),e.isUpload)&&(e.xhr.abort(),o.hugeAttachment.isHugeUploadInProgress--,p.decrementAttachCount.call(o),p.addRemoveClassToParentDom.call(o),p.onRemove.call(o))}),1===e.shType){var l=n.find(".changeOpt");l[0].childNodes[0].textContent=C.hugeAttach.hugeOpts.anyone,l.parents("b").data("val","public")}return n},T=function(t){var e=zmContactsTokenInput.init({input:t[0],placeHolder:C.hugeAttach.permissionDialog.inputPlh,classname:"addInvList expandMem"});return e.onRemove=function(t){var e=t.attributes,a=e.zid;if(y.isGroup(a))S.push(a),w=_.without(w,a);else{var i=e.email;b.push(i),k=_.without(k,i)}-1!==g.indexOf(e.id)&&(g=_.without(g,e.id))},e.onAdd=function(t){var e=t.attributes;if(-1===g.indexOf(e.id)){var a=e.zid;if(y.isGroup(a))w.push(a),S=_.without(S,a);else{var i=e.email;k.push(i),b=_.without(b,i)}}},e},x=function(t,o){return t=t[0].getElementsByClassName("SC_token")[0],zmContactsAutoComplete.autoComplete({input:t,includeEmailedGroups:!0,exclude:function(){for(var t,e=o.model.attributes.tokens.models,a=[],i=0,n=e.length;i<n;i++)t=e[i].attributes.zid||e[i].attributes.email,a.push(t);return a},excludeMe:!0,onSelect:function(t,e){(e=e.item.attributes).text=e.firstName;var a=o.tokenModelFactory.createModel(e);o.model.attributes.tokens.add(a)},listShown:function(){o.triggers.enterKeyTrigger.enabled=!1},listHidden:function(){o.triggers.enterKeyTrigger.enabled=!0},setDebounce:0})},N=function(t,e){var a=t.sharedUsers||[],i=function(t){for(var e=[],a=[],i=0;i<t.length;i++)(e=zmail.ContactBook.getGroups(String(t[i])))[0].attrs&&e[0].attrs.eid&&a.push(e[0].attrs.eid);return a}(t.sharedGroups||[]);g=a.concat(i);for(var n,o,s,l=zmail.Utils.EmailParser.parse(g.toString()),r=0,c=l.length;r<c;r++){if(l[r].valid){var d=zmail.ContactBook.get({promise:!1,eid:l[r].email})[0];n=d?{id:(o=d.attrs).eid||d.id,text:o.fn||o.name,firstName:o.fn||o.name,middleName:o.mn,lastName:o.ln,nickName:o.nn,email:o.eid,profileImage:o.photo,zid:o.zid||o.id,internalData:d}:(s=zmail.ContactBook.getGroups(l[r].email)[0])?{id:(o=s.attrs).eid,text:o.name,firstName:o.name,email:o.eid,profileImage:o.photo,zid:o.id,internalData:s}:{id:l[r].email,text:l[r].name,firstName:l[r].name,email:l[r].email}}else n={id:Date.now(),text:l[r].email};var m=e.tokenModelFactory.createModel(n);e.model.attributes.tokens.add(m)}},a=function(t){var r=t.resp,g=t.attObj,v=C.hugeAttach.permissionDialog;if(_.size(r)){var z,A,c=h("zmAttachUtility"),e={title:v.changePermission,$content:h("zmAttachment").templates.constructPermission(!0,r),buttons:[{name:v.save,callback:function(t){var e,a,i,n,o,s,l,r,c,d,m=t.$els.$buttonContainer[0].childNodes[0];if(!$.e(m).hasClass("reqLock")){$.e(m).addClass("reqLock"),$.e(m).text(v.saving);for(var h,u=t.$els.$content.find("input"),f=0;f<u.length;f++)if($.e(u[f]).prop("checked")){h=$.e(u[f]).parent().data("val");break}var p={entityType:11,attachId:g.Id,shType:h};e=p,a=function(){y.succErrMsg("s",v.success),A&&A.destroy(),z&&z.destroy(),t.remove(),O()},i=function(){$.e(m).text(C.button.ok),$.e(m).removeClass("reqLock"),y.succErrMsg("e",v.error)},n=w.length?w.join(","):[],o=k.length?k.join(","):[],s=S.length?S.join(","):[],l=b.length?b.join(","):[],r=!1,c=n.length||o.length,d=s.length||l.length,!c&&d?(e.mode="unshr",e.sUserIds=l,e.sZgids=s,delete e.shType):!d&&c?(e.mode="shr",e.sUserIds=o,e.sZgids=n):(e.mode="shr",c&&d&&(r=!0,e.sUserIds=o,e.sZgids=n)),zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",fn:function(){r?(e.mode="unshr",e.sUserIds=l,e.sZgids=s,delete e.shType,zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",fn:function(){a()},p:e,efn:i})):a()},p:e,efn:i})}}},{name:C.button.cancel,isCancel:!0,callback:function(t){A&&A.destroy(),z&&z.destroy(),O(),t.remove()}}],dialogDidMount:function(t){var a,e=t.$els.$content,i=e.find(".permElem"),n=r.sharedUsers||[],o=r.sharedGroups||[],s=r.shType,l=c.constants;n.length+n.length||(z=T(i.find(".expand")),(a=i.find(".expand input")).addClass("zm_sgst"),a.show(),a.focus(),A=x(i.find(".expand"),z),N(r,z)),s===l.share_private||o.length||n.length?$.e(e.find(".pvtElm > input")[0]).attr("checked",!0):s===l.share_public?(e.find(".publicElm > input").attr("checked",!0),i.find(".privateField").addClass("SC_dyn")):s===l.share_org&&(e.find(".orgElm > input").attr("checked",!0),i.find(".privateField").addClass("SC_dyn")),i.bind("click",function(){i.find("input").removeAttr("checked");var t=$.e(this);if($.e(t.find("input")[0]).attr("checked",!0),t.data("val")===l.share_private){i.find(".privateField").removeClass("SC_dyn");var e=i.find(".plusIcon");e.length&&!e.hasClass("SC_dyn")||a.focus()}else i.find(".privateField").addClass("SC_dyn")}),i.find(".expandMem").bind("click",function(t){t.stopPropagation(),$.e(this).parent().addClass("edit_parti"),$.e(this).remove(),z=T(i.find(".expand")),(a=i.find(".expand input")).addClass("zm_sgst"),a.show(),a.focus(),A=x(i.find(".expand"),z),N(r,z)})}};h("Dialog").new(e)}},D=function(t,e){var a=e.size,i=e.self,n=e.resp;t.find(".zm_lbl").remove(),t.find(".fileSize").text(y.sizeConv(a)),t.find(".showOpt").removeClass("SC_dyn"),n&&t.data({digest:n.digest,attachId:n.attachId,cloudLink:n.cloudLink}),o.call(i,t),v.push.call(i,n,e.name),a&&v.updateTempAttSize.call(i,n.digest,a),e.name&&v.updateTempName.call(i,n.digest,e.name),n.shType&&v.updateShType.call(i,n.digest,n.shType),i.onAddAttachment(i,n,t,"hugeAttachment")},e=function(e){var l,t,a,i=f.createXHR(),n=f.createFormInstance(),o=e.file,s=e.name||o.name,r=(a=o.size,h("zmAttachUtility").parseToNumber(a||0)),c=(t=s,window.encodeURIComponent(t)),d=this,m=!1;this.hugeAttachment.isHugeUploadInProgress++,p.incrementAttachCount.call(this),p.checkAppendElePresence.call(this),n.append("attach",o,c),i.withCredentials=!0,d.configJSON.eleId&&(l=A(s,{isUpload:!0,xhr:i,self:d,isOwner:!0}),i.onloadstart=function(){var t=!1;e.$replaceEle instanceof $?(l.insertDOMAfter(e.$replaceEle),e.$replaceEle.remove(),t=!0):p.attachmentSection.call(d)?(h("zmAttachUtility").appendAttachments(l,d.$ele,"huge",d),l[0].scrollIntoView()):d.$ele.appendDOM(l),p.addRemoveClassToParentDom.call(d),t||p.onAppend.call(d)},i.upload.addEventListener("progress",function(t){p.showProgressReq(l,t)},!1));i.onreadystatechange=function(){var t=h("zmAttachUtility");if(4===i.readyState&&i.status===t.statusCodes.SUCCESS){var e=JSON.parse(i.responseText);p.decrementAttachCount.call(d),d.hugeAttachment.isHugeUploadInProgress--,Array.isArray(e)&&Array.isArray(e[0].resData)?((e=u.copyOf(e[0].resData[0])).shType=0,d.configJSON.eleId&&(l.find(".msi-close").data("isDel",!0),l.find(".closeIcon").data("isDel",!0),D(l,{size:r,resp:e,self:d,name:s}),e.fName=s,delete e.attachId),d.onAddAttachment(d,e,l,"hugeAttachment")):(p.attachmentSection.call(d)?t.removeAttachments(l,"huge"):l.remove(),p.onRemove.call(d),d.onUploadError())}},i.onerror=function(t){var e=t,a="";e&&e.target&&(a=e.responseText||""),function(t){if(!m){var e;m=!0;var a,i=h("zmAttachUtility"),n=t.responseText||"";if(e&&(e=(e=JSON.parse(n))[0]&&e[0].resData?e[0].resData[0]:e[0].errorCode),t.status?a=p.errorMessageHandling(t).errorMsg:e&&e.emsg?a=e.emsg:i.errorMsgs[e]&&(a=i.errorMsgs[e]),a=a||C.ajaxErr.attFromDesktop,u.succErrMsg("e",a),d.hugeAttachment.isHugeUploadInProgress--,p.decrementAttachCount.call(d),e&&e[0]&&e[0].errorCode){e=e[0];var o=i.errorMsgs[e.errorCode];o?y.succErrMsg("e",o):y.succErrMsg("e",C.hugeAttach.errMsg.errSize)}else{var s=e&&e.emsg?e.emsg:C.ajaxErr.attFromDesktop;u.succErrMsg("e",s)}p.attachmentSection.call(d)?i.removeAttachments(l,"huge"):l.remove(),p.onRemove.call(d),d.onUploadError()}}(a)},i.open("POST","https://"+zmail.urls.uploadurl+"/upload?mode=upload&zmudrcsr="+zmAjq.getCookie("zmudcsr"),!0),i.send(n)};return m.showHugeUploadLimitMessage=function(){y.succErrMsg("e",C.hugeAttach.errMsg.oneHugeErr)},m.isNewHugeFileUploadAllowed=function(){return!!this.hugeAttachment&&!this.hugeAttachment.isHugeUploadInProgress},m.getHugeFileUploadLimit=function(){return 1},m.isRichTextMode=function(){if(p.isComposeApp.call(this)&&zmComp){var t=this.componentId.split("_")[1];return"plaintext"!==zmComp.getEditor(t).mode}return!0},m.showHugeAttachmentMsgDialog=function(t){var e=$.Deferred(),a=d.getAttachComp(),i=!1,n=m.isRichTextMode.call(this);if(m.isNewHugeFileUploadAllowed.call(this)&&n)if($.isEmptyObject(a)||!a.hugeAttPref||"askMe"===a.hugeAttPref){var o=C.hugeAttach.alertDialog;if(m.isPreferenceDialogOpen)m.queuePreferenceCallback.push(e);else{var s=zmText.applyArgs(o.content,{filename:t.filename,size:y.sizeConv(t.maxSize)}),l=[];l.push(zdom("div",null,zdom("font",null,s+" "+o.contentTitle),zdom("br",null),zdom("br",null),zdom("div",null,zdom("i",{className:"msi-uncheck"}),o.remChoice))),$.e(l).find(".msi-uncheck").click(function(){var t=$.e(this);i=t.hasClass("msi-uncheck")?(t.attr("class","msi-check"),!0):(t.attr("class","msi-uncheck"),!1)});var r={title:o.header,$content:l,buttons:[{name:o.yes,callback:function(t){e.resolve(),m.queuePreferenceCallback.forEach(function(t){t.resolve()}),t.remove(),i&&z("yes")}},{name:o.no,isCancel:!0,callback:function(t){e.reject(),m.queuePreferenceCallback.forEach(function(t){t.reject()}),t.remove(),i&&z("no")}}],dialogDidMount:function(){m.isPreferenceDialogOpen=!0},closeAction:function(){m.isPreferenceDialogOpen=!1,m.queuePreferenceCallback=[],"pending"===e.state()&&e.reject(),m.queuePreferenceCallback.forEach(function(t){"pending"===t.state()&&t.reject()})}};m.queuePreferenceCallback=[],h("Dialog").new(r)}}else if("yes"===a.hugeAttPref)e.resolve();else{e.reject();var c=zmText.applyArgs(C.hugeAttach.errMsg.settingSuggestion,{size:y.sizeConv(t.maxSize)});y.succErrMsg("e",c)}else n?(m.showHugeUploadLimitMessage(),e.reject()):y.succErrMsg("e",C.hugeAttach.errMsg.plainTextErr);return e.promise()},m.upload=function(t){!this.hugeAttachment||this.hugeAttachment.isHugeUploadInProgress?m.showHugeUploadLimitMessage():e.call(this,t)},m.showMoreOptions=function(i,t){var e=$.e(t),a=[];a.push({txt:C.UserMsg.attachToNewMail,data:{action:"attachToMail"}}),$.e(t).closest(".zmL, .zmAch").addClass("sel"),$.e(t).addClass("active");var n={divId:"hugeAttachMenu",par:e,parWidth:!0,list:a,clk:function(t,e){!function(t,e){var a=t.action;switch(s.remove(),a){case"attachToMail":y.openComposeWithAtt([i]),y.hideMenu()}}(t)},onHide:function(){$.e(t).parents(".zmL.zmAch").removeClass("sel"),$.e(t).removeClass("active")},showArrow:!0};if(y.isChildWindow()){var o=new zmDropDownMenu;o.setDropObj(n),o.paint(),s=o}else s=zmsuite.showMenu(n)},m.constructHugeAttHeader=function(t,e){return h("zmAttachment").templates.mailHugeTemplate(zmText.applyArgs(C.hugeAttach.hugeHeader,{num:t}),e)},m.constructHugeAttList=function(t){var e=t.name,a=t.attObj,i=t.size,n=a.isOwner,o=y.fileTyp(e,h("zmAttachUtility").fileType.hugeAttachment),s=h("zmAttachment").templates.mailListTemplate({fn:e,cls:o[1],size:y.sizeConv(i),isOwner:void 0===n||n,className:t.className});return $.e(s).unbind("click").bind("click",function(){m.downloadFile(a)}),$.e(s).find(".download").unbind("click").bind("click",function(t){t.stopPropagation(),m.downloadFile(a)}),$.e(s).find(".copyLink").unbind("click").bind("click",function(t){t.stopPropagation(),m.copyPermaLink(a)}),$.e(s).find(".moreAction").unbind("click").bind("click",function(t){u.stopEvents(t),zmAttach.util.removeMAct(),m.showMoreOptions(a,$.e(this))}),s},m.copyPermaLink=function(t){var e="",a=C.hugeAttach.copyLink;if(t)e=t.digest;else{var i=v.get.call(this);e=i[0]?i[0].digest:""}var n=t.cloudLink?t.cloudLink:"https://"+zmail.urls.downloadurl+"/download?mode=download&digest="+e;if(zmComponent.clipBoardAPI.isSupported())zmComponent.clipBoardAPI.setData(n,{type:"text",onSuccess:function(){y.succErrMsg("s",a.succMsg)}});else{var o={title:a.title,$content:h("zmAttachment").templates.showCopyLink(n),dialogWillMount:function(t){setTimeout(function(){$.e(t.$els.$contentWrapper).find("input").select()},500),$.e(t.$els.$content).filter(".SC_PUcen").css({"font-size":"13px",color:"grey"})}};h("Dialog").new(o)}},m.removeHugeAttFiles=function(t){var e,a=this;if(a.configJSON.attachmentSection?a.$ele.find(".attSec_huge").remove():a.$ele.find(".hugeAttTemp").remove(),t)for(var i=0;i<a.hugeAttachment.attachedFiles.length;i++)e=a.hugeAttachment.attachedFiles[i].digest,r.call(a,"",e,"","");else p.addRemoveClassToParentDom.call(this),p.onRemove.call(this)},m.getHugeLinkHTML=function(){var t,e,a=this.hugeAttachment.attachedFiles,i=zdom("div",{className:"zmHugeLink"});if(i.appendChild(zdom("br",null)),a&&a.length)for(var n=0;n<a.length;n++)t=a[n].digest,e=this.hugeAttachment.cloudLink[t],i.appendChild(h("zmAttachment").templates.hugeAttLink(e,this.hugeAttachment.name[t]));return i},m.setHugeMaxAttSize=function(){var e=h("zmAttachUtility");if(!e.constants.HUGE_ATT_UPER_LIMIT&&!i){i=!0;var a=new XMLHttpRequest;a.open("GET","https://"+zmail.urls.uploadurl+"/getmaxsize?mode=getmaxsize",!0),a.withCredentials=!0,a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE){var t=JSON.parse(a.responseText);t[0].resData?(t=t[0].resData[0].max_size,e.constants.HUGE_ATT_UPER_LIMIT=t):t[0].errorCode&&y.debugLog("max size for huge attachment error : "+t[0].errorCode),i=!1}else i=!1},a.send()}},m.initHugeOnboarding=function(t){if("0"===d.getHugeAttOnBoarding()){var e=h("zmAttachment");$.q("body").appendDOM(e.templates.transparentMask());var a=t.toolbardiv,i=$.e(a).find(".zei-attachment"),n=$.q("body").find(".transMask"),o=e.templates.hugeAttOnboarding();$.e(o).find(".saveBtn").unbind().bind("click",function(){y.hideMenu()}),$.e(o).find(".closeIcon").unbind().bind("click",function(){y.hideMenu()}),$.e(o).find(".lrnBtn").unbind().bind("click",function(){y.hideMenu(),window.open(window.location.protocol+"//www."+zmail.zohoUrl+"/mail/help/huge-attachments.html","_blank")});var s,l={par:$.e(t.toolbardiv).find(".zei-attachment"),showArrow:!0,loadHTML:!0,htm:o,divId:"hugeOnboard",spanClass:"minwid fadeIn",arrowPosition:"left",onHide:function(){d.setHugeAttOnBoarding("1"),$.e(a).parent().find(".highEle").remove(),$.e(a).removeClass("zmHighlightIcons"),$.e(i).removeClass("zmHighlightIcon pulseIcon"),$.e(n).remove(),$.publish("compose/focusTo",{type:"hugeOnboard"})}};(y.isChildWindow()||zmail.isComposeMail)&&(l.direction="left"),(s=new zmDropDownMenu).setDropObj(l),s.paint(),$.e(n).on("click",function(t){t.stopPropagation()}),zmail.isComposeMail&&($.e(n).keydown(function(t){27===t.keyCode&&y.hideMenu()}),$.e(n).focus())}},m.downloadFile=l,m.constructHugeAtt=A,m.hugeUploadBindAndShow=D,m.deleteFile=r,m.getListAndEditPerm=function(e){zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",fn:function(t){a({attObj:e,resp:t})},p:{mode:"getSharedUsers",attachId:e.Id}})},m});