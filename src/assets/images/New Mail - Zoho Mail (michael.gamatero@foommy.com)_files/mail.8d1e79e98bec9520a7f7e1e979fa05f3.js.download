"use strict";!function(e){var s,i,c,f={},m={},r="c",a="previouslySelected",l="expanded",n="currentFocusedMsgId",o=ZMail.lConstants,d=o.cls;f.init=function(e){s=e.doAfterMailSelection,i=e.updateMailSelectionView,c=e.isThreadExpanded},f.isChildId=function(e){return-1!==e.indexOf(r)},f.getRawId=function(e){return e.replace(r,"")},f.getViewObjectStore=function(e){return e=e||zmTab.currentTab,m[e]||{}},f.getViewObject=function(e,t){return f.getViewObjectStore(t)[e]},f.getChildMessage=function(e){var t=e.msgId,i=e.viewId;return f.isChildId(t)||(t="c"+t),f.getViewObject(t,i)};f.setViewObject=function(e,t,i){i=i||zmTab.currentTab;var a=m[i]||{};a[e]=t,m[i]=a;var l,n,s,r=f.getAllViewObjectIds();-1===r.indexOf(f.getCurrentFocusedMsgId)&&(r.length&&e!==r[0]||(l=e,n=t,s=i,f.setCurrentFocusedMsgId(l,s),zmInit.isNewKSEnabled&&zmail.mailOpt.isKey&&n.$element.addClass(d.focus)))},f.dropViewObjectStore=function(e){e=e||zmTab.currentTab,delete m[e]},f.setCurrentFocusedMsgId=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:zmTab.currentTab;f.getViewObjectStore(t)[n]=e},f.getCurrentFocusedMsgId=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:zmTab.currentTab;return f.getViewObjectStore(e)[n]};f.setScroll=function(e){var t,i,a;t=e,i=$.e(t).offset().top,a=i+t.offsetHeight,0<i&&a<=(window.innerHeight||document.documentElement.clientHeight)||e.scrollIntoView({block:"center"})},f.rowRemovedInView=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:o.mailAppId,a=!1;if("thd"===t)a=!0;else if("msg"===t){if(f.getAllViewObjectIds().includes("c"+e)){e="c"+e;var l=zmCenterListing.mailObjectAPI.getViewParentOf(e).id;if(zmCenterListing.mailObjectAPI.getChildrenIdsOf(l).length-1<=1)return void f.setFocus("Mouse",l)}}e===f.getCurrentFocusedMsgId(i)&&f.setFocus("Action",e,a,i)},f.setFocus=function(e,t,i,a){if(zmInit.isNewKSEnabled&&(zmInit.isFocusSet||"Mouse"!==e)&&"action"!==e){var l,n,s,r=f.getAllViewObjectIds(!1,a),m={};l=t?r.indexOf(t):r.indexOf(f.getCurrentFocusedMsgId(a));var o=f.getViewObjectStore(a);try{m.previous=function(){0!==l&&(o[r[l]]&&o[r[l]].$element.removeClass(d.focus),n=--l,(s=o[r[n]].$element).addClass(d.focus))},m.next=function(){o[r[l]].$element.hasClass(d.focus)?l<r.length-1&&(o[r[l]]&&o[r[l]].$element.removeClass(d.focus),n=++l,(s=o[r[n]].$element).addClass(d.focus)):(zmInit.isFocusSet=!0,(s=o[r[n=l]].$element).addClass(d.focus))},m.Mouse=function(){o[f.getCurrentFocusedMsgId()]&&o[f.getCurrentFocusedMsgId()].$element.removeClass(d.focus),o[r[l]].$element.addClass(d.focus)},m.Action=function(){i&&(r=r.filter(function(e){return!e.includes("c")})),1<r.length&&(o[r[l]]&&o[r[l]].$element.removeClass(d.focus),n=l===r.length-1?--l:++l,(s=o[r[n]].$element).addClass(d.focus))},m[e](),s&&f.setScroll(s[0]),f.setCurrentFocusedMsgId(r[l],a)}catch(e){zmUtil.debugLog(e)}}};var z=function(e,t){if(e&&e.isSelected!==t)return void 0===t&&(t=!e.isSelected),e.isSelected=t,i(e.$element,t),!0};f.selectMail=function(e,t,i){z(f.getViewObjectStore(i)[e],t)&&s(t,{msgId:e,type:"single"})},f.selectMails=function(e,t,i){var a,l=f.getViewObjectStore(i),n=e.length;if(l){for(a=0;a<n;a++)z(l[e[a]],t);s(t,{type:"multiple"})}},f.getChildrenIdsOf=function(e,t){var i=zmUtil.getMailObj(e);if(!i)return t;var a,l=zmList.getViewBasedMsgList(i.T,zmInit.getListingDetObj()),n=l.length;for(t=t||[],a=0;a<n;a++)t.push(r+l[a]);return t};var u=function(e,t){var i,a,l=(e=e||[]).length;for(a=0;a<l&&!(i=f.getViewObject(e[a],t));a++);return i};f.getViewParentOf=function(e,t){e=f.getRawId(e);var i=zmUtil.getMailObj(e,"T"),a=u(zmList.getViewBasedMsgList(i,zmInit.getListingDetObj(),!0),t),l=zmUtil.getListMap(i);if(l&&(a=a||u(l.MO,t)),!a&&1===zmail.convSortOrder){var n=zmList.getDupThdRowId(e,zmUtil.getFolId());n&&(a=f.getViewObject(n,t))}return a},f.isChildrenAreSelected=function(e){e=f.getRawId(e);var t,i,a=zmList.getViewBasedMsgList(zmUtil.getMailObj(e,"T"),zmInit.getListingDetObj()),l=a.length;for(i=0;i<l;i++)if((t=f.getViewObject(r+a[i]))&&!t.isSelected)return!1;return!0},f.getAllViewObjectIds=function(e,t){var i,a,l,n=[],s=f.getMailOrders(t),r=s.length;for(l=0;l<r;l++)i=s[l],n.push(i),a=f.getViewObject(i),(e||a&&a.$element.next("."+d.thdChild).is(":visible"))&&f.getChildrenIdsOf(i,n);return n},f.setPerviouslySelected=function(e,t){f.getViewObjectStore(t)[a]=e},f.getPerviouslySelected=function(e){return f.getViewObjectStore(e)[a]},f.setExpanded=function(e,t){f.getViewObjectStore(t)[l]=e},f.getExpanded=function(e){return f.getViewObjectStore(e)[l]},f.handleForChildSelection=function(e,t){if(f.isChildId(e)){var i=f.getViewParentOf(e),a=t&&f.isChildrenAreSelected(e);a&&f.setFocus("Mouse",i.id),f.selectMail(i.id,a)}},f.filter=function(e){var t,i,a,l,n,s,r,m,o,d=[];for(r=(t=f.getMailOrders()).length,m=0;m<r;m++)if(i=t[m],n=(l=c(i)&&f.getChildrenIdsOf(i)||[]).length){for(s=[],o=0;o<n;o++)a=l[o],e(f.getRawId(a))&&s.push(a);n===s.length&&d.push(i),d=d.concat(s)}else{e(i)&&d.push(i)}return d},f.readfilter=function(e){var t=zmUtil.getMailObj(e);return 0===t.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?1===t.S:1===t.TS},f.unreadfilter=function(e){var t=zmUtil.getMailObj(e);return 0===t.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?0===t.S:0===t.TS},f.flaggedfilter=function(e){var t=zmUtil.getMailObj(e);return 0===t.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?void 0!==t.NFG&&"0"!==t.NFG:t.TI||t.TF||t.TM},f.taggedfilter=function(e){var t,i=zmUtil.getMailObj(e);return 0===i.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?(t=i.TAG)&&0<t.length:(t=i.TTAGS)&&0<t.length},f.attachmentfilter=function(e){var t=zmUtil.getMailObj(e);return 0===t.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?Boolean(t.AT):Boolean(t.TA)},f.hasElement=function(e,t){var i=f.getViewObjectStore(t),a=i[e];if(a){if(document.contains(a.$element[0]))return a;delete i[e]}return!1},f.getMailOrders=function(e){var t;return 0<=(e=e||zmTab.currentTab).indexOf("zm_srch")?t=zmSearchUtil.getSearchList():(t=zmUtil.getListMap(zmUtil.getFolId()))&&t.MO||[]},f.init({doAfterMailSelection:function(e,t){var i=zmList.getElemObj();(i.mainElem.hasClass("SC_sw")||i.mainElem.hasClass("SC_swB"))&&(e?zmPrev.setCountinPreview(i):zmPrev.removeCountinPreview(i)),ZMail.topbar.header.updateSelectionInfo();var a,l=ZMail.utils.getHeaderRef({}).find("."+d.checkBox);zmList.isAllListingChecked(i.listElem)?l.removeClass().addClass("msi-uncheck msi-check"):zmList.isListingChecked(i.listElem)?l.removeClass().addClass("msi-uncheck msi-partcheck"):(l.removeClass().addClass("msi-uncheck"),zmList.resetSelectionInfo()),zmUtil.removeDocSelection();var n="zm_srch1"===zmTab.currentTab,s=zmUtil.getCheckedMailList(),r=s[0].length+s[1].length,m="zm_srch1"===zmTab.currentTab?"zm_srch1":"zm_Container";if(e){var o=t.msgId&&"c"===t.msgId.charAt(0)?t.msgId.substring(1):t.msgId;if(0===r||2<r&&"single"===t.type)return;(a="single"===t.type?0!==r&&(1<r||s[1].length)?{view:zmInit.getListingDetObj(),isSearchView:n}:{msgId:o,isSearchView:n}:{view:zmInit.getListingDetObj(),isSearchView:n}).type="functional",a.tabId=m,ZMail.topbar.icons.renovate(a)}else e||r||ZMail.topbar.icons.renovate({type:"functional",tabId:m,toHide:!0})},updateMailSelectionView:function(e,t){t?e.addClass(d.chkBox):e.removeClass(d.chkBox)},isThreadExpanded:function(e,t){if(!f.isChildId(e)&&f.getViewObjectStore(t)[e].$element.next("."+d.thdChild).is(":visible"))return!0;return!1}}),(e=e||{}).mailObjectAPI=f}(zmCenterListing),define([],function(e){var l,n=zmail.Core.Namespaces.create("ZMail.lView"),o=e("zmText").get("mail").listing.common,d=e("ZMail.lConstants"),i={};i.checkbox=function(e){var t=zdom("div",{className:"zmLChk","data-action":"checkbox"});return e.shwChkBox&&t.appendChild(zdom("i",{className:"msi-uncheck"})),t},i.envelope=function(e){if(l=zmAdHocSettings.getCustomizeMailListing(),e.hasOwnProperty("envelope")&&e.envelope||!parseInt(l.envelope)){var t=-1!==["msi-rpd","msi-fwd","msi-fwdRpd"].indexOf(e.iconCls),i=e.iconCls;e.outbox?i=e.iconCls:i+=" zmLTicon";var a=zdom("div",{className:"zmLType jsEnvelope","data-action":"envelope"},zdom("i",{className:i}));return t&&_zm(".",e.iconCls,a)[0].appendChild(zdom("i",{className:"path"})),a}return""},i.threadCount=function(e){return zdom("span",{className:"jsThdCount",title:o.tooltip.showHideConversation},e.count)},i.flag=function(e){return l=zmAdHocSettings.getCustomizeMailListing(),e.hasOwnProperty("flag")&&e.flag||!parseInt(l.flag)?zdom("div",{className:"zmLFg","data-action":"flag"},zdom("i",{className:e.iconCls})):""},i.sender=function(e){var t=e.tooltip&&_zm.unescapeTags(e.tooltip)||"";return zdom("span",{className:"zmLSender",title:t},_zm.unescapeTags(e.from))},i.draft=function(e){var t=[e.draftCount,1<e.draftCount?o.draftPlural:o.draft].join(" ");return zdom("span",{className:"zmLDft"},zdom("span",null,t))},i.commentCount=function(e){l=zmAdHocSettings.getCustomizeMailListing();var t="";return parseInt(l.commentcount)||(t=zdom("span",{className:"zmLCmnt zmThmClr","data-action":"commentcount"}),e.hasOwnProperty("cmtCount")&&e.cmtCount&&t.appendChild(zdom("span",null,e.cmtCount,zdom("i",{className:"msi-lcmnt"})))),t},i.attachment=function(e){return l=zmAdHocSettings.getCustomizeMailListing(),e.hasOwnProperty("attachment")&&e.attachment||!parseInt(l.attachment)?zdom("i",{className:"msi-attachicon","data-action":"attachment"}):""},i.subject=function(e){return zdom("span",null,zmUtil.replaceHTMLEntities(e.subject))},i.summary=function(e){var t=" - "+zmUtil.replaceHTMLEntities(e.summary);return zdom("span",{className:"zmLSum"},t)},i.labels=function(e){if(e.hasOwnProperty("labels")&&e.labels||!parseInt(l.label)){var t={constructOuterDiv:!0,getDOM:!0,maxLblCnt:3,customAttribute:{key:"data-action",value:"label"}};zmUtil.getFolId()===zmail.folId.teId&&(t.mode="template");var i=zdom("div",{className:"jsLabel"},zmsTemplates.constructTagListHTML(e.tagLst,!0,4,"",t));return"string"===e.ty?i.outerHTML:i}return""},i.quickAction=function(e){return zdom("span",{className:"zmLBtn"+e.disableCls+" jsQukAct","data-action":"viewAction",title:e.tooltip},zdom("span",{className:"jsQukAct"},e.quickAct),zdom("i",{className:e.icon+" jsQukAct"}))},i.folderName=function(e){return l=zmAdHocSettings.getCustomizeMailListing(),e.hasOwnProperty("folder")&&e.folder||!parseInt(l.thread)?(e.isArchive&&(e.folName=e.folName+" ("+o.archived+")"),zdom("div",{className:"zmLFolder jsFolName","data-action":"folder"},e.folName)):""},i.mds=function(e){return zdom("div",{className:"zmLSendSts "+d.jsCls.mdsStaus,title:e.tooltip},zdom("div",{className:"zmSndStsCon "+e.mdsParentCls},zdom("span",{className:"zmSndStsIco"},zdom("i",{className:e.iconCls+" "+d.jsCls.mds}))))},i.RSICON=function(e){var t=zdom("div",{className:"zmLSendSts "+d.jsCls.mdsStaus,title:e.tooltip},zdom("div",{className:"zmSndStsRecall "+e.cls},zdom("span",{className:"zmSndStsRIco"})));return e.gif?_zm(".","zmSndStsRIco",t)[0].appendChild(zdom("img",{src:zmResource.get("image","mail/recall-2x.gif"),width:"18px"})):_zm(".","zmSndStsRIco",t)[0].appendChild(zdom("i",{className:"msi-recall "+d.jsCls.mds})),t},i.date=function(e){return l=zmAdHocSettings.getCustomizeMailListing(),e.hasOwnProperty("isDateAdhoc")&&e.isDateAdhoc||!parseInt(l.date)?zdom("div",{className:"zmLDate","data-action":"date"},e.date):""},i.size=function(e){var t="";return l=zmAdHocSettings.getCustomizeMailListing(),(e.hasOwnProperty("isSizeAdhoc")&&e.isSizeAdhoc||!parseInt(l.size))&&(t=zdom("div",{className:"zmLSize","data-action":"size"}),e.size&&(t.innerText=e.size)),t},i.trash=function(e){return l=zmAdHocSettings.getCustomizeMailListing(),e.iconCls&&(e.hasOwnProperty("delete")&&e.delete||!parseInt(l.delete))?zdom("div",{className:"zmLTrash","data-action":"delete"},zdom("i",{className:e.iconCls})):""},i.associate=function(e){return zdom("span",{className:e.iconCls})},i.unReadCount=function(e){var t=e.unReadCount+" "+o.unreadTooltip;return zdom("span",{"data-action":"unReadCount",title:t,className:e.unReadCountCls},"("+e.unReadCount+")")},i.convLoadMore=function(){var e=zmAdHocSettings.getCustomizeMailListing(),t="",i="";return"0"===e.envelope&&(t=zdom("div",{className:"zmHideV zmLType"},zdom("i",{className:"msi-mail zmLTicon"}))),"0"===e.flag&&(i=zdom("div",{className:"zmHideV zmLFg"},zdom("i",{className:"msi-flag zmLNoFg"}))),zdom("div",{className:"zmList"},zdom("div",{className:"zmLact"},zdom("div",{className:"zmHideV zmLChk"},zdom("i",{className:"msi-uncheck"})),zdom("div",{className:"zmLTct"}),i,t),zdom("div",{className:"zmLFCD"},zdom("div",{className:"zmLContent jsContent"},zdom("span",{className:"zmThmClr jsLoadMore"},o.loadMore))))},n.constTemplate=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return i[e]?i[e](t):""};var s={envelope:function(e,t){var i=["msi-rpd","msi-fwd","msi-fwdRpd"][t.newStatus-1];if((e=_zm(".","jsEnvelope",e)[0])&&i){var a=n.constTemplate("envelope",{iconCls:i});a&&(_zm.after(e,a),_zm.removeElement(e))}}};return n.updateElement=function(e,t){var i=t.msgId,a=(zmCenterListing.mailObjectAPI.getViewObject(i)||{}).$element;a&&a.length&&s[e]&&s[e](a[0],t)},n.delete=function(e){var t=(zmCenterListing.mailObjectAPI.getViewObject(e)||{}).$element;t&&t.remove()},n.separateOfflineMails=function(e,t){if(t){var i,a;t===zmail.folId.dId?(a=o.offlineDraftTitle,i=o.onlineDraftTitle):t===zmail.folId.teId?(a=o.offlineTemplateTitle,i=o.onlineTemplateTitle):t===zmail.folId.oId&&(a=o.offlineOutboxTitle,i=o.onlineOutboxTitle);var l=$.e(zdom("h5",{className:"zmListHeader jsOnlineHeader"},a)),n=$.e(zdom("h5",{className:"zmListHeader jsOfflineHeader"},i)),s=$.e(zmail.mailCenter.listElem).find("."+d.jsCls.offlineRow),r=s.first();if(l.insertDOMBefore(r),e){var m=s.last();n.insertDOMAfter(m)}}},n.clearOfflineSeparator=function(){var e=$.e(zmail.mailCenter.listElem);0===e.find("."+d.jsCls.offlineRow).length&&(e.find(".jsOnlineHeader").remove(),e.find(".jsOfflineHeader").remove())},n.applyDisplayDensity=function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:zmAdHocSettings.getListingDisplayDensity(),a=1<arguments.length?arguments[1]:void 0;i=Number(i);var l,n,s=["zmLClassic","zmLCompact","zmLSCompact"],r=["msi-classic","msi-compact","msi-superCompact"];["zm_Container","zm_srch1"].forEach(function(e){if(zmsuite.isWorkspaceAvailable(e)&&(ZMail.topbar.icons.updateAttribute({iconName:"listingView",container:"right",tabId:e,key:"iconClass",value:r[i]}),n="","zm_Container"===e&&"zmStreamTree"!==zmail.mailLeft.selLayerId&&(n="m"),"zm_srch1"===e&&(n=zmSearch.forceSearch?zmSearch.forceSearch:zmSearchUtil.getSearchAppType()),"m"===n)){(l=zmsuite.getCenter(e)[0].getNodes()[2].$el||[]).removeClass(s.join(" ")),l.addClass(s[i]),2===i&&l.addClass(s[1]);var t=!0;("WS"===a||ZMail.utils.isROMode())&&(t=!1),zmAdHocSettings.setListingDisplayDensity(String(i),{sync:t})}})},n}),define([],function(u){var p,g,h,I,v,b,T=zmail.Core.Namespaces.create("ZMail.lView"),e=u("zmCenterListing"),C=u("zmText").get("mail").listing.common,M=e.getMappedClass,S=ZMail.lConstants,w=S.jsCls;T.constPart=function(t,i,a){var l;Object.keys(t).forEach(function(e){(l=t[e](a))&&i.appendChild(l)})},I={envelope:function(){var e=M(p,g,h,"markupIcons"),t=M(p,g,h,"calEvent"),i=M(p,g,h,"outType")||"",a=M(p,g,h,"att"),l=e||t?e||t:a;return h.SCO?T.constTemplate("envelope",{iconCls:i,outbox:!0}):!!l&&T.constTemplate("envelope",{iconCls:l})},checkbox:function(){return T.constTemplate("checkbox",{shwChkBox:h.selBoxVisibility})},flag:function(){var e=M(p,g,h,"flagIcon");return!!e&&T.constTemplate("flag",{iconCls:e})},threadIcon:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=h[p.count]||h.count||"";if(-2===t)return!1;var i=zdom("div",{className:"zmLTct","data-action":"thread"});return-1===t?i.appendChild(zdom("i",{className:"msi-thread",title:C.tooltip.loadFullConversation})):0<t&&i.appendChild(zdom("span",{className:w.thdCount,title:1<t?C.tooltip.showHideConversation:""}," ",t)),void 0!==e.data&&e.data.isOutbox&&i.appendChild(zdom("i",{className:"msi-edit zmLTicon"})),i}};(v={}).sender=function(){var e=zdom("div",{className:"zmLFrom","data-action":"from"}),t=h[p.from]||h.from||S.SPACE,i=T.constTemplate("sender",{tooltip:h[p.sender]||"",from:t});e.appendChild(i);var a=M(p,g,h,"priority");a&&(a=" "+a,_zm.before(i,zdom("i",{className:"msi-priority"+a})));var l=h.hasOwnProperty("TUC"),n=!1;if(h.hasOwnProperty("viewId")&&"zm_srch1"===h.viewId&&(n=!0),!n&&l&&0<h.TUC){var s=T.constTemplate("unReadCount",{unReadCountCls:"zmLThreadUC zmThmClr",unReadCount:h.TUC});_zm.before(i,s)}var r=function(){var e=h[p.draftCount]||h.draftCount||0,t=e&&!h.hideDraftCount,i=zdom("div",{className:"zmLDCInfo","data-action":"parCCount"}),a=!1;t?(i.appendChild(T.constTemplate("draft",{draftCount:e})),a=!0):i.appendChild(zdom("span",{className:"zmLDft"}));var l=h.CMT,n=T.constTemplate("commentCount",{cmtCount:l});return""!==n&&i.appendChild(n),{elem:i,haveDraft:a}}();return e.appendChild(r.elem),r.haveDraft&&_zm.addClass(e,"zmLDftOn"),e},v.titleNsummary=function(){var e,t=h[p.sub]||h.sub||C.noSubject,i=zdom("div",{className:"zmLContent"}),a=zdom("span",{className:"zmLSub","data-action":"subject"});if(h.AT&&(e=S.cls.attachmentIcon),e){var l=T.constTemplate("attachment");""!==l&&a.appendChild(l)}if(h.sumTxt&&Object.keys(h.sumTxt).length)a.appendChild(h.sumTxt.subject),i.appendChild(a),i.appendChild(h.sumTxt.summary);else{a.appendChild(T.constTemplate("subject",{subject:t})),i.appendChild(a);var n=h[p.sum]||h.sum||"";n&&i.appendChild(T.constTemplate("summary",{summary:n}))}return i};v.labelNqckActs=function(){var e=h[p.tagLst]||h.tagLst||"",t=zdom("div",{className:"zmLData","data-action":"pLabel"});if(e.length){var i=T.constTemplate("labels",{tagLst:e,conf:h});void 0!==i&&""!==i&&t.appendChild(i)}var a=h[p.schemaText]||h.schemaText||"";if(a){var l=M(p,g,h,"schemaDisable")||"";l=" "+l;var n=h[p.schemaTip]||h.schemaTip||"",s=M(p,g,h,"schemaIcon"),r=T.constTemplate("quickAction",{quickAct:a,icon:s,disableCls:l,tooltip:n});t.appendChild(r)}var m=function(){var e=h[p.recallStatus]||0;if(e&&-1!==e){var t=M(p,g,h,"recallStatus");return T.constTemplate("RSICON",{tooltip:h.rsTip,cls:t})}if(h[p.deliverySts]){var i=M(p,g,h,"mdsParentClass"),a=M(p,g,h,"deliverySts");return T.constTemplate("mds",{tooltip:h.mailDeliveryTip,mdsParentCls:i,iconCls:a})}}();if(m&&t.appendChild(m),h[S.meta.outboxErrmsg]){var o=zdom("fragment",null,$.dangerouslyParseHTML(h.EM));$.e(o).find("a").addClass(S.cls.link+" jsOutboxLearnMore");var d=zdom("div",{className:"zmLMsg zmRedClr"},zdom("i",{className:"msi-error"}),zdom("span",{className:"zmLMsgText"},o));t.appendChild(d)}return t};b={associates:function(){var e=M(p,g,h,"associate");return!!e&&T.constTemplate("associate",{iconCls:e})},folName:function(){var e=h[p.fName]||h.fName||"";return!!e&&T.constTemplate("folderName",{folName:e})},size:function(){var e=h[p.size]||h.size||"",t=h[p.count]||h.count||0;return e=t&&-1!==t&&-2!==t?0:e,T.constTemplate("size",{size:e})},date:function(){var e=h[p.date]||h.date||"";return!!e&&T.constTemplate("date",{date:e})},trash:function(){var e=h[p.iconArr]||h.iconArr||"";return!!e&&T.constTemplate("trash",{iconCls:e[0]})}};var t=function(e){var t,i=e.returnType;p=e.propertyMap,g=e.classMap;var a,l,n,s,r,m,o=(h=e.data)[p.id]||h.id||"",d=" "+M(p,g,h,"unreadCls")||"",c=" "+M(p,g,h,"archive")||"",f=h[p.data]||h.data||"",z=h.OFFLINE?" "+w.offlineRow:"";return(t=zdom("div",{id:o,className:S.cls.mRow+d+c+z,"data-ty":f})).appendChild((a=e,n=M(p,g,h,"draftAdjustWidth")||"",s=u("zmAdHocSettings").getCustomizeMailListing(),r="","1"===s.envelope&&"1"===s.flag&&(r=" zmLact2CH"),l=zdom("div",{className:"zmLact"+n+r,"data-action":"pRead"}),T.constPart(I,l,a),l)),void 0!==e.data&&e.data.isOutbox&&t.appendChild(function(){var e=M(p,g,h,"flagIcon"),t=zdom("div",{className:e});if(void 0===h.SCO)return zdom("fragment",null);if(1===h.SCO.OT||0===h.SCO.OT){if("queue"===h.S3){var i=h.SCO.OSDT+" @ "+h.SCO.OSTIME;t.appendChild(zdom("span",null,i))}else t.appendChild(zdom("span",null,h.DT));h.SCO.SCTZ?t.appendChild(zdom("span",null,zmail.timezoneList[h.SCO.SCTZ])):t.appendChild(zdom("span",null,zmail.timezoneList[zmail.userTimeZone]))}else{var a=C.recurring.yearly,l=h.SCO.SCTX;0<=l.indexOf("month")?a=C.recurring.monthly:0<=l.indexOf("week")?a=C.recurring.weekly:0<=l.indexOf("daily")&&(a=C.recurring.daily);var n=C.recurring.recurring+" "+a;t.appendChild(zdom("span",null,n)),t.appendChild(zdom("span",null,zmail.timezoneList[h.SCO.SCTZ]))}return t}()),t.appendChild((m=zdom("div",{className:"zmLFCD","data-action":"pFolder"}),T.constPart(v,m),m)),T.constPart(b,t),"dom"===i&&(t=$.e(t)[0]),t};return e.registerListItemTemplate({type:"Mail",generator:t}),T}),zmail.folderCache=function(){var u=function(){this.MO=[],this.showNextPage=0},i=function(e,t,i,a){var l,n,s,r,m=zmList.getListObj(i),o=m.MO,d=o.length,c=!1,f=!0,z=0;if(-1===o.indexOf(e)){var u=zmList.getMailObj(e);if(u&&u.T&&(l=u.T,"msg"===a&&1===(n=zmList.getViewBasedMsgList(l,{fId:i},!0)).length&&zmList.updateModel("TC",1,e)),a&&"newm"!==a)for(s=0;s<d;s++){if(o[s]===e){f=!1;break}if(r=zmList.getMailObj(o[s]),void 0!==l&&r.T===l){if(f=!1,1===zmUtil.getMLConversionValue())if(z=r.TC,zmList.getListObj(l)){for(var p=0;p<n.length;p++)if(t>zmList.getMailObj(n[p]).R){m.MO.splice(s,1),f=c=!0,d=o.length,"thd"===a?zmList.updateModel("TC",u.TC+z,e):zmList.updateModel("TC",z+1,e);break}c||("thd"===a?zmList.updateModel("TC",z+u.TC,o[s]):zmList.updateModel("TC",z+1,o[s]))}else{r.R<t?(m.MO.splice(s,1),"thd"===a?zmList.updateModel("TC",u.TC+z,e):zmList.updateModel("TC",z+1,e),d=o.length,f=!0):"thd"===a?zmList.updateModel("TC",z+u.TC,o[s]):zmList.updateModel("TC",z+1,o[s])}c=!1;break}}if(f){if(1===zmail.convSortOrder&&"newm"===a){for(s=d-1;0<=s;s--)if(t>(r=zmList.getMailObj(o[s])).R){m.MO.splice(s+1,0,e),c=!0;break}}else if(0===zmUtil.getMLConversionValue()&&zmList.sortOrder(i)&&i===zmUtil.getFolId())0===m.showNextPage&&m.MO.push(e),c=!0;else for(s=0;s<d;s++)if(t>zmList.getMailObj(o[s]).R){m.MO.splice(s,0,e),c=!0;break}c||m.MO.push(e),u.T&&0===u.TC&&zmList.updateModel("TC",1,e)}}else f=!1},a=function(e,t,i){var a=zmList.getListObj(t,"MO")||[],l=a.indexOf(e);-1!==l&&a.splice(l,1)},l=function(e){var t=zmList.getMailObj(e);if(t.T){var i,a=t.T;if(i="zm_Container"===zmTab.currentTab?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"),0===zmList.getViewBasedMsgList(a,i).length){var l,n=zmPrev.prevDetails().msgId;$("#"+e).length?(l=$("#"+e).parent().prev().attr("id"))&&(l=l.substring(1)):""!==n&&a===zmList.getMailObj(n).T&&(l=n),$("#thd"+l).remove(),$("#t"+l).remove()}}};return{dolistObj:function(e,t,i){return function(e,t,i){var a,l,n,s=t.length,r=[];for(l=new u,a=0;a<s;a++){var m=t[a],o="";if(m.M){o=m.M;var d,c,f=0,z=zmList.getMailObj(o);z?(m.opened=z.opened,n=z.PA,m.TH&&(i||(f=z.TC,m.DC=z.DC||m.DC,m.DMID=z.DMID,d=void 0===z.TS?void 0!==m.TS?m.TS:m.S:z.TS,m.TS=d,m.TI=z.TI||m.TI||!1,m.TM=z.TM||m.TM||!1,m.TF=z.TF||m.TF||!1,c=m.TSN!==z.TSN?z.SN:m.SN,m.SN=c,m.TSM=z.TSM||m.TSM||"",m.TSN=z.TSN||m.TSN||"",m.TTAGS=m.TTAGS||z.TTAGS||[],m.TSB=z.TSB||m.TSB||"",m.TA=z.TA||m.TA,m.TOADDR=z.TOADDR||m.TOADDR,m.TSNADDR=z.TSNADDR||"",0<m.TC&&(f=m.TC),m.TC=f),m.SM=z.SM||m.SM,m.TO=z.TO||m.TO),n&&(m.PA=n),m.opened+=1):m.opened=1,0===m.TC&&(m.TC=1),void 0===m.FD&&m.TAG[0]&&(m.FD=m.TAG[0]),zmUtil.addMailData(m,o),r.push(o)}else void 0!==m.showNextPage?l.showNextPage=m.showNextPage:m.stateinfo?l.showNextPage=m.stateinfo.showNextPage:void 0!==m.showMore&&(l.showNextPage=m.showMore)}return l.MO=r,l}(0,t,i)},updateObj:function(e){switch(e.mode){case"upd":zmList.updateModel(e.key,e.val,e.msgId);break;case"insert":zmList.getListObj(e.folId)&&i(e.msgId,e.rt,e.folId,e.type);break;case"delete":zmList.getListObj(e.folId)&&a(e.msgId,e.folId,e.type),l(e.msgId),zmList.updateModel("FD",zmail.folId.tId,e.msgId);break;case"move":var t=zmList.getMailObj(e.msgId);zmList.getListObj(e.rFrom)&&a(e.msgId,e.rFrom,e.type),l(e.msgId),zmList.updateModel("FD",e.addTo,e.msgId),zmList.getListObj(e.addTo)&&i(e.msgId,t.R,e.addTo,e.type)}},clearListObj:function(e){zmUtil.removeListMap("unread"),zmUtil.removeListMap("all"),zmUtil.removeListMap("flag");var t,i=zmList.getListObj("","",!0);for(t in i)(zmUtil.isFolderId(t)||zmUtil.isSharedFolder(t)||zmUtil.isLabelId(t))&&(e&&zmCache.clearMailObj({listId:t,reinit:!0}),zmUtil.removeListMap(t))},updateCacheForViews:function(e){var t,i=zmUtil.getFolId(),a=zmList.getListObj(i,"MO");zmCenterListing.mailObjectAPI.rowRemovedInView(e),-1!==(t=$.inArray(e,a))&&a.splice(t,1)},clearSearchList:function(){var e,t,i=zmSearchUtil.getSearchList(),a=i.length;for(e=0;e<a;e++)!(t=i[e])||zmList.isMailListedInApp(t)||zmUtil.isMailContentInUse(t)||zmUtil.isDraftMail(t)||zmUtil.removeMailData(t)},clearSearchMsg:function(e){!e||zmList.isMailListedInApp(e)||zmUtil.isMailContentInUse(e)||zmUtil.isDraftMail(e)||zmUtil.removeMailData(e)},clearMailObj:function(e){var t,i,a,l=e.msgId,n=[],s=e.listId&&zmList.getListObj(e.listId);if(!l||zmUtil.isMailContentInUse(l)||zmList.isMailListedInSearch(l)||zmUtil.isDraftMail(l)){if(s){var r,m,o;for(i=(n=s.MO).length,t=0;t<i;t++)if(l=n[t],a=zmList.getMailObj(l))if(zmUtil.isMailContentInUse(l)||zmList.isMailListedInSearch(l)||zmUtil.isDraftMail(l))e.reinit&&a.TH&&(m=a.T,$.publish("/mail/threadUpdated",m));else if(a.TH)if(m=a.T,r=zmList.getListObj(m)){r=r.MO;var d=!0,c=!1,f=void 0;try{for(var z,u=r[Symbol.iterator]();!(d=(z=u.next()).done);d=!0)o=z.value,zmList.getMailObj(o)&&zmUtil.removeMailData(o)}catch(e){c=!0,f=e}finally{try{d||null==u.return||u.return()}finally{if(c)throw f}}zmUtil.removeListMap(m)}else zmUtil.removeMailData(l);else zmUtil.removeMailData(l)}}else zmUtil.removeMailData(l)}}}(),function(){var S=window.zmInit||{};S.outboxErrorObj={errorBandElem:""},window.zmInit=S;var b=!1,n=!1,w=0,g=zmText.get("mail"),h=g.leftTree,C=g.listing,M=g.preview,e=g.actions,L=ZMail.lConstants,I=L.cls,t={list:ZMail.topbar.icons.model.get("all")},i=function(m){var o,d,c="",f="",z=!1,u=!1;o={selectFolder:e.bulkaction.common.selectall,selectFolderViewAll:e.bulkaction.common.selectfolder,clearSelection:e.bulkaction.common.clearselection,clearAndSelect:e.bulkaction.common.clearandselectall};return m.isBulkActionSet=!1,m.toggleListingBand=function(e){e?m.SpamTrashBand.setBand():m.SpamTrashBand.removeBand()},m.createBulkActionBand=function(e,t){var i,a,l,n,s,r;t&&e&&(a="zm_srch1"===zmTab.currentTab?zmsuite.getCenter()[0].getNodes()[2].$el.parent():$(zmail.mailCenter.listElem).parent(),m.toggleListingBand(!1),m.removeBulkActionBand(),c=o[t],f=e,l=zdom("div",{id:"bulkActBand",className:"zmListInfoBox"},zdom("span",{"x-id":"message"}),zdom("span",{className:"zmSDot"}),zdom("font",{"x-id":"action",className:"zmLink",id:"selectOpt"})).outerHTML,n=$(l),s=n.find("[x-id=message]").removeAttr("x-id"),r=n.find("[x-id=action]").removeAttr("x-id"),s.text(f),r.text(c),i=n[0],(d=$(i)).find("#selectOpt").off("click").on("click",function(){m.isBulkActionSet=!0,m.showClearSelectionBand();var e=zdom("div",{className:"zmAppMask wht jsBulkMask"});ZMail.topbar.header.updateSelectionInfo(),zmsuite.getCenter()[0].$el.find(".zmAppContent").append(e)}),a.before(i),zmsuite.getCenter()[0].$el.addClass("SC_trsh"),u=z=!0)},m.showClearSelectionBand=function(){var e,t,i,a,l,n;c=o.clearSelection,f=C.selmenuopt.all+" "+h.common.emailsel,t=zdom("div",{"x-id":"wrapper"},zdom("span",{"x-id":"message"}),zdom("span",{className:"zmSDot"}),zdom("font",{"x-id":"action",className:"zmLink",id:"clearSelect"})).outerHTML,i=$(t),l=(a=i).find("[x-id=message]").removeAttr("x-id"),n=i.find("[x-id=action]").removeAttr("x-id"),l.text(f),n.text(c),e=$(a.children()),d.html(e),d.find("#clearSelect").off("click").on("click",function(){m.isBulkActionSet=!1,zmList.unchkAll()})},m.toggleBulkActionBand=function(e){e?!u&&z&&(d.show(),u=!0):u&&(d.hide(),u=!1)},m.removeBulkActionBand=function(){z&&(d.remove(),z=!1,i.isBulkActionSet=!1,zmsuite.getCenter()[0].$el.find(".jsBulkMask").remove(),zmsuite.getCenter()[0].$el.removeClass("SC_trsh"),i.toggleListingBand(!0))},m}({});i=function(e){e=e||{};var m=zdom("div",{id:"listingBand",className:"zmListInfoBox js-spam-trash-band"},zdom("span",{id:"emptyTSP",className:"zmLink","x-id":"empty"}),zdom("span",{id:"helpET",className:"zmLink","x-id":"more"}),zdom("font",{"x-id":"message"})).outerHTML,o=zdom("span",{className:"zmSDot"}).outerHTML,d=function(){return $(zmail.mailCenter.listElem)},t=function(){var i,a="",l=function(){var e=S.getListingDetObj()||{};e.fId!==zmail.folId.tId&&e.fId!==zmail.folId.spId||zmail.Folder.EventHandlers.emptyFolContextMenu(e.fId)},n=function(){window.open("//www.zoho.com/mail/help/deleting-mail.html#alink3","_blank").focus()},s=function(){if(a){i&&i.remove();var e=d(),t=0===e.find("."+L.cls.mRow).length;i=function(e){e=e||{};var t=$(m),i={};return t.find("[x-id]").each(function(e,t){t=$(t),(i[t.attr("x-id")]=t).removeAttr("x-id")}),"spam"===e.mode?($(i.empty).text(h.foldercontextmenu.emptyspam),$(i.empty).after(o),$(i.message).text(zmText.applyArgs(h.foldercontextmenu.spamdelete,{days:zmail.userOptions.trashCleanupDays})),$(i.more).remove()):"trash"===e.mode&&($(i.empty).text(h.foldercontextmenu.emptytrash),$(i.empty).after(o),$(i.message).text(zmText.applyArgs(h.foldercontextmenu.trashdelete,{days:zmail.userOptions.trashCleanupDays})),$(i.more).text(h.foldercontextmenu.lrnmore),$(i.more).after(o)),void 0!==e.emptyAction&&$(i.empty).on("click",e.emptyAction),void 0!==e.moreAction&&$(i.more).on("click",e.moreAction),e.hideEmpty&&($(i.empty).next().remove(),$(i.empty).remove()),t}({mode:a,hideEmpty:t,emptyAction:l,moreAction:n}),$("#listingBand.js-spam-trash-band").remove(),e.parent().before(i),zmsuite.getCenter("zm_Container")[0].$el.addClass("SC_trsh")}},r=function(){zmsuite.getCenter("zm_Container")[0].$el.find("#bulkActBand").length||zmsuite.getCenter("zm_Container")[0].$el.removeClass("SC_trsh"),i&&(i.remove(),i=void 0)};return{setBand:function(){var e={};"zmlTreeH"===zmail.mailLeft.selLayerId&&(e=S.getListingDetObj()||{});var t=d().hasClass("zms_streams SC_streams"),i=zmInit.getListingDetObj()&&"2"===zmInit.getListingDetObj().attach;t||e.fId!==zmail.folId.spId||i?t||e.fId!==zmail.folId.tId||i?r():(a="trash",s()):(a="spam",s())},removeBand:function(){r()}}};return $.subscribe("mail/listing/viewchanged",t.setBand),e.SpamTrashBand=t(),e}(i);var l,c=function(e){var t,i={};t=e||(i=function(){var e=S.getListingDetObj(),t={};if(e.fId===zmail.folId.dId)t.children=C.emptylist.drafts;else if(e.fId===zmail.folId.teId)t.children=zdom("fragment",null,C.emptylist.templates,zdom("span",{className:"zmLink jsNewTemplate"},"  ",C.emptylist.newTemplate)),t.action=!0,t.id=e.fId;else if(e.fId===zmail.folId.sId)t.children=C.emptylist.folder;else if(e.fId===zmail.folId.spId&&"unread"!==e.view)t.children=C.emptylist.spam;else if(e.fId===zmail.folId.tId)t.children=C.emptylist.trash;else if(e.fId===zmail.folId.oId)t.children=C.emptylist.outbox;else if(e.fId&&"unread"===e.view)t.children=C.emptylist.unreadfolder;else if(e.label)if("-1"===e.label)t.children=C.emptylist.tagview;else{var i=C.emptylist.filteredtagview,a=zmText.applyArgs(i,{tagname:zmUtil.findTagName(e.label)});t.children=a}else if(e.flag)if("-1"===e.flag)t.children=C.emptylist.flagview;else{var l=C.emptylist.filteredflagview,n=zmText.applyArgs(l,{flagname:zmUtil.findFlagName(e.flag)});t.children=n}else e.fId?t.children=C.emptylist.nomailfolder:t.children=C.emptylist.nomailview;return t}()).children;var a,l=zdom("div",{className:"zmInfoWarnMsg",id:"nomails"},t);return i.action&&(a=l,i.id===zmail.folId.teId&&$.e(a).find(".jsNewTemplate").on("click",function(e){_zm.stopEvents(e),zmUtil.hideMenu(),_zm.isOfflineSyncActive()?zmUtil.compose():zmAppLoader.load("Template").then(function(){zmComponent.createTemplate()})})),l},O=function(){$(zmail.mailCenter.listElem).html(""),zmail.mailCenter.listElem.scrollTop=0,zmUtil.clearCollectionDMap(),ZMail.topbar.icons.renovate({type:"listing",fId:zmUtil.getFolId(),tabId:"zm_Container"}),i.SpamTrashBand.setBand(),i.removeBulkActionBand(),zmCenterListing.mailObjectAPI.dropViewObjectStore("zm_Container")},a=function(){var e,t,i,a,l,n=S.getListingDetObj(),s=[],r="",m="",o=0;if(e={unread:C.common.unreadmsg,archive:C.common.archivemsg,all:C.common.allmsg},t={"-1":C.selmenuopt.all,1:C.flagmenu.infoflag,2:C.flagmenu.important,3:C.flagmenu.followup},i={"-1":C.windowtitle.flagfolder,1:C.windowtitle.infoflagfolder,2:C.windowtitle.impflagfolder,3:C.windowtitle.followupflagfolder},n){if(n.fId?(m=S.findFolName(n.fId),o=zmail.folCount[n.fId]&&zmail.folCount[n.fId].c,l=n.view?(a="unread"===n.view?o?C.windowtitle.unreadfolderwithoutmails:C.windowtitle.unreadfolder:"archive"===n.view?C.windowtitle.archivefolder:C.windowtitle.folder,zmText.applyArgs(a,{foldername:m})):n.flag?(a=i[n.flag],zmText.applyArgs(a,{foldername:m})):n.label?"-1"===n.label?(a=C.windowtitle.tagfolder,zmText.applyArgs(a,{foldername:m})):(a=C.windowtitle.filteredtagfolder,zmText.applyArgs(a,{foldername:m,tagname:zmail.labInfo[n.label].dispName})):(a=n.attach?C.windowtitle.attachfolder:C.windowtitle.folder,zmText.applyArgs(a,{foldername:m})),s.push(l)):n.label?(a=C.windowtitle.tagview,l=zmText.applyArgs(a,{tagname:zmail.labInfo[n.label].dispName}),s.push(l)):n.view?(s.push(e[n.view]),"unread"===n.view&&(o=S.getUnreadViewCount())):n.flag&&("-1"!==n.flag?r=t[n.flag]+" ["+C.common.flagged+"]":r+=C.windowtitle.flagview,s.push(r)),0<o){if("undefined"!=typeof zmUtil){o=zmUtil.commaSeparateNum(o,!0)}s.unshift("("+o+")")}return s}},s=function(){var e=_zm("#","nmenc");e||(e=zdom("div",{id:"nmenc",className:"zmNewMailNoti"}),$(zmsuite.$el.centerHolder).append(e)),S.mNotifier=zmComponent.mailNotifier({parent:e,openMail:function(e){var t=e&&e.M;t&&zmList.getMailData({msgId:t,opentype:2,type:"lt",src:"external",eprm:{accId:zmail.accId}})}}),function(){zmAppLoader.load("SettingUpdateHandler").then(function(){SettingUpdateHandler.init()});zmComponent.notifier.addHandler("mail",function(e,t){var i=(t.opts||{}).sessionData,a=(t.opts||{}).changeId;if((t=t.data||{}).act){var l=t.act;switch(l){case"MAIL_DELIVERY_STATUS":zmAppLoader.load("listingEventHandlers").then(function(){zmail.Listing.Handlers.DeliveryStatus.updateMailDeliveryStatus(t.data)});break;case"RECALL_STATUS":zmAppLoader.load("listingEventHandlers").then(function(){var e=t.data;ZMail.recall.updateStatus(e.M,parseInt(e.RS))});break;case"UNDO_EXPIRED":window.zmRecall&&zmRecall.removeMessageBand();break;case"NEW_MAIL":case"DRAFT_UPDATE":zmAppLoader.load("NewMailNotifier").then(function(){zmail.Listing.Notifier.getNewMessage("newm","chat",t,i)});break;case"OUTBOX_ACTIVITY":zmUtil.updOutbox(t.data);break;case"MARK_FLAGGED":case"MOVE_MAIL":case"ARCHIVE_MAIL":case"UNARCHIVE_MAIL":case"APPLY_FLAG":case"APPLY_LABEL":case"REMOVE_LABEL":zmail.MailAction.Initializer.handleWMSEvents(l,t,t.data,a);break;case"EMPTY_FOLDER":case"FOLDER_READ":case"ADD_FOLDER":case"DELETE_FOLDER":case"MOVE_FOLDER":case"RENAME_FOLDER":zmfolAction.loadFolderApp(function(){zmfolAction.handleWMSEvents(l,t,t.data)});break;case"FOLDER_UPDATE":zmfolAction.loadFolderApp(function(){zmfolAction.wsProcessor(t.data)});break;case"BULK_OPR":zmail.MailAction.Initializer.notifyBulkAction(t.data);break;case"NEWUI_SETTINGS_UPDATE":zmAppLoader.load("SettingUpdateHandler").then(function(){SettingUpdateHandler.handle(t)});break;case"WATCH_EXPIRED":var n=window.zmWatch;if(n){t.stat="success";var s={cmpId:t.data["MessageId "],watchMode:"d"};n.updateWatch(t,s)}break;case"USEROPTIONS_UPDATE":var r=zmail.Settings.MailSuite.ComposeSettings.undo;if(0<t.data.undoInterval&&r){var m=zmail.Settings.MailSuite.Settings.Compose.UndoSendInterval.Setting;r.props.attributes.toggleSwitchActive=!0,m.set(t.data.undoInterval,{undoSendState:!0})}else if(t.data.undoInterval<0&&r){var o=zmail.Settings.MailSuite.Settings.Compose.UndoSendInterval.Setting;zmail.Settings.MailSuite.ComposeSettings.undo.props.attributes.toggleSwitchActive=!1,o.set(t.data.undoInterval,{undoSendState:!1})}}}else zmUtil.debugLog("WS notification ignored "+JSON.stringify(t))}),zmComponent.notifier.addHandler("sharedfolder",function(e,t){zmAppLoader.load("sharefolder").then(function(){zmshare.shNotify(e,t)})})}()},r=zmsuite.createAppRouter(),f=function(e,t,i){return ZMail.listing.collection.storeDMap(e,{mapId:t,startIndex:i,overWrite:!0})};$.extend(S,{rclkId:0,startFill:!1,leftMain:null,mapObj:{unreadCls:"S",id:"M",data:"data",subIcon:"AT",count:"TC",flagIcon:"NFG",date:"DT",from:"F",sub:"SB",sum:"SM",priority:"PR",tagLst:"TAG",dataAttr:"ty",fName:"FN",iconArr:"ICN",outboxSts:"OBT",att:"S",archive:"AR",associate:"HT",draftCount:"DC",outType:"OT",outText:"SCTX",calEvent:"HC",schemaIcon:"actionIcon",schemaIconColor:"actionIconColor",schemaDisable:"expired",sender:"fromaddr",deliverySts:"MDS",mdsParentClass:"MDS",draftAdjustWidth:"AW",markupIcons:"MUI",size:"SZ",recallStatus:"RS"},classObj:{unreadCls:{0:"zmLUrd",2:"zmLUrd",3:"zmLUrd",7:"zmLUrd"},markupIcons:{0:"msi-cart zmDoubleIcon zm_schmIco",1:"msi-flight zmDoubleIcon zm_schmIco"},att:{0:"msi-mail",1:"msi-mail","":"",2:"msi-rpd",3:"msi-fwd",4:"msi-rpd",5:"msi-fwd",6:"msi-edit",7:"msi-fwdRpd",8:"msi-fwdRpd",9:"msi-mail zmHideV"},calEvent:{2:"msi-calendar",3:"msi-calendar zmEvAcc",4:"msi-calendar zmEvDec",5:"msi-calendar zmEvMay",6:"msi-calendar zmEvCan",8:"msi-calendar",9:"msi-calendar",10:"msi-calendar",11:"msi-calendar",12:"msi-calendar"},subIcon:{1:"msi-attachicon"},flagIcon:{0:"msi-flag zmLNoFg jsFlg",1:"msi-flag blueFlag jsFlg",2:"msi-flag redFlag jsFlg",3:"msi-flag greenFlag jsFlg",4:"zmLSchedule SC_red",5:"zmLSchedule zmDGreenClr",6:"msi-multiFlag zmDoubleIcon jsFlg"},priority:{1:"highPriority",2:"highPriority",4:"lowPriority",5:"lowPriority"},outboxSts:{0:"SC_lred",1:"SC_lgreen"},archive:{1:"zmLArchive"},associate:{1:"zmLAssoc"},outType:{1:"msi-schdRecur",2:"msi-reccur"},schemaIcon:{one_click:"msi-tick",goto:"msi-openInTab",review:"msi-rate",review_comment:"msi-review",rsvp:"msi-rsvp"},schemaIconColor:{one_click:"zmlbtn_green",goto:"zmlbtn_red",review:"zmlbtn_orange",review_comment:"zmlbtn_blue",rsvp:"zmlbtn_blue"},schemaDisable:{1:"zmlbtn_disable"},deliverySts:{0:"",1:"msi-mailQue",2:"msi-mailQue",3:"msi-mailQue",4:"msi-mailQue",5:"msi-mailSuc",6:"msi-mailFail",7:"msi-mailFail",8:"msi-mailUndo",9:"msi-mailRetry",10:"msi-mailRetry"},mdsParentClass:{0:"",1:"",2:"zmSndSts-pro",3:"zmSndSts-pro",4:"zmSndSts-pro",5:"zmSndSts-suc",6:"zmSndSts-fail",7:"zmSndSts-fail",8:"zmSndSts-fail",9:"zmSndSts-failB",10:"zmSndSts-fail"},draftAdjustWidth:{1:" zmLact2CV"},recallStatus:{1:"zmSndSts-Inpro",2:"zmSndSts-partial",3:"zmSndSts-fail",4:"zmSndSts-suc",5:"zmSndSts-fail"}},prevHeader:{id:"zmPrevHeader",text:"Preview Text",rIcons:[[{tooltip:e.iconTooltip.prev,iconClass:"msi-prev",data:{action:"msi-prev"}},{tooltip:e.iconTooltip.next,iconClass:"msi-next",data:{action:"msi-next"}}],[{tooltip:e.iconTooltip.popout,iconClass:"msi-popout",data:{action:"openwindow",from:"header"}}],[{tooltip:e.iconTooltip.close,tooltipDir:"right",iconClass:"msi-close",data:{action:"clsPrev"}}]]},initMailAppRouter:function(){r.initialize({hashKey:"mail",handler:zmUrlAct.manualHandler}),r.activate();var e=zmHash.decode();zmail.onDemandListing&&e.key&&(zmail.initialPageTrigger.hash=!0),!e.key||"mail"===e.key&&"tab"===e.params[0]||"mail"===e.key&&!e.params.length?(S.lPageType()?r.setParams(["folder","inbox"]):r.setParams(["views","unread"]),r.update()):"mail"!==e.key&&(S.lPageType()?r.setParams(["folder","inbox"]):r.setParams(["views","unread"]))},init:function(){var e={appname:g.global.appName,appId:"zm_Container",appIcon:"msi-mail",faqKey:"mail listing",searchPlaceHolder:zmText.get("mailsuite").searchMail,data:{LNodes:"2",CNodes:"3"},stateData:{type:"app",data:{accId:zmail.accId,listing:{view:{fId:zmail.folId.iId,view:"",viewId:""},expand:{mId:""}},preview:{p:""}}},handler:{create:function(){!_zm.isSmartComposeEnabled()||!0===zmail.fromOtherService&&"wp"!==zmail.fromService?zmUtil.compose():zmUtil.loadSmartCompose({eType:"1",type:"tab"})}},baseScope:"mail",shortcuts:zmshCut.mail,titleProvider:a,sortLeftLayers:!0,router:r,isNewHeader:!0,isNewPreview:!1};zmsuite.setAppInfo(e),zmWinTitle.registerDefaultProvider(a),zmail.postJsDeffered.promise.then(function(){zmail.onDemandListing||S.initMailAppRouter()}),$.subscribe("/mail/accountSwitch",function(e,t){"success"===(t=t||{}).status&&(S.lPageType()?r.update(["folder","inbox"]):r.update(["views","unread"]))})},indicateOutboxFailure:function(){zmail.outboxFail&&(zmInit.outboxErrorObj.errorBandElem=_zm.succErrMsg("e",g.global.notifoutbox,{noHide:!0}),zmUtil.updSendErrorStatus(!0,zmail.folId.oId))},sendLoadOutbox:function(e){if("hide"===e)$("#zm_outbox_send_load").remove();else{var t=zdom("div",{id:"zm_outbox_send_load",className:"SC_msg SC_imsg"},zdom("span",null));$("body").append(t),$("#zm_outbox_send_load").children("span").html("Loading")}},loadOnDemandListing:function(e){if("zm_Container"===e&&!zmail.initialListingLoaded)if(zmail.initialPageTrigger.restore&&"m"===zmail.restoredApp){var t=zmState.getStoredSessionState().state.data.app.data,i=$.Deferred();$.when(i).then(function(){var e=$.Deferred();t.listing.expand.mId?zmRestore.expandThread(t.listing.expand.mId,e):e.resolve(),$.when(e).then(function(){window.setTimeout(function(){t.preview.p&&zmRestore.restorePreview(t.preview.p)},400)})}),zmList.showMailListing(t.listing.view,{retainPreview:!1,sortAscending:void 0,mlDefObj:i})}else zmail.mailLeft.selId?zmList.showMailListing({fId:zmail.mailLeft.selId}):S.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"})},initMailList:function(){var e,t,i="",a={},l={};l=1===S.lPageType()?(a={fId:e=i=zmail.folId.iId,view:"",label:"",flag:"",attach:""},{fId:i,view:"",lId:"",flag:"",attach:""}):(a={fId:"",view:e="unread",label:"",flag:"",attach:""},{fId:"",view:"unread",lId:"",flag:"",attach:""}),t=f(zmail.mailList,e,1),S.setListingDetObj(a),l.showNxt=t.showNextPage,S.mailList(t.MO,l),ZMail.topbar.icons.renovate({type:"listing",fId:e,tabId:"zm_Container"})},constructView:function(e){var t,i,a,l;for(t in e&&(zmail.folId=e.folId,zmail.folTree=e.folTree,zmail.folCount=e.folCount,zmail.labInfo=e.labInfo,zmail.viewInfo=e.viewInfo,zmail.mailOpt=e.mailOpt),1===zmail.folviewThread&&(zmail.folviewThread=2),zmail.folTree[0])1===(a=zmail.folTree[0][t]).CV&&(a.CV=2);for(i in zmail.folTree[1])for(t in l=zmail.folTree[1][i].CH)1===(a=l[t]).CV&&(a.CV=2);var n,s=zmUtil.getNonConversationFolders(),r=s.length;for(n=0;n<r;n++)zmail.folTree[0][s[n]].CV=0;if(zmail.shrTree=zmail.shrTree||[],zmail.shrLabelTree=zmail.shrLabelTree||[],zmail.showFeature&&zmail.shrLabelTree.length){var m=$.extend({},zmail.shrTree[0],zmail.shrLabelTree[0]);zmail.shrTree[0]=m}zmail.zohoAccLabInfo||(zmail.zohoAccLabInfo=zmail.labInfo),zmUtil.resetCollection(),zmUtil.resetListMap(),zmail.sortOrder=!zmail.mailOpt.isDesc,zmail.mailLeft=zmsuite.getLeft(),S.setListingDetObj({}),zmail.folCount[zmail.folId.sId].c="0",zmail.folCount[zmail.folId.dId].c="0",S.translateSystemFolders(),S.constructLeft(),S.constructCenter(),zmsuite.showExistingApp("zm_Container"),zmail.mailCenter=zmsuite.getCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(e,t){zmList.bindAction(e,t)})},zmfnPrecall:function(){zmail.win.zmCache=zmail.folderCache},getShareFolderSuppressList:function(){var t=$.Deferred(),i={};if(!zmail.shrTree[0])return t.resolve(i);i=zmail.shrTree[0];var e=Object.keys(i);return i[e[0]].hasOwnProperty("Notify")?t.resolve(i):(zmfolAction.getShareFolderNotificationList().then(function(e){return t.resolve(i)}),t.promise())},getSuppressedFolders:function(){zmfolAction.getNotificationSuppressedFolders(zmail.accId).then(function(e){zmail.notificationSuppressedFolders=e.folderList||[]})},isNotificationSuppressed:function(e){return!(!e||!zmail.notificationSuppressedFolders||-1===zmail.notificationSuppressedFolders.indexOf(e))},updateSuppressedFolders:function(e,t){zmail.notificationSuppressedFolders=zmail.notificationSuppressedFolders||[];var i,a=e.length;if(t)for(i=0;i<a;i++)zmail.notificationSuppressedFolders.indexOf(-1===e[i])&&zmail.notificationSuppressedFolders.push(e[i]);else for(i=0;i<a;i++)zmail.notificationSuppressedFolders.indexOf(-1===e[i])&&zmail.notificationSuppressedFolders.pop(e[i])},lPageType:function(){try{var e=zmail.Settings.Platform.Components.SettingManager.get("startup-action").get();if("new-session"===e)return zmail.mailOpt.isFol;if("inbox"===(e=zmail.Settings.Platform.Components.SettingManager.get("mail-app-startup").get()))return 1;if("unread"===e)return 0}catch(e){return zmUtil.debugLog(e),1}},initMailSuite:function(){return new Promise(function(l,e){var t,i;try{t=ZMStore.getInstance("KSCollection").fetchList()}catch(e){zmUtil.debugLog(e)}zmUtil.isNewMDV&&(i=zmModules.mail.initConversationModule()),Promise.all([new Promise(function(e){_zm.isOfflineLockAvailable()?(zmAppLoader.load("mailOffline").then(function(){e()}),zmUtil.requireComposeModule().done(function(){zmCompOffline.sendMailSync(),ZE_Init.loadURL(ZE_Init.jsPath+"/js/zep1.min.js","js","zep1_min"),ZE_Init.loadURL(ZE_Init.cssPath+"/css/editor1.min.css","css","editor1_min")})):e()}),t,i]).then(function(){if(S.isFlex=!0,S.isFocusSet=zmail.mailOpt.isKey?1:0,S.isNewKSEnabled=1,zmshCut.currentLeftId=1===S.lPageType()?zmail.folId&&zmail.folId.iId:"zm_unread",ZMail.listing.init.registerCollection(),zmfolAction.updateSFProperty(),zmUrlAct.init(),S.zmfnPrecall(),S.init(),S.constructView(),S.indicateOutboxFailure(),null===zmail.mailList){if(zmail.onDemandListing=!0,zmail.initialPageTrigger={hash:!1,restore:!1,setting:!1},zmail.initialListingLoaded=!1,S.initMailAppRouter(),!zmail.initialPageTrigger.hash&&"restore"===zmAdHocSettings.getLPageType()){zmail.initialPageTrigger.restore=!0;var e=zmState.getStoredSessionState().state;if(e&&e.data.app&&(zmail.restoredApp=e.data.app?e.data.app.currApp:"",zmail.restoredAccId=e.data.app.data?e.data.app.data.accId:"","m"===e.data.app.currApp)){var t=e.data.app.data;if(t.accId===zmail.accId){zmail.initialListingLoaded=!0;var i=t.listing.view;zmList.showMailListing(i,{retainPreview:!1,sortAscending:void 0})}}}zmail.initialListingLoaded||zmail.initialPageTrigger.hash&&zmail.initialPageTrigger.restore?S.removeMailPageLoader():(zmail.initialPageTrigger.setting=!0,zmail.initialListingLoaded=!0,S.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"}))}else S.initMailList();S.updateCountTitle(),s(),n||(n=!0,$.subscribe("/folder/rename",function(){zmList.updateFolderName()})),zmail.onDemandListing&&!zmail.initialListingLoaded&&($.subscribe("/apps/tabSwitching",function(e,t,i){zmInit.loadOnDemandListing(i)}),$.subscribe("mailsuite/appOpened",function(e,t){zmInit.loadOnDemandListing(t)})),$.subscribe("/maction/newm",function(e,t,i){var a,l,n=t.length-1;zmAppLoader.load("NewMailNotifier").then(function(){for(;0<=n;n--){a=t[n],l=a.M,zmUtil.addMailData(a,l);try{zmail.Listing.Notifier.reviewMailNotification(a,i)}catch(e){zmUtil.debugLog("Problem while updating new mail with id "+l+" "+e)}zmList.updateAttachmentCache(l)}})}),$.subscribe("folder/read",function(e,t,i){zmfolAction.loadFolderApp(function(){zmail.Folder.EventHandlers.markFolderAsReadHandler(t,i)})}),$.subscribe("folder/archived",function(e,t,i){zmfolAction.loadFolderApp(function(){zmail.Folder.EventHandlers.markFolderAsArchived(t,i)})}),$.subscribe("/mail/threadUpdated",function(e,t){zmList.updateThreadList(t)}),$.subscribe("/mail/listMails",function(e,t){"undefined"!=typeof zmList&&(t=t||{},zmList.showMailListing(t,{toSelFol:!0,retainPreview:t.retainPreview}))}),$.subscribe("/mail/updatemailview",function(e,t){zmPreviewTemplate.addMailsInView(t)}),$.subscribe("/mail/previewclosed",function(){zmList&&zmList.clearcpvReq()}),$.subscribe("/mail/msgDiscarded",function(e,t){zmUtil.discardMsg(t)}),$.subscribe("/mail/discardFromThread",function(e,t){zmUtil.discardFromThread(t)}),$.subscribe("wmsevents/mail",function(e,t){zmfolAction.loadFolderApp(function(){zmfolAction.handleWMSEvents(t.event,t.notification,t.content)})}),$.subscribe("wmsevents/mail",function(e,t){zmail.MailAction.Initializer.handleWMSEvents(t.event,t.notification,t.content)}),$.subscribe("m/mail_tab",function(e,t){if(!zmail.restoredAccId||zmail.restoredAccId&&zmail.restoredAccId===zmail.accId){var i=$.extend({},t.data);i.src="restore",zmList.getMailData(i)}else t.appId&&zmsuite.closeWorkspace(t.appId)}),$.subscribe("m/mail_attachment",function(e,t){(t=t.data).attObj.src="restore",zmAttach.util.viewAttachment(t.attObj,t.mode,t.fileExtn)}),$.subscribe("stream/stream_app",function(e,t){var i=t.appId;(t=t.data).src="restore",zmsuite.getAppObj(i).centerObj.paint(),zmsuite.addLoadingBand(i,"list"),zmUtil.requireStreamsApp().then(function(){zmStreamsApp.init(t.groupId,t.src)})}),$.subscribe("stream/stream_post",function(e,t){(t=t.data).src="restore",zmUtil.loadStreamsInTab(t)}),$.subscribe("stream/stream_mail",function(e,t){t=t.data,zmUtil.loadStreamsInTab(t)}),$.subscribe("/zm/task/addTask",function(e,t,i){t.TASKID&&zmList.addTaskIndicator(t,i)}),$.subscribe("/note/add",function(e,t,i){t.id&&zmList.addNoteIndicator(t,i)}),$.subscribe("/mail/updateSchema",function(e,t){zmAppLoader.load("listingEventHandlers").then(function(){zmail.Listing.Handlers.SchemaActions.updateSchemaAction(t.msgId,t)})}),$.subscribe("FROM_ADDRESS/CHANGE",function(e,t){var i=zmail.cmpdata.FROM_LIST;i[t.emailId]&&(i[t.emailId].FRM_DISN=t.dispName,t.attr.isDefault?i[t.emailId].FRM_SIGMODE=0:t.attr.isGroup?i[t.emailId].FRM_SIGMODE=2:t.attr.isAliasOrGroup&&(i[t.emailId].FRM_SIGMODE=1),!t.attr.isReplyVerified&&zmail.cmpdata.SETREPTO?i[t.emailId].FRM_REPLY=zmail.cmpdata.SETREPTO:t.attr.isReplyVerified||(i[t.emailId].FRM_REPLY=""),t.attr.isReplyVerified&&(i[t.emailId].FRM_REPLY=t.attr.replyTo))}),$.subscribe("FROM_ADDRESS/REMOVE",function(e,t){delete zmail.cmpdata.FROM_LIST[t.emailId]}),$.subscribe("FROM_ADDRESS/ADD",function(e,t){if(t.attr.isEnabled){var i=zmail.cmpdata.FROM_LIST;i[t.emailId]={FRM_DISN:t.dispName,FRM_SIGID:"null",FRM_SIGMODE:null},t.attr.isReplyVerified&&(i[t.emailId].FRM_REPLY=t.attr.replyTo),t.attr.isDefault?i[t.emailId].FRM_SIGMODE=0:t.attr.isGroup?i[t.emailId].FRM_SIGMODE=2:t.attr.isAliasOrGroup?i[t.emailId].FRM_SIGMODE=1:i[t.emailId].FRM_SIGMODE=3}}),$.subscribe("/streams/changePreview",function(e,t){var i=t.$el;i.removeAttr("data-mid"),i.removeAttr("data-ty")}),$.subscribe("mail/folder/countUpdated",function(e,t){try{zmInit.getListingDetObj().fId!==t.fId||ZMail.utils.selMailsCount()||ZMail.topbar.icons.renovateIcon({type:"listing",fId:t.fId,icon:"moreAction"})}catch(e){zmUtil.debugLog(e)}}),_zm.isOfflineLockAvailable()&&(ZMail.IDB.syncer.init(),$.subscribe("compose/offline/outboxView",function(){(zmInit.getListingDetObj()||{}).fId===zmail.folId.oId&&$.publish("/mail/listMails",{fId:zmail.folId.oId})}),$.subscribe("compose/offline/draftsView",function(){(zmInit.getListingDetObj()||{}).fId===zmail.folId.dId&&$.publish("/mail/listMails",{fId:zmail.folId.dId})}),$.subscribe("compose/offline/templatesView",function(){(zmInit.getListingDetObj()||{}).fId===zmail.folId.teId&&$.publish("/mail/listMails",{fId:zmail.folId.teId})}),$.subscribe("compose/offline/savedDraft",function(e,t){var i=t.msgId;t.folderId,ZMail.IDB.adapter.transact({action:"delete",record:{key:i}})})),$.subscribe("smartFilter/all",function(e,t){zmail.isSmartComposeEnabled=t}),$.subscribe("smartFilter/change",function(e,t){zmail.smartFilterStatus[t.attributes.name]=t.attributes.enable}),$.subscribe("antispam/add",function(e,t){var i=t.type,a=t.value;"te"===i&&ZMail.listing.collection.updateProperty({keyPath:"antispam.trustedSenders",opType:"add",value:a})}),$.subscribe("antispam/edit",function(e,t){var i=t.newValue,a=t.oldValue;if("te"===t.type){var l=ZMail.listing.collection;l.updateProperty({keyPath:"antispam.trustedSenders",opType:"remove",value:a}),l.updateProperty({keyPath:"antispam.trustedSenders",opType:"add",value:i})}}),$.subscribe("antispam/remove",function(e,t){var i=t.type,a=t.value;"te"===i&&ZMail.listing.collection.updateProperty({keyPath:"antispam.trustedSenders",opType:"remove",value:a})});var a=function(){zmail.allowInline=1!==zmail.mailOpt.compTab};zmAdHocSettings.subscribe("settingsloaded",a),zmAdHocSettings.subscribeComposeTypeChange(function(){a(),$.publish("/mail/listMails",{})}),zmail.loadCompleted=!0,zmInit.getSuppressedFolders(),zmInit.getShareFolderSuppressList(),zmAppLoader.load("mailPostLoad"),l()})})},hashFolPath:function(e){var t="",i="";return e===zmail.folId.iId||"inbox"===e?(t+="inbox",i=zmail.folId.iId):e===zmail.folId.dId||"drafts"===e?(t+="drafts",i=zmail.folId.dId):e===zmail.folId.spId||"spam"===e?(t+="spam",i=zmail.folId.spId):e===zmail.folId.teId||"templates"===e?(t+="templates",i=zmail.folId.teId):e===zmail.folId.sId||"sent"===e?(t+="sent",i=zmail.folId.sId):e===zmail.folId.tId||"trash"===e?(t+="trash",i=zmail.folId.tId):e===zmail.folId.oId||"outbox"===e?(t+="outbox",i=zmail.folId.oId):"unread"===e||"zm_unread"===e?(t+="unread",i="zm_unread"):"all"===e||"zm_all"===e?(t+="all",i="zm_all"):"flag"===e||"zm_flag"===e?(t+="flagged",i="zm_flag"):/^\+?(0|[1-9]\d*)$/.test(e)&&(t+=e,i=e),{hashTxt:t,folId:i}},constructLeft:function(){var e,l,t=[];e=zmail.mailLeft.getNodes();var i={name:"dispName",color:"color",id:"id",count:"c",sequence:"se"};zmail.showFeature&&(i.shared="shId");if(_zm.isStreamsEnabled()){var a=new ZMLayer,n={type:"1",listId:"zmsTree",hasChild:!1,mapObject:{id:"id",name:"name",count:"scount",sequence:"order"},id:"zmStreamTree",dataObject:{headerObject:{id:"zmStreamTree",name:h.header.stream,showList:!0},listObject:zmUtil.getEmailEnabledGroup()},disableSelection:!0};n.dataObject.headerObject.settingsOption=!0,n.dataObject.headerObject.settingsObject={className:"msi-manageGroup",tooltip:g.leftTree.streams.manageGrp,onClick:function(){zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0,app:"streams",createCallback:function(e){zmsuite.loadStreams(e)}})})}},zmUtil.isNewGroupUser()&&(n.dataObject.headerObject.scount=zdom("i",{className:"msi-plus"}),n.dataObject.headerObject.addIconTooltip=g.leftTree.streams.addGrp,n.dataObject.headerObject.onAdd=function(){zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({createGroup:!0,app:"streams",createCallback:function(e){zmsuite.loadStreams(e)}})})}),a.push(n),t.push(a)}zmail.folCount[zmail.folId.teId].c=zmail.discardFolCnt[zmail.folId.teId],zmail.folCount[zmail.folId.dId].c=zmail.discardFolCnt[zmail.folId.dId];var s=new ZMLayer,r={type:"1",listId:"zmlTree",hasChild:!0,hasCountObject:!0,mapObject:{id:"id",name:"FN",count:"c",parentId:"p",hasChild:"HC",expChild:"E",sequence:"SE",shared:"SH"},id:"zmlTreeH",dataObject:{headerObject:{id:"zmlTreeH",name:h.header.folders,count:zdom("i",{className:"msi-plus"}),showList:!0,onAdd:function(){zmfolAction.loadFolderApp(function(){zmfolAction.showCreateFolderPopUp({mode:"new"})})}},listObject:zmail.folTree[0],childObject:zmail.folTree[1],countObject:zmail.folCount}};s.push(r),s.setDragDrop({allowedParents:"#zmlTreeH",getDescendant:0===zmail.mailOpt.folSort,onDrop:function(e,t,i,a){zmfolAction.loadFolderApp(function(){zmfolAction.onDrop(e,t,i,a)})},allowDrag:function(e){return zmfolAction.allowDrag(e)},allowDrop:function(e,t,i){return zmfolAction.allowDrop(e,t,i)},dragStart:function(e,t){var i,a={};for(i in t)l=i;return a.text=t[l].FN,a}});var m=new ZMLayer,o={type:"2",mapObject:i,listId:"zmllabel",id:"zmllabelH",dataObject:{headerObject:{id:"zmllabelH",name:h.header.tag,showList:!0,count:zdom("i",{className:"msi-plus"}),onAdd:function(){zmlab.showCreateTagPopUp({mode:"new"})}},listObject:zmUtil.getTagList()}};m.push(o),m.setDragDrop({allowedParents:"#zmllabelH,."+L.cls.mRow,onDrop:function(e,t,i,a){var l,n,s,r,m={},o=[],d=[];for(l in t)s=l;if("center"===a){for(n=i.length,l=0;l<n;l++)-1!==i[l].id.indexOf("t")?o.push(S.zmsubStr(i[l].id,"t")):d.push(i[l].id);if(o.length||1!==d.length)r=zmTab.currentTab.indexOf("zm_srch")?S.getListingDetObj().fId:"";else{var c=zmList.getMailObj(d[0]);r=c&&c.FD}if(!r||r===zmail.folId.dId||r===zmail.folId.teId||r===zmail.folId.oId||r===zmail.folId.spId)return!1;m={action:"label",msgId:d,thd:o,lA:"add",lId:s},zmail.MailAction.Initializer.applyActions("label","click",m)}else zmlab.labelmov("m",t,i)},allowDrag:function(){return!0},allowDrop:function(e,t,i){return"inside"!==i&&(0===zmail.mailOpt.labSort||"next"!==i&&"prev"!==i)},dragStart:function(e,t){var i,a,l={};for(i in t)a=i;return l.text=t[a].dispName,l},rowCls:I.mRow,selCls:I.chkBox});var d=new ZMLayer,c={type:"1",mapObject:{id:"id",name:"FN",count:"c",parentId:"p"},listId:"zmlview",id:"zmlviewH",hasCountObject:!0,dataObject:{headerObject:{id:"zmlviewH",name:h.iconTooltip.views,showList:!0},listObject:{zm_unread:{FN:C.common.unread},zm_all:{FN:C.common.allmsg},zm_flag:{FN:C.common.flagged}},countObject:{zm_unread:{c:S.getUnreadViewCount(),p:"-1"},zm_all:{c:0,p:"-1"},zm_flag:{c:0,p:"-1"}}}};if(d.push(c),t.push(s),zmUtil.isShrFolEnabled()&&zmail.shrTree.length&&zmail.accId===zmail.defAccId){var f=new ZMLayer,z={type:"3",mapObject:{id:"id",name:"FN",OZUID:"OZUID",accessText:"ROLE",entityClass:"RT",sharedFolderToolTip:"roleName",dispName:"DISP_NAME"},listId:"zmlSTree",id:"zmlSTreeH",classObject:{accessText:{11:"R",12:"W",13:"W"}},dataObject:{headerObject:{id:"zmlSTreeH",name:h.header.sharedwithme,showList:!0},listObject:zmail.shrTree[0]}};zmail.showFeature&&(z.entityClass={entityClass:{91:"msi-folder",92:"msi-label"}}),f.push(z),t.push(f)}if(t.push(m),t.push(d),zmail.savedSearchList&&0<Object.keys(zmail.savedSearchList).length){var u=new ZMLayer,p={type:"1",mapObject:{id:"id",name:"FN",sequence:"SE"},disableSelection:!0,listId:"zmlSSrchTree",id:"zmlSSrchTreeH",dataObject:{headerObject:{id:"zmlSSrchTreeH",name:h.header.savedsearch,showList:!0},listObject:zmail.savedSearchList}};u.push(p),t.push(u)}e[0].push({layerArr:t}),zmail.mailLeft.render(),1===S.lPageType()?(l=zmail.folId.iId,zmsuite.getLeft().selRow(l,"zmlTreeH")):(l="zm_unread",zmsuite.getLeft().selRow(l,"zmlviewH")),zmail.mailLeft.setListener("click",function(e){S.bindLeftActions(e)}),zmail.mailLeft.setListener("contextmenu",function(e){S.bindLeftActions(e)}),zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").setChildToggle(S.viewChild)},constructCenter:function(){var e=zmsuite.getCenter()[0].getNodes();e[1].appendIconBar(),e[1].push(t.list),e[2].setListener("click",function(e){("zm_Container"!==zmTab.currentTab||"2"!==zmInit.getListingDetObj().attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.bindEventsMailRow(e)}),e[2].setListener("contextmenu",function(e){("zm_Container"!==zmTab.currentTab||"2"!==zmInit.getListingDetObj().attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.mailUtility(e)}),e[2].setDragDrop({onDrop:function(e,t,i){var a,l,n,s,r=[],m=[];for(n in i)a=n;for(s=t.length,n=0;n<s;n++)-1!==t[n].id.indexOf("t")?m.push(S.zmsubStr(t[n].id,"t")):r.push(t[n].id);i[a].FN?(l={action:"move",folId:a,msgId:r,thd:m},zmail.MailAction.Initializer.doActions("move","drop",l)):(l={action:"label",msgId:r,thd:m,lA:"add",lId:a},zmail.MailAction.Initializer.applyActions("label","drop",l))},allowDrag:function(){var e;return(e=S.getListingDetObj().fId)!==zmail.folId.dId&&e!==zmail.folId.teId&&e!==zmail.folId.spId&&e!==zmail.folId.oId&&"2"!==zmInit.getListingDetObj().attach&&!zmUtil.isSharedFolder(e)&&!ZMail.utils.isROMode()},allowDrop:function(e,t,i){var a,l;for(a in t)l=a;return t[l].FN?"inside"===i&&(l!==zmail.folId.dId&&l!==zmail.folId.teId&&l!==zmail.folId.oId&&"2"!==zmInit.getListingDetObj().attach):"inside"===i},dragStart:function(e,t){var i,a={};return 1<t.length?(a.count=zmUtil.getCheckedMailCount(),a.text=h.common.emailsel):(i=S.zmsubStr(t[0].id,"t"),a.text=zmUtil.replaceHtmlInSubject(zmList.getMailObj(i).SB)),a},allowedParents:"#zmlTreeH,#zmllabelH,.zmTtab",rowCls:I.mRow,selCls:I.chkBox}),zmsuite.renderCenter(),ZMail.topbar.icons.initResizeHandler(),ZMail.topbar.header.renovate(),ZMail.lView.applyDisplayDensity()},getListingDetObj:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"zm_Container";return ZMail.listing.collection.getViewDetails(e)||{}},setListingDetObj:function(e,t){t=t||"zm_Container",ZMail.listing.collection.setViewDetails(t,e)},viewChild:function(e,t){if(!_zm.isOfflineSyncActive()){var i,a,l,n={};if(e.zmsData)for(var s in e.zmsData.rowObject)n=e.zmsData.rowObject[s],i=s;else n=e,i=t[0].id;a=t.find(".msi-barrow"),l={accId:zmail.accId,mode:"expand",folId:i},a.length?(l.isExpand=1,n.E=1):(l.isExpand=0,n.E=0),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:"",p:l,csr:"s"})}},flgClass:function(e,t){return 1===(e=parseInt(e))?I.blueflag:2===e?I.redflag:3===e?I.greenflag:6===e?I.mulflag:"s"===t?"":I.noflag},getThdFlagvalue:function(e){var t;if(e){var i=zmList.getMailObj(e);t=i.TI&&i.TF||i.TF&&i.TM||i.TM&&i.TI?6:i.TF?3:i.TM?2:i.TI?1:0}return t},findFolName:function(e){if(zmail.folTree[0][e])return zmail.folTree[0][e].FN;var t,i=zmail.folTree[1];for(var a in i)if((t=i[a].CH)[e])return t[e].FN;var l=zmail.shrTree||[];for(var n in l)if(l[n][e])return l[n][e].FN;return""},getMails:function(e){var t,i,a=e.prms,l=e.ty,n=e.showLoadingBar,s=e.notifyOnEnd,r=e.exPrms,m=void 0===r?{}:r,o=a.f,d=a.t,c=a.fId,f=a.label,z=a.flag,u=a.attach,p=a.view;o||(o=1);var g,h={from:o,to:d,ty:l,fId:c,lId:f,view:p,flag:z,attach:u,cache:!1,scenario:a.scenario,retainPreview:a.retainPreview,sortOrder:a.sortOrder,mlDefObj:s,sortType:a.sortType};$.extend(h,m);var I={mode:"listing",accId:zmail.accId,from:o,to:d,summary:!0,sortBy:a.sortBy||"date",sortOrder:a.sortOrder,folderSpec:zmUtil.getMLConversionValue()};a.shId&&(I.shId=a.shId,2===zmail.folviewThread&&(I.folderSpec=1),zmail.opType.list?I.opType=zmail.opType.list:I.opType=0,c&&zmUtil.isSharedFolder(c)&&92===zmail.shrTree[0][c].RT&&(f=c,c="")),""!==c&&(I.folId=c,h.from=o,c===zmail.folId.sId&&(I.folderSpec=0)),""!==z&&(I.flag=z,a.sendReq=!0),""!==f&&(I.label=f,a.sendReq=!0),""!==u&&(I.attach=u,a.sendReq=!0),""!==p&&(c&&"all"===p||(I.view=p),a.sendReq=!0),g=c||f||p;var v=zmUtil.getListMap(g);if(v&&(t=v.MO,h.showNxt=v.showNextPage),i=a.callbk?a.callbk:S.mailList,!v||a.sendReq){h.req="server",h.reqId=++w;var b,T={p:I,ep:h},C=zmail.mailCenter.listElem;if(!n){var M=1===a.f?"listing":"pagination";b=zmComponent.loadingBand({container:C,type:M,addAtFirst:1===a.f})}T.fn=function(e,t){b&&b(),i(e,t)},T.efn=function(e,t,i,a){b&&b(),S.onNetFailure(e,t,i,a)},T.type="GET",ZMail.listing.collection.fetchMailList(T),zmUtil&&(zmUtil.isSharedFolder(c)||zmUtil.isFolderId(c)&&"-1"!==zmList.getRowInfo(c,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp().then(function(){})}else i(t,h)},foldView:function(e){var t,i,a,l="",n="",s="",r="",m="",o="",d="",c=e.folId||"",f=e.view||"",z=e.viewId||"",u=e.reInitialize,p=e.isLoadingNotNeeded,g=e.retainPreview,h=e.sortOrder,I=zmfolAction.getSortProperties(c,"",h);if(i=S.getListingDetObj(),zmail.initialListingLoaded||(zmail.initialListingLoaded=!0),i.view?(d=i.view,n=i.view):i.label?(d="label",n=i.label):i.attach?(d="attach",n=i.attach):i.flag&&(d="flag",n=i.flag),i.fId?l=i.fId:i.label&&(l=i.label),-1!==c.indexOf("zm_")&&(f=c.substring(3,c.length),c="","unread"===f||"all"===f?z=f:""===z&&(z="-1")),l!==c||d!==f||n!==z){S.startFill=!1,t=c,"flag"===f?(f="",m=z||-1):"attach"===f?(f="",o=1):"label"===f&&(f="",r=z||-1),a=$("#zm_Main .SC_frt .SC_mtb").eq(1),c||"unread"!==f&&"all"!==f&&"flag"!==f?a.show():"flag"===f?a.show():a.hide(),zmail.labInfo[c]&&(r=c,t=c=f=""),zmail.loadCompleted&&!g&&zmPrev.clsPreview("list"),("stream"===f||t&&"all"===f)&&(f=""),ZMail.listing.collection.clearModels({listId:zmUtil.getFolId()}),s='{"fId":"'+t+'","view":"'+f+'","flag":"'+m+'","label":"'+r+'","attach":"'+o+'","sortBy":"'+I.sortBy+'","sortOrder":'+I.sortOrder+"}",S.setListingDetObj(s),$.isEmptyObject(i)||O();var v={f:1,t:zmail.mailOpt.range,fId:c,view:f,flag:m,label:r,attach:o,sortBy:I.sortBy,sortOrder:I.sortOrder,callbk:S.mailList,retainPreview:g,sortType:I.type};if(u){var b=ZMail.utils.getHeaderRef({tabId:"zm_Container"}).find(".msi-uncheck");(b.hasClass("msi-check")||b.hasClass("msi-partcheck"))&&(b.removeClass().addClass("msi-uncheck"),ZMail.topbar.icons.renovate({type:"functional",tabId:"zm_Container",toHide:!0})),v.callbk=function(e,t){S.reInitListing(),S.mailList(e,t)}}else zmList.unchkAll();c&&"zmlSTree"===$("#"+c).parent().attr("id")&&(v.shId=zmList.getRowInfo(c,"zmlSTreeH","info").SHID),$.publish("mail/listing/viewchanged",[]);var T={fId:e.folId||zmail.mailLeft.selId,view:e.view,viewId:e.viewId};zmRestore.saveState("listing",T,{}),zmUrlAct.update(e),S.getMails({prms:v,ty:"n",showLoadingBar:p,notifyOnEnd:e.hashDeffObj})}},checkThreadRead:function(e){var t,i,a=[];if(zmUtil.getListMap(e)){var l,n=S.getListingDetObj();for(i=(a=zmList.getViewBasedMsgList(e,n)).length,t=0;t<i;t++)if((l=zmList.getMailObj(a[t]))&&0===l.S)return!1}return!0},onNetFailure:function(e,t,i,a){var l=zdom("div",{className:"zmInfoWarnMsg"},zdom("i",{className:"msi-error zmInfoWarnIcon"}),C.common.netFailure,zdom("span",{className:"zmLink jsReloadListing"},C.common.eRetry));$.e(zmail.mailCenter.listElem).appendDOM(l,{clear:!0}),S.removeMailPageLoader()},removeMailPageLoader:function(){$("#ms_load").remove();try{window.performance&&performance.mark&&!performance.getEntriesByName("mark_fully_visible").length&&(performance.mark("mark_fully_visible"),window.performance.timing&&window.performance.timing.navigationStart&&!0===zmail.isInternalOrgUser&&zmAppSuite.setLoadingTime(Date.now()-window.performance.timing.navigationStart))}catch(e){zmUtil.debugLog(e)}},mailList:function(e,t){if(!zmail.loadCompleted||t.reqId===w){var i,a,l,n;if("-1"!==(l=(n=S.getListingDetObj()).fId||n.view||n.label||n.flag)&&"1"!==l&&"2"!==l&&"3"!==l||(l="flag"),"server"===t.req?(a=(i=f(e,l,t.from)).showNextPage,i=i.MO):(i=e,a=t.showNxt,t.to=i.length),void 0===t.sortOrder||0!==zmUtil.getMLConversionValue()&&l!==zmail.folId.sId||l===zmail.folId.teId||zmUtil.updateListMap(l,"sortOrder",t.sortType),b=!1,S.startFill=!0,l===zmail.folId.oId?$(zmail.mailCenter.listElem).addClass("SC_obox"):$(zmail.mailCenter.listElem).removeClass("SC_obox"),0<i.length){var s=$(S.constructMailRow(l,i));if($(zmail.mailCenter.listElem).find("."+L.cls.mRow).length){var r=$(zmail.mailCenter.listElem)[0].scrollTop;$(zmail.mailCenter.listElem).append(s),$(zmail.mailCenter.listElem)[0].scrollTop=r;var m=ZMail.utils.getHeaderRef({tabId:L.mailAppId}).find(".msi-uncheck");m.hasClass("msi-check")&&m.removeClass().addClass("msi-uncheck msi-partcheck")}else $(zmail.mailCenter.listElem).html(s)}else 1===t.from&&$.e(zmail.mailCenter.listElem).dangerouslySetInnerHTML(c());if(S.removeMailPageLoader(),0<=a&&$(zmail.mailCenter.listElem).data("data-ty",a),zmail.loadCompleted&&1===t.from){if(zmail.mailCenter.listElem.scrollTop=0,!_zm.isOfflineSyncActive()&&(t.fId&&!zmUtil.isSharedFolder(t.fId)||!t.fId&&"unread"===t.view))!function(e){if(zmsuite.isWorkspaceAvailable("zm_Container")){var t,i=S.getListingDetObj();t=i.fId?parseInt(zmail.folCount[i.fId].c):parseInt(zmail.folCount[zmail.folId.iId].c),(i.fId&&i.fId!==zmail.folId.sId&&i.fId!==zmail.folId.teId&&i.fId!==zmail.folId.dId&&t!==e||!i.fId&&"unread"===i.view&&t!==e)&&S.getFolderTreeCount()}}(parseInt(e[e.length-1].unCnt));if(t.fId&&(t.fId===zmail.folId.dId||t.fId===zmail.folId.teId)){var o=0;e[e.length-1].hasOwnProperty("tcount")&&(o=parseInt(e[e.length-1].tcount||0)),ZMail.utils.updateCount({fId:t.fId,mode:"upd",state:"read",count:o})}S.listingBand.SpamTrashBand.setBand()}if($(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){zmUtil.hideMenu(),S.fillMails()}),zmail.loadCompleted&&t.retainPreview){var d=zmPrev.prevDetails();d.msgId&&zmList.getMailObj(d.msgId)&&zmList.setMailSelection(d.msgId,d.type,$(zmail.mailCenter.listElem))}t.mlDefObj&&t.mlDefObj.resolve(),zmail.isRHSEnabled&&zmAdHocSettings.dataLoadedDef.done(function(){"true"===zmAdHocSettings.getRhsOnBoarding()&&zmAppLoader.loadFiles("extcss",zmResource.get("css","integrationOnboarding.css")),zmModules.getRHSModule().then(function(){zmAppLoader.load("zmWidgets")})}),t.hasOfflineEmails&&ZMail.lView.separateOfflineMails(t.hasOnlineEmails,t.fId),zmail.mailOpt.isKey||(zmInit.isFocusSet=!1)}},constructMailRow:function(e,t){var i,a,l,n,s,r,m,o=document.createDocumentFragment(),d=[],c=S.getListingDetObj(),f=zmCenterListing.create({type:L.templateName.mail,mapObj:S.mapObj,classObj:S.classObj}),z={},u={},p=" ("+M.contentOptions.archived+")",g="zm_Container",h=zmUtil.getMLConversionValue(e),I=zmUtil.isSharedFolder(e);for(e===zmail.folId.sId&&(z={0:"",1:C.mailDeliveryStatus.tooltips.queued,2:C.mailDeliveryStatus.tooltips.inprogress,3:C.mailDeliveryStatus.tooltips.inprogress,4:C.mailDeliveryStatus.tooltips.inprogress,5:C.mailDeliveryStatus.tooltips.success,6:C.mailDeliveryStatus.tooltips.failure,7:C.mailDeliveryStatus.tooltips.failure,8:C.mailDeliveryStatus.tooltips.undo,9:C.mailDeliveryStatus.tooltips.retry,10:C.mailDeliveryStatus.tooltips.retry},u={0:"",1:C.mailDeliveryStatus.tooltips.rcProcess,2:C.mailDeliveryStatus.tooltips.rcParSucc,3:C.mailDeliveryStatus.tooltips.rcFailed,4:C.mailDeliveryStatus.tooltips.rcSuccess,5:C.mailDeliveryStatus.tooltips.rcFailed}),e||-1===zmTab.currentTab.indexOf("zm_srch")||(e=zmSearchUtil.getSearchedFolders()[0]||"",g=zmTab.currentTab),n=S.getMailRowIcons(e),r=(d=t||zmList.getListObj(e,"MO")).length,s=0;s<r;s++){a=d[s],m=zmUtil.getMailModel(a).attributes,(i=$.extend({},m)).viewId=g,(I||zmail.folCount[e])&&"zm_srch1"!==g||(i.FN=S.findFolName(m.FD),!m.AR||"zm_srch1"!==g&&c.fId||(i.FN+=p)),zmail.mailOpt.isshowSummary||(i.SM=""),i.isOutbox=!1,e===zmail.folId.oId&&(i.isOutbox=!0),e===zmail.folId.sId||e===zmail.folId.oId||e===zmail.folId.dId||e===zmail.folId.teId?i.fromaddr=i.TOADDR||i.TO||(i.CC&&"Not Provided"!==i.CC?i.CC:"")||i.BCC||"":i.fromaddr=i.F||i.SN||"",0!==g.indexOf("zm_srch")&&0!==h||(i.DC=0),0!==g.indexOf("zm_srch")&&0!==h&&m.TH&&e!==zmail.folId.tId&&e!==zmail.folId.dId&&e!==zmail.folId.sId&&0<m.TC&&(i.M="t"+i.M,i.S=m.TS,i.TS2&&(1===i.TS2?i.S=0===i.S?2:4:2===i.TS2?i.S=0===i.S?3:5:3===i.TS2&&(i.S=0===i.S?7:8)),i.NFG=S.getThdFlagvalue(a),zmail.mailOpt.isshowSummary&&(i.SM=m.TSM),i.SB=S.getThreadSubject(a),i.TAG=m.TTAGS,i.AT=m.TA),e===zmail.folId.sId||e===zmail.folId.oId?(e===zmail.folId.oId&&(i.S=""),i.F=m.TOADDR||i.TO||(i.CC&&"Not Provided"!==i.CC?i.CC:"")||i.BCC||C.common.undisclosed):(e===zmail.folId.spId&&(i.NFG="-1",i.TAG=[]),i.F=0===h?m.SN||m.F:m.TSN||m.SN||m.F);try{0===i.TH&&i.F===zmail.aInfo[zmail.accId].mailId&&(i.F="Me")}catch(e){}if(e===zmail.folId.oId?"queue"===i.S3?i.NFG="5":(i.NFG="4",i.OBT="0"):e===zmail.folId.teId?(i.AW=1,i.TC=-2,i.NFG="-1",i.S="",i.F=m.TOADDR||C.common.undisclosed):e===zmail.folId.dId?(i.AW=1,i.TC=-2,i.NFG="-1",i.S="",i.TAG=[],i.F=m.TOADDR||C.common.undisclosed):e===zmail.folId.tId||e===zmail.folId.spId?i.TC=-2:e===zmail.folId.sId?(i.S="",i.TH&&(i.TC=-1)):!i.TH||0!==h&&0!==g.indexOf("zm_srch")||(i.TC=-1,1===i.NS2?i.S=0===i.S?2:4:2===i.NS2?i.S=0===i.S?3:5:3===i.NS2&&(i.S=0===i.S?7:8)),i.UW=zmList.isRMOBJ(a),i.AWMID=a,i.data="lt",i.OFFLINE?i.ICN=["msi-trash"]:i.ICN=$.extend([],n),((m.MA||m.MSGREL&&-1<m.MSGREL.indexOf("1"))&&!zmUtil.isSharedFolder(e)||i.UW)&&(i.HT="1"),m.FD===zmail.folId.sId&&e===zmail.folId.sId||(i.MDS=0,i.RS=0),m.SZ&&(i.SZ=ZMail.utils.getMailSize(m.SZ)),m.SCO&&(i.OT=m.SCO.OT,i.SCTX=m.SCO.SCTX),i.hideDraftCount=m.FD===zmail.folId.dId,i.CT=Boolean(m.CT),i.mailDeliveryTip=z[i.MDS]||"",i.rsTip=u[i.RS]||"",m.SCOBJ&&m.FD!==zmail.folId.spId&&e!==zmail.folId.sId){var v=C.quickactions,b=m.SCOBJ[0]||{};if("REVIEWACTION"===b.SCATYPE)i.schemaTip=_zm.escapeTags(b.DESC||""),i.schemaText=v.review,b.SHOWRB?i.actionIcon=i.actionIconColor="review_comment":i.actionIcon=i.actionIconColor="review";else if("RSVPACTION"===b.SCATYPE){if(b.EXPIRED)i.schemaTip=v.eventexpired,i.schemaText=v.rsvp,i.expired=1;else{i.schemaTip=_zm.escapeTags(b.DESC||"");var T={yes:v.yes,no:v.no,maybe:v.maybe};b.RSVPSTUS?i.schemaText=v.attending+" : "+T[b.RSVPSTUS]:i.schemaText=v.rsvp}i.actionIcon=i.actionIconColor="rsvp"}else"CONFIRMACTION"===b.SCATYPE||"SAVEACTION"===b.SCATYPE?(i.schemaText=_zm.escapeTags(b.DN||""),i.schemaTip=_zm.escapeTags(b.DESC||""),i.actionIcon=i.actionIconColor="one_click",b.ASTATUS&&(i.expired=1)):"VIEWACTION"===b.SCATYPE||"TRACKACTION"===b.SCATYPE?(i.schemaText=_zm.escapeTags(b.DN||""),i.schemaTip=_zm.escapeTags(b.DESC||""),i.actionIcon=i.actionIconColor="goto"):"ORDER"===b.SCATYPE?(b.ORDEROBJ&&b.ORDEROBJ.VIEWORDERURL&&(i.schemaText=v.orderV,i.actionIcon=i.actionIconColor="goto"),i.F=i.SB,i.MUI=0,i.fromaddr="",i.sumTxt=zmList.markupSummary({schemaObj:b})):"PARCELDELIVERY"===b.SCATYPE?(b.PARCLDLVRYOBJ&&b.PARCLDLVRYOBJ.TRACKINGURL&&(i.schemaText=v.orderT,i.actionIcon=i.actionIconColor="goto"),i.F=i.SB,i.MUI=0,i.fromaddr="",i.sumTxt=zmList.markupSummary({schemaObj:b})):"FLIGHTRESERVATION"===b.SCATYPE&&(b.FLYTTKTOBJ&&b.FLYTTKTOBJ[0].url&&(i.schemaText=zmList.flightQAType(b.FLYTTKTOBJ[0]),i.schemaTip=_zm.escapeTags(b.DESC||""),i.actionIcon=i.actionIconColor="goto"),i.F=i.SB,i.MUI=1,i.fromaddr="",i.sumTxt=zmList.markupSummary({schemaObj:b}))}i.selBoxVisibility=!0,ZMail.utils.isROMode(e)&&(i.selBoxVisibility=!1),f.setDataObj(i),l=$(f.getHTML()),zmCenterListing.mailObjectAPI.setViewObject(a,{id:a,$element:l,isSelected:!1,isExpanded:!1},g),o.appendChild(l[0])}return o},constructListHolder:function(){$(".SCl").last().after(zdom("div",{id:"zm_centerHolder",className:"SCm_parent"}))},getCurrentLeftId:function(){return zmail.mailLeft.selId},checkLoadMoreMails:(l=0,function(){var e,t=$(zmail.mailCenter.listElem),i=t[0].scrollTop,a=t[0].scrollHeight-t[0].offsetHeight;return i<l?e=!1:i>=.8*Math.floor(a)&&(e=!0),l=i,e}),fillMails:_.debounce(function(e){var t,i,a,l,n,s,r="",m="",o="",d=!1,c="";if(S.checkLoadMoreMails()&&(d=!0,zmUtil.debugLog("Mail Listing","Scroll bottom reached. Have to fill new content")),e?(n=e<zmail.mailOpt.range?e:zmail.mailOpt.range,d=!0,S.startFill=!0):n=zmail.mailOpt.range,b&&(d=!1),d&&!0===S.startFill)if(0<$(zmail.mailCenter.listElem).data("data-ty")){-1!==(s=S.getCurrentLeftId()).indexOf("zm_")&&(s=s.substring(3,s.length)),c=(l=S.getListingDetObj()).fId,r=l.label,t=l.view,m=l.flag,o=l.attach,"unread"!==c&&"all"!==c&&"flag"!==c||("flag"===(t=c)&&(t=""),c="");var f,z=zmPrev.prevDetails("zm_Container"),u=zmList.getListObj(s,"MO"),p=u.length;if("unread"===t&&z.msgId){var g=z.msgId,h=zmList.getMailObj(g);a=h&&(0===h.TH||h.TH&&zmInit.checkThreadRead(h.T))?p:p+1}else a=p+1;if(_zm.isOfflineSyncActive()){var I=zmUtil.getMailObj(_.last(u))||{};f=2===zmUtil.getMLConversionValue()?{lastConvId:I.T||I.M,lastRevTime:I.LR||I.R,fetchedEmailsCount:u.length}:{lastMsgRevTime:I.R,lastMsgSize:I.SZ,lastMsgId:I.M}}var v=zmfolAction.getSortProperties(s);i={f:a,t:n,fId:c,view:t,flag:m,label:r,attach:o,sendReq:!0,sortBy:v.sortBy,sortOrder:v.sortOrder,sortType:v.type},zmUtil.isSharedFolder(c)&&(i.shId=zmUtil.getShareId(c)),$(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){S.fillMails()}),b=!0,S.getMails({prms:i,ty:"n",exPrms:f})}else zmList.setEmptyListing()},500),getUnreadViewCount:function(){var e=[zmail.folId.sId,zmail.folId.spId,zmail.folId.oId,zmail.folId.tId,zmail.folId.dId,zmail.folId.teId];e=e.concat(zmfolAction.getChildrenOf(zmail.folId.tId));for(var t=$.extend({},zmail.folCount),i=e.length,a=0;a<i;a++)delete t[e[a]];var l=0;for(var n in t)l+=parseInt(t[n].c);return l},updateCountTitle:function(){zmWinTitle.updateTitle()},zmsubStr:function(e,t){return-1!==e.indexOf(t)&&(e=e.substring(t.length,e.length)),e},bindLeftActions:function(e){var t,i,a,l,n,s,r,m,o="",d="",c="";for(var f in"clbk"in e&&(m=e.clbk),a=(e=e.zmsData).type,i=(l=e.eventInfo).srcElement||l.target,n=e.rowInfo.layerId,t=e.rowInfo.type,r=e.prevSelectLayer,e.rowObject){o=e.rowObject.id||f;break}if("contextmenu"===a)zmList.FLUtility(l,i,n,t);else if("click"===a){if("zmlSSrchTreeH"===n)return void(_zm.isOfflineSyncActive()||"header"===t&&"zmlSSrchTreeH"===o||zmAppLoader.load("mailSearch").then(function(){zmSearch.processSavedSearch({id:o,mode:"get"})}));if("zmStreamTree"===n&&n!==o){var z,u=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree");if("disabledGrp"===o)zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0,view:"disabled"})});else if("createGrp"===o)if($(i).hasClass("closeImg")){var p=u.listObject[o];if(!_.isEmpty(p)){u.deleteNode(u.getRowObj(o));var g=zmText.get("commonUtils","streams.colloborate");u.listObject[o]={id:"createGrp",name:g,count:"",order:2,txtNodeClass:"SC_thm"};var h=zmList.getRowInfo(o,n);h[o].hideNode=!1,u.insertNodeAfter(h,u.listObject,zmail.zuid)}zmAdHocSettings.setStreamsGroupImg("1")}else zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({app:"streams",isOnboard:!0,createCallback:function(e){zmsuite.loadStreams(e)}})});else if("more"===o||"less"===o){var I=o,v="less"===o?"more":"less",b=u.listObject,T="more"===o?"showNode":"hideNode",C=u.el.children("#zmsTree").children();_.each(C,function(e,t){z=e.id,(b[z].hideNode&&"more"===o||"less"===o&&5<t&&"more"!==z&&"less"!==z)&&u[T](z,m)}),u.hideNode(I,m),u.showNode(v,m),"more"===v&&($("#"+zmail.zuid)[0].scrollIntoView(),m&&"function"==typeof m&&m())}else s=zmail.mailLeft.getNodes()[0].getLayer(n),$(i).find(".SC_ct.SC_new").removeClass("SC_new"),zmUtil.requireStreamsApp().then(function(){zmail.ContactBook.fetchProcess.then(function(){if(zmStreamsApp&&zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.GroupId&&zmStreamsApp.GroupApp.GroupId===o&&zmsuite.isWorkspaceAvailable("zmStreamsApp"))return zmsuite.showWorkSpace("zmStreamsApp"),void zmStreamsApp.util.removeCommentClass(o,s);zmSearch.updateSearchValues("zmStreamsApp"),zmStreamsApp.util.removeCommentClass(o,s),zmStreamsApp.init(o,!0)})})}else{if(zmshCut.currentLeftId=o,"header"!==t&&zmsuite.showExistingApp("zm_Container"),"zmStreamTree"===r&&n!==r&&!e.rowObject.id){zmStreamsApp.PostApp.unsubscribeEvents(),zmail.mailCenter=zmsuite.getCenter("zm_Container"),S.constructCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(e,t){zmList.bindAction(e,t)}),zmail.mailCenter[0].$el.removeClass("zms_streams SC_streams"),O(),S.setListingDetObj({}),zmSearch.updateSearchValues("m");var M=zmTab.getTabObject("zm_Container");M.searchPlaceHolder=zmText.get("search","searchInApp",{appname:"Mail"}),M.appIcon="msi-mail",zmTab.updateTabLst(M)}"zmlTreeH"===n&&"zmlTreeH"!==o&&(s=zmsuite.getLeft().getNodes()[0].getLayer(n)).removeHighlightFromParent(o,!0),o!==n&&("zmllabelH"===n?(d="label",c=o):"zmlviewH"===n&&(d=o.substring(3)),o===zmail.folId.sId&&zmUtil.updSendErrorStatus(!1,zmail.folId.sId),S.foldView({folId:o,view:d,viewId:c})),ZMail.topbar.header.renovate(),(zmUtil.isSharedFolder(o)||zmUtil.isFolderId(o)&&"-1"!==zmList.getRowInfo(o,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp(1).then(function(){})}}S.isLeftFocused=!0},getFolderTreeCount:function(){var e={accId:zmail.accId,mode:"foldertree"};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:S.updFolTreeCount,p:e})},updFolTreeCount:function(e){var t,i,a,l="zmlTreeH",n={},s="0",r=!1;zmail.folCount&&(s=zmail.folCount[zmail.folId.sId].c||"0",$("#"+zmail.folId.sId).find(".zmTreeCount").hasClass("zmRedClr")&&(r=!0));var m=e&&e.foltree;if(m){for(var o in n=zmail.mailLeft.getNodes()[0].getLayer(l),m[zmail.folId.sId].c=s,m[zmail.folId.dId].c="0",m)t=o,a=zmail.folCount[t].c,m[t]!==a&&t!==zmail.folId.teId&&t!==zmail.folId.dId&&n.updateCount(t,"upd",m[t].c,!1);zmail.outboxFail&&zmUtil.updSendErrorStatus(!0,zmail.folId.oId),"0"!==s&&r&&zmUtil.updSendErrorStatus(!0,zmail.folId.sId),i=S.getUnreadViewCount(),l="zmlviewH",(n=zmail.mailLeft.getNodes()[0].getLayer(l)).updateCount("zm_unread","upd",i),zmUtil.updateCountForAcc(zmail.accId,"upd",i),zmWinTitle.updateTitle(),"zm_unread"===zmail.mailLeft.selId&&zmail.mailLeft.selRow(zmail.mailLeft.selId,"zmlviewH"),ZMail.topbar.header.renovate()}},getAccountInfo:function(){zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:S.updateAccountUnreadCount,p:{mode:"getAccInfo"}})},updateAccountUnreadCount:function(e){if(e instanceof Object){var t=e.aInfo;for(var i in t)zmUtil.updateCountForAcc(t[i].accId,"upd",t[i].c)}},getMailRowIcons:function(e){return e&&zmUtil.isSharedFolder(e)||_zm.isOfflineSyncActive()?[]:["msi-trash"]},emptyRow:c,reInitListing:O,listingBand:i,getThreadSubject:function(e){var t=zmList.getMailObj(e),i=t.SB||"",a=i.trim();return 0!==a.indexOf("Re:")&&0!==a.indexOf("Fwd:")||(i=t.TSB||i),i},isLeftFocused:!1,translateSystemFolders:function(){var e,t=zmail.folId,i=zmail.folTree[0];for(var a in t)i[e=t[a]].FN=h.systemFolder[i[e].FN]},excludedFolders:function(e,t){var i=zmail.folId,a=i.dId,l=i.teId,n=i.spId,s=i.tId,r=i.oId,m=i.sId,o=[];switch(e){case"headerBand":o=[a,l];break;case"accUnreadCount":o=[a,l,m,n,r,s];break;case"attListing":o=[a,l,r];break;case"archive":case"views":o=[a,l,n,s,r];break;case"unreadCount":o=[a,l,m]}return t?o.includes(t):o},updateIDB:function(e){if(zmail.accId===zmail.defAccId&&_zm.isOfflineLockAvailable())return ZMail.IDB.syncer.update(e)}})}(),window.zmList=function(){var l,P,p=zmCenterListing.mailObjectAPI,C=zmText.get("mail"),c=C.leftTree,k=C.listing,j=C.preview,F=C.actions,z=ZMail.lConstants,N=z.cls,u=z.jsCls,r=["zmLTMenu_Nf","zmLTMenu_lne1","zmLTMenu_Fr","zmLTMenu_lne2","zmLTMenu_Sf","zmLTMenu_lne3","zmLTMenu_Rf","zmLTMenu_Df","zmLTMenu_lne4","zmLTMenu_Af","zmLTMenu_Ef","zmLTMenu_Rt"],g=0,h=function(e){var t,i,a,l;(t=e.mainElem.find("."+N.thdChild+":visible")).length&&(i=t,a=e,l=$.e(a.listElem).scrollTop()-i.height(),$.e(a.listElem).scrollTop(l),t.prev().removeClass(N.thdTreeLine),t.prev().find("i.msi-tarrow").addClass("msi-barrow"),t.hide())},I=function(e){var t,i="";(t=e.mainElem.find("."+N.thdChild+":visible")).children("div."+N.sel).length?((i=t.prev().attr("id")).indexOf("t")||(i=i.substring(1)),zmList.setMailSelection(i,"lt",$.e(e.listElem))):t.prev().hasClass(N.sel)&&(i=zmUtil.getSelectedMails()[0][0])&&zmList.setMailSelection(i,"th",$.e(e.listElem))},v=function(e){e.rowElem.addClass(N.thdTreeLine),e.rowElem.hasClass(N.chkBox)&&e.rowElem.next().children("div").addClass(N.chkBox)},f=function(f,z,u){zmAppLoader.load("mailPostLoad").then(function(){var e,t,i=document.createDocumentFragment(),a=z.mId,l=f.MO,n=!0,s=f.hasNext,r=z.isNxtListLoad;if(!(e=u.rowElem.next()).hasClass(N.thdChild)||r){for(var m=p.getViewObject(a)||p.getViewParentOf(l[0]),o=m&&m.isSelected,d=0;d<l.length;d++)i.appendChild(zmList.constructThreadChildRow(l[d],o)[0]);if(r||(h(u),e=$.e(zdom("div",{className:N.thdChild,id:"thd"+a}))),e.appendDOM(i),s){var c=ZMail.lView.constTemplate("convLoadMore");e.appendDOM(c),c.addEventListener("click",function(e){if(_zm.hasClass(c,"jsDisabled"))_zm.stopEvents(e);else{var t=$.Deferred();zmList.showHideThread({elemObj:u,rowId:z.mId,isNxtListLoad:!0,onEnd:t});var i=zmComponent.loadingBand({container:c.querySelector(".jsContent"),type:"pagination"});t.done(function(){i(),c.remove()}),_zm.addClass(c.querySelector(".jsLoadMore"),"zmDisabled"),_zm.addClass(c,"jsDisabled"),_zm.stopEvents(e)}})}r||($.e(e).insertDOMAfter(u.rowElem).hide().slideDown(400),v(u))}else u.rowElem.hasClass(N.thdTreeLine)?(e.slideUp(400,function(){u.rowElem.removeClass(N.thdTreeLine)}),n=!1):(h(u),e.slideDown(400),v(u));t=n?{mId:z.mId}:{mId:""},zmRestore.saveState("expandThd",t,{mId:z.mId}),I(u),z.eTDefObj&&z.eTDefObj.resolve()})},R=function(e,t){var i,a=t.mId,l=[],n=[],s=0,r=zmList.getMailObj(a).T;e.tdata&&(e=e.tdata);var m=(i=t.elemObj).viewDetails||zmInit.getListingDetObj(),o=zmUtil.getListMap(r);if("tIcon"===t.from){if(1<(n="search"===m.view||"zmncenter"===m.view?o?o.MO:[]:zmList.getViewBasedMsgList(r,m,!1,t.index)).length)f({MO:n,hasNext:o.showNextPage},t,i);else if("unread"===m.view){var d=$.extend({},m);d.view="all",n=zmList.getViewBasedMsgList(r,d,!1),f({MO:n},t,i)}}else if("showMail"===t.from){(function(e,t,i){var a,l,n,s,r,m=t.mId,o=e.MO,d=o.length,c=zmUtil.getMLConversionValue(),f="",z={},u=!1;"zm_Container"===zmTab.currentTab?z=zmInit.getListingDetObj():-1!==zmTab.currentTab.indexOf("zm_tab")?z=zmsuite.getCenterOuter().$el.data("data-detail"):-1!==zmTab.currentTab.indexOf("zm_srch")&&(z=zmSearchUtil.getSearchViewDetails()),0===t.opentype||4===t.opentype?f="search"===z.view?"S":"P":2===t.opentype?f="T":3===t.opentype&&(f="N"),t.streamsMail||0===c&&(0!==c||"conversation"!==t.src)||(u=!0);for(var p=zdom("fragment",null),g=0;g<d;g++)if(l=f+(n=zmList.getMailObj(o[g])).M,n.SM=n.SM||"",n.M&&n.M!==m){if(n.FD===zmail.folId.spId&&z.fId!==zmail.folId.spId||n.FD===zmail.folId.tId&&z.fId!==zmail.folId.tId)continue;s=n.FD!==z.fId&&zmail.folCount[z.fId]&&3!==t.opentype?" SC_Tfdr":"",r=zmPrev.getHeader({msgId:n.M,thd:!0,opentype:t.opentype,frm:n.F,sender:n.SN,hasAtt:n.AT,sm:n.SM,label:n.TAG,flag:n.NFG,date:n.DT,elemId:l,hdrId:i.hdrId,elemObj:i,showIndex:u}),p.appendChild(zdom("div",{className:"SC_pct"+s},$.dangerouslyParseHTML(r)))}0===t.opentype||4===t.opentype?((a=i.contElem).appendDOM(p),$.e(i.prevElem).addClass("tmail")):2===t.opentype?((a=i.contElem).appendDOM(p),zmsuite.getCenter()[1].$el.addClass("tmail")):3===t.opentype&&(a=i.contElem,_zm.addClass(a.parentElement,"tmail"),$.e(a).appendDOM(p))})({MO:l=o?o.MO:[]},t,i),"0"!==t.opentype&&"4"!==t.opentype||zmsuite.getCenter()[1].$el.find(".SC_pct").removeClass("SC_Tfcs");for(var c=0;c<l.length;c++)if(t.mId===l[c]){s=c;break}0<s&&($.e(i.prevElem).find("#zmHdrP"+a).parent().insertDOMAfter($.e(i.prevElem).find("#zmHdrP"+l[s-1]).parent()),$.e(i.prevElem).find("#zmHdrT"+a).parent().insertDOMAfter($.e(i.prevElem).find("#zmHdrT"+l[s-1]).parent()),$.e(i.prevElem).find("#zmHdrS"+a).parent().insertDOMAfter($.e(i.prevElem).find("#zmHdrS"+l[s-1]).parent()),$.q("#zmHdrN"+a).parent().insertDOMAfter($.q("#zmHdrN"+l[s-1]).parent()))}},H=function(e,t,i){var a=zmUtil.getMailObj(e);return a||(zmUtil.addMailData({M:e,FD:i||"",T:"",TAG:"",NFG:"",SM:"",SB:"",TH:0},e),a=zmUtil.getMailObj(e)),t&&(a.TH=1,a.T=t),a},B=function(e,t,i){H(e,i);var a=zmList.getMailObj(e);a.F=a.F||t.FROM,a.TO=a.TO||t.TO,a.SN=a.SN||t.SENDER,a.R=a.R||t.RDT,a.SB=a.SB||t.SUBJECT,a.AT=a.AT||(t.NEWATT?1:0),a.MA=a.MA||t.MA},V=function(e,t,i,a){t=t||{};var l=e.msgId&&zmList.getMailObj(e.msgId)||{};if("tIcon"!==t.from&&"prefetch"!==t.from&&"bulk"!==e.mode){var n=e.entityId||l.T||e.msgId;n&&(e.entityId=n),e.groupId=e.groupId||zmail.zuid,e.entityType=1}(e.shId||e.shareId)&&(t.avoidCache=!0),e.msgId&&zmContentCache.isCached(e.msgId)&&e.hasdraft&&(t.forceFetch=!0),l.OFFLINE&&(t.isOfflineEmail=!0);var s={u:zmail.conPath+"/md.do",t:"POST",fn:i,p:e,ep:t,setSessionId:t.setSessionId};"function"==typeof a&&(s.efn=a),"tIcon"===t.from?ZMail.listing.collection.fetchThdList(s):zmContentCache.fetch(s)},b=function(e){var t,i={};return e=e||zmTab.currentTab,(t=zmsuite.getCenter(e))[1]&&(i.prevElem=t[1].$el[0]),t[0].getNodes()[2]&&(i.listElem=t[0].getNodes()[2].$el[0]),i.mainElem=t[0].$el,i.hdrId="zmHdr",i.viewDetails=$.extend({},zmsuite.getCenterOuter(e).$el.data("data-detail")),e.indexOf("zm_srch")?e.indexOf("zmStreamsApp")?e.indexOf("zmncenter")?e.indexOf("zm_tab")?i.viewDetails=$.extend({},zmInit.getListingDetObj()):i.viewDetails=$.extend({},zmsuite.getCenterOuter(e).$el.data("data-detail")):i.viewDetails={view:"zmncenter"}:i.viewDetails={view:"stream"}:(i.id=1,i.viewDetails=$.extend({},zmSearchUtil.getSearchViewDetails())),i},G=function(e){var t,i,a,l,n,s,r,m,o,d={},c=!1,f=!1,z=zmUtil.getMLConversionValue();if(r=e.tabId||zmTab.currentTab,!(n=e.msgId))return d;(n.indexOf("t")||(n=n.substring(1)),m=zmList.getMailObj(n),r.indexOf("zm_srch")||(c=!0),zmUtil.getFolId()===zmail.folId.sId&&(f=!0),c)?(s=r.substring(7),a=zmSearchUtil.getSearchViewDetails(),t="lt"===e.type?zmSearchUtil.getSearchList():zmList.getViewBasedMsgList(m.T,a,!1)):(a=zmInit.getListingDetObj(),l=e.opentype,i=zmUtil.getFolId(),"lt"===e.type||2===l&&0!==z?(o=zmList.getListObj(i))&&(t=o.MO):zmList.getListObj(m.T)&&(t=zmList.getViewBasedMsgList(m.T,a,!1)));return 0===l||4===l?d=b("zmStreamsApp"===r?"zmStreamsApp":"zm_Container"):(d=b(r)).listElem||(d.listElem=c?zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el:zmail.mailCenter.listElem),d.listArr=t,d.id=s,d.msgId=n,d.isParent=m.TH&&"lt"===e.type&&0!==z,"lt"===e.type&&m.TH&&0!==z?d.rowElem=c||f?$.e(d.listElem).find("#"+n):$.e(zmail.mailCenter.listElem).find("#t"+n):d.rowElem=c||f?$.e(d.listElem).find("#"+n):$.e(zmail.mailCenter.listElem).find("#"+n),c&&(zmSearchUtil.isNewSearch()?d.collection={}:d.collection=zmail.searchObj[1].collection),2===e.opentype?(d.contElem=zmsuite.getCenter("zm_Container")[1].getNodes()[1].$el.children().eq(0),d.hdrElem=zmsuite.getCenter("zm_Container")[1].getNodes()[0].$el):(d.contElem=zmsuite.getCenter()[1].getNodes()[1].$el.children().eq(0),d.hdrElem=zmsuite.getCenter()[1].getNodes()[0].$el),d.type=e.type,d},Z=function(e,t,i,a,l){var n=zmUtil.getMailObj(e);if(!zmInit.excludedFolders("attListing",n.FD)){var s,r,m,o={attData:{},addInfo:{}},d=zmail.attachmentContainer;for(s in i)r=i[s].e,o.attData[r]||(o.attData[r]={},o.attData[r].attData=[],o.attData[r].addInfo={}),o.attData[r].attData.push(i[s]);o.addInfo.shownext=a,o.addInfo.isFull=!0,"tc"===l&&(o.addInfo.isFull=!1),(m=d.getObject(t))?"tc"===l?m.data.attData[e]=o.attData[e]:"t"===l&&(m.data=o):d.addObject({id:t,data:o})}},W=function(e,t,i){var a=!1,l=zmail.attachmentContainer;switch(i){case"sm":(l.getObject(t)||zmail.mailAttachments[e])&&(a=!0);break;case"tc":(l.getObject(t)||zmail.mailAttachments[t])&&zmail.mailAttachments[t].data.attData[e]&&(a=!0);break;case"t":(l.getObject(t)||zmail.mailAttachments[t])&&zmail.mailAttachments[t].data.addInfo.isFull&&(a=!0)}return a},T=function(e,t,i){var a=[];switch(i){case"sm":zmail.mailAttachments[e]&&(a=zmail.mailAttachments[e].data.attData[e].attData);break;case"tc":zmail.mailAttachments[t]&&zmail.mailAttachments[t].data.attData[e]&&(a=zmail.mailAttachments[t].data.attData[e].attData);break;case"t":if(zmail.mailAttachments[t]){var l,n,s,r=zmail.mailAttachments[t].data.attData,m=Object.getOwnPropertyNames(r);for(l=0;l<m.length;l++)for(n in s=r[m[l]].attData)a.push(s[n])}break;default:a=[]}return a},q=function(e){var t,i,a=e.mId||e.mailID,l=zmList.getMailObj(a),n=l.T?l.CMT:l.CT;"opening"===e.state?(t="/mail/openingincontainer",i={mailID:String(a),useConversation:Boolean(l.T),conversationID:l.T?String(l.T):"",openedBy:e.openedBy,openedTab:e.openedTab,folderID:l.FD,commentValue:n}):"opened"===e.state&&(t="/mail/openedincontainer",i={mailID:String(a),containerDOM:e.elem,useConversation:Boolean(l.T),commentValue:n,conversationID:l.T?String(l.T):"",openedBy:e.openedBy,folderID:l.FD,openedTab:e.openedTab}),$.publish(t,i)},Y=function(i,a){var l;if(!i.MSGID||"bulk"!==a.mode&&"oldest"!==a.getUnread&&"latest"!==a.getUnread||a.msgId===i.MSGID||((l=zmList.getMailObj(a.msgId)||{}).TH?B(i.MSGID,i,l.T):B(i.MSGID,i),a.msgId=i.MSGID),i.mdata&&a.streamsMail?zmContentCache.processResponse(i,"",a):zmContentCache.populateMailData(i,a),i.mdata&&i.mdata.MSGID&&1===Object.keys(i.mdata).length)a.prevDefObj&&a.prevDefObj.resolve();else{var t,e,n,s,r,m,o,d,c,f;if(zmUtil.debugLog("zmList.openMail()",i,a),t=a.msgId,l=zmList.getMailObj(t),"external"!==a.src&&"restore"!==a.src&&"zmncenter"!==a.src||!i.mdata||(B(t,i.mdata),l.AT&&(a.att=l.AT),i.tdata&&i.tdata.length&&!l.T&&(l.TH=1,l.T=i.tdata[0].T)),a.streamsShowMail=a.streamsShowMail||!1,a.isDraftMail=a.isDraftMail||!1,a.isDraftEditable=a.isDraftEditable||!1,e=l.T,s=a.opentype,n=a.elemObj,d=a.isSh||!1,f=a.isReminder||!1,d&&3!==s&&delete a.streams,e&&!a.streamsMail&&("zm_srch1"===zmTab.currentTab&&("conversation"===a.src||"conversation"===a.toOpen||"content"===a.type)||0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==zmTab.currentTab||0===zmUtil.getMLConversionValue()&&("conversation"===a.src||"conversation"===a.toOpen))&&(a.showIndex=!0),0===s||4===s?c=n&&"search"===n.viewDetails.view?(o="S"+t,"S"):(o="P"+t,"P"):2===s?(o="T"+t,c="T"):3===s&&(o="N"+t,c="N"),a.prefix=c,n&&"search"===n.viewDetails.view&&!n.listArr){var z=n.id;zmSearchUtil.isNewSearch()?(n.searchStr=zmSearchUtil.getSearchString(),n.listArr=zmSearchUtil.getSearchList()):("srch"===zmail.searchObj[z].collection.type?(n.searchStr=zmail.searchObj[z].collection.searchContArr[0],n.searchType=2):(n.searchStr=zmail.searchObj[z].collection.advSearchStr,n.searchType=3),n.listArr=zmail.searchObj[z].collection.searchList),"lt"===a.type&&l.TH?n.rowElem=$.e(n.listElem).find("#t"+t):n.rowElem=$.e(n.listElem).find("#"+t)}if(i.tdata&&(a.sm=l.SM||"",a.streamsMail)){var u,p,g,h=i.tdata,I=h.length;for(u=0;u<I;u++)(p=h[u].M)&&((g=zmList.getMailObj(p)).accId=a.accId,g.actionType=a.actionType,g.entityType=a.entityType,g.groupId=a.groupId,g.S=1,g.streams=!0,g.isFav=a.isFav,g.TAG=a.TAG,a.newStreams&&(g.newStreams=!0))}if(a.vfc){var v=zmContentCache.isCached(t)&&zmContentCache.get(t).EXTIMG||{};a.imgStatus=v.link,zmPreviewTemplate.showFullContent(i,a)}else if("content"===a.type)"bulk_mail"!==a.load_action&&$.e(n.prevElem).find(".SC_pct").removeClass("SC_Tfcs"),zmPrev.setMailDOMContent(i.mdata,a),2===s&&n&&("search"===n.viewDetails.view&&(n=zmList.getElemObj()),$.e(n.prevElem).attr({"data-mid":a.msgId,"data-ty":"th"})),3!==s&&zmPreviewTemplate.setPreviewHeaderHeight(n,a.tabId,s);else{if(0===s||4===s){if(a.cpvreq&&a.cpvreq!==P)return void(a.markread&&zmail.MailAction.Initializer.applyActions("unread","click",{msgId:[t],thd:[]}));!function(e,t,i){var a,l=t.msgId,n=t.type,s=t.prevId||l,r=zmList.getMailObj(l),m=t.tabId||zmTab.currentTab,o="",d=zmUtil.getMLConversionValue(),c=zmPreviewTemplate.getSubjectToPreview(r.SB);$.e(i.prevElem).removeClass("tmail smail"),i.rowElem&&zmList.doThreadPath(i.rowElem,"remove"),a=zmsuite.getCenter(m)[1].getNodes(),o="conversation"!==t.src&&r.TH&&(0===d&&"zm_Container"===zmTab.currentTab||"zm_srch1"===zmTab.currentTab)?["DIV",{attrs:{class:"SC_phd"},child:[["text",c],["I",{attrs:{class:"msi-thread","data-event":"viewfullthd","data-from":"header",title:j.contextmenu.viewthd}}]]}]:["DIV",{attrs:{class:"SC_phd"},child:[["text",c]]}];var f=$.extend(!0,{},zmInit.prevHeader);if(r.streams){if(t.showIcons){f.rIcons.splice(2,f.rIcons.length-3);var z=f.rIcons[0];z[0].tooltip=F.iconTooltip.prevEntity,z[1].tooltip=F.iconTooltip.nextEntity}else f.rIcons.splice(0,f.rIcons.length-1),f.rIcons[0][0].tooltip=j.common.close;t.titleTxt&&(o=["DIV",{child:[["SPAN",{attrs:{class:"SC_StrmMT"},child:[["text",t.titleTxt]]}],["DIV",{attrs:{class:"SC_phd"},child:[["text",c]]}]]}])}var u=_zm.isOfflineSyncActive();u&&f.rIcons.splice(1,1),!u&&zmUtil.isChatletEnabled()&&zmUtil.isZohoAccount(zmail.accId)&&f.rIcons.unshift([{tooltip:zmText.applyArgs(zmText.get("mailsuite").tooltips.chatlet,{entity:zmText.get("mailsuite").entity[1]}),html:ZMail.topbar.icons.chatletTemplate({count:r.CLC}),data:{action:"chatlet"}}]),zmInit.prevHeader.text=o,f.text=o,a[0].push(f),zmPrev.setMailDOMContent(e.mdata,t),"lt"===n&&"conversation"!==t.src&&0===d&&zmsuite.getCenter(m)[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),i.contElem=zmsuite.getCenter(m)[1].contentObj.$el,i.hdrElem=zmsuite.getCenter(m)[1].getNodes()[0].$el,$.e(i.prevElem).attr({"data-mid":s,"data-ty":t.type});var p=t.opentype,g={fromMail:!1,previewType:""};"zm_Container"!==m&&(m.indexOf("zm_srch")||t.newStreams)||(g.fromMail=!0,g.percent=zmAdHocSettings.getMailPreviewSize()),0!==p&&4!==p||(g.previewType=0===p?"vertical":"horizontal"),zmsuite.getCenter(m)[1].show(g),r.TH&&i.viewDetails.fId!==zmail.folId.tId&&(0!==d&&"search"!==i.viewDetails.view&&i.viewDetails.fId!==zmail.folId.sId||r.streams||"conversation"===t.src)?(R("",{mId:l,from:"showMail",opentype:t.opentype,elemObj:i}),$.e(i.prevElem).addClass("tmail"),"th"===n&&i.viewDetails.fId!==zmail.folId.spId&&i.viewDetails.fId!==zmail.folId.tId&&zmList.doThreadPath(i.rowElem,"add")):$.e(i.prevElem).addClass("smail"),zmPreviewTemplate.setPreviewHeaderHeight(i,m,t.opentype),$.e(i.prevElem).hasClass("tmail")?i.contElem.css({bottom:"0px"}):i.contElem.css({bottom:$.e(i.prevElem).find(".zmQRB").height()+"px"}),zmUtil.setScrollShadow(i.contElem),"conversation"===t.src?($.e(i.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"),ZMail.topbar.icons.renovate({type:"functional",view:zmInit.getListingDetObj(),tabId:t.tabId})):t.streamsShowMail||(ZMail.topbar.icons.renovate({type:"functional",msgId:l,view:zmInit.getListingDetObj(),tabId:t.tabId}),zmList.unchkAll(i),zmPrev.PvNt(t.rowId,t.type,t.opentype,zmTab.currentTab,i))}(i,a,n),a.streamsShowMail||"zm_srch1"===a.tabId||(zmUrlAct.update({from:"zmCenter",msgId:a.msgId,type:a.type,opentype:0}),zmRestore.saveState("preview",{p:a.msgId},{}))}else if(2===s){if("DUPLICATE"===function(e,t,i){var a,l,n=t.msgId,s=n,r=zmList.getMailObj(n),m=zmPreviewTemplate.getSubjectToPreview(r.SB),o="",d={},c=zmUtil.getMLConversionValue(),f=t.msgId,z=!r.accId||r.accId===zmail.accId;r.TH&&(0!==c&&i.viewDetails&&"search"!==i.viewDetails.view&&i.viewDetails.fId!==zmail.folId.sId||r.streams||"conversation"===t.src||"restore"===t.src&&"conversation"===t.toOpen)&&(l=r.T,n="t"+(s=l),f=l),a="zm_tab"+n;var u=function(e,t){t.id.split("#")[1]===f&&zmsuite.isWorkspaceAvailable(a)&&zmsuite.closeWorkspace(a)};if($.subscribe("zmstreamsapp/deletePost",u),zmsuite.isWorkspaceAvailable(a)&&"restore"!==t.src&&!t.streamsMail)return zmsuite.showWorkSpace(a),"DUPLICATE";t.tabId=a,t.from&&zmsuite.isWorkspaceAvailable("zm_tab"+t.from)&&"restore"!==t.src&&zmsuite.closeWorkspace("zm_tab"+t.from);var p=t.actionType;t.streamsMail&&(p=zmCont.isGroup(t.groupId)?"viewGroupEntity":"viewSelfData");var g,h=(g=zmsuite.createAppRouter(),t.streamsMail?(g._hashKey="stream",g.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),g.setParams(["tab",t.groupId,s,t.entityType,p])):(g._hashKey="mail",g.initialize({hashKey:"mail",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),g.setParams(["tab",n])),g),I={appname:_zm.unescapeTags(m),title:e.mdata.SENDER,appId:a,faqKey:"Conversations",data:{CNodes:"2"},router:h,appIcon:"msi-mailopen",shortcuts:zmshCut.mail,titleProvider:function(){return zmUtil.replaceHTMLEntities(m)}},v={appId:a,msgId:t.msgId,opentype:2,type:t.type};I.onClose=function(){$.when(zmPrev.cmpClose(a)).then(function(e){if(e){var t=zmPrev.prevDetails(a).msgId;zmContentCache.remove(t),zmsuite.closeWorkspace(a)}});var e=zmsuite.getCenter(a)[1].$el;$.publish("/mail/tabClosed",{container:e})},("restore"===t.src||t.streamsMail)&&zmsuite.isWorkspaceAvailable(a)?zmsuite.resetWorkspace(a,I):zmsuite.setWorkSpace(I),i=i||zmList.getListingElemObj(t);var b=zmsuite.getCenter(),T=b[0].getNodes(),C=b[1].getNodes();T[1].$el.remove(),zmsuite.renderCenter(),o="conversation"!==t.src&&r.TH&&(0===c||i.viewDetails&&i.viewDetails.folId===zmail.folId.sId||i.viewDetails&&"search"===i.viewDetails.view)?["DIV",{attrs:{class:"SC_phd"},child:[["text",m],["I",{attrs:{class:"msi-thread","data-event":"msi-thread","data-action":"viewfullthd","data-from":"header",title:j.contextmenu.viewthd}}]]}]:t.titleTxt?["DIV",{child:[["SPAN",{attrs:{class:"SC_StrmMT"},child:[["text",t.titleTxt]]}],["DIV",{attrs:{class:"SC_phd"},child:[["text",m]]}]]}]:["DIV",{attrs:{class:"SC_phd"},child:[["text",m]]}];var M=[];if(!z||t.streamsMail||t.isMenuallyCreatedMeta||(M=ZMail.topbar.icons.model.get("functional"),!zmail.isPopupMail&&zmUtil.isChatletEnabled()&&M.unshift(ZMail.topbar.icons.chatletMenuConfig({count:r.CLC}))),(d={id:"zmPrevHeader",rIcons:M,isNewIcons:!0}).text=o,C[0].push(d),C[0].setListener("click",function(e,t){switch(e){case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"msi-close":zmList.bindAction({action:"clsPrev"}),$.unsubscribe("zmstreamsapp/deletePost",u);break;case"msi-thread":zmList.bindAction($.e(t).data(),t)}}),zmsuite.getCenterOuter().$el.data("row-detail",t),i.viewDetails&&"search"===i.viewDetails.view)zmsuite.isWorkspaceAvailable("zm_srch1")&&zmsuite.getCenterOuter().$el.data("data-maillist",zmSearchUtil.getSearchList().slice()),zmsuite.getCenterOuter().$el.data("data-detail",i.viewDetails);else if(i.viewDetails&&"stream"===i.viewDetails.view)zmsuite.getCenterOuter().$el.data("data-maillist",[t.msgId]),zmsuite.getCenterOuter().$el.data("data-detail",i.viewDetails);else{var S=zmInit.getListingDetObj(),w=zmUtil.getFolId(S),L=zmUtil.getListMap(w);L=L&&L.MO.slice()||[],zmsuite.getCenterOuter().$el.data("data-detail",S),zmsuite.getCenterOuter().$el.data("data-maillist",L)}zmPrev.setMailDOMContent(e.mdata,t),i.mainElem=b[0].$el,i.contElem=b[1].contentObj.$el,i.hdrElem=C[0].$el,i.prevElem=b[1].$el,b[1].show(),t.isReminder||r.TH&&r.FD!==zmail.folId.tId&&(0!==c&&i.viewDetails&&"search"!==i.viewDetails.view&&i.viewDetails.fId!==zmail.folId.sId||r.streams||"conversation"===t.src||"restore"===t.src&&"conversation"===t.toOpen)?(v.tId=r.T,R("",{mId:t.msgId,from:"showMail",opentype:t.opentype,elemObj:i}),$.e(i.prevElem).addClass("tmail")):$.e(i.prevElem).addClass("smail"),zmsuite.showWorkSpace(a),b[1].$el.addClass("SC_w100"),!z||t.streamsMail||t.isMenuallyCreatedMeta||ZMail.topbar.icons.renovate({type:"functional",msgId:e.mdata&&(e.mdata.MSGID||e.mdata.M)||void 0,view:i.viewDetails,elem:C[0],tabId:a});var O=zmsuite.getCenter()[1].getNodes()[0].$el[0].clientHeight;i.contElem.css({top:O+"px"}),$.e(i.prevElem).hasClass("tmail")?i.contElem.css({bottom:"0px"}):(b[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),i.contElem.css({bottom:$.e(i.prevElem).find(".zmQRB").height()+"px"})),$.e(i.prevElem).attr({"data-mid":t.msgId,"data-ty":t.type}),zmUtil.setScrollShadow(i.contElem),t.src&&("conversation"===t.src||"external"===t.src||"restore"===t.src)||r.streams?$.e(i.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"):t.streamsShowMail||zmPrev.PvNt(t.rowId,t.type,t.opentype,a,i),v.fId=r.FD,v.viewDetails=i.viewDetails,v.toOpen=t.toOpen||"conversation"===t.src?"conversation":void 0;var A={actionType:"viewGroupEntity",etype:t.entityType,gid:t.groupId};if(A.pid=v.tId?v.tId:t.msgId,t.streamsMail){var y={appname:m,appIcon:"msi-mailopen"};$.publish("zmail/SaveTabState",[{appId:a,app:"stream",appObj:y,category:"stream_mail",data:A}])}else $.publish("zmail/SaveTabState",[{appId:a,app:"m",appObj:{appname:m,appIcon:"msi-mailopen"},category:"mail_tab",data:v}]),zmRestore.saveState("tab",{key:"tab",data:{app:"m",category:"mail_tab",data:v}},{action:"open"})}(i,a,n))return}else 3===s&&("zmncenter"===a.src&&(zmList.getNotifyPopupContainer(i.mdata,n.prevElem,d,f,n),a.parentElm=n.contElem,-1===n.prevElem.className.indexOf("SC_Twpr")&&(n.contElem[0].style.maxHeight=document.body.getBoundingClientRect().height-zmUtil.wmsBarHeight()-320+"px"),i.mdata.shareId=a.shId||a.shareId),function(e,t,i){zmPrev.setMailDOMContent(e.mdata,t);var a=zmList.getMailObj(t.msgId),l=e.tdata&&e.tdata.length?"t"+a.T:a.M,n=i.contElem[0].parentElement,s=a.TH?a.T:"";if(_zm.setAttr(n,{msgId:l,groupId:t.shOwner||t.groupId,thId:s,pid:a.M,actionType:t.streamAction}),e.tdata&&e.tdata.length||zmList.getMailObj(l).T&&zmUtil.getListMap(s)){var r=e.tdata||zmUtil.getListMap(s,"MO");R(r,{mId:t.msgId,from:"showMail",opentype:3,elemObj:i})}}(i,a,n));if(a.streamsMail&&3!==s&&!i.mdata.newStreams&&!d){var b=e||t;b=zmList.getMailObj(b).groupId+"#"+b,zmUtil.requireStreamsApp().then(function(){zmStreamsApp.PostActions.getSharedMail(b,$.e(n.contElem)[0])}).fail(function(){zmUtil.debugLog("Could not load comments !","zmList.openMail()",arguments)})}if(n.contElem){var T=$.extend({},a);$.e(n.contElem).data("msg_params",T)}}if(a.streamsShowMail||zmPreviewTemplate.addDraftsToView(l.T,$.e(n.prevElem),c),i.mdata&&i.mdata.READSTATUS&&a.reqSent)"success"===i.mdata.READSTATUS&&zmail.MailAction.Initializer.rapplyActions({result:"success"},{mailId:[t],thd:[],action:"read"});else if(0===l.S&&l.FD!==zmail.folId.oId&&"stream"!==n.viewDetails.view&&!zmUtil.isSharedFolder(l.FD,"R")||a.markread){var C={};C.msgId=[t],C.thd=[],zmail.MailAction.Initializer.applyActions("read","click",C)}if(n?(r=$.e(n.prevElem),3===s&&(r.closest(".SCS_popUp").length?r=r.closest(".SCS_popUp"):r.closest("#postpopUp").length&&(r=r.closest("#postpopUp"))),m="th"===a.type||"content"===a.type?$.q("#zmCon"+o):$.e(n.prevElem)):r=m=$.e(a.parentElm),l.FD===zmail.folId.oId&&$.e(n.prevElem).find("i.msi-popout").closest("b").addClass("SC_opy3"),zmContentCache.isCached(t)&&zmContentCache.get(t).CALOBJ&&zmModules.mail.initEventMarkupModule().then(function(e){(0,e.construct)(t,r,{prefix:a.prefix})}),!a.vfc){if(!l.newStreams&&!a.shId){var M=i.mdata.SPAMDATA;M&&ZMail.previewUtil.loadSpamAlert({msgId:t,spamInfo:M,folId:l.FD,sender:i.mdata.FROM,headerElm:r.find("#zmHdr"+a.prefix+t)[0],targetElem:r.find("#zmCon"+a.prefix+t)[0]})}(i.mdata.hasOwnProperty("MAIL_LANGUAGE")||i.mdata.hasOwnProperty("ML"))&&ZMail.previewUtil.loadTranslator({msgId:t,contentAttrs:i.mdata,contentElem:r.find("#zmCon"+a.prefix+t),headerElm:r.find(".SC_phd")}),l.SCOBJ&&l.FD!==zmail.folId.spId&&l.FD!==zmail.folId.sId&&zmAppLoader.load("markup").then(function(){zmMarkup.load({msgId:t,schemaObj:l.SCOBJ[0],selector:r,prefix:a.prefix})})}if(zmPreviewTemplate.showImageDisplayElem(t,r,{isvfc:a.vfc,imgStatus:a.imgStatus}),l.FD!==zmail.folId.spId&&zmPreviewTemplate.showUnsubscribe(t,r),"content"!==a.type&&(a.vfc||zmPreviewTemplate.showProfilePhoto({msgId:a.msgId,type:"lt"},r),e&&1===zmUtil.getListMap(e,"showNextPage")&&(0!==zmUtil.getMLConversionValue()&&"search"!==n.viewDetails.view||"conversation"===a.src||"conversation"===a.toOpen||a.streamsMail)&&zmPreviewTemplate.addShowMoreMailsLink(n,s)),zmPreviewTemplate.bindPreviewEvents(r,s),zmPreviewTemplate.applyHeaderState(r.find("#zmHdr"+o)),"bulk_mail"===a.load_action||a.noScroll||a.vfc||zmUtil.setPreviewScroll($.q("#zmHdr"+o).closest(".SC_pct"),n.contElem),l.TH&&"lt"===a.type&&!a.streamsShowMail&&"1"===zmAdHocSettings.getMarkConversationRead()&&(_zm.isOfflineSyncActive()||zmInit.checkThreadRead(e)||zmList.loadUnreadMails(e,s,n.viewDetails)),a.showIndex&&$.q('[id="zmHdr'+o+'"]').each(function(e,t){setTimeout(function(){$.e(t).find("#zm_readtitle").fadeOut()},5e3)}),i.mdata.NEWATT){var S,w,L,O,A,y,D=i.mdata.NEWATT,E=D.length,U=0;for(y=l.TH?(A=l.T,"tc"):(A=t,"sm"),W(t,A,y)||Z(t,A,D,void 0,y),(O=l.FD)&&zmUtil.isSharedFolder(O)&&(S=zmUtil.getShareId(O)),l.streams&&(L=l.groupId,w="viewGroupEntity"),U=0;U<E;U++)S&&(D[U].shId=S),L&&(D[U].gId=L,D[U].type=w);zmPreviewTemplate.setSlideShow(D,m[0])}if(!a.vfc&&!_zm.isOfflineSyncActive()){if(i.comment&&d){i.comment.comments||(i.comment={comments:{},order:[]}),i.comment.shOwner=a.shOwner;var x=e||t;zmUtil.requireStreamsApp().then(function(){var e=i.sharedUsers||[],t={comment:i.comment,shId:a.shId||a.shareId,sharedUsers:e,commentuuid:a.commentuuid,sharedToMe:zmUtil.isSharedFolder(l.FD)};3===s&&(t.fixedComment=!0),zmStreamsApp.PostActions.getSharedMail(x,n.contElem[0],t,!0)}).fail(function(){zmUtil.debugLog("Could not load comments for shared folder mail !","zmList.openMail()",arguments)})}else a.streamsMail||d||"content"!==a.type&&!0!==a.vfc&&($.e(n.contElem).siblings(".zms_fixed").remove(),zmUtil.requireMailCollab().then(function(){q({state:"opened",mId:t,elem:$.e(n.contElem)[0],openedBy:s,openedTab:zmTab.currentTab})}));zmUtil.publishMPreviewEvent(t),zmPreviewTemplate.processReadReceipt(t)}a.prevDefObj&&a.prevDefObj.resolve(t)}},M=function(e,t){var i,a=t.msgId||[],l=a.length;for(i=0;i<l;i++){var n=a[i];if(zmContentCache.isCached(n)){var s={msgId:n,type:"content",reqSent:!0,load_action:"bulk_mail"};s.elemObj=b(),s.opentype=t.opentype,s.markread=t.markread;var r=$(s.elemObj.prevElem).find(".zmPHdr[data-mid='"+n+"']"),m=r.attr("id");if(m){m=m.substring(5),s.from=$(s.elemObj.prevElem).find(".zmPHdr[data-mid='"+n+"']");var o=$.e(zdom("div",{id:"zmCon"+m}));r.after(o),Y({},s)}}}zmInit.checkThreadRead(t.thdId)||zmList.loadUnreadMails(t.thdId,t.opentype,t.viewDet)},J=function(e,t){var i,a,l,n=e,s=zmList.getMailObj(e)||{};for(i=s.T,l=(a=zmList.getViewBasedMsgList(i,t,!0)).length-1;0<=l;l--)if(0===(s=zmList.getMailObj(a[l])||{}).S&&0===s.AR){n=a[l];break}return n},K=function(e,t){if(_zm.isOfflineSyncActive())return!1;if(e){var i=zmUtil.getFolId(),a=zmList.getListObj(i),l=(a=a?a.MO:[]).length;if(0<l){var n,s,r,m,o,d=2,c=0,f=!1,z=!1,u=!1,p=!1,g=0,h=a.indexOf(e),I=[];if(-1!==h){for(0!==zmUtil.getMLConversionValue()&&"archive"!==zmInit.getListingDetObj().view&&"0"===zmAdHocSettings.getMarkConversationRead()&&(p=!0),n=h-1,r=s=0;0<=n&&s<d&&r<10;n--){if(m=a[n],(o=zmList.getMailObj(m))&&o.TH&&p&&0===o.TS&&zmList.getListObj(o.T)&&(m=J(m,zmInit.getListingDetObj())||a[n],o=zmList.getMailObj(m)),o&&0===o.S){if(f=!0,zmContentCache.isCached(m)){c++;break}I.push(m),s++}r++}for(d=4-I.length,n=h+1,r=s=0;n<l&&s<d&&r<10;n++){if(m=a[n],(o=zmList.getMailObj(m))&&o.TH&&p&&0===o.TS&&zmList.getListObj(o.T)&&(m=J(m,zmInit.getListingDetObj())||a[n],o=zmList.getMailObj(m)),o&&0===o.S){if(z=!0,zmContentCache.isCached(m)){g++;break}I.push(m),s++}r++}if((f&&0===c)|(z&&0===g)&&(u=!0),I.length&&u){if("mailIds"===t)return I;var v={from:"prefetch"},b={accId:zmail.accId,summary:!0};b.msgId=I[0],b.folId=zmList.getMailObj(I[0]).FD,I.splice(0,1),I.length&&(b.mailId=I.join(),v.setSessionId=!0),v=$.extend(v,b),V(b,v,"")}}}}},X=function(e,t){var i,a,l,n,s=e.actionSrc,r=e.from,m=e.msgId,o=e.accId,d=void 0===o?zmail.accId:o;if("header"===r){var c=$.e(t).closest(".SC_pv");zmInit.rclkId=c.attr("data-mid"),"zm_Container"===zmTab.currentTab&&"lt"===c.attr("data-ty")&&zmList.getMailObj(zmInit.rclkId).TH&&(zmInit.rclkId="t"+zmInit.rclkId)}else"list"===r&&(zmInit.rclkId=$.e(t).closest("."+N.mRow).attr("id"));if("external"===r||zmInit.rclkId.indexOf("t")){if(i=m||zmInit.rclkId,(n=zmList.getMailObj(i)).FD===zmail.folId.oId)return;l=zmail.conPath+"/popMail.do?accId="+d+"&msgId="+i+"&folId="+n.FD+"&att="+n.AT,n.TH&&(l+="&thId="+n.T+"&showConv=false")}else i=zmInit.rclkId.substring(1),a=(n=zmList.getMailObj(i)).T,l=zmail.conPath+"/popMail.do?accId="+d+"&msgId="+i+"&thId="+a+"&folId="+n.FD+"&att="+n.AT+"&showConv=true";if(zmUtil.isInlineCompose()&&(l+="&inlineCompose=true"),d===zmail.accId){var f,z=n.FD,u=!1;zmUtil.isSharedFolder(z)?(u=!0,l+="&rShareId="+zmUtil.getShareId(z)+"&isSh=true&groupId="+zmail.shrTree[0][z].OZUID):zmUtil.isFolderId(z)&&(u=!0,f=zmList.getRowInfo(z,"zmlTreeH","info").SH,zmUtil.isShrFolEnabled()&&"-1"!==f&&(l+="&isSh=true&groupId="+zmail.zuid+"&rShareId="+f)),u&&(l+="&entityId="+i+"&entityType=1"),zmTab.currentTab.indexOf("zm_srch")||(l+="&isSrch=true")}l+="&feature="+zmail.showFeature,s&&(l+="&actionSrc="+s),zmUtil.openWindow(l,60,80)};$.subscribe("/streams/comment",function(e,t){if("1"===t.etype)try{!function(e){var t=e.mailID,i=zmList.getMailObj(t);if(i){var a=i.T,l=[];l=a&&zmList.getListObj(a)?zmList.getListObj(a).MO:[t];var n,s,r=e.total;if(!isNaN(r)){var m={update:function(e,t){if(!parseInt(zmAdHocSettings.getCustomizeMailListing().commentcount)){var i=$.e(e).find("."+N.cmtCount);i.length&&i.appendDOM(zdom("fragment",null,t,zdom("i",{className:"msi-lcmnt"})),{clear:!0})}},remove:function(e){var t=$.e(e).find("."+N.cmtCount);t.length&&t.clearHTML()},getElem:function(){var t,i=[];return["zm_Container","zm_srch1"].forEach(function(e){(t=(t=p.getViewObject(s,e))&&t.$element)&&t.length&&i.push(t)}),i}};for(n in l)s=l[n],zmList.updateModel("CMT",r,s),m.getElem().forEach(function(e){0===r?m.remove(e):m.update(e,r)})}}}(t)}catch(e){zmUtil.debugLog(e)}});var S=function(e){var t,i="",a="";if("string"==typeof e)a=e,i=$("#"+e).attr("data-ty");else{var l=N.mRow;(t=$.e(e).closest("."+l)).length&&(i=t.attr("data-ty"),a=t[0].id||t.attr("data-detail"))}return{msgId:a,type:i,opentype:zmail.mailOpt.isPopup}},o=function(e,t){var i;"zm_Container"===e&&(i="mListing",zmList.selDetails[i]={},"select_flag"===t?zmList.selDetails[i].flag="-1":"select_label"===t?zmList.selDetails[i].label="-1":"select_attach"===t?zmList.selDetails[i].attach="1":"select_unread"===t&&(zmList.selDetails[i].view="unread"))},w=function(e){var t,i=e.action,a=!0,l={},n=zmTab.currentTab,s=!1;"zm_Container"===n?(l=zmInit.getListingDetObj(),zmList.selDetails.mListing={}):-1!==n.indexOf("zm_srch")?(l=zmSearchUtil.getSearchViewDetails(),zmList.selDetails.sListing={}):l=zmsuite.getCenterOuter().$el.data("data-detail");var r,m=!!((r=(r=l)||{}).view||r.flag||r.label||r.attach);switch(i){case"select_all":zmList.chkAll();break;case"select_none":a=!1;break;case"select_read":(t=p.filter(p.readfilter)).length?p.selectMails(t,!0):s=!0;break;case"select_unread":"unread"===l.view?zmList.chkAll():(t=p.filter(p.unreadfilter)).length?(p.selectMails(t,!0),m||(zmList.showBulkActionBand("selFilter"),o(n,i))):s=!0;break;case"select_flag":l.flag?zmList.chkAll():(t=p.filter(p.flaggedfilter)).length?(p.selectMails(t,!0),m||(zmList.showBulkActionBand("selFilter"),o(n,i))):s=!0;break;case"select_label":l.label?zmList.chkAll():(t=p.filter(p.taggedfilter)).length?(p.selectMails(t,!0),m||(zmList.showBulkActionBand("selFilter"),o(n,i))):s=!0;break;case"select_attach":l.attach?zmList.chkAll():(t=p.filter(p.attachmentfilter)).length?(p.selectMails(t,!0),m||(zmList.showBulkActionBand("selFilter"),o(n,i))):s=!0;break;default:a=!1}s&&_zm.succErrMsg("i",k.common.selectionWarnMsg),a&&"select_all"!==i&&function(){var e=zmsuite.getCenter()[0].getNodes()[2].$el[0];e.scrollTop=0;var t=$(e).children("."+N.chkBox+":first");t.length&&(e.scrollTop=t.offset().top-$(e).offset().top)}(),zmUtil.hideMenu()},L=function(){var e=zmUtil.getFolId(),t=zmInit.findFolName(e),i=zdom("span",null,zdom("b",{className:"SC_opa50"},k.headertitle.attViewerHeader),zdom("i",{className:"msi-rarrow"}),t),a={workspaceConfig:{appname:zmText.applyArgs(k.headertitle.attViewerTabName,{folName:t}),headerDOM:i,onClose:function(){l=null},workspaceKey:e},attachListingConfig:{requireParams:{accId:zmail.accId,mode:"lstEntity",thb:!0,fldId:e}}};l?l.getWorkspacekey()===e?zmsuite.showWorkSpace("attachList"):l.rerender(a):zmUtil.createAttachListingWorkspace(a,function(e){l=e})},O=function(e){var t,i="",a="",l=e.action,n=zmInit.getListingDetObj(),s=!0;switch(t=n.fId,l){case"view_all":i="all";break;case"view_unread":i="unread";break;case"view_flag":i="flag",a="-1";break;case"view_label":i="label",a="-1";break;case"view_attach":i="attach",a="1";break;case"view_archive":i="archive";break;case"listview":i=e.view,a=e.viewId;break;default:s=!1}s&&(("date"===n.sortBy&&n.sortOrder||"size"===n.sortBy)&&zmList.updateSortProperties(0),zmList.unchkAll(),zmInit.foldView({folId:t,view:i,viewId:a}),ZMail.topbar.header.renovate()),zmUtil.hideMenu()},A=function(e,t){e.src="conversation",e.opentype=zmail.mailOpt.isPopup,zmList.getMailData(e,t)},y=function(e,t,i,a){var l,n,s,r,m;if(l="th"===e.type?"c"+e.msgId:e.msgId.includes("t")?e.msgId.substr(1):e.msgId,p.setFocus("Mouse",l),n=s=e.msgId,r=zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails(),n.indexOf("t")||(s=n.substring(1)),0===e.opentype||4===e.opentype){var o=zmPrev.prevDetails(zmTab.currentTab);s===o.msgId&&e.type===o.type&&"content"!==e.type&&(zmPrev.clsPreview(),m=!0)}var d=zmList.getMailObj(s)||{};"unread"!==r.view||!i||s===i||d.TH&&d.T===zmList.getMailObj(i).T||zmList.remReadMail(),m||zmList.getMailData(e,t,a)},D=function(e,t,i,a,l,n){var s,r,m,o="t"===a?1:0;s=o?"downloadconv":"downloadall",r=o?"zm_threadAtt":"",m=zmAttach.build({appName:"ML_popup",attList:t,zipType:s,showMOpt:!0,showTag:!0,supportDrag:!0,attClass:"zmAch",attListClass:"zmPAtt "+r,fileNameLen:20,entityInfo:{id:n,isThd:o,et:1}}),m=$.e(zdom("fragment",null,zdom("li",null,m),zdom("div",{className:"SCmb puClose"},zdom("ul",null,zdom("li",null,zdom("b",{"data-tooltip":"Close"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"SC_ttip ttr"},zdom("i",{className:"msi-close"}))))))));var d=i.$el;d.find(".zmPAtt").length||(d.find("ul").appendDOM(m),l(),i.position(),zmPreviewTemplate.setSlideShow(t,d),d.find(".zmListReset").unbind("scroll").bind("scroll",_.debounce(function(e){zmAttach.util.removeMAct()},500,!0)))},E=function(a,l,e,n,s,r){var t,i,m,o,d,c,f={accId:zmail.accId,mode:"lstEntity",thb:!0};"t"===n?f.tId=l:f.mId=a,t="/attach.do",i="POST",m=function(e,t){var i;t.reqId===g&&((i="tc"===n?e[a]:e[l]).length?(D(0,i,r,n,s,l),Z(a,l,i,e.shownext,n)):$("#zm_dropDown").remove())},o=function(e,t){if(t.reqId===g){var i=e.msg;i&&_zm.succErrMsg("e",i),$("#zm_dropDown").remove()}},d=f,c={loadingBand:s,reqId:++g},zmAjq.XHR({u:zmail.conPath+t,t:i,fn:m,onerror:o,p:d,ep:c})},n=function(e){var t=zmList.getMailObj(e)||{};if(t.AT&&t.TH){var i=t.T;W(e,i,"t")&&(zmail.mailAttachments[i].data.addInfo.isFull=!1)}};$.subscribe("/mail/sent",function(e,t){var i=t.msgId,a={reply:1,replyall:1,fwdi:2}[t.mode],l=zmUtil.getMLConversionValue();if(i&&a&&!l){var n=zmUtil.getMailObj(i);if(n){var s=n.NS2;3!==s&&s!==a&&(s&&s!==a&&(a=3),zmUtil.updateMailData("NS2",a,i),ZMail.lView.updateElement("envelope",{newStatus:a,msgId:i}))}}}),$.subscribe("mail/spam",function(e,t){n(t)}),$.subscribe("mail/notspam",function(e,t){n(t)}),$.subscribe("mail/delete",function(e,t,i,a){5===a&&n(t)}),$.subscribe("mail/updateRead",function(e,t){var i=t.msgId,a=zmUtil.getMailObj(i);if(t.hasOwnProperty("oldMId"))return a.TUC=zmUtil.getMailObj(t.oldMId,"TUC"),!1;var l=ZMail.lView,n=zmsuite.getCurrentAppObjId(),s=zmsuite.getWorkSpace(n).listElem,r=zmList.getViewBasedMsgList(zmList.getMailObj(i).T,""),m=$(s).find("#t"+i),o=m.find("[data-action='unReadCount']");if(t.hasOwnProperty("newMailWS")){o[0]||(o=(m=$(s).find("#t"+i)).find("[data-action='unReadCount']"));var d=0;if(d=void 0!==a.TUC?a.TUC+1:1,1!==(a.TUC=d)&&o[0])return o.text("("+d+")"),o[0].title=d+" "+C.listing.common.unreadTooltip,!1;var c=l.constTemplate("unReadCount",{unReadCountCls:"zmLThreadUC zmThmClr",unReadCount:d}),f=m.find("[data-action='from']");return $(f).prepend(c),!1}if(0===r.length&&o[0])a.TUC=0,o.remove();else if(0<r.length||t.hasOwnProperty("resp")||t.hasOwnProperty("newMailWS")){var z,u=0;if(r.forEach(function(e){0===(z=zmList.getMailObj(e)).S&&z.FD!==zmail.folId.sId&&u++}),a.TUC=u,o[0])return 0===u?o.remove():(o.text("("+u+")"),o[0].title=u+" "+C.listing.common.unreadTooltip),!1;if(t.hasOwnProperty("resp")){u=0;var p=zmail.folId.sId,g=zmail.folId.tId,h=zmail.folId.spId,I=zmail.folId.dId,v=zmail.folId.oId;t.resp.count.forEach(function(e){e.hasOwnProperty(p)||e.hasOwnProperty(g)||e.hasOwnProperty(h)||e.hasOwnProperty(I)||e.hasOwnProperty(v)||(u+=parseInt(e[Object.keys(e)[0]]))})}else t.hasOwnProperty("newMailWS")&&(u=void(u=0)!==a.TUC?a.TUC+1:1);if(0===(a.TUC=u))return!1;var b=l.constTemplate("unReadCount",{unReadCountCls:"zmLThreadUC zmThmClr",unReadCount:u}),T=m.find("[data-action='from']");$(T).prepend(b)}}),$.subscribe("mail/archive",function(e,t){n(t)});var U=function(e,t){var i,a,l,n=e.msgId,s=e.type,r="zm_Container"===zmTab.currentTab&&zmUtil.getFolId();if(!(r&&zmUtil.isSharedFolder(r)||_zm.isOfflineSyncActive())){if("t"===n.charAt(0)){if("zm_Container"===zmTab.currentTab&&(r===zmail.folId.spId||"archive"===zmInit.getListingDetObj().view))return;n=n.substring(1),i="t"}var m,o,d;m={par:t,showArrow:!0,liDom:"",spanClass:"zm_attPop minwid zmAtt_mulMail",liHover:!1,clk:function(e,t){$(t).closest(".puClose",l[0]).length?l[0].remove():zmAttach.util.removeMAct()},onHide:function(){zmUtil.hideMenu()}},o=zmsuite.showMenu(m),d=zmComponent.loadingBand({container:o.$el[0],type:"pagination"}),o.position(),l=[o,d];var c=zmList.getMailObj(n);if(a="t"===i?c.T:"lt"!==s||c.TH?(i="tc",c.T):(i="sm",n),W(n,a,i)){var f=T(n,a,i);D(0,f,l[0],i,l[1],a),l[1]()}else E(n,a,0,i,l[1],l[0])}},e={selDetails:{},excludeSent:!1,listingFocused:!0,showNotificationPopup:function(e){var t={},i={};(t={msgId:e.pid,opentype:3,type:"lt",tabId:"zmncenter",src:"zmncenter",commentuuid:e.commentuuid}).eprm={accId:zmUtil.getZohoAccId(),isSh:!0,groupId:e.gid,shareId:e.shId,thId:e.pid},e.gid!==zmail.zuid&&(t.eprm.shId=e.shId),i.prevElem=e.elm,i.viewDetails={view:"notification"},zmList.getMailData(t,i)},getNotifyPopupContainer:function(e,t,i,a,l){var n=e.SUBJECT,s=k.contextmenu.opentab,r=zdom("div",{className:"SC_ptit"},zdom("div",{className:"SCmb SC_frt"},zdom("ul",null,zdom("li",{"data-tooltip":s},zdom("b",null,zdom("span",{className:"SC_ttip ttr"},zdom("i",{className:"msi-openInTab popOut","data-shared":i,"data-reminder":a})))))),zdom("div",null,zdom("div",{className:"SC_phd"}," ",n))),m=zdom("div",{className:"SCS_postMail",type:"fixedComment"});t.appendChild(r),t.appendChild(m),a&&(t.className+=" zmMailReminder"),l.contElem=$.e(l.prevElem.childNodes[1])},isMailOpenInTab:function(e){var t,i=zmList.getMailObj(e)||{};return t=i.TH?"zm_tabt"+i.T:"zm_tab"+e,zmsuite.isWorkspaceAvailable(t)},getMailData:function(a,l,n){_zm.isOfflineSyncActive()&&1===a.opentype&&(a.opentype=2);var e=a.opentype;if(2!==e||!zmsuite.isMaxLimitReached()){var t=a.msgId,i=a.from;t&&!t.indexOf("t")&&(t=t.substring(1,t.length));var s=zmUtil.getMailObj(t);if(s||"zia"!==i){var r,m,o={},d=l&&l.viewDetails||{};"external"!==a.src&&"restore"!==a.src&&"zmncenter"!==a.src||s||("restore"===a.src&&(m=a.fId,d=a.viewDetails||{},r=a.toOpen),s=H(t,a.tId,m),s=$.extend(s,a.eprm),o.isMenuallyCreatedMeta=!0);var c,f,z,u={},p=a.type,g=a.tabId||zmTab.currentTab,h=!1,I=!1,v=o.invokedFrom=a.invokedFrom||"";if(Object.keys(d).length||("zm_Container"===g?d=zmInit.getListingDetObj():-1!==g.indexOf("zm_tab")?d=zmsuite.getCenterOuter(g).$el.data("data-detail"):-1!==g.indexOf("zm_srch")?d=zmSearchUtil.getSearchViewDetails():-1!==g.indexOf("zmncenter")&&(d=l?l.viewDetails:{view:"zmncenter"})),"search"===d.view&&zmSearchUtil.isWorkspaceAvailable()&&(a.tabId="zm_srch1"),l=l||G(a),"restore"===a.src&&(l.viewDetails=d),"search"===d.view&&"th"===p&&(l.listArr=zmList.getViewBasedMsgList(s.T,l.viewDetails,!1)),f=s,(c=t)&&s&&(a.vfc||!function(e,t){var i,a,l,n=!1;if(a=t.msgId,l=t.type,a.indexOf("t")||(a=a.substring(1,a.length)),0===e||4===e){var s=t.tabId;n=a===(i=zmPrev.prevDetails(s)).msgId&&l===i.type&&"content"!==l}else if(2===e){var r=zmList.getMailObj(a)||{};"lt"!==l&&"th"!==l||!r.T||(a="t"+r.T),zmsuite.isWorkspaceAvailable("zm_tab"+a)&&"restore"!==t.src&&(zmsuite.showWorkSpace("zm_tab"+a),i=zmPrev.prevDetails("zm_tab"+a),n=t.msgId===i.msgId&&l===i.type&&"content"!==l)}return n}(a.opentype,a)||("lt"!==p||s.TH)&&"th"!==p)){if(1===s.TH&&"external"===a.src&&(a.msgId="t"+a.msgId),m||(m=s.FD),zmUtil.isInlineCompose()||m!==zmail.folId.dId||"lt"!==p||l.viewDetails.fId===zmail.folId.dId||"search"===l.viewDetails.view||(t=s.T,m="",(s=zmUtil.getMailObj(t))||(zmUtil.addMailData({M:t,FD:"",S:1,TH:1,T:t,SB:f.SB},t),s=zmUtil.getMailObj(t))),0!==e&&4!==e||zmUtil.isMailOpenInPreview(t,g)&&("zm_Container"!==g||!zmList.isListingChecked(l.listElem))||$.e(l.prevElem).attr({"data-mid":"","data-ty":""}),m!==zmail.folId.dId||d.fId!==zmail.folId.dId&&zmUtil.isInlineCompose()&&"search"!==d.view)if(m===zmail.folId.teId)ZMail.utils.loadComposer({parentId:t,composeAction:"template"});else{if(l.rowElem&&l.rowElem.length&&l.rowElem.is(":visible")&&(0===a.opentype||4===a.opentype)&&($.e(l.listElem).find("div."+N.mRow).removeClass(N.sel),$.e(l.listElem).find(l.rowElem).addClass(N.sel)),1===a.opentype)return void X({from:"list"},$("#"+a.msgId));if(u={accId:zmail.accId,split:!0,summary:!0},zmail.showFeature&&(u.split=!1),"external"!==a.src&&"zmncenter"!==a.src||(a.eprm?u=$.extend(u,a.eprm):u.accId=zmUtil.getZohoAccId()),0!==zmUtil.getMLConversionValue()&&"search"!==d.view&&"archive"!==d.view&&1!==s.TS&&s.TH&&"lt"===p&&("1"===zmAdHocSettings.getMarkConversationRead()?zmUtil.getListMap(s.T)?(t=function(e,t){var i,a,l,n,s=e,r=zmList.getMailObj(e)||{};for(i=r.T,l=(a=zmList.getViewBasedMsgList(i,t,!0)).length,n=0;n<l;n++)if(0===(r=zmList.getMailObj(a[n])||{}).S&&0===r.AR){s=a[n];break}return s}(t,d),s=zmUtil.getMailObj(t)):u.getUnread="latest":zmUtil.getListMap(s.T)?(t=J(t,d),s=zmUtil.getMailObj(t)):u.getUnread="oldest"),zmUtil.isInlineCompose()&&("lt"===p?s.DC&&0<s.DC&&(u.hasdraft=!0,s.T&&(u.thId=s.T),s.FD===zmail.folId.dId&&(t=s.PA?s.PA:s.T,(s=zmUtil.getMailObj(t))||(s=H(t)),s.TH=1,s.T=u.thId)):"th"===p&&s.DMID&&(u.hasdraft=!0,s.T&&(u.thId=s.T))),u.msgId=t,"zmncenter"===a.src){var b=u.groupId!==zmail.zuid;m=m||zmUtil.getFolderForShID(u.shId,b)}m&&(s.FD||(s.FD=m),d.fId&&zmUtil.isSharedFolder(d.fId)&&92===zmail.shrTree[0][d.fId].RT?(u.label=d.fId,m=d.fId):u.folId=m),Object.assign(o,{msgId:t,att:s.AT,tg:s.TAG,flg:s.NFG,type:p,sm:s.SM,opentype:a.opentype,from:i,noanim:a.noanim,rowId:a.msgId,prevId:c,src:a.src,reqSent:!0,invokedFrom:v,tabId:g,prevDefObj:n,toOpen:r,commentuuid:a.commentuuid,mode:u.mode,getUnread:u.getUnread,isReminder:a.isReminder}),(a.tId&&a.isReminder||s.TH&&"content"!==p&&d.fId!==zmail.folId.tId&&("conversation"===a.src||"restore"===a.src&&"conversation"===r||0!==zmUtil.getMLConversionValue()&&"search"!==d.view&&d.fId!==zmail.folId.sId))&&(zmUtil.getListMap(s.T)&&!zmUtil.getMailObj(s.T,"streams")||(u.thId=s.T));var T,C,M=zmUtil.isShrFolEnabled();"zmncenter"!==a.src&&((C=zmContentCache.get(t)).shareId&&(u.isSh=!0,u.shareId=C.shareId,u.groupId=s.groupId),zmUtil.isSharedFolder(m)?(u.shId=o.shId=zmUtil.getShareId(m),u.isSh=!0,u.shareId=u.shId,u.groupId=zmail.shrTree[0][m].OZUID):d.fId&&zmUtil.isFolderId(d.fId)?(T=(z=zmList.getRowInfo(d.fId,"zmlTreeH","info"))?z.SH:"",M&&T&&"-1"!==T&&(u.isSh=!0,u.shareId=T,u.groupId=zmail.zuid)):d.label&&zmUtil.isLabelId(d.label)?(T=(z=zmList.getRowInfo(d.label,"zmllabelH","info"))?z.shId:"")&&"-1"!==T&&(u.isSh=!0,u.shareId=T,u.groupId=zmail.zuid):"search"===d.view&&zmUtil.isFolderId(s.FD)&&(T=(z=zmList.getRowInfo(s.FD,"zmlTreeH","info"))?z.SH:"",M&&T&&"-1"!==T&&(u.isSh=!0,u.shareId=T,u.groupId=zmail.zuid))),u.isSh&&(u.entityId=s.T?s.T:t,u.entityType=1,o.shOwner=u.groupId,o.shId=u.shId||"",o.shareId=u.shareId||"",zmContentCache.isCached(t)&&"notification-popout"!==v&&zmContentCache.remove(t),u.isSh="content"!==p&&u.isSh),o.isSh=u.isSh||!1,s.FD===zmail.folId.oId?o.opentype=4===zmail.mailOpt.isPopup?4:0:0!==s.S||zmUtil.isSharedFolder(m,"R")||(u.markread=!0,s.AR&&(u.archiveStatus=!0)),a.vfc&&(u.vfc=o.vfc=a.vfc,o.forceFetch=!0),"stream"!==(o.elemObj=l).viewDetails.view&&3!==e&&"zmStreamsApp"!==g&&!s.streams||!s.actionType||a.src||(u.accId=s.accId,delete u.folId,u.actionType=s.actionType,u.streamsView="true",u.groupId=s.groupId,u.entityId=t,u.entityType=s.entityType),s.TH||0!==s.S||s.FD===zmail.folId.oId||zmUtil.isSharedFolder(m,"R")||0!==a.opentype&&4!==a.opentype||(zmail.MailAction.Initializer.rapplyActions({result:"success"},{mailId:[t],thd:[],action:"read",from:"mail_preview"}),o.markread=!0),0!==a.opentype&&4!==a.opentype||(F=o,P="pvreq_"+Date.now(),F.cpvreq=P),"zmncenter"===a.src||!zmContentCache.isCached(t)||u.hasdraft||u.vfc||(u.thId?zmUtil.getListMap(u.thId)?h=!0:o.forceFetch=!0:h=!0),a.actionSrc&&(u.actionSrc=a.actionSrc);var S=0!==zmUtil.getMLConversionValue()&&"search"!==l.viewDetails.view&&l.viewDetails.fId!==zmail.folId.sId&&l.viewDetails.fId!==zmail.folId.tId,w=2===a.opentype&&"restore"!==a.src&&zmList.isMailOpenInTab(t)||(0===a.opentype||4===a.opentype)&&zmUtil.isMailOpenInPreview(t,g);if((2===a.opentype||0===a.opentype||4===a.opentype)&&!a.vfc&&"content"!==p&&s.TH&&S&&w){var L,O,A,y=a.type;0===a.opentype||4===a.opentype?(L="#zmHdr"+("search"===l.viewDetails.view?"S":"P")+t,O=$.q(L),zmPrev.removeCountinPreview(l,a.opentype),"lt"!==y&&(O.length||(A=zmPreviewTemplate.getMissingMailList(s.T,"P"),zmPreviewTemplate.removeNotifBand(l.prevElem),zmPreviewTemplate.addMailsInView({list:A,opentype:a.opentype}),O=$.q(L)),O.length&&(O.find(".zmpr:first").trigger("click"),O.removeClass("zm_tm"),zmPreviewTemplate.alignMailTopToPreview(String(t))),zmRestore.saveState("preview",{p:t},{})),O.parent().addClass("js-scrolltop"),zmList.setMailSelection(t,y,$.e(l.listElem))):(L="#zmHdr"+("search"===l.viewDetails.view?"S":"T")+t,O=$(L),"lt"!==y&&(O.length||(A=zmPreviewTemplate.getMissingMailList(s.T,"T"),zmPreviewTemplate.removeNotifBand(l.prevElem),zmPreviewTemplate.addMailsInView({list:A,opentype:a.opentype}),O=$(L)),O.length&&(O.find(".zmpr:first").trigger("click"),O.removeClass("zm_tm"))),O.parent().addClass("js-scrolltop")),zmList.listingFocused=!0}else if(!h||a.vfc||u.thId){if((0===a.opentype||4===a.opentype)&&"content"!==p){var D=zmsuite.getCenter(g)[1],E=D.getNodes(),U=["DIV",{attrs:{class:"SC_phd"},child:[["text",s.SB||k.common.noSubject]]}];if(zmInit.prevHeader.text=U,E[0].push(zmInit.prevHeader),!u.vfc){E[1].getDOMNode().html(""),zmComponent.loadingBand({container:E[1].getDOMNode()[0],type:"pagination"});var x={fromMail:!1,previewType:""};"zm_Container"!==g&&g.indexOf("zm_srch")||(x.fromMail=!0,x.percent=zmAdHocSettings.getMailPreviewSize()),0!==a.opentype&&4!==a.opentype||(x.previewType=0===a.opentype?"vertical":"horizontal"),D.$el.attr({"data-mid":c,"data-ty":p}),D.show(x)}"content"===p||u.vfc||u.isSh||q({state:"opening",mId:t,openedBy:v})}if("lt"===a.type&&"zm_Container"===g&&!u.isSh)try{var j;I=!0,(j=K(c||t,"mailIds")||[]).length&&(u.mailId=j.join(),o.setSessionId=!0)}catch(e){zmUtil.debugLog("Error while prefetch content for "+c||t,e)}V(u,o,Y)}else o.reqSent=!1,"content"!==p&&q({state:"opening",mId:t,openedBy:v}),Y({},o)}else ZMail.utils.loadComposer({parentId:t,composeAction:"draft"});var F;if(!I&&"lt"===a.type&&"zm_Container"===g&&!u.isSh){var _=c||t;try{K(_,"sendReq")}catch(e){zmUtil.debugLog("Error while prefetch content for "+_,e)}}}}else!function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:zmail.accId,e=Object.assign({messageIds:t,accId:i,getMetaData:!0},a.eprm);ZMail.listing.collection.fetchMailMeta({p:e}).then(function(e){if(i&&i!==zmail.accId)return 2===e.MT?ZMail.utils.loadComposer({parentId:t,openComposeIn:"w"}):X({msgId:e.M,accId:i,from:"external"});zmList.getMailData(a,l,n)},function(){zmUtil.debugLog("Oops! Unable to load the email contents.")})}(t,a.accId)}},constructThreadChildRow:function(e,t){var i,a,l,n={},s={},r=zmInit.getListingDetObj();n=zmCenterListing.create({type:"subMail",mapObj:zmInit.mapObj,classObj:zmInit.classObj});var m=zmList.getMailObj(e);(s=$.extend({},m)).data="th",a=s.FD;var o=zmUtil.isSharedFolder(a);(""===r.fId||!o&&2===zmUtil.getMLConversionValue())&&(s.FN=zmInit.findFolName(m.FD)),i=zmInit.getMailRowIcons(r.fId),m.SZ&&(s.SZ=ZMail.utils.getMailSize(m.SZ)),s.DC=0,1===s.NS2?s.S=0===s.S?2:4:2===s.NS2?s.S=0===s.S?3:5:3===s.NS2&&(s.S=0===s.S?7:8),zmail.mailOpt.isshowSummary||(s.SM=""),a===zmail.folId.oId||a===zmail.folId.dId||a===zmail.folId.teId?s.fromaddr=s.TO||s.TOADDR||"":s.fromaddr=s.F||s.SN||"",a===zmail.folId.oId?s.F=m.TOADDR||m.TO||k.common.undisclosed:(r.fId===zmail.folId.spId?(s.NFG="-1",s.TAG=[]):r.fId===zmail.folId.teId||r.fId===zmail.folId.dId?(s.NFG="-1",s.S=""):a===zmail.folId.sId&&(s.S=9),s.F=m.SN||m.F),s.UW=zmList.isRMOBJ(e),(m.MA||s.UW)&&(s.HT="1");try{s.F===zmail.aInfo[zmail.accId].mailId&&(s.F="Me")}catch(e){}if(m.SCOBJ&&m.FD!==zmail.folId.spId&&a!==zmail.folId.sId){var d=m.SCOBJ[0]||{};if("REVIEWACTION"===d.SCATYPE)s.schemaTip=_zm.escapeTags(d.DESC||""),s.schemaText=k.quickactions.review,d.SHOWRB?s.actionIcon=s.actionIconColor="review_comment":s.actionIcon=s.actionIconColor="review";else if("RSVPACTION"===d.SCATYPE){if(d.EXPIRED)s.schemaTip=k.quickactions.eventexpired,s.schemaText=k.quickactions.rsvp,s.expired=1;else{s.schemaTip=_zm.escapeTags(d.DESC||"");var c={yes:k.quickactions.yes,no:k.quickactions.no,maybe:k.quickactions.maybe};d.RSVPSTUS?s.schemaText=c[d.RSVPSTUS]:s.schemaText=k.quickactions.rsvp}s.actionIcon=s.actionIconColor="rsvp"}else"CONFIRMACTION"===d.SCATYPE||"SAVEACTION"===d.SCATYPE?(s.schemaText=_zm.escapeTags(d.DN||""),s.schemaTip=_zm.escapeTags(d.DESC||""),s.actionIcon=s.actionIconColor="one_click"):"VIEWACTION"===d.SCATYPE||"TRACKACTION"===d.SCATYPE?(s.schemaText=_zm.escapeTags(d.DN||""),s.schemaTip=_zm.escapeTags(d.DESC||""),s.actionIcon=s.actionIconColor="goto"):"ORDER"===d.SCATYPE?(d.ORDEROBJ&&d.ORDEROBJ.VIEWORDERURL&&(s.schemaText=k.quickactions.orderV,s.actionIcon=s.actionIconColor="goto"),s.F=s.SB,s.MUI=0,s.fromaddr="",s.sumTxt=zmList.markupSummary({schemaObj:d})):"PARCELDELIVERY"===d.SCATYPE?(d.PARCLDLVRYOBJ&&d.PARCLDLVRYOBJ.TRACKINGURL&&(s.schemaText=k.quickactions.orderT,s.actionIcon=s.actionIconColor="goto"),s.F=s.SB,s.MUI=0,s.fromaddr="",s.sumTxt=zmList.markupSummary({schemaObj:d})):"FLIGHTRESERVATION"===d.SCATYPE&&(d.FLYTTKTOBJ&&d.FLYTTKTOBJ[0].url&&(s.schemaText=zmList.flightQAType(d.FLYTTKTOBJ[0]),s.schemaTip=_zm.escapeTags(d.DESC||""),s.actionIcon=s.actionIconColor="goto"),s.F=s.SB,s.MUI=1,s.fromaddr="",s.sumTxt=zmList.markupSummary({schemaObj:d}))}if(s.selBoxVisibility=!0,ZMail.utils.isROMode(a)&&(s.selBoxVisibility=!1),s.iconArr=i,n.setDataObj(s),l=$(n.getHTML()),m&&a===zmail.folId.sId&&l.addClass("zmsnt"),void 0===t){var f=p.getViewParentOf(e);t=f&&f.isSelected||!1}return zmCenterListing.mailObjectAPI.setViewObject("c"+e,{id:"c"+e,$element:l,isSelected:t,isExpanded:!0}),l},bindEventsMailRow:function(c,f){zmAppLoader.load("listingEventHandlers").then(function(){var e,t,i,a,l,n,s,r,m=_zm.isOfflineSyncActive(),o=c.target||c.srcElement;if(!(e=$(o)).hasClass("jsOutboxLearnMore")){if(r=$(e).attr("data-attr"),t=e.attr("class")||"",i=S(o),zmList.listingFocused=!0,!i.msgId){if(e.hasClass("jsAcrossSearch")){var d=zmailSearch.Utils.CommonUtils.buildZiaQuery();return void _zm.openZohoOneSearch({query:d})}if(!e.hasClass("jsReloadListing"))return;t="jsReloadListing"}if(n=i.msgId,i.msgId.indexOf("t")||(n=i.msgId.substring(1)),s=n&&zmUtil.getMailObj(n,"FD"),(i.msgId||f)&&((f=f||zmList.getListingElemObj(i)).rowElem=e.closest("."+N.mRow)),e.closest(".zmLbl").length&&(t="zm_lbl"),-1===t.indexOf("msi-rpd")&&-1===t.indexOf("msi-fwd")&&-1===t.indexOf("msi-fwdRpd")&&-1===t.indexOf("path")||(t="msi-mail"),-1!==t.indexOf(u.thdCount))p.setFocus("Mouse",n),"1"===e.text()?(a=zmPrev.prevDetails().msgId)&&a!==n?$.when(zmPrev.cmpClose()).then(function(e){e&&(zmContentCache.remove(a),zmList.getMailData(i,f))}):zmList.getMailData(i,f):zmList.showHideThread({srcElem:e,elemObj:f});else if(-1!==t.indexOf("msi-uncheck")||-1!==t.indexOf("zmLChk")||-1!==t.indexOf("zmFlt")){if(zmUtil.isReadOnlyMail(n))return;i=S(e),f=zmList.getListingElemObj(i),zmList.chkBox(e,f,c)}else if(-1!==t.indexOf(N.flag)){if(zmUtil.isReadOnlyMail(n)||m)return;e.hasClass(N.blueflag)||e.hasClass(N.greenflag)||e.hasClass(N.redflag)||e.hasClass(N.mulflag)?zmail.MailAction.Initializer.flagMail(e,"0"):zmail.MailAction.Initializer.flagMail(e,"2")}else if(-1!==t.indexOf("msi-trash"))zmUtil.isSharedFolder(s)||zmail.MailAction.Initializer.delMail(e);else if(-1!==t.indexOf("msi-edit"))ZMail.utils.loadComposer({parentId:n,composeAction:"outbox"});else if(e.parent().attr("class")&&-1===e.parent().attr("class").indexOf("zmSndSts")&&-1!==t.indexOf("msi-mail")||-1!==t.indexOf("msi-calendar")||-1!==t.indexOf("msi-cart")||-1!==t.indexOf("msi-flight"))zmUtil.isReadOnlyMail(n)||m||zmail.MailAction.Initializer.markAsReadUnread(e);else if(-1!==t.indexOf("zm_lbl")||"tempLabel"===r){if(!zmUtil.isSharedFolder(s)&&!m&&!zmail.isROMode)!function(e,t){var i,a=[],l=[];"t"===e.charAt(0)?(e=e.substring(1),l.push(e)):a.push(e);var n="";(zmList.getMailObj(e)||{}).streams&&(n="default");var s={};(s={}).parentDOM=$(t),s.displayAs="popup",s.accType=n,s.labelState={mailList:[{id:e,ttag:Boolean(l.length)}]},s.onStateChange=function(e,t){zmail.MailAction.Initializer.applyActions("label","click",{msgId:a,thd:l,lA:t?"add":"delete",lId:e,accType:n,disp:zmail.labInfo[e].dispName})},s.onCreate=function(e,t){zmlab.isValidName(e)&&zmlab.labelCreate(e,"",{reqDoneClbk:function(e,t){e&&(s.onStateChange(t,!0),i.hide())},color:t})},(i=zmUtil.createFLComp("label",s)).show()}(String(i.msgId),e.closest(".zmLbl")[0])}else-1!==t.indexOf(N.associate)?zmail.Listing.Handlers.Integrations.associateDialog({msgId:n,elemObj:f,rowDet:i,elem:e,loadType:"list",openWatch:"header_all"}):-1!==t.indexOf("msi-thread")?(a=zmPrev.prevDetails().msgId)?$.when(zmPrev.cmpClose()).then(function(e){e&&A(i,f)}):A(i,f):-1!==t.indexOf("msi-reminder")?zmWatch.showWatch({msgId:n,elemObj:f,rowDet:i,elem:e,loadType:"popup",openWatch:"header_list"}):-1!==t.indexOf(N.qckAct)?zmail.Listing.Handlers.SchemaActions.processSchemaAction(i,e):-1!==t.indexOf(z.jsCls.mds)?zmail.Listing.Handlers.DeliveryStatus.getMailDeliveryStatus(i.msgId):"msi-attachicon"===t?U(i,e):"jsReloadListing"===t?zmList.showMailListing():(a=zmPrev.prevDetails().msgId,l=zmUtil.getMLConversionValue(),!a||0!==i.opentype&&4!==i.opentype||(0!==zmUtil.getMailObj(a,"TH")&&0!==l||a===n)&&(0===l||zmUtil.getMailObj(a,"T")===zmUtil.getMailObj(n,"T"))?(y(i,f),4!==i.opentype||a||function(e){try{var t="zm_srch1"!==zmTab.currentTab?$(zmail.mailCenter.listElem):zmailSearch.Model.getSearchData().elemObj.listingContentElem,i=e.offset().top-t.offset().top,a=t.height();if((a-=Number(zmAdHocSettings.getMailPreviewSize())/100*a)<=i){var l=t.scrollTop()+(i-e.height());t.scrollTop(l)}}catch(e){return}}(f.rowElem)):$.when(zmPrev.cmpClose()).then(function(e){e&&(zmContentCache.remove(a),y(i,f,a))}));zmInit.isLeftFocused=!1}})},isRMOBJ:function(e){var t=!1,i=zmList.getMailObj(e);if(i&&i.RMOBJ&&!$.isEmptyObject(i.RMOBJ)){var a=i.RMOBJ.WT||i.RMOBJ[_.size(i.RMOBJ)-1].WT;1!==a&&2!==a&&3!==a||(t=!0)}return zmail.folId.oId!==i.FD&&zmail.folId.dId!==i.FD&&zmail.folId.spId!==i.FD&&zmail.folId.tId!==i.FD&&zmail.folId.teId!==i.FD||(t=!1),t},unchkAll:function(){var e=ZMail.utils.getHeaderRef({partName:"menuBar"}).find("."+N.checkBox);e.length&&(e.hasClass("msi-check")||e.hasClass("msi-partcheck"))&&(p.selectMails(p.getAllViewObjectIds(!0),!1),zmList.resetThreadPath(),zmInit.listingBand.removeBulkActionBand())},chkAll:function(){p.selectMails(p.getAllViewObjectIds(!0),!0),zmList.showBulkActionBand()},chkBox:function(e,t,i){i=i||{};var a,l,n,s,r=t.isParent,m=t.msgId,o=p.getPerviouslySelected();a="th"===t.type?"c"+m:m,p.setFocus("Mouse",a),n=!((l=p.getViewObject(a))&&l.isSelected),p.selectMail(a,n),i.shiftKey&&o&&o!==a&&p.hasElement(o)&&(s=zmUtil.arrayExtractor(p.getAllViewObjectIds(),o,a),p.selectMails(s,n),p.handleForChildSelection(o,n)),r?p.selectMails(p.getChildrenIdsOf(m),n):p.handleForChildSelection(a,n),p.setPerviouslySelected(a),n||zmList.resetThreadPath(),zmList.showBulkActionBand()},existingchkSingleMsg:function(){var e,t={},i=zmPrev.prevDetails().msgId;i||(i=p.getMailOrders()[0]);var a=p.getViewObject(i);e=a&&a.$element.data("ty"),t.isParent=zmUtil.getMailObj(i,"TH")&&"lt"===e&&0!==zmUtil.getMLConversionValue(),t.msgId=i,t.type=e,t.msgId&&zmList.chkBox(null,t)},chkSingleMsg:function(){if(zmInit.isNewKSEnabled){var e,t,i,a={};e=p.getCurrentFocusedMsgId(),t=p.getViewObject(e),e.includes("c")&&(e=e.substr(1)),zmUtil.isSharedFolder(zmUtil.getMailObj(e).FD)&&zmUtil.isReadOnlyMail(e)||(i=t&&t.$element.data("ty"),a.isParent=zmUtil.getMailObj(e,"TH")&&"lt"===i&&0!==zmUtil.getMLConversionValue(),a.msgId=e,a.type=i,a.msgId&&zmList.chkBox(null,a))}else zmList.existingchkSingleMsg()},doThreadPath:function(e,t){var i;i=e.parents(".SC_mclst"),function(e,t,i){var a,l=N.parChild;if(a=t.attr("id")||t.attr("data-detail"),"add"===e){var n=zmList.getMailObj(a),s=n?n.PA:"";i.find("."+N.mRow).each(function(){var e=$(this),t=this.id||$(this).attr("data-detail");if(e.removeClass(l),t===a&&e.addClass(l),t===s){var i=zmList.getMailObj(s);e.addClass(l),s=void 0===i.PA?"":i.PA}})}else"remove"===e&&i.find("."+N.mRow).removeClass(l)}(t,e,i)},resetThreadPath:function(){if("zm_Container"===zmTab.currentTab||"zm_srch1"===zmTab.currentTab){var e=zmPrev.prevDetails(zmTab.currentTab),t=e.msgId;if(!t)return;var i,a,l=e.type;i=zmsuite.getCenter(zmTab.currentTab)[0].getNodes()[2].$el,a="th"===l?i.find("#"+t):i.find("#t"+t),zmList.doThreadPath(a,"add")}},allowFLOperation:function(e){var t=!0;if(!e)return!1;for(var i in zmail.folId)if(zmail.folId[i]===e){t=!1;break}return t},remReadMail:function(){var e=zmList.getElemObj().listElem||zmail.mailCenter.listElem,t=$(e);("zm_Container"===zmTab.currentTab?t.children("."+N.mRow+":not(."+N.unread+")"):t.children("."+N.mRow+":not(."+N.unread+",."+N.sel+")")).each(function(){var e,t,i=this.id;(t=(e=$(this)).parent()).hasClass(N.thdChild)?t.children("."+N.mRow).hasClass(N.unread)||(t.remove(),t.prev().remove()):(e.remove(),i.indexOf("t")||(i=i.substring(1,i.length)),$("#thd"+i).length&&$("#thd"+i).remove()),zmCache.updateCacheForViews(i)})},mailUtility:function(e){var t,i,a,l,n,s=!1,r=_zm.isOfflineSyncActive(),m=zmail.isROMode;l=e.target||e.srcElement;var o=$(l).closest("."+N.mRow).attr("id");if(o){n="t"===(zmInit.rclkId=o).charAt(0)?zmUtil.getFolId():zmUtil.getMailObj(o,"FD"),t=e.target||e.srcElement,i=$.e(t);var d="t"===o.charAt(0)?o.substring(1):o,c=i.closest("."+N.mRow);if(i.hasClass(N.flag)){if(zmUtil.isSharedFolder(n,"R")||r||m)return;i.css("visibility","visible"),a={clk:function(e,t){zmail.MailAction.Initializer.setFlag(i,t)},removeSelection:!0,conArr:[{dom:zdom("fragment",null,zdom("i",{className:N.blueflag}),k.flagmenu.infoflag),data:{flag:"1"}},{dom:zdom("fragment",null,zdom("i",{className:N.redflag}),k.flagmenu.important),data:{flag:"2"}},{dom:zdom("fragment",null,zdom("i",{className:N.greenflag}),k.flagmenu.followup),data:{flag:"3"}},{sep:!0},{dom:zdom("fragment",null,zdom("i",{className:N.noflag}),k.flagmenu.clearflag),data:{flag:"0"}}],onHide:function(){i.css("visibility","")}},s=!0,zmsuite.showContextMenu(e,a),zmUtil.stopEvents(e)}else if(n!==zmail.folId.oId&&n!==zmail.folId.teId&&n!==zmail.folId.dId){var f=[n===zmail.folId.sId?{txt:k.contextmenu.listrecipient,data:{action:"listrecipient",from:"ctxtMenu"}}:{txt:k.contextmenu.listfromsender,data:{action:"listsender",from:"ctxtMenu"}},{txt:k.contextmenu.listbysubject,data:{action:"listsubject",from:"ctxtMenu"}},{sep:!0},{txt:k.contextmenu.openpreview,data:{action:"openpreview",opentype:4===zmail.mailOpt.isPopup?4:0}},{txt:k.contextmenu.opentab,data:{action:"opentab",opentype:2}},{txt:k.contextmenu.popout,data:{action:"openwindow",from:"ctxtMenu"}},{sep:!0},{txt:k.contextmenu.reply,data:{action:"reply",from:"ctxtMenu"}},{txt:k.contextmenu.replyall,data:{action:"replyall",from:"ctxtMenu"}},{txt:k.contextmenu.forward,data:{action:"fwdi",from:"ctxtMenu"}},{sep:!0},{txt:k.contextmenu.markspam,data:{action:"spam",from:"ctxtMenu"}},{txt:k.contextmenu.marknotspam,data:{action:"notspam",from:"ctxtMenu"}},{txt:k.contextmenu.delete,data:{action:"delete",from:"ctxtMenu"}}];0===zmail.mailOpt.isPopup||4===zmail.mailOpt.isPopup?f.splice(3,1):1===zmail.mailOpt.isPopup?f.splice(5,1):f.splice(4,1),zmUtil.isSharedFolder(n)||r||m?f.splice(9,4):n===zmail.folId.spId?f.splice(10,1):f.splice(11,1),(zmUtil.isSharedFolder(n,"R")||m)&&f.splice(5,9),r&&(f.splice(0,3),f.splice(1,1));var z=[];zmUtil.isSharedFolder(n)||r||m||(z.push({htm:k.contextmenu.addfilter,data:{action:"addFilter"}}),zmUtil.isZohoAccount(zmail.accId)&&!zmail.isAusCustomer&&(z.push({txt:k.contextmenu.addtask,data:{action:"addTask"}}),zmail.isAusCustomer||z.push({txt:k.contextmenu.addnote,data:{action:"addNote"}}),zmail.isAusCustomer||z.push({txt:k.contextmenu.addevent,data:{action:"addEvent"}}))),z.length&&(f.push({sep:!0}),1===z.length?f.push({txt:k.contextmenu.addtofilter,data:{action:"addFilter"}}):f.push({dom:zdom("fragment",null,j.contextmenu.addto,zdom("i",{className:"msi-rarrow"})),data:{action:"addtomenu"},child:function(){return zmPreviewTemplate.getAddToMenu(d,"right")}})),a={clk:function(e,t){t&&(t.actionSrc="contextmenu",t.msgId=d),zmList.bindAction(t,e)},conArr:f,removeSelection:!0},s=!0,zmsuite.showContextMenu(e,a),zmUtil.stopEvents(e)}c.length&&s&&c.addClass(N.ritClk)}},leftUtility:function(e,t,i){var a,l=t.id||$(t).parents(".zmTreeNode").attr("id");if(zmInit.rclkId=l,"zmlTreeH"===i)a={clk:function(e,t){zmAppLoader.load("zmFolder").then(function(){zmList.bindAction(t,e)})},conArr:[{htm:c.foldercontextmenu.createsub,id:"zmLTMenu_Nf",cEdit:!0,data:{action:"zmLTMenu_Nf"}},{sep:!0,id:"zmLTMenu_lne1"},{htm:c.foldercontextmenu.markfolread,id:"zmLTMenu_Fr",cEdit:!1,data:{action:"zmLTMenu_Fr"}},{sep:!0,id:"zmLTMenu_lne2"},{htm:c.foldercontextmenu.sharefol,id:"zmLTMenu_Sf",cEdit:!1,data:{action:"zmLTMenu_Sf"}},{sep:!0,id:"zmLTMenu_lne3"},{htm:c.foldercontextmenu.renamefol,id:"zmLTMenu_Rf",cEdit:!0,data:{action:"zmLTMenu_Rf"}},{htm:c.foldercontextmenu.delfol,id:"zmLTMenu_Df",cEdit:!1,data:{action:"zmLTMenu_Df"}},{sep:!0,id:"zmLTMenu_lne4"},{htm:c.foldercontextmenu.archfol,id:"zmLTMenu_Af",cEdit:!1,data:{action:"zmLTMenu_Af"}},{htm:c.foldercontextmenu.emptyfol,id:"zmLTMenu_Ef",cEdit:!1,data:{action:"zmLTMenu_Ef"}},{htm:c.foldercontextmenu.runthru,id:"zmLTMenu_Rt",cEdit:!1,data:{action:"zmLTMenu_Rt"}}]},zmUtil.isShrFolEnabled()||a.conArr.splice(3,2),zmail.Utils.FeatureUtil.isHidden("settings")&&a.conArr.pop(),zmsuite.showContextMenu(e,a),zmUtil.stopEvents(e);else if("zmllabelH"===i){if(!zmUtil.isSystemLabel(l)){var n=[{htm:c.tagCreateEdit.edittag,id:"zmLTMenu_El",cEdit:!0,data:{action:"zmLTMenu_El"}},{htm:c.tagCreateEdit.deltag,id:"zmLTMenu_Dl",cEdit:!1,data:{action:"zmLTMenu_Dl"}}];if(zmail.showFeature){var s={},r=c.tagCreateEdit.sharetag,m=zmList.getRowInfo(l,"zmllabelH","info");m&&m.shId&&"-1"!==m.shId&&(r=c.foldercontextmenu.shareinfo),s.htm=r,s.id="zmLTMenu_Sl",s.data={action:"zmLTMenu_Sl"},s.cEdit=!0,n.push(s)}a={clk:function(e,t){zmail.showFeature?zmAppLoader.load("sharefolder").then(function(){zmList.bindAction(t,e)}):zmList.bindAction(t,e)},conArr:n},zmsuite.showContextMenu(e,a)}zmUtil.stopEvents(e)}else if("zmlSSrchTreeH"===i)a={clk:function(e,t){zmAppLoader.load("mailSearch").then(function(){zmList.bindAction(t,e)})},conArr:[{htm:c.common.rename,id:"zmLTMenu_Rss",cEdit:!1,data:{action:"zmLTMenu_Rss"}},{htm:c.common.delete,id:"zmLTMenu_Dss",cEdit:!1,data:{action:"zmLTMenu_Dss"}}]},zmsuite.showContextMenu(e,a),zmUtil.stopEvents(e);else if("zmlSTreeH"===i)a={clk:function(e,t){zmAppLoader.load("sharefolder").then(function(){zmList.bindAction(t,e)})},conArr:[{htm:c.foldercontextmenu.unsubscribe,id:"zmLTMenu_Unshare",cEdit:!1,data:{action:"zmLTMenu_Unshare",cur:t,zm_unshareId:l}}]},zmsuite.showContextMenu(e,a),zmUtil.stopEvents(e);else if("zmStreamTree"===i){if(a={clk:function(e,t){zmStreamsApp.events.groupAction(t)},conArr:[{htm:c.streams.viewMembers,id:"zmLTMenu_VMem",cEdit:!1,data:{action:"viewMembers",gid:l}}]},l!==zmail.zuid&&_zm.isNumeric(l)){var o=zmStreamsApp.util.getGroupDetails(l);if(o.eid&&a.conArr.push({htm:c.streams.emailGroup,id:"zmLTMenu_Email",cEdit:!1,data:{action:"email",gid:l}}),zmail.IntegrationStatus.CHAT&&a.conArr.unshift({htm:c.streams.chatGroup,id:"zmLTMenu_CChat",cEdit:!1,data:{action:"createChat",gid:l}}),0<o.scount)zmStreamsApp.events.getMarkReadProgress(l)||a.conArr.push({htm:c.streams.markRead,id:"zmLTMenu_Email",cEdit:!1,data:{action:"markRead",gid:l}});var d=c.streams.grpInfo;o.isOwner&&(d=c.streams.grpEdit),a.conArr.push({htm:d,id:"zmLTMenu_Email",cEdit:!1,data:{action:"editGroup",gid:l}}),a.conArr.push({htm:c.streams.hideGrp,id:"zmLTMenu_Email",cEdit:!1,data:{action:"hideGroup",gid:l}}),zmsuite.showContextMenu(e,a)}zmUtil.stopEvents(e)}},getMailSummaryList:function(e,t,i,a){var l,n=[],s=!1,r="archive"===e.view;if(e.fId!==zmail.folId.sId&&zmList.excludeSent||(s=!0),zmUtil.getListMap(t)){var m=zmList.getListObj(t,"MO"),o=zmail.folId.dId,d=zmail.folId.sId,c={};if(a&&(m=m.slice(a)),e.fId&&(zmail.folCount[e.fId]||$("#"+e.fId).length))if(e.flag)if(-1===parseInt(e.flag))for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD===e.fId&&0!==parseInt(c.NFG)&&1!==c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD===e.fId&&parseInt(c.NFG)===parseInt(e.flag)&&1!==c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else if(e.label)if("-1"===e.label)for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD===e.fId&&c.TAG&&0<c.TAG.length&&1!==c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else for(l=0;l<m.length;l++){c=zmList.getMailObj(m[l]);var f=$.inArray(e.label,c.TAG);c.FD===e.fId&&-1!==f&&1!==c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l])}else if("unread"===e.view)for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD===e.fId&&0===c.S&&1!==c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else if(e.attach)for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD===e.fId&&1===c.AT&&1!==c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else if(r)for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD===e.fId&&1===c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD===e.fId&&1!==c.AR&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else if(zmail.labInfo[e.label]){for(l=0;l<m.length;l++)if((c=zmList.getMailObj(m[l])).TAG&&c.FD!==zmail.folId.spId&&c.FD!==zmail.folId.tId&&c.FD!==o&&(c.FD!==d||c.FD===d&&s))for(var z=c.TAG,u=0;u<z.length;u++)z[u]===e.label&&n.push(m[l])}else if("unread"===e.view)for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD!==zmail.folId.spId&&c.FD!==zmail.folId.tId&&0===c.S&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else if(e.flag)if(-1===parseInt(e.flag))for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD!==zmail.folId.spId&&c.FD!==zmail.folId.tId&&0!==parseInt(c.NFG)&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD!==zmail.folId.spId&&c.FD!==zmail.folId.tId&&parseInt(c.NFG)===parseInt(e.flag)&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l]);else if("all"===e.view)for(l=0;l<m.length;l++)(c=zmList.getMailObj(m[l])).FD!==zmail.folId.spId&&c.FD!==zmail.folId.tId&&c.FD!==o&&(c.FD!==d||c.FD===d&&s)&&n.push(m[l])}return zmail.convSortOrder&&i?n.reverse():n},getListForAllMailsView:function(e,t,i,a){var l,n=[],s=!1,r="archive"===(e=e||{}).view;e.fId!==zmail.folId.sId&&zmList.excludeSent||(s=!0);var m=zmList.getListObj(t);if(m){var o,d=m.MO,c=zmail.folId.dId;for(a&&(d=d.slice(a)),l=0;l<d.length;l++)(o=zmList.getMailObj(d[l]))&&o.FD!==zmail.folId.spId&&o.FD!==zmail.folId.tId&&(r&&1===o.AR||!r&&1!==o.AR||i)&&o.FD!==c&&(o.FD!==zmail.folId.sId||o.FD===zmail.folId.sId&&s)&&n.push(d[l])}return n},showHideThread:function(e){var t,i,a=e.srcElem,l=e.elemObj,n=e.opentype,s=e.onEnd,r=e.rowId,m=e.isNxtListLoad,o={},d={};r||(r=$(a).closest("."+N.mRow)[0].id),r.indexOf("t")||(r=r.substring(1)),o={from:"tIcon",mId:r,elemObj:l},s&&(o.eTDefObj=s);var c=zmList.getMailObj(r);if("search"!==l.viewDetails.view&&zmList.getListObj(c.T)&&!m)R({},{mId:r,from:o.from,elemObj:l,opentype:n});else{if(t=c.T,i=c.FD,d={accId:zmail.accId,thId:t,summary:!0},m){var f=zmUtil.getListMap(t,"MO")||[],z=f.length;if(z&&(d.thdindex=z+1),o.isNxtListLoad=!0,o.index=z,_zm.isOfflineSyncActive()){var u=zmUtil.getMailObj(_.last(f))||{};o.lastMsgRevTime=u.R,o.lastMsgId=u.M}}l.viewDetails.fId&&zmUtil.isSharedFolder(l.viewDetails.fId)?(i=l.viewDetails.fId,d.shId=zmUtil.getShareId(i),zmail.opType.read_mail?d.opType=zmail.opType.read_mail:d.opType=0):"zm_Container"===zmTab.currentTab&&(d.folId=i),V(d,o,R)}},getThreadCount:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(void 0!==e.msgId){var t=zmUtil.getMailModel(e.msgId),i={msgId:e.msgId,ep:{deferredObj:e.deferredObj}};t.updateThdProperties(i)}},updThdCount:function(e,t){var i=t.msgId,a=1;e.cntdata[0].count&&(a=parseInt(e.cntdata[0].count)),zmList.updateModel("TC",a,i),t.deferredObj&&t.deferredObj.resolve()},updThdDetails:function(e,t){var i=t.msgId,a=zmUtil.getMailObj(i);e&&(a.TC=e.TC,a.TA=e.TA,a.TS=e.TS,a.TI=e.TI,a.TM=e.TM,a.TF=e.TF,a.TTAGS=e.TTAGS,a.TSN=e.TSN,a.TSB=e.TSB,a.TSM=e.TSM),t.deferredObj&&t.deferredObj.resolve()},setEmptyListing:function(){var e,t;0!==(e=$.e(zmail.mailCenter.listElem)).find("."+N.mRow).length||e.data("ty")||(t=zmInit.emptyRow(),e.appendDOM(t,{clear:!0}),zmInit.listingBand.SpamTrashBand.setBand(),zmUtil.hideMenu())},FLUtility:function(e,t,i,a){if(!ZMail.utils.isROMode()){var l=t.id||$(t).parents(".zmTreeNode").attr("id"),n=zmail.folId;if(zmUtil.stopEvents(e),"zm_unread"===l||"zm_all"===l||"zm_flag"===l||l===n.dId||l===n.oId&&0===zmfolAction.getUnreadCount(l))zmUtil.hideMenu();else{if("header"!==a){zmList.leftUtility(e,t,i),l&&"zmlTreeH"===i?zmfolAction.rgtFolId=l:"zmllabelH"===i?zmlab.labelId=l:"zmlSSrchTreeH"===i?zmSearch.savedSearchId=l:"zmStreamTree"===i&&zmUtil.requireStreamsApp().then(function(){zmStreamsApp.constants.rightClickId=l});var s=[];l===n.iId?s=[4,6,7]:l===n.tId?(s=[0,4,6,7,9,11],zmfolAction.rgtFolId=zmail.folId.tId,$("#zmLTMenu_Ef").html(c.emptyfolder.emptytrash)):zmfolAction.isDeletedFolder(l)?(s=[0,4,6,9],$("#zmLTMenu_Ef").html(c.emptyfolder.emptytrash)):l===n.sId?($("#zmLTMenu_Ef").html(c.emptyfolder.emptysent),s=[0,4,6,7]):l===n.spId?($("#zmLTMenu_Ef").html(c.emptyfolder.emptyspam),s=[0,4,6,7,9]):l===n.oId?($("#zmLTMenu_Ef").html(c.foldercontextmenu.sendnow),s=[0,2,4,6,7,9,11]):l===n.teId?($("#zmLTMenu_Ef").text("Create Template"),s=[0,4,6,7,9,11]):$("#zmLTMenu_Ef").html(c.foldercontextmenu.emptyfol),0===zmfolAction.getUnreadCount(l)&&s.push(2),zmList.dimUtility(r,s)}zmail.isOrg||"1"!==zmail.aInfo[zmail.accId].accountType?"0"===zmail.aInfo[zmail.accId].accountType?($("#zmLTMenu_lne2").remove(),$("#zmLTMenu_Sf").remove()):zmUtil.isFolderId(l)&&"-1"!==zmList.getRowInfo(l,"zmlTreeH","info").SH&&$("#zmLTMenu_Sf").html(c.foldercontextmenu.shareinfo):$("#zmLTMenu_Sf").addClass("SC_op3")}}},getParent:function(e,t){for(;$(e).attr("tagName")!==zmInit.topelement&&!$(e).hasClass(t);)if(e=zmInit.nn6?e.parentNode:e.parentElement,$(e).hasClass(t)&&"DIV"===e.tagName)return e;return e},dimUtility:function(e,t){t=t.sort(function(e,t){return e===t?0:t<e?1:-1});for(var i=0,a=0;a<e.length;a++)a===t[i]?("zmLTMenu_Rf"===e[a]||"zmLTMenu_Nf"===e[a]?$("#"+e[a]).parent().addClass("SC_op3"):$("#"+e[a]).addClass("SC_op3"),i++):$("#"+e[a]).removeClass("SC_op3")},getRowInfo:function(e,t,i){var a={};return e&&(a=zmail.mailLeft.getNodes()[0].getLayer(t).getRowObj(e),i)?a[e]:a},editLeftRow:function(e,t){var i;(i=zmail.mailLeft.getNodes()[0].getLayer(t)).editNode(e,i.mapObject)},rnLabContextMenu:function(){var e="zmllabelH"!==zmlab.labelId,t=e?"e":"a",i=$("#zmLTMenu_El");zmUtil.setEditable({ele:$("#zmLTMenu_El"),target:$("#"+zmlab.labelId),callback:zmUtil.hideMenu,initialize:e,parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:i,activeMenuHandler:zmlab.labelMenuHadler,activeMenuArgsArray:[t]}])},delLabContextMenu:function(){zmlab.labelId&&zmsDialog.confirm(c.tagCreateEdit.deltagdialogmsg,{onOk:function(){zmlab.labelreq("d")}}),zmUtil.hideMenu(!0)},frmListObj:function(e){var t={};for(var i in e)e[i]&&void 0!==e[i].FRM_SIGMODE&&6!==e[i].FRM_SIGMODE&&(t[i]=e[i]);return t},getFrmLst:function(e){var t,i=zmList.frmListObj(zmail.cmpdata.FROM_LIST),a={},l=[];for(var n in i)t={txt:n,data:{frm:n}},e.find("span").eq(0).text()!==n&&l.push(t);a.list=l,a.par=$("#zmshr_frmlst"),a.align="pleft",a.clk=function(e){$("#zmshr_frmlst").find("span").eq(0).text(e.frm),$("#zm_dropDown").remove()},zmsuite.showMenu(a)},updateThreadList:function(e){var t;e&&zmUtil.getListMap(e)&&(t={accId:zmail.accId,thId:e,summary:!0},V(t,{thId:e,from:"tIcon"},zmUtil.cacheThreadList))},updateFolderName:function(){var e,t=zmList.getElemObj();e=t.viewDetails,$.e(t.listElem).length&&(""!==e.fId||"unread"!==e.view&&"all"!==e.view&&"flag"!==e.view?e.fId&&ZMail.topbar.header.renovate():$.e(t.listElem).find("div."+N.mRow).each(function(){var e;-1!==(e=this.id).indexOf("t")&&(e=e.substring(1,e.length)),e&&$(this).find("."+N.folName).text(zmInit.findFolName(zmList.getMailObj(e).FD))}))},bindAction:function(e,t,i,a){if(e){var l,n,s,r,m=e.action||e,o=e.actionSrc;switch(m){case"actionmenu":break;case"folread":zmfolAction.markAsReadFolder(),zmUtil.hideMenu(!0);break;case"recall":ZMail.recall.init({mId:e.mId}),a&&a.remove();break;case"upgrade":window.open("//www.zoho.com/workplace/pricing.html","_blank").focus();break;case"unread":case"read":zmail.MailAction.Initializer.applyActions(m,"dropdown"),zmUtil.hideMenu(!0);break;case"flag":case"label":zmail.MailAction.Initializer.applyActions(m,"click",e),zmUtil.hideMenu(!0);break;case"move":zmail.MailAction.Initializer.doActions(m,"drop",e);break;case"spam":(e.from&&"ctxtMenu"===e.from?(s=zmInit.rclkId,zmail.MailAction.Initializer.markSpamFromContextMenu):(s="spam",zmail.MailAction.Initializer.doActions))(s,o);break;case"delete":(e.from&&"ctxtMenu"===e.from?(s=zmInit.rclkId,zmail.MailAction.Initializer.delMailFromContextMenu):(s="delete",zmail.MailAction.Initializer.doActions))(s,o);break;case"notspam":(e.from&&"ctxtMenu"===e.from?(s=zmInit.rclkId,zmail.MailAction.Initializer.markNotSpamFromContextMenu):(s="notspam",zmail.MailAction.Initializer.doActions))(s,o);break;case"archive":zmail.MailAction.Initializer.doActions("archive"),zmUtil.hideMenu();break;case"unarchive":zmail.MailAction.Initializer.doActions("unarchive"),zmUtil.hideMenu();break;case"sortdateup":zmList.changeListingSortOrder(1);break;case"sortdatedn":zmList.changeListingSortOrder(0);break;case"views":zmList.show("zm_viewLst",t);break;case"listview":zmUtil.hideMenu(),O(e);break;case"clsPrev":if("zm_Container"!==zmTab.currentTab&&zmTab.currentTab.indexOf("zm_srch"))"unread"===zmsuite.getCenterOuter().$el.data("data-detail").view&&zmList.remReadMail(),$.when(zmPrev.cmpClose()).then(function(e){if(e){var t=zmPrev.prevDetails(zmTab.currentTab).msgId;zmContentCache.remove(t),zmsuite.closeWorkspace(zmTab.currentTab)}});else zmPrev.clsPreview();break;case"zmLTMenu_Nf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"new",type:"subfolder"});break;case"zmLTMenu_Rf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"rename"});break;case"zmLTMenu_Fr":zmail.Folder.EventHandlers.mrkReadContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Unshare":zmAppLoader.load("sharefolder").then(function(){zmshare.unshareContextMenu(e),zmUtil.hideMenu(!0)});break;case"zmLTMenu_Ef":zmfolAction.rgtFolId===zmail.folId.oId?zmList.sendOutbox("sendI"):zmfolAction.rgtFolId===zmail.folId.teId?zmAppLoader.load("Template").then(function(){zmComponent.createTemplate(),zmUtil.hideMenu()}):zmail.Folder.EventHandlers.emptyFolContextMenu();break;case"zmLTMenu_Df":zmail.Folder.EventHandlers.delFolContextMenu();break;case"zmLTMenu_El":zmUtil.hideMenu(),zmlab.showCreateTagPopUp({mode:"rename"});break;case"zmLTMenu_Dl":zmList.delLabContextMenu();break;case"zmLTMenu_Sf":zmAppLoader.load("sharefolder").then(function(){zmshare.shareFolContextMenu("fol"),zmUtil.hideMenu(!0)});break;case"zmLTMenu_Sl":zmAppLoader.load("sharefolder").then(function(){zmshare.shareFolContextMenu("tag"),zmUtil.hideMenu(!0)});break;case"zmLTMenu_Af":zmail.Folder.EventHandlers.archiveFolderContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Dss":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.delSavedSrchContextMenu()}),zmUtil.hideMenu();break;case"zmLTMenu_Rt":$.publish("FILTER_RUNTHROUGH",zmfolAction.rgtFolId);break;case"zmLTMenu_Rss":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.rnSSrchContextMenu()});break;case"listsender":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.listMailsContextMenuAction("sender",o)});break;case"listrecipient":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.listMailsContextMenuAction("recipient",o)});break;case"listsubject":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.listMailsContextMenuAction("subject",o)});break;case"openpreview":(l=S(zmInit.rclkId)).src=o,l.opentype=e.opentype,r=l.msgId,l.msgId.indexOf("t")||(r=l.msgId.substring(1));var d=zmUtil.getMLConversionValue(),c=zmPrev.prevDetails().msgId;c&&((0===zmUtil.getMailObj(c,"TH")||0===d)&&c!==r||0!==d&&zmUtil.getMailObj(c,"T")!==zmUtil.getMailObj(r,"T"))?$.when(zmPrev.cmpClose()).then(function(e){e&&(zmContentCache.remove(c),zmList.getMailData(l))}):zmList.getMailData(l),zmUtil.hideMenu();break;case"opentab":(l=S(zmInit.rclkId)).actionSrc=o,l.opentype=e.opentype,zmsuite.isMaxLimitReached()||zmList.getMailData(l),zmUtil.hideMenu();break;case"openwindow":X(e,t),zmUtil.hideMenu();break;case"viewfullthd":"header"===(e.from||$.e(t).attr("data-from"))&&(n=$.e(t).closest(".SC_pv"),(r=n.attr("data-mid"))&&zmList.getMailData({msgId:r,type:"lt",opentype:2,src:"conversation"}));break;case"reply":case"replyall":case"fwdi":e.from&&"ctxtMenu"===e.from?ZMail.utils.loadComposer({parentId:e.msgId,composeAction:m,composeOpenType:"ctxtMenu"}):zmUtil.invokeComposer({mode:"fwdi"}),zmUtil.hideMenu();break;case"FwdAttach":zmUtil.hideMenu(),zmUtil.invokeComposer({mode:"fwdme"});break;case"select_all":case"select_none":case"select_unread":case"select_read":case"select_flag":case"select_label":case"select_attach":zmList.unchkAll(),w(e);break;case"view_all":case"view_unread":case"view_flag":case"view_label":case"view_attach":case"view_archive":e.isAttachOnly?(zmsuite.isMaxLimitReached()||L(),zmUtil.hideMenu()):O(e);break;case"addTask":r=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),ZMail.utils.loadTask(r);break;case"addFilter":r=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),zmUtil.hideMenu(),zmPreviewTemplate.createNewFilter({action:m,msgId:r,actionSrc:o});break;case"addNote":r=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),ZMail.utils.loadNote(r);break;case"addEvent":r=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),zmUtil.hideMenu(),zmUtil.loadEvents(function(){zmail.eventInteg.util.addEvent(r)});break;case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"sweep":zmAppLoader.load("listingEventHandlers").then(function(){zmail.Listing.Handlers.SweepAction.performSweepAction(zmUtil.getFolId())});break;case"conversationOn":zmList.changeListingView(2);break;case"conversationOff":zmList.changeListingView(0);break;case"chatlet":zmUtil.createContexualChat(t);break;case"customizeActionList":i(e.value),zmail.showHideSkeleton.updateList(e.value);var f=t.getElementsByClassName("msi-tick")[0];f?f.className="":"msi-tick"===t.className?t.className="":((f=document.createElement("i")).className="msi-tick",t.appendChild(f));break;default:zmUtil.hideMenu()}}},updOutbox:function(e,t){var i;if(zmInit.sendLoadOutbox("hide"),zmList.unchkAll(),0<(i=!e.res&&t.mIds?t.mIds.length:e.res.split(",")[0]))for(var a=0;a<i;a++)ZMail.utils.updateCount({fId:zmail.folId.oId,mode:"dec"});var l=zmInit.getListingDetObj();if("zm_Container"===zmTab.currentTab&&zmail.folId.oId===l.fId){var n={folId:zmail.folId.oId};$(zmail.mailCenter.listElem).html(""),zmUtil.clearCollectionDMap(),zmInit.setListingDetObj({});var s=zmPrev.prevDetails("zm_Container").msgId;if(s&&"sendM"===t.mode)-1===(t.mIds||[]).indexOf(s)&&(n.retainPreview=!0);zmInit.foldView(n)}t.draft&&ZMail.utils.updateCount({fId:zmail.folId.dId,mode:"binc",state:"read",count:i})},movetoDraftfromOutbox:function(){var e=zmUtil.getSelectedMails()[0],t={mode:"stopOutboxSchedule",mailId:e.join(","),accId:zmail.accId},i={mIds:e,draft:!0};if(0===t.mailId.length)return!1;zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",p:t,fn:zmList.updOutbox,csr:"s",ep:i})},sendOutbox:function(e){zmUtil.hideMenu(),zmInit.sendLoadOutbox("show"),e||(e="sendM");var t={aId:zmail.accId},i={mode:e};if("sendM"===(t.mode=e)){var a=zmUtil.getSelectedMails()[0];t.mId=a.join(","),i.mIds=a}zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmList.updOutbox,p:t,csr:"s",ep:i})},getElemObj:b,consPreview:Y,getListingElemObj:G,showMailListing:function(e,t){var i,a,l,n="",s=!1,r=!(!1===(t=t||{}).toSelFol);l=e&&!$.isEmptyObject(e)?(n=(i=e).fId||i.folId||"",a=i.view||"",i.viewId||""):(a=((i=zmInit.getListingDetObj()).flag?"flag":i.label&&"label")||i.view||i.attach&&"attach",n=i.fId||i.folId||{unread:"zm_unread",all:"zm_all",flag:"zm_flag"}[a]||"",i.label||i.flag);var m=t.sortAscending;if(void 0===m&&(m=zmfolAction.getSortProperties(n||zmUtil.getFolId(),"type")),r?n?zmUtil.isViewId(n)?(s=!0,zmail.mailLeft.selRow(n,"zmlviewH",!0)):zmUtil.isSharedFolder(n)?(s=!0,zmail.mailLeft.selRow(n,"zmlSTreeH",!0)):zmUtil.isFolderId(n)?(s=!0,zmail.mailLeft.selRow(n,"zmlTreeH",!0)):zmUtil.isLabelId(n)&&(s=!0,zmail.mailLeft.selRow(n,"zmllabelH",!0)):l&&zmUtil.isLabelId(l)&&(s=!0,zmail.mailLeft.selRow(l,"zmllabelH",!0)):s=!0,s){$(zmail.mailCenter.listElem).html(""),zmUtil.clearCollectionDMap(!0),zmInit.setListingDetObj({});var o={folId:n,view:a,viewId:l,reInitialize:!0,sortOrder:m,hashDeffObj:t.mlDefObj};t.retainPreview&&(o.retainPreview=!0),zmInit.foldView(o),ZMail.topbar.header.renovate()}else t.mlDefObj&&t.mlDefObj.resolve()},getViewBasedMsgList:function(e,t,i,a){var l=[],n=zmUtil.getMLConversionValue();return e&&(t||(t=zmInit.getListingDetObj()),t.fId!==zmail.folId.sId&&t.fId!==zmail.folId.tId&&t.fId!==zmail.folId.spId||(n=0),1===n?l=zmList.getMailSummaryList(t,e,!1,a):0!==n&&(l=zmList.getListForAllMailsView(t,e,!1,a))),zmail.convSortOrder&&i?l.reverse():l},setScrollUnreadView:function(e,t){var i=e.find("#"+t);$.e(i).length&&$(e).length&&e.scrollTop($(e).scrollTop()+$.e(i).offset().top-$(e).offset().top)},isMailListedInApp:function(e){var t=zmUtil.getFolId();return-1!==(zmUtil.getListMap(t,"MO")||[]).indexOf(e)},isMailListedInSearch:function(e){if(window.zmSearchUtil&&zmSearchUtil.isWorkspaceAvailable()&&-1!==zmSearchUtil.getSearchList().indexOf(e))return!0;return!1},setMailSelection:function(e,t,i){var a,l,n,s,r,m=!1;if(n=Boolean(zmUtil.getMailObj(e,"TH")),zmsuite.getWorkSpace(zmTab.currentTab)[1]&&(l=zmsuite.getWorkSpace(zmTab.currentTab)[1].$el),a=n&&"lt"===t?i.find("#t"+e):i.find("#"+e),!(s=Boolean(a&&a.length&&a.is(":visible")))&&l&&l.attr("data-mid")&&(a=i.find("#"+l.attr("data-mid"))),a&&a.length&&(s&&a.is(":visible")?(i.find("div."+N.mRow).removeClass(N.sel),a.addClass(N.sel)):a.parent().hasClass(N.thdChild)&&(i.find("div."+N.mRow).removeClass(N.sel),a.parent().prev().addClass(N.sel))),s&&l)l.attr("data-mid",e),n&&!a.hasClass(N.focus)&&"lt"!==t&&p.setFocus("Mouse","c"+e),"content"===t&&n&&l.hasClass("tmail")&&l.attr("data-ty","th"),"lt"===t&&l.attr("data-ty","lt"),zmList.doThreadPath(a,"add"),m=!0;else if(a&&a.length&&a.parent().hasClass(N.thdChild)&&l){var o=a.parent().prev().attr("id");o="t"===o.charAt(0)?o.substr(1):o,l.attr("data-mid",o),l.attr("data-ty","lt"),zmList.doThreadPath(a,"remove"),m=!0}m&&"zmStreamsApp"!==zmTab.currentTab&&"zm_srch1"!==zmTab.currentTab&&(t="content"===t?"th":t,r=zmList.getListingElemObj({msgId:e,type:t,opentype:4===zmail.mailOpt.isPopup?4:0}),"lt"===t&&zmUtil.getMailObj(e,"TH")&&-1===e.indexOf("t")&&(e="t"+e),zmPrev.PvNt(e,t,0,zmTab.currentTab,r))},clearcpvReq:function(){P=void 0},changeListingView:function(t,i){if(i||(i=zmUtil.getFolId()),zmUtil.hasFolSpecConversation(i)&&zmUtil.getMLConversionValue()!==t){var e,a=function(e){"success"===e.status&&(zmfolAction.updateCV(i,t),zmList.updateSortProperties(0),zmList.showMailListing())},l=function(e){var t=e.msg;t&&_zm.succErrMsg("e",t)};_zm.isOfflineSyncActive()?a({status:"success"}):(e={accId:zmail.accId,mode:"updateConversationView",folId:i,convView:t},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:a,onerror:l,p:e}))}},setListingType:function(t,e){var i={accId:zmail.accId,folderSpec:t,mode:"setlisttype"},a=function(e){"success"===e.result&&(zmUtil.resetCollection(),zmUtil.resetListMap(),zmail.folviewThread=t,zmUtil.closeMailTabs(),zmfolAction.updateFoldersCV(t),zmList.updateSortProperties(0),zmList.showMailListing())};if(!e)return zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:a,p:i});a({result:"success"})},setConversationOrder:function(e){e=Number(e);var t={accId:zmail.accId,isAscending:e,mode:"setsortorder"};return zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:function(e){"success"!==e.result&&_zm.succErrMsg("e",C.global.errmsg)},p:t}).then(function(){zmUtil.succErrMsg("s",k.common.succConvSortorder,{hideAfter:3e3}),zmail.convSortOrder=e})},updateSortProperties:function(e,t){t=t||zmUtil.getFolId(),zmfolAction.updateFolSortType(t,e);var i=zmList.getListObj(t);return i&&(i.sortOrder=e),!0},changeListingSortOrder:function(e,t){t=t||zmUtil.getFolId(),zmList.updateSortProperties(e,t),zmList.showMailListing({fId:zmail.mailLeft.selId},{retainPreview:!1,sortAscending:e})},showBulkActionBand:function(e){var t=!1,i=zmUtil.getFolId();if(!zmUtil.isSharedFolder(i)&&!ZMail.utils.isROMode()){"zm_Container"===zmTab.currentTab?t=zmUtil.getListMap(i,"showNextPage"):"zm_srch1"===zmTab.currentTab&&(t=zmSearchUtil.hasNextPage());var a,l,n=zmUtil.getCheckedMailCount();if(n)if(300<n)a=zmText.applyArgs(F.bulkaction.common.selexceed,{n:300}),l="clearAndSelect",zmInit.listingBand.createBulkActionBand(a,l);else if(t&&10<=n){a=zmText.applyArgs(k.common.multiplemail,{count:n}),l="selectFolder";var s=zmInit.getListingDetObj();"zm_Container"===zmTab.currentTab&&""===s.view&&""===s.flag&&""===s.label&&""===s.attach&&"selFilter"!==e&&(l="selectFolderViewAll"),zmInit.listingBand.createBulkActionBand(a,l)}else zmInit.listingBand.removeBulkActionBand();else zmInit.listingBand.removeBulkActionBand()}},showThreadTree:function(){var e,t,i=zmTab.currentTab;if("zm_Container"===i&&!(t=zmPrev.isPrevOpen()&&!zmUtil.getCheckedMailCount()?zmPrev.prevDetails().msgId:p.getCurrentFocusedMsgId()).includes("c")&&zmUtil.getMailObj(t).TC){var a=(e=zmList.getListingElemObj({msgId:t,type:"lt",tabId:i,opentype:4===zmail.mailOpt.isPopup?4:0})).rowElem||[];a.length&&a.hasClass(N.thdTreeLine)||(zmList.hideThreadTree(),zmList.showHideThread({srcElem:a,elemObj:e}))}},hideThreadTree:function(){var e,t=zmTab.currentTab;if("zm_Container"===t||"zm_srch1"===t){e=b(t),I(e),h(e);var i=zmCenterListing.mailObjectAPI.getCurrentFocusedMsgId();if(i.includes("c")){i=i.substr(1);var a=zmCenterListing.mailObjectAPI.getViewParentOf(i);zmCenterListing.mailObjectAPI.setFocus("Mouse",a.id)}}},addTaskIndicator:function(e){var t,i,a,l,n,s=["zm_Container","zm_srch1"],r=s.length;if(e.data.tasks.email&&e.data.tasks.email.msgid){t=e.data.tasks.email.msgid;var m=zmList.getMailObj(t);for(m&&zmUtil.updateMailData("MA",32|m.MA,t),l=0;l<r;l++)n=s[l],zmsuite.isWorkspaceAvailable(n)&&(a=(i=zmCenterListing.mailObjectAPI.getViewObject(t,n))?i.$element:zmsuite.getCenter(n)[0].getNodes()[2].$el.find("#"+t)).length&&!a.find("."+N.associate).length&&zmList.addAssociateIndication(a);zmPreviewTemplate.updateTaskComponent(t)}},addNoteIndicator:function(e){var t,i,a,l,n,s=["zm_Container","zm_srch1"],r=s.length;if(e.email&&e.email.accid&&e.email.msgid){t=e.email.msgid;var m=zmList.getMailObj(t);for(m&&zmUtil.updateMailData("MA",64|m.MA,t),l=0;l<r;l++)n=s[l],zmsuite.isWorkspaceAvailable(n)&&(a=(i=zmCenterListing.mailObjectAPI.getViewObject(t,n))?i.$element:zmsuite.getCenter(n)[0].getNodes()[2].$el.find("#"+t)).length&&!a.find("."+N.associate).length&&zmList.addAssociateIndication(a);zmPreviewTemplate.updateNoteComponent(t)}},getSelectedRowCount:function(){var e=zmUtil.getCheckedMailList();return e[0].length+e[1].length},sortOrder:function(e){if(e=e||zmUtil.getFolId(),zmUtil.isFolderId(e))return 1===zmfolAction.getSortProperties(e).type;var t=zmUtil.getListMap(e);return t?1===t.sortOrder:zmail.sortOrder},markupSummary:function(e){try{var t,i=e.schemaObj,a=k.markup,l={};return"ORDER"===i.SCATYPE||"PARCELDELIVERY"===i.SCATYPE?(r=i.SCATYPE,o="",(t="ORDER"===r?i.ORDEROBJ:i.PARCLDLVRYOBJ).PRICECURRENCY&&t.PRICE&&(o=" - "+t.PRICECURRENCY+" "+t.PRICE),l.subject=zdom("span",null,(m=t.ITEMDETAILS.length)&&1<m?t.ITEMDETAILS[0].ITEMNAME+zmText.applyArgs(a.moreItems,{count:m-1}):t.ITEMDETAILS[0].ITEMNAME,zdom("font",{className:"SC_red"}," ",o)," - "+a.from+" "+t.MERCHANTNAME),l.summary=zdom("span",{className:N.summary+" SC_ndot"})):"FLIGHTRESERVATION"===i.SCATYPE&&(n=i.FLYTTKTOBJ[0],s=n.DEPARTUREDETAILS.AIRPORTCODE+" to "+n.ARRIVALDETAILS.AIRPORTCODE,l.subject=zdom("span",null,n.AIRLINENAME+" - ",zdom("font",{className:"SC_red"},s+" ")),l.summary=zdom("span",{className:N.summary+" SC_ndot"}," - "+n.DEPARTUREDETAILS.DATE+" - "+n.DEPARTUREDETAILS.TIME)),l}catch(e){zmUtil.debugLog(e)}var n,s,r,m,o},flightQAType:function(e){try{var t=k.markup;return[t.checkin,t.modify,t.vTicket][["CHECKINURL","MODIFYRESERVATIONURL","VIEWRESERVATIONURL"].indexOf(e.URLACTTYPE)]}catch(e){zmUtil.debugLog(e)}},resetSelectionInfo:function(e){"zm_Container"===(e=e||zmTab.currentTab)?zmList.selDetails.mListing={}:"zm_srch1"===e&&(zmList.selDetails.sListing={})},updateAttachmentCache:n,isListingChecked:function(e){return!!$(e).find("."+N.chkBox).length},isAllListingChecked:function(e){var t=$(e).children("."+N.mRow);if(0<t.length&&0===t.filter(":not(."+N.chkBox+")").length)return!0;return!1},getDupThdRowId:function(e,t){var i,a="",l=[],n=zmList.getMailObj(e);if(!e||!n)return"";var s=zmList.getListObj(t);if(s?l=s.MO:"search"===t&&(l=zmSearchUtil.getSearchList()),0<(i=l.length)){var r,m,o=n.T;for(r=0;r<i;r++)if(m=zmList.getMailObj(l[r]),l[r]===o||m.TH&&m.T===o){a=l[r];break}}return a},sendMailDataReq:V,showMailPreview:y,loadUnreadMails:function(e,t,i){var a=zmPrev.prevDetails().msgId;if(a){a.indexOf("t")||(a=a.substring(1));var l=zmList.getMailObj(a);if(l&&l.T===e){var n,s,r,m,o,d=[],c=[],f=[];for(i=i||b().viewDetails,s=(n=zmList.getViewBasedMsgList(e,i,!0)).length,m=r=0;r<s&&m<5;r++)(o=zmList.getMailObj(n[r]))&&0===o.S&&(c.push(n[r]),zmContentCache.isCached(n[r])||(d.push(n[r]),o.AR?f.push(!0):f.push(!1)),m++);if(c.length){var z={accId:zmail.accId,summary:!0,mode:"bulk",markread:!0},u={markread:z.markread,msgId:c,thdId:e,opentype:t,viewDet:i};o=zmList.getMailObj(c[0]),z.msgId=d.join(),z.archiveStatus=f.join(),z.folId=o.FD,zmUtil.isSharedFolder(o.FD)&&(z.shId=u.shId=zmUtil.getShareId(o.FD)),d.length?V(z,u,M):M(0,u)}}}},getCachedAttachmentData:T,updateListingView:O,loadAttachviewer:L,getMailObj:function(e){if(e){var t=ZMail.listing.collection.get(e);return t&&t.attributes}},updateModel:function(e,t,i){try{ZMail.listing.collection.get(i).set(e,t)}catch(e){zmUtil.debugLog(e)}},getListObj:function(e,t,i){return ZMail.listing.collection.getListObj(e,t,i)},haveMailRecallSupport:function(e){if(!zmUtil.isZohoAccount(zmail.accId)||-1===zmail.zoid)return!1;var t=zmList.getMailObj(e);return t&&!t.RS&&5===t.MDS},addAssociateIndication:function(e){e.find("."+N.mRowCenter).after(ZMail.lView.constTemplate("associate",{iconCls:N.associate}))},selectEmails:w};return $.subscribe("zmailReconnect",function(){if(window.console.log("Updating Listing View, in respond to zmailReconnect - "+new Date),zmInit.getFolderTreeCount(),zmInit.getAccountInfo(),"zmStreamTree"!==zmail.mailLeft.selLayerId){var e=!0;"zmStreamsApp"===zmTab.currentTab&&(e=!1),zmList.showMailListing({},{retainPreview:!0,mlDefObj:void 0,toSelFol:e})}}),zmail.postJsDeffered.promise.then(function(){zmail.mailAttachments={},zmail.attachmentContainer=new zmail.Container({store:zmail.mailAttachments,containerSize:200,evictCount:20,idName:"id",considerAsHitOnRetrieval:!0})}),e}(),window.zmPrev=function(){var e=zmText.get("mail"),O=e.listing,A=e.preview,u=ZMail.lConstants,p=u.cls,t={prevDetails:function(e){e=e||zmTab.currentTab;var t="",i="";return zmsuite.isWorkspaceAvailable(e)&&zmsuite.getCenter(e)[1]&&(t=zmsuite.getCenter(e)[1].$el.attr("data-mid")||"",i=zmsuite.getCenter(e)[1].$el.attr("data-ty")||""),{msgId:t,type:i}},isPrevOpen:function(e){return e=e||zmTab.currentTab,zmsuite.getCenter(e)[1].$el.hasClass("shw")},posAView:function(e,t){var i=t.find("#zmC"+e+" div.zmPAtt");i.is(":visible")&&i[0].scrollIntoView({behavior:"smooth"})},PvNt:function(e,t,i,a,l){var n,s,r,m,o,d,c;if(n=l.listArr||[],o=zmUtil.getFolId(),e.indexOf("t")||(e=e.substring(1)),n.length&&(s=n[(m=$.inArray(e,n))-1],r=n[m+1]),s||"th"===t&&(zmList.getMailObj(e)||{}).TH&&zmUtil.getListMap(o)&&(d=zmList.getDupThdRowId(e,o))&&(n=zmUtil.getListMap(o,"MO")).length&&(m=n.indexOf(d),s=n[m-1]),r||"th"===t&&(zmList.getMailObj(e)||{}).TH&&zmUtil.getListMap(o)&&(d=zmList.getDupThdRowId(e,o))&&(m=n.indexOf(d),r=n[m+1]),s||r?s?r?ZMail.previewUtil.enableNavigation(a,"both"):ZMail.previewUtil.disableNavigation(a,"next"):ZMail.previewUtil.disableNavigation(a,"prev"):ZMail.previewUtil.disableNavigation(a,"both"),2===i){var f=(c=a,function(){c&&ZMail.previewUtil.disableNavigation(c,"both"),$.unsubscribe("mail/listing/viewchanged",f)});$.subscribe("mail/listing/viewchanged",f)}},cmpClose:function(e){e=e||zmTab.currentTab;var t=$.Deferred();if(zmsuite.getCenter(e)[1]){var i=zmsuite.getCenter(e)[1].getNodes()[1].$el;zmPreviewTemplate.unsubscribeNotesTasks(i);var a=zmPrev.prevDetails(e).msgId,l="",n=zmList.getMailObj(a);if(a&&n&&(l=n.T||"",$.publish("mail/preview/unload",{prevElem:i,msgId:a,thdId:l})),"undefined"!=typeof zmComp){var s=zmsuite.getCenter(e)[1].getNodes()[1].$el,r=[];s.find(".zm_cmp").each(function(){var e=$(this).attr("data-cmpid");e&&r.push(e)}),r.length?zmComp.saveReply({deferObj:t,cmpList:r}):t.resolve(!0)}else t.resolve(!0)}else t.resolve(!0);return t},clsPreview:function(s){var e=s||zmTab.currentTab;"list"===s&&(e="zm_Container"),$.when(zmPrev.cmpClose(e)).then(function(e){if(e){var t,i,a,l,n="zm_srch1"===(s=s||zmTab.currentTab)?"zm_srch1":"zm_Container";s.indexOf("zm_srch")?zmsuite.getCenter("zm_Container")[1].close():zmsuite.getCenter(s)[1].close(),zmPrev.prevDetails(n).msgId&&(-1===s.indexOf("zm_tab")&&(ZMail.topbar.icons.renovate({type:"functional",isForceHide:!0,tabId:n,toHide:!0}),zmUtil.hideMenu()),zmUrlAct.update({from:"zmCenter",remove:!0}),zmRestore.saveState("preview",{p:""},{})),"list"===s?(t=zmPrev.prevDetails("zm_Container").msgId,a=!0,l=zmList.getElemObj("zm_Container")):t=zmPrev.prevDetails().msgId,(l=l||zmList.getElemObj(s)).rowElem=$(l.listElem).find("."+p.sel),$(l.prevElem).attr("data-mid",""),$(l.prevElem).attr("data-ty",""),$(l.prevElem).removeClass("SC_notr"),l.mainElem.removeClass("SC_sw"),zmList.listingFocused=!0,l.rowElem.length&&l.rowElem.removeClass(p.sel),(i="zm_Container"===s||"list"===s?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"))&&"unread"===i.view&&t&&(a||zmList.remReadMail(),(""===i.fId&&0===zmInit.getUnreadViewCount()||""!==i.fId&&!zmUtil.isSharedFolder(i.fId)&&0===zmail.folCount[i.fId].c)&&zmList.setEmptyListing()),l.rowElem.length&&zmList.doThreadPath(l.rowElem,"remove"),zmContentCache.remove(t),$.publish("/mail/previewclosed",{})}})},updatePrevOnDeletion:function(t,i){var e,a,l,n,s;i=i||"zm_Container",t.indexOf("t")||(t=t.substring(1));var r,m=zmList.getMailObj(t)||{};"zm_Container"===i?(l=zmInit.getListingDetObj(),e=zmUtil.getFolId(),r=zmList.getListObj(e),"th"===$(zmail.mailCenter.listElem).find("#"+t).data("ty")?s=zmList.getViewBasedMsgList(m.T,l):r&&(s=r.MO)):"zm_srch1"===i&&(e=(l=zmsuite.getCenterOuter(i).$el.data("data-detail")).view,s="th"===zmsuite.getCenter(i)[0].getNodes()[2].$el.find("#"+t).data("ty")?zmList.getListForAllMailsView(m.T,l):zmSearchUtil.getSearchList()),-1!==(a=$.inArray(t,s))&&((n=s[a+1])||(n=s[a-1])),n&&i===zmTab.currentTab?(zmList.getMailObj(n).TH&&0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==i&&(n="t"+n),$.when(zmPrev.cmpClose(i)).then(function(e){e&&(zmContentCache.remove(t),zmList.getMailData({msgId:n,type:"lt",opentype:4===zmail.mailOpt.isPopup?4:0,tabId:i}))})):zmPrev.clsPreview(i)},setCountinPreview:function(e){var t,i,a,l,n=zmPrev.prevDetails().msgId;e.rowElem&&e.rowElem.length||($.q("#"+n).length?e.rowElem=$.e(e.listElem).find("#"+n):e.rowElem=$.e(e.listElem).find("#t"+n));var s,r,m=e.rowElem;if(m.removeClass(p.sel),(t=$.e(e.prevElem)).find(".SC_Popn").length&&t.find(".SC_Popn").remove(),r=1===(i=zmUtil.getCheckedMailCount())?O.common.singlemail:zmText.applyArgs(O.common.multiplemail,{count:i}),a=$.e(zdom("div",{className:"SC_pct SC_Popn"},r)),l=e.mainElem.height()-55,a.height(l),(s=t.find(".SC_frt").eq(0).find("ul")).eq(0).hide(),s.eq(1).hide(),s.eq(2).hide(),t.find(".SC_pct").hide(),t.find(".zm_shwconv").parent().hide(),t.find(".SCS_postWra").hide(),t.find(".zms_fixed").length){t.find(".zms_fixed").hide();var o=t.find(".SC_Twpr"),d=String(o.css("bottom"));"0px"!==d&&(o.data("bottom",d),o.css("bottom","0px"))}zmsuite.getCenter(zmTab.currentTab)[1].getNodes()[1].$el.append(a),t.find(".SC_phd").hide(),t.find(".zmQry").hide(),zmList.doThreadPath(m,"remove")},removeCountinPreview:function(e,t){var i,a,l,n=$(e.prevElem);if(a=(i=zmPrev.prevDetails()).msgId,0<(l=zmUtil.getCheckedMailCount()))if(1===l)n.find(".SC_Popn").text(O.common.singlemail);else{var s=O.common.multiplemail,r=zmText.applyArgs(s,{count:l});n.find(".SC_Popn").text(r)}else{if(n.find(".SC_Popn").remove(),n.find(".SC_pct").show(),n.find(".zm_shwconv").parent().show(),n.find(".SCS_postWra").show(),n.find(".zms_fixed").length&&!zmUtil.hideCommentBox()){n.find(".zms_fixed").show();var m=n.find(".SC_Twpr");m.css("bottom",m.data("bottom"))}var o;if(n.find(".SC_frt").eq(0).find("ul").show(),a)4===t||e.mainElem.hasClass("SC_swB")||n.find(".SC_phd").show(),o="zm_srch1"===zmTab.currentTab?0:zmUtil.getMLConversionValue(),"lt"===i.type&&1===zmList.getMailObj(a).TH&&0!==o?e.rowElem=$(e.listElem).find("#t"+a):e.rowElem=$(e.listElem).find("#"+a),e.rowElem.addClass(p.sel)}},toggleMailContentViewMode:function(e,t,i){var a,l,n,s=$(e),r=s.attr("data-mid"),m=s.attr("id"),o=s.next(),d=!1;i=i||zmTab.currentTab,m.indexOf("zmHdrT")||(t=2),l=3===t?((a={contElem:$(e).closest(".SC_pct"),hdrElem:$(e),viewDetails:{view:"notification"}}).prevElem=a.contElem.parent(),[]):(a=zmList.getElemObj(i)).listElem,zmList.setMailSelection(r,"content",$(l));var c=zmList.getMailObj(r);if(0===t){var f=zmsuite.getWorkSpace(i)[1].$el.find(".SC_ptit").find(".SC_phd"),z=zmPreviewTemplate.getSubjectToPreview(c.SB);f.text(z),!c.TH||(0!==zmUtil.getMLConversionValue()&&zmail.mailLeft.selId!==zmail.folId.sId||"zm_Container"!==zmTab.currentTab)&&"zm_srch1"!==zmTab.currentTab||f.appendDOM(zdom("i",{className:"msi-thread","data-event":"viewfullthd","data-from":"header"})),zmPrev.removeCountinPreview(a,t),zmPreviewTemplate.setPreviewHeaderHeight(a,i)}else 4===t&&(zmPrev.removeCountinPreview(a,t),zmPreviewTemplate.setPreviewHeaderHeight(a,i,t));0===o.length&&(d=!0,c.FD!==zmail.folId.dId&&(n=$.e(zdom("div",{id:"zmCon"+m.substr(5)})),setTimeout(function(){n.children().length||zmComponent.loadingBand({container:n[0],type:"pagination"})},100),s.after(n)),zmList.getMailData({msgId:r,type:"content",from:s,opentype:t,tabId:i},a)),c.T&&!$("t"+r).length&&$(l).find("."+u.cls.mRow).removeClass(p.chkBox),d||zmPreviewTemplate.applyHeaderState(s),0!==t&&4!==t||!s.parent().hasClass("js-scrolltop")||zmPreviewTemplate.alignMailTopToPreview(String(r)),3!==t&&ZMail.topbar.icons.renovate({type:"functional",msgId:zmUtil.getSelectedMails()[0][0],tabId:zmTab.currentTab})},setMailDOMContent:function(e,t){var i,a=zmPreviewTemplate.getTemplate("content",{data:e,prms:t});if(a=$(a),zmUtil.addSelectMenu({applyDOM:[a.find(".jsConTent")[0]]}),e.NEWATT&&e.NEWATT.length){var l=t.shId?0:1;i=zmAttach.build({appName:"mail",attList:e.NEWATT,zipType:"downloadall",showMOpt:!0,showTag:l,supportDrag:!0,attClass:"zmAch",attListClass:"zmPAtt",fileNameLen:23,entityInfo:{id:t.msgId},showToggleOpt:!0})}i&&(0===zmail.userOptions.showAttachment?a.find(".zmPCnt").after(i):a.find(".jsContentpart").prependDOM(i));var n,s,r,m=t.opentype,o=t.msgId,d=t.tabId||zmTab.currentTab;"content"===t.type?(n=$(t.from),(s=$(n.next())).html(""),s.append($(a).children().eq(1).children()),a=s,zmPreviewTemplate.applyHeaderState(n),"bulk_mail"!==t.load_action&&n.closest(".SC_pct").addClass("SC_Tfcs"),0!==m&&4!==m||(zmPrev.removeCountinPreview(zmList.getElemObj(d),m),n.parent().hasClass("js-scrolltop")&&zmPreviewTemplate.alignMailTopToPreview(String(o)))):(r=a,t.parentElm?$(t.parentElm).append($(r)):zmsuite.getCenter(d)[1].getNodes()[1].push($(r)));var c=zmList.getMailObj(o);3!==m&&c&&!zmUtil.isSharedFolder(c.FD)&&(t.mailContElem=$(a),zmAppLoader.load("listingEventHandlers").then(function(){zmPreviewTemplate.showNotes(t),zmPreviewTemplate.showTasks(t),zmPreviewTemplate.showEvents(t),zmPreviewTemplate.showProjectsEntities(t)}),t.streamsMail||ZMail.previewUtil.loadQuarantineMarkup({contentAttrs:e,targetElem:a.find(".zmPCnt")}))},changeFlag:function(e,t){var i=t.flag;zmPrev.flagMail(e,i),zmUtil.hideMenu()},flagMail:function(e,t){var i,a={};i=e.parents(".zmPHdr").attr("data-mid"),a.msgId=[i],a.thd=[],a.fVal=t,zmmailAct.applyActions("flag","click",a)},getHeader:function(e){return zmPreviewTemplate.getTemplate("header",e)},updatePvNtforNewMails:function(){if(zmsuite.isWorkspaceAvailable("zm_Container")&&$(zmail.mailCenter.prevElem).hasClass("shw")){var e,t,i=zmPrev.prevDetails("zm_Container").msgId,a=zmUtil.getFolId();e=0<$("#"+i).length?i:"t"+i,(t=zmList.getElemObj("zm_Container")).rowElem=$("#"+e),t.listArr=zmUtil.getListMap(a,"MO")||[],zmPrev.PvNt(e,"lt",0,"zm_Container",t)}},show:function(e,i,t){var a,l,n={};a=$.e(i).closest(".SC_pct").find(".zmPHdr").attr("data-mid");var s=[],r=zmList.getMailObj(a),m=r.FD,o=zmUtil.isSharedFolder(m);if(l="zm_Container"!==zmTab.currentTab&&(r.streams||zmPreviewTemplate.isMailOpenedViaStreams(i)),zmail.folId.dId===m)s=[{txt:A.contextmenu.editdraft,data:{action:"editdraft",msgId:a}},{txt:A.contextmenu.discarddraft,data:{action:"delete",msgId:a}}];else if(l)s=(s=s.concat([{txt:A.contextmenu.editasnew,data:{action:"editasnew",msgId:a}},{sep:!0},{htm:zdom("fragment",null," ",zdom("i",{className:"msi-larrow"})," ",A.contextmenu.save," "),data:{action:"save",msgId:a},child:function(){return zmPreviewTemplate.getSaveSubMenus(a)}},{txt:A.contextmenu.print,data:{action:"print",msgId:a}},{txt:A.contextmenu.showorg,data:{action:"original",msgId:a}},{txt:A.contextmenu.garbledmsg,data:{action:"garbled",msgId:a}}])).concat(zmStreamsApp.util.getDropdownMenu(a,"1"));else{var d=ZMail.utils.isROMode();if(r&&m&&!d&&m!==zmail.folId.sId&&!zmUtil.isSharedFolder(m,"R")){var c=r.S?"markunread":"markread",f=r.S?O.maillistopt.markunread:O.maillistopt.markread;s=s.concat([{txt:f,data:{action:c,msgId:a}},{sep:!0}])}var z={allowed:void 0};if($.publish("/mail/collab/share/status",{mailID:a,config:z,container:t?t.containerDOM:""}),!d)if(!0!==z.allowed||o||zmfolAction.isMutualFolder(ZMail.utils.currentMailListingInfo().fId))(o||zmfolAction.isMutualFolder(m)||zmfolAction.isMutualFolder(ZMail.utils.currentMailListingInfo().fId))&&s.push({txt:A.contextmenu.comment,data:{action:"focusComment",from:"preview",msgId:a}});else{var u="",p="";p=z.entityExists?z.isConvo?(u=z.sharedText,"updateConvo"):(u=A.contextmenu.comment,"share"):(u=r.TH?A.contextmenu.sharethd:A.contextmenu.share,"share"),s.push({txt:u,data:{action:p,from:"preview",msgId:a}})}var g=A.contextmenu.reminder;zmList.isRMOBJ(a)&&(g=A.contextmenu.updrem),zmUtil.isSharedFolder(m,"R")||zmail.isROMode||(s=s.concat([{txt:A.contextmenu.editasnew,data:{action:"editasnew",msgId:a}},{sep:!0}])),!zmUtil.isZohoAccount(zmail.accId)||d||o||(s=s.concat([{txt:g,data:{action:"addtowatch",msgId:a}},{sep:!0}]));var h={txt:A.contextmenu.print,data:{action:"print",msgId:a}};s=d?s.concat([h]):s.concat([{htm:zdom("fragment",null,zdom("i",{className:"msi-larrow"}),A.contextmenu.addto),data:{action:"addtolist",dropMenudirection:"left"},child:function(){return zmPreviewTemplate.getAddToMenu(a)}},{sep:!0},{htm:zdom("fragment",null," ",zdom("i",{className:"msi-larrow"})," ",A.contextmenu.save," "),data:{action:"save",msgId:a},child:function(){return zmPreviewTemplate.getSaveSubMenus(a)}},h,{txt:A.contextmenu.showorg,data:{action:"original",msgId:a}},{txt:A.contextmenu.garbledmsg,data:{action:"garbled",msgId:a}}]);var I=ZMail.utils.isCurrentUserEmailId(r.F);if(r&&!o&&!d&&!I){if(m===zmail.folId.spId)s.push({sep:!0}),s.push({txt:O.maillistopt.notspam,data:{action:"marknotspam",msgId:a}});else r.AR||(s.push({sep:!0}),s.push({txt:O.maillistopt.markspam,data:{action:"markspam",msgId:a}}));if(zmail.showFeature){var v=zmfolAction.isSystemFolder({folType:"outgoing",folId:m}),b=zmail.accId!==zmail.defAccId;if(!v&&!b){var T=zmText.applyArgs(A.contextmenu.blockSender,{emailId:'"'+r.F+'"'});s.push({txt:T,data:{action:"blockSender",msgId:a}})}}}if(!d&&!I&&zmUtil.isZohoAccount(zmail.accId)&&!o){var C=zmContentCache.get(a,"SPAMDATA")||{},M=C.IS_PHISHING_MARKED||C.PHM,S=(C.ALERT_EMAILLIST||C.AEL||[]).length;!M&&S&&s.push({txt:O.maillistopt.reportPhising,data:{action:"reportPhising",msgId:a,spamInfo:C}})}o||d||(s=s.concat([{sep:!0},{htm:O.contextmenu.delete,data:{action:"delete",msgId:a}}]))}var w=[{txt:A.attachmentmenu.downloadaszip,data:{action:"downloadall",msgId:a}}];n.align="pright",n.clk=function(e,t){zmPrev.bindAction(e,t,{sourceDOM:$(i).closest("li")})},"zm_dldLst"===e?(n.list=w,n.par=$.e(i).closest("li")):"zm_preaLst"===e&&(n.list=s,n.par=$.e(i).closest("li")),n.paddingOffset=5;var L=zmsuite.showMenu(n);"bottom"===_zm.getProperty(L,"dropObj.mountPosition")?$(i).closest("b").addClass("SC_ddnB"):$(i).closest("b").addClass("SC_ddn")},isEntityOpenedInPreview:function(e,t){var i=zmList.getMailObj(e);if(!i)return!1;t=t||"zm_Container";var a=zmPrev.prevDetails(t).msgId;if(e===a)return!0;if(i.TH){var l=i.T,n=zmList.getListObj(l);return l&&a&&n&&-1!==n.MO.indexOf(e)}return!1},bindAction:function(e,t,i){i=i||{};var a=e.action,l=e.msgId,n={};l||(l=$(t).closest(".SC_pct").find(".zmPHdr").attr("data-mid")),"view"!==a&&zmUtil.hideMenu();var s=zmList.getMailObj(l);switch(s&&s.streams&&(n.groupId=s.groupId,n.streamsView=!0),a){case"editasnew":ZMail.utils.loadComposer({parentId:l,composeAction:"eanew"});break;case"save":ZMail.previewUtil.downloadAsHTML({msgId:l});break;case"print":zmPreviewTemplate.printMsg({mId:l});break;case"original":zmPreviewTemplate.showOrgMsg({mId:l});break;case"garbled":zmPreviewTemplate.garbMsg({mId:l});break;case"delete":zmList.bindAction({action:"delete"});break;case"markunread":zmmailAct.applyActions("unread","dropdown",{thd:[],msgId:[l]});break;case"markread":zmmailAct.applyActions("read","dropdown",{thd:[],msgId:[l]});break;case"markspam":zmmailAct.doActions("spam","dropdown",{thd:[],msgId:[l]});break;case"marknotspam":zmmailAct.doActions("notspam","dropdown",{thd:[],msgId:[l]});break;case"reportPhising":ZMail.previewUtil.reportPhising(l,e.spamInfo);break;case"editdraft":ZMail.utils.loadComposer({parentId:l,composeAction:"draft"});break;case"addtotasks":ZMail.utils.loadTask(l);break;case"addtowatch":zmWatch.showWatch({msgId:l,elem:t,openWatch:"preview_dropdown",loadType:"popup"}),_zm.stopEvents();break;case"addtonotes":ZMail.utils.loadNote(l);break;case"addtoevents":zmUtil.hideMenu(),zmUtil.loadEvents(function(){zmail.eventInteg.util.addEvent(l)});break;case"share":var r=$(i.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent();$.publish("/mail/view/focuscommentbox",{mailID:l,containerDOM:$(r)[0]});break;case"updateConvo":var m=$(i.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent();$.publish("/mail/preview/updateshare",{mailID:l,containerDOM:$(m)[0],elm:$(i.sourceDOM).parents(".zmPHdr").find(".js-shareicon")[0]});break;case"focusComment":$(i.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent().find(".SCS_postWra").find(".zmCmntFixed").find("textArea").focus();break;case"addfilter":zmPreviewTemplate.createNewFilter(e);break;case"viewfullthd":zmList.getMailData({msgId:l,type:"lt",opentype:2,src:"conversation"});break;case"copylink":case"watch":case"streamsdelete":case"archive":case"streamsTimeline":e.fn&&e.fn();break;case"addsmartfilter":zmPreviewTemplate.classifySmartFilter(l,e.filtervalue,!0,$(t).closest(".SC_pct"));break;case"addtoprojects":zmUtil.loadProjects(function(){zmail.projectsInteg.util.addTaskBugFromMail(l),zmUtil.hideMenu()});break;case"blockSender":ZMail.previewUtil.blockSender({msgId:l})}},updateListOnNavigation:function(e,t){try{var i,a,l=!0;t=t||zmInit.getListingDetObj(),-1!==e.indexOf("t")?(i=e.substring(1,e.length),a=zmList.getMailObj(i),0===zmList.getMailSummaryList(t,a.T).length&&(l=!1)):(i=e,a=zmList.getMailObj(i),l=!1),("unread"===t.view&&1===a.S||t.flag&&("-1"===t.flag&&0===a.NFG||"-1"!==t.flag&&a.NFG!==t.flag))&&(l||zmList.remReadMail(),zmList.setEmptyListing())}catch(e){zmUtil.debugLog(e)}}};return zmail.postJsDeffered.promise.then(function(){zmail.prevMails={},zmail.mailContainer=new zmail.Container({store:zmail.prevMails,containerSize:100,evictCount:25,idName:"id",isObjectInUse:zmUtil.isMailContentInUse,considerAsHitOnRetrieval:!1})}),t}(),window.zmDragger=function(){var l={},e=zmText.get("mail").listing.common.dropMsg;l.currPos=0,l.newPos=0,l.updatePos=_.throttle(function(e,t){var i,a;t=t[0],l.currPos?l.newPos=e.getBoundingClientRect().top:l.currPos=l.newPos=e.getBoundingClientRect().top,l.newPos<0||(i=l.newPos-l.currPos,a=t.scrollTop+i,a=Math.min(a,t.scrollHeight),t.scrollTop=a)},100),l.reset=function(){l.currPos=0,l.newPos=0};var a=function(e,t){var i={};if(1<e.length)(i=zmUtil.getSelectedMails(t)).mIds=i[0],i.tIds=i[1];else{var a=e&&e[0].id;i="t"===a.charAt(0)?{mIds:[],tIds:[a=a.substring(1)]}:{mIds:[a],tIds:[]}}return i};return{updateScroll:l.updatePos,resetScrollPos:l.reset,hoverOnTabs:function(e,t){try{var i;if(i=e.closest("li")){var a;i.hasClass("cantClose")?a=i.index():i.parents(".secContainer").length&&(a=i.index()+1);var l=zmTab.tabArr[a]&&zmTab.tabArr[a].appId,n="mail"!==t&&!l.indexOf("zmStreamsApp"),s=("zm_Container"===l||!l.indexOf("zm_tab")||!l.indexOf("zm_srch"))&&zmsuite.getCenter(l)[1].$el.find(".SC_drag").length;(!l.indexOf("Cmp")||n||s||!l.indexOf("SComp")&&"mail"!==t)&&(zmsuite.showExistingApp(l),zmUtil.hideMenu())}}catch(e){zmUtil.debugLog(e)}},dropOnCompose:function(e,t,i){zmComp.dropCmpFwdMe({msgList:a(e,t),maskElem:i})},getDropMailData:a,getDropMessage:function(){return e}}}(),window.zmmailAct=function(){var B,V,e=zmText.get("mail"),m=e.listing,T=e.actions,s=e.preview,G=e.listing.common.deleteOutBox,Z={},w={},W=zmail.folviewThread,o=ZMail.lConstants,L=o.cls;V=["read","unread","flag","label","move","delete","archive","unarchive","spam","notspam","folderread","sweep"];var l,g="mail/updateRead",q="folder/archived",O="mail/listing/viewchanged",Y=function(e,t,i){var a={url:zmail.conPath+"/mA.do",t:"POST",fn:i,p:e,csr:"s",ep:t};_zm.isOfflineLockAvailable()||(a.setSessionId=t.suppressWSNoti),ZMail.listing.collection.doMailAction(a)},h=function(e,t){e="thd"===t?"zm_tabt"+zmUtil.getMailObj(e,"T"):"zm_tab"+e,zmsuite.isWorkspaceAvailable(e)&&(zmsuite.closeWorkspace(e),zmsuite.showExistingApp(zmTab.currentTab))},A=function(e){zmCache.updateObj(e)},I=function(e,t){void 0!==zmUtil.getMailObj(e,"TS")&&(A({mode:"upd",msgId:e,key:"TS",val:t}),$.publish(g,{msgId:e}))},v=function(e,t,i){var a,l,n,s;if(n=zmUtil.getMailObj(e))switch(l=n.T,(a=$.extend({},Z)).label="",a.attach="",a.flag=t,2!==W&&a.fId===zmail.folId.spId||(a.fId=""),s=zmList.getMailSummaryList(a,l).length,i){case"0":1===s&&("1"===t?n.TI=!1:"2"===t?n.TM=!1:"3"===t&&(n.TF=!1));break;case"1":n.TI=!0,1===s&&("2"===t?n.TM=!1:"3"===t&&(n.TF=!1));break;case"2":n.TM=!0,1===s&&("1"===t?n.TI=!1:"3"===t&&(n.TF=!1));break;case"3":n.TF=!0,1===s&&("1"===t?n.TI=!1:"2"===t&&(n.TM=!1))}},b=function(e,t){var i=zmUtil.getMailObj(e);if(i)switch(A({mode:"upd",msgId:e,key:"NFG",val:t}),t){case"0":i.TI=!1,i.TF=!1,i.TM=!1;break;case"1":i.TI=!0,i.TF=!1,i.TM=!1;break;case"2":i.TI=!1,i.TF=!1,i.TM=!0;break;case"3":i.TI=!1,i.TF=!0,i.TM=!1}},y=function(e,t,i){var a=zmUtil.getMailObj(e);if(a){a.TTAGS=a.TTAGS||[];var l,n,s,r=[],m=a.TTAGS,o=a.T;switch(i){case"add":for(l=0;l<t.length;l++)-1===m.indexOf(t[l])&&a.TTAGS.push(t[l]);break;case"delete":for(l=0;l<t.length;l++)n=m.indexOf(t[l]),s=$.extend({},Z),2!==W&&s.fId===zmail.folId.spId||(s.fId=""),s.label=t[l],r=zmList.getMailSummaryList(s,o),-1!==n&&r.length<=1&&m.splice(n,1);break;case"deleteall":a.TTAGS=[]}}},C=function(e,t,i){var a=[];return zmUtil.getListMap(t)?a=zmList.getViewBasedMsgList(t,i):a.push(e),a},M=function(e,t){var i,a,l,n=[],s=zmUtil.getMailObj(e),r=s.FD;if("msg"===t)A({mode:"upd",msgId:e,key:"AR",val:0}),s.S||ZMail.utils.updateCount({fId:r,mode:"inc"});else if("thd"===t)for(l=s.T,a=(n=C(e,l,Z)).length,i=0;i<a;i++)A({mode:"upd",msgId:n[i],key:"AR",val:0});Z.fId&&"archive"===Z.view&&zmCache.updateCacheForViews(e)},D=function(e,t){var i=zmCenterListing.mailObjectAPI.getViewObject(e,"zm_Container");i=i&&i.$element;var a=e,l=zmUtil.getMailObj(e);if(t=t||"zm_Container",zmTab.currentTab.indexOf("zm_tabt"))if(l&&zmUtil.getListMap(l.T)){var n=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a,t);n&&(i=n.$element)}else(a=zmList.getDupThdRowId(e,zmUtil.getFolId()))&&(i=$(zmail.mailCenter.listElem).find("#t"+a));else a=zmsuite.getCenterOuter().$el.data("row-detail").rowId,i=$(zmail.mailCenter.listElem).find("#"+a);return i},S=function(e,t){zmail.folCount[Z.fId]&&zmUtil.getMailObj(e,"TH")&&(Z.fId!==t?($("#zmHdrP"+e).parent().addClass("SC_Tfdr"),$("#zmHdrT"+e).parent().addClass("SC_Tfdr")):($("#zmHdrP"+e).parent().removeClass("SC_Tfdr"),$("#zmHdrT"+e).parent().removeClass("SC_Tfdr")))},E=function(e,t){var i=zmInit.findFolName(t),a="";a=zmUtil.getMailObj(e,"AR")?i+" ("+s.contentOptions.archived+")":i;var l="zm_folname";$.e(zmail.mailCenter.listElem).find("#"+e+" ."+L.folName).text(i),$.q("#zmHdrP"+e+" ."+l).text(a),$.q("#zmHdrT"+e+" ."+l).text(a),$.q("#zmHdrS"+e+" ."+l).text(a);var n=$.e(zmail.mailCenter.listElem).find("#t"+e);n.length&&n.find("."+L.folName).text(i)},U=function(e){var t=!1,i=zmUtil.getMailObj(e);return Z.fId&&!Z.flag&&!Z.label||"all"===Z.view?t=!0:0!==i.NFG&&Z.flag?"-1"!==Z.flag&&Z.flag!==i.NFG||(t=!0):i.TAG&&Z.label&&("-1"===Z.label||"-1"!==$.iArray(Z.label,i.TAG))&&(t=!0),t},u=function(e,t){e.length<99?t.text(e.length+1):t.text("99+")},p=function(e,t){1!==e.length&&(e.length<=100?t.text(e.length-1):t.text("99+"))},x=function(e){var t=e.parent("."+L.thdChild);t.prev().find("."+L.thdTreeCircle).remove(),t.prev().removeClass(L.thdTreeLine),t.remove()},j=function(){var e="";return e+=zmInit.isFlex?"":zdom("div",{className:"zm_td"},zdom("div",{className:"zm_tlb"})).outerHTML},F=function(e,t,i){var a,l=U(e),n=$("#"+e),s=zmUtil.getMailObj(e),r=zmList.getViewBasedMsgList(s.T,Z);if("zm_Container"!==zmTab.currentTab){if(1<r.length&&l){var m=$("#"+r[0]);a=m.parent().prev().find("."+L.tc),Z.fId===t?u(r,a):Z.fId===i&&(p(r,a),"1"===a.text()&&x(m))}else if(1===r.length)if(Z.fId===s.FD){zmPrev.clsPreview(),$("#t"+r[0]).remove(),h("t"+s.T);var o=zmUtil.getListMap(Z.fId);if(o)for(var d in o)o[d]===Z.fId&&o.MO.splice(d,1)}else l&&((a=$("#t"+r[0]).find("."+L.tc)).text(parseInt(a.text())+1),"2"===a.text()&&a.before(j()));n.remove()}else if(n.length&&l){a=n.parent().prev().find("."+L.tc);var c;p(r,a),1===(c=parseInt(a.text()))?x(n):c<1&&(n.parent().prev().remove(),n.parent().remove(),$(w.prevElem).hasClass("shw")&&s.T===zmUtil.getMailObj(zmPrev.prevDetails().msgId,"T")&&zmPrev.clsPreview()),n.remove()}else if(zmPrev.prevDetails().msgId&&s.T===zmUtil.getMailObj(zmPrev.prevDetails().msgId,"T"))if(a=$(zmail.mailCenter.listElem).find("."+L.sel+" ."+L.tc),1<r.length&&l)Z.fId===t?u(r,a):Z.fId===i&&p(r,a);else if(r.length<=1)if(Z.fId===s.FD){$(zmail.mailCenter.listElem).find("."+L.sel).remove(),zmPrev.clsPreview(),h("t"+s.T);var f=zmUtil.getListMap(Z.fId);if(f)for(var z in f)f[z]===Z.fId&&f.MO.splice(z,1)}else l&&(a.text(parseInt(a.text())+1),"2"===a.text()&&a.before(j()))},_=function(e,t){var i=e&&$("#"+e),a=e,l=(i.parent("."+L.thdChild),zmUtil.getMailObj(e));if("msg"===t&&l.T&&zmInit.checkThreadRead(l.T)&&(i=D(e)).length){0===(a=i[0].id).indexOf("t")&&(a=a.substring(1)),i.removeClass(L.unread),zmTab.currentTab.indexOf("zm_tabt")||"unread"!==Z.view||zmPrev.isEntityOpenedInPreview(a)||(i.remove(),$("#thd"+a).remove());var n=zmUtil.getFolId();if(zmUtil.getListMap(n)){var s=zmUtil.getFirstMsgId(l.T,Z);s&&(a=s)}I(a,1)}},P=function(e,t){var i,a,l=0,n=0,s=zmUtil.getMailObj(e);for(0===s.TC&&(s.TC=1),zmUtil.isFolderId(t)&&(s.FD=t),i=zmList.constructThreadChildRow(e),a=zmList.getMailSummaryList(Z,s.T),n=0;n<a.length;n++){if(zmUtil.getMailObj(a[n]).R<s.R){l=n;break}}$(w.listElem).find("#"+a[l]).before(i)},k=function(e,t){var i=$("#"+e),a=e,l=zmUtil.getMailObj(e);if("msg"===t&&l.T&&!zmInit.checkThreadRead(l.T)&&(i=D(e)).length){0===(a=i[0].id).indexOf("t")&&(a=a.substring(1)),i.addClass(L.unread);var n=zmUtil.getFolId();if(zmUtil.getListMap(n)){var s=zmUtil.getFirstMsgId(l.T,Z);s&&(a=s)}I(a,0)}},N=function(e,t,i){if(!t.preAction){var a,l,n,s,r,m,o=zmUtil.getMailObj(e);if(o.AR&&M(e,i),a=o.FD,l=t.folId,"notifier"!==t.from||a!==l||zmUtil.getFolId()!==l){if("msg"===i){if(s=$(zmail.mailCenter.listElem).find("#"+e),E(e,l),S(e,l),a===zmail.folId.tId||zmfolAction.isDeletedFolder(a)||a===zmail.folId.spId||l===zmail.folId.tId||zmfolAction.isDeletedFolder(l)||l===zmail.folId.spId)r=!0;else if((m=o.T)&&zmUtil.getListMap(m)){var d=zmList.getMailSummaryList(Z,m);if(d.length<=1&&-1!==t.mailId.indexOf(d[0])){var c=D(e);c.length&&(c.remove(),zmCenterListing.mailObjectAPI.rowRemovedInView(e,i)),x(s),$(w.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(e)}}o.T&&(1===W||2===W&&r)?F(e,l,o.FD):("unread"!==(n=zmUtil.getFolId())&&"all"!==n&&"flag"!==n&&!zmUtil.isLabelId(n)&&"search"!==n||l===zmail.folId.tId||zmfolAction.isDeletedFolder(l)||l===zmail.folId.spId)&&(o.T&&0!==W||(s.remove(),zmCenterListing.mailObjectAPI.rowRemovedInView(e,i))),o.T&&(""===Z.fId||Z.fId===l)&&U(e)&&P(e,l)}else if("thd"===i){(s=$(zmail.mailCenter.listElem).find("#t"+e)).length||(s=$(zmail.mailCenter.listElem).find("#"+e));var f,z,u=[],p=zmInit.findFolName(l);if(m=o.T,zmUtil.getListMap(m)&&(u=zmList.getViewBasedMsgList(m,Z)),f=u.length,2===W&&Z.fId&&Z.fId!==l||1===W&&Z.fId===a&&a!==l||l===zmail.folId.tId||"archive"===Z.view||l===zmail.folId.spId)s.remove(),$(zmail.mailCenter.listElem).find("#thd"+e).remove(),zmCenterListing.mailObjectAPI.rowRemovedInView(e,i);else if(s.find("."+L.folName).text(p),2===W||!Z.fId)for(z=0;z<f;z++)$(zmail.mailCenter.listElem).find("#"+u[z]+" ."+L.folName).text(p),$.publish("mail/move",[u[z],"msg",t])}h(e,i),$.publish("mail/move",[e,"msg",t]),function(e,t,i,a){var l,n,s,r,m=[];r=i.folId;var o=zmUtil.getMailObj(e);if("msg"===a){if(A({mode:"move",msgId:e,rFrom:t,addTo:r,type:a}),!o.S&&!o.AR){var d={action:"move",src:t,dest:r};ZMail.utils.updateCount({fId:t,mode:"dec",actionObj:d}),ZMail.utils.updateCount({fId:r,mode:"inc",actionObj:d})}}else if("thd"===a)for(A({mode:"move",msgId:e,rFrom:t,addTo:r,type:a}),l=o.T,n=(m=C(e,l,Z)).length,s=0;s<n;s++)A({mode:"upd",msgId:m[s],key:"FD",val:r});zmfolAction.isMutualFolder(r)&&zmContentCache.isCached(e)&&zmContentCache.delete(e)}(e,a,t,i),"msg"===i&&zmPreviewTemplate.updateMailHeaderView(e),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(o.T)?_(e,i):k(e,i))}}},R=function(e,t,i){if(i){if(i.preAction)return;i.from&&(B=i.from)}var a,l,n,s,r,m=zmUtil.getMailObj(e),o=m.FD;if(Z=zmInit.getListingDetObj(),o&&$("#"+o+" .SC_ct").hasClass("SC_new")){zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").clearNew(o)}if("msg"===t){if((a=$(zmail.mailCenter.listElem).find("#"+e)).removeClass(L.unread),l=a.parent("."+L.thdChild),"mail_preview"!==B||"mail_preview"===B&&!zmTab.currentTab.indexOf("zm_srch"))if("unread"===Z.view&&("zm_Container"!==zmTab.currentTab||!$(w.prevElem).attr("data-mid")||$(w.prevElem).attr("data-mid")&&$(w.prevElem).attr("data-mid")!==e&&(!m.TH||m.TH&&m.T!==zmUtil.getMailObj($(w.prevElem).attr("data-mid"),"T")))){var d=m.T;if(d&&0!==W){if(1===zmList.getMailSummaryList(Z,d).length&&!zmPrev.isEntityOpenedInPreview(e)){x(a);var c=zmCenterListing.mailObjectAPI.getViewParentOf("c"+e,"zm_Container");if(c){var f="t"+c.id;r=f,$(zmail.mailCenter.listElem).find("#"+r).remove()}}}else a.remove()}else l.hasClass(L.thdChild)&&!l.children("div").hasClass(L.unread)&&l.prev().removeClass(L.unread);$("#zmHdrP"+e).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+e).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+e).find(".zmPT").removeClass("zm_urd")}else if("thd"===t)if((a=$(zmail.mailCenter.listElem).find("#t"+e)).length||(a=$(zmail.mailCenter.listElem).find("#"+e)),l=$(zmail.mailCenter.listElem).find("#thd"+e),a.removeClass(L.unread),l.children("div").removeClass(L.unread),"unread"!==Z.view||"click"===B||"zm_Container"===zmTab.currentTab&&$(w.prevElem).attr("data-mid")===e)for(n=zmList.getViewBasedMsgList(m.T,Z),s=0;s<n.length;s++)$("#zmHdrP"+n[s]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+n[s]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+n[s]).find(".zmPT").removeClass("zm_urd"),$.publish("mail/read",[n[s],"msg"]);else a.remove(),l.remove();$.publish("mail/read",[e,"msg"]),function(e,t,i){var a,l,n,s,r=[],m=zmUtil.getMailObj(e)||{};if("msg"===t){if(!m.S){var o,d,c,f;a=m.FD,A({mode:"upd",msgId:e,key:"S",val:1}),o=(d=$(zmail.mailCenter.listElem).find("#"+e)).parent("."+L.thdChild).length?d.parent("."+L.thdChild):$(zmail.mailCenter.listElem).find("."+L.sel).next(),m.T&&0!==W&&(c=o.prev()).length&&0===(f=c[0].id).indexOf("t")&&(f=f.substring(1),$.publish(g,{msgId:f})),m.AR||ZMail.utils.updateCount({fId:a,mode:"dec",info:i})}}else if("thd"===t){s=m.T;var z=$.extend({},Z);for("unread"===Z.view&&(""===Z.fId?z.view="all":z.view=""),zmUtil.getListMap(s)?r=zmList.getViewBasedMsgList(m.T,z):r.push(e),n=r.length,l=0;l<n;l++)zmUtil.getMailObj(r[l],"S")||A({mode:"upd",msgId:r[l],key:"S",val:1});I(e,1)}if("unread"===Z.view&&"mail_preview"!==B){var u=!1;if("zm_Container"!==zmTab.currentTab){var p=zmsuite.getCenterOuter().$el.data("row-detail")?zmsuite.getCenterOuter().$el.data("row-detail").rowId:"";p.indexOf("t")||(e=p.substring(1),m=zmUtil.getMailObj(e)),u=!0}else!m.TH&&$(w.prevElem).attr("data-mid")!==e||m.TH&&$(w.prevElem).attr("data-mid")&&zmUtil.getMailObj($(w.prevElem).attr("data-mid"),"T")!==m.T?u=!0:"dropdown"===B&&(u=!0);u&&(!m.TH||m.TH&&zmInit.checkThreadRead(m.T))&&zmCache.updateCacheForViews(e)}}(e,t,i),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&_(e,t)},H=function(e,t,i){if(!i){var a,l,n,s,r=zmUtil.getMailObj(e);if("msg"===t){var m,o;if((a=$(zmail.mailCenter.listElem).find("#"+e)).addClass(L.unread),l=a.parent("."+L.thdChild).length?a.parent("."+L.thdChild):$(zmail.mailCenter.listElem).find("."+L.sel).next(),r.T&&0!==W&&l.children("div").hasClass(L.unread)&&(""===Z.fId||""!==Z.fId&&Z.fId===r.FD))(m=l.prev()).addClass(L.unread),m.length&&(0===(o=m[0].id).indexOf("t")&&(o=o.substring(1)),I(o,0));$("#zmHdrP"+e).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+e).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+e).find(".zmPT").addClass("zm_urd")}else if("thd"===t){for((a=$(zmail.mailCenter.listElem).find("#t"+e)).length||(a=$(zmail.mailCenter.listElem).find("#"+e)),a.addClass(L.unread),$(zmail.mailCenter.listElem).find("#thd"+e).children("div").not(".zmsnt").addClass(L.unread),n=zmList.getViewBasedMsgList(r.T,Z),s=0;s<n.length;s++)zmUtil.getMailObj(n[s],"FD")!==zmail.folId.sId&&($("#zmHdrP"+n[s]).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+n[s]).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+n[s]).find(".zmPT").addClass("zm_urd"),$.publish("mail/unread",[n[s],"msg"]))}$.publish("mail/unread",[e,"msg"]),function(e,t){var i,a,l,n=[],s=zmUtil.getMailObj(e);if("msg"===t)s.S&&((i=s.FD)!==zmail.folId.sId&&A({mode:"upd",msgId:e,key:"S",val:0}),s.AR||ZMail.utils.updateCount({fId:i,mode:"inc"}));else if("thd"===t){var r;l=s.T;var m,o=$.extend({},Z);for("unread"===Z.view&&(""===Z.fId?o.view="all":o.view=""),zmUtil.getListMap(l)?n=zmList.getViewBasedMsgList(s.T,o):n.push(e),a=n.length,r=0;r<a;r++)(m=zmUtil.getMailObj(n[r])).S&&m.FD!==zmail.folId.sId&&A({mode:"upd",msgId:n[r],key:"S",val:0});I(e,0)}}(e,t),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&k(e,t)}},J=function(e,t){var i,a=zmList.getMailSummaryList(Z,zmUtil.getMailObj(e,"T")),l=0,n=$("#"+e);Z.flag?l="-1"===Z.flag&&"0"===t||"-1"!==Z.flag&&Z.flag!==t?0:1:Z.label&&(l=t),0===l?n.length?(i=n.parent().prev().find("."+L.tc),p(a,i),"1"===i.text()&&x(n)):(i=$(zmail.mailCenter.listElem).find("."+L.sel+" ."+L.tc),p(a,i)):n.length?(i=n.parent().prev().find("."+L.tc),u(a,i)):(i=$(zmail.mailCenter.listElem).find("."+L.sel+" ."+L.tc),u(a,i),"2"===i.text()&&i.before(j()))},K=function e(t,i,a,l){if(!l){var n,s,r,m,o=zmInit.flgClass(i),d="",c="",f=zmUtil.getMailObj(t);if("msg"===a){if(d=$.e(zmail.mailCenter.listElem).find("#"+t),f.TH&&0!==W&&(n=D(t))&&n.length){-1!==(c=n[0].id).indexOf("t")&&(c=c.substring(1));var z=zmUtil.getFolId();if(zmUtil.getListMap(z)){var u=zmUtil.getFirstMsgId(f.T,Z);u&&(c=u)}v(c,f.NFG,i),r=zmInit.getThdFlagvalue(c),s=zmInit.flgClass(r),n.find("."+L.flag).removeClass().addClass(s)}if($("#zmHdrP"+t+" ."+L.flag).removeClass().addClass(o),$("#zmHdrT"+t+" ."+L.flag).removeClass().addClass(o),$("#zmHdrS"+t+" ."+L.flag).removeClass().addClass(o),Z.flag&&"0"===i)f.T?"-1"!==Z.flag&&Z.flag!==f.NFG||0===f.NFG||(m=zmList.getMailSummaryList(Z,f.T),1===W||2===W?(J(t,i),2===m.length?x(d):1===m.length&&n.length&&(n.remove(),$(w.prevElem).attr("data-mid")===c&&"lt"===$(w.prevElem).attr("data-ty")&&zmPrev.clsPreview()),d.remove()):2===W&&1===m.length&&(x(d),n.length&&(n.remove(),$(w.prevElem).attr("data-mid")===c&&"lt"===$(w.prevElem).attr("data-ty")&&zmPrev.clsPreview()))):(d.remove(),$(w.prevElem).attr("data-mid")===t&&zmPrev.clsPreview()),d.find("."+L.flag).removeClass().addClass(o);else if(0===i)d.find("."+L.flag).removeClass().addClass(o);else{if(f.T){if(Z.flag)if(m=zmList.getMailSummaryList(Z,f.T),1===W||2===W)if(""===Z.fId)if("-1"===Z.flag&&"0"===f.NFG||Z.flag===i&&f.NFG!==i){if(P(t,""),1===m.length)if($("#t"+m[0]).length)$("#t"+m[0]).find("."+L.tc).before(j());else if($(zmail.mailCenter.listElem).find("."+L.sel).length){var p=zmail.mailCenter.listElem;$(p).find("."+L.sel+" ."+L.tc).before(j())}J(t,i)}else"-1"!==Z.flag&&f.NFG!==i&&(2===m.length?x(d):1===m.length&&(d.parent().prev().remove(),d.parent().remove(),zmPrev.clsPreview()),J(t,i),d.remove());else Z.fId===f.FD&&("-1"===Z.flag&&"0"===f.NFG||Z.flag===i&&f.NFG!==i?(P(t,""),J(t,i)):"-1"!==Z.flag&&f.NFG===Z.flag&&f.NFG!==i&&(J(t,i),d.remove()));else 2===W&&1===m.length&&(""===Z.fId&&"-1"!==Z.flag&&f.NFG!==i||Z.fId===f.FD&&"-1"!==Z.flag&&f.NFG===Z.flag&&f.NFG!==i)&&(x(d),n.length&&(n.remove(),$(w.prevElem).attr("data-mid")===c&&"lt"===$(w.prevElem).attr("data-ty")&&zmPrev.clsPreview()))}else Z.flag&&"-1"!==Z.flag&&f.NFG!==i&&d.remove();d.find("."+L.flag).removeClass().addClass(o)}A({mode:"upd",msgId:t,key:"NFG",val:i})}else if("thd"===a){var g,h,I;for(m=[],I=f.T,g=(m=zmList.getViewBasedMsgList(I,Z)).length,h=0;h<g;h++)e(m[h],i,"msg",l);(d=$(zmail.mailCenter.listElem).find("#t"+t)).length||(d=$(zmail.mailCenter.listElem).find("#"+t)),b(t,i),Z.flag&&"0"===i?(d.remove(),$(zmail.mailCenter.listElem).find("#thd"+t).remove(),$(w.prevElem).attr("data-mid")===t&&zmPrev.clsPreview()):"0"===i?d.find("."+L.flag).removeClass().addClass(o):Z.flag&&"-1"!==Z.flag&&Z.flag!==i?($(zmail.mailCenter.listElem).find("#thd"+t).remove(),d.remove(),$(w.prevElem).attr("data-mid")===t&&zmPrev.clsPreview()):d.find("."+L.flag).removeClass().addClass(o)}$.publish("mail/flag",[t,"msg",i]),Z.flag&&("-1"===Z.flag&&"0"===i||"-1"!==Z.flag&&i!==Z.flag)&&zmCache.updateCacheForViews(t),d.length&&0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(f.T)?_(t,a):k(t,a))}},X=function e(t,i,a){if(!i.preAction){var l,n,s,r,m,o,d=!1,c=zmUtil.getMailObj(t);if("msg"===a){var f;if(l=$(zmail.mailCenter.listElem).find("#"+t),c.TH&&0!==W){if((n=D(t)).length){-1!==(s=n[0].id).indexOf("t")&&(s=s.substring(1));var z=zmUtil.getFolId();if(zmUtil.getListMap(z)){var u=zmUtil.getFirstMsgId(c.T,Z);u&&(s=u)}}y(s,[i.lId],i.lA)}if("add"===i.lA){if(c.TAG=c.TAG||[],m=c.TAG,c.T&&(1===W||2===W)&&Z.label)if(f=$.inArray(i.lId,c.TAG),""===Z.fId){if(Z.label===i.lId&&-1===f){if(P(t,""),1===(r=zmList.getMailSummaryList(Z,c.T)).length)if($("#t"+r[0]).length)$("#t"+r[0]).find("."+L.tc).before(j());else if($(zmail.mailCenter.listElem).find("."+L.sel).length){$(zmail.mailCenter.listElem).find("."+L.sel+" ."+L.tc).before(j())}J(t,1)}}else Z.fId===c.FD&&("-1"===Z.label&&0===c.TAG.length||Z.label===i.lId&&-1===f)&&(P(t,""),J(t,1));-1===(f=$.inArray(i.lId,m))&&c.TAG.push(i.lId)}else if("delete"===i.lA&&c.TAG){var p,g=c.TAG,h=g.length;for(c.T&&(1===W||2===W&&Z.fId===zmail.folId.tId)&&("-1"===Z.label&&1===c.TAG.length||Z.label===i.lId)&&(J(t,0),2===(r=zmList.getMailSummaryList(Z,c.T)).length?x(l):1===r.length&&(n.length&&(n.remove(),$(zmail.mailCenter.listElem).find("#thd"+s).remove(),$(w.prevElem).attr("data-mid")===s&&"lt"===$(w.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish(O,[]))),d=!0,o=s)),p=0;p<h;p++)if(i.lId===g[p]){c.TAG.splice(p,1);break}}else"deleteall"===i.lA&&c.TAG&&(c.T&&(J(t,"0"),Z.label&&(2===(r=zmList.getMailSummaryList(Z,c.T)).length?x(l):1===r.length&&((n=D(t)).length&&(n.remove(),$(zmail.mailCenter.listElem).find("#thd"+s).remove(),$(w.prevElem).attr("data-mid")===s&&"lt"===$(w.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish(O,[]))),d=!0,o=s))),c.TAG=[]);(Z.label&&"deleteall"===i.lA||(Z.label===i.lId||"-1"===Z.label)&&"delete"===i.lA)&&(l.remove(),d=!0,o=o||t,$(w.prevElem).attr("data-mid")!==t||c.T&&"th"!==$(w.prevElem).attr("data-ty")||("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish(O,[])))}else if("thd"===a){var I,v,b,T=c.T;for(r=[],v=0,I=(r=zmList.getViewBasedMsgList(T,Z)).length;v<I;v++)b=zmUtil.getMailObj(r[v]),("deleteall"===i.lA&&b.TAG||"add"===i.lA&&(!b.TAG||-1===$.inArray(i.lId,b.TAG))||"delete"===i.lA&&$.inArray(i.lId,0<=b.TAG))&&e(r[v],i,"msg");if((l=n=$(zmail.mailCenter.listElem).find("#t"+t)).length||(l=n=$(zmail.mailCenter.listElem).find("#"+t)),y(t,[i.lId],i.lA),"add"===i.lA)c.TAG||(c.TAG=[]),m=c.TAG,-1===$.inArray(i.lId,c.TAG)&&m.push(i.lId);else if("delete"===i.lA&&c.TAG){var C,M=c.TAG,S=M.length;for(C=0;C<S;C++)if(i.lId===M[C]){c.TAG.splice(C,1);break}("-1"===Z.label&&0===c.TAG.length||Z.label===i.lId)&&($(zmail.mailCenter.listElem).find("#thd"+t).remove(),l.remove(),$(w.prevElem).attr("data-mid")===t&&zmPrev.clsPreview(),d=!0,o=t)}else"deleteall"===i.lA&&c.TAG&&($(zmail.mailCenter.listElem).find("#t"+t+" p").remove(),c.TAG=[]);Z.label&&"deleteall"===i.lA&&(l.remove(),A({mode:"upd",msgId:t,key:"TAG",val:""}),$(w.prevElem).attr("data-mid")===t&&zmPrev.clsPreview(),d=!0,o=t)}d&&o&&zmCache.updateCacheForViews(o),zmPreviewTemplate.refreshLabelsForMail(t,n),$.publish("mail/label",[t,"msg",i]),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(c.T)?_(t,a):k(t,a))}},Q=function(e,t,i,a){if(!a){var l,n=zmUtil.getMailObj(e);if("msg"===i)l=$.e(zmail.mailCenter.listElem).find("#"+e),E(e,zmail.folId.tId),S(e,zmail.folId.tId),n.T&&(n.FD===zmail.folId.dId&&zmUtil.removeDraftMapping(e),zmCenterListing.mailObjectAPI.rowRemovedInView(e,i),F(e,zmail.folId.tId,n.FD)),5!==t&&n.FD===zmail.folId.tId&&(t=5),Z.fId===zmail.folId.tId&&n.FD!==zmail.folId.tId&&U(e)&&P(e,zmail.folId.tId),n.TH&&0!==W||(l.remove(),zmCenterListing.mailObjectAPI.rowRemovedInView(e,i)),$.publish("/mail/msgDiscarded",[{draftId:e,actionType:"discard_draft"}]),zmContentCache.remove(e);else if("thd"===i){var s,r,m;for((l=$.e(zmail.mailCenter.listElem).find("#t"+e)).length||(l=$.e(zmail.mailCenter.listElem).find("#"+e)),m=(s=zmList.getViewBasedMsgList(void 0,Z)).length,r=0;r<m;r++)$.publish("mail/delete",[s[r],"msg",t]);l.remove(),zmCenterListing.mailObjectAPI.rowRemovedInView(e,i),$.e(zmail.mailCenter.listElem).find("#thd"+e).remove()}h(e,i),$.publish("mail/delete",[e,"msg",t]),function(e,t,i){var a,l,n,s=[],r=zmUtil.getMailObj(e);if("msg"===t){if(r.FD===zmail.folId.teId)ZMail.utils.updateCount({fId:zmail.folId.teId,mode:"dec"});else if(r.FD===zmail.folId.dId)ZMail.utils.updateCount({fId:zmail.folId.dId,mode:"dec"});else if(0===r.S&&!r.AR){var m={action:"delete",src:r.FD,dest:zmail.folId.tId};ZMail.utils.updateCount({fId:r.FD,mode:"dec",actionObj:m}),0===i&&ZMail.utils.updateCount({fId:zmail.folId.tId,mode:"inc",actionObj:m})}A({mode:"delete",msgId:e,folId:r.FD,type:t})}else if("thd"===t&&(a=r.T,zmUtil.getListMap(a)?s=zmList.getViewBasedMsgList(a,Z):s.push(e),n=s.length,0===i))for(l=0;l<n;l++)A({mode:"delete",msgId:s[l],folId:zmUtil.getMailObj(s[l],"FD"),type:t});!Z.fId&&(Z.view||Z.flag||Z.label)&&zmCache.updateCacheForViews(e)}(e,i,t),"msg"===i&&zmPreviewTemplate.updateMailHeaderView(e),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(n.T)?_(e,i):k(e,i))}},d=function(e,t){var i,a,l,n,s=zmUtil.getMailObj(e);i=C(e,s.T,Z),l=$(zmail.mailCenter.listElem).find("#"+e),n=Boolean(Z.fId),a=l.length?l.parent().prev().find("."+L.tc):$(zmail.mailCenter.listElem).find("."+L.sel+" ."+L.tc),n&&("unarchive"===t&&1===s.AR||"archive"===t&&0===s.AR)&&(p(i,a),"1"===a.text()&&x(l))},ee=function(e,t,i){if(!i){var a,l,n=!0,s=zmUtil.getMailObj(e),r=s.T;if("msg"===t){if((a=$(zmail.mailCenter.listElem).find("#"+e)).addClass(L.archIndication),r&&zmUtil.getListMap(r)){var m=zmList.getMailSummaryList(Z,r);if(m.length<=1&&e===m[0]){var o=D(e);o.length&&o.remove(),x(a),$(w.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(e),n=!1}}n&&s.TH&&0!==W&&d(e,"archive"),("archive"!==Z.view&&Z.fId||!Z.fId&&"unread"===Z.view)&&a.remove()}else"thd"===t&&(a=$(zmail.mailCenter.listElem).find("#t"+e),l=$(zmail.mailCenter.listElem).find("#thd"+e),a.addClass(L.archIndication),"archive"!==Z.view&&""!==Z.fId&&(a.remove(),l.remove()));h(e,t),$.publish("mail/archive",[e,"msg"]),function(e,t){var i,a,l,n=[],s=zmUtil.getMailObj(e),r=s.FD;if("msg"===t)A({mode:"upd",msgId:e,key:"AR",val:1}),$.publish(q,[s.FD]),s.S||ZMail.utils.updateCount({fId:r,mode:"dec"});else if("thd"===t)for(l=s.T,a=(n=C(e,l,Z)).length,i=0;i<a;i++)A({mode:"upd",msgId:n[i],key:"AR",val:1}),$.publish(q,[zmUtil.getMailObj(n[i],"FD")]);(Z.fId&&"archive"!==Z.view||!Z.fId&&"unread"===Z.view)&&zmCache.updateCacheForViews(e)}(e,t),E(e,s.FD),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(s.T)?_(e,t):k(e,t))}},te=function(e,t,i){if(!i){var a,l,n=!0,s=zmUtil.getMailObj(e),r=s.T;if("msg"===t){if((a=$(zmail.mailCenter.listElem).find("#"+e)).removeClass(L.archIndication),r&&zmUtil.getListMap(r)){var m=zmList.getMailSummaryList(Z,r);if(m.length<=1&&e===m[0]){var o=D(e);o.length&&o.remove(),x(a),$(w.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(e),n=!1}}n&&s.TH&&0!==W&&d(e,"unarchive"),"archive"===Z.view&&a.remove()}else a=$(zmail.mailCenter.listElem).find("#t"+e),l=$(zmail.mailCenter.listElem).find("#thd"+e),a.removeClass(L.archIndication),"archive"===Z.view&&(a.remove(),l.remove());$.publish("mail/unarchive",[e,"msg"]),M(e,t),E(e,s.FD),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(s.T)?_(e,t):k(e,t))}},ie=function(e,t,i){if(!i){var a,l,n=zmUtil.getMailObj(e);if("msg"===t){if(a=n.FD,l=zmail.folId.spId,E(e,l),S(e,l),n.T&&0!==W&&F(e,l,a),n.TH&&0!==W||$(zmail.mailCenter.listElem).find("#"+e).remove(),A({mode:"move",msgId:e,rFrom:a,addTo:l,type:t}),0===n.S&&!n.AR){var s={action:"spam",src:a,dest:l};ZMail.utils.updateCount({fId:a,mode:"dec",actionObj:s}),ZMail.utils.updateCount({fId:l,mode:"inc",actionObj:s})}}else if("thd"===t){var r,m,o,d;for(a=n.FD,l=zmail.folId.spId,d=n.T,$("#t"+e).remove(),$("#thd"+e).remove(),zmPrev.clsPreview(),A({mode:"move",msgId:e,rFrom:a,addTo:l,type:t}),m=(r=C(e,d,Z)).length,o=0;o<m;o++)A({mode:"upd",msgId:r[o],key:"FD",val:zmail.folId.spId})}h(e,t),"msg"===t&&zmPreviewTemplate.updateMailHeaderView(e),$.publish("mail/spam",[e,"msg"]),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(n.T)?_(e,t):k(e,t))}},ae=function(e,t,i){var a,l,n,s,r,m;if(a=zmail.folId.spId,t){l=t.length;var o,d=zmUtil.getMailObj(e);if("msg"===i){if(n=t[0].folId,s=t[0].detail.m,E(e,n),S(e,n),(1===W||2===W&&Z.fId===zmail.folId.spId)&&d.T&&Z.fId===a&&F(e,n,a),(0===W||!d.TH||d.TH&&"unread"!==Z.view)&&$(zmail.mailCenter.listElem).find("#"+e).remove(),A({mode:"move",msgId:e,rFrom:zmail.folId.spId,addTo:n,type:i}),0===d.S&&!d.AR){var c={action:"notspam",src:a,dest:n};ZMail.utils.updateCount({fId:a,mode:"dec",actionObj:c}),ZMail.utils.updateCount({fId:n,mode:"inc",actionObj:c})}}else for($("#t"+e).remove(),$("#thd"+e).remove(),zmPrev.clsPreview(),r=0;r<l;r++)for(n=t[0].folId,s=t[0].detail.m,A({mode:"insert",msgId:e,rt:d.R,folId:n,type:i}),m=0;m<s.length;m++)if((o=zmUtil.getMailObj(s[m]))&&(A({mode:"upd",msgId:s[m],key:"FD",val:n}),0===o.S&&!o.AR)){var f={action:"notspam",src:a,dest:n};ZMail.utils.updateCount({fId:a,mode:"dec",actionObj:f}),ZMail.utils.updateCount({fId:n,mode:"inc",actionObj:f})}"msg"===i&&zmPreviewTemplate.updateMailHeaderView(e),$.publish("mail/notspam",[e,"msg",t]),0!==W&&Z.fId!==zmail.folId.tId&&Z.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(d.T)?_(e,i):k(e,i))}},le=function(e,t){zmUtil.hideMenu();var i={read:m.maillistopt.markread,unread:m.maillistopt.markunread,flag:T.common.flag,label:T.common.label,move:T.common.move,delete:T.common.delete,spam:m.maillistopt.markspam,notspam:m.maillistopt.notspam,archive:m.maillistopt.archive,unarchive:m.maillistopt.unarchive};if("success"===e.result)return zmUtil.succErrMsg("s",zmText.applyArgs(T.bulkaction.common.info,{actionname:i[t.action]})),void zmList.unchkAll()},ne=function(e,t){var i,a,l,n,s,r,m=e.length,o=t.length,d=zmPrev.prevDetails().msgId,c=zmUtil.getMailObj(d),f=c&&c.TH&&W||0,z=!1,u=!1,p=!0;if((1===m&&0===o||0===m&&1===o)&&d===(a=m?e[0]:t[0])&&(z=!0),f&&0<m&&0===o){var g=c.T;for(s=0;s<m;s++)if(zmUtil.getMailObj(e[s],"T")!==g){p=!1;break}if(p)return}if(!z&&!u)for(s=0,l=m;s<l;s++)if(d===e[s]){u=!0;break}if(!z&&!u)for(i=zmInit.getListingDetObj(),s=0,l=o;!u&&s<l;s++){if(d===t[s]){u=!0;break}for(r=0,n=(e=zmList.getMailSummaryList(i,zmUtil.getMailObj(t[s],"T"))).length;r<n;r++)if(d===e[r]){u=!0;break}}z?zmPrev.updatePrevOnDeletion(a):u&&zmPrev.clsPreview()},se=function(){var e=zmUtil.getFolId(),t=zmUtil.getListMap(e);if(t){var i=parseInt(zmail.mailOpt.range)||50;(t.MO&&t.MO.length)<i&&zmInit.fillMails(i)}},re=function(){var e,t=[{id:"zm_Container",view:zmUtil.getFolId()},{id:"zm_srch1",view:"search"}],i=t.length,a=0;for(a=0;a<i;a++){var l,n,s=t[a].id,r=t[a].view;zmsuite.isWorkspaceAvailable(s)&&(n=zmsuite.getCenter(s)[0].getNodes()[2].$el,(l=zmPrev.prevDetails(s).msgId)&&0===n.find("."+o.cls.mRow+"."+L.sel).length&&(e=zmList.getDupThdRowId(l,r))&&zmList.setMailSelection(e,"lt",n))}},me=function(e,t){if(!ZMail.utils.isROMode()){var i,a,l,n,s,r,m,o=t.mailId,d=t.amailId,c=t.tmailId,f=t.source,z=t.action,u=t.preAction,p=t.loadAdjacent,g=[];if(w=zmList.getElemObj(),"success"===e.result){var h,I,v=zmUtil.getMLConversionValue();for(zmUtil.hideMenu(),Z=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),W=Z.fId===zmail.folId.sId&&0!==v?0:v,g.push(o),g.push(d),g.push(c),l=g.length,("popup"===f||p)&&""!==zmPrev.prevDetails().msgId&&("move"===z||"delete"===z||"spam"===z||"notspam"===z||"unarchive"===z&&"archive"===Z.view||"archive"===z&&("archive"!==Z.view&&Z.fId||!Z.fId&&"unread"===Z.view))&&ne(o||[],c||[]),n=0;n<l;n++)for(s=0===n||1===n?"msg":"thd",a=(i=g[n])?i.length:0,r=0;r<a;r++)if(m=i[r],zmUtil.isMetaDataAvailable(m))switch(z){case"move":N(m,t,s);break;case"delete":Q(m,t.fT,s,u);break;case"archive":ee(m,s,u);break;case"unarchive":te(m,s,u);break;case"spam":ie(m,s,u);break;case"notspam":ae(m,e.desFol||t.resp.desFol,s)}if(e.count)e.count.forEach(function(e){I=Object.keys(e)[0],(h=parseInt(e[I]))<0?ZMail.utils.updateCount({fId:I,mode:"bdec",count:Math.abs(h)}):ZMail.utils.updateCount({fId:I,mode:"binc",count:h})});"mail"===t.from||-1!==zmTab.currentTab.indexOf("zm_tab")||!Z.fId&&((Z.fId||"unread"!==Z.view)&&"search"!==Z.view||"delete"!==z&&"move"!==z&&"archive"!==z&&"spam"!==z&&"notspam"!==z)||("notifier"!==t.from&&(zmList.unchkAll(),"move"===z&&zmUtil.succErrMsg("s",T.info.moveSuccess)),$(w.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(w)),re(),se()}else{var b=T.common.errorprocessing;e.result?b=e.result:e.error&&(b=e.error),zmsDialog.alert(b)}$.publish("/maction/"+t.action),t.updUnarchiveStatusforFId&&zmfolAction.markFolderAsUnarchived({folId:t.updUnarchiveStatusforFId})}},oe=function(e,t){if(!ZMail.utils.isROMode()){var i,a,l,n,s,r,m,o=[];if(w=zmList.getElemObj(),"success"===e.result){e.hasOwnProperty("count")&&void 0!==t&&"unread"===t.action&&t.tmailId&&0<t.tmailId.length&&$.publish(g,{resp:e,data:t,msgId:t.tmailId[0]});var d,c,f=zmTab.currentTab,z=zmUtil.getMLConversionValue();for(Z=f.indexOf("zm_tab")?f.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),W=Z.fId===zmail.folId.sId&&0!==z?0:z,void 0!==t&&(o.push(t.mailId),o.push(t.amailId),o.push(t.tmailId)),s=o.length,n=0;n<s;n++)for(a=0===n||1===n?"msg":"thd",l=0,(r=o[n])&&(l=r.length),m=0;m<l;m++)if(i=r[m],zmUtil.isMetaDataAvailable(i))switch(t.action){case"read":R(i,a,t);break;case"unread":H(i,a,t.preAction);break;case"flag":K(i,t.fVal,a,t.preAction);break;case"label":X(i,t,a);break;case"spam":ie(i,a)}if("notifier"!==t.from&&"zm_Container"===f&&("read"===t.action&&"unread"===Z.view||"flag"===t.action&&Z.flag||"label"===t.action&&Z.label)&&zmList.unchkAll(),e.count)e.count.forEach(function(e){c=Object.keys(e)[0],(d=parseInt(e[c]))<0?ZMail.utils.updateCount({fId:c,mode:"bdec",count:Math.abs(d)}):ZMail.utils.updateCount({fId:c,mode:"binc",count:d})});$(w.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(w),re(),se()}else{var u=T.common.errorprocessing;e.result?u=e.result:e.error&&(u=e.error),zmsDialog.alert(u)}}},de=function(e,t,i){var a,l,n,s,r,m,o,d,c,f=[];for(d=i.mailId||i.amailId,c=i.tmailId,f.push(d),f.push(c),a=f.length,w=zmList.getElemObj(),""!==zmPrev.prevDetails().msgId&&("move"===e||"delete"===e||"spam"===e||"notspam"===e||"unarchive"===e&&"archive"===Z.view||"archive"===e&&("archive"!==Z.view&&Z.fId||!Z.fId&&"unread"===Z.view))&&ne(d||[],c||[]),l=0;l<a;l++)for(m=0===l?"msg":"thd",s=0,(r=f[l])&&(s=r.length),n=0;n<s;n++)switch(o=r[n],e){case"read":R(o,m);break;case"unread":H(o,m);break;case"flag":K(o,t.fA,m);break;case"label":i.preAction=!1,X(o,i,m);break;case"move":i.preAction=!1,N(o,i,m);break;case"delete":Q(o,i.fT,m);break;case"archive":ee(o,m);break;case"unarchive":te(o,m);break;case"spam":ie(o,m)}},ce=function(){var e,t,i,a,l=[],n="";t=(e=zmUtil.getCheckedMailList())[0],i=e[1];var s,r=zmUtil.getMailObj(t[0],"R"),m=zmUtil.getMailObj(i[0],"R");for(t.length&&i.length?n=parseInt(r)>=parseInt(m)?parseInt(r):parseInt(m):t.length?n=parseInt(r):i.length&&(n=parseInt(m)),a=0;a<t.length&&(s=zmUtil.getMailObj(t[a],"R"),parseInt(s)===n);a++)l.push(t[a]);for(a=0;a<i.length&&(s=zmUtil.getMailObj(i[a],"R"),parseInt(s)===n);a++)l.push(i[a]);return{receivedTime:n,list:[l,[]]}},t={applyActions:function(e,t,i){if(!ZMail.utils.isROMode()){var a,l,n,s,r,m,o,d,c=!0,f=[],z=zmUtil.getMLConversionValue(),u={};if(B=t,l={accId:zmail.accId,mode:"markas"},n={action:e},zmInit.listingBand.isBulkActionSet){var p=ce();m=p.list,l.mode="bulkaction",l.receivetime=p.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(l=$.extend(l,zmSearchUtil.getRequestParams()))}else{var g=zmUtil.getCheckedMailCount();if(m=zmUtil.getSelectedMails(),300<g)return}if(n.mailId=a=i&&i.msgId?i.msgId:m[0],r=i&&i.thd?i.thd:m[1],n.tmailId=r,zmTab.currentTab.indexOf("zm_tab")?u=zmTab.currentTab.indexOf("zm_srch")?(Z=zmInit.getListingDetObj(),zmList.selDetails.mListing||{}):(Z=zmSearchUtil.getSearchViewDetails(),zmList.selDetails.sListing||{}):Z=zmsuite.getCenterOuter().$el.data("data-detail"),W=Z.fId===zmail.folId.sId||Z.fId===zmail.folId.tId||Z.fId===zmail.folId.spId?0:z,Z.fId&&(l.viewfolId=Z.fId,d=Z.fId),(Z.view||zmInit.listingBand.isBulkActionSet&&u.view)&&(l.view=Z.view||u.view,d=Z.view),(Z.flag||zmInit.listingBand.isBulkActionSet&&u.flag)&&(l.flag=Z.flag||u.flag,d="flag"),(Z.label||zmInit.listingBand.isBulkActionSet&&u.label)&&(l.label=Z.label||u.label,d=Z.label),(Z.attach||zmInit.listingBand.isBulkActionSet&&u.attach)&&(l.attach=Z.attach||u.attach,d=Z.attach),zmInit.listingBand.isBulkActionSet||(l.folderSpec=W),r&&r.length&&(f=zmUtil.getThreadIdArr(r)),"zm_Container"===zmTab.currentTab&&"unread"===d&&$.e(zmail.mailCenter.prevElem).hasClass("shw")&&f.length){var h,I,v=zmPrev.prevDetails().msgId,b=$.extend({},Z),T=v&&zmUtil.getMailObj(v);if(I=T.T,h=f.indexOf(I),T.TH&&-1!==h){""===Z.fId?b.view="all":b.view="";var C=zmList.getMailSummaryList(Z,I);0===C.length&&(C=zmList.getMailSummaryList(b,I),a=a.concat(zmUtil.getListMap(I,"MO")),n.mailId=a,r.splice(h,1),n.tmailId=r)}}if((Z.fId===zmail.folId.tId||Z.fId===zmail.folId.dId||0===W)&&r&&r.length&&(a=a.concat(r),r=[],n.mailId=a,n.tmailId=[]),a&&a.length&&(s=zmmailAct.separateArchive(a),l.mailId=s[0].join(),l.mailId.length||(delete l.mailId,delete n.mailId),0<s[0].length&&zmUtil.isSharedFolder(Z.fId)&&(l.shId=n.shId=zmUtil.getShareId(Z.fId),zmail.opType[e]?l.opType=zmail.opType[e]:l.opType=0)),s&&0<s[1].length&&(n.amailId=s[1],l.amailId=s[1].join(),zmUtil.isSharedFolder(Z.fId)&&(l.shId=n.shId=zmUtil.getShareId(Z.fId),zmail.opType[e]?l.opType=zmail.opType[e]:l.opType=0)),r&&r.length&&(l.tmailId=f.join(),zmUtil.isSharedFolder(Z.fId)&&(l.shId=n.shId=zmUtil.getShareId(Z.fId),zmail.opType[e]?l.opType=zmail.opType[e]:l.opType=0)),l.todo=$.inArray(e,V),"flag"===e?(l.fA=i.fVal,n.fVal=i.fVal):"label"===e?(n.lA=i.lA,i.lId&&(l.lId=n.lId=i.lId),"add"===i.lA?(l.mailId&&l.mailId.length?o=zmmailAct.rmDuplicateLabel(l.mailId,i.lId,"msg"):(delete l.mailId,delete n.mailId),o&&0<o.length?(l.mailId=o.join(),l.lA=0):r&&r.length?c=!(l.lA=0):l.amailId&&l.amailId.length?((o=zmmailAct.rmDuplicateLabel(l.amailId,i.lId,"msg"))&&0<o.length&&(l.amailId=o.join()),l.lA=0):(zmUtil.hideMenu(),c=!1)):"delete"===i.lA?l.lA=2:l.lA=3,"default"===i.accType&&(l.accId=zmail.defAccId)):-1===l.todo&&(c=!1),c&&"zmStreamsApp"!==zmTab.currentTab){var M=oe;if(n.suppressWSNoti=!0,zmInit.listingBand.isBulkActionSet?(n.suppressWSNoti=!1,n.preAction=!1,M=le):l.shId?n.preAction=!1:n.preAction=!0,Y(l,n,M),n.preAction){var S=$.extend({},l),w=$.extend({},n);de(e,S,w)}}}},doActions:function(e,t,i){if(!ZMail.utils.isROMode()){var a,l,n,s,r,m,o,d={accId:zmail.accId,mode:"moveto"},c={action:e,from:t},f=!0,z=[],u=zmUtil.getMLConversionValue(),p={};if(B=t,zmTab.currentTab.indexOf("zm_tab")?p=zmTab.currentTab.indexOf("zm_srch")?(Z=zmInit.getListingDetObj(),zmList.selDetails.mListing||{}):(Z=zmSearchUtil.getSearchViewDetails(),zmList.selDetails.sListing||{}):Z=zmsuite.getCenterOuter().$el.data("data-detail"),W=Z.fId===zmail.folId.sId||Z.fId===zmail.folId.tId||Z.fId===zmail.folId.spId?0:u,"newm"!==e){if("sweep"===e){d.mode="bulkaction";var g=zmUtil.createSearchParams(i.senderList,Z);d=$.extend(d,g),(n=zmUtil.getSelectedMails())[0]=n[0].concat(n[1])||[];var h=zmUtil.getFolId(Z);zmUtil.getListMap(h,"MO").length?d.receivetime=zmUtil.getMailObj(zmUtil.getListMap(h,"MO")[0],"R"):d.receivetime=zmUtil.getMailObj(n[0][0],"R"),"delete"===i.actionType?d.sA=0:"archive"===i.actionType&&(d.sA=1,$.publish(q,[Z.fId])),c.action=i.actionType}else if(zmInit.listingBand.isBulkActionSet){var I=ce();n=I.list,d.mode="bulkaction",d.receivetime=I.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(d=$.extend(d,zmSearchUtil.getRequestParams()))}else{var v=zmUtil.getCheckedMailCount();if(n=zmUtil.getSelectedMails(),300<v)return}if(c.mailId=a=i&&i.msgId?i.msgId:n[0],s=i&&i.thd?i.thd:n[1],c.tmailId=s,"sweep"!==e){if(Z.fId&&(d.viewfolId=Z.fId,r=Z.fId),(Z.view||zmInit.listingBand.isBulkActionSet&&p.view)&&(d.view=Z.view||p.view,r=Z.view,"bulkaction"===d.mode&&!Z.fId&&"search"===Z.view)){var b=zmSearchUtil.getSearchedFolders()[0]||"";b&&(d.viewfolId=b)}(Z.flag||zmInit.listingBand.isBulkActionSet&&p.flag)&&(d.flag=Z.flag||p.flag,r="flag"),(Z.label||zmInit.listingBand.isBulkActionSet&&p.label)&&(d.label=Z.label||p.label,r=Z.label),(Z.attach||zmInit.listingBand.isBulkActionSet&&p.attach)&&(d.attach=Z.attach||p.attach,r=Z.attach)}if(s&&s.length&&(z=zmUtil.getThreadIdArr(s)),"zm_Container"===zmTab.currentTab&&"unread"===r&&$(zmail.mailCenter.prevElem).hasClass("shw")&&z.length){var T,C,M=zmPrev.prevDetails().msgId,S=zmUtil.getMailObj(M),w=$.extend({},Z);if(C=S.T,T=z.indexOf(C),S.TH&&-1!==T){""===Z.fId?w.view="all":w.view="";var L=zmList.getMailSummaryList(Z,S.T);0===L.length&&(L=zmList.getMailSummaryList(w,S.T),a=a.concat(L),c.mailId=a,s.splice(T,1),c.tmailId=s)}}(Z.fId===zmail.folId.dId||Z.fId===zmail.folId.tId||0===W)&&s&&s.length&&(a=a.concat(s),s=[],c.mailId=a,c.tmailId=[]),a&&a.length&&(l=zmmailAct.separateArchive(a),d.mailId=l[0].join(),d.mailId.length||(delete d.mailId,delete c.mailId),0<l[0].length&&zmUtil.isSharedFolder(Z.fId)&&(d.shId=c.shId=zmUtil.getShareId(Z.fId),zmail.opType[e]?d.opType=zmail.opType[e]:d.opType=0)),l&&0<l[1].length&&(c.amailId=l[1],d.amailId=l[1].join(),zmUtil.isSharedFolder(Z.fId)&&(d.shId=c.shId=zmUtil.getShareId(Z.fId),zmail.opType[e]?d.opType=zmail.opType[e]:d.opType=0)),s&&s.length&&(d.tmailId=z.join(),zmUtil.isSharedFolder(Z.fId)&&(d.shId=c.shId=zmUtil.getShareId(Z.fId),zmail.opType[e]?d.opType=zmail.opType[e]:d.opType=0))}if(d.todo=$.inArray(e,V),"move"===e){var O,A;if(d.folId=c.folId=i.folId,d.mailId){for(O=d.mailId.toString().split(","),d.mailId="",A=0;A<O.length;A++)i.folId!==zmUtil.getMailObj(O[A],"FD")&&(0!==A&&""!==d.mailId&&(d.mailId+=","),d.mailId+=O[A]);d.mailId||delete d.mailId}if(d.tmailId&&1===W&&zmail.folCount[Z.fId])for(O=s.toString().split(","),d.tmailId="",A=0;A<O.length;A++)o=zmUtil.getMailObj(O[A]),i.folId!==o.FD&&(0!==A&&""!==d.tmailId&&(d.tmailId+=","),d.tmailId+=o.T)}else if("delete"===e){var y=Z.fId;"search"===Z.view&&(y=zmSearchUtil.getSearchedFolders()[0]||""),y===zmail.folId.dId?d.fT=c.fT=1:y===zmail.folId.teId?d.fT=c.fT=2:y===zmail.folId.spId?d.fT=c.fT=4:y===zmail.folId.tId?d.fT=c.fT=5:y===zmail.folId.oId?d.fT=c.fT=6:d.fT=c.fT=0,o=zmUtil.getMailObj(d.mailId),d.mailId&&o&&o.FD===zmail.folId.dId&&(d.fT=c.fT=1)}else if("notspam"===e){var D,E;if(d.mailId){for(D=d.mailId.toString().split(","),E=0;E<D.length;E++)zmUtil.getMailObj(D[E],"FD")!==zmail.folId.spId&&D.splice(E,1);d.mailId=D.join()}}else-1===d.todo&&(d.todo=-1);if(d.mailId||d.tmailId||d.amailId||"newm"===e||(zmUtil.hideMenu(),f=!1),"bulkaction"!==d.mode&&(1===W||2===W&&r===zmail.folId.tId||r===zmail.folId.dId?d.folderSpec=1:d.folderSpec=W,m=i&&i.listingType?i.listingType:zmAdHocSettings.getConversationActionType(),2!==d.folderSpec||"delete"!==e&&"spam"!==e&&"move"!==e||(d.folderSpec=parseInt(m))),f){var U,x,j,F=me;if(c.suppressWSNoti=!0,"bulkaction"===d.mode?(c.preAction=!1,F=le,c.suppressWSNoti=!1):d.shId||"notspam"===e?(c.preAction=!1,c.loadAdjacent=!0):c.preAction=!0,i&&i.actionSrc&&(d.actionSrc=i.actionSrc),"moveto"===d.mode&&6===d.fT){var _,P,k;j=d.mailId.split(","),$.subscribe("mail/updateOutBox",function(e,t){var i=t.M.split(",");j.forEach(function(t){i.forEach(function(e){if(t===e)return zmsDialog.remove(),!1})})}),1===j.length?(P=zmUtil.getMailObj(d.mailId),_=0===P.SCO.OT?G.schedule:G.Recurred):(_="",j.forEach(function(e){P=zmUtil.getMailObj(e),k=0===P.SCO.OT?G.schedule:G.Recurred,0===_.trim().length?_=k:_!==k&&(_=G.schedule)})),zmsDialog.confirm(_,{onOk:function(){Y(d,c,F),c.preAction&&(U=$.extend({},d),x=$.extend({},c),de(e,U,x))}})}else{if(("unarchive"===e||"delete"===e)&&"zm_Container"===zmTab.currentTab&&Z.fId&&"archive"===Z.view){var N=zmList.getSelectedRowCount(),R=zmUtil.getListMap(Z.fId)||{},H=R&&R.showNextPage;(zmInit.listingBand.isBulkActionSet||(R.MO||[]).length===N&&0===H)&&(c.updUnarchiveStatusforFId=Z.fId)}Y(d,c,F),c.preAction&&(U=$.extend({},d),x=$.extend({},c),de(e,U,x))}}}},rmDuplicateLabel:function(e,t){for(var i,a,l,n=e.toString().split(","),s=n.length,r=[],m=0;m<s;m++){var o;if(l=n[m],i=!1,a=zmUtil.getMailObj(l,"TAG"))for(o=0;o<a.length;o++)if(a[o]===t){i=!0;break}i||r.push(l)}return r},separateArchive:function(e){for(var t=[],i=[],a=e.length,l=0;l<a;l++)1===zmUtil.getMailObj(e[l],"AR")?i.push(e[l]):t.push(e[l]);return[t,i]},createCommentEntity:(l={no_data:{code:0,message:e.publishcomment.error.maildatanotavlbl},no_mention:{code:1,message:e.publishcomment.error.userorgrouprequire},req_fail:{code:2,message:e.publishcomment.error.requestfail}},function(e,t,i){var a=$.Deferred();return t=t||"",(e=String(e||""))?t&&t.length?zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:function(){a.resolve()},p:{mode:"createCommentEntity",messageID:e,shareWith:t,shareConversation:i},csr:"s",efn:function(){a.reject({error:l.req_fail})}}).fail(function(){a.reject({error:l.req_fail})}):a.reject({error:l.no_mention}):a.reject({error:l.no_data}),a.promise()}),updateDraftCountInUI:function(e,t,i,a){var l,n,s=zmUtil.getMLConversionValue();if(""!==t&&void 0!==t&&0!==s&&(l=D(e,a)))if("discard_draft"===t)i?(n=1<i?i+" "+m.common.draftPlural:i+" "+m.common.draft,l.find("."+L.draft).appendDOM(zdom("span",null,n),{clear:!0})):(l.find("."+L.draft).clearHTML(),l.find("."+L.from).removeClass(L.hasDftCount));else if("save_draft"===t){var r=zmUtil.getMailObj(e);r&&!r.DMID&&(l.length&&0===(e=l.attr("id")).indexOf("t")&&(e=e.substring(1),r=zmUtil.getMailObj(e)),n=1<(i=r.DC?r.DC+1:1)?i+" "+m.common.draftPlural:i+" "+m.common.draft,l.find("."+L.draft).appendDOM(zdom("span",null,n),{clear:!0}),l.find("."+L.from).addClass(L.hasDftCount))}},rapplyAction:oe,rdoAction:me,updateUnreadStatusforThd:I,updateFlagStatusforThd:v,setFlagStatusforThd:b,updateLabelsforThd:y,deleteOfflineEmail:function(e){zmCompOffline.removeDraft(e).then(function(){ZMail.listing.collection.clearMsgFromListMap(e,zmUtil.getFolId()),ZMail.listing.collection.clearModel(e),ZMail.lView.delete(e),ZMail.lView.clearOfflineSeparator(),zmList.setEmptyListing()})}};return $.subscribe("/mail/draftsaved",function(e,t){t=t||{},zmUtil.isInlineCompose()&&zmUtil.getMailContent(String(t.draftId),{reload:!0}),zmmailAct.updateDraftCountInUI(t.msgId,"save_draft","","zm_Container")}),t}(),window.zmUrlAct=function(){var e={},r=["folder","share","tags","views","all"],m=["view_unread","view_archive","view_all","flag_all","flag_1","flag_2","flag_3","label_all","label","view_attach","attach_1"],o={},d={},c={prev:[],curr:[]},f=function(e,t){e.length||(e=c.curr());for(var i=t.length,a=0;a<i;a++)if(-1!==e.indexOf(t[a])){e=e.slice(0,e.indexOf(t[a]));break}return e},z=function(e){var t="",i="";if(e===zmail.folId.iId||"inbox"===e)t+="inbox",i=zmail.folId.iId;else if(e===zmail.folId.dId||"drafts"===e)t+="drafts",i=zmail.folId.dId;else if(e===zmail.folId.spId||"spam"===e)t+="spam",i=zmail.folId.spId;else if(e===zmail.folId.teId||"templates"===e)t+="templates",i=zmail.folId.teId;else if(e===zmail.folId.sId||"sent"===e)t+="sent",i=zmail.folId.sId;else if(e===zmail.folId.tId||"trash"===e)t+="trash",i=zmail.folId.tId;else if(e===zmail.folId.oId||"outbox"===e)t+="outbox",i=zmail.folId.oId;else if("unread"===e||"zm_unread"===e)t+="unread",i="zm_unread";else if("all"===e||"zm_all"===e)t+="all",i="zm_all";else if("flag"===e||"flagged"===e||"zm_flag"===e)t+="flagged",i="zm_flag";else if(/^\+?(0|[1-9]\d*)$/.test(e)){if(!(zmUtil.isFolderId(e)||zmUtil.isSharedFolder(e)||zmUtil.isLabelId(e)||zmUtil.isViewId(e)))return{folId:!1};t+=e,i=e}return{hashTxt:t,folId:i}},u=function(e){var t,i,a,l=[],n="";return i=zmail.mailLeft.selLayerId,a="","zmlTreeH"===i?a=r[0]:"zmlSTreeH"===i?a=r[1]:"zmllabelH"===i?a=r[2]:"zmlviewH"===i&&(a=r[3]),n=a,t=z(e),l.push(n),l.push(t.hashTxt),{hashTxt:l,folId:t.folId}};e.update=function(a){var e,t,i,l,n=zmsuite.getAppRouter("zm_Container");if("zmLeft"===(e=a.from?a.from:a.folId&&!a.view||a.view&&a.folId===a.viewId||a.folId&&"zm"===a.folId.substring(0,2)?"zmLeft":"dropMenu"))t=u(a.folId).hashTxt;else if("dropMenu"===e){var s=function(e){var t=[];if(e.viewId)if(e.viewId&&"-1"===e.viewId)"label"===e.view?t.push("tags"):t.push(e.view),t.push("all");else{if(!e.viewId||"-1"===e.viewId)return!1;"label"===e.view?t.push("tags"):"attach"===e.view?t.push("attach"):t.push(e.view),t.push(e.viewId)}else"all"===e.view?t=[]:(t.push("view"),t.push(e.view));return t}(a);2<(i=c.curr).length&&(i=f(i,["view","tags","flag","attach","p"])),t=i.concat(s)}else{if("zmCenter"!==e)return;if(2<(i=c.curr).length&&(i=f(i,["p"])),a.remove)t=i;else{var r=function(){var e=zmail.folId,t=zmUtil.getFolId();if(t!==e.teId&&t!==e.oId&&t!==e.dId&&(0===a.opentype||4===a.opentype)){var i=a.msgId;return"t"===i.charAt(0)&&(i=i.substring(1)),"th"===a.type&&(i=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a.msgId).id),i}}();t=r?i.concat(["p",r]):i}}t.toString()!==c.curr.toString()&&(l=t,c.curr.length&&(c.prev=c.curr),c.curr=l,n.setParams(t),n.update())};var a=function(t){o={},d={};var e,i,a,l,n=function(){var e;e="t"===d.msgId.charAt(0)?d.msgId.substring(1):d.msgId,zmList.getMailObj(e)&&($(zmail.mailCenter.listElem).find("#"+e).length||$(zmail.mailCenter.listElem).find("#t"+e).length)?zmList.showMailPreview(d):(zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:d.msgId,opentype:2,type:"lt",src:"external"}),t=c.curr.length?c.curr:t.slice(0,t.indexOf("p")))};if(function(e){var t,i={};i[0]=function(e){if(!e[0]||!e[1])return!1;if(-1===r.indexOf(e[0]))return!1;var t=z(e[1]);return!!t.folId&&(o.fId=t.folId,!0)},i[1]=function(e){var t;return"tags"===e[0]&&(e[0]="label"),t="label"===e[0]&&"all"!==e[1]?e[0]:e[0]+"_"+e[1],-1!==m.indexOf(t)&&("view"===e[0]?"all"!==e[1]&&(o.view=e[1]):(o.view=e[0],"all"!==e[1]?o.viewId=e[1]:o.viewId=-1),!0)},i[2]=function(e){var t;return"p"===e[0]&&(t="t"===e[1].charAt(0)?e[1].substring(1):e[1],!!/^\+?(0|[1-9]\d*)$/.test(t)&&(d.msgId=e[1],d.type="lt",d.opentype=4===zmail.mailOpt.isPopup?4:0,!0))};for(var a=0;a<e.length;a+=2)if(t=a/2,2===a&&"p"===e[a]&&(t=a),!i[t]([e[a],e[a+1]]))return!1;return!0}(t=t.toString().toLowerCase().split(","))){if(o.fId)if("m"!==zmApp.currentApp&&zmApp.showApp("m"),"zm_Container"!==zmTab.currentTab&&zmsuite.showExistingApp("zm_Container"),!c.curr.length||(a=-1===c.curr.indexOf("p")?c.curr.length:c.curr.indexOf("p"),l=-1===t.indexOf("p")?t.length:t.indexOf("p"),e=c.curr.slice(0,a),i=t.slice(0,l),e.toString()!==i.toString())||zmail.onDemandListing&&!zmail.initialListingLoaded)if(zmail.initialListingLoaded=!0,d.msgId){var s=$.Deferred();zmList.showMailListing(o,{retainPreview:!1,sortAscending:void 0,mlDefObj:s}),$.when(s).done(function(){n()})}else zmList.showMailListing(o);else d.msgId?n():zmPrev.prevDetails().msgId&&zmPrev.clsPreview();return!0}return!1};return e.manualHandler=function(e){var t,l=!1;(t=e).length?1===t.length&&("inbox"===t[0]?t.unshift("folder"):"unread"===t[0]&&t.unshift("views")):1===zmInit.lPageType()?(t.push("folder"),t.push("inbox")):(t.push("views"),t.push("unread"));var i={tab:{handler:function(e){var t,i,a;zmsuite.isMaxLimitReached()||(t=e[1],a="lt","t"!==t.charAt(0)?((i=zmList.getMailObj(t))&&i.TH&&(a="th"),zmList.getMailData({msgId:t,opentype:2,type:a,src:"external"})):(t=t.substring(1),zmList.getMailData({msgId:t,opentype:2,type:a,src:"external",tId:t})),l=!0)}},switch:{handler:function(e){var t=e[1];t&&zmail.aInfo[t]&&(zmUtil.switchAccount(t),l=!0)}}};return(e=t)[0]in i?(i[e[0]].handler(e),{updateParams:l,defaultAction:!1}):{updateParams:a(e)}},e.getZmLayers=function(){return r},e.init=function(){zmInit.lPageType()?c.curr=["folder","inbox"]:c.curr=["views","unread"]},e}(),window.zmRestore=function(){var e={},s="zm_Container",a=["listing","expandThd","preview","tab"],r=ZMail.lConstants.cls;e.saveState=function(e,t){if("restore"===zmAdHocSettings.getLPageType()){if(-1===a.indexOf(e))return;var i=zmsuite.getAppObj(s).obj.stateData.data;"listing"===e?i.listing.view=t:"expandThd"===e?i.listing.expand=t:"preview"===e&&(i.preview=t),zmState.sendRequestToSaveState()}},e.restoreTabs=function(e){e.app&&e.category&&$.publish(e.app+"/"+e.category,[e])};var m=function(e,t){if(e){var i=$.Deferred();if($.when(i).done(function(){zmPrev.prevDetails(s).msgId&&function(e){if(e){var t,i=zmList.getMailObj(e);i&&(i.TH&&(t=zmCenterListing.mailObjectAPI.getViewParentOf("c"+e)),i.TH&&zmUtil.getFolId()!==zmail.folId.sId&&zmUtil.getMLConversionValue()&&t&&t.id===e?zmUtil.initScroll(zmsuite.getCenter(s)[0].getNodes()[2].$el,"t"+e,"t"+e):zmUtil.initScroll(zmsuite.getCenter(s)[0].getNodes()[2].$el,e,e))}}(e),t&&t.deferred.resolve()}),zmList.getMailObj(e)&&($(zmail.mailCenter.listElem).find("#"+e).length||$(zmail.mailCenter.listElem).find("#t"+e).length)){var a=$("#"+e).attr("data-ty")||$("#t"+e).attr("data-ty"),l={msgId:e,type:a,opentype:zmail.mailOpt.isPopup},n=zmList.getListingElemObj(l);zmList.showMailPreview({msgId:e,opentype:4===zmail.mailOpt.isPopup?4:0,type:a,tabId:s},n,void 0,i)}else zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:e,opentype:2,type:"lt",src:"external"},void 0,i)}},o=function(e,t){var i=$(zmail.mailCenter.listElem).find("#t"+e);if(i.length){var a={msgId:e,type:$("#t"+e).attr("data-ty"),opentype:zmail.mailOpt.isPopup},l=zmList.getListingElemObj(a),n=$(i).find("."+r.tc),s=$(n);l.rowElem=$(n).closest("."+r.mRow),zmList.showHideThread({srcElem:s,elemObj:l,onEnd:t})}else t&&t.resolve()};return $.subscribe("/mail/switchAccount",function(e,t){zmsuite.getAppObj(s).obj.stateData.data.accId=t}),e.restoreMailApp=function(t,i){try{var e=t.accId;if(zmail.accId!==e||zmail.onDemandListing)i.deferred.resolve();else{var a=$.Deferred();$.when(a).done(function(){var e=$.Deferred();t.listing.expand.mId?o(t.listing.expand.mId,e):e.resolve(),$.when(e).done(function(){window.setTimeout(function(){t.preview.p?m(t.preview.p,i):i.deferred.resolve()},400)})}),n=(l=t).listing.view.fId,s=l.listing.view.view,r=l.listing.view.viewId,n===zmail.folId.iId&&zmInit.lPageType()&&""===s&&""===r||"zm_unread"===n&&!zmInit.lPageType()&&"unread"===s&&""===r?a.resolve():zmList.showMailListing(t.listing.view,{retainPreview:!1,sortAscending:void 0,mlDefObj:a})}}catch(e){i.deferred.resolve()}var l,n,s,r},e.expandThread=o,e.restorePreview=m,e}(),function(){var I,e,v=zmail.Core.Namespaces.create("zmContentCache");v.get=function(e,t){var i=zmail.prevMails&&zmail.prevMails[e];return i=i?i.data.mdata:I.getCacheLib().get(e)||{},t?i[t]:i},v.fetch=function(t){if(t.p&&!t.p.msgId)zmAjq.XHR(t);else{var e=!!t.ep&&t.ep.avoidCache,i=!!t.ep&&t.ep.forceFetch;t.avoidCache=e,t.forceFetch=i,$.when(I.get(t)).then(function(e){t.fn&&t.fn(e,t.ep)})}},v.fetchSingleItem=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},p=e.msgId,t=e.forceFetch,g=void 0!==t&&t,i=e.needSharedUserInfo,h=void 0!==i&&i;return new Promise(function(i,a){if(g||!zmContentCache.isCached(p)){var e=zmUtil.getMailObj(p)||{},t=e.FD,l=e.T,n=e.newStreams,s=e.streams,r=e.accId,m=e.actionType,o=e.groupId,d=e.entityType,c=void 0===d?1:d,f={accId:zmail.accId,split:!0,summary:!0,msgId:p,vfc:!0};t&&(f.folId=t),zmUtil.isSharedFolder(t)?Object.assign(f,{isSh:h,shId:zmUtil.getShareId(t),shareId:zmUtil.getShareId(t),groupId:zmail.shrTree[0][t].OZUID,entityId:l||p,entityType:c}):zmfolAction.isMutualFolder(t)&&Object.assign(f,{isSh:h,shareId:zmfolAction.getModel(t,"SH"),groupId:zmail.zuid,entityId:l||p,entityType:c}),(n||s)&&(delete f.folId,Object.assign(f,{streamsView:!0,accId:r,groupId:o,entityId:p,actionType:m,entityType:c}));var z={msgId:p};g&&(z.forceFetch=!0);var u={u:zmail.conPath+"/md.do",t:"POST",p:f,ep:z,fn:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(1<arguments.length&&void 0!==arguments[1]&&arguments[1],Object.keys(e).length);0===t||1===t&&e.MSGID?a():i(v.get(p))},efn:function(){},forceFetch:g};$.when(I.get(u)).then(function(e){u.fn&&u.fn(e,u.ep)})}else i(zmContentCache.get(p))})},v.remove=function(e){zmail.mailContainer&&zmail.mailContainer.getObject(e)&&zmail.mailContainer.removeObject(e)},v.isCached=function(e){try{return!(!zmail.prevMails||!zmail.prevMails[e])||!!I.getCacheLib().hasKey(e)}catch(e){return!1}},v.processResponse=function(e,t,i){var a;if("CID"!==t){if(e.mdata?(a=e.mdata.MSGID||e.mdata.M,t&&t!==a&&i&&i.updateKey&&(t=a,i.updateKey(a))):(e=e[a=t]?{mdata:e[a]}:{mdata:e}).mdata.MSGID=a,e.mdata&&(e.comment&&(e.mdata.comment=e.comment,e.mdata.sharedUsers=e.sharedUsers,e.mdata.metadata=e.metadata),zmContentCache.remove(a),zmUtil.prevCache(a,e)),e.tdata&&e.tdata.length){var l=e.tdata[0].T;l&&(!zmUtil.getListMap(l)||zmUtil.isInlineCompose()||e.streamsMail)&&(zmUtil.addDMapModels(e.tdata,l),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(l))}if(e.ddata){var n,s,r,m=e.ddata,o=m.length;for(n=0;n<o;n++)s=m[n].draftId,r=m[n].content,zmContentCache.isCached(s)&&zmContentCache.remove(s),zmUtil.prevCache(s,{mdata:r})}var d=e.mdata;if(!_.isEmpty(d)&&1!==Object.keys(d).length)return e.mdata;zmContentCache.remove(a)}},v.getCacheStore=function(){return I},v.getCacheLib=function(){return I.getCacheLib()},v.populateMailData=function(e,t){var i=t.msgId,a=t.thId;i&&!e.mdata&&(e.mdata=zmContentCache.get(i),e.mdata.comment&&(e.comment=e.mdata.comment),e.mdata.sharedUsers&&(e.sharedUsers=e.mdata.sharedUsers));var l=zmUtil.getListMap(a);if(a&&!e.tdata&&l){var n,s,r=l.MO?l.MO.length:0;for(n=0;n<r;n++)(s=zmList.getMailObj(l.MO[n]))&&e.tdata.push(s)}},v.delete=function(e){I.remove(e)},e={type:"MFU",keyParam:"msgId",requestURI:"md.do",requestType:"POST",beforeAdd:zmContentCache.processResponse,maxSize:200},I=new zmail.Components.ContentCache.ContentCacheComp(e)}(),function(){var c=zmail.Core.Namespaces.create("ZMail.utils");c.updateCount=function(e){var t=e.fId,i=e.mode,a=e.count,l=e.actionObj,n=e.isHighlight,s=e.state,r=!1;if(!zmUtil.isSharedFolder(t)&&t!==zmail.folId.sId){if(l){var m=l.src,o=l.dest,d=l.action;if(d&&-1!==["move","spam","notspam","delete"].indexOf(d))zmfolAction.isExcludeFolder("accUnreadCount",t)||t!==m&&t!==o||(r=!0)}else r=!0;var c,f="zmlTreeH";zmail.mailLeft.getNodes()[0].getLayer(f).updateCount(t,i,a,n,!0,{state:s}),r&&(c=zmInit.getUnreadViewCount(),f="zmlviewH",zmail.mailLeft.getNodes()[0].getLayer(f).updateCount("zm_unread","upd",c),zmUtil.updateCountForAcc(zmail.accId,"upd",c));var z=zmInit.getListingDetObj();(z.fId||"unread"===z.view&&r)&&ZMail.topbar.header.renovate("notification"),zmWinTitle.updateTitle(),(!e.info||e.info&&"mail_preview"!==e.info.from)&&$.publish("mail/folder/countUpdated",{fId:t})}},c.selMailsCount=function(e){var t=zmUtil.getSelectedMails(e);return t[0].length+t[1].length},c.getTextContent=function(e){var t=zdom("div",null," ",$.dangerouslyParseHTML(e)," ");t.style.opacity=0,document.body.appendChild(t);var i=t.innerText;return t.parentElement.removeChild(t),i},c.loadTask=function(n){var a=function(e){var t=e.CONTENT,i=e.NEWATT,a=zmList.getMailObj(n),l=t&&c.getTextContent(t)||a.SM;zmUtil.loadTask({action:"addPopupTask",groupId:zmail.zuid,tasks:{SUMMARY:l,TITLE:a.SB,attEntObj:i},addparams:{msgid:n,accid:zmail.accId,senderid:a.F}})};zmContentCache.fetchSingleItem({msgId:n}).then(function(e){var t=e.NEWATT,i=e.CONTENT;a({NEWATT:t,CONTENT:i})}).catch(function(){a({})})},c.loadNote=function(n){var a=function(e){var t=e.CONTENT,i=e.NEWATT,a=zmList.getMailObj(n);zmUtil.hideMenu();var l={attEntObj:i,addparams:{msgid:n,accid:zmail.accId,senderid:a.F}};(64|a.MA)!==a.MA&&(l.title=a.SB,l.desc=t&&c.getTextContent(t)||a.SM),zmUtil.loadNotes("popup",l)};zmContentCache.fetchSingleItem({msgId:n}).then(function(e){var t=e.NEWATT,i=e.CONTENT;a({NEWATT:t,CONTENT:i})}).catch(function(){a({})})},c.isCurrentUserEmailId=function(e){return zmail.aInfo[zmail.accId].mailId===e||!!(zmail.Settings.Apps.SendMailAs.models.API.getAliasList()||[]).includes(e)},c.isRecallDisabled=function(){return"true"!==zmail.isTrailUser&&"false"===zmail.isPaidUser&&!zmail.isInternalOrgUser},c.hasExternalImageNotLoaded=function(e){var t=zmContentCache.get(e,"EXTIMG");return t&&"display"===t.link},c.showHideprompt=function(l,n){return new Promise(function(e){if(zmail.showFeature){var t,i=zmText.get("preview"),a={title:i.compose.warningTitle,ignoreMouseDown:!1,$content:zdom("span",null,i.compose.warningMsg),buttons:[{name:i.compose.accept,callback:function(){t.remove(),zmPreviewTemplate.loadImages("",n.msgId,n.prevElem.find(".zmListInfoBox").find(".zmLink")[0]),n.externalImagePopup=!0,e(n)}},{name:i.compose.cancel,isCancel:!0,callback:function(){t.remove(),n.externalImagePopup=!0,e(n)}}]};c.hasExternalImageNotLoaded(l)&&!_zm.isOfflineSyncActive()&&n.meta.FD!==zmail.folId.dId&&"w"!==zmUtil.getComposeType()&&"edithere"!==n.loadType?t=Dialog.new(a):e(n)}else e(n)})},c.loadComposer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.parentId,i=e.composeOpenType,a=e.draftId,l=e.composeAction,n=e.prevElem,s=void 0===n?zmsuite.getCenter&&zmsuite.getCenter(window.zmTab&&zmTab.currentTab)[1].$el:n,r=e.recipientList;a&&(t=zmUtil.getMailObj(a,"PA"));var m={loadApp:"mail",msgId:t,mode:l,prevElem:s,loadType:i};r&&(m.recipientList=r);var o=zmUtil.getMailObj(t);if(o&&(m.meta=o,a=a||o.DMID),a&&(m.draftId=a,m.meta=zmUtil.getMailObj(a)),o&&o.streams){var d=window.zmTab&&zmTab.currentTab;o.groupId===zmail.zuid&&"zmStreamsApp"!==d&&"zmncenter"!==d||Object.assign(m,{groupId:o.groupId,streamsView:!0,loadApp:""})}zmUtil.requireComposeModule().then(function(){var e=zmContentCache.get(a||t);"template"===l||_.isEmpty(e)||e.SHRINKED?zmContentCache.fetchSingleItem({msgId:a||t,forceFetch:!0}).then(function(e){zmContentCache.isCached(t)&&(m.data=e),c.showHideprompt(a||t,m).then(function(e){zmUtil.invokeComposer(e)})},function(e){zmUtil.debugLog(e)}):(m.data=e,c.showHideprompt(a||t,m).then(function(e){zmUtil.invokeComposer(e)}))})},c.getHeaderRef=function(e){var t=e.tabId,i=void 0===t?zmTab.currentTab:t,a=e.partName,l=void 0===a?"menuBar":a,n=e.container;return"menuBar"===l?ZMail.topbar.icons.getLeftElem(i):"titleBar"===l?ZMail.topbar.header.getElem(i):"menuBarRight"===l?ZMail.topbar.icons.getRightElem(i,n):ZMail.topbar.getElem(i)},c.isROMode=function(e){return!0===zmail.isROMode||e&&zmUtil.isSharedFolder(e,"R")||_zm.isOfflineSyncActive()},c.getMailSize=function(e){return e<1024?"1 KB":e<1048576?(e/1024).toFixed(0)+" KB":e<1073741824?(e/1048576).toFixed(0)+" MB":void 0},c.currentMailListingInfo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:zmTab.currentTab,t={};return"zm_Container"===e?t=zmInit.getListingDetObj():"zm_srch1"===e?t=zmSearchUtil.getSearchViewDetails():e.indexOf("zm_tab")?zmUtil.isChildWindow()&&(t=$.q("#zmWindowWrapper").data("detail")):t=zmsuite.getCenterOuter(e).$el.data("data-detail"),t}}();