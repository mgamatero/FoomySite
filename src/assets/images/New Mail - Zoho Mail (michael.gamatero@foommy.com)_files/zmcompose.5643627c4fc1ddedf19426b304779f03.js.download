"use strict";window.zmComp=function(){var C=0,A={},E=zmUtil.composeI18N(),R=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=!1,o=!0;zmail.policyBasedHiddenItems?zmail.policyBasedHiddenItems.isBCCEnabled||(t=!0):zmail.cmpWinObj.policyBasedHiddenItems&&(zmail.cmpWinObj.policyBasedHiddenItems.isBCCEnabled||(t=!0));var n=!1,r=e.composeID,i=e.parentDOM,a=e.nextDOMAnchor,m=zmComp.getCmpObj()[r]||{};0===zmComp.getDefault().showBcc&&(n=!0),t&&(o=n=!1);var d={parentDOM:i,nextDOMAnchor:a,buttonLabels:{to:E.to,cc:E.cc},ccFieldVisible:"0"===zmAdHocSettings.getShowCCOption(),bccFieldVisible:n,showBccButton:o,composeID:r};t||(d.buttonLabels.bcc=E.bcc);var s=zmail.Compose.Components.composeRecipientComponent.createNew(d);m.recipientComponent=s,["to","cc","bcc"].forEach(function(m){var e=s.recipientField[m];$.events(e.component).on("inputFocus inputBlur",function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};zmComp.getShowSuggestions(r)&&"focus"===t.type&&zmComp.setSugType(r,m)}),$.events(e.component).on("escKeyPress",function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1];zmComp.setShowSuggestions(r,!1),zmTooltip.remove(),zmCUtil.removeSugList(r)}),$.events(e).on("tokenChange",function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=t.model,n=void 0===o?null:o,i="change"===t.type&&n&&n.changed.hasOwnProperty("contact"),a="change"===t.type&&n&&n.changed.hasOwnProperty("smimeStatus");!A[r].handleTokenEvents||i||a||(zmComp.setModified(r,1),zmComp.modifyAtMention(r),"outbox"!==A[r].mode&&zmComp.modifyRecipients({composeID:r,field:m,action:t.type}))})}),m.handleTokenEvents=!0},i=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).composeID;return zmComp.getCmpObj()[e].recipientComponent},m=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.field;return i(e).recipientField[t]},t=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return m(e).component.refs.input},r=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t(e).focus()},o=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t(e).scrollIntoView()},n=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};m(e).resetTokens()},u=function(z,e){return e.handlePasteImages=!0,e.mouseUpActionTriggered=function(e){$.publish("mail/composeKeyAction",e)},e.convertBase64ToImg=function(d,s,p){Object.keys(d).forEach(function(r){_zm.b64toBlob(d[r],function(e){var t=new FormData,o=zmAjq.getCookie("zmcsr");t.append("aId",zmail.accId),t.append("frm","c"),t.append("uploadMode","drop"),t.append("mode","composeSet"),t.append("zmrcsr",o),t.append("img_file",e,r+".png");var m=new XMLHttpRequest;A[z].imagepending++,m.onreadystatechange=function(){if(4===m.readyState)if(A[z].imagepending--,200===m.status){var e,t=$.parseJSON(m.responseText),o=t.fileName,n=t.aId,i=t.storeName,a=t.frm;if(o&&n&&i&&a){e="/zm/ImageSignature?fileName="+o,e+="&accountId="+n+"&storeName="+i,"c"===a&&(e+="&frm=c"),s(e,r)}else p(d,r)}else 500===m.status||m.status,p(d,r)},m.open("POST",zmail.conPath+"/zeUploadImage.do",!0),m.send(t)},function(e){})})},e.processPastedFile=function(l,e,c,u,f,t){var o;l.dataURI&&(l.file=zmCUtil.dataURItoBlob(l.dataURI)),"file"===t?zmAttachComponent.imageEditTool.init({file:l.file,onAttach:function(e){l.file=e.blob,o()},onClose:function(){},handBckObj:function(){}}):"source"===t&&zmAttachComponent.imageEditTool.init({source:l,onAttach:function(e){(l={}).file=e.blob,o()},onClose:function(){},handBckObj:function(){}}),o=function(){if(l.file){var e,m="pastImg_"+z+"_uId"+C,t=(new Date).getTime()+".png",o=0;if(l&&l.file){if(l.file&&(e=l.file,l.file.name&&(t=l.file.name)),-1!==t.lastIndexOf("."))"png"!==t.substr(t.lastIndexOf("."))&&(t+=".png");else t+=".png";l.file.size&&(o=l.file.size)}if(3145728<o){var n=E.imageupload_size_exceeds,i=$.q(zdom("h4",null,n)),a=$.q(zdom("div",null));a.attr("id","zmcmp_pasteupload_"+z),a.appendDOM(i,{clear:!0});var r={cmpId:z};return r.$content=a,r.ignoreMouseDown=!1,r.dialogDidMount=function(o){($.q("#zmcmp_pasteupload_"+z)[0].zmcmp_pasteupload_dialog_ele=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},r.defaultNavigator=!1,r.navigator=new zmail.Navigator({onEscape:function(){$.q("#zmcmp_pasteupload_"+z)[0].zmcmp_pasteupload_dialog_ele.remove()}}),r.buttons=[{name:E.ok,callback:function(e){e.remove(),l.file&&(l.file.name||(l.file.name="Screenshot_"+(new Date).getTime()+".png"),zmComp.getAttRef(z).uploadFiles([l.file]))}},{name:E.cancel,isCancel:!0,callback:function(e){e.remove()}}],void Dialog.new(r)}var d=new XMLHttpRequest;A[z].imagepending++,d.upload.addEventListener("loadstart",function(){c(m)},!1);var s=new FormData,p=zmAjq.getCookie("zmcsr");s.append("aId",zmail.accId),s.append("frm","c"),s.append("uploadMode","drop"),s.append("mode","composeSet"),s.append("zmrcsr",p),s.append("img_file",e,t),d.onreadystatechange=function(){if(4===d.readyState)if(A[z].imagepending--,200===d.status){var e,t=$.parseJSON(d.responseText),o=t.fileName,n=t.aId,i=t.storeName,a=t.frm;if(o&&n&&i&&a){e="/zm/ImageSignature?fileName="+o,e+="&accountId="+n+"&storeName="+i,"c"===a&&(e+="&frm=c"),u(e,m)}else f(m)}else 500===d.status||d.status,f(m)},d.open("POST",zmail.conPath+"/zeUploadImage.do",!0),d.send(s),C++}}},e},g=function(o,e,t,n){var i=$.Deferred(),a=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==a&&(ZE_Init.defaultFontFamily=a);var m=zmCUtil.getfontSize();m&&(ZE_Init.defaultFontSize=m+"pt");var r=zmCUtil.getfontColor();r&&(ZE_Init.defaultFontColor=r);var d="";-1!==["fwdi","fwdme","compose"].indexOf(n)?ZE_Init.needEditorFocus=!1:(zmComp.setFocusOption(o,"text"),ZE_Init.needEditorFocus=!0),ZE_Init.fileUpload=zmComp.editorDropUpload,ZE_Init.toolbarOrder=zmCUtil.getTabToolbar(),_zm.isOfflineLockAvailable()&&(ZE_Init.loading=!1);var s,p,l={id:"zmEdi_"+o};l.toolbarOrder=zmCUtil.getTabToolbar({}),l.contentChanged=function(){zmail.showFeature&&zmComp.debounceSave(o);var e=zmComp.getEditor(o).getContent({plaintext:!0}),t=zmComp.getInitialContent(o);t&&(t=$.trim(t)),e&&(e=$.trim(e)),t!==e&&zmComp.setModified(o,1)},s=o,(p=l).getSmiley=function(e){return zmSmiley.getSmiley(e)},p.handleAutoFill=!0,p.getNewAutofillContacts=zmCUtil.getContacts,p.getDraftImageReplacedContent=function(e){var t=zmail.Utils.DOM;e.cmpId=e.cmpId.split("_")[1];var o=A[e.cmpId].inlinemapObj;if(1<=Object.keys(o).length){var n=Object.keys(o),i=n.length,a=document.createDocumentFragment();a.appendChild(zdom("div",null)),t.__dangerouslySetInnerHTML(a.firstChild,e.content);for(var m=a.firstChild.getElementsByTagName("img"),r=m.length,d=0;d<i;d++)for(var s=0;s<r;s++)m[s].getAttribute("src")===n[d].replace(/&amp;/g,"&")&&(m[s].src=o[n[d]].replace(/&amp;/g,"&"));return a.firstChild.innerHTML}},p.triggerOnMention=function(e){try{if(A[s]&&!A[s]._atMentionObj&&(A[s]._atMentionObj=[]),A[s]._atMentionObj&&-1===A[s]._atMentionObj.indexOf(e.eid)){A[s]._atMentionObj.push(e.eid);var t=e.fn+" <"+e.eid+">";zmComp.cmpSetContact(s,"to",t)}}catch(e){zmComp.debugLog(e)}},l=u(o,l=p),"plaintext"===e&&(l.mode="plaintext"),"w"!==zmComp.getType(o)?("plaintext"===e&&(t=ZE.getText(t)),l.content=t):zmComp.setEditorContent(o,t),l.isResizeRequired=!0,l.customAttachArr=function(){var e=[],t=["custom",E.attachment,"zei-attachment",function(e){zmComp.triggerCloudUpload(e)}];return e.push(t),e},l.getSpellcheckContent=function(){return{id:"zmail_extra"}},l.modeChangeMessage=E.editorModeChangeMessage,l.showModeChgMsg=!1,l.customTooltip=!0,l.systemFontFamily=zmAdHocSettings.getFont(),zmail.isInternalOrgUser&&(l.addSmartSuggestion=!0);var c="ltr";return 1===zmail.userOptions.typeOption&&(c="rtl"),l.textDirection=c,ZE_Init.editorCoreLoaded.then(function(){ZE_Init.allowZiaInteg=!0,d=ZE.create(l),zmComp.setEditor(o,d);var e;d.afterEditorLoad((e=o,function(){zmComp.postEditorLoad(e),$.publish("editorLoaded",e)})),i.resolve()}),i.promise()},x=function(e,t,o){var n=$.Deferred(),i=zmComp.getSMType(e);return g(e,i,o,t).done(function(){n.resolve()}),n.promise()},v=function(e,t){e&&A[e]&&("fwdi"===t?o({field:"to",composeID:e}):A[e].info&&!A[e].info.disableScrollIntoView&&$.q("#zmEdi_"+e).get(0).scrollIntoView())},k=function(a){if(a){if(!zmail.dndComp)return!1;(new zmail.dndComp.Drop).init(a,{onDrop:function(e){var t,o=e.dragObj;"draggingAtt"===e.dragObj.id?t=o.type.attList:"attachView"===e.dragObj.id&&(t=o.type.attObj);var n=$.e(a).attr("id").split("_")[1],i={NEWATT:t};zmComp.insertAttachment(n,i),zmComp.hideDrag()},onDragOver:function(){return{allowDragOver:!0}}})}},j=function(m,e){zmComp.removeDiscard(),function(e,t){var o={appname:E.nosubject,defaultAppName:zmText.get("mailsuite","compose"),appId:e,data:{CNodes:"2"},onDelete:zmComp.delCompObj,noPreview:!0,appIcon:"msi-edit",shortcuts:zmshCut.compose,allowDefaultShortcutScope:!1,titleProvider:function(){return zmComp.getSubject(e)||E.compose},hashKey:"compose",hashChangeHandler:function(e){zmUtil.debugLog("Compose hash url changed",e,this)}};if(zmsuite.isWorkspaceAvailable(e))t.restore&&zmsuite.resetWorkspace(e,o);else{if(!zmsuite.setWorkSpace(o))return;zmsuite.showWorkSpace(e)}}(m,e);var t=zmsuite.getCenter(m)[0].getNodes(),o=["msi-send SC_thm",{txt:E.send}];0<zmComp.getDefault().outIntr&&o.push("msi-barrow");var n={iconList:o,tooltip:E.send,data:"s",dropAction:!0,customClass:"SCtxt SCBtn"},i={iconList:["msi-schdRecur"],tooltip:E.schedule+" / "+E.recurring,data:"cmp_schedule",separator:!0},a={iconList:["msi-reminder"],tooltip:zmText.get("zmreminder").watch.remind,data:"watch",separator:!0},r={iconList:[{txt:E.save_draft,hide_txt:!0},"msi-barrow"],tooltip:E.save_as_draft,data:"svedrp",dropAction:!0},d={iconList:["msi-trash"],tooltip:E.discard_draft,data:"d",separator:!0};"outbox"===zmComp.getMode(m)&&(d.tooltip=E.discardTxt);var s={iconList:["msi-action"],tooltip:E.options,separator:!0,data:"o"},p={iconList:[{txt:E.sharedraft,hide_txt:!0}],data:"cmp_share",separator:!0},l={iconList:["msi-priority"],tooltip:E.priority,data:"p",separator:!0},c=[{groupId:"sendOptions",actionArr:[n]},{groupId:"compSchedule",actionArr:[i]}];zmComp.isZohoAcc(m)&&c.push({groupId:"remind",actionArr:[a]}),c.push({groupId:"compPriority",actionArr:[l]}),c.push({groupId:"compOptions",actionArr:[s]});var u=[{groupId:"saveOptions",actionArr:[r]},{groupId:"compShare",actionArr:[p]}];u.push({groupId:"discard",actionArr:[d]}),u.push({groupId:"compComment",actionArr:[{iconList:["msi-comment"],separator:!0,data:"cmp_cmt"}]});var f={list:{left:c,right:u},clk:function(e,t,o){var n,i,a=e.target||e.srcElement;n=$.e(a).closest("li"),"s"===o?((i={action:"compose",sendIm:!1}).cmpId=m,i.id="zm_SndLst",zmCDrop.showDropDown(e,i)):"cmp_schedule"===o?((i={}).id=m,i.ele=n,i.title=E.schedule+" / "+E.recurring,i.component="compose",i.type=1,zmSchedule.initScRec(i)):"d"===o?zmComp.discardCmp({cmpId:m}):"p"===o?(zmCDrop.show({cmpId:m,par:n,id:"zm_priLst"}),zmUtil.stopEvents(e)):"o"===o?zmCDrop.show({id:"zm_compactLst",par:n,cmpId:m}):"cmp_cmt"===o?zmComp.toggleComment(m):"watch"===o?((i={}).msgId=m,i.loadType="popup",i.openWatch="compose_tab",i.elem=n,zmWatch.showWatch(i)):"svedrp"===o&&("msi-barrow"===t?(zmCDrop.show({id:"zm_SveLst",par:n,cmpId:m}),zmUtil.stopEvents(e)):zmComp.updateDraft({cmpId:m}))}};return t[0].push(f.list),t[0].setListener("click",f.clk),zmsuite.renderWorkSpace(),t[1].$el},h=function(e,t){var o=t.msgId||"";e=e||{},(t=t||{}).msgId&&(o=t.msgId);var n,i="compose";if(t.mode&&(i=t.mode),o){var a=zmComp.getMailContent(o,e);if(o&&$.isEmptyObject(a))return _zm.succErrMsg("e",E.errorMsg,{hideAfter:2e3}),!1}if(o&&e.tdata){var m=zmComp.draftParentId(o,e.tdata);m&&(t.draftParentId=m)}["template","compose","fwdme"].includes(i)||(n=zmComp.getOpenedTabId(t,A));var r=!1;if(n){var d=zmComp.getSmartData(n);!zmsuite.isWorkspaceAvailable(n)&&d&&d.appId?(zmsuite.showExistingApp(d.appId),r=!0):zmsuite.isWorkspaceAvailable(n)?(zmsuite.showExistingApp(n),r=!0):delete A[n]}if(!r){if(n=t.restore?t.restoreAppId:zmUtil.getCmpAppId(),!t.restore&&zmsuite.isWorkspaceAvailable(n))return zmsuite.showExistingApp(n),!1;if(zmComp.updateCmpSet(n),A[n]=new zmComp.newInstance(i),zmComp.setType(n,"t"),t.info&&zmComp.setInfo(n,t.info),t.draftParentId&&(A[n]._draftParentId=t.draftParentId),t.fol_opt&&"tmp"===t.fol_opt&&(A[n].fol_opt="tmp"),t.tempId&&zmComp.setTempId(n,t.tempId),t.info&&t.info.deferredObj&&t.info.deferredObj.resolve){var s=$.Deferred(),p=$.Deferred();A[n].editorDeferred=s,A[n].attachmentDeferred=p,$.when(s,p).done(function(){try{t.info.deferredObj.resolve(n)}catch(e){}})}var l=j(n,t),c={cmpId:n,type:"t"},u=zmCompOpt.recipientDOM(c);R({composeID:n,parentDOM:$.query(".recipient-fields",u),nextDOMAnchor:$.query(".subject-field",u)});var f=$.e(zmCompOpt.editorDOM(c)),z=$.e(zmCompOpt.dragDOM(c)),C=$.e(zmCompOpt.attSecDOM(c)),g=$.e(zmCompTemp.attEdiorDOM());g.appendDOM(f),g.appendDOM(C),g.appendDOM(z),l.appendDOM(u),l.appendDOM(g),zmComp.attActionBind(n,C),k(z[0]),l.addClass("zmCnew"),zmsuite.getCenter(n)[0].$el.addClass("zm_Ctab");var v=!1;if(o||!$.isEmptyObject(e)){var h,I=!0;if(t.loadType&&"newcompose"===t.loadType&&(I=!1),I&&(e=function(e,t,o,n,i){if(zmContentCache.isCached(t)&&!i.newdata)n=zmContentCache.get(t);else{var a={mdata:n.mdata},m=!1;i.shId&&i.dbData&&(m=!0),m||-1!==["outbox","draft","template"].indexOf(o)||zmUtil.prevCache(t,a),n=a.mdata}return n&&!$.isEmptyObject(n)&&zmComp.setMailData(e,n),zmComp.updateSMType(e),n}(n,o,i,e,t)),e&&e.shId||t&&t.shId){var _=e.shId||t.shId;zmComp.setShareId(n,_)}if(e&&e.groupId&&(A[n].groupId=e.groupId,A[n].streamsView=e.streamsView),A[n].info&&A[n].info.groupId&&(A[n].groupId=A[n].info.groupId),A[n].info&&A[n].info.streamsView&&(A[n].streamsView=A[n].info.streamsView),A[n].groupId&&A[n].streamsView&&e.REPLYFROM&&e.REPLYFROM!==zmComp.getFromAddr(n)&&(A[n].groupEmailId=e.REPLYFROM),zmComp.setMymId(n,o),zmComp.setFwdInlineMode(n,e),3===e.STATUS2ID&&o&&t.draft_opt&&zmComp.setAskReceipt(n,"yes"),"p"===zmUtil.getComposeType()&&A[n]._draftParentId&&zmComp.updateAllShowDraftedAsTab(A[n]._draftParentId),A[n]._draftParentId&&!A[n].inlineMode){var D=zmComp.getModeObj("string",e.STATUS2ID);A[n].inlineMode=D,A[n].mode=D}if(t.draft_opt&&(A[n].discard_Id=o,A[n].enableDiscard=!0,e.MAILID&&(A[n].discard_mailId=e.MAILID),e.INREPLYTO&&(A[n].discard_inReplyTo=e.INREPLYTO),e.REFHEADER&&(A[n].discard_refHeader=e.REFHEADER)),e.PRIORITY){var b=e.PRIORITY,S=!1,O=!1;("template"===t.mode||o&&t.draft_opt)&&(O=!0),2!==b&&4!==b||(S=!0),!O||2!==b&&4!==b||(S=!0),(S||2===b)&&(v=!0,zmComp.updPriority(n,b))}if(e.RMOBJ&&!$.isEmptyObject(e.RMOBJ)&&zmComp.isZohoAcc(n)&&((h=e.RMOBJ).WT||(h=h[h.length-1])),o&&(t.draft_opt||"outbox"===i)&&h&&(zmWUtil.addWatchTheme(n),A[n].RMOBJ=h,A[n]._reminder_draft=!0),zmSchedule&&e.SCO&&0!==e.SCO.OT){1===e.SCO.OT?zmSchedule.processScheduleObject(n,e.SCO):2===e.SCO.OT&&zmSchedule.processRecurringObject(n,e.SCO);var M=zmsuite.getCenter(n)[0].getNodes()[0].$el;$.e(M).find("[data-event='cmp_schedule']").addClass("SC_thm")}o&&zmCUtil.setTempFolId(n,o),zmComp.constructComp(n,i,e)}else zmComp.loadAttachment(n);zmsuite.showWorkSpace(n),zmComp.hideComment(n),v?zmsuite.getCenter(n)[0].getNodes()[0].showGroup("compPriority"):zmsuite.getCenter(n)[0].getNodes()[0].hideGroup("compPriority"),A[n].prm&&"note"===A[n].prm.entityType&&zmComp.enableSave(n),o&&t.dbData&&"outbox"===i&&zmComp.setOutboxUUId(n,o);var y=zmCompContent.composeContent(n,i,e);x(n,i,y).done(function(){try{A[n].editorDeferred&&A[n].editorDeferred.resolve()}catch(e){}});var T=!1;if(["outbox","template","eanew","fwdme"].includes(i)&&(T=!0),A[n].streamsView&&A[n].groupId&&(T=!0),"p"===zmUtil.getComposeType()&&!T){var w=zmComp.getMessageInfo(n,A);zmComp.updateShowDraftedAfterNewSave({cmpId:n,msgId:w.msgId,draftId:w.draftId,type:"t"})}zmComp.focusToField(n),zmCUtil.resizeRepDOM(n),zmComp.updAtMention(n),zmComp.fromAddrDropBind(n),zmComp.updateTitle(n),zmComp.blurOutSubject(n),zmComp.startClock(n),t.restore||zmUtil.addCmpAppId(),!o||"draft"!==i&&"template"!==i||(zmComp.cmpHashURL(n,["draft",o]),zmComp.cmpRestoreState(n,{mode:"draft",msgId:o})),o&&t.draft_opt&&zmComp.setDraftId(n,o),o&&"template"===i&&zmComp.setTemplateId(n,o),zmComp.shareDraftOption(n,o,t),"outbox"===i&&(_zm.isOfflineSyncActive()&&t.dbData&&zmCompAdapter.updateMessageData(o,zmail.folId.oId,!0),zmCUtil.updateOutboxView())}},d=function(e){for(var t=[],o=0;o<e.length;o++)void 0!==e[o]&&t.push(e[o]);return e=t},e=function(){var e=zmComp.getCurrentCompId();if(e&&A[e]){var t=zmComp.getType(e);"t"===t?zmComp.setTabHeight(e):"w"===t&&zmComp.setWindowHeight(e),zmCUtil.regenerateToolbar(e)}zmComp.resizeRepDOMList(),zmComp.resizeDialog(),zmComp.resizeAllTab()},a={cleanArray:d,getSize:function(e){if(!isNaN(e)){var t=Math.floor(Math.log(Number(e))/Math.log(2));t<1&&(t=0);var o=Math.floor(t/10);return(e=Number(e)/Math.pow(2,10*o)).toString().length>e.toFixed(1).toString().length&&(e=e.toFixed(1)),e+[" bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"][o]}},I18N:E,windowCmpId:null,updateToolbarForSignature:function(e){if(!_zm.isOfflineSyncActive()&&zmail.Signature){var o=zmComp.getEditor(e);zmail.Signature.initialize().done(function(){if(0<zmail.Signature.adminAddedAcc.length){var t=zmComp.getFromAddr(e);zmail.Signature.adminAddedAcc.forEach(function(e){e===t?$.e(o.toolbarobject.signature).addClass("zmDisabled"):$.e(o.toolbarobject.signature).removeClass("zmDisabled")})}}).fail(function(){})}},getFwdAtt:function(e,t){var o,n,i,a={},m=[],r="";if(e&&e.length)for(var d=e.length,s=0;s<d;s++)n=e[s],(o={}).mId=n,o.thrd=!1,!(i=zmUtil.getMailObj(n))&&opener&&opener.document.domain===document.domain&&(i=opener.zmUtil.getMailObj(n)),o.sub=i.SB,r=i.SB,m.push(o);if(t&&t.length)for(var p=t.length,l=0;l<p;l++)n=t[l],o={thrd:!0},!(i=zmUtil.getMailObj(n))&&opener&&opener.document.domain===document.domain&&(i=opener.zmUtil.getMailObj(n)),o.mId=i.T,o.sub=i.SB,""===r&&(r=i.SB),m.push(o);return a.subject=r,a.fwdLst=m,a},cmpFwd:function(e){var t,o,n={},i=zmUtil.getFwdArr(e);if(i){i.mId&&i.mId.length&&(n.FWDMSG=i.mId),i.tId&&i.tId.length&&(n.FWDTID=i.tId);var a={act:"compose",mode:"fwdme"};i.folderId&&(a.folderId=i.folderId,t=i.folderId),t&&zmUtil.isSharedFolder(t)&&(o=zmUtil.getShareId(t)),o&&(a.shId=o),a.loadType="newcompose",h(n,a)}},compose:function(e,t){h(e,{info:t,loadType:"newcompose"})},cmpReply:function(e){var t=e.loadType||"";e.draftId&&(e.mode="draft");var o=e.mode||"compose",n=e.type,i=e.msgId,a=e.loadApp&&"mail"===e.loadApp&&"p"===n;if(a){var m=e.streamsView&&e.groupId;(o&&["outbox","template","eanew","fwdme"].includes(o)||m)&&(a=!1)}if("drafted"!==t||a){var r;if(a){if(!(r=zmComp.previewElementDOM(e))&&"drafted"===t)return;e.messageElem=r;var d,s=!1;if(zmComp.isInlinePreContainerDOM(e)&&(d=zmComp.getInlinePreContainerCmpId(i))&&(s=!0),s){if(zmComp.checkInlinePreLoadedDOM(e,A[d])){var p=zmComp.getDraftId(d),l=zmComp.isUnsavedChange(d,A[d]);p||l||zmComp.openPreLoadedView(d,e.mode),v(d,zmComp.getMode(d))}else{var c=zmComp.getInlineDraftContainer(e);e.prevDOM=c,"drafted"===t?zmComp.showDraftedContainer(c,zmComp.getType(d)):zmComp.loadPreview(d,e)}return}var u=!1;if((d=zmComp.getOpenedInlineId(e,A))&&"t"===zmComp.getType(d)&&(u=!0),u&&"drafted"===t){var f=zmComp.getInlineDraftContainer(e);return e.prevDOM=f,void zmComp.showDraftedContainer(f,"t")}if(u){var z=zmComp.getSmartData(d);if(!zmsuite.isWorkspaceAvailable(d)&&z&&z.appId)return void zmsuite.showExistingApp(z.appId);if(zmsuite.isWorkspaceAvailable(d))return void zmsuite.showExistingApp(d)}}var C="fwdi"===e.mode&&i;if(r)!C||e.externalImagePopup||zmUtil.isChildWindow()||e.draftId||zmComp.shareEmailDialog(i),zmComp.cmpPrev(e);else{if(zmsuite.isMaxLimitReached())return;"fwdme"===o?zmComp.cmpFwd(i):(!C||e.externalImagePopup||zmUtil.isChildWindow()||zmComp.shareEmailDialog(i),zmComp.cmpRF(i,o,e))}}},cmpPrev:function(e){var t=e.msgId,o={};if(e.data?(o=e.data).mdata&&(o=o.mdata):o=o.mdata?o.mdata:zmContentCache.get(t),$.isEmptyObject(o)||!e.prevElem.length)return _zm.succErrMsg("e",E.errorMsg,{hideAfter:2e3}),!1;if(zmCUtil.getFolId(t)){var n=zmCUtil.getFolId(t);zmUtil.isSharedFolder(n)&&(e.shId=zmUtil.getShareId(n))}if(e.prevDOM=zmComp.getInlineDraftContainer(e),!e.prevDOM.length)return!1;!function(e){zmComp.removeDiscard();var t=zmUtil.getCmpAppId(),o=e.mode,n=e.msgId,i=e.draftId;zmComp.updateCmpSet(t),A[t]=new zmComp.newInstance(o),zmComp.setType(t,"p");var a=(A[t].info=e).data;a&&!$.isEmptyObject(a)&&zmComp.setMailData(t,a),zmComp.updateSMType(t);var m=e.prevDOM,r={cmpId:t,type:"p",msgId:n};i&&(r.draftId=i);var d=zmCompOpt.headerDOM(r),s=zmCompOpt.recipientDOM(r);R({composeID:t,parentDOM:$.query(".recipient-fields",s),nextDOMAnchor:$.query(".subject-field",s)});var p=$.e(zmCompOpt.editorDOM(r)),l=$.e(zmCompOpt.attSecDOM(r)),c=$.e(zmCompOpt.dragDOM(r)),u=$.e(zmCompTemp.attEdiorDOM());u.appendDOM(p),u.appendDOM(l),u.appendDOM(c);var f=$.e(zmCompTemp.inlinePrevDOM(t,n));f.appendDOM(d),f.appendDOM(s),f.appendDOM(u),zmComp.attActionBind(t,l),k(c[0]),m.appendDOM(f,{clear:!0}),zmComp.hidePreviewRepliedOption(t,A),zmComp.updateShowDraftedAsEdited(t,n,"p"),zmComp.setMymId(t,n),i&&(zmComp.setMymId(t,e.draftId),A[t].discard_Id=i),e&&e.shId&&zmComp.setShareId(t,e.shId),zmComp.updateDataFrom(t,o,a),zmComp.updateSubject(t,o,a.SUBJECT),3===a.STATUS2ID&&zmComp.setAskReceipt(t,"yes"),zmComp.setFwdInlineMode(t,a),i&&(A[t].enableDiscard=!0,a.MAILID&&(A[t].discard_mailId=a.MAILID),a.INREPLYTO&&(A[t].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(A[t].discard_refHeader=a.REFHEADER)),n&&zmCUtil.setTempFolId(t,n);var z=zmCompContent.composeContent(t,o,a);zmComp.updateRecipients(t,o,a),x(t,o,z),zmComp.focusToField(t),zmCUtil.resizeRepDOM(t),zmComp.updAtMention(t),zmComp.fromAddrDropBind(t),v(t,o),zmComp.startClock(t),zmUtil.addCmpAppId(),zmComp.blurOutSubject(t)}(e)},cmpRF:function(e,t,o){var n,i;if(e)n=e;else{var a=zmUtil.getSelectedMails(),m=[];a[0].length?m=a[0]:a[1].length&&(m=a[1]),n=m[0]}"template"!==o.mode&&(i=zmComp.getOpenedTabId(o,A));var r=!1;if(i){var d=zmComp.getSmartData(i);!zmsuite.isWorkspaceAvailable(i)&&d&&d.appId?(zmsuite.showExistingApp(d.appId),r=!0):zmsuite.isWorkspaceAvailable(i)?(zmsuite.showExistingApp(i),r=!0):delete A[i]}if(r)return!1;var s={accId:zmail.accId,act:"compose"};"outbox"===t&&(s.mode=t);var p={mode:t,msgId:n};if(zmCUtil.getFolId(n)){var l=zmCUtil.getFolId(n);if(zmail.folId.teId===l&&(p.fol_opt="tmp",p.tempId=n),zmail.folId.dId===l){p.draft_opt=!0;var c=zmComp.draftThreadId(n);c&&(p.draft_threadId=c)}"outbox"===t&&(s.folId=l,p.folId=l),zmUtil.isSharedFolder(l)&&(s.shId=zmUtil.getShareId(l),p.shId=zmUtil.getShareId(l))}var u=!0;o&&!$.isEmptyObject(o)&&((p.info=o).restore&&(p.restore=o.restore,p.restoreAppId=o.restoreAppId),o.msgId&&(s.msgId=o.msgId),o.accId&&(s.accId=o.accId),o.entityId&&(s.entityId=o.entityId),o.groupId&&(s.groupId=o.groupId),o.streamsView&&(s.streamsView=o.streamsView),o.entityType&&(s.entityType=o.entityType),o.actionType&&(s.actionType=o.actionType)),zmContentCache.isCached(n)&&!zmContentCache.get(n).SHRINKED&&"outbox"!==t&&(u=!1),p.draft_opt&&(u=!0,p.newdata=!0),o.reqData&&(u=!0);var f={};if(o.dbData?(u=!1,f=o.data,p.dbData=!0):f=zmContentCache.get(n),o.dbData&&(u=!(p.newdata=!0)),u){s.msgId=n,s.vfc=!0,p.draft_threadId&&(s.summary=!0,s.thId=p.draft_threadId);var z={u:zmail.conPath+"/compose.do",t:"GET",act:"compose",fn:h,p:s,ep:p};zmAjq.XHR(z)}else h({mdata:f},p)},setCmpHeader:function(e,t){var o=zmComp.getMailId(e),n=zmComp.getInReplyTo(e),i=zmComp.getRefHeader(e);["outbox","draft","compose","eanew","fwdme"].includes(t)?(o&&(A[e].data_mailId=o),n&&(A[e].data_inReplyTo=n),i&&(A[e].data_refHeader=i)):["reply","replyall","fwdi"].includes(t)&&(o&&(A[e].data_inReplyTo=o),n&&(A[e].data_refHeader=zmCUtil.addRefHeader(i,n)))},getCmpHeader:function(e){var t={};return A[e].data_mailId&&(t.mailId=A[e].data_mailId),A[e].data_inReplyTo&&(t.inReplyTo=A[e].data_inReplyTo),A[e].data_refHeader&&(t.refHeader=A[e].data_refHeader),t},resetRepView:function(e){n({field:"to",composeID:e}),n({field:"cc",composeID:e}),n({field:"bcc",composeID:e})},shCBc:function(e,t,o){var n,i={};"c"===t?(n="cc",i.ccBtn=!1):(n="bcc",i.bccBtn=!1);var a=m({field:n,composeID:e});$.element(a.component.dom).removeClass("SC_dyn"),m({field:"to",composeID:e}).component.setState(i),"setFocus"===o&&(r({field:n,composeID:e}),zmComp.setFocusOption(e,n)),zmComp.setHeight(e),window.event&&zmUtil.stopEvents(window.event)},editorDropUpload:function(e,t){var o=e.initobj.id.split("_")[1];zmComp.getAttRef(o).uploadFiles(t)},comClose:function(e){try{var t,o=e.cmpId;if(!A[o])return void zmComp.debugLog("Cmp cleared");var n="close",i=e.triggerType,a=!1,m=!1;if(i&&(["close_view_aftersend","close_preview_aftersave","close_outbox_afterdelete"].includes(i)&&(m=!0),"discard"===i&&(n="discard",a=!0),"close_view_aftersend"===i)){var r=A[o].info;r&&r.callback&&(t=r.callback)}var d,s=!0;if(!a&&!m){var p=zmComp.isUnsavedChange(o,A[o]),l=zmComp.isEmptyContent(o);p&&!l&&(zmComp.unsavedConfirm(o),s=!1)}e.msgTxt&&(d=e.msgTxt);var c=zmComp.getType(o);if(s){var u={cmpId:o,cmpDObj:A,triggerFrom:n,triggerType:i};zmail.isComposeMail&&"w"===c?zmComp.windowClose(o,u):"p"===c?zmComp.prvClose(u):"d"===c?zmComp.dialogClose(u):"st"===c?zmComp.smartClose(u):"t"===c&&zmComp.tabClose(u)}t&&t({cmpId:o,status:!0}),d&&!zmail.isComposeMail&&zmUtil.succErrMsg("s",d)}catch(e){}},triggerTemplate:function(e){var t={cmpId:e.split("_")[1],tmpInsert:zmCDrop.tmpInsert,insertCRMTemplate:zmCDrop.insertCRMTemplate,showCrmTemplates:!0};zmAppLoader.load("TemplateCategory").done(function(){ZMail.Template.init({start:1,end:21},"all",t)})},tempOverWrite:function(t){var e=E.template_overwrite_alert,o=$.q(zdom("h4",null,e)),n=$.q(zdom("div",null));n.attr("id","zmcmp_tempatt_"+t),n.appendDOM(o);var i={cmpId:t};i.$content=n,i.ignoreMouseDown=!1,i.dialogDidMount=function(o){($.q("#zmcmp_tempatt_"+t)[0].zmcmp_confirm_dialog_ele=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},i.defaultNavigator=!1,i.navigator=new zmail.Navigator({onEscape:function(){$.q("#zmcmp_tempatt_"+t)[0].zmcmp_confirm_dialog_ele.remove()}}),i.buttons=[{name:E.ok,callback:function(e){zmComp.sendMail({action:"stemplate",sendIm:!1,cmpId:t,tmpUpdate:!0}),e.remove()}},{name:E.cancel,isCancel:!0,callback:function(e){e.remove()}}],Dialog.new(i)},remindAtt:function(t,e){var o=E.attachment_reminder_alert;o=zmText.applyArgs(o,{USER_INPUT:""});var n=$.q(zdom("div",{id:"zmcmp_confirm_"+t}));$.e(n).dangerouslySetInnerHTML(o),$.e(n).find("b").text(' " '+e[0]+' " ');var i={cmpId:t,$content:n,ignoreMouseDown:!1,dialogDidMount:function(o){($.q("#zmcmp_confirm_"+t)[0].zmcmp_confirm_dialog_ele=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},defaultNavigator:!1};i.navigator=new zmail.Navigator({onEscape:function(){$.q("#zmcmp_confirm_"+t)[0].zmcmp_confirm_dialog_ele.remove()}}),i.buttons=[{name:E.ok,callback:function(e){zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(t),cmpId:t,actVal:"attfalse"}),e.remove()}},{name:E.cancel,isCancel:!0,callback:function(e){e.remove()}}],Dialog.new(i)},cmpConfirm:function(e){var t,n=e.cmpId,o=e.textMsg;A[n]&&A[n].discard_Id&&(t=A[n].discard_mailId);var i=E.discardTxt;t&&(i=E.deleteTxt);var a=$.q(zdom("div",null));a.attr("id","zmcmp_alt_"+n),a.text(o);var m={cmpId:n};return m.$content=a,m.ignoreMouseDown=!1,m.dialogDidMount=function(o){($.q("#zmcmp_alt_"+n)[0].zmcmp_alt_dialog_ele=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},m.defaultNavigator=!1,m.navigator=new zmail.Navigator({onEscape:function(e){e.remove()}}),m.buttons=[{name:E.save_draft,callback:function(e){var t;t=n,zmComp.sendMail({action:"sdraft",sendIm:!1,cmpId:t,actVal:"close"}),e.remove()}},{name:i,isCancel:!0,callback:function(e){zmComp.discardCmp({cmpId:n}),e.remove()}}],Dialog.new(m),!1},discardCmp:function(e){var t=e.cmpId;A[t]?"outbox"===zmComp.getMode(t)?zmCUtil.discardOutboxConfirm(t):(A[t].newsave=!0,zmComp.discardDraft(e)):zmComp.debugLog("Cmp cleared")},discardDraft:function(e){var t,o,n=e.cmpId,i={cmpId:n};if(A[n]&&A[n].discard_Id&&(t=A[n].discard_mailId,o=A[n].discard_Id),t){var a={aId:A[n].accId,mode:"discard"};a.mailId=t,i.discard_Id=o,zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmComp.discardResp,p:a,csr:"s",ep:i,setSessionId:!0})}else zmComp.discardClose(i)},discardResp:function(e,t){if("success"===e.status){var o=t.cmpId;if(A[o]){var n=zmComp.getMessageInfo(o,A),i=n.msgId,a=n.draftId;a&&$.publish("/mail/msgDiscarded",[{draftId:a,msgId:i,actionType:"discard_draft"}]),zmComp.discardClose(t)}}},discardClose:function(e){var t=e.cmpId;A[t].viaDiscard=!0,e.triggerType="discard";var o=zmComp.isEmptyContent(t);!A[t].enableDiscard||o?zmComp.comClose(e):(A[t].discard_close=!0,zmComp.prevCmpObj(t,A),zmComp.comClose(e),zmail.isComposeMail||zmUtil.isChildWindow()||zmComp.discardMsg(t),e.discard_Id&&zmUtil.deleteMsg(e.discard_Id))},delCompObj:function(e){var t=!1;if(A[e]){try{var o=zmComp.isUnsavedChange(e,A),n="outbox"===zmComp.getMode(e),i=zmComp.getOutboxClose(e);if(o)if(n&&!i)zmCUtil.closeOutboxConfirm(e);else zmComp.isEmptyContent(e)?o=!1:zmComp.unsavedConfirm(e);else n&&!i&&zmCUtil.closeOutboxConfirm(e);if(o||n||(t=!0),t){var a=d(arguments).length;"p"===zmUtil.getComposeType()&&zmComp.updateAllContainerAfterClose(e,A,"close","tab_close"),1!==a||A[e].viaDiscard||zmComp.deleteCmpObj(e,A)}}catch(e){zmComp.debugLog(e)}return t}},cmpRevert:function(e){!function(e){A[e].discard_close=!1,A[e].viaDiscard=!1,A[e].commentObj="",A[e].loadDraftComment=void 0,zmComp.setType(e,"t");var t=j(e),o={cmpId:e,type:"t"},n=zmCompOpt.recipientDOM(o);R({composeID:e,parentDOM:$.query(".recipient-fields",n),nextDOMAnchor:$.query(".subject-field",n)});var i=$.e(zmCompOpt.editorDOM(o)),a=$.e(zmCompOpt.attSecDOM(o)),m=$.e(zmCompOpt.dragDOM(o)),r=$.e(zmCompTemp.attEdiorDOM());r.appendDOM(i),r.appendDOM(a),r.appendDOM(m),t.appendDOM(n),t.appendDOM(r),t.addClass("zmCnew"),zmsuite.getCenter(e)[0].$el.addClass("zm_Ctab"),zmComp.attActionBind(e,a);var d=A[e].prevObj;zmComp.reloadPrvObj(e,d),zmsuite.showWorkSpace(e),d.isPriority?(zmsuite.getCenter(e)[0].getNodes()[0].showGroup("compPriority"),zmComp.updatePriority(e)):zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compPriority"),zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compComment");var s=zmComp.getEditor(e),p=s.getContent()||"",l=s.mode;"plaintext"===l&&(p=p.split("\n").join("<br />"));var c=zmComp.getMode(e);g(e,l,p,c),zmComp.focusToField(e),zmCUtil.resizeRepDOM(e),zmComp.setHeight(e),zmComp.fromAddrDropBind(e),zmComp.updateTitle(e),zmComp.blurOutSubject(e),zmComp.isZohoAcc(e)||zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compShare")}(zmComp.revert_cmpId=e)},updShowMsg:function(e,t){var o,n=2e3;"u"===t&&(t="s",o=2e3),"s"===t?(n=1e3,$.q("#zm_smsg_"+e).attr("data-status","s")):"i"===t?$.q("#zm_smsg_"+e).attr("data-status","i"):"e"===t&&$.q("#zm_smsg_"+e).attr("data-status","e"),o&&(n=o),setTimeout(function(){"s"===$.q("#zm_smsg_"+e).attr("data-status")&&zmComp.hideMsg(e)},n)},hideMsg:function(e){$.q("#zm_smsg_"+e).removeClass().addClass("SC_msg")},removeMsg:function(){$.q("#zm_smsg_discard").remove()},removeDiscard:function(){clearTimeout(zmComp.discard_timer);var e=!0;zmComp.discard_cmpId&&zmComp.discard_cmpId===zmComp.revert_cmpId&&(e=!1),e&&delete A[zmComp.discard_cmpId],zmComp.removeMsg()},updateTitle:function(e,t){t||(t=$.q("#zmsub_"+e).val()),""===t&&(t=E.nosubject);var o=zmTab.getTabObject(e);o.appname=t,zmTab.updateTabLst(o)},discardMsg:function(e){if(zmComp.removeDiscard(),!$.q("#zm_smsg_discard").length){var t=zdom("div",{id:"zm_smsg_discard",className:"SC_msg SC_imsg"},zdom("span",null,E.discard_msg,zdom("u",{id:"zm_discard_back",style:{marginLeft:"7px"},className:"cursorPointer"},zdom("b",null,E.undo_discard)),zdom("i",{id:"zm_discard_close",className:"msi-close"})));$.q("body").appendDOM(t)}$.q("#zm_discard_back").off("click").on("click",function(){zmComp.cmpRevert(e)}),$.q("#zm_discard_close").off("click").on("click",function(){zmComp.removeDiscard()}),zmComp.discard_timer=setTimeout(function(){zmComp.removeDiscard()},6e3),zmComp.discard_cmpId=e},showMsg:function(t,e,o,n,i,a){var m=!1;e&&"s"!==e&&(m=!0);var r="";if("s"===e?r="SC_msg SC_smsg":"e"===e?r="SC_msg SC_emsg":"i"===e&&(r="SC_msg SC_imsg"),!n&&A[t]&&(n=zmComp.getType(t)),!$.q("#zm_smsg_"+t).length){var d,s=null;if(zmUtil.isChildWindow()||zmail.isComposeMail)s=$.q("body");else if(n&&"p"===n)s=zmsuite.getAppObj("zm_Container").centerObj.$el;else if(n&&"d"===n){s=A[t]._dDialog.$els.$contentWrapper}else s=n&&"st"===n?A[t].errorPar:zmsuite.getAppObj(t).centerObj.$el;zmail.isComposeMail&&(d={top:0});var p=zdom("div",{id:"zm_smsg_"+t,className:r,style:d});n&&"st"===n?s[0].appendChild(p):s.appendDOM(p)}var l,c=$.q("#zm_smsg_"+t);if(a&&"HTML"===a)o&&(o=(o=o.replace(/&lt;/g,"<")).replace(/&gt;/g,">")),l=zdom("span",null,zdom("font",{dangerouslySetInnerHTML:o}),zdom("i",{className:"msi-close"}));else if(a&&"retry"===a){l=zdom("span",null,zdom("font",null,o),zdom("font",{className:"zmBlinkText"},"..."),zdom("u",{id:"zm_sendRetry_"+t,style:{marginLeft:"7px"},className:"cursorPointer"},zdom("b",null,E.retry))),$.e(l).find("#zm_sendRetry_"+t).off("click").on("click",function(){var e=zmComp.getRetry(t);zmComp.sendMail(e)})}else if(a&&"resend"===a){l=zdom("span",null,zdom("font",null,o),zdom("u",{id:"zm_resendTry_"+t,style:{marginLeft:"7px"},className:"cursorPointer"},zdom("b",null,E.trysendingagain)),zdom("i",{className:"msi-close"})),$.e(l).find("#zm_resendTry_"+t).off("click").on("click",function(){var e=zmComp.getRetry(t);zmComp.sendMail(e)})}else l=zdom("span",null,zdom("font",null,o),zdom("i",{className:"msi-close"}));$.e(c).appendDOM(l,{clear:!0}),c.removeClass().addClass(r);var u=c.children("span").find("i");m?u.off("click").on("click",function(){zmComp.hideMsg(t)}):u.remove(),i&&(e=i),zmComp.updShowMsg(t,e)},triggerUpload:function(e){var t=zmComp.getCurrentCompId();e&&!zmComp.getCurrentCompId()&&(t=zmComp.zmsubStr(e,"zmEdi_")),zmComp.getAttRef(t).browseDesktop()},triggerCloudUpload:function(e){var t=zmComp.getCurrentCompId();!t&&e&&(t=zmComp.zmsubStr(e,"zmEdi_")),zmComp.getAttRef(t).init()},triggerTeamDrive:function(e){var t=zmComp.getCurrentCompId();!t&&e&&(t=zmComp.zmsubStr(e,"zmEdi_")),zmComp.getAttRef(t).init("teamDrive")},getCenter:function(e){var t,o;A[e]&&(A[e].type&&(o=A[e].type),o&&"t"===o?t=zmsuite.getAppObj(e).centerObj.$el:o&&"d"===o&&(t=$.q("#zmQuick_compose_"+e)));return t},resizeWindow:function(){try{for(var e in A)A[e].type&&"w"===A[e].type&&zmComp.setWindowHeight(e)}catch(e){zmComp.debugLog("ZM: Resizing",e)}},resizeRepDOMList:function(){try{for(var e in A)A[e]&&(A[e].resizeWidth=!0,A[e].resizeTab=!0)}catch(e){}},resizeAllTab:function(){try{for(var e in A)A[e]&&(A[e].resizeTab=!0)}catch(e){}},resizeCmpTab:function(){var e=zmComp.getCurrentCompId();e&&A[e]&&(A[e].resizeTab=!1,"t"===zmComp.getType(e)&&zmComp.setTabHeight(e)),zmComp.resizeAllTab()},getDialogObj:function(){var e=[];for(var t in A)"d"===zmComp.getType(t)&&e.push(t);return e},resizeDialog:function(){var e=[],t=$.e(zmail.win).height();try{for(var o in A)"d"===zmComp.getType(o)&&e.push(o);if(e.length)for(var n=e.length,i=0;i<n;i++){var a=e[i];a&&450<t&&zmComp.setQuickHeight(a)}}catch(e){}},showDrag:function(e){try{for(var t in A)A[t]&&zmCompOpt.showDrag(t,e)}catch(e){}},hideDrag:function(){try{for(var e in A)A[e]&&zmCompOpt.hideDrag(e)}catch(e){}},moveTab:function(e){var t=e.cmpId,o=e.draftId;zmComp.prevCmpObj(t,A),A[t].info.prevDOM.find(".zm_cmp").remove();var n=$.q("div[id$='_cmpInline_"+e.msgId+"']");n.each(function(){n.parent().children(":first").find(".zm_ry").hide();var e=$.e(this).find("div[ref='inlineContent']");zmComp.showDraftedContainer(e,"t")}),function(e,t){zmComp.setType(e,"t");var o=j(e),n={cmpId:e,type:"t"},i=zmCompOpt.recipientDOM(n);R({composeID:e,parentDOM:$.query(".recipient-fields",i),nextDOMAnchor:$.query(".subject-field",i)});var a=$.e(zmCompOpt.editorDOM(n)),m=$.e(zmCompOpt.dragDOM(n)),r=$.e(zmCompOpt.attSecDOM(n)),d=$.e(zmCompTemp.attEdiorDOM());d.appendDOM(a),d.appendDOM(r),d.appendDOM(m),o.appendDOM(i),o.appendDOM(d),zmComp.attActionBind(e,r),o.addClass("zmCnew"),zmsuite.getCenter(e)[0].$el.addClass("zm_Ctab");var s=A[e].prevObj;zmComp.reloadPrvObj(e,s),zmsuite.showWorkSpace(e),zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compPriority"),zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compComment"),A[e].enableDiscard=!0;var p=zmComp.getEditor(e),l=p.mode,c=zmComp.popupTrimmed(e,p);c=c||"","plaintext"===l&&(c=c.split("\n").join("<br />"));var u=zmComp.getMode(e);g(e,l,c,u),zmComp.focusToField(e),zmCUtil.resizeRepDOM(e),zmComp.setHeight(e),zmComp.updAtMention(e),zmComp.fromAddrDropBind(e),zmComp.updateTitle(e),zmComp.blurOutSubject(e),_zm.isStreamsEnabled()&&t&&zmail.isOrg&&zmComp.isZohoAcc(e)&&zmComp.draftComments(e,t,"draft_onload")}(t,o)},loadPreview:function(e,t){zmComp.prevCmpObj(e,A),A[e].info.prevDOM.find(".zm_cmp").remove(),$.q("div[id$='_cmpInline_"+t.msgId+"']").each(function(){$.e(this).parent().children(":first").find(".zm_ry").hide();var e=$.e(this).find("div[ref='inlineContent']");zmComp.showDraftedContainer(e,"p")}),t.messageElem.find(".zm_ry").hide(),function(e,t){zmComp.removeDiscard();var o=t.msgId,n=t.prevDOM;if(n.length){if(n){var i={cmpId:e,msgId:o,type:"p"},a=zmCompOpt.headerDOM(i),m=zmCompOpt.recipientDOM(i);R({composeID:e,parentDOM:$.query(".recipient-fields",m),nextDOMAnchor:$.query(".subject-field",m)});var r=$.e(zmCompOpt.editorDOM(i)),d=$.e(zmCompOpt.attSecDOM(i)),s=$.e(zmCompOpt.dragDOM(i)),p=$.e(zmCompTemp.attEdiorDOM());p.appendDOM(r),p.appendDOM(d),p.appendDOM(s);var l=$.e(zmCompTemp.inlinePrevDOM(e,o));l.appendDOM(a),l.appendDOM(m),l.appendDOM(p),zmComp.attActionBind(e,d),k(s[0]),n.appendDOM(l,{clear:!0})}A[e].info=t;var c=A[e].prevObj;zmComp.reloadPrvObj(e,c);var u=zmComp.getEditor(e),f=u.mode,z=u.getContent();g(e,f,z,zmComp.getMode(e)),zmComp.setHeight(e),zmComp.focusToField(e),zmCUtil.resizeRepDOM(e)}}(e,t)},backupAttCompRef:function(e){var t=zmComp.getAttRef(e);if(A&&A[e]&&t){var o=t.getAllAttachedList(!0);t.clearStoreAttachments(),A[e].attCompRefList=o}},txtFocus:function(e){zmComp.setElemFocus($.e(e))},updatePriority:function(e){var t=zmComp.getPriorityDom(e).elem.find("i.msi-priority"),o=zmComp.getPriority(e);"Low"===o?t.removeClass("SC_red SC_blue").addClass("SC_blue"):"High"===o?t.removeClass("SC_red SC_blue").addClass("SC_red"):t.removeClass("SC_red SC_blue")},updPriority:function(e,t){var o="Medium",n=$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("i.msi-priority");4===t?(o="Low",n.removeClass("SC_red SC_blue").addClass("SC_blue")):2===t?(o="High",n.removeClass("SC_red SC_blue").addClass("SC_red")):n.removeClass("SC_red SC_blue"),zmComp.setPriority(e,o)},objSize:function(e){var t,o=0;for(t in e)e.hasOwnProperty(t)&&o++;return o},updateDraft:function(e){e.action="sdraft",zmComp.sendMail(e)},updDraftText:function(e,t){zmComp.getDraftDom(e).text(t)},getPriorityDom:function(e){var t,o,n={},i=zmComp.getType(e);if("w"===i||"d"===i||"p"===i)t=$.q("#zmPriorityM_"+e).find("li"),o="d";else if("st"===i)t=$.e(A[e].priorityDOM),o="st";else{t=zmsuite.getCenter(e)[0].getNodes()[0].$el.find("li[data-event='p']"),o="t"}return n.elem=t,n.appTy=o,n},getDraftDom:function(e){var t;if(zmail.isComposeMail)t=$.q("#zmSaveM_"+e).find("li");else if(A[e].type&&"d"===zmComp.getType(e))t=$.q("#zmSaveM_"+e).find("li");else if(A[e].type&&"p"===zmComp.getType(e))t=$.q("#zmSaveM_"+e).find("li");else if(A[e].type&&"st"===zmComp.getType(e))t=$.q(A[e].saveDOM);else{t=zmsuite.getCenter(e)[0].getNodes()[0].$el.find("li[data-event='svedrp']")}return t.find("span").eq(1)},saveReply:function(e){for(var t=e.deferObj,o=e.cmpList,n=o.length,i=0;i<n;i++){var a=o[i];zmComp.afterSave(a)}t.resolve(!0)},afterSave:function(e){try{zmComp.isModified(e)?zmComp.sendMail({action:"sdraft",sendIm:!1,cmpId:e,actVal:"close",triggerFrom:"close_preview"}):zmComp.deleteCmpObj(e,A)}catch(e){zmComp.debugLog(e)}},send:function(e){var t={action:"compose",sendIm:!1,cmpId:e};zmComp.sendMail(t)},save:function(e,t){var o={action:"sdraft",sendIm:!1,cmpId:e};t&&(o.autosave=t),zmComp.sendMail(o)},getObj:function(e){return A[e]},confirmSend:function(){zmComp.sendMail({action:"outbox",schedule:!0,scheduled_type:"DATE"}),zmUtil.hideMenu()},constants:{DRAFT_LOAD_TAB:"tab",DRAFT_LOAD_INLINE:"inline"},updateOutbox:function(e){var t={aId:zmComp.getAccId(e),mode:"updOut",mId:zmComp.getMymId(e)},o={u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmCUtil.updateOutboxView,p:t};zmAjq.XHR(o)},modifyAtMention:function(e){zmComp.updAtMention(e)},modifyRecipients:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.action,o=e.composeID,n=e.field,i=zmComp.getShowSuggestions(o);(_zm.isOfflineSyncActive()&&(i=!1),!i||"add"!==t&&"remove"!==t||zmCUtil.getSugContacts(o,n),"add"===t&&"bcc"===n)&&(1===m({field:"bcc",composeID:o}).getRecipientList().length&&$.publish("/compose/bccpresent",{cmpID:o,mailID:A[o]?A[o]._draftParentId||A[o].mymId:""}))},getAccId:function(e){var t=zmail.accId;return e&&A[e].accId&&(t=A[e].accId),t},zmsubStr:function(e,t){return-1!==e.indexOf(t)&&(e=e.substring(t.length,e.length)),e},delegateEID:function(e){var t=zmComp.getShareId(e),o=zmComp.shareListObj()[t],n="";return o&&zmail.shrTree[0][o]&&(n=zmail.shrTree[0][o].EID),n},shareListObj:function(){var e={};zmail.shrTree[0]&&(e=zmail.shrTree[0]);var t={};if(e&&!$.isEmptyObject(e))for(var o in e)e[o].SHID&&(t[e[o].SHID]=o);return t},frmListObj:function(e){var t={};for(var o in e)e[o]&&void 0!==e[o].FRM_SIGMODE&&6!==e[o].FRM_SIGMODE&&(t[o]=e[o]);return t},emptyToRecipient:function(o){var e=zdom("div",null,zdom("h4",null,zdom("font",null,"Empty To Recipient"),zdom("div",{className:"SC_p10"},zdom("div",{className:"SC_p10"},zdom("input",{ref:"recipientInput",className:"SC_tiput",type:"text",style:{width:"560px"}}))))),n=_zm.getDOMReferenceMap(e),t={$content:e,ignoreMouseDown:!1,defaultNavigator:!1,buttons:[{name:E.send_anyway,callback:function(e){var t=n.recipientInput.value;""!==t.trim()?zmail.Utils.EmailValidator.validate(t.trim())&&zmComp.getRecipientField({field:"to",composeID:o}).createTokens({text:t,silent:!0}):A[o].emptyTo=!0,zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(o),cmpId:o,actVal:"subfalse"}),e.remove()}},{name:E.cancel,isCancel:!0,callback:function(e){e.remove()}}]};Dialog.new(t)},boxSubject:function(i){var e=$.q(zdom("input",null));e.attr("type","text"),e.attr("data-enableshortcuts",!0),e.addClass("SC_tiput"),e.width(560),e.val(""),e.attr("placeholder",E.specify_subject);var t=$.q(zdom("div",null));t.addClass("SC_p10"),t.appendDOM(e);var o=$.q(zdom("div",null));o.addClass("SC_p10"),o.appendDOM(t);var n=$.q(zdom("h4",null)),a=$.q(zdom("font",null));a.appendDOM(zdom("fragment",null,E.subject_alert)),n.appendDOM(a),n.appendDOM(o);var m=$.q(zdom("div",null));m.attr("id","zmcmp_subjalt_"+i),m.appendDOM(n);var r={cmpId:i};r.$content=m,r.ignoreMouseDown=!1,r.dialogDidMount=function(o){$.q("#zmcmp_subjalt_"+i)[0].zmcmp_subjalt_ele=o;var n=$.q("#zmcmp_subjalt_"+i).find("input").eq(0);n.focus(),n.select(),n.keyup(function(){var e=$.q("#zmcmp_subjalt_"+i)[0].zmcmp_subjalt_ele.$els.$buttonContainer,t=n.val(),o=E.send;""===$.trim(t)&&(o=E.send_anyway),e.find("span").eq(0).text(o)}),o.$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},r.defaultNavigator=!1,r.navigator=new zmail.Navigator({onEscape:function(){$.q("#zmcmp_subjalt_"+i)[0].zmcmp_subjalt_ele.remove()}}),r.buttons=[{name:E.send_anyway,callback:function(e){var t=e.$els.$contentWrapper.find("input").eq(0).val();""!==t&&($.q("#zmsub_"+i).val(t),zmComp.setSubject(i,t)),A[i].subfalse=!0,zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(i),cmpId:i,actVal:"subfalse"}),e.remove()}},{name:E.cancel,isCancel:!0,callback:function(e){e.remove()}}],Dialog.new(r)},getContacts:function(e,t){return m({field:t,composeID:e}).getRecipientList().join(",")},allContacts:function(e){var t="",o=!1,n=zmComp.getContacts(e,"to"),i=zmComp.getContacts(e,"cc"),a=zmComp.getContacts(e,"bcc");return""!==n&&(t=n,o=!0),""!==i&&o&&(t+=",",t+=i,o=!0),""!==a&&o&&(t+=",",t+=a),t},pushContacts:function(e,t){zmail.ContactBook.set({eid:e,fn:t})},addContacts:function(e){try{var t=zmComp.allContacts(e),o=zmConUtil.splitncheck(t,"object"),n="",i="";for(var a in o)o[a]&&o[a].eid&&!zmCUtil.isEmailExist(o[a].eid)&&(n=o[a].eid,o[a].fn&&(i=o[a].fn),zmComp.pushContacts(n,i))}catch(e){}},cmpDialog:function(e){e=e||{},zmComp.removeDiscard();var t=zmComp.getDialogObj();if(t.length){var o=t[0];if(A&&A[o]&&A[o]._dDialog){var n=A[o]._dDialog;return n.$els.$maskWrapper.addClass("SC_Pop"),n.show(),!1}}var i={act:"compose",mode:"compose"};e&&(i.data=e),zmComp.openDialog({},i)},openDialog:function(e,t){var o=zmUtil.getCmpAppId(),n=t.mode,i=t.msgId;zmComp.updateCmpSet(o),t.data?(e=t.data).mdata&&(e=e.mdata):e.mdata&&(e=e.mdata),A[o]=new zmComp.newInstance(n),zmComp.setType(o,"d"),A[o].info=t.info,$.isEmptyObject(e)||zmComp.setMailData(o,e),zmComp.updateSMType(o);var a={cmpId:o,type:"d"},m=zmCompOpt.headerDOM(a),r=zmCompOpt.recipientDOM(a);R({composeID:o,parentDOM:$.query(".recipient-fields",r),nextDOMAnchor:$.query(".subject-field",r)});var d=$.e(zmCompOpt.editorDOM(a)),s=$.e(zmCompOpt.dragDOM(a)),p=$.e(zmCompOpt.attSecDOM(a)),l=$.e(zmCompTemp.attEdiorDOM());l.appendDOM(d),l.appendDOM(p),l.appendDOM(s);var c=$.e(zmCompTemp.quickDialogDOM(o));c.appendDOM(m),c.appendDOM(r),c.appendDOM(l),zmComp.attActionBind(o,p);var u={cmpId:o,$content:c,ignoreMouseDown:!1,defaultCloseIcon:!1,dialogDidMount:function(e){zmComp.updateDialog(e,o)},dialogWillMount:function(e){zmComp.modifyDialog(e,o)},defaultNavigator:!1,navigator:new zmail.Navigator({onEscape:function(){zmComp.hideDialog(o)}})};Dialog.new(u),zmComp.setMymId(o,i),t&&t.shId&&zmComp.setShareId(o,t.shId),zmComp.updateDataFrom(o,n,e),zmComp.updateSubject(o,n,e.SUBJECT),zmComp.setFwdInlineMode(o,e),t.info&&t.info.draftId&&(e.MAILID&&(A[o].discard_mailId=e.MAILID),e.INREPLYTO&&(A[o].discard_inReplyTo=e.INREPLYTO),e.REFHEADER&&(A[o].discard_refHeader=e.REFHEADER)),i&&zmCUtil.setTempFolId(o,i),zmComp.loadDialog(o,n,e,t)},updateDialog:function(e,t){(A[t]._dDialog=e).$els.$positionWrapper.addClass("SC_PopTop");var o=$.q(".zmNewBtn").offset().top+"px",n=$.q("#zm_centerHolder").offset().left+"px";e.$els.$positionWrapper.css("top",o),e.$els.$positionWrapper.css("left",n)},modifyDialog:function(e,t){e.$els.$maskWrapper.removeClass("SC_cent"),e.$els.$content.attr("id","zmQuick_compose_"+t),e.$els.$content.removeClass()},loadDialog:function(e,t,o,n){try{var i=zmCompContent.composeContent(e,t,o);zmComp.updateRecipients(e,t,o),x(e,t,i),zmComp.focusToField(e),zmCUtil.resizeRepDOM(e),zmComp.setHeight(e),zmComp.fromAddrDropBind(e),v(e,t),zmComp.startClock(e),zmUtil.addCmpAppId()}catch(e){zmComp.debugLog(e)}},enableSave:function(e){var t;if(A[e]&&"d"===zmComp.getType(e))t=$.q("#zmSaveM_"+e).find("li");else if(A[e]&&"p"===zmComp.getType(e))t=$.q("#zmSaveM_"+e).find("li");else if(A[e]&&"st"===zmComp.getType(e))t=$.q(A[e].saveDOM);else if(zmail.isComposeMail)t=$.q("#zmSaveM_"+e).find("li");else if(!zmUtil.isChildWindow()&&zmsuite.getAppObj(e)&&zmsuite.getAppObj(e).centerObj){t=$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("li[data-event='svedrp']")}e&&A[e]&&(A[e].enableDiscard=!0),t&&t.removeClass("SC_op3 SC_nopntr");var o=zmComp.getCommentObj(e);"t"!==zmComp.getType(e)||o&&(!o||o.entityExists)||zmComp.enableDraftShare(e)},updAtMention:function(e){var t=A[e];if(t){var o=t._atMentionObj||[],n=function(e,t){return(t=(t||"").trim().toLowerCase())&&(e[t]=!0),e};return o=o.reduce(n,{}),i({composeID:e}).getEmailList().reduce(n,o),o=Object.keys(o),t._atMentionObj=o}},parseHTML:function(e){return zdom("div",{dangerouslySetInnerHTML:e}).innerHTML},composeMail:function(e,t){!function(e,t){zmComp.removeDiscard();var o="CmpW"+(new Date).getTime(),n=t.mode,i=t.msgId;zmComp.updateCmpSet(o),zmComp.windowCmpId=o,t.data?(e=t.data).mdata&&(e=e.mdata):e.mdata&&(e=e.mdata),A[o]=new zmComp.newInstance(n),zmComp.setType(o,"w"),6!==t.zapp&&zmComp.setTagMatching(o,!1),A[o].info=t,e&&!$.isEmptyObject(e)&&zmComp.setMailData(o,e),zmComp.updateSMType(o);var a={cmpId:o,type:"w"},m=zmCompOpt.headerDOM(a),r=zmCompOpt.recipientDOM(a);R({composeID:o,parentDOM:$.query(".recipient-fields",r),nextDOMAnchor:$.query(".subject-field",r)});var d=$.e(zmCompOpt.editorDOM(a)),s=$.e(zmCompOpt.dragDOM(a)),p=$.e(zmCompOpt.attSecDOM(a)),l=$.e(zmCompTemp.attEdiorDOM());l.appendDOM(d),l.appendDOM(p),l.appendDOM(s);var c=$.q("#zmComposeWrapper");c.appendDOM(m),c.appendDOM(r),c.appendDOM(l),zmComp.attActionBind(o,p),zmComp.fromActionBind(o),zmComp.setMymId(o,i),t&&t.shId&&zmComp.setShareId(o,t.shId),zmComp.updateDataFrom(o,n,e),zmComp.updateSubject(o,n,e.SUBJECT),t.isFwd&&(A[o]._referOpener=!0),zmComp.setFwdInlineMode(o,e),"draft"===t.mode&&t.msgId&&e&&(A[o].discard_Id=t.msgId,e.MAILID&&(A[o].discard_mailId=e.MAILID),e.INREPLYTO&&(A[o].discard_inReplyTo=e.INREPLYTO),e.REFHEADER&&(A[o].discard_refHeader=e.REFHEADER)),i&&zmCUtil.setTempFolId(o,i);var u=zmCompContent.composeContent(o,n,e);zmComp.updateRecipients(o,n,e),x(o,n,u),zmComp.focusToField(o),zmCUtil.resizeRepDOM(o),zmComp.setHeight(o,"w"),zmComp.fromAddrDropBind(o),v(o,n),zmComp.startClock(o),zmUtil.addCmpAppId(),zmComp.blurOutSubject(o),"outbox"===n&&zmComp.updateOutbox(o)}(e,t)},debugLog:function(e){zmUtil.debugLog(e)},insertAttachment:function(e,t){zmComp.getAttRef(e).addFiles(t.NEWATT)},cmpData:function(e){return zmComp.updateCmpSet(e),{askReceipt:zmComp.getDefault().askReceipt,charset:zmComp.getDefault().charset,smType:zmComp.getDefault().smType,outIntr:zmComp.getDefault().outIntr,setRepto:zmComp.getDefault().setRepto,showBcc:zmComp.getDefault().showBcc,fromObj:zmComp.getFromObj(),signObj:zmComp.getSignObj(),encode:zmComp.getEncodeList(),fromAddr:zmComp.getDefaultFrom()}},loadAppObj:function(e){return A[e]=new zmComp.newInstance("compose"),zmComp.setType(e,"st"),A[e]},getZDocLink:function(e){var t=zmComp.getZDocLoc(e),o=[];return A[e]&&A[e].plaindoclink&&(o=A[e].plaindoclink),t=$.grep(t,function(e){return $.inArray(e,o)<0})},loadCmpDOMProp:function(e,t){A[e].saveDOM=t.saveDOM,A[e].priorityDOM=t.priorityDOM,A[e].errorPar=t.errorPar,zmComp.setType(e,t.type);var o=t.editor;zmComp.setEditor(e,o);var n={};n=u(e,n),o.updateConfigProperties(n),zmComp.setAttRef(e,t.attRef)},getCmpData:function(){var e=zmUtil.getCmpAppId(),t={cmpId:e,data:zmComp.cmpData(e),appobj:zmComp.loadAppObj(e)};return zmUtil.addCmpAppId(),t},getCmpObj:function(){return A},getCurrentCompId:function(){var e;return zmail.isComposeMail?e=zmComp.windowCmpId:(!zmUtil.isChildWindow()&&zmTab&&(e=zmTab.currentTab),e&&-1===e.indexOf("Cmp")&&(e=null)),e}};return zmUtil.loadZDocs(),window.onbeforeunload=function(e){if(zmComp.checkModified()){var t=E.unsent_alert;return void 0===e&&(e=window.event),e&&(e.returnValue=t),t}},$.subscribe("/network/online",function(){zmComp.updateOnlineStatus()}),zmail.isComposeMail||(ZMStore.registerCleanUpAction("compose",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=zmail.zuid;return e.zuid&&(t=e.zuid),zmUtil.removeComposeDB(t)}),$.subscribe("mail/draggingStarted",function(e,t){try{zmComp.showDrag(t.text)}catch(e){}}),$.subscribe("mail/draggingEnded",function(){try{zmComp.hideDrag()}catch(e){}}),$.subscribe("mail/draggingOnCmpMask",function(){try{zmComp.debugLog("Element on compose drag mask")}catch(e){}}),$.subscribe("/streams/comment",function(e,t){zmComp.updateComment(t)}),$.subscribe("/streams/draftShared",function(e,t){zmComp.updateNotifyAll(t)}),$.subscribe("settings/mail-accounts/fromAddressChange",function(e,t){t.obj.accId===zmail.accId&&(zmail.cmpdata.DEFFRM_ADDR=t.obj.sendAsEmail)}),$.subscribe("settings/mail-accounts/replyToEmailAdded",function(e,t){var o="";t&&t.obj&&(o=t.obj.replyToEmail),o&&(zmail.cmpdata.SETREPTO=o)}),$.subscribe("settings/mail-accounts/replyToEmailRemoved",function(e,t){var o="";t&&t.obj&&(o=t.obj.replyToEmail),o&&(zmail.cmpdata.SETREPTO="")})),$.subscribe("smartCompose/onClose",function(e,t){try{if(t.mailObj){var o=t.mailObj.cmpId;t.mailObj.clearData&&zmComp.getOutboxMailId(o)&&zmCUtil.clearDraft(zmComp.getAccId(o),zmComp.getOutboxMailId(o)),A[o].discard_close||delete A[o]}zmUtil.stopEvents(e)}catch(e){}}),$.q(window).resize(_.debounce(e,1e3)),$.subscribe("mailsuite/appOpened",function(e,t){if(t&&zmComp.getCurrentCompId()&&A&&A[t]){try{var o=zmComp.getEditor(t);if("t"===zmComp.getType(t)&&zmComp.setTabHeight(t),A[t].resizeWidth?(zmCUtil.transResizeRepDOM(t),A[t].resizeWidth=!1):o&&zmCUtil.regenerateToolbar(t),o&&void 0!==o.squireInstance){o.squireInstance.focus();var n,i=o.squireInstance.getSelection().startContainer.parentNode.getBoundingClientRect(),a=i.y||i.height,m=i.x||i.width,r=o.iframe.scrollHeight;n=i.y>=r?a+r:a,o.iframe.contentWindow&&o.iframe.contentWindow.scrollTo(m,n)}}catch(e){}return!1}}),$.subscribe("/announcement/show",function(){zmComp.resizeCmpTab()}),$.subscribe("/announcement/hide",function(){zmComp.resizeCmpTab()}),$.subscribe("zmsuite/previewResize",function(e,t){try{if(t.completed)for(var o in A)A[o]&&zmCUtil.regenerateToolbar(o)}catch(e){}}),$.subscribe("zmsuite/lhsResize",function(e,t){if(t.completed){var o=zmComp.getCurrentCompId();o&&A[o]&&(zmCUtil.transResizeRepDOM(o),"t"===zmComp.getType(o)&&zmComp.setTabHeight(o)),zmComp.resizeUtil()}}),$.subscribe("/integ/rhs/start",function(){var e=zmComp.getCurrentCompId();e&&zmCUtil.clearResizeRepDOM(e),zmComp.clearResizeRepDOM()}),$.subscribe("/integ/rhs",function(){var e=zmComp.getCurrentCompId();e&&A[e]&&(zmCUtil.transResizeRepDOM(e),"t"===zmComp.getType(e)&&zmComp.setTabHeight(e)),zmComp.resizeUtil()}),a.getRecipientField=m,a.getRecipientComponent=i,a.focusInputField=r,a.scrollInputFieldToView=o,a}(),function(e){var m=zmUtil.composeI18N(),d="div[ref='inlineContent']",s=function(e,t){var o,n,i=t[e],a=i.info;return a&&(o=a.msgId,a.mode&&"draft"===a.mode&&i._draftParentId&&(o=i._draftParentId),!(n=a.draftId)&&a.mode&&"draft"===a.mode&&(n=a.msgId),n||(n=zmComp.getDraftId(e))),{msgId:o,draftId:n}},r=function(e,t){var o,n,i,a=(o=t,n=m.edithere,i=m.hasdraft,"t"===o&&(n=m.editdraftintab,i=m.editingmsg),zdom("div",{className:"SC_simg"},zdom("font",{className:"zm_draft"},n),zdom("span",null,i)));e.appendDOM(a,{clear:!0})},p=function(e){var t=e.messageId,o=e.draftId||"",n=e.elmSuffixId;return zdom("div",{className:"SC_pct SC_Drft",id:n},zdom("div",{className:"zmPHdr","data-mid":t,"data-did":o}),zdom("div",{ref:"inlineContent"}))},n=function(i,e,a){$.q("div[id$='_cmpInline_"+e+"']").each(function(e,t){var o=$.e(this).find(d),n=o.find("> div.zm_cmp");(!n||n&&!n.length)&&($.e(this).parent().children(":first").find(".zm_ry").hide(),a||(a=zmComp.getType(i)),r(o,a))})},l=function(e){try{$.q("div[id$='_cmpInline_"+e+"']").each(function(){$.e(this).parent().children(":first").find(".zm_ry").show(),$.e(this).remove()})}catch(e){}},t={showDraftedContainer:r,updateShowDraftedAsEdited:n,updateShowDraftedAfterNewSave:function(e){var t=e.cmpId,i=e.msgId,a=e.draftId,o=e.type;$.q("div[data-mid='"+i+"']").filter("div[id$='"+i+"']").each(function(){var e=$.e(this).parent(),t=$.e(this).attr("id").replace(i,""),o="zmDrft_"+(t=t.replace("zmHdr",""))+"_cmpInline_"+i;if(!e.next().hasClass("SC_pct SC_Drft")){var n=p({msgId:i,draftId:a,elmSuffixId:o});$.e(n).insertDOMAfter(e)}}),zmComp.updateDraftIdAfterSave(e),n(t,i,o)},checkInlinePreLoadedDOM:function(e,t){var o=e.msgId,n="zmDrft_"+e.elmPrefix+"_cmpInline_"+o;if(t.info&&t.info.prevDOM){var i=t.info.prevDOM.parent();if(i.attr("id")===n)return i}return!1},getInlineDraftContainer:function(e){var t=e.msgId,o=e.draftId||"",n=e.elmPrefix,i=e.messageElem,a="zmDrft_"+n+"_cmpInline_"+t,m=e.prevElem.find("div#"+a);if(m.length)return m.find(d);m=p({messageId:t,draftId:o,elmSuffixId:a});var r=zmail.Utils.DOM.getRefs(m);return $.e(m).insertDOMAfter(i),$.e(r.inlineContent)},draftParentId:function(e,t){for(var o,n=t.length,i=0;i<n;i++)if(t[i].M===e&&t[i].FD===zmail.folId.dId){o=t[i].PA;break}return o},draftThreadId:function(e){var t,o=zmUtil.getMailObj(e);return o&&o.T&&(t=o.T),t},getOpenedInlineId:function(e,t){try{var o=e.msgId,n=e.draftId,i=e.mode;for(var a in t){var m=t[a];if(!t[a].discard_close){var r=m._draftParentId,d=zmComp.getDraftId(a);if(o===r&&n===d)return a;var s=void 0;if(m.info&&(s=m.info),s&&s.msgId&&s.draftId&&(r=s.msgId,d=s.draftId),r&&d&&o===r&&n===d)return a;if(s&&s.msgId&&(r=s.msgId),"draft"===i&&o===d)return a;if(o===r)return a}}}catch(e){zmComp.debugLog(e)}return!1},getOpenedTabId:function(e,t){try{var o=e.msgId,n=e.mode,i=e.draftId;for(var a in t){var m=t[a];if(!m.discard_close){var r=m._draftParentId,d=zmComp.getMode(a),s=void 0;if(m.info&&(s=m.info),s&&(s.mode&&(d=s.mode),s.msgId&&(r=s.msgId),s.draftId&&(i=s.draftId)),"draft"===n&&o===i)return a;if("draft"===n&&o===zmComp.getDraftId(a))return a;if(s&&o===r&&n===d)return a}}}catch(e){zmComp.debugLog(e)}return!1},getInlinePreContainerCmpId:function(e){var t;return $.q("div[id$='_cmpInline_"+e+"']").each(function(){var e=$.e(this).find("div[ref='inlineContent']").find("> div.zm_cmp");e&&e.length&&(t=e.attr("data-cmpid"))}),t},hidePreviewRepliedOption:function(e,t){var o=t[e].info;o&&o.messageElem&&o.messageElem.find(".zm_ry").hide()},updateAllContainerAfterClose:function(e,t,o,n){try{var i=t[e].info;if(i){var a=s(e,t),m=a.msgId,r=a.draftId;if("close"===o)if("close_view_aftersend"===n){try{i.prevDOM.parent().remove(),i.messageElem.find(".zm_ry").show()}catch(e){}l(m)}else if("close_preview_aftersave"===n){try{i.messageElem&&i.messageElem.find(".zm_ry").hide()}catch(e){}zmComp.showDraftedContainer(i.prevDOM,"p"),zmComp.updateShowDraftedAfterNewSave({cmpId:e,msgId:m,draftId:r,type:"p"})}else if(r){try{i.messageElem&&i.messageElem.find(".zm_ry").hide()}catch(e){}zmComp.showDraftedContainer(i.prevDOM,"p"),zmComp.updateShowDraftedAfterNewSave({cmpId:e,msgId:m,draftId:r,type:"p"})}else{try{i.prevDOM.parent().remove(),i.messageElem.find(".zm_ry").show()}catch(e){}l(m)}else if("discard"===o){try{i.prevDOM.parent().remove(),i.messageElem.find(".zm_ry").show()}catch(e){}l(m)}}}catch(e){}},updateAllShowDraftedAsTab:function(e){$.q("div[id$='_cmpInline_"+e+"']").each(function(){var e=$.e(this).find("div[ref='inlineContent']");zmComp.showDraftedContainer(e,"t")})},updateDraftIdAfterSave:function(t){t.msgId&&t.draftId&&$.q("div[id$='_cmpInline_"+t.msgId+"']").each(function(){var e=$.e(this).find("> div.zmPHdr");e.attr("data-mid",t.msgId),e.attr("data-did",t.draftId)});zmComp.updateShowDraftedAsEdited(t.cmpId,t.msgId)},isInlinePreContainerDOM:function(e){var t=$.q("div[id$='_cmpInline_"+e.msgId+"']");return!!t.length&&t},getMessageInfo:s,tabClose:function(e){var t=e.cmpId,o=e.cmpDObj,n=e.triggerFrom,i=e.triggerType;delete zmTab.getTabObject(t).onDelete,zmsuite.closeWorkspace(t),"p"===zmUtil.getComposeType()&&zmComp.updateAllContainerAfterClose(t,o,n,i),zmComp.deleteCmpObj(t,o)},windowClose:function(e,t){var o={close:!0};try{var n;window&&window.opener&&null!==window.opener.opener?n=window.opener.opener:window&&null!==window.opener&&(n=window.opener),window.self!==top&&window.parent.postMessage(o,"*"),n&&(o.cmpId=e,n.postMessage(o,"*"))}catch(e){}var i=m.mailsentsuccessfully;t&&"discard"===t.triggerFrom&&(i=m.discard_msg),zmComp.windowSuccessMessage(e,i);try{window.close()}catch(e){close()}},dialogClose:function(e){var t,o,n,i,a=e.cmpId,m=e.cmpDObj;m[a].closeQuick?(m[a].closeQuick=!1,n=(o=e).cmpId,(i=o.cmpDObj)[n]._dDialog&&i[n]._dDialog.remove()):((t=m._dDialog).$els.$maskWrapper.removeClass("SC_Pop"),t.hide())},smartClose:function(e){var t,o=e.cmpId,n=e.cmpDObj[o];n.smartData&&n.smartData.afterClose&&(t=n.smartData.afterClose),t&&t()},prvClose:function(e){var t=e.cmpId,o=e.cmpDObj,n=e.triggerFrom,i=e.triggerType;zmComp.updateAllContainerAfterClose(t,o,n,i),zmComp.deleteCmpObj(t,o)},isUnsavedChange:function(e,t){var o=!1;return zmComp.isModified(e)&&(o=!0),t.discard_close&&(o=!1),o},deleteCmpObj:function(e,t){try{var o=zmComp.getCommentObj(e);o&&$.publish("smartCompose/removeComment",{msgId:o.context.draftId,prevElem:o.parentElem}),clearInterval(zmComp.getInterVal(e)),$.q("#zm_smsg_"+e)&&zmComp.hideMsg(e),t[e].discard_close||delete t[e]}catch(e){}},unsavedConfirm:function(e){var t={cmpId:e,textMsg:m.save_content_alert};return zmComp.cmpConfirm(t)},prevCmpObj:function(e,t){var o="";"st"===t[e].type?o=zmComp.getSubject(e):(o=$.q("#zmsub_"+e).val(),t[e].type&&"p"===t[e].type&&(o=zmComp.getSubject(e))),o&&(o=o.substr(0,1e3),zmComp.setSubject(e,o)),zmComp.backupAttCompRef(e),function(e,t){var o,n,i,a=new zmComp.prevInstance;o=zmComp.cmpGetAddr(e,"to"),n=zmComp.cmpGetAddr(e,"cc"),i=zmComp.cmpGetAddr(e,"bcc"),o.address&&(a.to=o.address),n.address&&(a.cc=n.address,a.isCC=!0),i.address&&(a.bcc=i.address,a.isBCC=!0);var m=zmComp.getMode(e);"compose"!==m&&"fwdi"!==m&&"fwdme"!==m||(a.isCC=!0),a.from=zmComp.getFromAddr(e),a.subject=zmComp.getSubject(e),a.replyto=zmComp.getReplyTo(e),zmComp.getMymId(e)&&(a.msgId=zmComp.getMymId(e)),a.askreceipt=zmComp.getAskReceipt(e);var r=zmComp.getPriority(e);-1!==["low","high"].indexOf(r)&&(a.isPriority=!0),t.prevObj=a}(e,t[e])},reloadPrvObj:function(e,t){var o=t.from,n=zmComp.getFromDispN(o);$.q("#zm_fromaddr_"+e).text(n),zmComp.updateShieldIcon(e);var i=zmComp.getSubject(e);$.q("#zmsub_"+e).val(i);var a=t.to,m=t.cc,r=t.bcc,d=t.isCC,s=t.isBCC;a&&""!==$.trim(a)&&zmComp.cmpSetContact(e,"to",a),d&&zmComp.shCBc(e,"c"),m&&""!==$.trim(m)&&"Not Provided"!==$.trim(m)&&zmComp.cmpSetContact(e,"cc",m),r&&$.trim(r)&&zmComp.cmpSetContact(e,"bcc",r),s&&zmComp.shCBc(e,"b"),zmComp.reloadAttachment(e)},previewElementDOM:function(e){var t=e.msgId;if(e.prevElem&&e.prevElem.length&&t){var o="#zmHdr"+e.elmPrefix+t,n=e.prevElem.find(o).closest(".SC_pct");if(n&&n.length)return n}return!1},isEmptyContent:function(e){var t=!1;if(!zmComp.getDraftId(e)){var o,n,i,a="",m="",r="";o=zmComp.cmpGetAddr(e,"to"),n=zmComp.cmpGetAddr(e,"cc"),i=zmComp.cmpGetAddr(e,"bcc"),o.address&&(a=o.address),n.address&&(m=n.address),i.address&&(r=i.address);var d=!1;""!==a&&(d=!0),""!==m&&(d=!0),""!==r&&(d=!0);var s,p=!0;""===zmComp.getSubject(e)&&(p=!1),zmComp.getAttRef(e)&&(s=zmComp.getAttRef(e).getStoreAttachments(!0));var l,c,u,f,z=zmComp.getFwdMsg(e),C=zmComp.getFwdThrd(e);s&&(l=s.myAttachment,c=s.tempLocation,u=s.hugeAttachment,f=s.cloudAttList);var g=!1,v=l&&l.length,h=c&&c.length,I=u&&u.length,_=f&&f.length,D=z&&z.length,b=C&&C.length;(v||h||I||_||D||b)&&(g=!0);var S=!0,O=zmComp.getEditor(e).getContent({plaintext:!0});if(O){var M=zmComp.getInitialContent(e);M&&(M=$.trim(M)),(O=$.trim(O))===M&&(S=!1)}else O=$.trim(O);O||(S=!1),S||p||g||d||(t=!0)}return t},openPreLoadedView:function(e,t){var o=zmComp.getMailData(e),n=zmCompContent.composeContent(e,t,o);zmComp.setContentUpdateFlagState(e,!1);var i=zmComp.getEditor(e);i.setContent(n);var a=i.getContent({plaintext:!0});zmComp.setInitialContent(e,a),zmComp.updateSubject(e,t,o.SUBJECT),zmComp.updRepView(e,t),zmComp.setContentUpdateFlagState(e,!0),"fwdi"===t?(zmComp.focusInputField({field:"to",composeID:e}),zmComp.setFocusOption(e,"to")):i&&void 0!==i.squireInstance&&i.squireInstance.focus()},shareEmailDialog:function(e){$.publish("/mail/forwardmail",{mailID:e,mode:"forward",workspaceID:window.zmTab&&zmTab.currentTab})},iframeFocusBinder:function(t){function e(e){zmComp.setFocusOption(t,"text")}var o=zmComp.getEditor(t);if(o&&o.doc.body){var n=o.doc.body;"onfocusin"in n?n.addEventListener?n.addEventListener("focusin",e,!1):n.attachEvent&&n.attachEvent("onfocusin",e):n.addEventListener&&n.addEventListener("focus",e,!0)}}};$.extend(!0,e,t)}(window.zmComp),function(e){var a=e.getCmpObj(),o=function(e){var t=e.cmpId,o=t&&a[t]||{};if(!$.isEmptyObject(o)){var n="st"===zmComp.getType(t);try{if(!n&&!$.q("#zmdArea_"+t).length)return void zmComp.deleteCmpObj(t,a)}catch(e){}if(zmComp.isModified(t)&&!zmComp.isEmptyContent(t)){e.action="sdraft",e.sendIm=!1;var i=e.viaType;i&&"adraft"===i&&(e.autosave=i),zmComp.sendMail(e)}}},t=_.debounce(function(e){o({cmpId:e})},5e3);e.autoSave=o,e.startClock=function(e){var t=setInterval(function(){o({cmpId:e,viaType:"adraft",calleeType:"interval"})},6e4);zmComp.setInterVal(e,t)},e.debounceSave=t}(window.zmComp=window.zmComp||{}),function(e){var s=e.getCmpObj(),r=zmUtil.composeI18N(),p=function(e,t,o){var n,i={},a="",m="",r="";"reply"===t?a=o.REPLYTO:"replyall"===t?(a=o.REPLYTO,m=o.REPLYCC,s[e].groupEmailId&&(m?m+=","+s[e].groupEmailId:m=s[e].groupEmailId)):-1!==["draft","template","outbox","eanew","compose"].indexOf(t)&&(a=o.TO,m=o.CC,r=o.BCC),a=a||"",m=m||"",zmComp.getFID(e)&&(n=zmComp.getFID(e)),n&&zmail.folId.sId===n&&o&&o.BCC&&["reply","replyall"].includes(t)&&(r=o.BCC),r=r||"";var d=s[e]&&s[e].info;return d&&d.predata&&d.predata.TO&&"fwdi"===t&&(a=d.predata.TO),i.TO=a,i.CC=m,i.BCC=r,i},l=function(e,t,o){o=zmUtil.replaceHTMLEntities(o),o=zmail.Compose.Components.recipientListComponent.addQuotesToEmails(o);var n=zmComp.getCmpObj()[e];n.handleTokenEvents=!1,zmComp.getRecipientField({field:t,composeID:e}).createTokens({text:o,silent:!0}),n.handleTokenEvents=!0};e.updateSubject=function(e,t,o){if(o&&""!==$.trim(o)){var n=o.indexOf(":"),i=o.substr(0,n+1),a="",m=-1;i&&(i=i.toLowerCase()),"reply"===t||"replyall"===t?(a=r.subprefix_re,m=Object.keys(zmCompLang.getREText).map(function(e){return zmCompLang.getREText[e].toLowerCase()}).indexOf(i)):"fwdi"===t&&(a=r.subprefix_fwd,m=Object.keys(zmCompLang.getFWDText).map(function(e){return zmCompLang.getFWDText[e].toLowerCase()}).indexOf(i)),-1===m&&a.trim()!==i.trim()&&(o=a+o),o=o.substr(0,1e3),$.q("#zmsub_"+e).val(o),zmComp.setSubject(e,o),zmComp.setInitialSubject(e,o)}},e.blurOutSubject=function(o){$.q("#zmsub_"+o).keyup(function(){s[o]&&"t"===zmComp.getType(o)&&zmComp.updateTitle(o);var e=$.q("#zmsub_"+o).val(),t=zmComp.getInitialSubject(o);e&&(e=$.trim(e)),t&&(t=$.trim(t)),e&&""!==$.trim(e)&&t!==e&&zmComp.setModified(o,1),zmComp.setSubject(o,e)})},e.updateRecipients=function(e,t,o){zmComp.loadAttachment(e,t,o),o.MAILID&&zmComp.setMailId(e,o.MAILID),o.REFHEADER&&zmComp.setRefHeader(e,o.REFHEADER),o.INREPLYTO&&zmComp.setInReplyTo(e,o.INREPLYTO),zmComp.setCmpHeader(e,t);var n=p(e,t,o),i=n.TO,a=n.CC,m=n.BCC;i&&""!==$.trim(i)&&l(e,"to",i),a&&""!==$.trim(a)&&"Not Provided"!==$.trim(a)&&(l(e,"cc",a),zmComp.shCBc(e,"c")),m&&$.trim(m)&&(l(e,"bcc",m),zmComp.shCBc(e,"b"))},e.updRepView=function(e,t){var o=zmComp.getMailData(e);if(zmComp.setMode(e,t),zmComp.setInlineMode(e,t),!$.isEmptyObject(o)){zmComp.resetRepView(e);var n=p(e,t,o),i=n.TO,a=n.CC,m=n.BCC;if(a&&""!==$.trim(a)&&"Not Provided"!==$.trim(a))l(e,"cc",a),zmComp.shCBc(e,"c");else{var r=zmComp.getRecipientField({field:"cc",composeID:e}).component.dom;$.q(r).addClass("SC_dyn"),zmComp.getRecipientField({field:"to",composeID:e}).component.setState({ccBtn:!0})}if(m&&$.trim(m))l(e,"bcc",m),zmComp.shCBc(e,"b");else{var d=zmComp.getRecipientField({field:"bcc",composeID:e}).component.dom;$.q(d).addClass("SC_dyn"),zmComp.getRecipientField({field:"to",composeID:e}).component.setState({bccBtn:!0})}i&&""!==$.trim(i)&&l(e,"to",i)}},e.cmpSetContact=l,e.postEditorLoad=function(e){var o=zmComp.getEditor(e);try{o.regenerateToolbar()}catch(e){}if(zmComp.setHeight(e),"w"===zmComp.getType(e)){var t=zmComp.getEditorContent(e);t=DOMPurify.sanitize(t),"plaintext"===o.mode&&(t=ZE.getText(t)),zmComp.setContentUpdateFlagState(e,!1),o.setContent(t);var n=o.getContent({plaintext:!0});zmComp.setInitialContent(e,n),zmComp.setContentUpdateFlagState(e,!0)}else{var i=o.getContent({plaintext:!0});zmComp.setInitialContent(e,i)}zmUtil.getIntegStatus().then(function(){var e=o.toolbarobject&&o.toolbarobject.compWorkdrive;if(zmail.IntegrationStatus&&!zmail.IntegrationStatus.workdrive&&e){var t=o.toolbarobject.compWorkdrive;$.e(t.parentElement.parentElement.previousElementSibling).remove(),$.e(t.parentElement.parentElement).remove()}},function(){}),zmComp.updateToolbarForSignature(e);var a=zmComp.getZDocLoc(e);if(a.length&&"plaintext"===zmComp.getEditor(e).mode&&(s[e].plaindoclink=a),s[e].newsave){var m={cmpId:e,calleeType:"afterEditorLoad"};zmComp.autoSave(m)}zmComp.loadExtImages(e),zmComp.loadShareDoc(e);var r=!0;s[e].type&&"p"===zmComp.getType(e)&&(r=!1);var d=o.doc.body;"plaintext"===o.mode&&(d=o._textarea),r&&d.setAttribute("data-enableshortcuts","true"),zmComponent.keybindings.listener.add(o.doc),zmComponent.bind({ev:"click",fn:function(){$.publish("/editor/click"),zmUtil.hideMenu(!0)},args:[!0,!1],elm:o.doc,capture:!0}),zmComp.bindEditorEvents(e,o),function(e){try{zmAppLoader.load("ComposeSmiley").then(function(){(new(zmail.Core.Namespaces.get("Compose").smileyAutofill.smileyAutofillComponent)).init(e,!0)})}catch(e){}}(o)},e.constructComp=function(e,t,o){zmComp.updateDataFrom(e,t,o),zmComp.updateSubject(e,t,o.SUBJECT),zmComp.loadAttachment(e,t,o),o.MAILID&&zmComp.setMailId(e,o.MAILID),o.REFHEADER&&zmComp.setRefHeader(e,o.REFHEADER),o.INREPLYTO&&zmComp.setInReplyTo(e,o.INREPLYTO),zmComp.setCmpHeader(e,t);var n=p(e,t,o),i=n.TO,a=n.CC,m=n.BCC;i&&""!==$.trim(i)&&l(e,"to",i),a&&""!==$.trim(a)&&"Not Provided"!==$.trim(a)&&(l(e,"cc",a),zmComp.shCBc(e,"c")),m&&$.trim(m)&&(l(e,"bcc",m),zmComp.shCBc(e,"b")),"fwdi"!==t&&"fwdme"!==t||zmComp.shCBc(e,"c")},e.focusToField=function(e){var t=zmComp.getMode(e);-1!==["fwdi","fwdme","compose"].indexOf(t)&&(zmail.isComposeMail?setTimeout(function(){zmComp.focusInputField({field:"to",composeID:e})},500):zmComp.focusInputField({field:"to",composeID:e}),zmComp.setFocusOption(e,"to"))},e.setFwdInlineMode=function(e,t){if(t.STATUS2ID&&(5===t.STATUS2ID||6===t.STATUS2ID||7===t.STATUS2ID)){var o=zmComp.getModeObj("string",t.STATUS2ID);zmComp.setInlineMode(e,o),zmComp.setMode(e,o)}}}(window.zmComp=window.zmComp||{}),function(e){var t={getCloseDOM:function(){return zdom("div",{className:"zmScCmnt"},zdom("div",{className:"SCmb puClose"},zdom("ul",null,zdom("li",{className:"ScCmntClose"},zdom("b",null,zdom("span",null,zdom("i",{className:"msi-close"})))))))},getSpanDOM:function(e){return zdom("span",{className:"StCnt"},e.count)},fileDOM:function(){return zdom("div",{className:"zmL SC_Pbar",id:"{{AT_UID}}"},zdom("div",{className:"zmLst"}),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze"},zdom("span",{id:"{{AT_UID}}_SZE",className:"sum"})),zdom("div",{className:"zmFrm"},zdom("span",{id:"{{AT_UID}}_FRM"})),zdom("div",{className:"zmImg",id:"{{AT_UID}}_IMG"},zdom("i",{className:"{{AT_CLS}}"})),zdom("div",{className:"SC_icn",id:"{{AT_UID}}_DEL"},zdom("i",{className:"msi-close"}))),zdom("div",{className:"zm_lbl",id:"{{AT_UID}}_STATUS"},zdom("div",{style:{width:"0%"}}))).outerHTML},attEdiorDOM:function(){return zdom("div",{className:"zmCEA"})},inlinePrevDOM:function(e,t){return zdom("div",{className:"zm_cmp","data-cmpid":e})},quickDialogDOM:function(e){return zdom("div",{id:"zmQuick_compose_"+e})},afterMailSentDom:function(e){return zdom("div",{className:"zmCallBackPage SC_mclst zmCnW",style:{display:"block"}},zdom("div",{className:"zmCBMsgWrap"},zdom("div",{className:"zmCBMsgTxt"},zdom("div",{className:"zmCBIcon zmCBSucIcon"},zdom("i",{className:"msi-mailSuc"})),zdom("div",{className:"zmCBMsg"},zdom("span",null,e))),zdom("div",{className:"zmCBLogo"},zdom("i",{className:"msi-zohoMail zmDoubleIcon"}),zdom("span",null,zmail.globalI18N.productName))))}};$.extend(!0,e,t)}(window.zmCompTemp=window.zmCompTemp||{}),function(e){var t={sendMailAdapter:function(){var e=zmail.SendMailAdapter,t={adapters:[{id:"http-adapter",type:"default",classObj:e.HTTPAdapter}],default:"http-adapter"};return _zm.isOfflineLockAvailable()&&t.adapters.push({id:"indexDB",type:"offline",classObj:e.IndexDBAdapter}),t},composeCollection:function(){var e=ZMStore.getInstance("compose");return e||(e=ZMStore.createInstance("compose",zmail.ComposeCollection,{adapterConfig:zmComp.sendMailAdapter()})),e}};$.extend(!0,e,t)}(window.zmComp=window.zmComp||{}),function(e){var t=zmUtil.composeI18N(),n=function i(a){var e=a.folderType,m=void 0===e?a.folder:e,t=a.dbSyncEmails,r=a.serverFailed,o=a.dbFailed,d=a.outboxList,s=a.sentList,p=a.draftList,l=a.templateList,n=a.resolveFunc,c=a.totalEmails;if(0!==t.length){var u=t[0];t.splice(0,1);var f={prm:{p:u.PRM.P,ep:u.PRM.EP},adapterId:"http-adapter"},z=u.dbData.OFFLINE_ATTID;zmCompOffline.initAttachment(z).then(function(e){if(e.attTmp.length){var t=JSON.stringify(e.attTmp);f.prm.p.attTmpObj=t,f.prm.ep.attTmpObj=t,f.prm.ep.offlineAttRef=e.attRef}zmComp.composeCollection().triggerAction("sendMail",f).then(function(e){zmCompOffline.showPopup(m);var t=e.opts.resp,o=e.opts.prm.ep;if(t.error)zmCompOffline.updateDBFailed(u.MSGID,u,e),r.push(u),i(a);else{try{"drafts"===m?(p.push(u),$.publish("compose/offline/drafts",{msgId:u.MSGID})):"outbox"===m?u.PRM.P.sendImm?(s.push(u),$.publish("compose/offline/sent",{msgId:u.MSGID})):(d.push(u),$.publish("compose/offline/outbox",{msgId:u.MSGID})):"template"===m&&(l.push(u),$.publish("compose/offline/templates",{msgId:u.MSGID}));var n=zmComp.isOfflineTab(u.MSGID);(o.cmpId=n)&&zmComp.sendConf(t,o)}catch(e){}i(a),o.offlineAttRef&&o.offlineAttRef.clearAllOfflineFiles(),zmCompOffline.removeDraft(u.MSGID).then(function(e){window.console.log("draft cleared after online sync")})}},function(e){zmCompOffline.updateDBFailed(u.MSGID,u,e),o.push(u),i(a)})},function(){i(a)})}else if("function"==typeof n){var C={totalEmails:c,serverfailed:r,dbFailed:o};"drafts"===m?C.draftList=p:"outbox"===m?(C.outboxList=d,C.sentList=s):"template"===m&&(C.templateList=l),n(C)}},i=function(e,t){return e.DT>t.DT?1:t.DT>e.DT?-1:0},o={timeDate:function(e){return zmComponent.dateTimeUtil.getRelativeTimeForCompose(e,"day mm dd",!0)},getOfflineMailData:function(e,t){var o={};o=$.extend(!0,e.DATA.MOBJ,o);var n=e.PRM.P;return o.OFFLINE=e.OFFLINE,o.DBFAILED&&(o.DBFAILED=e.DBFAILED),o.FD=e.FD,o.TO=n.to,o.CC=n.cc,o.BCC=n.bcc,o.PRIORITY=3,"meta"===t?(o.M=e.MSGID,o.F=e.DATA.MOBJ.F,o.SN=e.DATA.MOBJ.SN,o.DT=zmCompOffline.timeDate(e.DT),o.P=n.priority,o.SB=n.subject,o.TOADDR=zmCompOffline.getToAddr(n)):(o.MSGID=e.MSGID,o.FROM=n.from,o.REPLYCC=n.cc,o.REPLYBCC=n.bcc,o.REPLYTO=n.replyto,o.SUBJECT=n.subject,o.CONTENT=n.content,o.SMT=2),o},getChangedData:function(e,t){for(var o in e)t[o]&&(e[o]=t[o]);return e},getSendList:function(){return new Promise(function(o,e){zmCompOffline.getOutboxEmails().then(function(e){var t=e.reverse();o(t)})})},getSaveList:function(){return new Promise(function(o,e){zmCompOffline.getDrafts().then(function(e){var t=e.reverse();o(t)})})},getTemplateList:function(){return new Promise(function(o,e){zmCompOffline.getTemplates().then(function(e){var t=e.reverse();o(t)})})},getMetaList:function(e){var t=[];if(e.length)for(var o in e){var n=e[o];if(n){var i=zmCompOffline.getOfflineMailData(n,"meta");t.push(i)}}return t},getOutboxEmails:function(){return new Promise(function(n,e){var t={storeId:zmail.folId.oId};zmComp.composeCollection().triggerAction("outbox",{attrs:t,adapterId:"indexDB"}).then(function(e){var t=e.resp.list;t.sort(i);var o=t.reverse();n(o)})})},getOfflineOutbox:function(){return new Promise(function(o,e){zmCompOffline.getOutboxEmails().then(function(e){var t=[];e.length&&(t=zmCompOffline.getMetaList(e)),o(t)})})},getOfflineDrafts:function(){return new Promise(function(o,e){zmCompOffline.getDrafts().then(function(e){var t=[];e.length&&(t=zmCompOffline.getMetaList(e)),o(t)})})},getOfflineTemplates:function(){return new Promise(function(o,e){zmCompOffline.getTemplates().then(function(e){var t=[];e.length&&(t=zmCompOffline.getMetaList(e)),o(t)})})},getDrafts:function(){return new Promise(function(n,e){var t={storeId:zmail.folId.dId};zmComp.composeCollection().triggerAction("drafts",{attrs:t,adapterId:"indexDB"}).then(function(e){var t=e.resp.list;t.sort(i);var o=t.reverse();n(o)})})},getTemplates:function(){return new Promise(function(n,e){var t={storeId:zmail.folId.teId};zmComp.composeCollection().triggerAction("templates",{attrs:t,adapterId:"indexDB"}).then(function(e){var t=e.resp.list;t.sort(i);var o=t.reverse();n(o)})})},getComposeData:function(){return new Promise(function(n,e){zmComp.composeCollection().triggerAction("composeData",{attrs:{},adapterId:"indexDB"}).then(function(e){var t=e.resp.list;t.sort(i);var o=t.reverse();n(o)})})},updateDBFailed:function(n,i,e){var a=e.resp;return new Promise(function(t,e){var o=zmComp.composeCollection();i.DBFAILED={type:2,failed:a},o.triggerAction("updateMessage",{attrs:{storeId:n,data:i},adapterId:"indexDB"}).then(function(e){t(e)})})},removeDBFailed:function(e){return _.filter(e,function(e){return!e.DBFAILED})},outbox:function(){return new Promise(function(o,e){zmCompOffline.getOutboxEmails().then(function(e){if((e=zmCompOffline.removeDBFailed(e)).length){var t={folder:"outbox",dbSyncEmails:e.slice(0),resolveFunc:o,totalEmails:e.slice(0).length,serverFailed:[],dbFailed:[],sentList:[],outboxList:[]};n(t)}})})},drafts:function(){return new Promise(function(o,e){zmCompOffline.getSaveList().then(function(e){if(e.length){var t={folder:"drafts",dbSyncEmails:e.slice(0),resolveFunc:o,totalEmails:e.slice(0).length,serverFailed:[],dbFailed:[],draftList:[]};n(t)}})})},templates:function(){return new Promise(function(o,e){zmCompOffline.getTemplateList().then(function(e){if(e.length){var t={folder:"template",dbSyncEmails:e.slice(0),resolveFunc:o,totalEmails:e.slice(0).length,serverFailed:[],dbFailed:[],templateList:[]};n(t)}})})},removeDraft:function(i){return new Promise(function(o,e){var t=zmComp.composeCollection(),n={attrs:{storeId:i},adapterId:"indexDB"};t.triggerAction("removeDraft",n).then(function(e){var t=e.resp.key;o(t)})})},removeComposeDB:function(){return new Promise(function(o,e){var t=zmComp.composeCollection(),n={attrs:{userId:zmail.zuid},adapterId:"indexDB"};t.triggerAction("dropDB",n).then(function(e){var t=e.resp.userId;o(t)})})},getToAddr:function(e){var t="";return e.to&&(t+=e.to),e.cc&&(""!==t&&(t+=","),t+=e.cc),e.bcc&&(""!==t&&(t+=","),t+=e.bcc),t},getMetaData:function(e){return{F:zmComp.getFrom(e),SN:zmComp.getSender(e)}},showPopup:function(e){"outbox"===e&&zmComponent.showPopup({headerText:t.offline_sync_header,descText:t.offline_sync_messagetext,iconClass:"msi-send zmThmClr zmDoubleIcon"})},initAttachment:function(o){return new Promise(function(i,e){var t={storeAttachmentId:o,offlineUpload:!0,offlineEnabled:!0,componentId:"zmEdi_"};zmUtil.initAttachComponent(t,function(n){n.offlineGetAttachDeferred.then(function(e){var t={attTmp:[],attRef:n};if(e){var o=n.getOfflineDeferred();n.uploadOfflineAttachments(),o.then(function(){var e=n.getStoreAttachments(!0);e&&(t.attTmp=e.tempLocation),i(t)})}else i(t)},function(){e()})})})},sendMailSync:function(){zmCompOffline.outbox().then(function(e){var t=e.outboxList.length,o=e.sentList.length;(t||o)&&$.publish("compose/offline/outboxView",e)}),zmCompOffline.drafts().then(function(e){$.publish("compose/offline/draftsView",e)}),zmCompOffline.templates().then(function(e){$.publish("compose/offline/templatesView",e)})}};_zm.isOfflineLockAvailable()&&$.subscribe("/network/online",function(){zmCompOffline.sendMailSync()}),$.extend(!0,e,o)}(window.zmCompOffline=window.zmCompOffline||{}),function(e){var t={getMessageData:function(o,a){return new Promise(function(i,e){var t={storeId:o};zmComp.composeCollection().triggerAction("getDraft",{attrs:t,adapterId:"indexDB"}).then(function(e){var t;if(e.resp&&e.resp.draft){t=e.resp.draft;var o={};if(o.meta=zmCompOffline.getOfflineMailData(t,"meta"),a){var n=zmCompOffline.getOfflineMailData(t);o.content=$.extend(!0,n,t.dbData)}window.console.log("getMessageData",o),i(o)}})})},updateMessageData:function(i,e,t){var a;return e&&t&&(a={queue:1}),new Promise(function(o,e){var n=zmComp.composeCollection();n.triggerAction("getDraft",{attrs:{storeId:i},adapterId:"indexDB"}).then(function(e){if(window.console.log("maildata",e),e.resp&&e.resp.draft){var t=e.resp.draft;a&&(t.DBFAILED=a),n.triggerAction("updateMessage",{attrs:{storeId:i,data:t},adapterId:"indexDB"}).then(function(e){o(e),window.console.log("updateMessageData",e)})}})})},offlineRespData:function(e,t){var o=t.cmpId,n=e.DT,i=e.MSGID,a=zmComponent.dateTimeUtil.getRelativeTimeForCompose(n,"day mm dd",!0),m={msgId:i,dftst:e.dftst=a,msgObj:zmCompOffline.getOfflineMailData(e,"meta"),dataObj:zmCompOffline.getOfflineMailData(e)};"2"===e.OFFLINE&&("sdraft"===t.act?zmComp.setDraftUUId(o,i):"stemplate"===t.act&&zmComp.setTemplateUUId(o,i)),$.publish("compose/offline/savedDraft",{msgId:i,folderId:e.FD}),zmComp.sendConf(m,t)},sendMail:function(e){var o,n,t={hideErrorMsg:!0};t.prm=e,zmComp.composeCollection().triggerAction("sendMail",t).then(function(e){e.opts.isOffline?(o=e.resp,n=e.opts.prm.ep,zmCompAdapter.offlineRespData(o,n)):(o=e.opts.resp,n=e.opts.prm.ep,zmComp.sendConf(o,n))},function(e){if(e.opts.isOffline)zmCompAdapter.offlineRespError(e);else{var t=e.err.errCode;t&&(o=e.err.respObj,n=e.opts.prm.ep,"3"===t?zmComp.sendError(o,n):"1"===t&&zmComp.networkError(n))}})}};$.extend(!0,e,t)}(window.zmCompAdapter=window.zmCompAdapter||{}),function(e){var t={setHeight:function(e,t){if(zmComp.getObj(e)){var o=zmComp.getType(e);"p"===o?zmComp.setPrevHeight(e,t):"w"===o?zmComp.setWindowHeight(e,t):"d"===o?zmComp.setQuickHeight(e,t):zmComp.setTabHeight(e,t)}},resetHeight:function(e){var t=e.attr("id").split("_")[1];zmComp.setHeight(t)},setPrevHeight:function(e,t){var o;if(zmComp.getObj(e).info&&zmComp.getObj(e).info.prevDOM&&(o=zmComp.getObj(e).info.prevDOM),o){var n=o.find(".zm_cmp");zmComp.updateHeight(e,t,n,300)}},setWindowHeight:function(e,t){var o=$.q(zmail.win).height(),n=$.q("#zmComposeWrapper");zmComp.updateHeight(e,t,n,o)},setTabHeight:function(e,t){if(zmsuite.getAppObj()[e]){var o=zmsuite.getAppObj()[e].centerObj.$el,n=o.outerHeight();zmComp.updateHeight(e,t,o,n)}},setQuickHeight:function(e,t){var o=$.q(zmail.win).height(),n=$.q(".zm_compose").offset().top,i=$.q("#wmstoolbar").outerHeight(),a=zmComp.getObj(e)._dDialog,m=o-(n+i),r=zmCUtil.getCenterAppElem(),d=700;r&&(d=r.width()),a.$els.$contentWrapper.css({"max-width":d+"px",padding:"0px"});var s=a.$els.$contentWrapper;zmComp.updateHeight(e,t,s,m)},updateHeight:function(e,t,o,n){if(n){var i=zmComp.getType(e),a=n-(o.find(".SCmb").eq(0).outerHeight()+o.find(".zmCR").outerHeight());if("p"===i&&(a=n),o.find(".zmCEA").height(a),zmUtil.isAttachmentSectionEnabled()&&!t){var m=a/100*30;$.q("#zmAttLst_"+e).css({"max-height":m+"px"})}var r=$.q("#zmAtt_"+e).outerHeight();a-=r,o.find(".zmCE").height(a);var d=o.find(".ze_SCmb");if(d.outerHeight())a-=d.outerHeight();o.find("iframe.ze_area").height(a),o.find("textarea.ze_area").height(a-30);var s=o.find("#zmDrag_"+e);s.height(a),s.css("bottom",r)}}};$.extend(!0,e,t)}(window.zmComp),function(e){var m=zmUtil.composeI18N(),d=e.getCmpObj(),t={shareAttachments:function(e){var t={to:"",cc:"",bcc:""};e.to&&(t.to=e.to),e.cc&&(t.cc=e.cc),e.bcc&&(t.bcc=e.bcc),t.attachments=e.cloudAttList,$.publish("compose/attachments",t)},loadAttachment:function(e,t,o){var n={},i=[],a={};if(o&&(o.NEWATT&&"replyall"!==t&&"reply"!==t&&(i=o.NEWATT),o.FWDMSG&&(n.FWDMSG=o.FWDMSG),o.FWDTID&&(n.FWDTID=o.FWDTID),o.OFFLINE_ATTID&&zmComp.setAttachmentUUId(e,o.OFFLINE_ATTID),o.docsObj&&(a=o.docsObj)),zmail.isComposeMail&&d[e].info&&d[e].info.attTmpObj){var m=d[e].info.attTmpObj;m.forEach(function(e){e.name=e.n}),i=m}zmComp.initAttachment(e,i,n,a)},initAttachment:function(n,e,i,a){i=i||{};var t,m=$.Deferred();d[n]&&zmComp.getAccId(n)&&(t=zmComp.getAccId(n));var o={componentId:"zmEdi_"+n,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],isNewImp:!0,currentAttachedSize:0,autoLaunch:!1,eleId:"zmAttLst_"+n,onAddElement:function(e){zmComp.updateAttachment(n,"ele","add",e)},onRemoveElement:function(e){zmComp.updateAttachment(n,"ele","remove",e)},onAddAttachment:function(e){zmComp.updateAttachment(n,"att","add",e)},onRemoveAttachment:function(e){zmComp.updateAttachment(n,"att","remove",e)},onExpandCollapse:function(){zmComp.setHeight(n,!0)},preAttachedFile:e,insertDocsLink:zmComp.insertDocsLink};zmComp.isPopup()&&(o.appTypePopup=!0),t&&(o.accId=t);var r=zmComp.getSMType(n);return o.renameSupport=!0,"richtext"===r&&(o.showZDocsAsLinkOption=!0),o.editorMode=r,zmUtil.isAttachmentSectionEnabled()&&(o.attachmentSection=!0),zmail.isZMOfflineEnabled&&!zmComp.isPopup()&&(o.offlineEnabled=!0,o.storeAttachmentId=zmComp.getAttachmentUUId(n)),zmUtil.initAttachComponent(o,function(e){if(d[n]){zmComp.setAttRef(n,e);try{d[n].attachmentDeferred&&d[n].attachmentDeferred.resolve()}catch(e){}if(i&&(i.FWDMSG||i.FWDTID)){var t=[],o=[];i.FWDMSG&&(t=i.FWDMSG),i.FWDTID&&(o=i.FWDTID),zmComp.fwdEmlInsert(n,t,o,!0)}}$.isEmptyObject(a)||zmComp.attachFromDocs(n,a),zmComp.updateSecCountAttachment(n),zmComp.editorCloudState(n),zmComp.setHeight(n),m.resolve({cmpId:n,attRef:e})}),m.promise()},reloadAttachment:function(e){var t=[];d&&d[e]&&d[e].attCompRefList&&(t=d[e].attCompRefList),zmComp.initAttachment(e,t)},deleteEml:function(e){var t=e.id,o=e.componentId,n=zmComp.getCurrentCompId();!n&&o&&(n=zmComp.zmsubStr(o,"zmEdi_"));var i=[],a=(i=e.thrd?zmComp.getFwdThrd(n):zmComp.getFwdMsg(n)).indexOf(t);-1!==a&&i.splice(a,1),zmComp.updateSecCountAttachment(n)},convertEml:function(e){return{fname:e.sub,type:"eml",id:e.mId,thrd:e.thrd,componentId:e.cmpId}},fwdEmlInsert:function(e,t,o,n){var i,a,m=zmComp.getAttRef(e),r=zmComp.getFwdAtt(t,o),d=r.fwdLst,s=[],p=[],l=[],c=!1,u="";if(d.length){u=r.subject;for(var f=d.length,z=0;z<f;z++)i=-1,a=d[z].mId,d[z].thrd?((l=zmComp.getFwdThrd(e))&&l.length&&(i=l.indexOf(a)),-1===i&&(c=!0,p.push(a))):((l=zmComp.getFwdMsg(e))&&l.length&&(i=l.indexOf(a)),-1===i&&(c=!0,s.push(a))),c&&(d[z].cmpId=e,m.insertExtFiles(zmComp.convertEml(d[z]),zmComp.deleteEml));c&&(zmComp.setFwdThrd(e,p),zmComp.setFwdMsg(e,s),zmComp.updateSecCountAttachment(e)),n&&u&&""!==$.trim(u)&&($.q("#zmsub_"+e).val(u),zmComp.setSubject(e,u)),zmComp.setHeight(e,!0)}},dropCmpFwdMe:function(e){var t=e.msgList,o=t.tIds,n=t.mIds,i=e.maskElem.attr("id").split("_")[1];zmComp.fwdEmlInsert(i,n,o)},removeDocsAtt:function(e,t){var o=t.id,n=zmComp.getZDocObj(e);if(o)for(var i=n.docStore,a=i.length,m=0;m<a;m++)if(i[m].split(":")[1]===o){n.docName.splice(m,1),n.docPath.splice(m,1),n.docStore.splice(m,1);var r={docName:n.docName,docPath:n.docPath,docStore:n.docStore};return zmComp.setZDocObj(e,r),!1}},attachFromDocs:function(t,e){for(var o=e.docName.length,n=0;n<o;n++){var i=e.docStore[n].split(":")[1],a=e.docStore[n].split(":")[2],m="others";"writer"===a?m="writer":"sheet"===a?m="sheet":"show"===a&&(m="show");var r={fname:e.docName[n],id:i,type:m,componentId:t};zmComp.getAttRef(t).insertExtFiles(r,function(e){zmComp.removeDocsAtt(t,e)})}var d={docName:e.docName,docPath:e.docPath,docStore:e.docStore};zmComp.setZDocObj(t,d)},attActionBind:function(t,o){var e=o.find("#zmAttCntHeader_"+t);$.e(e).off("mousedown").on("mousedown",function(){var e=o.find("#zmAttLstPar_"+t);zmComp.updateSecCountAttachment(t),e.is(":visible")?(e.slideUp(400,function(){zmComp.setHeight(t,!0)}),o.removeClass("zmCompShwAtt")):(e.slideDown(400,function(){zmComp.setHeight(t,!0)}),o.addClass("zmCompShwAtt"))})},getAttachmentCount:function(e){var t,o;zmComp.getAttRef(e)&&(t=(o=zmComp.getAttRef(e)).getStoreAttachments(!0));var n=0;if(t){n=t.attachmentCount;var i=o.isAttachingCount;i&&(n+=i)}var a=zmComp.getFwdMsg(e);a&&a.length&&(n+=a.length);var m=zmComp.getFwdThrd(e);return m&&m.length&&(n+=m.length),n},updateSecCountAttachment:function(e){var t=$.q("#zmAtt_"+e);1===$.q("#zmAttLst_"+e).find("> div").length?t.addClass("zmCompSingleAttGrp"):t.removeClass("zmCompSingleAttGrp");var o=zmComp.getAttachmentCount(e),n=$.q("#zmAttCntTxt_"+e);n=$.e(n);var i=m.attachment;if(1<o&&(i=m.attachments),o){var a=o+" "+i;n.text(a)}},updateSecAttachment:function(e,t,o){var n=$.q("#zmAtt_"+e);if("ele"===t){if("add"===o){$.e(n).is(":visible")||$.e(n).removeClass("zmHideD");var i=n.find("#zmAttLstPar_"+e);i.is(":visible")||(i.slideDown(400,function(){zmComp.setHeight(e,!0)}),n.addClass("zmCompShwAtt"))}else if("remove"===o){var a=n.find("#zmAttLst_"+e);$.e(a).find("> div").length||$.e(n).addClass("zmHideD")}zmComp.updateSecCountAttachment(e)}},updateFixedAttachment:function(e,t,o){var n=$.q("#zmAtt_"+e);if("ele"===t)if("add"===o)$.e(n).is(":visible")||$.e(n).removeClass("SC_dyn");else if("remove"===o){var i=n.find("#zmAttLst_"+e);$.e(i).find("> div").length||n.addClass("SC_dyn")}},editorCloudState:function(e){var t,o,n,i=zmComp.getAttRef(e);i&&(n=i.getStoreAttachments(!0)),n&&(t=n.hugeAttachment,o=n.cloudAttList);var a=zmComp.getEditor(e),m=!1;t&&t.length&&(m=!0),o&&o.length&&(m=!0),a&&a.initobj&&(a.initobj.showModeChgMsg=m)},stateUpdateEditor:function(e,t,o){"att"!==t||"add"!==o&&"remove"!==o||zmComp.editorCloudState(e)},updateAttachment:function(e,t,o){zmComp.getAttRef(e)&&"att"===t&&zmComp.setModified(e,1),zmUtil.isAttachmentSectionEnabled()?zmComp.updateSecAttachment(e,t,o):zmComp.updateFixedAttachment(e,t,o),zmComp.stateUpdateEditor(e,t,o),zmComp.setHeight(e,!0)},modeChange:function(e,t){var o,n=t.split("_")[1];if(zmComp.getAttRef(n)){var i,a,m=(o=zmComp.getAttRef(n)).getStoreAttachments(!0);if("plaintext"===e)o.updateConfig({showZDocsAsLinkOption:!1}),m&&(i=m.hugeAttachment,a=m.cloudAttList),i&&i.length&&o.removeHugeFiles(),a&&a.length&&o.removeCloudFiles();else"richtext"===e&&o.updateConfig({showZDocsAsLinkOption:!0})}zmCUtil.regenerateToolbar(n)}};$.extend(!0,e,t)}(window.zmComp),function(e){var o=e.getCmpObj(),t={},n={},i={},a=function(){var o=zmail.Settings.Apps.SendMailAs.models,e=function(){var e=o.getSendMailAsCollection(),t=_.filter(e.models,function(e){return e.get("isEnabled")}),r={};t.forEach(function(e){var t,o,n,i,a=e.get("fromAddr"),m={FRM_DISN:e.get("dispName"),FRM_ORDER:e.get("order"),FRM_SIGMODE:e.get("mode"),FRM_SIGID:(t=e.get("sendId"),o=(zmail.Signature&&zmail.Signature.models.models).models,n=_.filter(o,function(e){return-1!==e.get("sendMailIds").indexOf(t)}),i="",n.length&&(i=n[0].get("id")),i)};e.get("isReplyVerified")&&(m.FRM_REPLY=e.get("replyTo")),m.FRM_SMIME=e.get("isSmimeEnabled"),r[a]=m}),zmail.cmpdata.FROM_LIST=r,zmComp.setFromObj(zmComp.frmListObj(zmail.cmpdata.FROM_LIST))};o.sendMailCollectionDeferred.done(function(){zmail.Signature&&zmail.Signature.initialize().done(function(){e()})})},m={newInstance:function(e){"reply"!==(this.mode=e)&&"replyall"!==e&&"fwdi"!==e||(this.inlineMode=e),this.modified=0,this.editor="",this.lastModified=0,this.prevModified=0,this.charset=n.charset,this.refHeader="",this.inReplyTo="",this.mailId="",this.mymId="",this.mailData="",this.metaData="",this.priority="Medium",this.attTmpObj=[],this.process=!1,this.subject="",this.accId=zmail.accId,this.dmailid="",this.tempId="",this.data_mailId="",this.data_inReplyTo="",this.data_refHeader="",this.fromAddr=zmComp.getDefaultFrom(),this.replyto=zmComp.getDefaultReplyTo(this.fromAddr),this.uplpending=0,this.imagepending=0,this.discard_close=!1,this.inlinemapObj={},0===n.askReceipt&&(this.askreceipt="yes"),this.showSuggestionContacts="0"===zmAdHocSettings.getContactsSuggestionType(),this.datereminder=!0,this.debounceSave=!0,this.remindersetting=!1,this.updateTagMatch=!0,this.from="",this.sender="";var t="richtext";0===n.smType&&(t="plaintext"),this.sugType="to",this.smType=t,this.daddr="",this.storeAttachmentId=String(zmail.DataLayer.Utils.getNextUUID()),this.initialState={subject:"",content:"",updateState:!0},this.requestState={triggerType:"",viaType:"",retry:"",networkFailure:""}},prevInstance:function(){this.to="",this.cc="",this.bcc="",this.isCC="",this.isBCC="",this.from="",this.replyto="",this.msgId=""},updateCmpSet:function(t){var e;e=zmail.cmpdata,n.askReceipt=e.ASKRECEIPT,n.charset=e.CHAR_SET,e.DEFFRM_ADDR&&zmComp.setDefaultFrom(e.DEFFRM_ADDR),n.smType=e.HTML_ENABLED,n.outIntr=e.OUT_INTERVAL,n.setRepto=e.SETREPTO,n.showBcc=e.SHOWBCC,zmComp.setFromObj(zmComp.frmListObj(e.FROM_LIST)),zmComp.setSignObj(e.SIGN_INFO),zmComp.setEncodeList(e.ENCODE_LIST),zmComp.isPopup()?zmComp.getSendMailDetails().then(function(e){zmail.cmpdata.FROM_LIST=e,zmComp.setFromObj(zmComp.frmListObj(zmail.cmpdata.FROM_LIST)),zmComp.fromAddrDropBind(t)}):a()},getFromDispN:function(e){if(e&&""!==$.trim(e)){var t=(o=e,n=zmail.cmpdata.FROM_LIST,i="",n&&!$.isEmptyObject(n)&&n[o]&&n[o].FRM_DISN&&(i=n[o].FRM_DISN),i);t&&(e=t+" <"+e+">")}var o,n,i;return e},getFromData:function(e,t){var o=t.REPLYFROM||"";"outbox"===e||"draft"===e||"template"===e?o=t.FROM:"fwdi"===e?o=zmComp.getDefaultFrom():"reply"!==e&&"replyall"!==e||1!==zmail.userOptions.replyFrom||(o=zmComp.getDefaultFrom());var n=zmComp.getFromObj(),i=Object.keys(n),a=o.toLowerCase(),m=!1;return i.forEach(function(e){a===e.toLowerCase()&&(m=!0)}),m||(o="draft"===e&&t.SHID?t.FROM:zmComp.getDefaultFrom()),o},getPrvObj:function(){return zmComp.cmpPrvObj},getFromObj:function(){return t.fromObj},getTemplate:function(){return t.tempObj},setTemplate:function(e){t.tempObj=e},getEncodeList:function(){return t.encode},setEncodeList:function(e){t.encode=e.split(",")},getSignObj:function(){return t.signObj},setSignObj:function(e){t.signObj=e},getDefault:function(){return n},getDefaultFrom:function(){return zmail.fromAddr},setDefaultFrom:function(e){zmail.fromAddr=e},setFromObj:function(e){t.fromObj=e},getPriority:function(e){return o[e].priority},setPriority:function(e,t){o[e].priority=t},getMymId:function(e){return o[e].mymId},setMymId:function(e,t){o[e].mymId=t},getDraftId:function(e){return o[e].storeDraftId},setDraftId:function(e,t){o[e].storeDraftId=t},getTemplateId:function(e){return o[e].storeTemplateId},setTemplateId:function(e,t){o[e].storeTemplateId=t},getOutboxId:function(e){return o[e].storeOutboxId},setOutboxId:function(e,t){o[e].storeOutboxId=t},getAttachmentUUId:function(e){return o[e].storeAttachmentId},setAttachmentUUId:function(e,t){o[e].storeAttachmentId=t},getDraftUUId:function(e){return o[e].draftUUId},setDraftUUId:function(e,t){o[e].draftUUId=t},getOutboxUUId:function(e){return o[e].outboxUUId},setOutboxUUId:function(e,t){o[e].outboxUUId=t},getTemplateUUId:function(e){return o[e].templateUUId},setTemplateUUId:function(e,t){o[e].templateUUId=t},getMetaData:function(e){return o[e].metaData},setMetaData:function(e,t){o[e].metaData=t},getMailId:function(e){return o[e].mailId},setMailId:function(e,t){o[e].mailId=t},getInReplyTo:function(e){return o[e].inReplyTo},setInReplyTo:function(e,t){o[e].inReplyTo=t},getRefHeader:function(e){return o[e].refHeader},setRefHeader:function(e,t){o[e].refHeader=t},getCharSet:function(e){return o[e].charset},setCharSet:function(e,t){o[e].charset=t},setZDocObj:function(e,t){o[e].zDocObj=t},getZDocObj:function(e){return o[e].zDocObj},getStatus:function(e){return o[e].process},setStatus:function(e,t){o[e].process=t},getSubject:function(e){return o[e].subject},setSubject:function(e,t){o[e].subject=t},getFromAddr:function(e){return o[e].fromAddr},setFromAddr:function(e,t){o[e].fromAddr=t},getReplyTo:function(e){return o[e].replyto},setReplyTo:function(e,t){o[e].replyto=t},getShareId:function(e){return o[e].shareId},setShareId:function(e,t){o[e].shareId=t},getInterVal:function(e){return o[e].interval},setInterVal:function(e,t){o[e].interval=t},getAttTmp:function(e){return o[e].attTmpObj},setAttTmp:function(e,t){o[e].attTmpObj.push(t)},getFwdThrd:function(e){return o[e].fwdThrdObj},setFwdThrd:function(e,t){zmComp.getFwdThrd(e)?o[e].fwdThrdObj=o[e].fwdThrdObj.concat(t):o[e].fwdThrdObj=t},getFwdMsg:function(e){return o[e].fwdMsgObj},setFwdMsg:function(e,t){zmComp.getFwdMsg(e)?o[e].fwdMsgObj=o[e].fwdMsgObj.concat(t):o[e].fwdMsgObj=t},getAttEnt:function(e){return o[e].attEntObj},setAttEnt:function(e,t){zmComp.getAttEnt(e)?o[e].attEntObj=o[e].attEntObj.concat(t):o[e].attEntObj=t},getAttEntity:function(e){return o[e].attEntity},setAttEntity:function(e,t){zmComp.getAttEntity(e)?o[e].attEntity=o[e].attEntity.concat(t):o[e].attEntity=t},getEditor:function(e){return o[e].editor},setEditor:function(e,t){o[e].editor=t},getAttRef:function(e){return o[e].attCompRef},setAttRef:function(e,t){o[e].attCompRef=t},getType:function(e){return o[e].type},setType:function(e,t){o[e].type=t},getSmartData:function(e){return o[e].smartData},setSmartData:function(e,t){o[e].smartData=t},getFID:function(e){return o[e].fId},setFID:function(e,t){o[e].fId=t},getModified:function(e){return o[e].modified},setModified:function(e,t){zmComp.getContentUpdateFlagState(e)&&(1===t&&(zmComp.enableSave(e),"sync"===zmComp.getNetworkStatus(e)&&zmComp.updateNetworkStatus(e)),o[e].modified=t)},getMode:function(e){return o[e].mode},setMode:function(e,t){o[e].mode=t},getOutboxClose:function(e){return o[e].setOutboxClose},setOutboxClose:function(e,t){o[e].setOutboxClose=t},getSendImm:function(e){return o[e].sendImm},setSendImm:function(e,t){o[e].sendImm=t},getOutboxMailId:function(e){return o[e].outboxMailId},setOutboxMailId:function(e,t){o[e].outboxMailId=t},getAskReceipt:function(e){return o[e].askreceipt},setAskReceipt:function(e,t){o[e].askreceipt=t},getTempId:function(e){return o[e].tempId},setTempId:function(e,t){o[e].tempId=t},setCmtDraftId:function(e,t){i[t]=e},getCmtDraftId:function(e){return i[e]},setSugType:function(e,t){o[e].sugType=t},getSugType:function(e){return o[e].sugType},setCommentObj:function(e,t){o[e].commentObj=t},getCommentObj:function(e){return o[e].commentObj},setShowSuggestions:function(e,t){o[e].showSuggestionContacts=t},getShowSuggestions:function(e){return o[e].showSuggestionContacts},setDateReminder:function(e,t){o[e].datereminder=t},getDateReminder:function(e){return o[e].datereminder},setInlineMode:function(e,t){o[e].inlineMode=t},getInlineMode:function(e){return o[e].inlineMode},setExecuteSave:function(e,t){o[e].debounceSave=t},getExecuteSave:function(e){return o[e].debounceSave},setReminderSetting:function(e,t){o[e].remindersetting=t},getReminderSetting:function(e){return o[e].remindersetting},setEditorContent:function(e,t){o[e].mailcontent=t},getEditorContent:function(e){return o[e].mailcontent},setMailData:function(e,t){t.CONTENT&&(t.CONTENT=zmComp.updateAttLink(t.CONTENT)),t.SHID&&zmComp.setShareId(e,t.SHID),t.DADDR&&zmComp.setDADDR(e,t.DADDR),o[e].mailData=t},getMailData:function(e){return o[e].mailData},setTagMatching:function(e,t){o[e].updateTagMatch=t},getTagMatching:function(e){return o[e].updateTagMatch},setFrom:function(e,t){o[e].from=t},getFrom:function(e){return o[e].from},setSender:function(e,t){o[e].sender=t},getSender:function(e){return o[e].sender},setSMType:function(e,t){o[e].smType=t},getSMType:function(e){return o[e].smType},setDADDR:function(e,t){o[e].daddr=t},getDADDR:function(e){return o[e].daddr},setInitialContent:function(e,t){o[e].initialState.content=t},getInitialContent:function(e){return o[e].initialState.content},setInitialSubject:function(e,t){o[e].initialState.subject=t},getInitialSubject:function(e){return o[e].initialState.subject},setContentUpdateFlagState:function(e,t){o[e].initialState.updateState=t},getContentUpdateFlagState:function(e){return o[e].initialState.updateState},setRetry:function(e,t){o[e].requestState.retry=t},getRetry:function(e){return o[e].requestState.retry},setNetworkStatus:function(e,t){o[e].requestState.networkFailure=t},getNetworkStatus:function(e){return o[e].requestState.networkFailure},setTriggerType:function(e,t){o[e].requestState.triggerType=t},getTriggerType:function(e){return o[e].requestState.triggerType},setViaType:function(e,t){o[e].requestState.viaType=t},getViaType:function(e){return o[e].requestState.viaType},setFocusOption:function(e,t){o[e].focusOption=t},getFocusOption:function(e){return o[e].focusOption},setInfo:function(e,t){o[e].info=t},getInfo:function(e){return o[e].info}};$.extend(!0,e,m)}(window.zmComp),function(e){var r=e.getCmpObj(),s=zmUtil.composeI18N(),p=function(e,t){return e.order<t.order?-1:e.dispName>t.dispName?1:0},d=function(t){setTimeout(function(){var e=zmComp.getRetry(t);e.reconnect=!0,zmComp.sendMail(e)},1e3)},t={getDelegateAddr:function(e){var t="",o=!1,n=zmComp.getMode(e);return!n||"reply"!==n&&"replyall"!==n||(o=!0),r[e]&&zmComp.getShareId(e)&&o&&zmComp.delegateEID(e)&&(t=zmComp.delegateEID(e)),t},getReplyToRowObj:function(e,t){var o=[],n=zmComp.getReplyToRowList(t),i=zmComp.getReplyTo(e);for(var a in n){var m=n[a],r={data:{replyto:m.replyTo}},d="msi-untick";m.replyTo===i&&(d="msi-tick zmThmClr"),m.text?r={dom:zdom("b",null,m.text),className:"nohr zmDDSecHdr"}:r.dom=zdom("zmfrag",null,zdom("i",{className:d}),zmComp.getFromDispN(m.replyTo)),o.push(r)}return o},getFromRowObj:function(e,t){var o=zmComp.getFromAddr(e),n=[],i=zmComp.getFromRowList(t);for(var a in i){var m=i[a],r={data:{from:m.from,signId:m.signId}},d="msi-untick";m.from===o&&(d="msi-tick zmThmClr"),m.text?r={dom:zdom("b",null,m.text),className:"nohr zmDDSecHdr"}:r.dom=zdom("zmfrag",null,m.smime&&zdom("i",{className:"msi-secured zmDGreenClr zmDoubleIcon"}),zdom("i",{className:d}),zmComp.getFromDispN(m.from)),n.push(r)}return n},getReplyToRowList:function(e){var t=[],o=[],n=[],i=[],a=[];for(var m in e){var r=e[m].FRM_SIGMODE,d={replyTo:m,order:e[m].FRM_ORDER};m===zmail.aInfo[zmUtil.getZohoAccId()].mailId?t.push(d):6===r?o.push(d):2===r?n.push(d):0===r||1===r?i.push(d):a.push(d)}return a=a.sort(p),o=o.sort(p),n=n.sort(p),i=i.sort(p),0<t.length&&t.unshift({text:s.primaryAddr}),0<i.length&&i.unshift({text:s.aliasAddr}),0<a.length&&a.unshift({text:s.externalAddr}),0<n.length&&n.unshift({text:s.groupAddr}),0<o.length&&o.unshift({text:s.delegatedAddress}),t.concat(i,a,n,o)},getFromRowList:function(e){var t=[],o=[],n=[],i=[],a=[];for(var m in e){var r=e[m].FRM_SIGMODE,d={from:m,smime:e[m].FRM_SMIME,order:e[m].FRM_ORDER,signId:(e[m]||{}).FRM_SIGID};m===zmail.aInfo[zmUtil.getZohoAccId()].mailId?t.push(d):6===r?o.push(d):2===r?n.push(d):0===r||1===r?i.push(d):a.push(d)}return a=a.sort(p),o=o.sort(p),n=n.sort(p),i=i.sort(p),0<t.length&&t.unshift({text:s.primaryAddr}),0<i.length&&i.unshift({text:s.aliasAddr}),0<a.length&&a.unshift({text:s.externalAddr}),0<n.length&&n.unshift({text:s.groupAddr}),0<o.length&&o.unshift({text:s.delegatedAddress}),t.concat(i,a,n,o)},fromListDrop:function(d,e,t,s){var o={par:t};o.list=zmComp.getFromRowObj(d,e),o.align="pleft",o.clk=function(e){var t=e.from,o=e.signId,n=$.q("#zm_fromaddr_"+d),i=$.q("#zm_replyto_addr_"+d),a=zmComp.getFromDispN(t);n.text(a),zmComp.setFromAddr(d,t);var m=zmComp.getDefaultReplyTo(t);if(m?(s.removeClass("SC_dyn"),zmComp.setReplyTo(d,m)):s.addClass("SC_dyn"),zmComp.updateToolbarForSignature(d),i.text(m),!_zm.isOfflineSyncActive()){zmComp.updateShieldIcon(d);var r=zmComp.getRecipientComponent({composeID:d});r.resetSmimeState(),r.cacheSmimeData({fromAddress:t}).then(function(){r.fetchSmimeState()},function(){})}zmComp.allowSignature(d)&&zmCDrop.signUpdate(d,o),zmComp.updateToolbarForSignature(d),zmUtil.hideMenu()},zmUtil.showMenu(o)},getDataReplyTo:function(e){var t="";return zmComp.getFromObj()[e]&&zmComp.getFromObj()[e].FRM_REPLY&&(t=zmComp.getFromObj()[e].FRM_REPLY),t},getDefaultReplyTo:function(e){var t=zmail.cmpdata.SETREPTO?zmail.cmpdata.SETREPTO:"",o=zmComp.getDataReplyTo(e);return o&&(t=o),t},getFromAddrList:function(e){var t=$.extend(!0,{},zmComp.getFromObj()),o=zmComp.getDelegateAddr(e),n=zmComp.getDADDR(e);return n&&(o=n),o&&(t[o]?t[o].FRM_SIGMODE=6:t[o]={FRM_SIGMODE:6}),t},getReplyToAddrList:function(e){var t=$.extend(!0,{},zmComp.getFromObj()),o=zmComp.getDefault().setRepto;o&&!t[o]&&(t[o]={FRM_SIGMODE:4});var n=zmComp.getReplyTo(e);n&&!t[n]&&(t[n]={FRM_SIGMODE:4});var i=zmComp.getFromAddr(e),a=zmComp.getDefaultReplyTo(i);return a&&!t[a]&&(t[a]={FRM_SIGMODE:4}),t},replyToListDrop:function(t,e,o){var n={par:o};n.list=zmComp.getReplyToRowObj(t,e),n.align="pright",n.clk=function(e){zmUtil.hideMenu(),zmComp.setReplyTo(t,e.replyto),$.q("#zm_replyto_addr_"+t).text(e.replyto)},zmUtil.showMenu(n)},fromAddrDropBind:function(e){var t=zmComp.getFromAddrList(e),o=zmComp.objSize(t),n=$.q("#zm_fSel_"+e),i=$.q("#zm_repSel_"+e),a=n.find("i.msi-barrow");1===o?a.addClass("SC_dyn"):1<o&&(a.removeClass("SC_dyn"),n.off("click").on("click",function(){t=zmComp.getFromAddrList(e),zmComp.fromListDrop(e,t,n,i)}));var m=zmComp.getReplyToAddrList(e),r=zmComp.objSize(m),d=i.find("i.msi-barrow");1===r?d.addClass("SC_dyn"):1<r&&(d.removeClass("SC_dyn"),i.off("click").on("click",function(){m=zmComp.getReplyToAddrList(e),zmComp.replyToListDrop(e,m,i)}))},updateDataFrom:function(e,t,o){var n=zmComp.getFromData(t,o),i=zmComp.getDADDR(e),a=zmComp.getDelegateAddr(e);i&&(a=i),a&&(n=a);var m=$.q("#zm_fromaddr_"+e),r=$.q("#zm_replyto_addr_"+e),d=zmComp.getFromDispN(n);m.text(d),zmComp.setFromAddr(e,n),zmComp.updateShieldIcon(e);var s=$.q("#zm_repSel_"+e),p=zmComp.getDefaultReplyTo(n);p?(s.removeClass("SC_dyn"),zmComp.setReplyTo(e,p)):s.addClass("SC_dyn"),r.text(p)},isZohoAcc:function(e){var t=!1;return zmUtil.isZohoAccount(zmComp.getAccId(e))&&(t=!0),t},checkIsAdminAddesSignPresent:function(e){var o=!1;return zmail.Signature.initialize().done(function(){if(0<zmail.Signature.adminAddedAcc.length){var t=zmComp.getFromAddr(e);zmail.Signature.adminAddedAcc.forEach(function(e){e===t&&(o=!0)})}}).fail(function(){}),o},allowSignature:function(e){var t=["reply","replyall"],o=zmComp.getInlineMode(e),n=!0,i=!1;(zmail.userOptions&&zmail.userOptions.hideSignatureInReply||zmail.mailOpt&&zmail.mailOpt.hideSignatureInReply)&&(i=!0);var a=zmComp.getMode(e),m=!1;return(-1!==t.indexOf(a)||o&&-1!==t.indexOf(o))&&(m=!0),m&&i&&(n=!1),n},getMailContent:function(e,t,o){var n={};n=zmContentCache.isCached(e)?zmContentCache.get(e):t.mdata;var i={};return void 0!==babelHelpers.typeof(n.CONTENT)&&(i=n),i},updateShieldIcon:function(e){var t=zmComp.getFromAddr(e);zmComp.getShield(t).then(function(){$.q("#zm_fSelShield_"+e).removeClass("SC_dyn")},function(){$.q("#zm_fSelShield_"+e).addClass("SC_dyn")})},getShield:function(n){return new Promise(function(t,o){zmComponent.smimeUtil.getConfirmedEmailList().then(function(e){null!==(e.filter(function(e){return e.emailId===n&&e.isSmimeEnabled})[0]||null)?t():o()},function(){o()})})},getSendMailDetails:function(){return new Promise(function(t,e){var o=$.extend(!0,{},zmail.cmpdata.FROM_LIST);zmComponent.smimeUtil.getConfirmedEmailList().then(function(e){e.forEach(function(e){var t=e.emailId;o[t].FRM_SMIME=e.isSmimeEnabled}),t(o)})})},isOfflineTab:function(e){for(var t in r)if(r[t].uuId===e)return t},shareDraftOption:function(e,t,o){!_zm.isOfflineSyncActive()&&_zm.isStreamsEnabled()&&zmail.isOrg&&zmComp.isZohoAcc(e)?(t&&o.draft_opt||o.restore||o.info&&o.info.hashKey)&&zmComp.draftComments(e,t,"draft_onload"):zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compShare")},getFullContent:function(e){var t="";return e.CONTENT&&(t=e.CONTENT,e.BLCKCON&&(t+=e.BLCKCON)),t},signContentObj:function(e){var t="",o=!1,n=zmComp.getFromObj(),i=zmail.fromAddr;zmComp.getFromAddr(e)&&(i=zmComp.getFromAddr(e));var a=(n[i]||{}).FRM_SIGID;if(a&&"null"!==a){var m=zmComp.getSignObj();m[a]&&(t=m[a].SIG_CONT,1===m[a].SIG_POS&&(o=!0))}return r[e].prm&&"note"===r[e].prm.entityType&&(o=!1),{_signTxt:t,_signOpt:o}},updateSMType:function(e){var t=zmComp.getSMType(e),o=zmComp.getMode(e),n=!1;-1!==["draft","template","outbox"].indexOf(o)&&(n=!0);var i,a=!1;if(-1!==["reply","replyall","fwdi"].indexOf(o)&&(a=!0),zmComp.getMailData(e))if(i=zmComp.getMailData(e),n)void 0!==i.SMT&&0===i.SMT?t="plaintext":void 0!==i.SMT&&2===i.SMT&&(t="richtext");else if(a&&zmail.showFeature){var m=zmail.userOptions.htmlenabled;0===m||1===m?0===m?t="plaintext":1===m&&(t="richtext"):3!==m&&4!==m||(3===m?t="plaintext":4===m&&(t="richtext"),void 0!==i.SMT&&0===i.SMT?t="plaintext":void 0!==i.SMT&&2===i.SMT&&(t="richtext"))}zmComp.setSMType(e,t)},updateAttLink:function(e){var t=zdom("div",{dangerouslySetInnerHTML:e});return $.e(t).find("div[class$='zmHugeLink']").remove(),$.e(t).find("div[class$='zmCloudLink']").remove(),$.e(t).html()},fromActionBind:function(e){$.q("#zm_repSel_"+e).addClass("SC_dyn"),zmComp.getReplyTo(e)&&$.q("#zm_repSel_"+e).removeClass("SC_dyn"),$.q("#zm_fromaddr_"+e).text(zmail.fromAddr),$.q("#zm_replyto_addr_"+e).text(zmComp.getReplyTo(e))},bindEditorEvents:function(t,e){var o=function(e){e.doc.addEventListener("mousedown",function(e){zmComp.showTrimmed(t,e)},!0)};-1!==navigator.userAgent.indexOf("Safari")?o(e):e.doc.attachEvent?e.doc.attachEvent("onmousedown",function(e){zmComp.showTrimmed(t,e)}):e.doc.addEventListener&&o(e)},isPopup:function(){var e=!1;return(zmUtil.isChildWindow()||zmail.isComposeMail)&&(e=!0),e},offSugDOMList:function(){try{for(var e in r)if(r&&r[e]){var t=$.q("#zmsuglist_"+e);t.length&&(r[e].resizeTab=!0,t.parent().hide())}}catch(e){}},offSugList:function(){try{for(var e in r)r&&r[e]&&(r[e].showSuggestionContacts=!1)}catch(e){}},onSugList:function(){try{for(var e in r)r&&r[e]&&(r[e].showSuggestionContacts=!0)}catch(e){}},resizeUtil:function(){try{for(var e in r)r&&r[e]&&(zmCUtil.transResizeRepDOM(e),zmComp.setTabHeight(e))}catch(e){}zmComp.resizeRepDOMList()},clearResizeRepDOM:function(){try{for(var e in r)r&&r[e]&&zmCUtil.clearResizeRepDOM(e)}catch(e){}}};t.getModeObj=function(e,t){var o="";return"string"===e&&(o={5:"reply",6:"replyall",7:"fwdi"}[t]),"int"===e&&(o={reply:"5",replyall:"6",fwdi:"7"}[t]),o},t.checkModified=function(){var t=!1;for(var e in r)try{if(r[e].discard_close)continue;1===zmComp.getModified(e)&&(t=!0);break}catch(e){t=!1}return t},t.isModified=function(e){var t=!1;r[e]&&1===zmComp.getModified(e)&&(t=!0);return t},t.getZDocLoc=function(e){var t=[],o=zmComp.getEditor(e).getContent().match(/https:\/\/docs.zoho.com\/file\/.[(a-z)(A-Z)(0-9]*/g);if(o&&o.length)for(var n=o.length,i=/https:\/\/docs.zoho.com\/file\//g,a=0;a<n;a++){var m=o[a].replace(i,"");t.push(m)}return t},t.popupTrimmed=function(e,t){var o=t.doc,n=$(o).find("[class=zmail_extra]");return n.length&&(n.show(),"ZM_SHWTRIM"===n.prev().attr("name")&&n.prev().remove()),t.getContent()},t.showTrimmed=function(e,t){var o=(t=t||window.event).target||t.srcElement;if(o&&"ZM_SHWTRIM"===$(o).attr("name")){t&&zmUtil.stopEvents(t),$(o).remove();var n=zmComp.getEditor(e).doc;$(n).find("[class=zmail_extra]").show()}else{if(o&&"ZM_SHAREDOC"===$(o).attr("name")&&$(o).is("a"))return window.open($(o).attr("href"),"_blank"),t&&zmUtil.stopEvents(t),!1;if(o&&"ZM_SHAREDOC"===$(o).attr("name")&&$(o).is("div")){var i=$(o).closest("table").attr("data-zmdocname");zmComp.clearZDoc(o,e,i)}else o&&$(o).closest("table").attr("data-zmdocname")&&t&&zmUtil.stopEvents(t)}},t.loadExtImages=function(e){var t;zmComp.getMailData(e)&&(t=zmComp.getMailData(e)),t&&t.EXTIMG&&zmCUtil.loadExtImages(e,t.EXTIMG)},t.loadShareDoc=function(e){var t,o,n;zmComp.getMailData(e)&&(t=zmComp.getMailData(e)),t&&t.SHDOC&&(o=t.SHDOC);var i=[],a=[],m=[];if(o&&o.SHDOCID){var r=o.SHDOCID;-1!==r.indexOf(",")?a=r.split(","):a.push(r),a.length&&(n=zmComp.getEditor(e).doc,i=$(n).find('a[name="ZM_SHAREDOC"]'))}if(i.length)for(var d=i.length,s=0;s<d;s++){var p=i[s],l=p.href;if(l){var c=l.split("/");if(c.length){var u=c[c.length-1];0<=$.inArray(u,a)&&m.push({docId:u,docEle:p})}}}if(m.length){n=zmComp.getEditor(e).doc,$(n.head).find('style[id="docHOVER_'+e+'"]').length||$(n.head).append(zmComp.docHoverClass(e));for(var f=0;f<m.length;f++){var z={docId:m[f].docId},C=$(m[f].docEle).html();z.docName=C,$(m[f].docEle).closest("table").replaceWith($(zmComp._zdocTxt(e,z)))}}},t.updateOnlineStatus=function(){try{for(var e in r){var t=r[e]||{},o=!$.isEmptyObject(t)&&zmComp.getNetworkStatus(e);if(o)if("save"===o)zmComp.hideMsg(e);else if("sync"===o){var n=zmComp.getSubject(e),i=zmText.applyArgs(s.sending_subject,{SUBJECT:n}),a=s.reconnected;a+=" "+i,zmComp.showMsg(e,"s",a,void 0,"i"),d(e)}else if("syncChanged"===o){var m=s.oneditreconnected;zmComp.showMsg(e,"i",m,void 0,void 0,"resend")}}}catch(e){}},t.updateNetworkStatus=function(e){zmComp.setNetworkStatus(e,"syncChanged");var t=s.oneditreconnected;zmComp.showMsg(e,"i",t,void 0,void 0,"resend")},t.windowSuccessMessage=function(e,t){var o=$.q("#zmComposeWrapper"),n=zmCompTemp.afterMailSentDom(t);$.e(n).insertAfter(o),$.q("#zm_smsg_"+e).remove()},$.extend(!0,e,t)}(window.zmComp);var isSmimeEnabled=function(){try{return"true"===String(zmail.Settings.Apps.SendMailAs.models.isSmimeEnabled)}catch(e){}return!1};!function(e){var Xe=e.getCmpObj(),Qe=zmUtil.composeI18N(),f=function(e,t){var o="";t&&(o=t),"send"===o&&Xe[e]&&zmComp.setStatus(e,!1),"save"===o&&Xe[e]&&(Xe[e].saveReq=!1,Xe[e].savedraft=!1)},W=function(e,t){var o,n,i=e.cmpId,a=e.errType,m=e.type,r=e.resp,d=e.triggerType;if(t&&t.close&&(o=t.close),t.triggerFrom&&(n=t.triggerFrom),Xe[i]&&o&&n&&"close_preview"===n&&zmComp.deleteCmpObj(i,Xe),f(i,d),a&&"serverError"===a&&r){var s="HTML";r.errorCode&&-1!==r.errorCode&&7020!==r.errorCode&&(s="TEXT"),zmComp.showMsg(i,"e",r.error,m,void 0,s)}if(a&&"sendError"===a){var p=Qe.errorinsave;"send"===d&&(p=Qe.errorinsend),r&&r.msg&&(p=r.msg),zmComp.showMsg(i,"e",p,m)}if(a&&"networkError"===a&&!(Xe[i]&&zmComp.getViaType(i))){var l=Qe.onnetworkSave;"send"===d?(l=Qe.onnetworkSend,l+=" "+Qe.reconnecting+" ",zmComp.showMsg(i,"e",l,m,void 0,"retry"),zmComp.setNetworkStatus(i,"sync")):(zmComp.showMsg(i,"e",l,m),zmComp.setNetworkStatus(i,"save"))}if("save"===d&&Xe&&Xe[i]){var c=Qe.save_draft;if(Xe[i].draft_saved_txt){var u=Qe.save_lastmodified;c=zmText.applyArgs(u,{TIME:Xe[i].draft_saved_txt})}zmComp.updDraftText(i,c)}},Ke=function(e,t){var o={cmpId:t.cmpId,resp:e,type:t.type,errType:"sendError",triggerType:t.triggerType};W(o,t)},et=function(e){var t={cmpId:e.cmpId,type:e.type,errType:"networkError",triggerType:e.triggerType};W(t,e)},Z=function(e,t){f(e,t.triggerType)},tt=function(e,t){var o,n=t.cmpId,i=t.act,a=t.mode,m=t.sendImm,r=t.tempact,d=t.type,s=t.mymId,p=t.info;p&&p.msgId&&(s=p.msgId),t.parentMsgId&&(s=t.parentMsgId);var l,c="";if(Xe&&Xe[n]&&(c=zmComp.getFromAddr(n)),Xe&&Xe[n]&&Xe[n].capSave&&e&&e.dmailid&&(l=$.trim(e.dmailid),Xe[n].auto_mailId=l,Xe[n].capSave=!1),e.inlineImageUrls)if(Object.keys(Xe[n].inlinemapObj).length<1)Xe[n].inlinemapObj=e.inlineImageUrls||{};else{var u=Xe[n].inlinemapObj,f=e.inlineImageUrls||{},z=Object.keys(u),C=Object.keys(f),g=[];z.forEach(function(e){g.push(u[e])});var v=[];C.forEach(function(e){v.push(f[e])});for(var h=C.length,I=z.length,_=0;_<h;_++)for(var D=0;D<I;D++){if(g[D]===C[_]){u[z[D]]=v[_];break}D===I-1&&(u[C[_]]=v[_])}}t._dupDraft&&Xe&&Xe[n]&&function(e){if(Xe&&Xe[e]&&Xe[e].auto_mailId){var t=zmComp.getAccId(e),o=Xe[e].auto_mailId;zmCUtil.clearDraft(t,o)}}(n),Z(n,t);var b,S,O,M=!1,y="",T="";if(e.error)b=e,O={cmpId:(S=t).cmpId,resp:b,type:S.type,errType:"serverError",triggerType:S.triggerType},W(O,S);else{zmComp.setModified(n,0),Xe[n].changeData=!1,zmail.userOptions&&1===zmail.userOptions.autoAddContacts&&zmComp.addContacts(n);var w={cmpId:n};if("sdraft"===i||"stemplate"===i){var A=$.trim(e.dmailid);if(A&&zmComp.setOutboxMailId(n,A),e.msgObj&&zmComp.setMetaData(n,e.msgObj),"sdraft"===i&&(o=$.trim(e.msgId),zmComp.setDraftId(n,o),Xe[n].enableDiscard=!0),"sdraft"===i&&t&&t.close)y=_zm.isOfflineSyncActive()?Qe.offline_save_draft+e.dftst:Qe.message_saved+e.dftst,zmComp.showMsg(n,"s",y,d),w.triggerType="close_preview_aftersave",zmComp.comClose(w);else if("sdraft"===i){l=$.trim(e.dmailid),Xe[n].discard_mailId=l,Xe[n].discard_Id=o,l&&(Xe[n].dmailid=l),t.refHeader&&(Xe[n].discard_refHeader=t.refHeader),t.inReplyTo&&(Xe[n].discard_inReplyTo=t.inReplyTo),zmail.folId&&zmComp.setFID(n,zmail.folId.dId),T=Qe.save_lastmodified,y=zmText.applyArgs(T,{TIME:e.dftst}),Xe[n].draft_saved_txt=e.dftst,zmComp.updDraftText(n,y);var E=!1,R=zmComp.getMode(n);if(["outbox","template","eanew","fwdme"].includes(R)&&(E=!0),Xe[n].streamsView&&Xe[n].groupId&&(E=!0),"p"===zmUtil.getComposeType()&&!E){var x=zmComp.getMessageInfo(n,Xe);zmComp.updateShowDraftedAfterNewSave({cmpId:n,msgId:x.msgId,draftId:x.draftId,type:"t"})}if(!zmail.isComposeMail&&zmComp.getCurrentCompId()&&(zmComp.cmpHashURL(n,["drafts",o]),zmComp.cmpRestoreState(n,{mode:"draft",msgId:o})),!_zm.isOfflineSyncActive()){var k=zmComp.isZohoAcc(n);if("t"===zmComp.getType(n)&&zmail.isOrg&&k){var j=!1,U=zmComp.getCommentObj(n),L=Xe[n].loadDraftComment;void 0===babelHelpers.typeof(L)||L||(j=!0),U&&j&&t.viashare?zmComp.setDraftFocus(n):!U&&Xe[n].loadDraftComment?zmComp.draftComments(n,o,"draft_newsave"):U&&U.entityExists?zmComp.enableNotifyAll(n,o,"draft_save"):U||zmComp.enableShare(n,o,"draft_newsave")}}$.publish("/compose/savedraft",{draftId:o,draftOj:t})}else if("stemplate"===i){zmComp.setTemplateId(n,$.trim(e.msgId));var F=$.trim(e.msgId);F&&zmComp.setTempId(n,F),zmail.folId&&zmComp.setFID(n,zmail.folId.teId),y=r?Qe.template_modified:Qe.template_saved,zmComp.showMsg(n,"s",y,d)}}else{w.triggerType="close_view_aftersend";var N="";0<zmComp.getDefault().outIntr&&!m&&(M=!0),e.scheduledTime?(T=Qe.scheduled_time,N=y=zmText.applyArgs(T,{TIME:e.scheduledTime})):M?N=Qe.message_scheduled:!_zm.isOfflineSyncActive()&&0<zmail.userOptions.undoInterval&&(_zm.isZohoSMTPEmail(c)||_zm.isZMAccount(c))?zmRecall.showRecallBand(e.UUID,w):N=Qe.message_sent,_zm.isOfflineSyncActive()&&(N=Qe.offline_save_outbox,M=!0),"d"===zmComp.getType(n)&&(Xe[n].closeQuick=!0),w.msgTxt=N,(M||0<zmail.userOptions.undoInterval&&0!==zmail.userOptions.composeView||!_zm.isZohoSMTPEmail(c)&&!_zm.isZMAccount(c)||zmail.userOptions.undoInterval<0)&&zmComp.comClose(w)}if(t.cloudAttList&&"sdraft"!==i&&zmComp.shareAttachments(t),!e.outbxfail){var q=zmInit;try{window.opener&&window.opener.zmInit&&zmail.isComposeMail&&(q=window.opener.zmInit)}catch(e){}q&&q.outboxErrorObj&&q.outboxErrorObj.errorBandElem.$el&&q.outboxErrorObj.errorBandElem.$el.remove()}var P="";zmail.isComposeMail&&(P="w");var H={action:i,msgId:s,draftId:o,draftDataObj:{msgId:s,draftId:o},draftObj:e.msgObj,schedule:M,mode:a,cmpType:P},B=zmUtil;try{window.opener&&window.opener.zmUtil&&zmail.isComposeMail&&(B=window.opener.zmUtil)}catch(e){}B&&B.postMailActionsOnSend&&B.postMailActionsOnSend(H)}},t={addAttLink:function(e,t){var o,n=zdom("div",{dangerouslySetInnerHTML:t});if(zmComp.getAttRef(e)){var i,a,m=(o=zmComp.getAttRef(e)).getStoreAttachments(!0);m&&(i=m.hugeAttachment,a=m.cloudAttList),i&&i.length&&n.appendChild(o.getHugeLinkHTML()),a&&a.length&&n.appendChild(o.getCloudLinkHTML())}return n.innerHTML},wrapContent:function(e){var t=zmCUtil.getfontFamily(zmail.mailOpt.ff);return"Default"!==t&&(e.style.fontFamily=t),e.style.fontSize=String(zmCUtil.getfontSize())+"pt",e.style.color=zmCUtil.getfontColor(),1===zmail.userOptions.typeOption&&(e.dir="rtl"),e},sendMailContent:function(e){var t=zdom("div",{dangerouslySetInnerHTML:e}),o=t.childNodes.length,n=t.firstChild.nodeName;return(t=1===o&&"DIV"===n?zmComp.wrapContent(t.firstChild):zmComp.wrapContent(t)).outerHTML},setDraftFocus:function(e){var t=zmsuite.getAppObj(e);if(t){var o,n=t.centerObj.$el.find(">.SCmc"),i=zmComp.getCommentObj(e),a=n.find(".zmScCmnt");n.hasClass("zmCShared")?(i.focusComments(),i.highlightComment()):(zmCUtil.clearResizeRepDOM(e),a.find(".SCS_postWra").length&&a.find(".SCS_postWra").addClass("SC_dyn"),n.addClass("zmCShared"),o=zmComponent.loadingBand({container:a[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(e),o&&o(),a.find(".SCS_postWra").length?a.find(".SCS_postWra").removeClass("SC_dyn"):a.appendDOM(i.jqDOM),i.focusComments(),i.highlightComment()},300)),zmComp.tooltipComment(e)}},draftComments:function(l,c,u){zmAppLoader.load("mailCollaboration").then(function(){var r,e=zmCompTemp.getCloseDOM(),d=zmsuite.getAppObj(l).centerObj.$el.find(">.SCmc");d.appendDOM($.e(e));var s=d.find(".zmScCmnt");"draft_newsave"===u&&(zmCUtil.clearResizeRepDOM(l),d.addClass("zmCShared"),r=zmComponent.loadingBand({container:s[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(l)},300));var t=s.find(".ScCmntClose");t.off("click").on("click",function(){d.removeClass("zmCShared"),setTimeout(function(){zmCUtil.transResizeRepDOM(l),s.appendDOM(zmComp.getCommentObj(l).jqDOM)},300),zmComp.tooltipComment(l)}),t.attr("data-tooltip",Qe.hidecomments),zmComp.tooltipComment(l);var p={draftID:c,parentElem:s,context:{composeID:l,draftID:c}};zmUtil.DraftShare.loadComments(p).done(function(e){var t,o=$.e(zmsuite.getCenter(l)[0].getNodes()[0].$el);if("draft_onload"===u)if(e.entityExists){zmComp.showComment(l);var n=o.find("li[data-event='cmp_cmt']").find("span"),i=0;e.count&&(i=e.count);var a=n.find(".StCnt");if(!a.length&&i){var m=zmCompTemp.getSpanDOM({count:i});n.appendDOM($.e(m))}else i&&a.text(i);zmComp.enableNotifyAll(l,c,u)}else{(t=o.find("li[data-event='cmp_share']")).find("span").eq(1).text(Qe.sharedraft),t.attr("data-tooltip",Qe.sharedraft),t.addClass("SC_thm"),t.removeClass("SC_op3 SC_nopntr"),t.length&&(t.off("mousedown").on("mousedown",function(e){e.preventDefault()}),t.off("click").on("click",function(){d.hasClass("zmCShared")?(e.focusComments(),e.highlightComment()):(zmCUtil.clearResizeRepDOM(l),s.find(".SCS_postWra").length&&s.find(".SCS_postWra").addClass("SC_dyn"),d.addClass("zmCShared"),r=zmComponent.loadingBand({container:s[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(l),r&&r(),s.find(".SCS_postWra").length?s.find(".SCS_postWra").removeClass("SC_dyn"):s.appendDOM(e.jqDOM),e.focusComments(),e.highlightComment()},300)),zmComp.tooltipComment(l)}))}"draft_newsave"===u&&(r&&r(),s.appendDOM(e.jqDOM),(t=o.find("li[data-event='cmp_share']")).length&&(t.off("mousedown").on("mousedown",function(e){e.preventDefault()}),t.off("click").on("click",function(){d.hasClass("zmCShared")?(e.focusComments(),e.highlightComment()):(zmCUtil.clearResizeRepDOM(l),s.find(".SCS_postWra").addClass("SC_dyn"),d.addClass("zmCShared"),r=zmComponent.loadingBand({container:s[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(l),r&&r(),s.find(".SCS_postWra").removeClass("SC_dyn"),e.focusComments(),e.highlightComment()},300)),zmComp.tooltipComment(l)})),e.focusComments(),e.highlightComment()),e.parentElem=p.parentElem,Xe[l].loadDraftComment=!1,zmComp.setCommentObj(l,e),zmComp.setCmtDraftId(l,c)}).fail(function(){d.removeClass("zmCShared"),setTimeout(function(){zmCUtil.transResizeRepDOM(l)},300),zmComp.showMsg(l,"i",Qe.unable_load_comments,"t")})})},updateNotifyAll:function(e){var t=zmComp.getCmtDraftId(e.draftId);if(t&&(zmComp.enableNotifyAll(t,e.draftId,"enablevia_notify"),zmComp.isModified(t))){var o={cmpId:t,viashare:!1};o.cmpId=t,o.viashare=!1,zmComp.updateDraft(o)}},updateComment:function(e){var t=zmComp.getCmtDraftId(e.entityId);if(t){var o=$.q(zmsuite.getCenter(t)[0].getNodes()[0].$el).find("li[data-event='cmp_cmt']").find("span"),n=0;if(e.total&&(n=e.total),n)zmComp.showComment(t),zmComp.getCommentObj(t).entityExists=!0;var i=o.find(".StCnt");if(n)if(!i.length&&n){var a=zmCompTemp.getSpanDOM({count:n});o.appendDOM($.e(a))}else n&&i.text(n);else i.remove()}},showComment:function(e){var t;Xe[e]&&(Xe[e].type&&(t=Xe[e].type),t&&"t"===t?(zmComp.getShareEle(e).liObj.addClass("SC_thm"),zmsuite.getCenter(e)[0].getNodes()[0].showGroup("compComment")):$.q("#zmShareM_"+e).removeClass("SC_dyn"))},tooltipComment:function(e){var t=zmsuite.getAppObj(e).centerObj.$el.find(">.SCmc").eq(0),o=$.q(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("li[data-event='cmp_cmt']");t.hasClass("zmCShared")?o.attr("data-tooltip",Qe.hidecomments):o.attr("data-tooltip",Qe.showcomments)},toggleComment:function(e){zmCUtil.clearResizeRepDOM(e);var t=zmComp.getCommentObj(e),o=zmsuite.getAppObj(e).centerObj.$el.find(">.SCmc");if(o.hasClass("zmCShared"))o.removeClass("zmCShared"),setTimeout(function(){zmCUtil.transResizeRepDOM(e)},300);else{var n=o.find(".zmScCmnt");n.find(".SCS_postWra").length&&n.find(".SCS_postWra").addClass("SC_dyn"),o.addClass("zmCShared");var i=zmComponent.loadingBand({container:n[0],type:"pagination"});setTimeout(function(){zmCUtil.transResizeRepDOM(e),i&&i(),n.find(".SCS_postWra").length?n.find(".SCS_postWra").removeClass("SC_dyn"):n.appendDOM(t.jqDOM)},300)}zmComp.tooltipComment(e)},hideComment:function(e){var t;Xe[e]&&(Xe[e].type&&(t=Xe[e].type),t&&"t"===t?zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compComment"):$.q("#zmShareM_"+e).addClass("SC_dyn"))},getShareEle:function(e){var t,o={};if(Xe[e]){var n;if(Xe[e].type&&(n=Xe[e].type),n&&"t"===n)t=$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("li[data-event='cmp_share']"),o.liObj=t,o.txtObj=t.find("span").eq(1);else t=$.q("#zmShareM_"+e).find("li");o.liObj=t,o.txtObj=t.find("span").eq(1)}return o},enableDraftShare:function(t,e){if(zmsuite.getAppObj(t)){var o=zmsuite.getAppObj(t).centerObj.$el.find("li[data-event='cmp_share']");o.length&&(o.removeClass("SC_op3 SC_nopntr"),o.off("click").on("click",function(){if(void 0===Xe[t].loadDraftComment&&(Xe[t].loadDraftComment=!0),zmComp.getCommentObj(t)&&!zmComp.isModified(t))zmComp.setDraftFocus(t);else{var e={cmpId:t,viashare:!0};e.cmpId=t,e.viashare=!0,zmComp.updateDraft(e)}}),o.addClass("SC_thm"),o.attr("data-tooltip",Qe.sharedraft))}},enableShare:function(e,t,o){var n=$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("li[data-event='cmp_share']");n.length&&(n.removeClass("SC_op3 SC_nopntr"),n.off("click").on("click",function(){zmComp.draftComments(e,t,o)}),n.addClass("SC_thm"),n.attr("data-tooltip",Qe.sharedraft))},enableNotifyAll:function(e,t,o){var n=$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el).find("li[data-event='cmp_share']");n.find("span").eq(1).text(Qe.notify_to_all),n.attr("data-tooltip",Qe.notify_to_all),n.addClass("SC_thm"),"draft_onload"===o&&n.removeClass("SC_thm"),n.removeClass("SC_op3 SC_nopntr"),n.off("click").on("click",function(){zmUtil.DraftShare.notifyUpdate({draftID:t}).done(function(){n.removeClass("SC_thm")}).fail(function(){zmComp.showMsg(e,"i",Qe.prob_notify_invitees,"t"),n.addClass("SC_thm")})})},cmpRestoreState:function(e,t){var o=zmTab.getTabObject(e);o&&o.appId&&$.publish("zmail/SaveTabState",[{appId:e,app:"cmp",appObj:{appname:o.appname,appIcon:o.appIcon,data:{cNodes:"2"}},category:"compose_tab",data:t}])},cmpHashURL:function(e,t){var o=zmsuite.getAppRouter(e);o&&(o.setParams(t),o.update())},setElemFocus:function(e){var t=e.find("input");t.length&&t.focus()},storeRecipientsInLocalStorage:function(o,t){var e="localStorage"in window&&null!==window.localStorage&&null!==localStorage.getItem("RecipientInstance"),n={},i=(new Date).getTime();if(e)try{var a=JSON.parse(localStorage.getItem("RecipientInstance"));["to","cc","bcc"].forEach(function(e){var t=zmComp.getRecipientField({field:e,composeID:o});n[e]=t.getRecipientList()}),n.subject=zmComp.getSubject(o),(a[i]=n).mode=t,localStorage.setItem("RecipientInstance",JSON.stringify(a))}catch(e){var m=JSON.parse(localStorage.getItem("RecipientInstance"));m[i]=e,n.mode=t,localStorage.getItem("RecipientInstance",JSON.stringify(m)),window.console.log(e)}},cmpGetAddr:function(e,t){var o={};try{if(Xe[e])if("st"===Xe[e].type)Xe[e].smartData&&Xe[e].smartData.recipients&&(o=Xe[e].smartData.recipients[t]);else{var n=zmComp.getRecipientField({field:t,composeID:e});o.address=n.getRecipientList().join(","),o.count=n.model.getTokenModelList().length,o.error=n.hasErrors(),o.smimeEnabledEmails=n.getEmailList({sMimeEnabled:!0}),o.smimeDisabledEmails=n.getEmailList({sMimeDisabled:!0})}}catch(e){zmComp.debugLog(e)}return o},remindDate:function(t,e){var o=Qe.date_reminder_alert;o=zmText.applyArgs(o,{USER_INPUT:'"'+e+'"',REMINDER:'"'+Qe.reminder+'"'});var n=$.q(zdom("div",null));n.attr("id","zmcmp_reminderdate_"+t),n.appendDOM(o,{clear:!0});var i={cmpId:t};i.$content=n,i.ignoreMouseDown=!1,i.dialogDidMount=function(o){($.q("#zmcmp_reminderdate_"+t)[0].zmcmp_reminderdate_dialog_ele=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},i.defaultNavigator=!1,i.navigator=new zmail.Navigator({onEscape:function(){$.q("#zmcmp_reminderdate_"+t)[0].zmcmp_reminderdate_dialog_ele.remove()}}),i.buttons=[{name:Qe.ok,callback:function(e){zmComp.setDateReminder(t,!1),zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(t),cmpId:t,actVal:"datefalse"}),e.remove()}},{name:Qe.cancel,isCancel:!0,callback:function(e){e.remove()}}],Dialog.new(i)},updReq:Z,sendConf:tt,sendError:Ke,networkError:et,sendMail:function(e){var t,o,n,i,a,m,r,d,s,p,l,c,u,f=["145794"];e&&(t=e.action,o=e.sendIm,n=e.cmpId,i=e.actVal,c=e.triggerFrom,a=e.type,m=e.autosave,r=e.data,d=e.tmpUpdate,s=e.viashare,u=e.reminderElem,p=e.hugeAttWarning,l=e.reconnect),n||(n=zmComp.getCurrentCompId()),a||(a=zmComp.getType(n));var z="compose";"sdraft"===t?z="draft":"stemplate"===t?z="template":Xe[n].mode&&(z=Xe[n].mode),"compose"!==t||"draft"!==z&&"template"!==z||(z="compose");var C="";C="template"===z?"template":"draft"!==z?"send":"save";var g=zmComp.getStatus(n),v=!1;if(g&&"send"===C&&(v=!0),g&&m&&"adraft"===m&&(v=!0),"save"===C&&Xe[n].savedraft&&!Xe[n].dmailid&&(v=!0),!v){var h,I,_,D,b,S,O={accId:Xe[n].accId},M={cmpId:n};if(Xe[n].info&&(M.info=Xe[n].info),Xe[n]._draftParentId&&(M.parentMsgId=Xe[n]._draftParentId),M.type=a,M.viashare=s,M.tmpUpdate=!0,"stemplate"!==e.action||e.tmpUpdate||(M.tmpUpdate=!1),zmComp.getAttRef(n)&&(h=(I=zmComp.getAttRef(n)).getStoreAttachments(!0)),h&&(_=h.myAttachment,D=h.tempLocation,b=h.hugeAttachment,S=h.cloudAttList),"template"===z){if(zmComp.getTempId(n)){if(!d)return void zmComp.tempOverWrite(n);O.tempact=!0,M.tempact=!0}var y=!1;if((S&&S.length||b&&b.length)&&(y=!0),!p&&y)return void zmCDialog.hugeNotAllowTemplate(n)}var T=zmComp.getMymId(n);T&&("eanew"!==zmComp.getMode(n)&&"template"!==C&&(O.mymId=T),M.mymId=T),O.originalMode=z,M.mode=z,M.act=t;var w=zmComp.getInlineMode(n);if(w&&-1!==["reply","replyall","fwdi"].indexOf(w)){var A=zmComp.getModeObj("int",w);A&&(O.fwdInlineMode=A,M.fwdInlineMode=A)}r&&(Xe[n].smartData=r);var E,R,x,k="",j="",U="";if(E=zmComp.cmpGetAddr(n,"to"),R=zmComp.cmpGetAddr(n,"cc"),x=zmComp.cmpGetAddr(n,"bcc"),E.address&&(k=E.address),R.address&&(j=R.address),x.address&&(U=x.address),I){var L=!1,F=!1;if(zmUtil.isHugeAttachmentUploadEnabled()&&"template"!==z&&(F=!0),F&&I.isHugeFileUploadInProgress()&&(L=!0),I.isUploadInProgress()&&(L=!0),zmail.isZMOfflineEnabled&&I.isOfflineFilesUploadInProgress()&&(L=!0),L&&(!m||"adraft"!==m))return void zmComp.showMsg(n,"e",Qe.process_alert,a,"u");var N=h.tempLocation;if(N&&N.error)return void(11===N.errorCode?zmComp.showMsg(n,"e",Qe.attachErr11,a,"u"):12===N.errorCode?zmComp.showMsg(n,"e",Qe.attachErr12,a,"u"):13===N.errorCode&&zmComp.showMsg(n,"e",Qe.attachErr13,a,"u"))}if(Xe[n].imagepending)zmComp.showMsg(n,"e",Qe.imageupload_process,a,"u");else{var q=!0;if("draft"!==z&&"template"!==z&&(q=function(e,t,o,n){var i=Xe[e].type,a="";if(""===t.address&&""===o.address&&""===n.address?a=Qe.please_select_recipients:!0!==t.error&&!0!==o.error&&!0!==n.error||(a=Qe.address_invalid),a){if(zmComp.showMsg(e,"i",a,i),"st"===i){var m=Xe[e].smartData.domLst.toPar,r=$.e(m).find("input").eq(0);zmComp.setElemFocus(r)}else zmComp.focusInputField({field:"to",composeID:e}),zmComp.setFocusOption(e,"to");return!1}return!0}(n,E,R,x)),q&&q){var P=zmComp.getFromAddr(n);zmComp.setFrom(n,P);var H=zmComp.getFromObj(),B="";if(H[P]&&H[P].FRM_DISN&&(B=H[P].FRM_DISN),B&&(zmComp.setSender(n,B),P=(B='"'+B.replace(/(^|[^\\])"/g,'$1\\"')+'"')+" <"+P+">"),O.from=P,O.to=k,O.cc=j,O.bcc=U,M.from=P,M.to=k,M.cc=j,M.bcc=U,isSmimeEnabled()){var W=[];W=(W=(W=W.concat(E.smimeDisabledEmails||[])).concat(R.smimeDisabledEmails||[])).concat(x.smimeDisabledEmails||[]),W=Object.keys(W.reduce(function(e,t){return e[t]=!0,e},{})),O.ignoreList=W}O.bcc&&(M.bcc=O.bcc);var Z="";(Z="st"===a?zmComp.getSubject(n):$.q("#zmsub_"+n).val())&&(Z=$.trim(Z));var G=!1;"draft"!==z&&"template"!==z&&(G=!0),zmComp.setSendImm(n,!1),o&&zmComp.setSendImm(n,!0);var V=Xe[n].subfalse;if(""===Z&&G&&!V)return void zmComp.boxSubject(n);if(f.includes(zmail.zuid)&&!Xe[n].hasOwnProperty("emptyTo")&&(Xe[n].emptyTo=!1),G&&E&&0===E.address.length&&f.includes(zmail.zuid)&&!Xe[n].emptyTo)return void zmComp.emptyToRecipient(n);var J=!1;if(0<zmComp.getDefault().outIntr&&!o&&(J=!0),J&&Z&&251<Z.length)return zmComp.showMsg(n,"e",Qe.lengthy_subject,a),void $.q("#zmsub_"+n).focus();var Y=window.zmWatch,X=!0,Q=!1;!zmUtil.isChildWindow()&&Y&&Y.getAvoidWatch(n)&&(Q=!0);var K,ee=!1;!zmUtil.isChildWindow()&&Y&&Y.getModified(n)&&(ee=!0),Q||ee||!Xe[n].RMOBJ?!zmUtil.isChildWindow()&&Y&&Y.allowWatch(n)&&!Q&&(1!==(K=Y.getWatchType(n))&&2!==K&&3!==K||(O.watchType=K,O.reminderMode=0,O.reminderDesc=Y.getReminderDesc(n),!K||1!==K&&2!==K||(O.reminderType=Y.getReminderType(n),O.reminderMode=Y.getReminderMode(n),O.rDate=Y.getReminderDate(n)+":00")),X=!1):(1!==(K=Xe[n].RMOBJ.WT)&&2!==K&&3!==K||(O.watchType=K,O.reminderMode=0,O.reminderDesc=Xe[n].RMOBJ.RMDSC,1!==K&&2!==K||(Xe[n].RMOBJ.RMM&&void 0!==Xe[n].RMOBJ.RMM&&(O.reminderMode=Xe[n].RMOBJ.RMM),Xe[n].RMOBJ.RMT&&void 0!==Xe[n].RMOBJ.RMT&&(O.reminderType=Xe[n].RMOBJ.RMT),Xe[n].RMOBJ.RMD&&(O.rDate=Xe[n].RMOBJ.RMD))),X=!1);var te,oe,ne=!1;h&&(_=h.myAttachment,D=h.tempLocation,b=h.hugeAttachment,S=h.cloudAttList);var ie=zmComp.getEditor(n),ae=!0;i&&"attfalse"===i&&(ae=!1);var me=zmComp.getDateReminder(n),re=!1;-1!==["compose","reply","replyall","fwdi","fwdme","eanew"].indexOf(z)&&(re=!0);var de=!1;"0"===zmAdHocSettings.getReminderWarningState()&&X&&(de=!0);var se=!0;if(zmUtil.isChildWindow()&&(se=!1),se&&de&&re&&me){var pe=!1;if(te=ie.getContent(),pe="plaintext"===ie.mode?zmMailReminder.isReminderNeedToAdd(te):(oe=zmCUtil.removeNotToParse(te),zmMailReminder.isReminderNeedToAdd(oe))){var le={msgId:n,loadType:"popupalert"};return le.dateScan=pe,le.openWatch="compose_tab",le.elem="st"===a?u:Y.getWatchDom(n),void Y.showWatch(le)}}var ce=zmComp.getFwdMsg(n);ce&&ce.length&&(O.fwdMsgIds=ce);var ue=zmComp.getFwdThrd(n);if(ue&&ue.length&&(O.fwdtId=ue),re&&ae){var fe=!1,ze=_&&_.length,Ce=D&&D.length,ge=b&&b.length,ve=S&&S.length,he=ce&&ce.length,Ie=ue&&ue.length;if((ze||Ce||ge||ve||he||Ie)&&(fe=!0),!fe&&(te=ie.getContent(),ne="plaintext"===ie.mode?zmAttReminder.isFileNeedToAttach(te):(oe=zmCUtil.removeNotToParse(te),zmAttReminder.isFileNeedToAttach(oe))))return void zmComp.remindAtt(n,ne)}if("richtext"===ie.mode&&zmComp.getZDStr(n)&&(O.docId=zmComp.getZDStr(n),O.shareType="private"),"plaintext"===ie.mode&&zmComp.getZDocLink(n).length&&(O.docId=zmComp.getZDocLink(n),O.shareType="private"),"send"===C&&zmComp.getZDStr(n)&&"send_with"===e.zDocShare){var _e=e._sReq;if(_e)for(var De in _e)O[De]=_e[De],M[De]=_e[De]}if(!e.zDocShare&&"send"===C&&zmComp.getZDStr(n))return void zmCDoc.showBox(n,$.extend({},e));O.subject=Z,M.subject=Z;var be=zmComp.getAskReceipt(n);be&&(O.askReceipt=be),O.sendImm=!1,M.sendImm=!1,o&&(O.sendImm=!0,M.sendImm=!0);var Se=zmComp.getZDocObj(n);Se&&!$.isEmptyObject(Se)&&(O.attachname=Se.docName,O.attachpath=Se.docPath,O.attachstorelist=Se.docStore);var Oe=0,Me="",ye=ie.mode;if(te="send"===C?ie.getRawContent():ie.getContent(),"plaintext"!==ye){Oe=2;["draft","template"].includes(z)||-1===te.indexOf("Zm-_Id_-Sgn")||(te=te.replace(/Zm-_Id_-Sgn/gi,""))}if("outbox"!==z&&"plaintext"!==ye){if(["reply","replyall","draft","template"].includes(z)){var Te=$.q(ie.doc.body),we=Te.find("div[name=ZM_SHWTRIM]");we.length&&we.remove();var Ae=Te.find("div.zmail_extra");Ae.length&&Ae.show(),te="send"===C?ie.getRawContent():ie.getContent()}Me=zmComp.sendMailContent(te)}else Me=te;"template"!==z&&"plaintext"!==ye&&(Me=zmComp.addAttLink(n,Me));var $e=zmail.Utils.DOM,Ee=Xe[n].inlinemapObj;if(Ee&&1<=Object.keys(Ee).length){var Re=Object.keys(Ee),xe=Re.length,ke=document.createDocumentFragment();ke.appendChild(zdom("div",null)),$e.__dangerouslySetInnerHTML(ke.firstChild,Me);for(var je=ke.firstChild.getElementsByTagName("img"),Ue=je.length,Le=0;Le<Ue;Le++)for(var Fe=0;Fe<xe;Fe++)if(je[Le].getAttribute("src")===Re[Fe].replace(/&amp;/g,"&")){je[Le].src=Ee[Re[Fe]].replace(/&amp;/g,"&");break}Me=ke.firstChild.innerHTML}"template"===z&&Xe[n].categoryId&&(O.categoryId=Xe[n].categoryId),O.content=Me,M.content=Me,O.smType=Oe,O.charSet=zmComp.getCharSet(n),O.replyTo=zmComp.getReplyTo(n),O.priority=zmComp.getPriority(n);var Ne=window.zmSchedule;if(!zmUtil.isChildWindow()&&Ne){var qe=Ne.getScheduleObject(n);qe&&(O.OT="1",O.SCT=qe.scheduleType,qe.customTime&&""!==qe.customTime&&(O.SCTI=qe.customTime+":00"),qe.customTimezone&&(O.SCTZ=qe.customTimezone));var Pe=Ne.getRecurringObject(n);Pe&&((O=$.extend(O,Pe)).OT="2")}Xe[n].groupId&&(O.groupId=M.groupId=Xe[n].groupId,O.streamsView=M.streamsView=Xe[n].streamsView),zmComp.getShareId(n)&&(O.shId=zmComp.getShareId(n),M.shId=zmComp.getShareId(n));var He=!1;if(zmail.showFeature)Xe[n].groupId&&(He=!0),zmComp.getShareId(n)&&(He=!0);else{He=!0,"eanew"!==zmComp.getMode(n)&&"fwdme"!==zmComp.getMode(n)||(He=!1);var Be=Xe[n].fol_opt&&"tmp"===Xe[n].fol_opt;(Xe[n].newsave||Be)&&(He=!1)}if(He){var We=zmComp.getCmpHeader(n);We.mailId&&(O.mailId=We.mailId,M.mailId=We.mailId),We.inReplyTo&&(O.inReplyTo=We.inReplyTo),We.refHeader&&(O.refHeader=We.refHeader)}if(Xe[n].discard_refHeader&&(O.refHeader=Xe[n].discard_refHeader),Xe[n].discard_inReplyTo&&(O.inReplyTo=Xe[n].discard_inReplyTo),Xe[n].dmailid&&(O.mailId=Xe[n].dmailid,M.mailId=Xe[n].dmailid),"template"===C&&zmComp.getTempId(n)&&(O.mymId=zmComp.getTempId(n),M.tempId=zmComp.getTempId(n)),O.refHeader&&(M.refHeader=O.refHeader),O.inReplyTo&&(M.inReplyTo=O.inReplyTo),_&&_.length&&(O.attEntObj=JSON.stringify(_),I&&I.isStreamView()&&(O.streamsView=!0)),D&&D.length){var Ze=JSON.stringify(D);O.attTmpObj=Ze,M.attTmpObj=Ze}if("template"!==z&&(b&&b.length&&(O.hugeAttList=JSON.stringify(b)),S&&S.length&&(O.cloudAttList=JSON.stringify(S),M.cloudAttList=JSON.stringify(S))),c&&(M.triggerFrom=c),i&&"close"===i)M.close=!0;else{var Ge=Z&&(150<Z.length?Z.substring(0,150):Z)||Qe.nosubject,Ve=zmText.applyArgs(Qe.sending_subject,{SUBJECT:Ge}),Je=!1;"draft"===z?(Ve=Xe[n].newsave?Qe.resaving_draft:Qe.saving_draft,a&&"p"===a&&(Ve=Qe.saving),Je=!0):"template"===z&&(Ve=Qe.saving_temp),Je?zmComp.updDraftText(n,Ve):l||zmComp.showMsg(n,"s",Ve,a,"i")}"save"!==C||O.mailId||(Xe[n].savedraft=!0),"save"===C&&!O.mailId&&m&&"adraft"===m&&(Xe[n].capSave=!0),"send"===C&&Xe[n].saveReq&&Xe[n].capSave&&(M._dupDraft=!0),M.triggerType="send","save"===C&&(M.triggerType="save",Xe[n].saveReq=!0),"send"===C&&(zmComp.setStatus(n,!0),zmComp.setRetry(n,e));if(["draft","template"].includes(O.originalMode)||zmComp.storeRecipientsInLocalStorage(n,O.originalMode),m&&"adraft"===m&&(O.sType="a"),zmComp.setTriggerType(n,C),zmComp.setViaType(n,m),_zm.isOfflineLockAvailable()){var Ye={p:O,ep:M};zmCompAdapter.sendMail(Ye)}else zmAjq.XHR({u:zmail.conPath+"/send.do",t:"POST",fn:tt,p:O,ep:M,csr:"s",onerror:Ke,onnetfailure:et})}}}}};$.extend(!0,e,t)}(window.zmComp),function(e){var p=function(e,t){var o=t.docName,n=t.docId,i=location.protocol+"//"+zmail.urls.docsURL+"/file/"+n;return zdom("table",{id:"zmdoc_share_"+e,className:"dochover",spellCheck:"false",contentEditable:"false","data-avoidContext":"true","data-zmdocname":n,"data-zmdocshare":"true","data-zmdoccmp":e,style:{backgroundColor:"#f5f5f5",border:"#dcdcdc 1px solid",padding:"1px",width:"80%"}},zdom("tr",null,zdom("td",null,zdom("a",{name:"ZM_SHAREDOC","data-hugatt":"hugatt",href:i,target:"_blank",rel:"noopener noreferrer",style:{color:"#004B91",textDecoration:"none",cursor:"pointer"}},o)),zdom("td",{style:{width:"10px"}},zdom("div",{name:"ZM_SHAREDOC","data-hugatt":"hugatt",style:{visibility:"hidden",fontSize:"14px",cursor:"pointer",color:"#4A4A4A"}},"x")))).outerHTML},l=function(e){return".dochover:hover div{visibility:visible !important } ",".dochover a:hover {text-decoration:underline!important;}",zdom("style",{id:"docHOVER_ "+e},".dochover {border:1px solid red} .dochover:hover div{visibility:visible !important } .dochover a:hover {text-decoration:underline!important;}")},c=function(){return zdom("div",null,zdom("br",null))},t={insertDocsLink:function(e){var t=e.eprm;"link"===e.loadType&&function(e,t){var o=t.cmpId,n=[],i=e.zohodocs;for(var a in i){var m=i[a];if(m.docId&&-1===$.inArray(m.docId,zmComp.getZDArr(o))){var r={docId:m.docId,docName:m.docName,docType:m.docType};n.push(c().outerHTML),n.push(p(o,r))}}if(n.join("")){n.push(c().outerHTML);var d=zmComp.getEditor(o),s=d.doc;$.e(s.head).find('style[id="docHOVER_'+o+'"]').length||$.e(s.head).appendDOM($.e(l(o)),{clear:!0}),d.insertHTML(n.join(""),!0)}}($.parseJSON(e.docObj),t)},clearZDoc:function(e,t,o){!function(e,t){var o=zmComp.getZDObj(e);for(var n in o)if(o[n].docId===t){o.splice(n,1);break}}(t,o);var n=$.e(e).parents("table").prev(),i=n.get(0);"DIV"===i.nodeName&&1===i.childNodes.length&&"BR"===i.childNodes[0].nodeName&&n.remove(),$.e(e).closest("table").remove()},getZDArr:function(e){var t=[],o=zmComp.getZDObj(e);for(var n in o)t.push(o[n].docId);return t},getZDStr:function(e){var t="",o=zmComp.getZDObj(e);for(var n in o)""!==t&&(t+=","),t+=o[n].docId;return t},getZDObj:function(e){var t=zmComp.getEditor(e).doc,o=[],n=$.e(t).find('a[name="ZM_SHAREDOC"]');if(n.length)for(var i=n.length,a=0;a<i;a++){var m=n[a];if(!$.e(m).closest(".zmail_extra").length){var r=m.href;if(r){var d=r.split("/");if(d.length){var s=d[d.length-1];s===$.e(m).closest("table").attr("data-zmdocname")&&o.push({docId:s})}}}}return o},docHoverClass:l,_zdocTxt:p};$.extend(!0,e,t)}(window.zmComp=window.zmComp||{}),function(e){var d=zmUtil.composeI18N(),s=function(e,t){var o=e.SENDER||"",n=e.FROM||"",i=!1;return""!==o&&o!==n&&(i=!0),zdom("fragment",null,t?d.from+": ":" ",t&&(i?o:"")+" <"+n+">",!t&&zdom("b",null,(i?o:"")+" <"+n+">"))},p={margin:"0"},l={borderLeft:"1px solid #cccccc",paddingLeft:"6px",margin:"0 0 0 5px"},v={display:"inline-block",width:"98.0%"},c={display:"none"},h=function(e,t,o){var n=e.SENTTIME||"",i=e.SENDER||"",a=e.FROM||"";i&&(i=_zm.escapeTags(i));var m=zmail.showFeature?p:l;return zdom("div",{className:"zmail_extra",style:t?c:"","data-zbluepencil-ignore":"true"},zdom("br",null),zdom("div",{id:"Zm-_Id_-Sgn1"}," ---- "+d.on+" "+n,""!==i||""!==a?s(e):""," "+d.wrote+" ----"),zdom("br",null),zdom("blockquote",{style:m,dangerouslySetInnerHTML:o}))},u=function(){var e="============ "+d.forwardedmessage+" ============";return zdom("fragment",null,e,zdom("br",null))},f=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(""!==t)return zdom("fragment",null,e+": "+t,zdom("br",null))},I=function(e,t,o){var n=e.SENTTIME||"",i=e.TO||"",a=e.CC||"",m=e.SUBJECT||"",r=zmail.showFeature?p:l;return zdom("div",{className:"zmail_extra",style:t?c:"","data-zbluepencil-ignore":"true"},zdom("br",null),zdom("div",{id:"Zm-_Id_-Sgn1"},u(),function(e){var t=e.SENDER||"",o=e.FROM||"";if(t&&(t=_zm.escapeTags(t)),""!==t||""!==o)return[s(e,!0),zdom("br",{key:"lineSpacing"})]}(e),f(d.to,zmUtil.replaceHTMLEntities(i)),f(d.cc,zmUtil.replaceHTMLEntities(a)),f(d.date,n),f(d.subject,zmUtil.replaceHTMLEntities(m)),u()),zdom("br",null),zdom("blockquote",{style:r,dangerouslySetInnerHTML:o}))},t={backgroundImage:"url("+zmResource.get("image","compose/ellipse.png")+")",backgroundPosition:"0 0",backgroundSize:"22px auto",backgroundRepeat:"no-repeat",cursor:"pointer",height:"10px",verticalAlign:"middle",width:"22px"},_=function(){return zdom("fragment",null,zdom("div",{name:"ZM_SHWTRIM",title:"Show trimmed content",contentEditable:"false",style:t}))},D=function(e){return zdom("fragment",null,zdom("br",null),zdom("br",null),zdom("div",{id:"Zm-_Id_-Sgn","data-zbluepencil-ignore":"true",dangerouslySetInnerHTML:e}),zdom("br",null))},b=function(e){return zdom("fragment",null,zdom("br",null),zdom("div",{id:"Zm-_Id_-Sgn","data-zbluepencil-ignore":"true",dangerouslySetInnerHTML:e}),zdom("br",null),zdom("br",null))},S=function(e){var t;return zmComp.allowSignature(e)&&(t=zmComp.signContentObj(e)),t},i=function(e,t,o){o||(o=zmComp.getMode(e));var n=zmComp.getType(e),i=["reply","replyall"],a=!1,m=!1;"fwdi"===o?m=!0:-1!==i.indexOf(o)&&(a=!0);var r,d=zmComp.getInfo(e);a&&d&&d.predata&&d.predata.CONTENT&&(r=d.predata.CONTENT);var s=!1,p=!1;"p"!==n||ZMStore.isOffline()||(p=!0),p&&-1!==i.indexOf(o)&&(s=!0),_zm.is_ie&&(s=!1);var l=zmComp.getFullContent(t),c=l||"",u=S(e),f=!1,z="";u&&(f=u._signOpt,z=u._signTxt?u._signTxt:"");var C,g="",v="";return z?f?g=D(z):(g=zdom("fragment",null,zdom("br",null),zdom("br",null)),v=b(z)):g=zdom("fragment",null,zdom("br",null),zdom("br",null)),zdom("div",null,r&&(C=r,zdom("fragment",null,zdom("br",null),zdom("br",null),zdom("div",{dangerouslySetInnerHTML:C}))),g,s&&_(),a&&h(t,s,c),m&&I(t,s,c),v).innerHTML},o={composeContent:function(e,t,o){var n=["fwdi","reply","replyall"];return-1!==["draft","template","outbox","eanew"].indexOf(t)?zmComp.getFullContent(o):zmail.showFeature&&-1!==n.indexOf(t)?function(e,t){var o=zmComp.getMode(e),n=zmComp.getType(e),i=["reply","replyall"],a=!1,m=!1;"fwdi"===o?m=!0:-1!==i.indexOf(o)&&(a=!0);var r=!1,d=!1;"p"!==n||ZMStore.isOffline()||(d=!0),d&&-1!==i.indexOf(o)&&(r=!0),_zm.is_ie&&(r=!1);var s=zmComp.getFullContent(t),p=s||"",l=S(e),c=!1,u="";l&&(c=l._signOpt,u=l._signTxt?l._signTxt:"");var f="",z="";u?c?f=D(u):(f=zdom("fragment",null,zdom("br",null),zdom("br",null)),z=b(u)):f=zdom("fragment",null,zdom("br",null),zdom("br",null));var C=zdom("hr",{style:v}),g=zdom("div",{id:"_jsCustom_"+Date.now()+"_prevContent"},C,a&&h(t,r,p),m&&I(t,r,p));return zdom("div",null,f,r&&_(),g,z).innerHTML}(e,o):-1!==n.indexOf(t)?i(e,o,t):function(e,t){var o=zmComp.getFullContent(t),n=o||"",i=S(e),a="";i&&(a=i._signTxt?i._signTxt:"");var m=zdom("div",{dangerouslySetInnerHTML:n});return a&&m.appendChild(b(a)),m.innerHTML}(e,o)}};$.extend(!0,e,o)}(window.zmCompContent=window.zmCompContent||{}),window.zmCompOpt=function(){var w=zmUtil.composeI18N();return{_send:function(){var e={cls:"SCtxt SCBtn",divclass:"SC_hd",optclass:"msi-send"};return e.txt=w.send,e.arrow=!0,e},_discard:function(){var e={cls:"SC_lbr",divclass:"SC_hd",optclass:"msi-trash",arrow_hide:!0,txt_hide:!0};return e},_more:function(){var e={cls:"SC_lbr",optclass:"msi-action",arrow_hide:!0,txt_hide:!0};return e},_save:function(){var e={cls:"SCtxt SC_op3 SC_nopntr",divclass:"SC_hd",opt_hide:!0};return e.txt=w.save_draft,e.arrow=!0,e},_priority:function(){var e={cls:"SC_lbr",optclass:"msi-priority",divclass:"SC_hd",arrow_hide:!0,txt_hide:!0};return e},_share:function(){var e={cls:"SC_lbr SCtxt",divclass:"SC_hd",txt:"Share",arrow_hide:!0};return e},_schedule:function(){var e={cls:"SC_lbr",divclass:"SC_hd",optclass:"msi-schdRecur",arrow_hide:!0,txt_hide:!0};return e},_watch:function(){var e={cls:"SC_lbr",divclass:"SC_hd",optclass:"msi-reminder",arrow_hide:!0,txt_hide:!0};return e},_moveTab:function(){var e={cls:"SC_lbr",optclass:"msi-popout",divclass:"SC_hd",arrow_hide:!0,txt_hide:!0};return e},_minimizeTab:function(){var e={cls:"SC_lbr",optclass:"msi-minus",divclass:"SC_hd",arrow_hide:!0,txt_hide:!0};return e},_close:function(){var e={cls:"SC_lbr",optclass:"msi-close",divclass:"SC_hd",arrow_hide:!0,txt_hide:!0};return e},headerDOM:function(e){var t,i=e.cmpId,a=e.type,o=e.msgId,n=zdom("div",{className:"SCmb",id:"SCmb_ "+i},zdom("div",{className:"SC_frt"}),zdom("div",null)),m=zmCompOpt.optDOM(zmCompOpt._send()),r=zmCompOpt.optDOM(zmCompOpt._discard()),d=zmCompOpt.optDOM(zmCompOpt._more()),s=zmCompOpt.optDOM(zmCompOpt._save()),p=zmCompOpt.optDOM(zmCompOpt._priority()),l=zmCompOpt.optDOM(zmCompOpt._share()),c=zmCompOpt.optDOM(zmCompOpt._schedule()),u=zmCompOpt.optDOM(zmCompOpt._watch()),f=zmCompOpt.optDOM(zmCompOpt._moveTab()),z=zmCompOpt.optDOM(zmCompOpt._close()),C=$.e(n),g=$.e(C[0].childNodes[0]),v=$.e(C[0].childNodes[1]),h=$.e(m);zmComp.getDefault().outIntr<0&&h.find("i.msi-barrow").addClass("SC_dyn"),h.attr("id","zmSendM_"+i),h.attr("data-tooltip",w.send),h.off("click").on("click",function(e){(t={action:"compose",sendIm:!1}).cmpId=i,t.type=a,t.id="zm_SndLst",zmCDrop.showDropDown(e,t)});var I=$.e(r);I.attr("id","zmDiscardM_"+i),I.attr("data-tooltip",w.discard_draft),I.off("click").on("click",function(){zmComp.discardCmp({cmpId:i})});var _=$.e(d);_.attr("id","zmMoveM_"+i),_.attr("data-tooltip",w.options),_.off("click").on("click",function(){zmCDrop.show({id:"zm_compactLst",par:_.find(" > li").eq(0),cmpId:i})});var D=$.e(s);a&&"p"===a&&D.find("i.msi-barrow").addClass("SC_dyn"),D.attr("id","zmSaveM_"+i),D.attr("data-tooltip",w.save_as_draft),D.off("click").on("click",function(e){var t,o,n;e&&(o=(t=e.target||e.srcElement).nodeName,n=t.className),o&&"I"===o&&n&&"msi-barrow"===n?(zmCDrop.show({id:"zm_SveLst",par:$.e(t).closest("li"),cmpId:i}),zmUtil.stopEvents(e)):zmComp.sendMail({cmpId:i,action:"sdraft",type:a,sendIm:!1})});var b=$.e(p);b.attr("id","zmPriorityM_"+i),b.attr("data-tooltip",w.priority),b.off("click").on("click",function(e){zmCDrop.show({cmpId:i,par:b.find(" > li").eq(0),id:"zm_priLst"}),zmUtil.stopEvents(e)});var S=$.e(l);S.attr("id","zmShareM_"+i),S.attr("data-tooltip","Share draft");var O=$.e(c);O.attr("id","zmScheduleM_"+i),O.attr("data-tooltip",w.schedule+" / "+w.recurring),O.off("click").on("click",function(){(t={}).id=i,t.ele=this,t.component="compose",t.type=1,zmSchedule.initScRec(t)});var M=$.e(u);M.attr("id","zmWatchM_"+i),M.attr("data-tooltip",zmText.get("zmreminder").watch.remind),M.off("click").on("click",function(){(t={}).msgId=i,t.loadType="popup",t.openWatch="compose_tab",t.elem=$.e(this).find("li"),zmWatch.showWatch(t)});var y=$.e(f);y.attr("id","zmMoveTabM_"+i),y.attr("data-tooltip","Move to Tab"),y.off("click").on("click",function(){zmComp.moveTab(e)});var T=$.e(z);return T.attr("id","zmCloseM_"+i),T.attr("data-tooltip",w.close),T.off("click").on("click",function(){var e={cmpId:i,type:a,msgId:o};zmComp.comClose(e)}),a&&"w"===a?(v.appendDOM(h),v.appendDOM(O),v.appendDOM(M),v.appendDOM(b),b.addClass("SC_dyn"),v.appendDOM(_),g.appendDOM(D),g.appendDOM(S),S.addClass("SC_dyn"),g.appendDOM(I),g.appendDOM(T)):a&&"p"===a?(v.appendDOM(h),zmUtil.isChildWindow()||(v.appendDOM(O),v.appendDOM(M),v.appendDOM(b),b.addClass("SC_dyn"),v.appendDOM(_)),g.appendDOM(D),zmUtil.isChildWindow()||g.appendDOM(y),g.appendDOM(I),g.appendDOM(T)):a&&"d"===a&&(v.appendDOM(h),v.appendDOM(O),v.appendDOM(M),v.appendDOM(b),b.addClass("SC_dyn"),v.appendDOM(_),g.appendDOM(D),g.appendDOM(S),S.addClass("SC_dyn"),g.appendDOM(I),g.appendDOM(T)),C[0]},fromDOM:function(e){var t=e.cmpId,o=$.q(zdom("div",null));o.attr("class","zmCTxt");var n=$.q(zdom("font",null));n.text(w.from);var i=$.q(zdom("span",null));i.attr("id","zm_fSel_"+t),i.off("click").on("click",function(){zmCUtil.showFromAddr(this)});var a=$.q(zdom("div",null));a.attr("class","SC_cs SC_np");var m=$.q(zdom("span",null));m.attr("id","zm_fromaddr_"+t);var r=zmComp.getFromDispN(zmail.fromAddr);m.text(r);var d=$.q(zdom("i",null));d.attr("class","msi-barrow"),a.appendDOM(m),a.appendDOM(d);var s=$.q(zdom("i",null));s.attr("id","zm_fSelShield_"+t),s.attr("class","msi-secured zmDGreenClr zmDoubleIcon SC_dyn"),zmComp.getShield(zmail.fromAddr).then(function(){s.removeClass("SC_dyn")},function(){s.addClass("SC_dyn")}),i.appendDOM(s),i.appendDOM(a);var p=$.q(zdom("div",null));p.attr("id","zm_repSel_"+t),p.attr("class","SC_frt SC_dyn");var l=$.q(zdom("font",null));l.text(w.replyto);var c=$.q(zdom("span",null)),u=$.q(zdom("div",null));u.attr("class","SC_cs SC_np");var f=$.q(zdom("span",null));f.attr("id","zm_replyto_addr_"+t),"st"!==e.type&&zmComp.getReplyTo(t)&&(p.removeClass("SC_dyn"),f.text(zmComp.getReplyTo(t)));var z=$.q(zdom("i",null));return z.attr("class","msi-barrow"),u.appendDOM(f),u.appendDOM(z),c.appendDOM(u),p.appendDOM(l),p.appendDOM(c),o.appendDOM(n),o.appendDOM(i),o.appendDOM(p),o},_suggestionDOM:function(t){var e=$.q(zdom("div",null));e.css("display","none");var o=$.q(zdom("div",null));o.attr("class","zmListInfoBox"),o.attr("id","zmsuglist_"+t);var n=$.q(zdom("font",null));n.text(w.add),n.attr("id","zmsugflist_"+t);var i=$.q(zdom("i",null));i.attr("class","msi-help"),n.appendDOM(i);var a=$.q(zdom("span",null));a.attr("class","zmListInfoRBlk");var m=$.q(zdom("span",null));m.text(w.addall),m.attr("id","zmsugfrlist_"+t),m.attr("class","SC_lnk"),m.off("mousedown").on("mousedown",function(e){zmCUtil.insertAllSugContacts(t),zmTooltip.remove(),zmCUtil.removeSugList(t),_zm.stopEvents(e)});var r=$.q(zdom("i",null));r.attr("class","msi-close"),r.off("mousedown").on("mousedown",function(e){zmComp.setShowSuggestions(t,!1),zmTooltip.remove(),zmCUtil.removeSugList(t),_zm.stopEvents(e)}),a.appendDOM(m),a.appendDOM(r);var d=$.q(zdom("span",null));d.attr("class","loading_dots"),d.attr("id","zmsugloading_dots_"+t);var s=$.q(zdom("span",null)),p=$.q(zdom("span",null)),l=$.q(zdom("span",null));d.appendDOM(s),d.appendDOM(p),d.appendDOM(l);var c=$.q(zdom("span",null));c.attr("class","zmRedClr zmHideD");var u=$.q(zdom("span",null));return u.attr("id","zmsugcontactslist_"+t),o.appendDOM(n),o.appendDOM(u),o.appendDOM(d),o.appendDOM(c),o.appendDOM(a),e.appendDOM(o),e},subDOM:function(e){var t=e.cmpId,o=e.type,n=$.q(zdom("div",null));n.attr("class","zmCTxt"),n.addClass("subject-field"),n.css({cursor:"text"}),n.on("click",function(e){n.find("input").focus(),e.stopPropagation()});var i=$.q(zdom("input",null));return i.attr("type","text"),i.attr("id","zmsub_"+t),i.attr("maxlength","1000"),i.attr("placeholder",w.subject),i.css({width:"100%",display:"table-cell",boxSizing:"border-box",overflow:"hidden"}),o&&"p"!==o&&i.attr("data-enableshortcuts",!0),n.appendDOM(i),n},recipientDOM:function(e){var t=e.cmpId,o=zdom("div",null,zdom("div",null,zdom("div",null),zdom("div",null))),n=$.e(o)[0],i=n.childNodes[0],a=i.childNodes[1],m=$.e(n);m.attr("id","zmdArea_"+t),m.attr("class","zmCR"),$.e(i).attr("class","zmCmd");var r=$.e(a);r.attr("id","zmrep_"+t);var d=$.q(zdom("div",null));return d.attr("id","zmrepall_"+t),d.appendDOM(zmCompOpt.fromDOM(e)),d.addClass("recipient-fields"),d.appendDOM(zmCompOpt.subDOM(e)),r.appendDOM(d),m[0]},dragDOM:function(e){var t=e.cmpId;return zdom("div",{id:"zmDrag_"+t,className:"SC_drag SC_thmDrag SC_dyn"},zdom("span",null,"Drop message here to attach"))},showDrag:function(e,t){var o=$.q("#zmDrag_"+e);$.e(o).children().text(t),o.removeClass("SC_dyn")},hideDrag:function(e){$.q("#zmDrag_"+e).addClass("SC_dyn")},editorDOM:function(e){var t=e.cmpId;return zdom("div",{id:"zmEdi_"+t,className:"zmCE"})},attLstDOM:function(e){var t=e.cmpId,o="zmAttCntTxt_"+t,n="zmAttLst_"+t,i="zmAttLstPar_"+t;return zdom("div",{id:"zmAtt_"+t,className:"zmCA zmCompAttWrap zmCompShwAtt zmHideD"},zdom("div",{id:"zmAttCntHeader_"+t,className:"zmCompAttTCount"},zdom("div",{className:"zmCompAttTCountTxt"},zdom("b",null,zdom("i",{className:"msi-attachment zmThmClr"}),zdom("font",{id:o}))),zdom("div",{className:"zmCompAttTCountIcon"},zdom("ul",{className:"zmAMG"},zdom("li",{className:"zmAMItem"},zdom("div",{className:"zmAMWra"},zdom("i",{className:"msi-tarrowD zmThmClr zmAMIcon"})))))),zdom("div",{id:i,className:"zmPAttGrp"},zdom("div",{id:n,className:"zmCAttGrp"})))},attDOM:function(e){var t=e.cmpId;return zdom("div",{id:"zmAtt_"+t,className:"zmCA SC_dyn"},zdom("div",{id:"zmAttLst_"+t,className:"zmCAt",style:{height:"50px"}}))},optDOM:function(e){var t=zdom("span",null,zdom("i",null),zdom("span",null),zdom("i",{className:"msi-barrow"})),o=zdom("ul",null,zdom("li",null,zdom("b",null,zdom("div",null),t))),n=$.e(o)[0],i=n.childNodes[0],a=i.childNodes[0].childNodes[0],m=i.childNodes[0].childNodes[1],r=m.childNodes[0],d=m.childNodes[1],s=m.childNodes[2];return(e=e||{}).cls=e.cls||"",e.divclass=e.divclass||"SC_hd",e.ret=e.ret||"string",e.evt&&$.e(i).attr("data-event",e.evt),e.title&&$.e(i).attr("title",e.title),$.e(i).attr("class",e.cls),$.e(a).attr("class",e.divclass),$.e(r).attr("class",e.optclass),$.e(d).text(e.txt),e.opt_hide&&$.e(r).remove(),e.arrow_hide&&$.e(s).remove(),e.txt_hide&&$.e(d).remove(),e.sc_hd_hide&&$.e(a).remove(),n},attSecDOM:function(e){return zmUtil.isAttachmentSectionEnabled()?zmCompOpt.attLstDOM(e):zmCompOpt.attDOM(e)}}}(),window.zmCDrop=function(){var _=zmText.get("dropMenus"),u=zmUtil.composeI18N(),D=function(e){for(var t=zmComp.getCharSet(e),o=zmComp.getEncodeList(),n=o.length,i=[],a={},m=0;m<n;m++){var r=o[m];r=r===t?zdom("fragment",null,zdom("i",{className:"msi-none msi-tick"}),r):zdom("fragment",null,zdom("i",{className:"msi-none"}),r),i.push({dom:r,data:{chrset:o[m],cmpId:e}})}return a.list=i,a.divId="zm_EncLst",a.clk=function(e){var t,o;o=(t=e).cmpId,zmComp.setCharSet(o,t.chrset),zmComp.setModified(o,1),zmUtil.hideMenu()},a},b=function(e){var t=e.cmpId,o=e.pTy,n="Medium",i=zmComp.getPriorityDom(t),a=i.elem;"l"===o?(n="Low",a.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_blue")):"h"===o?(n="High",a.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_red")):a.find("i.msi-priority").removeClass("SC_red SC_blue"),"d"===i.appTy?$.q("#zmPriorityM_"+t).removeClass("SC_dyn"):"st"===i.appTy?a.removeClass("SC_dyn"):"t"===i.appTy&&zmsuite.getCenter(t)[0].getNodes()[0].showGroup("compPriority"),zmComp.setPriority(t,n),zmComp.setModified(t,1)},o=function(e,t){var o=zmail.Utils.DOM,n=zmComp.getSignObj(),i=zmComp.getEditor(e),a=$.e(i.doc.body);if(a.find("#Zm-_Id_-Sgn").remove(),t&&""!==t&&"null"!==t){var m=n[t].SIG_CONT,r=n[t].SIG_POS;if("plaintext"===i.mode)i.insertHTML(m);else{if(0===r)a.appendDOM(zdom("div",{id:"Zm-_Id_-Sgn","data-zbluepencil-ignore":"true"}));else{var d=a.find("[name='ZM_SHWTRIM']");d.length||(d=a.find(".zmail_extra")),d.length?$.e(zdom("div",{id:"Zm-_Id_-Sgn","data-zbluepencil-ignore":"true"})).insertDOMBefore(d):a.appendDOM(zdom("div",{id:"Zm-_Id_-Sgn","data-zbluepencil-ignore":"true"}))}var s=a.find("#Zm-_Id_-Sgn");s.clearHTML(),o.__dangerouslySetInnerHTML(s,m)}i.saveCurrentState()}},S=function(o){var e=function(e){var t=$.e(e.target).closest("div").attr("data-sid");zmCDrop.signInsert(o.cmpId,t)},t=o.cmpId,n=zmComp.getSignObj(),i=!0;n&&!$.isEmptyObject(n)&&(i=!1),0===$.q("#zm_insSign").length&&$.q("body").appendDOM(zdom("div",{id:"zm_insSign"}));var a={title:u.insert_signature,style:{width:"576px",left:"400px"},mask:!0,drag:!1,hide:!1};zmsDialog.create("zm_insSign",a);var m,r,d=zdom("li",null);if(i)r=zdom("li",null,u.no_signature),$.e(d).appendDOM(r);else for(var s in $.q("#zm_insSign").clearHTML(),m=zdom("div",{title:u.remove_signature,"data-sid":null,onClick:e},zdom("h3",null,u.remove_signature),zdom("div",{className:"zmSigCont","data-sid":null},zdom("span",null,u.none))),n){if(n[s].SIG_IMG){var p=n[s].SIG_TIT;r=zdom("div",{title:p,"data-sid":s,onClick:e},zdom("h3",{placeholder:u.notitle},p),zdom("div",{className:"zmSigCont","data-sid":s},zdom("img",{src:zmail.conPath+"/SignatureImage?signatureId="+s})))}else{var l=n[s].SIG_TIT;r=zdom("div",{title:l,"data-sid":s,onClick:e},zdom("h3",{placeholder:u.notitle},l),zdom("div",{className:"zmSigCont","data-sid":s},zdom("span",null,n[s].SIG_TIT)))}$.e(d).appendDOM(r)}var c=zdom("ul",{"data-cmpId":t,ref:"container",className:"SC_isig"});m&&$.e(d).appendDOM(m),$.e(c).appendDOM(d),$.q("#zm_insSign").appendDOM(c,{clear:!0})},a=function(e,t){e=e.mdata;var o=t.cmpId;zmComp.setModified(o,1);var n=e.SUBJECT||"",i=e.CONTENT;if(""===$.trim($.q("#zmsub_"+o).val())&&$.q("#zmsub_"+o).val(n),i&&""!==$.trim(i)){var a=zmComp.getEditor(o);a.doc.getElementById("Zm-_Id_-Sgn")&&(i=i.replace(/Zm-_Id_-Sgn/gi,"")),a.insertHTML(i)}t.categoryId&&(zmComp.getCmpObj()[o].categoryId=t.categoryId);e&&e.EXTIMG&&zmCUtil.loadExtImages(o,e.EXTIMG),e.NEWATT&&zmComp.insertAttachment(o,e);try{$.q("#zmcmp_temp_"+o)[0].zmcmp_confirm_dialog_ele.remove()}catch(e){zmComp.debugLog(e)}};return{consDropDown:function(e){new zmDropDownMenu(e).paint()},showDropDown:function(e,t){var o,n,i;if(e&&(n=(o=e.target||e.srcElement).nodeName,i=o.className),n&&"I"===n&&i&&"msi-barrow"===i){var a=$.e(o).closest("li");t.par=a,zmCDrop.show(t),zmUtil.stopEvents(e)}else zmComp.sendMail(t)},moreDropOptions:function(e){var t,o,n=e.cmpId,i="",a="",m="",r="",d="msi-rarrow";"st"===zmComp.getType(n)&&(d="msi-larrow"),t="msi-tick",o=zmComp.getPriority(n);var s=zmComp.getAskReceipt(n);"yes"===s&&(r=t),"High"===o?i=t:"Low"===o?m=t:a=t;var p={dom:zdom("b",null,_.priority," : "),nohover:"nohr"},l={dom:zdom("fragment",null,zdom("i",{className:"msi-none "+i}),_.high),data:{action:"h",cmpId:n}},c={dom:zdom("fragment",null,zdom("i",{className:"msi-none "+a}),_.medium),data:{action:"m",cmpId:n}},u={dom:zdom("fragment",null,zdom("i",{className:"msi-none "+m}),_.low),data:{action:"l",cmpId:n}},f={sep:!0},z={dom:zdom("b",null,_.insert," : "),nohover:"nohr"},C={txt:_.template,data:{action:"insTemplate",cmpId:n}},g={txt:_.signature,data:{action:"sig",cmpId:n}},v={dom:zdom("fragment",null,_.encoding,zdom("i",{className:d})),childCls:"SC_tin",child:function(){return D(n)}},h={data:{cmpId:n,actVal:s,action:"askReceipt"}};""===r?h.txt=_.askreceipt:h.dom=zdom("fragment",null,zdom("i",{className:r}),_.askreceipt);var I=[];return I.push(p),I.push(l),I.push(c),I.push(u),I.push(f),I.push(z),I.push(C),!_zm.isOfflineSyncActive()&&zmail.Signature&&zmail.Signature.initialize().done(function(){if(0<zmail.Signature.adminAddedAcc.length){var t=zmComp.getFromAddr(n);zmail.Signature.adminAddedAcc.forEach(function(e){e===t&&(g.className="SC_op3 SC_nopntr")})}}).fail(function(){}),I.push(g),I.push(f),I.push(v),I.push(h),{list:I,clk:function(e){if(void 0===e)return!1;var t,o,n,i,a=e.action,m={cmpId:e.cmpId},r=e.actVal;switch(a){case"sdraft":m.action="sdraft",zmComp.sendMail(m),zmUtil.hideMenu();break;case"stemplate":m.action="stemplate",zmComp.sendMail(m),zmUtil.hideMenu();break;case"insTemplate":zmail.folId&&(m.tmpInsert=zmCDrop.tmpInsert,m.insertCRMTemplate=zmCDrop.insertCRMTemplate,m.showCrmTemplates=!0,zmAppLoader.load("TemplateCategory").done(function(){ZMail.Template.init({start:1,end:21},"all",m)})),zmUtil.hideMenu();break;case"sig":S(m),zmUtil.hideMenu();break;case"h":m.pTy="h",b(m),zmUtil.hideMenu();break;case"m":m.pTy="m",b(m),zmUtil.hideMenu();break;case"l":m.pTy="l",b(m),zmUtil.hideMenu();break;case"draftprint":i=m,zmComp.debugLog(i),zmUtil.hideMenu();break;case"askReceipt":m.askVal=r,o=(t=m).cmpId,n="yes"===(n=t.askVal)?"no":"yes",zmComp.setAskReceipt(o,n),zmComp.setModified(o,1),zmUtil.hideMenu()}}}},priorityOptions:function(e){var t,o,n=e.cmpId,i="",a="",m="",r={};return t="msi-tick","High"===(o=zmComp.getPriority(n))?i=t:"Low"===o?m=t:a=t,r.list=[{dom:zdom("fragment",null,zdom("i",{className:"msi-none "+i}),_.high),data:{action:"h",cmpId:n}},{dom:zdom("fragment",null,zdom("i",{className:"msi-none "+a}),_.medium),data:{action:"m",cmpId:n}},{dom:zdom("fragment",null,zdom("i",{className:"msi-none "+m}),_.low),data:{action:"l",cmpId:n}}],r.clk=function(e){var t=e.action,o={cmpId:e.cmpId,pTy:t};b(o),zmUtil.hideMenu()},r},tmpInsert:function(e,t,o){var n={accId:zmail.accId,msgId:e,split:!1},i={msgId:e,cmpId:t};o&&(i.categoryId=o),zmail.folId&&(n.folId=zmail.folId.teId,i.folId=zmail.folId.teId),zmAjq.XHR({u:zmail.conPath+"/md.do",t:"POST",fn:a,p:n,ep:i})},openSignatureList:S,insertCRMTemplate:function(e,t){var o=zmComp.getAttRef(e),n=t.data.templates,i=n.attachments||[],a=[],m={};i.forEach(function(e){m={integId:zmail.integId,attachId:e.file_id,fName:e.name},a.push(m)});var r={crm:a};0<i.length&&o.cloudUpload(JSON.stringify(r),i.length),zmComp.getEditor(e).insertHTML(n.content)},signInsert:function(e,t){o(e,t),zmCUtil.closeDialog("zm_insSign")},signUpdate:o,removeExistingSign:function(e){var t=zmComp.getEditor(e);$.e(t.doc.body).find("#Zm-_Id_-Sgn").remove()},show:function(e,t){var o,n=e.id,i=e.par;switch(i.find("b").addClass("SC_ddn"),n){case"zm_priLst":e.ulClass="SC_tin";var a=zmCDrop.priorityOptions(e);e.list=a.list,e.clk=a.clk,e.align="pright",e.parWidth=!0;break;case"zm_compactLst":e.ulClass="SC_tin";var m=zmCDrop.moreDropOptions(e);e.list=m.list,e.clk=m.clk;break;case"zm_SndLst":e.par=i;var r=function(e){var t=[],o={txt:_.send,data:{}};o.data.action="s",o.data.cmpId=e;var n={txt:_.sendNow,data:{}};return n.data.action="si",n.data.cmpId=e,t.push(o,n),{list:t,clk:function(e){var t=e.action,o=e.cmpId;"s"===t?(zmComp.sendMail({action:"compose",cmpId:o}),zmUtil.hideMenu()):"si"===t&&(zmComp.sendMail({action:"compose",sendIm:!0,cmpId:o}),zmUtil.hideMenu())}}}(e.cmpId);i.find("b").addClass("SC_ddn"),e.list=r.list,e.clk=r.clk,e.leftOffset=4,e.topOffset=-2;break;case"zm_SveLst":var d=(o=e.cmpId,{list:[{txt:_.draft,data:{action:"sdraft",cmpId:o}},{txt:_.template,data:{action:"stemplate",cmpId:o}}],clk:function(e){var t=e.action,o={cmpId:e.cmpId};switch(t){case"sdraft":o.action="sdraft",zmComp.sendMail(o),zmUtil.hideMenu();break;case"stemplate":o.action="stemplate",zmComp.sendMail(o),zmUtil.hideMenu()}}});e.list=d.list,e.clk=d.clk,e.align="pright",e.loadCopt=!0,e.parWidth=!0}(e.align=e.align||"pleft","pleft"!==e.align&&"pright"!==e.align||!i.attr("data-drop"))?new zmDropDownMenu(e).paint():(i.removeAttr("data-drop"),zmUtil.hideMenu())}}}(),window.zmCUtil=function(){var V=zmUtil.composeI18N(),l="#zmsuglist_",J=function(e,t,o){return zmText.get("editorInteg",e,t,o)};return{getfontFamily:function(e){var t="";switch(e){case"Arial":t="Arial,Helvetica,serif,sans-serif";break;case"Courier":t="Courier New,Courier,monospace,sans-serif";break;case"Georgia":t="Georgia,Times New Roman,Times,serif,sans-serif";break;case"Tahoma":t="Tahoma,Arial,Helvetica,sans-serif";break;case"Times":t="Times New Roman,Times,serif,sans-serif";break;case"Trebuchet":t="Trebuchet ms,Arial,Helvetica,sans-serif";break;case"Verdana":t="Verdana,Arial,Helvetica,sans-serif";break;case"Comic Sans MS":t="Comic Sans MS,sans-serif";break;case"Serif":t="Serif,sans-serif";break;case"Default":t="Default";break;case"Calibri":t="Calibri,Verdana,Arial,sans-serif";break;default:t=e}return t},getfontSize:function(){var e=10;return zmail.mailOpt.fs&&(e=zmail.mailOpt.fs),e},getfontColor:function(e){var t="#00000";return zmail.userOptions&&zmail.userOptions.fontColor&&"Default"!==zmail.userOptions.fontColor&&(t=zmail.userOptions.fontColor),t},closeDialog:function(e){zmsDialog.remove(),$.q("#"+e).remove()},chgEncode:function(e){var t=zmComp.getCurrentCompId();zmComp.setCharSet(t,e),zmComp.setModified(t,1),zmUtil.hideMenu()},loadExtImages:function(e,t){var o,n,i,a=zmComp.getEditor(e);t.externalURL?(o=t.externalURL,n=t.externalLink):t.exturl&&t.extlink&&(o=t.exturl.split(","),n=t.extlink.split(","));try{if(n&&n.length){i=n.length;for(var m,r,d=a.doc,s=0;s<i;s++)m=n[s],r=o[s].replace(/&amp;/gi,"&"),$.e(d).find("img#"+m)[0]?$.e(d).find("img#"+m).attr("src",r):$.e(d).find('img[data-extimg_id="'+m+'"]')[0]&&$.e(d).find('img[data-extimg_id="'+m+'"]').attr("src",r)}}catch(e){}},showFromAddr:function(e){if(e=$.e(e).find("> div"),$.q("#zm_fLst").is(":visible"))$.q("#zm_fLst").hide();else{var t=$.e(e).offset(),o=t.left,n=t.top+$.e(e).height();$.q("#zm_fLst").css({left:o+"px",top:n+"px"}).show()}},bindDatePicker:function(e,t){if("undefined"!=typeof ZEVENTS){var o=zmail.userDateFormat.toUpperCase(),n=zmail.userDateVal;void 0!==e&&ZEVENTS(e).picker("date",{dform:o,wkst:0,mode:"popup",update:"yes",range:[n,""],minhgt:251}).on("dateclick",function(){t&&t(this.getDate().getDateBy(o))}).bind()}},bindTimePicker:function(e){"undefined"!=typeof ZEVENTS&&void 0!==e&&ZEVENTS(e).picker("time",{tform:"HH:mm ss"}).bind()},hideDatePicker:function(){$.q(".zcal_cn").remove()},hideTimePicker:function(){$.q(".zcal_tilst").remove()},dataURItoBlob:function(e){var t,o,n;t=0<=e.split(",")[0].indexOf("base64")?window.atob(e.split(",")[1]):window.unescape(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length);for(var i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new Blob([n],{type:o})},getTabToolbar:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=!0;t=e.workDrive||t;var o=function(e){zmComp.triggerCloudUpload(e)},n=function(e){zmComp.triggerTeamDrive(e)};o=e.callbackAttachment||o,n=e.callbackWorkDrive||n;var i=[],a=["custom",V.attachment,"zei-attachment",o,"compAttachment"],m=["custom",V.cloudAttachment,"zei-workDrive",n,"compWorkdrive"],r=!1;"MacIntel"===navigator.platform&&(r=!0);var d=["bold",J(r?"mactooltip.bold":"tooltip.bold"),"zei-bold"],s=["italic",J(r?"mactooltip.italic":"tooltip.italic"),"zei-italic"],p=["underline",J(r?"mactooltip.underline":"tooltip.underline"),"zei-underline"],l=["strikethrough",J(r?"mactooltip.strikethrough":"tooltip.strikethrough"),"zei-strike"],c=["fontfamily",J(r?"mactooltip.font":"tooltip.font"),"zeFFce"],u=["fontsize",J(r?"mactooltip.fontSize":"tooltip.fontSize"),["ze_pdl","zeFUce"].join(" ")],f=["forecolor",J("tooltip.fontColor"),"zei-textclr"],z=["backcolor",J("tooltip.backgroundColor"),"zei-bgclr"],C=["alignoptions",J("tooltip.alignOptions"),"zei-textleft"],g=["listoptions",J("tooltip.listOptions"),"zei-unorder"],v=["indentoptions",J("tooltip.indent"),"zei-indent"],h=["directionoptions",J("tooltip.direction"),"zei-ltr"],I=["image",J("tooltip.insertImage"),"zei-image"],_=["link",J(r?"mactooltip.insertLink":"tooltip.insertLink"),"zei-link"],D=["insertHTML",J("tooltip.insertHtml"),"zei-html"],b=["quote",J(r?"mactooltip.insertQuote":"tooltip.insertQuote"),"zei-quote"],S=["formatingoptions",J("tooltip.formatingoptions"),"zei-formatpaint"],O=["tableGrid",J("tooltip.table"),"zei-table"],M=["edithtml",J("tooltip.edithtml"),"zei-editHtml"],y=["smiley",J("tooltip.insertSmiley"),"zei-smiley"],T=["spellcheck",J("tooltip.spellcheck"),"zei-spellCheck"],w=["otheroptions",J("tooltip.otherOptions"),"zei-arrow ze-big"],A=["scriptoptions",J("tooltip.script"),"zei-superScript"],$=["lineHeight",J("tooltip.lineHeight"),"zei-lineHeight"],E=["template",J("tooltip.template"),"zei-template"],R=[];R.push(a);var x=[],k=[],j=[];j.push(d),j.push(s),j.push(p),j.push(l);var U=[];U.push(c);var L=[];L.push(u);var F=[];F.push(f),F.push(z);var N=[];N.push(C),N.push(g),N.push(v),N.push(h),N.push($);var q=[];q.push(I),q.push(_),q.push(E),q.push(["signature","Insert Signature","zei-signature"]),q.push(D),q.push(M),k.push(y);var P=[];P.push(S);var H=[];H.push(T);var B=[];B.push(w);var W=[];W.push(A);var Z=[];if(Z.push(["markdown","markDownEditor","zei-editHtml"]),x.push(b),x.push(O),x.push(["inserthorizontalrule","Insert Horizontal Rule","zei-line"]),i.push(R),t){var G=[];G.push(m),i.push(G)}return i.push(j),i.push(U),i.push(L),i.push(F),i.push(N),i.push(W),i.push(q),i.push(x),i.push(P),i.push(k),i.push(H),zmail.showFeature&&i.push(Z),i.push(B),i},getSmartToolbar:function(){return[[["bold","Bold (Ctrl+B)","zei-bold"],["italic","Italic (Ctrl+I)","zei-italic"],["underline","Underline (Ctrl+U)","zei-underline"],["strikethrough","Strikethrough","zei-strike"]],[["fontfamily","Font","zei-fontfamily"]],[["forecolor","Font color","zei-textclr"],["backcolor","Background Color","zei-bgclr"]],[["smiley","Insert smiley","zei-smiley"]],[["otheroptions","Spell Check Languages","zei-arrow ze-big"]]]},tooltip:function(e){e.ele&&$.e(e.ele).attr("data-tooltip",e.tooltip)},getContactsEmails:function(e,t){return zmComp.getRecipientField({field:t,composeID:e}).getEmailList().join(",")},contactsObj:{},fillContactObj:function(e){if(e.length)for(var t=e.length,o=0;o<t;o++)zmCUtil.contactsObj[e[o].emailAddress]=e[o]},loadingSugList:function(e){$.q("#zmsugfrlist_"+e).addClass("zmHideD"),$.q("#zmsugloading_dots_"+e).removeClass("zmHideD")},showSugList:function(e,t){var o=$.q(l+e);o.length&&!o.is(":visible")&&(o.attr("data-type")!==t&&o.parent().remove(),o=$.q(l+e));if(o.length)o.length&&!o.is(":visible")&&o.parent().slideDown("100",function(){zmComp.setHeight(e)});else{var n=zmCompOpt._suggestionDOM(e),i=zmComp.getRecipientField({field:"cc"===t?"cc":"to",composeID:e}).component.dom;$.e(n).insertDOMAfter(i),(o=$.q(l+e)).attr("data-type",t),o.parent().slideDown("300",function(){zmComp.setHeight(e)})}$.q("#zmsugcontactslist_"+e).removeClass("zmHideD"),$.q("#zmsugfrlist_"+e).removeClass("zmHideD"),$.q("#zmsugloading_dots_"+e).addClass("zmHideD")},removeSugList:function(e){var t=$.q(l+e);t.length&&t.is(":visible")&&t.parent().slideUp("100",function(){zmComp.setHeight(e)}),zmCUtil.showLoading[e]=!1},insertAllSugContacts:function(e,t){var o=zmCUtil.missedSugObj[e],n=o.length;if(n)for(var i=0;i<n;i++)zmCUtil.insertSugContacts(e,t,o[i])},insertSugContacts:function(e,t,o){var n=zmComp.getSugType(e),i=zmConUtil.constructContact(zmCUtil.contactsObj[o]);zmComp.getRecipientField({field:n,composeID:e}).createTokens({text:i,silent:!0})},prevReqObj:[],showContactCard:function(e,o,t){var n=t.attr("eId");zmConUtil.showContactCard({dom:t[0],email:n,event:e,hideOnBlur:!0,source:"compose"}).done(function(e){if(e.eventSource&&e.component){var t=e.eventSource;if($.e(t).is(":visible"))$.q(l+o).data({eIdElem:e.eventSource,listElem:e.component.$el});else e.component.$el.remove()}})},loadSugList:function(p,e,t){var o=$.q("#zmsugcontactslist_"+p);o.find("> span").remove();var n=function(o){return function(e){var t=setTimeout(function(){o.data({timer:null}),zmCUtil.showContactCard(e,p,o)},1e3);o.data({timer:t})}},i=function(t){return function(){var e=t.data("timer");e&&clearTimeout(e)}},a=function(m,r,d,s){return function(e){var t=$.q(l+p),o=s.data("timer");o&&(clearTimeout(o),s.data({timer:null}));var n=t.data();n&&n.listElem&&n.listElem.remove(),s.remove();var i=zmCUtil.missedSugObj[p],a=i.indexOf(d);-1<a&&i.splice(a,1),i.length||zmCUtil.removeSugList(p),zmCUtil.insertSugContacts(m,r,d),_zm.stopEvents(e)}};for(var m in t){var r=$.trim(t[m].email),d=$.q(zdom("span",null));d.attr("class","SC_lnk zmNxtVal"),d.attr("eId",r),d.text($.trim(t[m].name)),d.on("mouseenter",n(d)),d.on("mouseout",i(d)),d.on("mousedown",a(p,e,r,d)),$.e(o).appendDOM(d)}},noContactsArray:function(e,t){for(var o=_.difference(e,t),n=o.length,i=[],a=0;a<n;a++){var m={email:o[a],name:o[a]};zmCUtil.contactsObj[m.email]||(zmCUtil.contactsObj[m.email]={emailAddress:m.email}),i.push(m)}return i},missedSugList:function(m,r,d){var e={eid:d,type:["personal"],excludeOrgUsers:!0};zmail.ContactBook.get(e).done(function(e){var t=e.map(function(e){return e.attrs}),o=t.map(function(e){return{name:e.fn+" "+e.ln,email:e.eid,photo:e.photo}}),n=[];o.forEach(function(e){n.push(e.email)});var i=zmCUtil.noContactsArray(d,n);o=o.concat(i);var a=t.map(function(e){return{firstName:e.fn,lastName:e.ln,nickName:e.nn,emailAddress:e.eid}});zmCUtil.fillContactObj(a),o.length&&(zmCUtil.showSugList(m,r),zmCUtil.loadSugList(m,r,o))})},missedSugObj:{},showLoading:{},updateSugList:function(e,t){var o=e.missedContacts||[],n=t.cmpId,i=t.type;(zmCUtil.missedSugObj[n]=o)&&!o.length?(zmCUtil.showLoading[n]=!1,zmCUtil.removeSugList(n)):o.length&&(zmCUtil.showLoading[n]=!0,zmCUtil.missedSugList(n,i,o))},getEmailsList:function(e,t){var o=zmCUtil.getContactsEmails(e,t);if("cc"===t){var n=zmCUtil.getContactsEmails(e,"to");n&&(o&&""!==o?o+=","+n:o=n)}else if("to"===t){var i=zmCUtil.getContactsEmails(e,"cc");i&&(o&&""!==o?o+=","+i:o=i)}return o},uniqSugContacts:function(e,t){var o=zmCUtil.getEmailsList(e,t);return o&&2<=(o=o.split(",")).length&&(o=o.filter(function(e,t,o){return o.indexOf(e)===t})),o},chkWrongContacts:function(e,t){var o=zmCUtil.uniqSugContacts(e,t);if(3<=o.length){var n={cmpId:e,eleType:t,mode:"wrong",emailLst:o};zmCUtil.reqWrongContacts(n)}},reqNewSugContacts:function(e){var t=zmCUtil.prevReqObj,o=!0,n=[];if(t.length===e.length)for(var i=t.length,a=e.length,m=0;m<i;m++)for(var r=0;r<a;r++)t[m]===e[r]&&n.push(t[m]);return n.length===e.length&&(o=!1),o},getSugContacts:function(e,t){zmCUtil.previousIcontactReq&&"pending"===zmCUtil.previousIcontactReq.state()&&zmCUtil.previousIcontactReq.abort();var o=zmCUtil.uniqSugContacts(e,t),n=!1;if(o.length&&(n=zmCUtil.reqNewSugContacts(o)),2<=o.length&&o.length<=15&&n){var i={cmpId:e,eleType:t,mode:"missed",emailLst:o};zmCUtil.showLoading&&zmCUtil.showLoading[e]&&zmCUtil.loadingSugList(e),zmCUtil.reqSugContacts(i)}else zmCUtil.removeSugList(e)},wrongContacts:function(e){zmComp.debugLog(e)},reqWrongContacts:function(e){var t=e.cmpId,o=e.eleType,n="";n=e.emailLst?e.emailLst:zmCUtil.uniqSugContacts(t,o);var i={mode:e.mode,contact:n},a={mode:e.mode,contact:n,cmpId:t,type:o};zmCUtil.previousIcontactReq=zmAjq.XHR({u:zmail.conPath+"/ircontact.do",t:"POST",p:i,ep:a,csr:"s",fn:zmCUtil.wrongContacts})},reqSugContacts:function(e){var t=e.cmpId,o=e.eleType,n="";n=e.emailLst?e.emailLst:zmCUtil.uniqSugContacts(t,o);var i={mode:e.mode,contact:n},a={mode:e.mode,contact:n,cmpId:t,type:o};zmCUtil.previousIcontactReq=zmAjq.XHR({u:zmail.conPath+"/ircontact.do",t:"POST",p:i,ep:a,csr:"s",fn:zmCUtil.updateSugList})},isEmailExist:function(e){var t=zmail.ContactBook.get({promise:!1,eid:e});return Boolean(t.length)},getCmpIdType:function(e){var t=e.split("_")[1],o=e.split("_")[0];return o&&(o=(o=o.replace(/zm/g,"")).replace(/txt/g,"")),{cmpId:t,eleType:o}},getElemId:function(e){var t=e.elem,o=null;return t&&t.id&&(o=zmCUtil.getCmpIdType(t.id)),o},getContacts:function(e){var n=$.Deferred(),i={},t={str:e,type:["personal"],excludeOrgUsers:!0,expected:10};return zmail.ContactBook.get(t).done(function(e){var t=[],o=e.map(function(e){return e.attrs});o.length&&(t=o.map(function(e){return{fn:e.fn+" "+e.ln,eid:e.eid,photo:e.photo}})),i.result=t,n.resolve(i)}),n.promise()},getCmpObj:function(e){return zmComp.getCmpObj()[e]},clearDraft:function(e,t){var o={aId:e,mode:"discard"};o.mailId=t;var n=$.extend({},o);zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",p:o,csr:"s",ep:n})},closeOutboxConfirm:function(t){var e=$.q(zdom("div",null));e.attr("id","zmcmp_close_outbox_"+t);var o=V.outboxSending;e.text(o);var n={cmpId:t,$content:e,ignoreMouseDown:!1,dialogDidMount:function(o){($.q("#zmcmp_close_outbox_"+t)[0].zmcmp_close_outbox=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},defaultNavigator:!1};n.navigator=new zmail.Navigator({onEscape:function(){$.q("#zmcmp_close_outbox_"+t)[0].zmcmp_close_outbox.remove()}});var i={name:V.send,callback:function(e){zmComp.setOutboxClose(t,!0),zmComp.sendMail({action:"compose",sendIm:!1,cmpId:t}),e.remove()}},a={name:V.deleteTxt,isCancel:!0,callback:function(e){zmCUtil.delOutboxReq(t,zmComp.getMymId(t)),zmComp.getOutboxMailId(t)&&zmCUtil.clearDraft(zmComp.getAccId(t),zmComp.getOutboxMailId(t)),e.remove()}},m={name:V.cancel,isCancel:!0,callback:function(e){e.remove()}};n.buttons=[i,m,a],Dialog.new(n)},discardOutboxConfirm:function(t){var e=$.q(zdom("div",null));e.attr("id","zmcmp_discard_outbox_"+t),e.text(V.outboxCancelMessage);var o={cmpId:t,$content:e,ignoreMouseDown:!1,dialogDidMount:function(o){($.q("#zmcmp_discard_outbox_"+t)[0].zmcmp_discard_outbox=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},defaultNavigator:!1};o.navigator=new zmail.Navigator({onEscape:function(){$.e("#zmcmp_discard_outbox_"+t)[0].zmcmp_discard_outbox.remove()}});var n={name:V.ok,callback:function(e){zmCUtil.delOutboxReq(t,zmComp.getMymId(t)),zmComp.getOutboxMailId(t)&&zmCUtil.clearDraft(zmComp.getAccId(t),zmComp.getOutboxMailId(t)),e.remove()}},i={name:V.cancel,isCancel:!0,callback:function(e){e.remove()}};o.buttons=[n,i],Dialog.new(o)},delOutboxReq:function(e,t){var o={accId:zmComp.getAccId(e),mode:"moveto",viewfolId:zmail.folId.oId,mailId:t,todo:5,fT:6,folderSpec:1},n={cmpId:e,msgId:t};zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:zmCUtil.delOutboxResp,p:o,csr:"s",ep:n,setSessionId:!0})},updateOutboxView:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).msgId,t=zmInit,o=!1,n=zmail.folId;window.opener&&window.opener.zmInit&&zmail.isComposeMail&&(o=!0,t=window.opener.zmInit,n=window.opener.zmail.folId);var i=t.getListingDetObj();if(i){var a=i.fId;if(a&&a===n.oId){var m={fId:a,view:"",viewId:"",retainPreview:e!==(window.zmPrev&&zmPrev.prevDetails("zm_Container")||{}).msgId};o?window.opener.$.publish("/mail/listMails",m):$.publish("/mail/listMails",m)}}},delOutboxResp:function(e,t){if("success"===e.result){var o={cmpId:t.cmpId,triggerType:"close_outbox_afterdelete"};zmComp.comClose(o),zmCUtil.updateOutboxView({msgId:t.msgId})}},setTempFolId:function(e,t){var o=zmCUtil.getFolId(t);o&&(o===zmail.folId.teId&&zmComp.setTempId(e,t),zmComp.setFID(e,o))},getFolId:function(e){var t,o=zmUtil.getMailObj(e);return o&&o.FD&&(t=o.FD),t},addRefHeader:function(e,t){return e&&-1===e.indexOf(t)&&(e=e+" "+t),e},getCompHeaderObj:function(e){return"t"===zmComp.getType(e)?$.e(zmsuite.getCenter(e)[0].getNodes()[0].$el):$.q("#SCmb_"+e)},transResizeRepDOM:function(t){var e=zmCUtil.getCompHeaderObj(t),o=$.e(e).outerWidth();$.q("#zmrep_"+t).css({maxWidth:o+"px"}),["to","cc","bcc"].forEach(function(e){zmComp.getRecipientField({field:e,composeID:t}).component.resizeInput()});try{zmComp.setTabHeight(t);var n=zmComp.getEditor(t);n&&($.e(n.toolbardiv).css({overflow:""}),zmCUtil.regenerateToolbar(t))}catch(e){}},clearResizeRepDOM:function(e){var t=zmComp.getEditor(e);t&&$.e(t.toolbardiv).css({overflow:"hidden"})},resizeRepDOM:function(t){["to","cc","bcc"].forEach(function(e){zmComp.getRecipientField({field:e,composeID:t}).component.resizeInput()})},removeNotToParse:function(e){var t=$.q(zdom("div",null));return $.e(t).dangerouslySetInnerHTML(e),$.e(t).find("div[class$='zmail_extra']").remove(),$.e(t).find("div[id$='Zm-_Id_-Sgn']").remove(),t.html()},getCenterAppElem:function(){var e=zmTab.currentTab;return zmsuite.getAppObj(e).centerObj.$el},getSignature:function(e){var t=zmComp.getSignObj(),o="",n="";return e&&""!==e&&"null"!==e&&(o=t[e].SIG_CONT,n=t[e].SIG_POS),{SIG_CONT:o,SIG_POS:n}},regenerateToolbar:function(e){var t=zmComp.getEditor(e);if(t){try{t.regenerateToolbar()}catch(e){zmComp.debugLog(e)}zmComp.updateToolbarForSignature(e)}}}}(),function(e){var n=zmUtil.composeI18N(),t={hugeNotAllowTemplate:function(t){var e=zdom("h4",{id:"zmcmp_temphugatt_"+t},n.hugeAttNotAllowedTemplate),o={cmpId:t,$content:$.e(e),ignoreMouseDown:!1,dialogDidMount:function(o){($.q("#zmcmp_temphugatt_"+t)[0].zmcmp_confirm_dialog_ele=o).$els.$maskWrapper.on("mousedown",function(e){var t=e.target||e.srcElement;$.e(t).closest("div.SC_pe").length?$.e(t).trigger("click"):o.remove()})},defaultNavigator:!1,navigator:new zmail.Navigator({onEscape:function(){$.q("#zmcmp_temphugatt_"+t)[0].zmcmp_confirm_dialog_ele.remove()}}),buttons:[{name:n.savetemplate,callback:function(e){zmComp.sendMail({action:"stemplate",sendIm:!1,cmpId:t,tmpUpdate:!0,hugeAttWarning:!0}),e.remove()}},{name:n.cancel,isCancel:!0,callback:function(e){e.remove()}}]};Dialog.new(o)}};$.extend(!0,e,t)}(window.zmCDialog=window.zmCDialog||{}),window.zmCDocTemplate=function(){var i=zmUtil.composeI18N(),e="";e=zmail.globalI18N?zmail.globalI18N:i.global;var a=zmText.applyArgs(i.docshare_recipientsalone,{companyName:e.companyName});return{_getCenter:function(e){var t,o,n;return zdom("div",null,zdom("fragment",null,zdom("b",null,i.docshare_choosefiles)),zdom("div",{className:"zmL nohr",id:"zmcdoc_recipients_tit_"+e,"data-shareopt":"private"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmFlt"},zdom("i",{className:"msi-option","data-shareopt":"option"})),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmFrm"},zdom("span",null,i.docshare_recipientsthisemail)),zdom("div",{className:"zmSub"},zdom("span",{className:"sum"},a))))),(n=e,zdom("div",{className:"shrPUOdata",id:"zmcdoc_recipients_opt_"+n,"data-shareopt":"private"},zdom("label",null,i.docshare_setpermissions+": "),zdom("div",{className:"SC_select",style:{width:"135px"}},zdom("select",{id:"zmcdoc_recipients_select_"+n},zdom("option",{value:"1"},i.docshare_readonly),zdom("option",{value:"2"},i.docshare_readwrite))))),zmail.isOrg&&zdom("div",{className:"zmL nohr",id:"zmcdoc_org_tit_"+e,"data-shareopt":"orgshare"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmFlt"},zdom("i",{className:"msi-unoption","data-shareopt":"option"})),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmFrm"},zdom("span",null,i.docshare_everyonewithme)),zdom("div",{className:"zmSub"},zdom("span",{className:"sum"},i.docshare_orgmemberhaslink))))),zmail.isOrg&&(o=e,zdom("div",{className:"shrPUOdata",id:"zmcdoc_org_opt_"+o,"data-shareopt":"orgshare"},zdom("label",null,i.docshare_setpermissions+": "),zdom("div",{className:"SC_select",style:{width:"135px"}},zdom("select",{id:"zmcdoc_org_select_"+o},zdom("option",{value:"1"},i.docshare_readonly),zdom("option",{value:"2"},i.docshare_readwrite))))),zdom("div",{className:"zmL nohr",id:"zmcdoc_internet_tit_"+e,"data-shareopt":"linkshare"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmFlt"},zdom("i",{className:"msi-unoption","data-shareopt":"option"})),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmFrm"},zdom("span",null,i.docshare_everyoneinnet)),zdom("div",{className:"zmSub"},zdom("span",{className:"sum"},i.docshare_anyonehaslink))))),(t=e,zdom("div",{className:"shrPUOdata",id:"zmcdoc_internet_opt_"+t,"data-shareopt":"linkshare"},zdom("div",{style:{minHeight:"39px"}},zdom("i",{className:"msi-uncheck",id:"zmcdoc_internet_checkbox_"+t}),i.docshare_setexpirydate,zdom("input",{id:"zmcdoc_internet_text_date_"+t,placeholder:"",type:"text",readOnly:!0}))))).outerHTML},_getButton:function(e){return zdom("div",{className:"SC_PUbtm",id:"button_share_"+e},zdom("span",{className:"sel",id:"button_sharesend_"+e},i.docshare_shareandsend),zdom("span",{id:"button_cancel_"+e,"data-val":"Cancel"},i.docshare_cancel),zdom("label",{className:"SC_lnk SC_frt",id:"button_sendwithout_"+e},i.docshare_sendwithoutshare))}}}(),window.zmCDoc=function(){var r={};return{showMore:function(e){$("#moreopt_sharedata_"+e).removeClass("SC_dyn"),$("#moreopt_share_"+e).addClass("SC_dyn")},hideMore:function(e){$("#moreopt_sharedata_"+e).addClass("SC_dyn"),$("#moreopt_share_"+e).removeClass("SC_dyn")},shareSend:function(e){var t=r[e]._sObj,o=r[e].shareType,n={};"private"===o?n.permission=$("#zmcdoc_recipients_select_"+e).find("option:selected").val():"orgshare"===o?n.permission=$("#zmcdoc_org_select_"+e).find("option:selected").val():"linkshare"===o?(n.permission=1,$("#zmcdoc_internet_checkbox_"+e).hasClass("msi-check")&&(n.expiryDate=$("#zmcdoc_internet_text_date_"+e).val())):"userpwdlink"===o&&(n.permission=1,n.sendPasswordInMail=!0,$("#zmcdoc_pwdlink_checkbox_"+e).hasClass("msi-check")&&(n.expiryDate=$("#zmcdoc_pwdlink_text_date_"+e).val()),n.password=$("#zmcdoc_pwdlink_inpPass_"+e).val()),n.expiryDate&&(n.expiryDate=zmCDoc.getDocDate(n.expiryDate)),r[e]._dialogDOCSHARE.remove(),n.shareType=o,t._sReq=n,t.zDocShare="send_with",zmComp.sendMail(t)},getDocDate:function(e){if("DD/MM/YYYY"===zmail.userDateFormat.toUpperCase()){var t=e.split("/");e=t[1]+"/"+t[0]+"/"+t[2]}return e},shareCancel:function(e){r[e]._dialogDOCSHARE.remove()},shareWithout:function(e){r[e]._dialogDOCSHARE.remove(),r[e]._sObj.zDocShare="send_without",zmComp.sendMail(r[e]._sObj)},setShowMore:function(e){$("#moreopt_share_"+e).off("click").on("click",function(){zmCDoc.showMore(e)})},setShareSend:function(e){$("#button_sharesend_"+e).off("click").on("click",function(){zmCDoc.shareSend(e)})},setShareCancel:function(e){$("#button_cancel_"+e).off("click").on("click",function(){zmCDoc.shareCancel(e)})},setShareWithout:function(e){$("#button_sendwithout_"+e).off("click").on("click",function(){zmCDoc.shareWithout(e)})},resetShareModes:function(e){for(var t=["zmcdoc_recipients_tit","zmcdoc_org_tit","zmcdoc_internet_tit","zmcdoc_pwdlink_tit"],o=0;o<t.length;o++){$("#"+t[o]+"_"+e).find('i[data-shareopt="option"]').eq(0).removeClass("msi-option").addClass("msi-unoption")}},binderPrivate:function(e){var t=$("#zmcdoc_recipients_tit_"+e);t.off("click").on("click",function(){zmCDoc.resetShareModes(e),r[e].shareType="private",t.find('i[data-shareopt="option"]').eq(0).removeClass("msi-unoption").addClass("msi-option")})},binderOrgshare:function(e){var t=$("#zmcdoc_org_tit_"+e);t.off("click").on("click",function(){zmCDoc.resetShareModes(e),r[e].shareType="orgshare",t.find('i[data-shareopt="option"]').eq(0).removeClass("msi-unoption").addClass("msi-option")})},binderLinkshare:function(t){var e=zmCDoc.getDate(),o=$("#zmcdoc_internet_text_date_"+t).get(0);$("#zmcdoc_internet_text_date_"+t).val(e),zmCDoc.bindDatePicker(o,function(e){r[t]._date_val=e});var n=$("#zmcdoc_internet_tit_"+t);n.off("click").on("click",function(){zmCDoc.resetShareModes(t),r[t].shareType="linkshare",n.find('i[data-shareopt="option"]').eq(0).removeClass("msi-unoption").addClass("msi-option")});var i=$("#zmcdoc_internet_opt_"+t).find("i").eq(0);i.off("click").on("click",function(){i.hasClass("msi-check")?i.removeClass("msi-check").addClass("msi-uncheck"):i.removeClass("msi-uncheck").addClass("msi-check")})},bindBox:function(e){zmCDoc.setShowMore(e),zmCDoc.setShareSend(e),zmCDoc.setShareCancel(e),zmCDoc.setShareWithout(e),zmCDoc.binderPrivate(e),zmCDoc.binderOrgshare(e),zmCDoc.binderLinkshare(e)},bindDatePicker:function(e,t){var o;if("undefined"!=typeof ZEVENTS){var n=zmCDoc.getDate(),i=zmail.userDateFormat.toUpperCase();void 0!==e&&(o=ZEVENTS(e).picker("date",{dform:i,wkst:0,mode:"popup",update:"yes",range:[n,""],minhgt:251}).on("dateclick",function(){t&&t(this.getDate().getDateBy(i))}).bind())}return o},getDocObj:function(e){var t={};return t.docObj=r,t.cmpId=r[e],t},getDate:function(){var e=new Date;e.setDate(e.getDate()+2);var t=e.getDate(),o=e.getMonth()+1;return t<10&&(t="0"+t),o<10&&(o="0"+o),e=t+"/"+o+"/"+e.getFullYear()},shareDialog:function(e){var t={servicename:"zmail",docsURL:"//"+zmail.urls.docsURL,isnewui:!0};ATTACHDIALOG.setSharingTypeForSelectedUser(t.callback,zmComp.getZDObj(e))},showBox:function(n,i){var e=zmCDocTemplate._getCenter(n),t=zmCDocTemplate._getButton(n),a=$(e),m=$(t),o={};o.cmpId=n,o.$content=a,o.title="Share Files",o.ignoreMouseDown=!1,o.dialogDidMount=function(e){e.$els.$content.attr("id","zmshare_"+n);var t=e.$els.$content;t.append(a),t.after(m),t.addClass("shrPU");var o="";try{o=ATTACHDIALOG.getDocAsLink().ZD_USER_PLAN_TYPE}catch(e){zmUtil.debugLog(e)}"FREE"===o&&$("#zmcdoc_internet_opt_"+n).remove(),zmCDoc.bindBox(n),r[n]={},r[n]._dialogDOCSHARE=e,r[n]._sObj=i,r[n].shareType="private"},Dialog.new(o)}}}(),function(e){e.getREText={bg:"Re:",bn:"এই সম্পর্কে:",cs:"Re:",da:"Sv:",de:"Re:",en:"Re:",es:"Re:",fr:"Re :",hi:"संदर्भ:",hr:"Odgovor:",hu:"Vá:",it:"R:",ja:"Re:",ko:"답장:",mr:"उत्तर:",nl:"Re:",pl:"Odp.:",pt:"Re:",pt_PT:"Re:",ru:"Re:",sv:"Ang:",ta:"பொருள்:",te:"రిఫరెన్స్:",tr:"Yanıtla:",uk:"Відповідь:",zh:"回复:",zh_CN:"Re:"},e.getFWDText={bg:"Fwd:",bn:"ফরোয়ার্ড করুন:",cs:"Fwd:",da:"VS:",de:"Fwd:",en:"Fwd:",es:"Reenviar:",fr:"Trf :",hi:"अग्रेषित:",hr:"Proslijedi:",hu:"Tv.:",it:"I:",ja:"Fwd:",ko:"전달:",mr:"अग्रेषित:",nl:"Doorsturen:",pl:"Pd:",pt:"Enc:",pt_PT:"Reencaminhar:",ru:"Fwd:",sv:"Vid.bef:",ta:"முன்னனுப்பு:",te:"ఫార్వర్డ్:",tr:"İlet:",uk:"Переслати:",zh:"转发：",zh_CN:"Fwd:"}}(window.zmCompLang=window.zmCompLang||{});