"use strict";!function(){var n=function(e,t){var n=null,i=null,r=null,s=function(){r=i=n=null};return function(){null!==n&&(clearTimeout(n),s()),i=this,r=Array.prototype.slice.call(arguments);return n=setTimeout(function(){e.apply(i,r),s()},t),{cancel:function(){clearTimeout(n),s()}}}},i=function(e,t){var n=null,i=null,r=null,s=function(){r=i=n=null};return function(){if(n)return i=this,void(r=Array.prototype.slice.call(arguments));e.apply(this,arguments);return n=setTimeout(function(){clearTimeout(n),e.apply(i,r),s()},t),{cancel:function(){clearTimeout(n),s()}}}};function r(e,t,n){n=n||"ref","string"==typeof e&&(e=$.parseHTML(e)),e=$.element(e);var i,r,s,o=$.query("["+n+"]",e),l={};for(o=o||[],$.element(e).attr(n)&&o.push($.element(e,!0)),i=0,r=o.length;i<r;i++)s=o[i],l[$.element(s).attr(n)]=$.element(s,!0),t&&$.element(s).removeAttr(n);return l}var d={ESC:27,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,BACKSPACE:8,TAB:9,COMMA:188,SHIFT:16,CTRL:17,ALT:18,META:91,RIGHT_META:93,A:65},s=d,o={DOM_MOUNTED:"domMounted"},e=Object.freeze({KEYS:s,EVENTS:o}),l=[];function a(e,t){return"function"==typeof e?n(e,t):null}function c(e,t){return"function"==typeof e?i(e,t):null}function u(){return $.Deferred()}var t=r;function h(e){return e===document.body||document.body.contains(e)}function p(e,t,n){var i,r=(n=n||{}).parentComponent||null,s=!1;s=i=h(t),r&&(s=h(r.dom)),(i||r||n.detached)&&(!0!==e._mounted&&(t.appendChild(e.dom),e._mounted=!0),s&&$(e).triggerHandler(o.DOM_MOUNTED,{dom:e.dom}))}function f(e){e&&($(e.dom).remove(),e._mounted=!1)}function m(e,t){e=e||"",t=t||e.length;var n=e.substring(0,t),i=/(?:(?=\s*)([\S]+[^\S\n]*)$)/i.exec(n);return i?i[1]:""}function v(){var e=$.q("#topBar")[0],t=$.q("#wmstoolbar")[0],n=$.q(".zsw-enclosure.shw")[0],i=document.body.getBoundingClientRect(),r={top:i.top,right:i.right,bottom:i.bottom,left:i.left};return e&&(r.top=e.getBoundingClientRect().bottom),t&&$(t).is(":visible")&&(r.bottom=t.getBoundingClientRect().top),n&&(r.right=n.getBoundingClientRect().left),r}function g(e){var t,n,i,r,s,o,l,a=null,d=null,c=!0,u=!1;d={left:0,top:0},a=(e=e||{}).dom,n=e.viewPortBounds,t=e.anchorBounds,$(a).css({height:"auto"}),i=a.getBoundingClientRect(),d.left=t.left,d.top=t.bottom,r=Math.abs(t.top-n.top),s=Math.abs(t.bottom-n.bottom),o=Math.abs(t.left-n.left),l=Math.abs(t.left-n.right),s<i.height&&s<r&&(d.top=t.top-i.height,d.top<n.top&&(d.top=n.top),c=!1),l<i.width&&l<o&&(d.left-=Math.abs(i.width-t.width));var h=Math.abs($(a).innerHeight()-$(a).height());c&&s<i.height&&($(a).css({height:s-h+"px"}),u=!0),!c&&r<i.height&&($(a).css({height:r-h+"px"}),u=!0),$(a).css({top:d.top+"px",left:d.left+"px"});var p={overflow:u};return u&&(p.height=(c?s:r)-h),p}var C=Object.freeze({debounce:a,throttle:c,deferred:u,getDOMReferenceMap:t,isDOMMounted:h,mountComponent:p,unmountComponent:f,findWordAtIndex:m,getListComponentViewPort:v,positionDOM:g,getAbsoluteBounds:function(e,t){return{top:e.top+t.top,right:e.left+t.left+t.width,left:e.left+t.left,bottom:e.top+t.top+t.height,width:t.width,height:t.height}},autoCompleteListsShown:function(e){if(!(e=e||{}).hideAll){if(e.instance){var t=e.instance;if(e.hide){var n=l.indexOf(t);return void l.splice(n,1)}l.push(t)}return l}for(var i in l)l[i].hideComponent()}}),y=function(){function e(){babelHelpers.classCallCheck(this,e);this._element=null}return babelHelpers.createClass(e,[{key:"init",value:function(e){this._element=e,this.bindEvents()}},{key:"destroy",value:function(){this.unbindEvents(),this._element=null}},{key:"bindEvents",value:function(){throw new Error("Yet to be implemented")}},{key:"unbindEvents",value:function(){throw new Error("Yet to be implemented")}},{key:"getText",value:function(){throw new Error("Yet to be implemented")}},{key:"setText",value:function(e){throw new Error("Yet to be implemented")}},{key:"getCursorPosition",value:function(){throw new Error("Yet to be implemented")}},{key:"setCursorPosition",value:function(e){throw new Error("Yet to be implemented")}},{key:"getListAnchorBounds",value:function(){return null}},{key:"saveCursorPosition",value:function(){throw new Error("Yet to be implemented")}},{key:"restoreCursorPosition",value:function(){throw new Error("Yet to be implemented")}},{key:"focus",value:function(){throw new Error("Yet to be implemented")}}]),e}();y.EVENTS={TEXT_CHANGE:"textchange"};var b={TRIGGER:"trigger",TRIGGER_NEGATIVE:"triggerNegative"},E=function(){function e(){babelHelpers.classCallCheck(this,e);this._input=null,this.active=!1}return babelHelpers.createClass(e,[{key:"init",value:function(e){if(!(e instanceof y))throw new Error("<input> argument should be instance of <AbstractInput>");this._input=e,this.active=!1,this.bindEvents()}},{key:"destroy",value:function(){this.unbindEvents(),this._input=null,this.active=!1}},{key:"textChangeAction",value:function(){}},{key:"_textChangeEventHandler",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.textChangeAction(t)}},{key:"publishTriggerEvent",value:function(e){((e=e||{}).triggerInstance=this).active=!0,$.events(this).triggerHandler(b.TRIGGER,e)}},{key:"publishNegativeTriggerEvent",value:function(e){(e=e||{}).triggerInstance=this,(e.force||this.active)&&(this.active=!1,$.events(this).triggerHandler(b.TRIGGER_NEGATIVE,e))}},{key:"bindEvents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,n=t._input;e.debounce=e.debounce||200,0<e.debounce&&(t._textChangeEventHandler=a(t._textChangeEventHandler,e.debounce)),t._textChangeEventHandler=t._textChangeEventHandler.bind(t),$.events(n).on("textchange",t._textChangeEventHandler)}},{key:"unbindEvents",value:function(){var e=this._input,t=this._textChangeEventHandler;$.events(e).off("textchange",t)}}]),e}();function k(){return Backbone.Model}function H(){return Backbone.Collection}E.EVENTS=b;var w=k().extend({defaults:{id:"",text:"",selected:!1}}),T=H().extend({model:w}),S={LIST_ITEM_CHANGE:"listItemChange"},I=k().extend({defaults:{listItems:null,currentSearchKey:"",searchInProgress:!1,searchState:"idle"},createListItemCollection:function(){return new T},initialize:function(){var t=this;t.set({listItems:t.createListItemCollection()}),t.getListItemCollection().on("change",function(e){t.trigger(S.LIST_ITEM_CHANGE,e)})},getListItemCollection:function(){return this.attributes.listItems},getListItems:function(){return this.getListItemCollection().models},getSelectedItem:function(){return this.getListItems().filter(function(e){return!0===e.attributes.selected})[0]},selectItem:function(e){var t=this.getListItemCollection().get(e),n=this.getSelectedItem();t.attributes.selected||(n&&n.set({selected:!1}),t.set({selected:!0}))},selectFirstItem:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.getListItemCollection().models[0];if(t){var n=this.getSelectedItem();n&&n.id===t.id||(n&&n.set({selected:!1},{silent:e.silent}),t.set({selected:!0},{silent:e.silent}))}},selectNextItem:function(){var e=this.getListItems();if(e.length){for(var t=0,n=0,i=e.length;n<i;n++)if(e[n].attributes.selected){t=n+1;break}t>=e.length&&(t=e.length-1),this.selectItem(e[t].attributes.id)}},selectPreviousItem:function(){var e=this.getListItems();if(e.length){for(var t=0,n=0,i=e.length;n<i;n++)if(e[n].attributes.selected){t=n-1;break}t<0&&(t=0),this.selectItem(e[t].attributes.id)}},resetData:function(){this.set({currentSearchKey:"",searchInProgress:!1,searchState:"idle"},{silent:!0}),this.get("listItems").reset(null,{silent:!0})}},{EVENTS:S}),M={LIST_UPDATE:"listUpdate",SEARCH_COMPLETE:"searchComplete"},O=function(){function e(){babelHelpers.classCallCheck(this,e);this.dataCollection=null,this.searchComplete=!1,this.searchRequest=null,this.enabled=!1}return babelHelpers.createClass(e,[{key:"createListItemCollection",value:function(){return new T}},{key:"init",value:function(){this.dataCollection=this.createListItemCollection(),this.enabled=!0}},{key:"destroy",value:function(){this.dataCollection=null,this.searchComplete=!1,this.searchRequest=null,this.enabled=!1}},{key:"triggerListUpdate",value:function(){$.events(this).triggerHandler(M.LIST_UPDATE,{provider:this})}},{key:"triggerSearchComplete",value:function(){this.searchComplete=!0,$.events(this).triggerHandler(M.SEARCH_COMPLETE,{provider:this})}},{key:"searchData",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.deferred,n=e.collection;t.resolve(n)}},{key:"getData",value:function(e){var t=this;if(t.enabled){t.abortPendingSearch(),t.searchComplete=!1,t.dataCollection.reset(null,{silent:!0});var n=u(),i=t.createListItemCollection();(t.searchRequest=n).done(function(){n===t.searchRequest&&(t.dataCollection.reset(i.models,{silent:!0}),t.triggerSearchComplete())}).fail(function(e){n===t.searchRequest&&((e=e||{}).cancel||t.triggerSearchComplete())}).always(function(){n===t.searchRequest&&(t.searchRequest=null)}),n.progress(function(){n===t.searchRequest&&(t.dataCollection.reset(i.models,{silent:!0}),t.triggerListUpdate())}),e.collection=i,e.deferred=n,t.searchData(e)}}},{key:"abortPendingSearch",value:function(){this.searchRequest&&(this.searchRequest.reject({cancel:!0}),this.searchRequest=null)}}]),e}();O.EVENTS=M;var A={ACCUMULATE_COMPLETE:"accumulateComplete"},D=function(){function e(){babelHelpers.classCallCheck(this,e);this.dataCollection=null,this.accumulateRequest=null}return babelHelpers.createClass(e,[{key:"createListItemCollection",value:function(){return new T}},{key:"init",value:function(){this.dataCollection=this.createListItemCollection(),this.accumulateRequest=null}},{key:"destroy",value:function(){this.dataCollection=null,this.accumulateRequest=null}},{key:"triggerAccumulationComplete",value:function(){$.events(this).triggerHandler(A.ACCUMULATE_COMPLETE,{accumulator:this})}},{key:"accumulateData",value:function(e){var t=e.deferred,n=e.collection;t.resolve(n)}},{key:"abortPendingAccumulation",value:function(){this.accumulateRequest&&(this.accumulateRequest.reject({cancel:!0}),this.accumulateRequest=null)}},{key:"getAccumulatedData",value:function(e){var t=this;t.abortPendingAccumulation(),t.dataCollection.reset(null,{silent:!0});var n=t.createListItemCollection(),i=u();e.collection=n,e.deferred=i,(t.accumulateRequest=i).done(function(){i===t.accumulateRequest&&(t.dataCollection.reset(n.models,{silent:!0}),t.triggerAccumulationComplete())}).always(function(){t.accumulateRequest=null}),t.accumulateData(e)}}]),e}();D.EVENTS=A;var N=["ht","tp"].join(""),x=/^on/,L={viewBox:!0},K={svg:!0,g:!0,path:!0,rect:!0,defs:!0,lineargradient:!0,stop:!0},z={fragment:!0},R=[],P=function(n,i,r){var s=!1;return R.forEach(function(e){var t=e(n,i,r);s=s||t}),s},U=function(e,t){var n;if(t)for(var i in t)if("ref"===i&&"function"==typeof t[i])t[i](e);else if(n=i,x.test(n))"string"!=typeof t[i]&&e.addEventListener(i.slice(2).toLowerCase(),t[i]);else if("style"===i&&"object"===babelHelpers.typeof(t[i]))Object.assign(e.style,t[i]);else if("className"===i)e.setAttribute("class",t[i]);else{if(P(i,e,t))continue;void 0!==t[i]&&(L[i]&&K[e.type.toLowerCase()]?e.setAttributeNS("",i,t[i]):e.setAttribute(i,t[i]))}};function F(e,t){for(var n=arguments.length,i=new Array(2<n?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return function n(e){var i;if(!e)return document.createComment("");if("string"==typeof e)return document.createTextNode(e);if("number"==typeof e)return document.createTextNode(String(e));if(e instanceof Node)return e;var t=(e.type||"").trim().toLowerCase();return K[t]?(t=(e.type||"").trim(),i=document.createElementNS("".concat(N,"://www.w3.org/2000/svg"),t),"svg"===t&&i.setAttributeNS("".concat(N,"://www.w3.org/2000/xmlns/"),"xmlns:xlink","".concat(N,"://www.w3.org/1999/xlink")),e.props&&U(i,e.props)):z[t]?i=document.createDocumentFragment():t&&(i=document.createElement(t),e.props&&U(i,e.props)),(e.children||[]).reduce(function(e,t){return e.concat(t)},[]).forEach(function(e){if(void 0!==e){var t=n(e);void 0!==t&&i.appendChild(t)}}),i}({type:e,props:t,children:i})}!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;"function"==typeof e&&R.push(e)}(function(e,t,n){return"dangerouslySetInnerHTML"===e&&(t.innerHTML=n[e],!0)});var B={SELECT:"select"},V=function(){function e(){babelHelpers.classCallCheck(this,e);this.dom=null,this.refs=null,this.state={},this.model=null}return babelHelpers.createClass(e,[{key:"destructor",value:function(){var e=this;$.events(e).off(),e.uninitializeDOM(),f(e),e.dom=null,e.refs=null,e.state=null,e.model=null}},{key:"getTemplate",value:function(){return F("div",{ref:"wrapper",className:"list-item"},F("span",{ref:"label",className:"label"}))}},{key:"focus",value:function(){var e=this;e.focusTimeoutID=setTimeout(function(){e._mounted&&($.element(e.refs.wrapper).focus(),e.refs.wrapper.scrollIntoView({behaviour:"smooth",block:"end"}))},0)}},{key:"getSelectionClassName",value:function(){return"selected"}},{key:"createDOM",value:function(){return this.dom=this.getTemplate(),this.dom}},{key:"createDOMRefs",value:function(){return this.refs=r(this.dom,!0),this.refs}},{key:"_preRender",value:function(e){var t=this,n=e.attributes;t.model=e,t.state.selected=n.selected||!1,t.dom?t.uninitializeDOM():(t.createDOM(),t.createDOMRefs())}},{key:"_postRender",value:function(){this.initializeDOM()}},{key:"render",value:function(e){var t=this,n=e.attributes;t._preRender(e);var i=t.getSelectionClassName();$.element(t.refs.label).text(n.text),t.state.selected?$.element(t.refs.wrapper).addClass(i):$.element(t.refs.wrapper).removeClass(i),t._postRender()}},{key:"_domMountHandler",value:function(){}},{key:"_handleSelectAction",value:function(e){$.events(this).triggerHandler(B.SELECT,{instance:this,event:e,isClickEvent:"click"===e.type})}},{key:"_clickHandler",value:function(e){this._handleSelectAction(e),e.stopPropagation()}},{key:"_keyDownHandler",value:function(e){var t=!0;(e.which||e.keyCode)===s.ENTER?this._handleSelectAction(e):t=!1,t&&(e.stopPropagation(),e.preventDefault())}},{key:"initializeDOM",value:function(){var e=this;e._clickHandler=e._clickHandler.bind(e),$.element(e.refs.wrapper).on("click",e._clickHandler),e._keyDownHandler=e._keyDownHandler.bind(e),$.element(e.refs.wrapper).on("keydown",e._keyDownHandler),e._domMountHandler=e._domMountHandler.bind(e),$.events(e).on(o.DOM_MOUNTED,e._domMountHandler)}},{key:"uninitializeDOM",value:function(){var e=this;clearTimeout(e.focusTimeoutID),$.element(e.refs.wrapper).off("click",e._clickHandler),$.element(e.refs.wrapper).off("keydown",e._keyDownHandler),$.events(e).off(o.DOM_MOUNTED,e._domMountHandler)}}]),e}();V.EVENTS=B;var j=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"createComponent",value:function(e){if(e instanceof w)return new V}}]),e}(),W={SELECT_NEXT:"selectNext",SELECT_PREVIOUS:"selectPrevious",ITEM_SELECTION:"itemSelection",ITEM_SELECTION_CURRENT:"itemSelectionCurrent",ITEM_FOCUSED:"itemFocused"},G=function(){function t(){babelHelpers.classCallCheck(this,t);var e=this;e.dom=null,e.refs=null,e.state={},e.listItemComponents=[],e.model=null,e.listItemComponentFactory=null,e.visible=!1,e.mouseDown=!1}return babelHelpers.createClass(t,[{key:"init",value:function(e){e=e||{},this.listItemComponentFactory=e.listItemComponentFactory}},{key:"destroy",value:function(){var e=this;$.events(e).off(),e.dom&&(e.uninitializeDOM(),f(e)),e.dom=null,e.refs=null,e.state=null,e.listItemComponents=null,e.model=null,e.listItemComponentFactory=null}},{key:"getTemplate",value:function(){return F("div",{ref:"wrapper",className:"auto-complete wrapper"},F("div",{ref:"listWrapper",className:"inner-wrapper"}))}},{key:"updateScrollIndicators",value:function(){var e=this,t=e.getScrollWrapperDOM(),n=t.getBoundingClientRect(),i=t.scrollHeight-n.height,r=0<t.scrollTop,s=t.scrollTop<i;r?$.element(e.refs.wrapper).addClass("top-scroll"):$.element(e.refs.wrapper).removeClass("top-scroll"),s?$.element(e.refs.wrapper).addClass("bottom-scroll"):$.element(e.refs.wrapper).removeClass("bottom-scroll")}},{key:"handleSelectAction",value:function(e,t){t=t||{},$.events(this).triggerHandler(W.ITEM_SELECTION,{listItemModel:e,isClickEvent:t.isClickEvent||!1})}},{key:"renderListItem",value:function(n,e){var i=this,t=null;return e=e||{},(t=i.listItemComponents.filter(function(e){return n===e.model})[0])||(t=i.listItemComponentFactory.createComponent(n),i.listItemComponents.push(t),$.events(t).on(V.EVENTS.SELECT,function(e,t){i.handleSelectAction(n,t)})),t.render(n,e),p(t,i.refs.listWrapper,{parentComponent:i}),e.modelChanged&&n.attributes.selected&&!e.disableSelectedItemFocus&&t.focus(),!e.batchRender&&n.attributes.selected&&$.events(i).triggerHandler(W.ITEM_FOCUSED,{component:t,model:n}),t}},{key:"createDOM",value:function(){return this.dom=this.getTemplate(),this.dom}},{key:"createDOMRefs",value:function(){return this.refs=r(this.dom,!0),this.refs}},{key:"_preRender",value:function(e){var t=this;t.model=e,t.dom?t.uninitializeDOM():(t.createDOM(),t.createDOMRefs())}},{key:"_postRender",value:function(){this.initializeDOM()}},{key:"renderListItems",value:function(e,n){var i=this,t=e.attributes;n=n||{};var r=t.listItems.models,s=null,o=null;n.batchRender=!0,r.forEach(function(e){var t=i.renderListItem(e,n);e.attributes.selected&&(s=t,o=e)}),s&&!n.disableSelectedItemFocus&&s.focus(),s&&$.events(i).triggerHandler(W.ITEM_FOCUSED,{component:s,model:o,isBatchRender:!0})}},{key:"render",value:function(e,t){t=t||{},this._preRender(e),this.renderListItems(e,t),this._postRender()}},{key:"focus",value:function(){var e=this;e.focusTimeoutID=setTimeout(function(){e._mounted&&$.element(e.refs.wrapper).focus()},0)}},{key:"selectNextListItem",value:function(){$.events(this).triggerHandler(W.SELECT_NEXT)}},{key:"selectPreviousListItem",value:function(){$.events(this).triggerHandler(W.SELECT_PREVIOUS)}},{key:"choseCurrentSelectedItem",value:function(){var e={};return $.events(this).triggerHandler(W.ITEM_SELECTION_CURRENT,e),!0===e.selection}},{key:"_domMountHandler",value:function(){this.listItemComponents.forEach(function(e){$.events(e).triggerHandler(o.DOM_MOUNTED)}),this.updateScrollIndicators()}},{key:"_keyDownHandler",value:function(e,t){t=t||{};var n=!0,i=!1,r=!1;switch(e.which||e.keyCode){case s.UP:this.selectPreviousListItem(),r=!1;break;case s.DOWN:this.selectNextListItem(),r=!1;break;case s.ENTER:i=this.choseCurrentSelectedItem(),e.ignoreKeyUp=!0,!i&&t.isProxyEvent&&(n=!1),r=!1;break;default:n=!1}return n&&(e.stopPropagation(),e.preventDefault()),r}},{key:"_listScrollHandler",value:function(){this&&this.dom&&this.updateScrollIndicators()}},{key:"_mouseDownHandler",value:function(){this.mouseDown=!0}},{key:"checkMouseDownFlag",value:function(){var e=this.mouseDown;return this.mouseDown=!1,e}},{key:"proxyKeyDownEvent",value:function(e){this._keyDownHandler(e,{isProxyEvent:!0})}},{key:"getScrollWrapperDOM",value:function(){return this.refs.listWrapper}},{key:"getViewPortBounds",value:function(){return v()}},{key:"handleListSpaceOverflow",value:function(e){}},{key:"positionComponent",value:function(e){var t,n=this;t=(e=e||{}).anchorBounds,$.element(n.dom).css({visibility:"hidden"}),$.element(n.dom).css({height:"auto"}),n.show();var i=g({dom:n.dom,anchorBounds:t,viewPortBounds:n.getViewPortBounds()});return i.overflow&&n.handleListSpaceOverflow({height:i.height}),n.updateScrollIndicators(),n.hide(),$.element(n.dom).css({visibility:"visible"}),i}},{key:"initializeDOM",value:function(){var e=this;e._keyDownHandler=e._keyDownHandler.bind(e),$.element(e.refs.wrapper).on("keydown",e._keyDownHandler),e._mouseDownHandler=e._mouseDownHandler.bind(e),$.element(e.refs.wrapper).on("mousedown",e._mouseDownHandler),e._listScrollHandler=c(e._listScrollHandler,200),e._listScrollHandler=e._listScrollHandler.bind(e);var t=e.getScrollWrapperDOM();$.element(t).on("scroll",e._listScrollHandler),e._domMountHandler=e._domMountHandler.bind(e),$.events(e).on(o.DOM_MOUNTED,e._domMountHandler)}},{key:"uninitializeDOM",value:function(){var e=this;clearTimeout(e.focusTimeoutID),$.element(e.refs.wrapper).off("keydown",e._keyDownHandler),$.element(e.refs.wrapper).off("mousedown",e._mouseDownHandler);var t=e.getScrollWrapperDOM();$.element(t).off("scroll",e._listScrollHandler),$.events(e).off(o.DOM_MOUNTED,e._domMountHandler),e.listItemComponents.forEach(function(e){e.destructor()}),e.listItemComponents=[]}},{key:"show",value:function(){this.visible=!0,$.events(this).triggerHandler("visibilityChange",{visible:!0})}},{key:"hide",value:function(){this.visible=!1,$.events(this).triggerHandler("visibilityChange",{visible:!1})}}]),t}();G.EVENTS=W;var q={ITEM_SELECTED:"itemSelected",ITEM_FOCUS_SELECTED:"itemFocusSelected"},Y=function(){function t(){babelHelpers.classCallCheck(this,t);var e=this;e._initialized=!1,e.userInput=null,e.trigger=null,e.searchTokenGetter=null,e.dataProviders=[],e.dataAccumulator=null,e.listItemComponentFactory=null,e.listModel=null,e.listComponent=null,e.parentDOM=null}return babelHelpers.createClass(t,[{key:"createUserInput",value:function(){return new y}},{key:"initUserInput",value:function(e){var t=e.inputElement;this.userInput=this.createUserInput(),this.userInput.init(t)}},{key:"createTrigger",value:function(){return new E}},{key:"initTrigger",value:function(){this.trigger=this.createTrigger(),this.trigger.init(this.userInput)}},{key:"createSearchTokenGetter",value:function(){return null}},{key:"initSearchTokenGetter",value:function(){this.searchTokenGetter=this.createSearchTokenGetter(),this.searchTokenGetter&&this.searchTokenGetter.init()}},{key:"createDataProviders",value:function(){return[]}},{key:"initDataProviders",value:function(){this.dataProviders=this.createDataProviders(),this.dataProviders.forEach(function(e){e.init()})}},{key:"createDataAccumulator",value:function(){return new D}},{key:"initDataAccumulator",value:function(){this.dataAccumulator=this.createDataAccumulator(),this.dataAccumulator.init()}},{key:"createListItemComponentFactory",value:function(){return new j}},{key:"initListItemComponentFactory",value:function(){this.listItemComponentFactory=this.createListItemComponentFactory(),this.listItemComponentFactory.init()}},{key:"createListModel",value:function(){return new I}},{key:"initListModel",value:function(){this.listModel=this.createListModel()}},{key:"createListComponent",value:function(){return new G}},{key:"initListComponent",value:function(){this.listComponent=this.createListComponent(),this.listComponent.init({listItemComponentFactory:this.listItemComponentFactory})}},{key:"init",value:function(e){var t=this;t._initialized||(e=e||{},t.initUserInput(e),t.initTrigger(),t.initSearchTokenGetter(),t.initDataProviders(),t.initDataAccumulator(),t.initListItemComponentFactory(),t.initListModel(),t.initListComponent(),t.parentDOM=e.parentDOM||document.body,t.bindEvents(),t._initialized=!0)}},{key:"destroy",value:function(){var e=this;e._initialized&&(e.unbindEvents(),e.userInput.destroy(),e.trigger.destroy(),e.searchTokenGetter&&e.searchTokenGetter.destroy(),e.dataProviders.forEach(function(e){e.destroy()}),e.dataAccumulator.destroy(),e.listItemComponentFactory.destroy(),e.listComponent.destroy(),e.userInput=null,e.trigger=null,e.searchTokenGetter=null,e.dataProviders=null,e.dataAccumulator=null,e.listItemComponentFactory=null,e.listModel=null,e.listComponent=null,e.parentDOM=null,e._initialized=!1)}},{key:"renderComponent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.listComponent.render(this.listModel,e)}},{key:"renderListItemComponent",value:function(e){this.listComponent.renderListItem(e,{modelChanged:!0})}},{key:"getSearchToken",value:function(e){var t=e.triggerInstance,n=this.searchTokenGetter;return n?n.getSearchToken({trigger:t}):null}},{key:"invokeDataProviderSearch",value:function(e){var t=e.searchToken,n=e.trigger,i=this.dataProviders;this.dataAccumulator.dataCollection.reset(null),this.listModel.resetData(),this.listModel.set({currentSearchKey:t,searchInProgress:!0},{silent:!0}),i.forEach(function(e){e.getData({searchToken:t,trigger:n})})}},{key:"handleTriggerAction",value:function(e){var t=(e=e||{}).triggerInstance,n=e.searchToken;n||(n=this.getSearchToken(e)),this.invokeDataProviderSearch({searchToken:n,trigger:t}),this.listModel.set({searchState:"progress"},{silent:!0})}},{key:"handleTriggerNegativeAction",value:function(e){this.cancelAutoComplete()}},{key:"listUpdateAction",value:function(e){var t=this.dataProviders.map(function(e){return e.dataCollection});this.listModel.set({searchState:"updated"},{silent:!0}),this.dataAccumulator.getAccumulatedData({collectionList:t})}},{key:"searchCompleteAction",value:function(e){this.listUpdateAction(e),this.listModel.set({searchState:"completed"},{silent:!0})}},{key:"showComponent",value:function(){this.dataAccumulator.dataCollection.length&&(this.listComponent.positionComponent({anchorBounds:this.userInput.getListAnchorBounds()}),this.listComponent.show())}},{key:"hideComponent",value:function(){this.listComponent.hide()}},{key:"cancelAutoComplete",value:function(){var e=this;e.hideComponent(),e.dataAccumulator.abortPendingAccumulation(),e.dataProviders.forEach(function(e){e.abortPendingSearch()}),e.dataAccumulator.dataCollection.reset(null),e.listModel.resetData(),e.renderComponent({type:"cancel"})}},{key:"isComponentVisible",value:function(){return!!this._initialized&&this.listComponent.visible}},{key:"isSearchPending",value:function(){return 0<this.dataProviders.filter(function(e){return!0!==e.searchComplete}).length}},{key:"accumulationCompleteAction",value:function(){var e=this,t=e.dataAccumulator.dataCollection;e.listModel.set({searchInProgress:!1},{silent:!0}),e.listModel.get("listItems").reset(t.models,{silent:!0}),e.renderComponent({type:"initial"}),p(e.listComponent,e.parentDOM),t.length?e.showComponent():e.hideComponent()}},{key:"listItemSelectAction",value:function(e){var t=e.listItemModel,n=this;$.events(n).triggerHandler(q.ITEM_SELECTED,{item:t}),setTimeout(function(){n.cancelAutoComplete()},0)}},{key:"listItemFocusSelectAction",value:function(e){var t=e.listItemModel;$.events(this).triggerHandler(q.ITEM_FOCUS_SELECTED,{item:t})}},{key:"_triggerActionHandler",value:function(e,t){t=t||{},this.handleTriggerAction(t)}},{key:"_triggerNegativeActionHandler",value:function(e,t){t=t||{},this.handleTriggerNegativeAction(t)}},{key:"_dataProviderSearchCompleteHandler",value:function(e,t){t=t||{},this.searchCompleteAction(t)}},{key:"_dataProviderListUpdateHandler",value:function(e,t){t=t||{},this.listUpdateAction(t)}},{key:"_dataAccumulationCompleteHandler",value:function(e,t){t=t||{},this.accumulationCompleteAction(t)}},{key:"_componentSelectNextHandler",value:function(e,t){this.listModel.selectNextItem();var n=this.listModel.getSelectedItem();n&&this.listItemFocusSelectAction({listItemModel:n})}},{key:"_componentSelectPreviousHandler",value:function(e,t){this.listModel.selectPreviousItem();var n=this.listModel.getSelectedItem();n&&this.listItemFocusSelectAction({listItemModel:n})}},{key:"_componentSelectItemHandler",value:function(e,t){var n=(t=t||{}).listItemModel;n&&(this.listModel.selectItem(n.attributes.id),this.listItemSelectAction(t),t.isClickEvent&&this.userInput.focus())}},{key:"_componentSelectCurrentItemHandler",value:function(e,t){t=t||{};var n=this.listModel.getSelectedItem();n?(t.selection=!0,this.listItemSelectAction({listItemModel:n})):t.selection=!1}},{key:"_modelListItemChangeHandler",value:function(e){this.renderListItemComponent(e)}},{key:"_modelChangeHandler",value:function(){this.renderComponent({type:"change"})}},{key:"_componentVisibilityChangeHandler",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};$.events(this).triggerHandler("listComponentVisibilityChange",t)}},{key:"bindEvents",value:function(){var t=this;t._triggerActionHandler=t._triggerActionHandler.bind(t),t._triggerNegativeActionHandler=t._triggerNegativeActionHandler.bind(t),$.events(t.trigger).on(E.EVENTS.TRIGGER,t._triggerActionHandler),$.events(t.trigger).on(E.EVENTS.TRIGGER_NEGATIVE,t._triggerNegativeActionHandler),t._dataProviderSearchCompleteHandler=t._dataProviderSearchCompleteHandler.bind(t),t._dataProviderListUpdateHandler=t._dataProviderListUpdateHandler.bind(t),t.dataProviders.forEach(function(e){$.events(e).on(O.EVENTS.LIST_UPDATE,t._dataProviderListUpdateHandler),$.events(e).on(O.EVENTS.SEARCH_COMPLETE,t._dataProviderSearchCompleteHandler)}),t._dataAccumulationCompleteHandler=t._dataAccumulationCompleteHandler.bind(t),$.events(t.dataAccumulator).on(D.EVENTS.ACCUMULATE_COMPLETE,t._dataAccumulationCompleteHandler),t._componentSelectPreviousHandler=t._componentSelectPreviousHandler.bind(t),$.events(t.listComponent).on(G.EVENTS.SELECT_PREVIOUS,t._componentSelectPreviousHandler),t._componentSelectNextHandler=t._componentSelectNextHandler.bind(t),$.events(t.listComponent).on(G.EVENTS.SELECT_NEXT,t._componentSelectNextHandler),t._componentSelectItemHandler=t._componentSelectItemHandler.bind(t),$.events(t.listComponent).on(G.EVENTS.ITEM_SELECTION,t._componentSelectItemHandler),t._componentSelectCurrentItemHandler=t._componentSelectCurrentItemHandler.bind(t),$.events(t.listComponent).on(G.EVENTS.ITEM_SELECTION_CURRENT,t._componentSelectCurrentItemHandler),t._modelChangeHandler=t._modelChangeHandler.bind(t),t.listModel.on("change",t._modelChangeHandler),t._modelListItemChangeHandler=t._modelListItemChangeHandler.bind(t),t.listModel.on(I.EVENTS.LIST_ITEM_CHANGE,t._modelListItemChangeHandler),t._componentVisibilityChangeHandler=t._componentVisibilityChangeHandler.bind(t),$.events(t.listComponent).on("visibilityChange",t._componentVisibilityChangeHandler)}},{key:"unbindEvents",value:function(){var t=this;$.events(t.trigger).off(E.EVENTS.TRIGGER,t._triggerActionHandler),$.events(t.trigger).off(E.EVENTS.TRIGGER_NEGATIVE,t._triggerNegativeActionHandler),t.dataProviders.forEach(function(e){$.events(e).off(O.EVENTS.LIST_UPDATE,t._dataProviderListUpdateHandler),$.events(e).off(O.EVENTS.SEARCH_COMPLETE,t._dataProviderSearchCompleteHandler)}),$.events(t.dataAccumulator).off(D.EVENTS.ACCUMULATE_COMPLETE,t._dataAccumulationCompleteHandler),$.events(t.listComponent).off(G.EVENTS.SELECT_PREVIOUS,t._componentSelectPreviousHandler),$.events(t.listComponent).off(G.EVENTS.SELECT_NEXT,t._componentSelectNextHandler),$.events(t.listComponent).off(G.EVENTS.ITEM_SELECTION,t._componentSelectItemHandler),$.events(t.listComponent).off(G.EVENTS.ITEM_SELECTION_CURRENT,t._componentSelectCurrentItemHandler),t.listModel.off("change",t._modelChangeHandler),t.listModel.off(I.EVENTS.LIST_ITEM_CHANGE,t._modelListItemChangeHandler),$.events(t.listComponent).off("visibilityChange",t._componentVisibilityChangeHandler)}}]),t}();Y.EVENTS=q;var X,Z,J=function(e,t){var n=e.value||"";n=n.substr(0,t);var i=/(?:(?=\s*)([\S]+[^\S\n]*)$)/i.exec(n);return i?i[1]:" "},Q=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=e.getBoundingClientRect(),i="".concat(n.width,"px"),r="".concat(n.height,"px");t.autoWidth&&(i="auto");var s,o,l,a=F("div",null),d=(l={},(s=e)&&"function"==typeof window.getComputedStyle&&(o=window.getComputedStyle(s),Array.prototype.forEach.apply(o,[function(e){l[e]=o[e]}])),l);return d=Object.assign(d,{position:"absolute",top:"0",left:"0",width:i,height:r,opacity:"0",margin:"0",pointerEvents:"none"}),d=Object.keys(d).map(function(e){return"".concat(e,": ").concat(d[e])}).join("; "),a.setAttribute("style",d),document.body.appendChild(a),a},ee=["input","keyup","cut","paste"],te=[s.UP,s.DOWN,s.LEFT,s.RIGHT],ne=[s.UP,s.DOWN,s.LEFT,s.RIGHT,s.ESC,s.SHIFT,s.CTRL,s.ALT,s.META,s.RIGHT_META],ie=function(e){var t=e;return!!te.includes(t)},re=function(e){var t=e;return!!ne.includes(t)},se=function(e){function n(){var e;babelHelpers.classCallCheck(this,n),e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));var t=babelHelpers.assertThisInitialized(e);return t.savedCursorPostion=null,t.keyUpIgnoreMap=null,e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"init",value:function(e){babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"init",this).call(this,e),this.keyUpIgnoreMap={}}},{key:"destroy",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"destroy",this).call(this),this.keyUpIgnoreMap=null}},{key:"_inputEventHandler",value:function(e){var t=this,n=t._element,i=e.keyCode||e.which;if("keyup"===e.type){if(re(i))return;if(t.keyUpIgnoreMap[i])return void(t.keyUpIgnoreMap[i]=!1)}$.events(t).triggerHandler("textchange",{element:n,source:t,event:e})}},{key:"_keyUpEventHandler",value:function(e){var t=this,n=t._element,i=e.keyCode||e.which,r=re(i);t.keyUpIgnoreMap[i]?t.keyUpIgnoreMap[i]=!1:$.events(t).triggerHandler("keyup",{element:n,source:t,event:e,isNonCharKey:r})}},{key:"_keyDownEventHandler",value:function(e){var t=this._element,n=e.keyCode||e.which,i=re(n),r=ie(n);$.events(this).triggerHandler("keydown",{element:t,source:this,event:e,isNonCharKey:i,isArrowKey:r}),e.ignoreKeyUp&&(this.keyUpIgnoreMap[n]=!0)}},{key:"_keyPressEventHandler",value:function(e){var t=this._element,n=e.keyCode||e.which,i=e.charCode||null,r=re(n),s=ie(n);this.keyUpIgnoreMap[n]||$.events(this).triggerHandler("keypress",{element:t,source:this,event:e,isNonCharKey:r,isArrowKey:s,charCode:i})}},{key:"_focusEventHandler",value:function(e){var t=this._element;$.events(this).triggerHandler("focus",{element:t,source:this,event:e})}},{key:"_blurEventHandler",value:function(e){var t=this._element;$.events(this).triggerHandler("blur",{element:t,source:this,event:e})}},{key:"bindEvents",value:function(){var e=this,t=e._element;e._inputEventHandler=e._inputEventHandler.bind(e),e._keyUpEventHandler=e._keyUpEventHandler.bind(e),e._keyDownEventHandler=e._keyDownEventHandler.bind(e),e._keyPressEventHandler=e._keyPressEventHandler.bind(e);var n=e._inputEventHandler,i=e._keyUpEventHandler,r=e._keyDownEventHandler;ee.forEach(function(e){$.element(t).on(e,n)}),$.element(t).on("keyup",i),$.element(t).on("keydown",r),$.element(t).on("keypress",e._keyPressEventHandler),e._focusEventHandler=e._focusEventHandler.bind(e),e._blurEventHandler=e._blurEventHandler.bind(e),$.element(t).on("focus",e._focusEventHandler),$.element(t).on("blur",e._blurEventHandler)}},{key:"unbindEvents",value:function(){var e=this,t=e._element,n=e._inputEventHandler,i=e._keyUpEventHandler,r=e._keyDownEventHandler,s=e._keyPressEventHandler;ee.forEach(function(e){$.element(t).off(e,n)}),$.element(t).off("keyup",i),$.element(t).off("keydown",r),$.element(t).off("keypress",s),$.element(t).off("focus",e._focusEventHandler),$.element(t).off("blur",e._blurEventHandler)}},{key:"getText",value:function(){return this._element.value}},{key:"setText",value:function(e){this._element.value=e}},{key:"getCursorPosition",value:function(){var e=this._element;return e.selectionStart!==e.selectionEnd?-1:e.selectionStart}},{key:"setCursorPosition",value:function(e){var t=this._element;t.selectionStart=e,t.selectionEnd=e}},{key:"saveCursorPosition",value:function(){this.savedCursorPostion=this.getCursorPosition()}},{key:"restoreCursorPosition",value:function(){null!==this.savedCursorPostion&&(this.setCursorPosition(this.savedCursorPostion),this.savedCursorPostion=null)}},{key:"focus",value:function(){this._element.focus()}},{key:"getListAnchorBounds",value:function(){var e=this._element,t=e.getBoundingClientRect(),n=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;var n,i,r,s=Q(e,t),o=e.value||"",l=(i=(n=e).selectionEnd,r=n.selectionStart,i||r||0),a=J(e,l),d=F("span",{className:"content-span"},o=(o=o.substring(0,l)).substr(0,o.length-a.length)),c=F("span",{className:"content-span-last-word"},a);s.appendChild(d),s.appendChild(c);var u=c.getBoundingClientRect();return s.parentNode.removeChild(s),s=null,u}(e);return{top:t.top+n.top,right:t.left+n.left+n.width,left:t.left+n.left,bottom:t.top+n.top+n.height,height:n.height,width:n.width}}},{key:"getCurrentTypingWord",value:function(){var e=this._element;return J(e,this.getCursorPosition())}},{key:"replaceContentBeforeCursor",value:function(e,t){var n=this._element;if(e){var i=this.getCursorPosition();if(-1!==i){var r=n.value,s=r.lastIndexOf(e,i);if(-1!==s)r=r.substring(0,s)+t+r.substring(s+e.length),n.value=r,i+=t.length-e.length,n.selectionStart=i,n.selectionEnd=i}}}}]),n}(y),oe=function(e){function n(){return babelHelpers.classCallCheck(this,n),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).apply(this,arguments))}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"createUserInput",value:function(){return new se}},{key:"inputFocusAction",value:function(){this.showComponent()}},{key:"inputBlurAction",value:function(e){var t=!1,n=e.event;this.listComponent.checkMouseDownFlag()||(this.cancelAutoComplete(),this.hideComponent(),t=!0),t||n.preventDefault()}},{key:"bodyMouseDownAction",value:function(e){if(e=e||{},this.isComponentVisible()){var t=!0,n=e.event.target,i=this.listComponent.dom,r=this.userInput._element;(n===i||i.contains(n))&&(t=!1),(n===r||r.contains(n))&&(t=!1),t&&this.hideComponent()}}},{key:"_inputFocusHandler",value:function(){this.inputFocusAction()}},{key:"_inputBlurHandler",value:function(e,t){this.inputBlurAction(t)}},{key:"_inputKeyDownHandler",value:function(e,t){var n=(t=t||{}).event;(n.which||n.keyCode)!==s.ESC?this.isComponentVisible()&&this.listComponent.proxyKeyDownEvent(n):this.cancelAutoComplete()}},{key:"_bodyMouseDownHandler",value:function(e){this.bodyMouseDownAction({event:e})}},{key:"bindEvents",value:function(){var e=this,t=e.userInput;babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"bindEvents",this).call(this),e._inputFocusHandler=e._inputFocusHandler.bind(e),$.events(t).on("focus",e._inputFocusHandler),e._inputBlurHandler=e._inputBlurHandler.bind(e),$.events(t).on("blur",e._inputBlurHandler),e._inputKeyDownHandler=e._inputKeyDownHandler.bind(e),$.events(t).on("keydown",e._inputKeyDownHandler),e._bodyMouseDownHandler=e._bodyMouseDownHandler.bind(e),$.element(document.body).on("mousedown",e._bodyMouseDownHandler)}},{key:"unbindEvents",value:function(){var e=this,t=e.userInput;babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"unbindEvents",this).call(this),$.events(t).off("focus",e._inputFocusHandler),$.events(t).off("blur",e._inputBlurHandler),$.events(t).off("keydown",e._inputKeyDownHandler),$.element(document.body).off("mousedown",e._bodyMouseDownHandler)}}]),n}(Y),le=function(){function e(){babelHelpers.classCallCheck(this,e);this._input=null}return babelHelpers.createClass(e,[{key:"init",value:function(e){if(!(e instanceof y))throw new Error("<input> argument should be instance of <AbstractInput>");this._input=e}},{key:"destroy",value:function(){this._input=null}},{key:"getSearchToken",value:function(){return this._input.getText()}}]),e}(),ae=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(se),de=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"init",value:function(e){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"init",this).call(this,e),this.checkAndInsertSingleTextNode()}},{key:"checkAndInsertSingleTextNode",value:function(){var e=window.getSelection(),t=e.anchorOffset,n=this._element;if(!n.childNodes.length){var i=n.textContent,r=document.createTextNode(i),s=document.createRange();n.appendChild(r),0===i.length&&(t=0),s.setStart(r,t),s.setEnd(r,t),e.removeAllRanges(),e.addRange(s)}}},{key:"_textChangeHandler",value:function(){this.checkAndInsertSingleTextNode()}},{key:"bindEvents",value:function(){var e=this;e._textChangeHandler=e._textChangeHandler.bind(e),e._textChangeHandler=a(e._textChangeHandler,100),$.events(e).on("textchange",e._textChangeHandler),babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"bindEvents",this).call(this)}},{key:"unbindEvents",value:function(){$.events(this).off("textchange",this._textChangeHandler),babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"unbindEvents",this).call(this)}},{key:"getSelectionRange",value:function(){var e,t;return e=window.getSelection(),t=document.createRange(),e.rangeCount?(t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.anchorNode,e.anchorOffset),t):null}},{key:"replaceContentBeforeCursor",value:function(e,t){var n=window.getSelection(),i=this.getSelectionRange(),r=i.startContainer,s=r.nodeValue,o=i.endOffset,l=s.lastIndexOf(e);-1!==l&&(s=s.substring(0,l)+t+s.substring(l+e.length),r.nodeValue=s,o+=t.length-e.length,i.setStart(i.startContainer,o),i.setEnd(i.startContainer,o),n.removeAllRanges(),n.addRange(i))}},{key:"replaceAndInsertContentAtCursor",value:function(e,t){var n=window.getSelection(),i=this.getSelectionRange(),r=i.startContainer,s=r.nodeValue,o=s.lastIndexOf(e);if(-1!==o&&t){var l=s.substring(0,o),a=s.substring(o+e.length)||" ";r.nodeValue=l;var d=r.parentNode;d.lastChild===r?d.appendChild(t):$.element(t).insertDOMBefore(r.nextSibling);var c=document.createTextNode(a);c.nodeValue=a,d.lastChild===t?d.appendChild(c):$.element(c).insertDOMBefore(t.nextSibling),i.setStartAfter(c),i.setEndAfter(c),n.removeAllRanges(),n.addRange(i)}}},{key:"getCurrentTypingWord",value:function(){var e=this._element,t=this.getSelectionRange(),n=t.startContainer,i=t.startOffset;return 3!==n.nodeType&&((!e.childNodes.length||1===e.childNodes.length&&3===e.childNodes[0].nodeType)&&this.checkAndInsertSingleTextNode(),n=e.childNodes[0]),m(n.nodeValue,i)}},{key:"getListAnchorBounds",value:function(){var e=this.getCurrentTypingWord(),t=this.getSelectionRange(),n=t.startOffset-e.length;return n<0&&(n=0),t.setStart(t.startContainer,n),t.getBoundingClientRect()}}]),t}(ae),ce=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(se),ue={time:600},he=_.noop||function(){},pe=function(e){return e.trim().toLowerCase()},fe=function(e){return _zm.stopEvents(e,!0)},me=function(e){zmUtil.scrollIntoView(e,ue)},ve={check:"msi-check",uncheck:"msi-uncheck",partial:"msi-partcheck"},ge="uncheck",Ce=_.noop=_.noop||function(){},ye=function(){function e(){babelHelpers.classCallCheck(this,e),this.__events={},this.trigger=this.trigger.bind(this),this.stopEvents=this.stopEvents.bind(this),this.listen=this.listen.bind(this)}return babelHelpers.createClass(e,[{key:"trigger",value:function(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return(this.__events[e]||[]).forEach(function(e,t,n){"function"==typeof e&&e(i)}),this}},{key:"listen",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ce,n=this.__events[e];return n&&n.indexOf(t)<0?n.push(t):!n&&e&&(this.__events[e]=[t]),this}},{key:"neglect",value:function(e,i){var r=this;return e.split(" ").forEach(function(e){var t=r.__events[e];if(t)if(i){var n=t.indexOf(i);-1<n&&t.splice(n,1)}else delete r.__events[e]}),this}},{key:"stopEvents",value:function(e){return e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),this}}]),e}(),_e=["enterKeyHandler","escKeyHandler","upArrowKeyHandler","downArrowKeyHandler","leftArrowKeyHandler","rightArrowKeyHandler","tabKeyHandler","handle"],be=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,t),_zm.autoBind(this,_e),this.SELECTION_CLASS=e.selClass||"sel",this.KEY_CODE={TAB:9,ENTER:13,ESC:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40},this.$list=e.$list||{},this.mouseHoverHandler=e.mouseHoverHandler,this.__$currentEl=this.__$prevEl=void 0,this.defaultAction=e.defaultAction||he,this.enterKeyAction=e.enterKeyAction||he,this.tabKeyAction=e.tabKeyAction||he}return babelHelpers.createClass(t,[{key:"isAllowed",value:function(e){return"keyup"!==e}},{key:"scrollCurrentElementIntoView",value:function(){return this.__$currentEl&&this.__$currentEl.length&&(this.mouseHoverHandler.unbind(),me(this.__$currentEl[0]),this.mouseHoverHandler.bind()),this}},{key:"addSelection",value:function(){return this.__$prevEl&&this.__$prevEl.removeClass(this.SELECTION_CLASS),this.__$currentEl&&this.__$currentEl.addClass(this.SELECTION_CLASS),this}},{key:"tabKeyHandler",value:function(e){return this.isAllowed(e.type)&&this.tabKeyAction(e),this}},{key:"enterKeyHandler",value:function(e){return this.isAllowed(e.type)&&this.enterKeyAction(e,this.__$currentEl,this.__$prevEl),this}},{key:"escKeyHandler",value:function(e){return this.isAllowed(e.type)&&(e.preventDefault(),zmUtil.hideMenu(!0)),this}},{key:"getMouseSelection",value:function(){return this.__$currentEl=this.$list.find("."+this.SELECTION_CLASS).eq(0),this.__$currentEl}},{key:"upArrowKeyHandler",value:function(e){return this.isAllowed(e.type)&&this.getMouseSelection()?(this.__$currentEl&&this.__$currentEl.length&&(this.__$prevEl=this.__$currentEl,this.__$currentEl=this.__$currentEl.prev(),this.__$currentEl.length||(this.__$currentEl=void 0)),this.addSelection().scrollCurrentElementIntoView()):this}},{key:"downArrowKeyHandler",value:function(e){return this.isAllowed(e.type)&&this.getMouseSelection()?(this.__$currentEl&&(this.__$prevEl=this.__$currentEl,this.__$currentEl=this.__$currentEl.next()),this.__$currentEl&&this.__$currentEl.length||(this.__$currentEl=$.e(this.$list).children().first()),this.addSelection().scrollCurrentElementIntoView()):this}},{key:"leftArrowKeyHandler",value:function(){return!1}},{key:"rightArrowKeyHandler",value:function(){return!1}},{key:"handle",value:function(e){var t=!0,n=e.type;if(!e.shiftKey){switch(e.which){case this.KEY_CODE.TAB:this.tabKeyHandler(e);break;case this.KEY_CODE.ENTER:this.enterKeyHandler(e);break;case this.KEY_CODE.ESC:this.escKeyHandler(e);break;case this.KEY_CODE.LEFT_ARROW:t=this.leftArrowKeyHandler(e);break;case this.KEY_CODE.UP_ARROW:this.upArrowKeyHandler(e);break;case this.KEY_CODE.RIGHT_ARROW:t=this.rightArrowKeyHandler(e);break;case this.KEY_CODE.DOWN_ARROW:this.downArrowKeyHandler(e);break;default:if("keydown"===n){t=!1;break}this.defaultAction(e)}t&&_zm.stopEvents(e)}}}]),t}(),Ee=["enterKeyHandler","escKeyHandler","tabKeyHandler","upArrowKeyHandler","downArrowKeyHandler"],ke=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,t),_zm.autoBind(this,Ee),this.SELECTION_CLASS=e.selClass||"sel",this.KEY_CODE={TAB:9,ENTER:13,ESC:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40},this.$list=e.$list||$.e(),this.__$currentEl=this.__$prevEl=void 0,this.enterKeyAction=e.enterKeyAction||he,this.tabKeyAction=e.tabKeyAction||he,this.isInitialised=!1}return babelHelpers.createClass(t,[{key:"scrollCurrentElementIntoView",value:function(){return this.__$currentEl&&this.__$currentEl.length&&me(this.__$currentEl[0]),this}},{key:"addSelection",value:function(){return this.__$prevEl&&this.__$prevEl.removeClass(this.SELECTION_CLASS),this.__$currentEl&&this.__$currentEl.addClass(this.SELECTION_CLASS),this}},{key:"tabKeyHandler",value:function(){this.tabKeyAction()}},{key:"enterKeyHandler",value:function(){return this.enterKeyAction(void 0,this.__$currentEl,this.__$prevEl),this}},{key:"escKeyHandler",value:function(){return zmUtil.hideMenu(!0),this}},{key:"upArrowKeyHandler",value:function(){return this.__$currentEl&&this.__$currentEl.length&&(this.__$prevEl=this.__$currentEl,this.__$currentEl=this.__$currentEl.prev(),this.__$currentEl.length||(this.__$currentEl=$.e(this.$list).children().last())),this.addSelection().scrollCurrentElementIntoView()}},{key:"downArrowKeyHandler",value:function(){return this.__$currentEl&&(this.__$prevEl=this.__$currentEl,this.__$currentEl=this.__$currentEl.next()),this.__$currentEl&&this.__$currentEl.length||(this.__$currentEl=$.e(this.$list).children().first()),this.addSelection().scrollCurrentElementIntoView()}},{key:"registerScope",value:function(){return this.curKeyScope="folder-label-component",zmComponent.keybindings.registerAll({scope:this.curKeyScope,allowDefaultScope:!1,shortcuts:[{scope:this.curKeyScope,uid:"flprevItem",keyStr:"upArrow",actions:[this.upArrowKeyHandler],preventDefault:!0},{scope:this.curKeyScope,uid:"flnextItem",keyStr:"downArrow",actions:[this.downArrowKeyHandler],preventDefault:!0},{scope:this.curKeyScope,uid:"flselectItem",keyStr:"enter",actions:[this.enterKeyHandler],preventDefault:!0},{scope:this.curKeyScope,uid:"flexit",keyStr:"esc",actions:[this.escKeyHandler],preventDefault:!0},{scope:this.curKeyScope,uid:"fltab",keyStr:"tab",actions:[this.tabKeyHandler],preventDefault:!0}]}),this}},{key:"deregisterScope",value:function(){var t=this;return["upArrow","downArrow","enter","esc","tab"].forEach(function(e){return zmComponent.keybindings.deregister(t.curKeyScope,e)}),this}},{key:"enableScope",value:function(){return this.prevScope=zmComponent.keybindings.getScope(),zmComponent.keybindings.setScope(this.curKeyScope),this}},{key:"disableScope",value:function(){return zmComponent.keybindings.dropScope(this.curKeyScope),this.prevScope&&zmComponent.keybindings.setScope(this.prevScope),this}},{key:"bindEvents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.registerScope(),e.enableScope||this.enableScope(),this.isInitialised=!0,this}},{key:"unbindEvents",value:function(){return this.isInitialised&&(this.disableScope().deregisterScope().isInitialised=!1),this}}]),t}(),He=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=$.e(e.$list),r=e.selClass||"sel",s=function(){"nohr"!==($.e(this).data("zmsData")||{}).type&&(i.find("li."+r).removeClass(r),$.e(this).addClass(r))},o=function(){$.e(this).removeClass(r)},l=function(e){e&&"function"==typeof e.stopPropagation&&e.stopPropagation()},t=function(e){var t,n;t=e,"nohr"!==((n=$.e(t.target).closest("li")).data("zmsData")||{}).type&&i.has(t.target).length&&(i.find("li."+r).removeClass(r),n.addClass(r)),i.on("mouseenter","li",s),i.on("mouseleave","li",o),i.on("mouseenter","div",l),i.on("mouseleave","div",l)},n=function(){i.off("mouseenter","li",s),i.off("mouseleave","li",o),i.off("mouseenter","div",l),i.off("mouseleave","div",l)};return{bind:function(){i.on("mousemove",t)},unbind:function(){n(),i.off("mousemove",n)}}},$e=zmText.get("folder-label-component"),we=["__itemClickHandler","__kbEnterKeyAction","scrollToItem","__onDOMMount","unbindEvents"],Te=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).model=t.data||[],e.refs={},e.SHOW_CREATE=t.showCreate,t.showSearch=void 0===t.showSearch||t.showSearch,e.SHOW_SEARCH=(5<e.model.length||e.SHOW_CREATE)&&t.showSearch,e.SEARCH_PLACEHOLDER=t.searchPlaceholder||"",e.EMPTY_MSG=t.emptyMsg||$e.emptyMsg,e.NO_RESULTS_MSG=t.noResultsMsg||$e.noMatches.replace("{{entityName}}",$e.entity.items),e.searchOn=t.search||"name",e.displayTextOn=t.display,e.onSelect=t.onSelect||he,e.onCreate=t.addNew||he,e.onTab=t.onTab||he,e.listContainerClassName="",_zm.autoBind(babelHelpers.assertThisInitialized(e),we),100<e.model.length?e.__kbDefaultAction=_.debounce(e.__kbDefaultAction.bind(babelHelpers.assertThisInitialized(e)),300):e.__kbDefaultAction=e.__kbDefaultAction.bind(babelHelpers.assertThisInitialized(e)),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"getFragment",value:function(){return $.e(document.createDocumentFragment())}},{key:"getSearchDOM",value:function(){return this.SHOW_SEARCH?zdom("div",{className:"zmDDSearch",ref:"search","data-disableshortcuts":"true"},zdom("input",{type:"text",ref:"searchInput","data-disableshortcuts":"true",placeholder:this.SEARCH_PLACEHOLDER})):void 0}},{key:"getCreateDOM",value:function(e){var t=e.name;return zdom("li",{className:"js-item","data-id":"create"},zdom("font",{className:"SC_thm"},$e.create),zdom("font",null,t))}},{key:"getHiglightedDOM",value:function(e){var t=e.prefix,n=e.matchedTxt,i=e.suffix;return n=n?zdom("font",{className:"afHgl"},n):void 0,zdom("fragment",null,t,n,i)}},{key:"getListItemDOM",value:function(e){var t=e.content,n=e.tooltip,i=e.id,r=e.className;return zdom("li",{className:(r||"")+" js-item","data-id":i,title:n},t)}},{key:"getEmptyMsgDOM",value:function(e){var t=e.partialRender;return zdom("div",{className:"zmInfoWarnMsg"},void 0!==t&&t?this.NO_RESULTS_MSG:this.EMPTY_MSG)}},{key:"getTemplate",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return zdom("div",{className:"js-container",ref:"container"},this.getSearchDOM(e),zdom("div",{className:"zmDDScroll js-scrolldiv"},zdom("ul",{className:(this.listContainerClassName||"")+" js-list-container",ref:"list"})))}},{key:"getContentDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e[this.displayTextOn]||e.display_text||e.name}},{key:"constructListItem",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.getListItemDOM($.extend({},e,{tooltip:e.tooltip||e.name,content:this.getContentDOM(e,t)}),t)}},{key:"match",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=!1,n=this.model,i=0,r=n.length,s=[];r;){var o=!1,l=n[i],a={},d=l[this.searchOn]||l.tooltip||l.name||l.display_text||"",c=l[this.displayTextOn]||l.display_text||l.name||l.tooltip||"",u=pe(e),h=pe(d);if(u===h)o=t=!0,a={orgTxt:c,matchedTxt:d};else{var p=zmUtil.UnicodeUtils.indexOf(h,u);if(-1<p){o=!0;var f=p+zmUtil.UnicodeUtils.length(u),m=-1<zmUtil.UnicodeUtils.indexOf(pe(c),u)?c:d;a={orgTxt:m,prefix:zmUtil.UnicodeUtils.substring(m,0,p),matchedTxt:zmUtil.UnicodeUtils.substring(m,p,f),suffix:zmUtil.UnicodeUtils.substring(m,f)}}else delete l.__highlightInfo}o&&(l.__highlightInfo=a,s.push(l)),--r,++i}return{txt:e,model:s,exactMatch:t}}},{key:"constructList",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.model,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=this.getFragment(),r=0,s=e.length;s;){var o=e[r],l=this.constructListItem(o,n);i.appendDOM(l),$.e(l).data("zmsData",o),--s,++r}if(this.$emptyMsg&&this.$emptyMsg.remove(),$.e(this.refs.list).appendDOM(i),t&&this.SHOW_CREATE){var a=$.e(this.getCreateDOM({name:n.txt}));a.data("zmsData",{type:"addnew"}),$.e(this.refs.list).appendDOM(a)}else e.length||(this.$emptyMsg=$.e(this.getEmptyMsgDOM(n)),$.e(this.refs.list).appendDOM(this.$emptyMsg));return this.refs.list}},{key:"__preRender",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.unbindEvents(e),this.refs.list&&$.e(this.refs.list).clearHTML(),this}},{key:"render",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.__preRender(e),e.partialRender||(this.$el=$.e(this.getTemplate()),this.refs=zmail.Utils.DOM.getRefs(this.$el[0],!0)||{}),this.constructList(e.list,e.showCreate,e),this.__postRender(e),this.$el[0]}},{key:"__selectIfItemIsTheOnlyOne",value:function(){var e=$.e(this.refs.list).find(".js-item:visible");return 1===e.length&&e.eq(0).addClass("sel"),this}},{key:"__postRender",value:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.bindEvents({}),this.__selectIfItemIsTheOnlyOne(),this}},{key:"selectionHandler",value:function(e){if(e){var t=String(e.data("id"));if("create"===t)this.onCreate(e[0],String($.e(this.refs.searchInput).val()));else if(this.idMap)this.onSelect(this.idMap[t]);else{for(var n,i=this.model,r=0,s=i.length;s&&(n=i[r],String(n.id)!==t);)--s,++r;this.onSelect(n)}return this}}},{key:"__itemClickHandler",value:function(e){fe(e);var t=$.e(e.target).closest(".js-item").eq(0);return this.selectionHandler(t),this}},{key:"__kbDefaultAction",value:function(){var e=String($.e(this.refs.searchInput).val()).trim(),t=this.match(e)||[];this.render({partialRender:!0,initPage:0===e.length,showCreate:!t.exactMatch&&0<e.length,exactMatch:t.exactMatch,list:t.model,txt:t.txt})}},{key:"__kbEnterKeyAction",value:function(e,t,n){fe(e);var i=1===$.e(this.refs.list).find(".js-item:visible").length;!t&&i&&(t=$.e(this.refs.list).find(".js-item"),this.keyboardHandler&&(this.keyboardHandler.__$currentEl=t,this.keyboardHandler.addSelection())),this.selectionHandler(t)}},{key:"focusSearchInput",value:function(){var e=this;return this.refs.searchInput&&setTimeout(function(){return e.refs.searchInput.focus()}),this}},{key:"__onDOMMount",value:function(){this.focusSearchInput(),this.keyboardHandler instanceof ke&&this.keyboardHandler.enableScope()}},{key:"bindEvents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.refs.list&&($.e(this.refs.list).on("mouseup click",fe).on("mousedown",this.__itemClickHandler),e.disableMouseBind||(this.mouseHoverHandler=new He({$list:this.refs.list}),this.mouseHoverHandler.bind()));return this.refs.searchInput&&!e.disableKeyboardInit?(this.keyboardHandler=new be({mouseHoverHandler:this.mouseHoverHandler,$list:$.e(this.refs.list),defaultAction:this.__kbDefaultAction,enterKeyAction:this.__kbEnterKeyAction,tabKeyAction:this.onTab}),$.e(this.refs.searchInput).on("keydown keyup",this.keyboardHandler.handle)):this.SHOW_SEARCH||e.disableKeyboardInit||(this.keyboardHandler=new ke({$list:$.e(this.refs.list),enterKeyAction:this.__kbEnterKeyAction}),this.keyboardHandler.bindEvents({enableScope:!1})),this.listen("DOMMounted",this.__onDOMMount),this.listen("DOMUnmounted",this.unbindEvents),this}},{key:"unbindEvents",value:function(){return this.refs.list&&($.e(this.refs.list).off("mouseup click",fe).off("mousedown",this.__itemClickHandler),this.mouseHoverHandler&&(this.mouseHoverHandler.unbind(),this.mouseHoverHandler=void 0)),this.refs.searchInput&&this.keyboardHandler?($.e(this.refs.searchInput).off("keydown keyup",this.keyboardHandler.handle),this.keyboardHandler=void 0):!this.SHOW_SEARCH&&this.keyboardHandler&&(this.keyboardHandler.unbindEvents(),this.keyboardHandler=void 0),this.neglect("DOMMounted"),this.neglect("DOMUnmounted"),this}},{key:"scrollToItem",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e&&this.refs.list){var n=$.e(this.refs.list).find('[data-id="'.concat(e,'"]'));n.length&&(me(n),t&&n.addClass("sel"))}}}]),n}(ye),Se=zmText.get("folder-label-component"),Ie=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).NO_RESULTS_MSG=t.noResultsMsg||Se.noMatches.replace("{{entityName}}",Se.entity.folders),e.displayTextOn="name",e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"getContentDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=function(e,t){if(e&&t){var n="",i=t.toLowerCase().lastIndexOf(e.toLowerCase());return 0<i&&(n+=t.substring(0,i)),n}}(t,e.tooltip);return e.__highlightInfo&&(t=e.__highlightInfo.orgTxt===t?this.getHiglightedDOM(e.__highlightInfo):t,n=e.__highlightInfo.orgTxt===e.tooltip?this.getHiglightedDOM(e.__highlightInfo):n),zdom("fragment",null,t,zdom("div",{className:"greyText"},n))}},{key:"match",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return this.searchOn=-1<zmUtil.UnicodeUtils.indexOf(e,"/")?"tooltip":"name",babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"match",this).call(this,e)}}]),n}(Te),Me=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).listContainerClassName="zmListReset",e.parseData(),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"parseData",value:function(){for(var e=this.model,t=e.length,n=0,i=[],r=[],s=[];t;){var o=e[n];"check"===o.type?i.push(o):o.type===ge?r.push(o):s.push(o),--t,++n}this.model=i.concat(s,r)}},{key:"getContentDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.type=e.type||ge;var t=e.name||e[this.displayTextOn],n=ve[e.type];return e.__highlightInfo&&(t=e.__highlightInfo.orgTxt===t?this.getHiglightedDOM(e.__highlightInfo):t),zdom("fragment",null,zdom("i",{className:n}),t)}},{key:"constructListItem",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.chkboxState=e.chkboxState||this.updateCheckbox.bind(this),babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"constructListItem",this).call(this,e,t)}},{key:"updateCheckbox",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ge;if(e.type=t,this.refs.list){var n=$.e(this.refs.list).find("[data-id='"+e.id+"']").find("i");n&&n.removeClass().addClass(ve[t])}}}]),n}(Te),Oe=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t)),_zm.autoBind(babelHelpers.assertThisInitialized(e),["upArrowKeyHandler","downArrowKeyHandler"]),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"upArrowKeyHandler",value:function(e){if(this.isAllowed(e.type)&&this.getMouseSelection()){if(this.__$currentEl&&this.__$currentEl.length){this.__$prevEl=this.__$currentEl;var t=this.__$currentEl.closest('[data-id="color-container"]');this.__$currentEl=this.__$currentEl.prev(),t&&!this.__$currentEl.length?this.__$currentEl=this.__$prevEl.closest("[data-id='nohr']").prev():this.__$currentEl.length||(this.__$currentEl=void 0)}return this.addSelection().scrollCurrentElementIntoView()}return this}},{key:"downArrowKeyHandler",value:function(e){return this.isAllowed(e.type)&&this.getMouseSelection()?(this.__$currentEl&&(this.__$prevEl=this.__$currentEl,this.__$currentEl=this.__$currentEl.next()),this.__$currentEl&&this.__$currentEl.length?"nohr"===this.__$currentEl.data("id")&&(this.__$currentEl=this.__$currentEl.find("[data-id='color-container']").children().first()):this.__$currentEl=$.e(this.$list).children().first(),this.addSelection().scrollCurrentElementIntoView()):this}}]),n}(be),Ae=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t)),_zm.autoBind(babelHelpers.assertThisInitialized(e),["upArrowKeyHandler","downArrowKeyHandler"]),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"upArrowKeyHandler",value:function(){if(this.__$currentEl&&this.__$currentEl.length){this.__$prevEl=this.__$currentEl;var e=this.__$currentEl.closest('[data-id="color-container"]');this.__$currentEl=this.__$currentEl.prev(),e&&!this.__$currentEl.length?this.__$currentEl=this.__$prevEl.closest("[data-id='nohr']").prev():this.__$currentEl.length||(this.__$currentEl=void 0)}return this.addSelection().scrollCurrentElementIntoView()}},{key:"downArrowKeyHandler",value:function(){return this.__$currentEl&&(this.__$prevEl=this.__$currentEl,this.__$currentEl=this.__$currentEl.next()),this.__$currentEl&&this.__$currentEl.length?"nohr"===this.__$currentEl.data("id")&&(this.__$currentEl=this.__$currentEl.find("[data-id='color-container']").children().first()):this.__$currentEl=$.e(this.$list).children().first(),this.addSelection().scrollCurrentElementIntoView()}}]),n}(ke),De=zmText.get("folder-label-component"),Ne="sel",xe={HEIGHT:{height:"95px"},ADD_NEW_LABEL_ROW_UL:{margin:"0 !important"},ADD_NEW_LABEL_ROW_LI:{padding:"0"},INLINE_BLOCK:{display:"inline-block"}},Le=["#e5e5e5","#f9baab","#f9d3a2","#fef86a","#d7f3b0","#c8e5fb","#e0ceef","#f6d0e6","#c4c4c4","#e07861","#ecb772","#f6e565","#badf88","#96ccf5","#b99fce","#e099c2","#808080","#ce232c","#dd902f","#d0c04b","#90ca40","#70abec","#a97ac6","#c26a9d","#000000","#9d1812","#a56016","#a69646","#5b8828","#4c76a2","#8343a0","#ba3682"],Ke=function(e){function o(){var n,e,t,i,r,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,o),(n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(o).call(this,s))).showCheckbox=!0,n.NO_RESULTS_MSG=s.noResultsMsg||De.noMatches.replace("{{entityName}}",De.entity.labels),n.listContainerClassName="zmListReset",n.colorCode=(e=Math.ceil(0),t=Le.length,i=Math.floor(t-1),0<=(r=Math.floor(Math.random()*(i-e+1))+e)&&r<=t-1?Le[r]:Le[0]),n.__colorPaletteHandler=n.__colorPaletteHandler.bind(babelHelpers.assertThisInitialized(n)),n.onCreate=function(e,t){s.addNew(e,t,{clrCode:n.colorCode})},100<n.model.length?n.__kbDefaultAction=_.debounce(n.__kbDefaultAction.bind(babelHelpers.assertThisInitialized(n)),300):n.__kbDefaultAction=n.__kbDefaultAction.bind(babelHelpers.assertThisInitialized(n)),n.__kbEnterKeyAction=n.__kbEnterKeyAction.bind(babelHelpers.assertThisInitialized(n)),n}return babelHelpers.inherits(o,e),babelHelpers.createClass(o,[{key:"getColorCodeRows",value:function(e){for(var t=this.getFragment(),n=0,i=Le.length;i;){var r=Le[n];t.appendDOM(zdom("div",{className:r===e?Ne:"",style:{"background-color":r},"data-clrcode":r})),--i,++n}return t[0]}},{key:"getCreateDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"getCreateDOM",this).call(this,{name:e.name}),n=e.colorCode||this.colorCode,i={"background-color":n};$.e(zdom("i",{className:"msi-uncheck zmLabelBox","data-id":"clrBx",style:i})).insertDOMAfter($.e(t).children().first());var r=this.getColorCodeRows(n);return zdom("fragment",null,t,zdom("li",{className:"nohr","data-id":"nohr",style:xe.HEIGHT},zdom("div",{"data-id":"clrPal"},zdom("ul",{className:"SC_cp",style:xe.ADD_NEW_LABEL_ROW_UL},zdom("li",{className:"js-no-sel","data-id":"color-container",style:xe.ADD_NEW_LABEL_ROW_LI},r)))))}},{key:"getContentDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.type=e.type||ge;var t=e.name||e[this.displayTextOn],n=ve[e.type],i={"background-color":e.color||"#cceeff"};return e.__highlightInfo&&(t=e.__highlightInfo.orgTxt===t?this.getHiglightedDOM(e.__highlightInfo):t),zdom("fragment",null,zdom("i",{className:"zmLabelBox "+n,style:i}),t)}},{key:"constructListItem",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.chkboxState=e.chkboxState||this.updateLabelCheckbox.bind(this),babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"constructListItem",this).call(this,e,t)}},{key:"updateLabelCheckbox",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ge;if(e.type=t,this.refs.list){var n=$.e(this.refs.list).find("[data-id='"+e.id+"']").find("i");n&&n.removeClass().addClass("zmLabelBox "+ve[t])}}},{key:"__colorPaletteHandler",value:function(e){fe(e);var t=$.e(e.target||e.srcElement),n=t.attr("data-clrcode"),i=t.closest("[data-id='clrPal'"),r=t.closest('[data-id="nohr"]').eq(0).prev().find("[data-id='clrBx']");i.find(".sel").removeClass(Ne).removeClass("black"),t.addClass(Ne),"#000000"===n&&t.addClass("black"),r.attr("data-clrcode",n).css("background-color",n),this.colorCode=n}},{key:"__kbDefaultAction",value:function(){var e=String($.e(this.refs.searchInput).val()),t=this.match(e)||[];this.render({partialRender:!0,initPage:0===e.length,showCreate:!t.exactMatch&&0<e.length,exactMatch:t.exactMatch,list:t.model,txt:t.txt})}},{key:"__kbEnterKeyAction",value:function(e,t){fe(e);var n=1===$.e(this.refs.list).find(".js-item:visible").length;!t&&n&&(t=$.e(this.refs.list).find(".js-item"),this.keyboardHandler&&(this.keyboardHandler.__$currentEl=t,this.keyboardHandler.addSelection())),this.selectionHandler(t)}},{key:"bindEvents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"bindEvents",this).call(this,$.extend({},e,{disableKeyboardInit:!0}));var t=$.e(this.refs.list);return t.length&&t.find("[data-id='clrPal']").length&&t.find("[data-id='clrPal']").eq(0).off("mousedown mouseup click").on("mousedown",this.__colorPaletteHandler).on("mouseup click",fe),this.refs.searchInput&&!e.disableKeyboardInit?(this.keyboardHandler=new Oe({mouseHoverHandler:this.mouseHoverHandler,$list:t,defaultAction:this.__kbDefaultAction,enterKeyAction:this.__kbEnterKeyAction,tabKeyAction:this.onTab}),$.e(this.refs.searchInput).off("keydown keyup").on("keydown keyup",this.keyboardHandler.handle)):this.SHOW_SEARCH||e.disableKeyboardInit||(this.keyboardHandler=new Ae({$list:t,enterKeyAction:this.__kbEnterKeyAction,tabKeyAction:this.onTab}),this.keyboardHandler.bindEvents({enableScope:!1})),this}},{key:"unbindEvents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"unbindEvents",this).call(this,e),this.refs.list&&$.e(this.refs.list).find("[data-id='clrPal']").length&&$.e(this.refs.list).find("[data-id='clrPal']").eq(0).off("mousedown",this.__colorPaletteHandler).off("mouseup click",fe),this}}]),o}(Me),ze=zmText.get("folder-label-component"),Re=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).NO_RESULTS_MSG=t.noResultsMsg||ze.noMatches.replace("{{entityName}}",ze.entity.groups),e.listContainerClassName="SC_Pr zmGUC",e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"getContentDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.logo||e.photo,n=e.avatar||zdom("img",{src:t}),i=e.count?zdom("b",null,e.name):e.name,r=e.count?zdom("b",null,e.count):e.count||"";return zdom("fragment",null,zdom("div",null,i),n,zdom("span",{className:"zmGUrCount"},r))}}]),n}(Te),Pe=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=$.e(e.$list),r=e.selClass||"sel",s=function(){"nohr"!==($.e(this).data("zmsData")||{}).type&&(i.find("div."+r).removeClass(r),$.e(this).addClass(r))},o=function(){$.e(this).removeClass(r)},l=function(e){e&&"function"==typeof e.stopPropagation&&e.stopPropagation()},t=function(e){var t,n;t=e,"nohr"!==((n=$.e(t.target).closest("div.js-item")).data("zmsData")||{}).type&&i.has(t.target).length&&(i.find("div."+r).removeClass(r),n.addClass(r)),i.on("mouseenter","div.js-item",s),i.on("mouseleave","div.js-item",o),i.on("mouseenter","div.js-list-container",l),i.on("mouseleave","div.js-list-container",l)},n=function(){i.off("mouseenter","div.js-item",s),i.off("mouseleave","div.js-item",o),i.off("mouseenter","div.js-list-container",l),i.off("mouseleave","div.js-list-container",l)};return{bind:function(){i.on("mousemove",t)},unbind:function(){n(),i.off("mousemove",n)}}},Ue=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t)),_zm.autoBind(babelHelpers.assertThisInitialized(e),["handle"]),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"enterKeyHandler",value:function(e,t){return this.isAllowed(e.type)&&this.enterKeyAction(e,t),this}},{key:"handle",value:function(e){var t=!0,n=$.e(e.target).val();switch(e.which){case this.KEY_CODE.ENTER:this.enterKeyHandler(e,n);break;case this.KEY_CODE.ESC:this.escKeyHandler(e,n);break;default:t=!1}return t&&_zm.stopEvents(e),this}}]),n}(be),Fe=["upArrowKeyHandler","downArrowKeyHandler","leftArrowKeyHandler","rightArrowKeyHandler"],Be=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t))).itemSelector=t.itemSelector||".js-folder",e.expandOrCollapseChild=t.expandOrCollapseChild||he,e.$listItems=e.$list.find(".js-item"),e.curIndex=0,e.prevIndex=0,_zm.autoBind(babelHelpers.assertThisInitialized(e),Fe),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"scrollCurrentElementIntoView",value:function(){return this.__$currentEl&&this.__$currentEl.length&&(this.mouseHoverHandler.unbind(),me(this.getName(this.__$currentEl)[0]),this.mouseHoverHandler.bind()),this}},{key:"addSelection",value:function(){return this.__$prevEl&&this.__$prevEl.length&&this.getName(this.__$prevEl).removeClass(this.SELECTION_CLASS),this.$list.find(".".concat(this.SELECTION_CLASS)).removeClass(this.SELECTION_CLASS),this.__$currentEl&&this.__$currentEl.length&&this.getName(this.__$currentEl).addClass(this.SELECTION_CLASS),this}},{key:"getName",value:function(e){return e.find(this.itemSelector).addBack(this.itemSelector).eq(0)}},{key:"isFirstChild",value:function(e){return e.parent().children().first().is(e)}},{key:"isLastChild",value:function(e){return e.parent().children().last().is(e)}},{key:"upArrowKeyHandler",value:function(e){if(this.isAllowed(e.type)){if(this.__$currentEl&&this.__$currentEl.length){for(this.__$prevEl=this.__$currentEl,this.prevIndex=this.curIndex,this.curIndex=this.curIndex<=0?this.$listItems.length:this.curIndex;--this.curIndex,this.__$currentEl=this.$listItems.eq(this.curIndex),!this.__$currentEl.is(":visible")&&-1<this.curIndex;);this.__$currentEl.length||(this.__$currentEl=void 0)}else this.curIndex=0,this.prevIndex=0;return this.addSelection().scrollCurrentElementIntoView()}return this}},{key:"downArrowKeyHandler",value:function(e){if(this.isAllowed(e.type)){if(this.__$currentEl&&this.__$currentEl.length){for(this.__$prevEl=this.__$currentEl,this.prevIndex=this.curIndex,this.curIndex=this.curIndex>=this.$listItems.length?0:this.curIndex;++this.curIndex,this.__$currentEl=this.$listItems.eq(this.curIndex),!this.__$currentEl.is(":visible")&&this.curIndex<this.$listItems.length;);this.__$currentEl.length||(this.__$currentEl=void 0)}else this.__$currentEl=this.$listItems.eq(0),this.curIndex=0,this.prevIndex=0;return this.addSelection().scrollCurrentElementIntoView()}return this}},{key:"leftArrowKeyHandler",value:function(e){return this.isAllowed(e.type)&&this.__$currentEl&&this.__$currentEl.length&&(this.__$currentEl.attr("aria-state","collapse"),this.expandOrCollapseChild(this.__$currentEl,void 0,!1)),!1}},{key:"rightArrowKeyHandler",value:function(e){return this.isAllowed(e.type)&&this.__$currentEl&&this.__$currentEl.length&&(this.__$currentEl.attr("aria-state","expand"),this.expandOrCollapseChild(this.__$currentEl,void 0,!0)),!1}},{key:"reset",value:function(){return this.__$prevEl&&this.__$prevEl.length&&this.getName(this.__$prevEl).removeClass(this.SELECTION_CLASS),this.$list.find(".".concat(this.SELECTION_CLASS)).removeClass(this.SELECTION_CLASS),this.__$currentEl&&this.__$currentEl.length&&this.getName(this.__$currentEl).removeClass(this.SELECTION_CLASS),this.__$currentEl=this.__$prevEl=void 0,this}},{key:"resetListItems",value:function(){this.$listItems=this.$list.find(".js-item:visible")}}]),n}(be),Ve=zmText.get("folder-label-component"),je={HIDE:{display:"none"}},We=["__toggleHandler","__addHandler","__itemClickHandler","__expandCollapseFoldersHandler","__kbExpandOrCollapseChild","__kbEnterKeyAction"],Ge=function(e){return e/parseInt($.q("html").css("font-size"))+"rem"},qe=function(e){return"input"===e.nodeName.toLowerCase()||$.e(e).hasClass("js-addInput")||$.e(e).closest(".js-add-menu").length},Ye=function(e,t){e=$.e(e),(t=$.e(t)).insertDOMBefore(e),e.remove()},Xe=(X="folderCompExpandAllFolders",{getValue:function(){return zmAdHocSettings.getWhatsNewVersion()[X]||!1},setValue:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=zmAdHocSettings.getWhatsNewVersion();return t[X]=e,zmAdHocSettings.setWhatsNewVersion(t)}}),Ze=function(e){function n(){var e,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,n),(e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,i))).listContainerClassName="zmFolderMenuDD",e.addClickedID=void 0,e.prevClickedID=void 0,e.parentMap=i.parentMap||{},e.rootMap=i.rootMap||{},e.idMap=i.idMap||{},e.elMap={},e.expandStates={},e.childElementMap={},e.SEARCH_PLACEHOLDER=i.searchPlaceholder||Ve.searchPlaceholder,e.SUBFOLDER_PLACEHOLDER=i.subFolderInputPlaceHolder||Ve.subfolderName,e.onCreate=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};i.addNew(e,t,{parentId:n.id,parentObj:n})},e.inputStates={},e.$create=void 0,e.expandAllFolders=Xe.getValue(),e.__intialRender=!1,_zm.autoBind(babelHelpers.assertThisInitialized(e),We),e.__kbDefaultAction=_.debounce(e.__kbDefaultAction.bind(babelHelpers.assertThisInitialized(e)),300),e}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"setPaddingLeft",value:function(e){var t=e.level,n=e.id,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(0<t&&!i){var r=this.elMap[n];this.parentMap[n]?($.e(r.arrow).css("padding-left",Ge(15*t)),$.e(r.name).css("padding-left",Ge(5))):$.e(r.name).css("padding-left",Ge(25+15*t))}else 0<t&&i?$.e(this.refs.addInputContainer).css("padding-left",Ge(25+15*(t+1))):$.e(this.refs.addInputContainer).css("padding-left");return this}},{key:"getSearchDOM",value:function(){return this.SHOW_SEARCH?zdom("div",{ref:"search",className:"SC_floatLabel zmIconLabel zmFolderSearch flBoxF","data-disableshortcuts":"true"},zdom("i",{className:"msi-search"}),zdom("input",{type:"text",ref:"searchInput","data-disableshortcuts":"true",placeholder:this.SEARCH_PLACEHOLDER||""})):void 0}},{key:"getCreateDOM",value:function(e){var t=e.name;return zdom("div",{className:"zmFolderMenu js-item","data-id":"create"},zdom("div",{className:"zmFolderMenuCreate"},Ve.create," ",zdom("span",{className:"zmThmClr"},t)))}},{key:"getListItemDOM",value:function(e,t){var n=e.content,i=e.className,r=void 0===i?"":i,s=e.id,o=e.pid,l=void 0===o?"-1":o,a=t.openClass,d=void 0===a?"":a,c=t.ariaState,u=void 0===c?"collapse":c,h=t.display;return zdom("div",{className:r+" zmFolderMenu js-item "+d,"data-pid":l,"data-id":s,"aria-state":u,ref:"item",style:void 0!==h&&h?void 0:je.HIDE},n)}},{key:"getNameContent",value:function(e){var t=e.__highlightInfo,n=e.name;return t&&"name"===this.searchOn?this.getHiglightedDOM(t):n}},{key:"getNameDOM",value:function(e){var t=e.__highlightInfo,n=e.name,i=e.tooltip,r=void 0===i?n:i,s=e.isSharedFolder;return zdom("div",{className:"zmFolderMenuName js-name",ref:"name",title:r},void 0!==s&&s?zdom("fragment",null,zdom("i",{className:"msi-share zmThmClr"})," "):void 0,this.getNameContent({__highlightInfo:t,name:n}))}},{key:"getArrowDOM",value:function(e){var t=e.id;return this.parentMap[t]?zdom("div",{className:"zmFolderMenuOpen js-arrow",ref:"arrow"},zdom("i",{className:"msi-rarrow"})):void 0}},{key:"getContentDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return zdom("fragment",null,this.getArrowDOM(e),this.getNameDOM(e),zdom("span",{className:"zmFolderMenuActIco js-add",ref:"add",style:e.isSubFolderCreationAllowed&&this.SHOW_CREATE?void 0:je.HIDE},zdom("i",{className:"msi-plus",title:Ve.createSubFolder})))}},{key:"getAddSearchInputDOM",value:function(){return zdom("div",{className:"zmFolderMenuAdd js-add-menu","data-disableshortcuts":"true",style:je.HIDE,ref:"addInputContainer"},zdom("div",{className:"zmAddSubMenu"},zdom("input",{type:"text",ref:"addInput","data-disableshortcuts":"true",placeholder:this.SUBFOLDER_PLACEHOLDER||""})))}},{key:"getExpColFoldersDOM",value:function(){return zdom("span",{className:"zmLink"},this.expandAllFolders?Ve.collapseAllFolders:Ve.expandAllFolders," ",zdom("i",{className:this.expandAllFolders?"msi-zmPle":"msi-zmPme"}))}},{key:"getTemplate",value:function(){return zdom("div",{className:"js-container",ref:"container"},zdom("div",{className:"zmFolderMenuSearch"},this.getSearchDOM(),zdom("div",{className:"zmFolderMenuCollapse",ref:"expColFolders"},this.getExpColFoldersDOM())),zdom("div",{className:"zmDDScroll js-scrolldiv"},zdom("div",{className:this.listContainerClassName+" js-list-container",ref:"list"})),this.getAddSearchInputDOM())}},{key:"getModelOfLastClickedID",value:function(){return this.idMap[this.addClickedID]}},{key:"getElementRef",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.elMap[e]=this.elMap[e]||zmail.Utils.DOM.getRefs(this.constructListItem(this.idMap[e],t),!0)}},{key:"getChildren",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=[],r=this.parentMap[e]||{};for(var s in r)this.idMap[s]&&(n&&!this.expandStates[s]&&($.e(this.elMap[s].item).removeClass("js-open"),$.e(this.elMap[s].arrow).find("i").addClass("msi-rarrow").removeClass("msi-barrow")),i.push(this.elMap[s].item),this.parentMap[s]&&t&&(i=i.concat(this.getChildren(s,t,n))));return i}},{key:"updateChildElementMap",value:function(e){var t=e.id,n=e.pid;if("-1"!==n){var i=this.childElementMap[n]=this.childElementMap[n]||[];i.push(this.elMap[t].item),this.childElementMap[n]=i}}},{key:"initialRender",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=$.e(this.refs.list),n=this.getFragment();for(var i in this.idMap){var r=this.idMap[i],s=this.rootMap[i],o=this.getElementRef(i,$.extend({},e,{openClass:s?"":"js-open",display:Boolean(s),ariaState:"expand"}));s||$.e(o.arrow).find("i").addClass("msi-barrow").removeClass("msi-rarrow"),this.setPaddingLeft(r),this.updateChildElementMap(r),n.appendDOM(o.item)}t.appendDOM(n),this.__intialRender=!0}},{key:"updateNameElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.elMap[e.id],n=this.getNameDOM(e);Ye(t.name,n),t.name=n}},{key:"showListItem",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=e.id,i=e.pid,r=this.elMap[n];return $.e(r.item).css("display",""),t?($.e(r.item).addClass("js-open"),$.e(r.arrow).find("i").addClass("msi-barrow").removeClass("msi-rarrow")):$.e(r.arrow).find("i").addClass("msi-rarrow").removeClass("msi-barrow"),this.updateNameElement(e),this.setPaddingLeft(e),"-1"!==i&&this.showListItem(this.idMap[i],!0),this}},{key:"constructList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.model,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.$create&&this.$create.remove(),this.$emptyMsg&&this.$emptyMsg.remove(),void 0===n.partialRender)this.initialRender(n),this.expandAllFolders&&this.showAllElements(),$.e(this.refs.expColFolders).css("display","");else if(n.initPage&&this.expandAllFolders)this.showAllElements(),$.e(this.refs.expColFolders).css("display","");else if(n.initPage&&!this.expandAllFolders)this.hideAllElements(),this.showRootElements(),$.e(this.refs.expColFolders).css("display","");else{for(var i=e.length,r=0;i;){var s=e[r];this.showListItem(s,!1),--i,++r}t&&this.SHOW_CREATE?(this.$create=$.e(this.getCreateDOM({name:n.txt})),this.$create.data("zmsData",{type:"addnew"}),$.e(this.refs.list).appendDOM(this.$create)):e.length||(this.$emptyMsg=$.e(this.getEmptyMsgDOM(n)),$.e(this.refs.list).appendDOM(this.$emptyMsg)),$.e(this.refs.expColFolders).css("display","none")}return this.refs.list}},{key:"removeOpenState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.prevClickedID;return $.e(this.refs.addInputContainer).slideUp({duration:350}),this.prevClickedID&&(this.inputStates[this.prevClickedID]=$.e(this.refs.addInput).val()),e&&$.e(this.elMap[e].add).css("display",""),this.inputStates[this.addClickedID]&&$.e(this.refs.addInput).val(this.inputStates[this.addClickedID]),this.unbindAddInput(),this}},{key:"expandOrCollapseChild",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];n?this.expandStates[e]=!0:delete this.expandStates[e];var s=this.elMap[e],o=n?"slideDown":"slideUp",l=n?"focus":"blur",a=(n?"add":"remove")+"Class",d=$.e(this.getChildren(e,!n,n));n?$.e(s.arrow).find("i").addClass("msi-barrow").removeClass("msi-rarrow"):$.e(s.arrow).find("i").addClass("msi-rarrow").removeClass("msi-barrow"),$.e(s.item)[a]("js-open");var c=function(){setTimeout(function(){var e=i?$.e(t.refs.addInput):$.e(t.refs.searchInput);e.length&&e[0][i?l:"focus"]()})};return r||100<d.length?(d.css("display",n?"":"none"),c()):d.length?d[o]({complete:i?c:_.debounce(c,300),duration:250}):c(),this.keyboardHandler&&this.keyboardHandler.resetListItems(),this}},{key:"__toggleHandler",value:function(e){var t=$.e(e.target).closest(".js-item").eq(0),n=t.hasClass("js-open");return t.attr("aria-state",n?"collapse":"expand"),this.removeOpenState(this.addClickedID),fe(e),this.expandOrCollapseChild(t.data("id"),!n)}},{key:"__addHandler",value:function(e){var t=$.e(e.target),n=$.e(this.refs.addInputContainer),i=t.closest(".js-item").eq(0);return t.closest(".js-add").css("display","none"),this.prevClickedID=this.addClickedID,this.addClickedID=i.data("id"),this.removeOpenState(),$.e(n).insertDOMAfter(this.elMap[this.addClickedID].item),this.setPaddingLeft(this.idMap[this.addClickedID],!0),this.bindAddInput(),n.slideDown({duration:350}),fe(e),this.expandOrCollapseChild(this.addClickedID,!0,!0,!1)}},{key:"__itemClickHandler",value:function(e){if(!qe(e.target))return babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"__itemClickHandler",this).call(this,e);fe(e)}},{key:"__expandCollapseFoldersHandler",value:function(e){this.expandAllFolders=!this.expandAllFolders,this.expandAllFolders?this.showAllElements():(this.hideAllElements(),this.showRootElements(),this.expandStates={});var t=this.getExpColFoldersDOM();return Ye(this.refs.expColFolders.firstElementChild,t),Xe.setValue(this.expandAllFolders),fe(e),this}},{key:"bindAddInput",value:function(){var n=this;return this.refs.list&&(this.addInputKeyboardHandler=new Ue({enterKeyAction:function(e,t){return t&&t.length&&n.onCreate(void 0,t,n.getModelOfLastClickedID())}}),$.e(this.refs.addInput).on("keydown keyup",this.addInputKeyboardHandler.handle)),this}},{key:"unbindAddInput",value:function(){return this.refs.list&&this.addInputKeyboardHandler&&($.e(this.refs.addInput).off("keydown keyup",this.addInputKeyboardHandler.handle),this.addInputKeyboardHandler=void 0),this}},{key:"showRootElements",value:function(){for(var e in this.rootMap)this.idMap[e]&&this.rootMap.hasOwnProperty(e)&&($.e(this.elMap[e].item).removeClass("js-open").css("display",""),this.updateNameElement(this.idMap[e]),$.e(this.elMap[e].arrow).find("i").addClass("msi-rarrow").removeClass("msi-barrow"))}},{key:"showAllElements",value:function(){$.e(this.refs.list).find(".js-arrow").find("i").addClass("msi-barrow").removeClass("msi-rarrow"),$.e(this.refs.list).find(".js-item").addClass("js-open").css("display","")}},{key:"hideAllElements",value:function(){$.e(this.refs.list).find(".js-arrow").find("i").addClass("msi-rarrow").removeClass("msi-barrow"),$.e(this.refs.list).find(".js-item").removeClass("js-open").css("display","none")}},{key:"__preRender",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return void 0===e.partialRender?this.unbindEvents(e):this.hideAllElements(),this}},{key:"__postRender",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return void 0===e.partialRender?this.bindEvents(e):this.keyboardHandler&&this.keyboardHandler.reset().resetListItems(),this.__selectIfItemIsTheOnlyOne(),this.removeOpenState(this.prevClickedID||this.addClickedID),this}},{key:"__kbDefaultAction",value:function(){this.removeOpenState();var e=String($.e(this.refs.searchInput).val()).trim(),t=this.match(e)||[];this.render({partialRender:!0,initPage:!e.length,showCreate:!t.exactMatch&&0<e.length,exactMatch:t.exactMatch,list:t.model,txt:t.txt})}},{key:"__kbExpandOrCollapseChild",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.data("id"),n=2<arguments.length?arguments[2]:void 0;"create"!==t&&this.expandOrCollapseChild(t,n)}},{key:"__kbEnterKeyAction",value:function(e,t){var n=1===$.e(this.refs.list).find(".js-item:visible").length;!t&&n&&(t=$.e(this.refs.list).find(".js-item").eq(0),this.keyboardHandler&&(this.keyboardHandler.__$currentEl=t,this.keyboardHandler.addSelection())),this.selectionHandler(t)}},{key:"bindEvents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"bindEvents",this).call(this,$.extend({},e,{disableKeyboardInit:!0,disableMouseBind:!0})),this.refs.list){var t=$.e(this.refs.list);t.off("mouseup click").on("mouseup click",function(e){qe(e.target)||fe(e)}),t.find(".js-arrow").on("mouseup click",fe).on("mousedown",this.__toggleHandler),t.find(".js-add").on("mouseup click",fe).on("mousedown",this.__addHandler),this.bindAddInput(),e.disableMouseBind||(this.mouseHoverHandler=new Pe({$list:t}),this.mouseHoverHandler.bind())}return this.refs.searchInput&&!e.disableKeyboardInit&&(this.keyboardHandler=new Be({$list:$.e(this.refs.list),mouseHoverHandler:this.mouseHoverHandler,itemSelector:".js-item",enterKeyAction:this.__kbEnterKeyAction,defaultAction:this.__kbDefaultAction,expandOrCollapseChild:this.__kbExpandOrCollapseChild}),$.e(this.refs.searchInput).off("keydown keyup").on("keyup keydown",this.keyboardHandler.handle)),this.refs.expColFolders&&$.e(this.refs.expColFolders).on("mouseup click",fe).on("mousedown",this.__expandCollapseFoldersHandler),this}},{key:"unbindEvents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"unbindEvents",this).call(this,e),this.refs.list){var t=$.e(this.refs.list);t.off("mousedown",this.__itemClickHandler).off("mouseup click"),t.find(".js-arrow").on("mouseup click",fe).on("mousedown",this.__toggleHandler),t.find(".js-add").on("mouseup click",fe).on("mousedown",this.__addHandler),this.unbindAddInput()}return this.refs.searchInput&&this.keyboardHandler&&($.e(this.refs.searchInput).off("keydown keyup",this.keyboardHandler.handle),this.keyboardHandler.reset(),this.keyboardHandler=void 0),this.refs.expColFolders&&$.e(this.refs.expColFolders).off("mousedown",this.__expandCollapseFoldersHandler).off("mouseup click",fe),this}}]),n}(Ie);function Je(e){if(zmComponent.keybindings.scopeInfos.hasOwnProperty(e)){for(var t=["upArrow","leftArrow","rightArrow","downArrow","enter","esc","space"],n=0;n<t.length;n++)zmComponent.keybindings.deregister(e,t[n]);zmComponent.keybindings.dropScope(e),zmComponent.keybindings.setScope(Z)}}function Qe(e){$(e).off("mousemove.dd").one("mousemove.dd",function(e){$(this).children().removeClass("sel"),$(this).hasClass("sel")||($(this).addClass("SC_Phr"),$(e.target).trigger("mouseenter"))}).removeClass("SC_Phr")}function et(e){var t=e.parent().parent(),n=t.height(),i=e.position().top,r=t.scrollTop(),s=e.outerHeight();n<i+s?t.scrollTop(Math.abs(i+s-n)+r):i<0&&t.scrollTop(Math.abs(i+r))}function tt(e,t){for(var n=e.children(),i=t=t||0;i<n.length;i++){var r=$(n[i]);if("SC_lne"!==r.attr("class")&&"nohr"!==r.attr("class"))return et(r),e.children().closest(".sel").removeClass("sel"),r.addClass("sel"),Qe(r.parent()),e.data("currentSelected",i),!0}return!1}function nt(e,t){(t<0||void 0===t)&&(t=t||e.children().length-1);for(var n=e.children(),i=t;0<=i;i--){var r=$(n[i]);if("SC_lne"!==r.attr("class")&&"nohr"!==r.attr("class"))return et(r),e.children().closest(".sel").removeClass("sel"),r.addClass("sel"),Qe(r.parent()),e.data("currentSelected",i),!0}return!1}function it(e,t){var n=t.data("currentSelected")||0;1===e?tt(t,n+1)||tt(t):-1===e&&(nt(t,n-1)||nt(t))}var rt=function(e,t){1===t?it(1,e):-1===t&&it(-1,e),e.children().find(".sel").removeClass("sel")};function st(e,i,t,a){var n=[function(e,t,n){!function(e,t){var n,i,r=$.q("."+a).length,s=-1;if(void 0!==(i=$($.q("."+a)[r-1])).data("currentSelected")&&(s=i.data("currentSelected")),("nextChildElement"===e||"prevChildElement"===e)&&(n=i.children().closest(".sel").prevAll().length,void 0!==$(i).data().listArr[n].data)){var o=$(i).data().listArr[n].data.dropMenudirection;void 0===o&&(o=$(i).data().listArr[n].data.menuDirection),"left"!==o&&"cright"!==$(i).data().position||(e="nextChildElement"===e?"prevChildElement":"nextChildElement")}if(-1===s)"prevElement"===e?nt(i):"nextElement"===e&&tt(i);else if("prevElement"===e)rt(i,-1);else if("nextElement"===e)rt(i,1);else{if("selectElement"===e)return void 0!==t[n=i.children().closest(".sel").prevAll().length]&&"function"==typeof t[n].child?i.children().closest(".sel").trigger("mouseenter"):(Je("dropDownNavigation"),i.children().closest(".sel").trigger("click"));"nextChildElement"===e&&(n=i.children().closest(".sel").prevAll().length,"function"==typeof $(i).data().listArr[n].child&&(i.children().closest(".sel").trigger("mouseenter"),$.q("."+a).length>r&&$.q("."+a).last().children().eq(0).addClass("sel")))}if("removeElement"===e||"prevChildElement"===e){var l=$.q("."+a).length;"removeElement"===e&&l<=1&&(Je("dropDownNavigation"),zmUtil.hideMenu()),(1<l||"removeElement"===e)&&i.parent().remove()}}(e,i),n.preventDefault()}],r={scope:"dropDownNavigation",allowDefaultScope:!1,defaultOccurrence:!0,shortcuts:[{uid:"prevElement",keyStr:"upArrow",scope:"dropDownNavigation",actions:n},{uid:"removeElement",keyStr:"esc",scope:"dropDownNavigation",actions:n},{uid:"nextElement",keyStr:"downArrow",scope:"dropDownNavigation",actions:n},{uid:"nextChildElement",keyStr:"rightArrow",scope:"dropDownNavigation",actions:n},{uid:"prevChildElement",keyStr:"leftArrow",scope:"dropDownNavigation",actions:n},{uid:"selectElement",keyStr:"enter",scope:"dropDownNavigation",actions:n},{uid:"selectElement",keyStr:"space",scope:"dropDownNavigation",actions:n}]};"dropDownNavigation"!==zmComponent.keybindings.getScope()&&(Z=zmComponent.keybindings.getScope(),zmComponent.keybindings.registerAll(r),zmComponent.keybindings.setScope("dropDownNavigation"))}function ot(e){return(parseInt(e.css("margin-top"))||0)+(parseInt(e.css("padding-top"))||0)+parseInt(e.css("border-top")||0)}var lt,at,dt=function e(t){var n,i;for(n=0;n<t.length;n++)t[n]&&(t[n].child?t[n].child.divId?$.q("#"+t[n].child.divId).remove():$.q("#"+t[n].child("",t[n].data).divId).remove():t[n].customList&&t[n].customList.remove(),(i="function"==typeof t[n].child?t[n].child("rem",t[n].data):t[n].child)&&i.list&&e(i.list))},ct=function(e,t,n,i){e&&e.removeAttr("data-drop"),n&&n.par&&$.e(n.par).removeAttr("data-dropdown").removeClass("zmAMddOnB zmAMddOnT"),t&&(zmUtil.removeHighlight(),Je("dropDownNavigation")),i.remove()},ut=function(){$(this).parent().children().removeClass("sel"),$(this).hasClass("nohr")||$(this).addClass("sel")};function ht(e){this.dropObj=e}ht.prototype.removeBindings=function(){Je("dropDownNavigation")},(ht.prototype={setDropObj:function(e){this.dropObj=e},paint:function(){this.dropObj.showArrow?this.paintArrowDrop():this.paintDrop()},createChildDrp:function(l,a,d,c,u,h){return function(e){var t,n,i,r,s,o=$(e.target);"disabled"!==c[l].state&&(dt(c),c[l].customList&&(c[l].customList.show(a),$(o).parent().children().removeClass("sel")),$(o).parent().hasClass("SC_Phr")&&($(o).parent().data("currentSelected",$(e.target).prevAll().length),$(o).parent().children().removeClass("sel")),(t="function"==typeof c[l].child?c[l].child():c[l].child)?(n=c[l].align?c[l].align:(s=(r=zmail.isComposeMail?$.q("#zmComposeWrapper"):zmsuite.getCenter()[0].$el).offset().left+r.width()/2,$(d.dropObj.par).offset().left>s?"cright":"cleft"),t.par=a,t.align=n,t.clk=t.clk||h.clk,t.isChild=!0,t.container=d.dropObj.container,(i=new ht(t)).paint(),u.childElem=i):$(o).parent().data("childrenVisible",!1),(t||c[l].customList)&&($(o).parent().data("childrenVisible",!0),$(o).addClass("sel")))}},paintDrop:function(){var e,t,n,i,r,s,o,l,a=this.dropObj,d=a.list||[],c=a.liDom||[],u=$(a.par),h=a.align,p=a.divId,f=u.offset(),m=u.outerHeight(),v=f.left,g=a.container||document.body,C=a.dom,y=a.htm,_=f.top,b=void 0===a.defaultclass||a.defaultclass,E=a.dir,k=$(g).offset(),H=a.avoidScroll,w=a.paddingOffset||40,T="",S=parseInt(zmUtil.wmsBarHeight()),I=a.avoidAutoPosition;$(a.par[0]).addClass("zmcDrpDwnOpn");var M,O,A,D,N,x,L,K,z=d.length||c.length;r=g.offsetHeight,$.e(a.par).attr("data-dropdown","true"),s=g.offsetWidth,h||(i=(t=zmsuite.getCenter()[0].$el).offset().left+t.width()/2,h=u.offset().left>i?"pright":"pleft"),N=$.e(zdom("div",null)),p?($.q("#"+p).remove(),N[0].id=p):($.q("#zm_dropDown").remove(),N[0].id="zm_dropDown");var R="SC_dd";if(!b&&a.spanClass&&(R=a.spanClass),N.addClass(R+" shw"),N.mousedown(function(e){_zm.stopEvents(e,!0)}),a.removeLi){for(var P=0;P<a.liDom.length;P++){var U=$(a.liDom[P]);N.append(U)}e=a.scrollElement,$(g).append(N),"pleft"===h&&v+$(N).width()>s&&(h="pright"),a.liDom=null,z=!1}if(z){if(D=$.e(zdom("ul",null)),a.clk&&D.click(function(e){var t,n=e.target||e.srcElement,i=$(n).closest("li");t=i.data(),i.hasClass("SC_op3")||(Je("dropDownNavigation"),a.clk(t,n,e))}),$(D).on("mouseleave",function(){$(this).data("childrenVisible")||$(D).find(".sel").removeClass("sel")}),a.ulClass&&D.addClass(a.ulClass),a.liDom)for(z=a.liDom.length,M=0;M<z;M++)D.append(a.liDom[M]);else{for(M=0;M<z;M++)d[M]&&(A=$.e(zdom("li",null)),d[M].sep?A.addClass("SC_lne"):d[M].txt?A.text(d[M].txt):d[M].dom?A.append(d[M].dom):(!1===zmail.isProduction&&window.console.error("Please pass DOM rather than html to the dropdown"),A.html(d[M].htm)),d[M].className&&A.addClass(d[M].className),d[M].nohover&&A.addClass("nohr"),d[M].noclick&&A.addClass(d[M].noclick),d[M].data&&A.data(d[M].data),"disabled"===d[M].state&&A.addClass("SC_op3"),A.mouseover(this.createChildDrp(M,A,this,d,this)),D.append(A),_zm.is_typesafari&&A.hover(ut))}Qe(D),D.on("contextmenu",function(){return!1}),e=$.e(zdom("div",null)),a.removeLi||(e.append(D),N.append(e))}else y?N.append(y):C&&N.append(C);if($(g).append(N),$(D).addClass("zmcDrpDwnMnu"),$(D).data({listArr:d,position:h}),!0!==a.disableShortCut&&!0!==this.dropObj.isChild&&st(0,d,0,"zmcDrpDwnMnu"),a.parWidth){var F=u.outerWidth();N.width()<F?(N.width(F),N.addClass("topSt SC_ddT")):N.addClass("topLt SC_ddT"),a.removeBorderValue&&N.width(F-((parseInt($(N).css("border-left-width"))||0)+(parseInt($(N).css("border-right-width"))||0)))}var B=N.height();if("cleft"===h||"colorpicker"===h){O="cleft"===h?u.parent().width():u.width(),n=N.width(),a.container&&(s-=parseFloat($(a.container).css("border-left-width"))||0),f.left+O+n>s?(N.find("ul").addClass("SC_ddr"),N.css("right",s-f.left)):N.css("left",v+O),_-=parseFloat(N.find("ul").css("padding-top"));var V=0;if(a.isChild&&(_-=V=ot(N)),r<_+B&&0<_-B)N.css({top:_+m-B});else if(r<_+B+S+w&&r/2<_){var j=r-_-m-2*V;N.css({bottom:j}),r-j-B<0&&(e.css({"max-height":r-j-2*ot(N)}),e.addClass("zmDDScroll")),x="bottom"}else N.css({top:_})}else if("pright"===h)n=u.outerWidth(),v-=k.left,_-=k.top,v=(s-=parseFloat($(a.container).css("border-right-width"))||0)-(v+n),a.isChild&&(_-=ot(N)),N.find("ul").addClass("SC_ddr"),.7*g.getBoundingClientRect().height-S<_&&!I&&(E="bottom"),E&&"bottom"===E?((K=_-B)<10&&e&&!H&&(e.css("height",N.height()-(k.top+5-K)).addClass("zmDDScroll"),K=k.top+5,H=!0),l="SC_ddRtB",T="botRt"):(K=_+m-0-0,l="SC_ddRt",T="topRt",E="top"),K+N.outerHeight()<u.offset().top-k.top+m&&(K-=N.outerHeight()-B),e&&N.addClass(l),N.css({right:v+"px",top:K+"px"});else if("cright"===h)n=u.outerWidth(!0),v-=k.left,_-=k.top,a.container&&(s-=parseFloat($(a.container).css("border-right-width"))||0),v=s-v,a.isChild&&(_-=ot(N)),N.find("ul").addClass("SC_ddr"),N.css({right:v+"px"}),N.find("ul").length&&(_-=parseFloat(N.find("ul").css("padding-top"))),e&&N.addClass("SC_ddRt"),_+N.outerHeight()+S>r&&0<_-N.outerHeight()?N.css({top:_+m-B}):N.css({top:_});else if("pleft"===h){if(L=v-k.left,_-=k.top,.7*g.getBoundingClientRect().height-S<_&&!I&&(E="bottom"),a.isChild&&(_-=ot(N)),E&&"bottom"===E){if($(u).hasClass("zmAMddOnB")&&$(u).removeClass("zmAMddOnB").addClass("zmAMddOnT"),N.find("ul").addClass("SC_ddr"),(K=_-B-2*ot(N))<10){if(e&&!H){var W=0;a.showSearch&&(W=40),e.css("height",N.height()-W-(k.top+5-K)).addClass("zmDDScroll"),K=k.top+5,H=!0}}else e.css("height",e.height());T="botLt",T+=" "+(l="SC_ddLtB"),(!a.parWidth||N.width()<=u.outerWidth())&&(T="botSt")}else K=_+m-0-0-1,u.hasClass("zmAMItem")&&(K+=1),a.parWidth||(T="topLt"),E="top";N.css({left:L+"px",top:K+"px"}),L+N.outerWidth()>s&&!a.container&&$(N).css("width",s-L)}else"mright"===h&&(n=u.width(),a.container&&(s-=parseFloat($(a.container).css("border-right-width"))||0),v=s-v,N.find("ul").addClass("SC_ddr"),N.css({right:v+"px",top:_-N.height()/2}));T&&N.addClass(T);var G=N.height();if("bottom"!==x&&(o=G+N.offset().top-k.top-(r-w),a.showSearch&&(o+=40)),a.showSearch&&L){var q=s-L,Y=r-K-S;q=600<q?600:s-L,$(N).css({"max-width":a.maxWidth||q,"max-height":Y}),$(e).css("max-height",Y-35)}0<o&&e&&!H&&(!0===a.isChild&&(o-=w),e.css("max-height",G-o-ot(N)-S).addClass("zmDDScroll")),a.isChild&&0<o&&e&&!H&&e.css("top",parseFloat(e.css("top")-o)),$("[data-drop='1']").removeAttr("data-drop"),"pleft"!==h&&"pright"!==h||u.attr("data-drop","1"),a.leftOffset&&(N[0].style.left=parseFloat(N[0].style.left)+a.leftOffset+"px"),a.topOffset&&(N[0].style.top=parseFloat(N[0].style.top)+a.topOffset+"px"),setTimeout(function(){a.beforeShow&&a.beforeShow(),N.addClass("shw")},200),$.publish("/mail/menuCreated",[{element:N[0],menuHandler:ct,menuArgsArray:[u,!a.isChild,a,this]}]),this.dropObj.mountPosition=E,(this.dropObj.addParentClass||!0===$(u).data("fromicon"))&&("top"===E?$.e(this.dropObj.par).addClass("zmAMddOnB"):"bottom"===E&&$.e(this.dropObj.par).addClass("zmAMddOnT")),this.$el=N},paintArrowDrop:function(){var e,t,n,i,r,s,c=this.dropObj,u=c.list,h=$(c.par),o=h.offset(),l=h.height(),a=h.width(),d=c.divId,p=c.arrowPosition,f={},m=c.offset||{x:0,y:0},v={},g=c.container||document.body,C=$(g).offset(),y=parseInt(zmUtil.wmsBarHeight());c.par&&(v=h[0].getBoundingClientRect()),c.par||(l=a=0),$.e(c.par).attr("data-dropdown","true");var _,b,E,k,H,w,T,S,I,M=0;if(n=g.offsetHeight-y,i=g.offsetWidth,s=c.paddingOffset||15,k=$.e(zdom("div",null)),this,d?($.q("#"+d).remove(),k[0].id=d):($.q("#zm_dropDown").remove(),k[0].id="zm_dropDown"),c.fromFolderLabel&&$(k).css("min-width","204px"),k.addClass("SC_arm"),k.mousedown(function(e){_zm.stopEvents(e,!0)}),r=c.ulClass||(!1===c.liHover?"":"SC_Phr "),(E=$.e(zdom("ul",null)))[0].className=r,E.addClass("zmListReset"),c.spanClass&&k.addClass(c.spanClass),c.clk&&E.click(function(e){var t,n=e.target||e.srcElement;t=$(n).closest("li").data(),c.clk(t,n)}),c.removeLi){for(var O=0;O<c.liDom.length;O++){var A=$(c.liDom[O]);k.append(A)}E.remove(),c.liDom=null,c.scrollElement&&(E=c.scrollElement)}if(c.liDom)for(H=c.liDom.length,_=0;_<H;_++)E.append(c.liDom[_]);else if(u&&u.length){var D=this,N=function(l,a,d){return function(e){var t,n,i,r,s,o=$(e.target);"disabled"!==u[l].state&&(dt(u),u[l].customList&&(u[l].customList.show(a),$(o).parent().children().removeClass("sel")),$(b).parent().hasClass("SC_Phr")&&($(b).parent().data("currentSelected",$(e.target).prevAll().length),$(o).parent().children().removeClass("sel")),(t="function"==typeof u[l].child?u[l].child("",u[l].data):u[l].child)?(n=u[l].align?u[l].align:(s=(r=zmail.isComposeMail?$.q("#zmComposeWrapper"):zmsuite.getCenter()[0].$el).offset().left+r.width()/2,h.offset().left>s?"cright":"cleft"),t.par=a,t.align=n,t.clk=t.clk||c.clk,t.isChild=!0,t.container=d.dropObj.container,(i=new ht(t)).paint(),D.childElem=i):$(o).parent().data("childrenVisible",!1),(t||u[l].customList)&&($(o).parent().data("childrenVisible",!0),$(o).addClass("sel")))}};for(H=u.length,_=0;_<H;_++)u[_]&&(b=$.e(zdom("li",null)),u[_].sep?b.addClass("SC_lne"):u[_].txt?b.text(u[_].txt):u[_].dom?b.append(u[_].dom):(!1===zmail.isProduction&&window.console.error("Please pass DOM rather than html to the dropdown"),b.html(u[_].htm)),u[_].data&&b.data(u[_].data),u[_].className&&b.addClass(u[_].className),u[_].nohover&&b.addClass("nohr"),"disabled"===u[_].state&&b.addClass("SC_op3"),u[_].nohover&&b.addClass("nohr"),b.mouseover(N(_,b,this)),E.append(b),_zm.is_typesafari&&b.hover(ut))}if(c.buttons){for(M=(T=c.buttons).length,S=$.e(zdom("div",{className:"SC_PUbtm"})),b=$.e(zdom("li",null)),_=0;_<M;_++)(w=$.e(zdom("span",null))).html(T[_].txt),w.on("click",T[_].callback),S.append(w);b.append(S),E.append(b)}c.htm&&c.loadHTML?k.append(c.htm):c.removeLi||k.append(E);var x=13;c.removeArrow&&(k.addClass("na"),x=0),c.showSearch&&(s+=40),c.direction||(c.autoPosition=!0,o.top>n/2&&(c.direction="bottom")),n-=s;var L,K={};if("left"===c.direction)$(document.body).append(k),e=c.left||o.left+a,I=k.outerHeight(),(t=c.top||o.top+l/2-I/2)<10||t+I/2<n-s?o.top<n/2?(t=o.top-(x+15)+h.width()/2,k.addClass("ltt"),t+k.height()>n-s&&(E.css("height",k.height()-(t+k.height()-n+s)),E.addClass("zmDDScroll"))):(t=c.top||o.top+l/2+15+x-I,k.addClass("ltb"),!c.top&&t<1&&(t=x,E.css("height",o.top+x),E.addClass("zmDDScroll"))):k.addClass("lt"),k.css({left:e+"px",top:t+"px"}),K.left=k.offset().left+x+"px";else if("bottom"===c.direction){$(document.body).append(k),L=k.width(),c.fromFolderLabel&&$(k).css("width",L),e=c.left+a/2-L/2||o.left+a/2-k.outerWidth()/2,t=c.top-k.height()-ot(k)||o.top-k.outerHeight(),i<e+L+5&&c.par||"right"===p?(k.addClass("btr"),e=o.right,f.right=i-v.right+h.width()/2-(x+15)+"px",parseInt(f.right)+L+10>i&&$(k).css("width",i-parseInt(f.right)-10)):e<0||"left"===p?(f.left=o.left+a/2-x-15+"px",parseInt(f.left)+L+10>i&&$(k).css("width",i-parseInt(f.left)-10),k.addClass("btl")):(k.addClass("bt"),f.left=e+"px"),t<10&&(E.css("height",o.top-(85+s)).addClass("zmDDScroll"),t=70+x);var z=$(document.body).height()-(c.top||o.top);f.bottom=z-x+"px",k.css(f),K.bottom=z+x+"px"}else if("right"===c.direction)$(document.body).append(k),I=k.height(),t=c.top||o.top+l/2-I/2,e=c.right||i-o.left,t<10||t+I/2<n?o.top<n/2?(t=o.top-(x+15)+h.width()/2,k.addClass("rtt"),t+k.height()>n-s&&(E.css("height",k.height()-(t+k.height()-n+s)),E.addClass("zmDDScroll"))):(t=c.top||o.top+l-k.height(),k.addClass("rtb"),!c.top&&t<1&&(t=x,E.css("height",o.top+x),E.addClass("zmDDScroll"))):k.addClass("rt"),k.css({right:e+"px",top:t+"px"}),K.right=i-k.offset().left-k.width()+x+"px";else if("rightBottom"===c.direction)$(document.body).append(k),e=c.right||i-o.left,t=c.top||o.top+l-k.height(),k.addClass("rtb"),!c.top&&t<1&&(t=x,E.css("height",o.top+x).addClass("zmDDScroll")),k.css({right:e+"px",top:t+"px"}),c.bottom&&k.css({bottom:c.bottom}),K.right=i-k.offset().left-k.width()+x+"px";else{if(a=parseInt($(h).outerWidth()),c.par||(a=0),$(g).append(k),e=c.left||o.left+a/2-k.outerWidth()/2,e-=C.left,t=c.top||o.top,t-=C.top,I=k.height(),L=k.width(),c.fromFolderLabel&&$(k).css("width",L),e+k.width()+5>i&&c.par||"right"===p?(k.addClass("tpr"),f.right=i-v.right+h.width()/2-(x+15)+"px"):e<0||"left"===p?("left"===c.directionAlign?(e=c.left||o.left+a/2,e-=C.left,e-=x+15+"px",f.left=e):f.left=o.left+a/2-(x+15)+"px",k.addClass("tpl")):(k.addClass("tp"),f.left=e+"px"),f.top=t+l+"px",n<t+I+10){var R=I+t-n;R+=70,E.css("max-height",I-R+"px").addClass("zmDDScroll")}f.left=parseInt(f.left)+m.x+"px",f.right&&(f.right=parseInt(f.right)+m.x+"px"),f.top=parseInt(f.top)+m.y+"px",k.css(f);var P=k.offset().top;k.css("top",P+2*x+"px"),K.top=P+x+"px"}setTimeout(function(){c.beforeShow&&c.beforeShow(),k.addClass("shw"),k.css(K)},200),$.publish("/mail/menuCreated",[{element:k[0],menuHandler:ct,menuArgsArray:[null,!c.isChild,c,this]}]),E.on("contextmenu",function(){return!1}),this.$el=k}}).hide=function(){this.$el.hide()},ht.prototype.remove=function(){var e=this;e.$el.remove(),"function"==typeof e.dropObj.onHide&&e.dropObj.onHide(),void 0!==e.dropObj.par&&$.e(e.dropObj.par).removeClass("zmAMddOnB zmAMddOnT").removeAttr("data-dropdown"),this.childElem&&this.childElem.remove(),$(e).triggerHandler("removed",e)},ht.prototype.show=function(){this.$el.show(),this.position()},ht.prototype.position=function(e){var t=this,n=zmail.Components.AutoFill.Helper.getAutofillViewPort();(e=e||{}).arrowPadding=e.arrowPadding||12,t.dropObj.showArrow||(e.arrowPadding=0);var i,r,s,o,l=$(t.$el)[0],a=$(t.dropObj.par)[0],d=null,c=e.arrowPadding,u=!1,h=!0;if(d={left:0,top:0},l&&a){$(l).css({height:"auto"}),i=a.getBoundingClientRect(),r=l.getBoundingClientRect(),d.left=i.left,d.left-=(r.width-i.width)/2,s=Math.abs(i.top-n.top),o=Math.abs(i.bottom-n.bottom),t.dropObj.autoPosition||"top"!==t.dropObj.direction?!0===t.dropObj.autoPosition&&(h=s<o):h=!1,$(l).removeClass("tp").removeClass("bt").removeClass("scroll-active");var p={};if(h)d.top=i.bottom+c,o<r.height+c&&($(l).css({height:o-c+"px"}).addClass("scroll-active"),u=!0),d.left<0?d.left=i.left:$(l).addClass("tp"),p.bottom="",p.top=d.top,p.left=d.left;else{d.top=i.top-r.height-c,d.top<n.top&&(d.top=n.top),s<r.height+c&&($(l).css({height:s-c+"px"}).addClass("scroll-active"),u=!0);var f=parseInt($(l).css("height"));isNaN(f)?p.top=d.top:(p.bottom=n.bottom-i.top+c,p.bottom+=parseInt(zmUtil.wmsBarHeight())),p.left=d.left,$(l).addClass("bt")}$(l).hide(),$(l).css(p),$(l).show(),u&&"function"==typeof e.onResize&&e.onResize({wrapperDOM:l,height:l.getBoundingClientRect().height,position:h?"bottom":"top",insufficientSpace:u})}},ht.create=ht.show=function(e){var t=new ht;return zmTooltip.remove(),t.setDropObj(e),t.paint(),zmail.debug&&(window._lastDropMenu=t),t};var pt=function(e,t,n){e&&t&&zmUtil.removeRightClickSelection(e),Je("dropDownNavigation"),n.remove()};function ft(e){this.menuObj=e&&e.menuObj}ft.prototype={setMenuObj:function(e){this.menuObj=e},remove:function(){"function"==typeof this.menuObj.onHide&&this.menuObj.onHide()},paint:function(e){var t,n,i,r,s=this.menuObj.conArr||this.menuObj.list,o=this.menuObj.par,l=this.menuObj.position||"right",a=this,d=document.body.offsetWidth;if(s){t=this.menuObj.divId||"zmCntxtMenu";var c=s.length;if(c){$.q("#"+t).remove();var u=$.e(zdom("div",{id:t,className:"SC_dd shw",onMouseDown:function(e){zmUtil.stopEvents(e,!0)}})),h=$.e(zdom("div",null));u.append(h),u.click(function(e){var t=e.target||e.srcElement;Je("dropDownNavigation"),(t=$(t).closest("li")).hasClass("SC_op3")||a.menuObj.clk(e,t.data())}),u.on("contextmenu",function(){return!1});var p=$(zdom("ul",null));h.append(p);for(var f=function(){$(this).parent().children().removeClass("sel"),$(this).hasClass("nohr")||$(this).addClass("sel")},m=0;m<c;m++){var v=$(zdom("li",null)),g=!0===s[m].cEdit,C=s[m].id?s[m].id:"";if(v.data(s[m].data),s[m].txt)s[m].id?v.appendDOM(zdom("div",{id:s[m].id},s[m].txt)):v.text(s[m].txt);else if(s[m].dom)v.append(s[m].dom);else if(s[m].htm){if(g){var y=$(zdom("div",null));y[0].innerHTML=s[m].htm,y[0].id=C,v.append(y)}else v[0].innerHTML=s[m].htm,v[0].id=C;!1===zmail.isProduction&&window.console.error("Please pass DOM rather than html to the dropdown")}else s[m].sep&&(v[0].className="SC_lne",v[0].id=C);p.append(v),o&&d<e.clientX+o[0].offsetWidth+200&&(l="left"),v.mouseover(lt(m,s,v,l)),v.hover(f)}$(p).on("mouseleave",function(){$(this).data("childrenVisible")||$(p).find(".sel").removeClass("sel")}),Qe(p);var _=e.clientY,b=e.clientX;$("body").append(u),p.addClass("zmcCntxtMnu"),void 0===this.menuObj.parent&&st(0,s,0,"zmcCntxtMnu"),n=u[0].offsetWidth||0,o&&($(o).addClass("sel"),i=o[0].offsetWidth,r=o[0].getBoundingClientRect(),"left"===l?b=r.left-n:"right"===l?b=r.right:d<b+i+n&&(b=r.left-n),_=r.top);var E=$.q("#"+t).height()+_,k=$.q("#"+t).height(),H=$(document.body).height();if(u)if(d<b+n&&(b-=n),H-100<E&&0<=_-k){o&&(_+=r.height);var w=H-_;o&&(w-=ot(u)),u.css({bottom:w,left:b})}else o&&(_-=ot(u)),u.css({top:_,left:b});$.publish("/mail/menuCreated",[{element:u[0],menuHandler:pt,menuArgsArray:[e.target||e.srcElement,this.menuObj.removeSelection,this]}])}}}},at=function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i].child){var r=e[i].child();$.q("#"+r.divId)&&$.q("#"+r.divId).remove()}},lt=function(i,r,s,o){return function(e){var t={};if(at(r),$($(s).parent()).hasClass("SC_Phr")&&$($(s).parent()).data("currentSelected",$(e.target).prevAll().length),r[i].child&&((t=r[i].child()).par=s,t.position=o),0<Object.keys(t).length){var n=new ft;n.setMenuObj(t),n.paint(e),$(s).parent().data("childrenVisible",!0)}else $(s).parent().data("childrenVisible",!1)}};var mt={DOM_MOUNTED:"domMounted"},vt=Object.freeze({KEYS:d,EVENTS:mt}),gt=r,Ct=function(e){return e===document.body||document.body.contains(e)},yt=function(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=i.parentComponent||null,s=!1;s=n=Ct(t),r&&(s=Ct(r.dom)),(n||r||i.detached)&&(!0!==e._mounted&&(i.nextDOMAnchor?t.insertBefore(e.dom,i.nextDOMAnchor):t.appendChild(e.dom),e._mounted=!0),s&&$.events(e).triggerHandler(mt.DOM_MOUNTED,{dom:e.dom}))},_t=function(e){e&&($.e(e.dom).remove(),e._mounted=!1)},bt=Object.freeze({getDOMReferenceMap:gt,debounce:function(e,t){return"function"==typeof e?n(e,t):null},throttle:function(e,t){return"function"==typeof e?i(e,t):null},deferred:function(){return $.Deferred()},mountComponent:yt,unmountComponent:_t}),Et=k().extend({defaults:{id:null,text:"",editMode:!1,selected:!1}}),kt=H().extend({model:Et}),Ht={TOKEN_ADD:"tokenAdd",TOKEN_REMOVE:"tokenRemove",TOKEN_CHANGE:"tokenChange",TOKEN_BULK_CHANGE:"tokenBulkChange",TOKEN_RESET:"tokenReset",BACKBONE_COLLECTION_ADD:"add",BACKBONE_COLLECTION_REMOVE:"remove",BACKBONE_COLLECTION_MODEL_CHANGE:"change",BACKBONE_COLLECTION_MODEL_RESET:"reset"},$t=k().extend({defaults:{tokens:null,text:"",placeHolderText:""},createTokenCollection:function(){return new kt},initialize:function(){var i=this,e=null;i.set({tokens:i.createTokenCollection()}),(e=i.attributes.tokens).on(Ht.BACKBONE_COLLECTION_ADD,function(e,t,n){$.events(i).triggerHandler(Ht.TOKEN_ADD,e,t,n)}),e.on(Ht.BACKBONE_COLLECTION_REMOVE,function(e,t,n){$.events(i).triggerHandler(Ht.TOKEN_REMOVE,e,t,n)}),e.on(Ht.BACKBONE_COLLECTION_MODEL_CHANGE,function(e){$.events(i).triggerHandler(Ht.TOKEN_CHANGE,e)}),e.on(Ht.BACKBONE_COLLECTION_MODEL_RESET,function(){$.events(i).triggerHandler(Ht.TOKEN_RESET,{})})},getTokenCollection:function(){return this.attributes.tokens},getTokenModelList:function(){return this.getTokenCollection().models},selectAllTokens:function(){this.getTokenModelList().forEach(function(e){e.set({selected:!0},{silent:!0})}),$.events(this).triggerHandler(Ht.TOKEN_BULK_CHANGE)},deselectAllTokens:function(){this.getTokenModelList().forEach(function(e){e.set({selected:!1},{silent:!0})}),$.events(this).triggerHandler(Ht.TOKEN_BULK_CHANGE)},isAllSelected:function(){for(var e=this.getTokenModelList(),t=0,n=e.length;t<n;t++)if(!e[t].attributes.selected)return!1;return!0},findTokenIndex:function(e){for(var t=this.getTokenModelList(),n=0,i=t.length;n<i;n++)if(!t[n]===e)return n;return-1},removeAllSelected:function(){var e=this.getTokenModelList(),t=this.getTokenCollection();e=e.filter(function(e){return!0===e.attributes.selected}),t.remove(e,{silent:!0}),$.events(this).triggerHandler(Ht.TOKEN_BULK_CHANGE,{type:"remove"})},addTokens:function(e){this.getTokenCollection().add(e,{silent:!0}),e.forEach(function(e){e.trigger("add")}),$.events(this).triggerHandler(Ht.TOKEN_BULK_CHANGE,{type:"add"})}});$t.EVENTS=Ht;var wt={REMOVE:"remove",EDIT:"edit",SELECT:"select",TEXTCHANGE:"textChange",RESIZED:"resized"},Tt=function(){function e(){babelHelpers.classCallCheck(this,e);this.dom=null,this.refs=null,this.state={}}return babelHelpers.createClass(e,[{key:"destructor",value:function(){var e=this;$.events(e).off(),e.uninitializeDOM(),_t(e),e.dom=null,e.refs=null,e.state=null}},{key:"getTemplate",value:function(){return F("div",{ref:"wrapper",className:"SC_cs token no-image",tabIndex:"0"},F("div",{ref:"text-wrapper",className:"text"},F("span",{ref:"textLabel",className:"text-label"}),F("input",{ref:"textInput",className:"text-input",type:"text",autoComplete:"off",value:""})),F("i",{ref:"removeButton",className:"msi-close remove"},"x"))}},{key:"createDOM",value:function(){return this.dom=this.getTemplate(),this.dom}},{key:"createDOMRefs",value:function(){return this.refs=r(this.dom,!0),this.refs}},{key:"getSelectionClass",value:function(){return"selected"}},{key:"render",value:function(e){var t=this,n=(t.model=e).attributes;t.dom?t.uninitializeDOM():(t.createDOM(),t.createDOMRefs()),t.state.editMode=n.editMode,t.state.selected=n.selected,$.e(t.refs.wrapper).attr({tabindex:0});var i=t.getSelectionClass();n.selected?$.e(t.refs.wrapper).addClass(i):$.e(t.refs.wrapper).removeClass(i),n.editMode?($.e(t.refs.wrapper).addClass("edit-mode"),$.e(t.refs.textInput).attr("readonly",!1)):($.e(t.refs.wrapper).removeClass("edit-mode"),$.e(t.refs.textInput).attr("readonly",!0)),$.e(t.refs.textInput).attr("value",n.text),$.e(t.refs.textLabel).text(n.text),n.editMode&&t.focusInput(),t.initializeDOM()}},{key:"resizeInput",value:function(){var e=this.refs.textInput;$.e(e).attr({size:Math.max(1,e.value.length)}),$.events(this).triggerHandler(wt.RESIZED)}},{key:"focusInput",value:function(){var e=this;e.state.editMode&&setTimeout(function(){$.e(e.refs.textInput).focus()},0)}},{key:"focus",value:function(){var e=this;setTimeout(function(){e._mounted&&$.e(e.refs.wrapper).focus()},0)}},{key:"getText",value:function(){return this.refs.textInput.value}},{key:"_removeClickHandler",value:function(e){$.e(this).triggerHandler(wt.REMOVE,{instance:this,event:e}),e.stopPropagation()}},{key:"_handleEditAction",value:function(e){var t=this;!0!==t.state.editMode&&(t.state.editMode=!0,$.e(t.refs.wrapper).addClass("edit-mode"),$.e(t.refs.textInput).attr("readonly",!1),t.focusInput(),$.events(t).triggerHandler(wt.EDIT,{instance:t,event:e}))}},{key:"_doubleClickHandler",value:function(e){this._handleEditAction(e),e.stopPropagation()}},{key:"_handleSelectAction",value:function(e,t){var n=this;if(t=t||{},!0!==n.state.editMode){n.state.selected=!n.state.selected;var i=n.getSelectionClass();n.state.selected?$.e(n.refs.wrapper).addClass(i):$.e(n.refs.wrapper).removeClass(i),$.events(n).triggerHandler(wt.SELECT,{instance:n,selected:n.state.selected,isSingleSelect:t.isSingleSelect,event:e})}}},{key:"_handleTextChangeAction",value:function(e,t){var n=this;t=t||{},n.state.editMode=!1,$.e(n.refs.textLabel).text(n.getText()),$.e(n.refs.wrapper).removeClass("edit-mode"),$.e(n.refs.textInput).attr("readonly",!0),t.isBlurEvent||n.focus(),$.events(n).triggerHandler(wt.TEXTCHANGE,{instance:n,event:e})}},{key:"_clickHandler",value:function(e){this._handleSelectAction(e,{isSingleSelect:!0!==e.ctrlKey}),e.stopPropagation()}},{key:"_inputEventHandler",value:function(e){this.resizeInput()}},{key:"_inputChangeHandler",value:function(e){this.resizeInput(),this._handleTextChangeAction(e)}},{key:"_inputBlurHandler",value:function(e){this._handleTextChangeAction(e,{isBlurEvent:!0})}},{key:"_inputKeyDownHandler",value:function(e){switch(e.which||e.keyCode){case d.LEFT:case d.RIGHT:this.state.editMode&&e.stopPropagation()}}},{key:"_inputKeyUpHandler",value:function(){this.resizeInput()}},{key:"_inputKeyPressHandler",value:function(){this.resizeInput()}},{key:"_keyDownHandler",value:function(e){var t=this,n=!0;switch(e.which||e.keyCode){case d.ESC:!0===t.state.editMode?t._handleTextChangeAction(e):$.e(t.refs.wrapper).blur();break;case d.SPACE:e.target===t.refs.wrapper&&!0!==t.state.editMode?t._handleSelectAction(e,{isSingleSelect:!0!==e.ctrlKey}):n=!1;break;case d.ENTER:!0!==t.state.editMode?t._handleEditAction(e):($.events(t).triggerHandler(wt.TEXTCHANGE,{instance:t,event:e}),t.focus());break;case d.DELETE:case d.BACKSPACE:!0!==t.state.editMode?$.events(t).triggerHandler(wt.REMOVE,{instance:t,event:e}):n=!1;break;default:n=!1}n&&(e.stopPropagation(),e.preventDefault())}},{key:"_focusHandler",value:function(){this.state.editMode&&this.focusInput()}},{key:"_domMountHandler",value:function(){this.resizeInput()}},{key:"isFocused",value:function(){return document.activeElement===this.refs.wrapper||document.activeElement===this.refs.textInput}},{key:"initializeDOM",value:function(){var e=this;e._removeClickHandler=e._removeClickHandler.bind(e),$.e(e.refs.removeButton).on("click",e._removeClickHandler),e._doubleClickHandler=e._doubleClickHandler.bind(e),$.e(e.refs.wrapper).on("dblclick",e._doubleClickHandler),e._clickHandler=e._clickHandler.bind(e),$.e(e.refs.wrapper).on("click",e._clickHandler),e._inputChangeHandler=e._inputChangeHandler.bind(e),$.e(e.refs.textInput).on("change",e._inputChangeHandler),e._inputEventHandler=e._inputEventHandler.bind(e),$.e(e.refs.textInput).on("input",e._inputEventHandler),e._inputBlurHandler=e._inputBlurHandler.bind(e),$.e(e.refs.textInput).on("blur",e._inputBlurHandler),e._inputKeyDownHandler=e._inputKeyDownHandler.bind(e),$.e(e.refs.textInput).on("keydown",e._inputKeyDownHandler),e._inputKeyUpHandler=e._inputKeyUpHandler.bind(e),$.e(e.refs.textInput).on("keyup",e._inputKeyUpHandler),e._inputKeyPressHandler=e._inputKeyPressHandler.bind(e),$.e(e.refs.textInput).on("keypress",e._inputKeyPressHandler),e._keyDownHandler=e._keyDownHandler.bind(e),$.e(e.refs.wrapper).on("keydown",e._keyDownHandler),e._focusHandler=e._focusHandler.bind(e),$.e(e.refs.wrapper).on("focus",e._focusHandler),e._domMountHandler=e._domMountHandler.bind(e),$.events(e).on(mt.DOM_MOUNTED,e._domMountHandler)}},{key:"uninitializeDOM",value:function(){var e=this;$.e(e.refs.removeButton).off("click",e._removeClickHandler),$.e(e.refs.wrapper).off("dblclick",e._doubleClickHandler),$.e(e.refs.wrapper).off("click",e._clickHandler),$.e(e.refs.textInput).off("change",e._inputChangeHandler),$.e(e.refs.textInput).off("input",e._inputEventHandler),$.e(e.refs.textInput).off("blur",e._inputBlurHandler),$.e(e.refs.textInput).off("keydown",e._inputKeyDownHandler),$.e(e.refs.textInput).off("keyup",e._inputKeyUpHandler),$.e(e.refs.textInput).off("keypress",e._inputKeyPressHandler),$.e(e.refs.wrapper).off("keydown",e._keyDownHandler),$.e(e.refs.wrapper).off("focus",e._focusHandler),$.events(e).off(mt.DOM_MOUNTED,e._domMountHandler)}}]),e}();Tt.EVENTS=wt;var St={INPUTCHANGE:"inputChange",INPUTKEYPRESS:"inputKeyPress",INPUTKEYDOWN:"inputKeyDown",INPUTKEYUP:"inputKeyUp",REMOVEMODEL:"removeModel",TOKENENTRY:"tokenEntry",COMPONENTKEYDOWN:"componentKeyDown",COMPONENTKEYUP:"componentKeyUp"},It=function(){function t(){babelHelpers.classCallCheck(this,t);var e=this;e.dom=null,e.refs=null,e.state={},e.tokenComponents=[],e.tokenComponentFactory=null}return babelHelpers.createClass(t,[{key:"destructor",value:function(){var e=this;$.events(e).off(),e.uninitializeDOM(),_t(e),e.dom=null,e.refs=null,e.state=null,e.tokenComponents=null,e.tokenComponentFactory=null}},{key:"createTokenComponent",value:function(e){return this.tokenComponentFactory.createComponent(e)}},{key:"setState",value:function(e){this.state=$.extend({},this.state,e),this.render(this.model)}},{key:"getDOMTemplate",value:function(){return F("div",{ref:"wrapper",className:"token-input",tabIndex:"0"},F("div",{ref:"innerWrapper",className:"inner-wrapper"},F("div",{ref:"listWrapper",className:"token-list"}),F("input",{ref:"input",className:"new-token",type:"text",autoComplete:"off"})))}},{key:"createDOM",value:function(){return this.dom=this.getDOMTemplate(),this.dom}},{key:"createDOMRefs",value:function(){return this.refs=r(this.dom,!0),this.refs}},{key:"mountTokenComponent",value:function(e){yt(e,this.refs.listWrapper,{parentComponent:this})}},{key:"renderToken",value:function(i){var r=this,e=null;return(e=r.tokenComponents.filter(function(e){return i===e.model})[0])||(e=r.createTokenComponent(i),$.events(e).on(Tt.EVENTS.SELECT,function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};i.set("selected",t.selected,{silent:!0})}),$.events(e).on(Tt.EVENTS.EDIT,function(){i.set("editMode",!0,{silent:!0})}),$.events(e).on(Tt.EVENTS.TEXTCHANGE,function(){i.set({text:e.getText(),editMode:!1},{silent:!0})}),$.events(e).on(Tt.EVENTS.REMOVE,function(e,t){var n=t.event;$.events(r).triggerHandler(St.REMOVEMODEL,{model:i,event:n})}),e.model=i),e.render(i),r.mountTokenComponent(e),e}},{key:"render",value:function(e){var n=this,t=(n.model=e).attributes,i=t.tokens.models;n.tokenComponents=n.tokenComponents.filter(function(e){return!!i.includes(e.model)||(e.destructor(),!1)}),n.dom||(n.createDOM(),n.createDOMRefs(),n.initializeDOM()),$.e(n.refs.input).val(t.text||""),$.e(n.refs.input).attr("placeholder",t.placeHolderText||"");var r=0,s=[];i.forEach(function(e){var t=n.renderToken(e);s.push(t),e.attributes.editMode&&r++}),n.tokenComponents=s,r||n.disableAutoFocus||n.focusInput()}},{key:"resizeInput",value:function(){var e=this.refs.input,t=e.value.length||e.getAttribute("placeholder").length;$.e(e).attr({size:Math.max(5,t)+3})}},{key:"focusInput",value:function(){var e=this;setTimeout(function(){$.e(e.refs.input).focus()},0)}},{key:"focus",value:function(){var e=this;setTimeout(function(){$.e(e.refs.wrapper).focus()},0)}},{key:"getInputCursorPosition",value:function(){var e=this.refs.input;return document.activeElement!==e?-1:e.selectionStart}},{key:"findFocusedTokenIndex",value:function(){var e=this.tokenComponents,n=-1;return e.forEach(function(e,t){e.isFocused()&&(n=t)}),n}},{key:"focusToken",value:function(e){var t=this.tokenComponents,n=-1,i=t["previous"===(e=e||{}).position?(n=this.findFocusedTokenIndex(),Math.max(0,n-1)):"next"===e.position?(n=this.findFocusedTokenIndex(),Math.min(t.length-1,n+1)):"last"===e.position?t.length-1:"first"===e.position?0:e.index];if(i)return!i.isFocused()&&(i.focus(),!0)}},{key:"_inputChangeHandler",value:function(e){this.resizeInput(),$.events(this).triggerHandler(St.INPUTCHANGE,{instance:this,event:e})}},{key:"_inputKeyPressHandler",value:function(e){this.resizeInput(),$.events(this).triggerHandler(St.INPUTKEYPRESS,{instance:this,event:e})}},{key:"_inputKeyDownHandler",value:function(e){$.events(this).triggerHandler(St.INPUTKEYDOWN,{instance:this,event:e})}},{key:"_inputKeyUpHandler",value:function(e){this.resizeInput(),$.events(this).triggerHandler(St.INPUTKEYUP,{instance:this,event:e})}},{key:"_componentKeyDownHandler",value:function(e){$.events(this).triggerHandler(St.COMPONENTKEYDOWN,{instance:this,event:e})}},{key:"_componentKeyUpHandler",value:function(e){$.events(this).triggerHandler(St.COMPONENTKEYUP,{instance:this,event:e})}},{key:"_focusHandler",value:function(){}},{key:"_clickHandler",value:function(){this.focusInput()}},{key:"_domMountHandler",value:function(){this.resizeInput()}},{key:"getText",value:function(){return this.refs.input.value}},{key:"initializeDOM",value:function(){var e=this;e._inputChangeHandler=e._inputChangeHandler.bind(e),$.e(e.refs.input).on("change",e._inputChangeHandler),e._inputKeyPressHandler=e._inputKeyPressHandler.bind(e),$.e(e.refs.input).on("keypress",e._inputKeyPressHandler),e._inputKeyDownHandler=e._inputKeyDownHandler.bind(e),$.e(e.refs.input).on("keydown",e._inputKeyDownHandler),e._inputKeyUpHandler=e._inputKeyUpHandler.bind(e),$.e(e.refs.input).on("keyup",e._inputKeyUpHandler),e._componentKeyDownHandler=e._componentKeyDownHandler.bind(e),$.e(e.refs.wrapper).on("keydown",e._componentKeyDownHandler),e._componentKeyUpHandler=e._componentKeyUpHandler.bind(e),$.e(e.refs.wrapper).on("keyup",e._componentKeyUpHandler),e._focusHandler=e._focusHandler.bind(e),$.e(e.refs.wrapper).on("focus",e._focusHandler),e._clickHandler=e._clickHandler.bind(e),$.e(e.refs.wrapper).on("click",e._clickHandler),e._domMountHandler=e._domMountHandler.bind(e),$.events(e).on(mt.DOM_MOUNTED,e._domMountHandler)}},{key:"uninitializeDOM",value:function(){var e=this;$.e(e.refs.input).off("change",e._inputChangeHandler),$.e(e.refs.input).off("keypress",e._inputKeyPressHandler),$.e(e.refs.input).off("keydown",e._inputKeyDownHandler),$.e(e.refs.input).off("keyup",e._inputKeyUpHandler),$.e(e.refs.wrapper).off("focus",e._focusHandler),$.e(e.refs.wrapper).off("click",e._clickHandler),$.e(e.refs.wrapper).off("keydown",e._componentKeyDownHandler),$.e(e.refs.wrapper).off("keyup",e._componentKeyUpHandler),$.events(e).off(mt.DOM_MOUNTED,e._domMountHandler),e.tokenComponents.forEach(function(e){e.destructor()}),e.tokenComponents=[]}},{key:"show",value:function(){$.e(this.dom).addClass("shown"),$.e(this.dom).removeClass("hidden")}},{key:"hide",value:function(){$.e(this.dom).addClass("hidden"),$.e(this.do).removeClass("shown")}}]),t}();It.EVENTS=St;var Mt=function(){function e(){babelHelpers.classCallCheck(this,e);this.component=null,this.enabled=!1}return babelHelpers.createClass(e,[{key:"destructor",value:function(){this.uninitialize(),this.component=null,this.enabled=null}},{key:"initialize",value:function(e){if(e=e||{},this.component=e.component,!(this.component instanceof It))throw new Error("[component] is of invalid type !");this.enable(),this.bindEvents()}},{key:"uninitialize",value:function(){this.disable(),this.unbindEvents()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"bindEvents",value:function(){throw new Error("Abstract method. Implement in sub-class.")}},{key:"unbindEvents",value:function(){throw new Error("Abstract method. Implement in sub-class.")}}]),e}(),Ot=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"createModelInstance",value:function(){return new Et}},{key:"createModel",value:function(e){if(!(e=e||{}).id)return null;if(!(e.text||"").trim())return null;var t=this.createModelInstance();return t.set({id:e.id,text:e.text}),t}}]),e}(),At=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"createComponent",value:function(e){if(e instanceof Et)return new Tt}}]),e}(),Dt="keyTrigger",Nt=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"matchKey",value:function(e){throw new Error("Abstract method. Implement in sub-class.")}},{key:"validate",value:function(){return!0}},{key:"_componentKeyDownHandler",value:function(e,t){var n=this;if(t=t||{},n.enabled){var i=t.event,r=i.keyCode||i.which;if(n.matchKey(r)&&n.validate()){var s=n.component.getText();$.events(n.component).triggerHandler(It.EVENTS.TOKENENTRY,{trigger:n,text:s,event:t.event}),$.events(n).triggerHandler(Dt,{instance:n,event:t.event})}}}},{key:"bindEvents",value:function(){var e=this;e._componentKeyDownHandler=e._componentKeyDownHandler.bind(e),$.events(e.component).on(It.EVENTS.INPUTKEYDOWN,e._componentKeyDownHandler)}},{key:"unbindEvents",value:function(){$.events(this.component).off(It.EVENTS.INPUTKEYDOWN,this._componentKeyDownHandler)}}]),t}(Mt),xt=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"matchKey",value:function(e){return e===d.ENTER}}]),t}(Nt),Lt=function(){function t(){babelHelpers.classCallCheck(this,t);var e=this;e._initialized=!1,e.component=null,e.model=null,e.tokenModelFactory=null,e.triggers={},e.parentDOM=null}return babelHelpers.createClass(t,[{key:"createComponent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new It(e)}},{key:"initComponent",value:function(e){e=e||{},this.component=this.createComponent(e),this.component.tokenComponentFactory=this.tokenComponentFactory}},{key:"createModel",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new $t(e)}},{key:"initModel",value:function(e){e=e||{},this.model=this.createModel(e)}},{key:"createTokenModelFactory",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Ot(e)}},{key:"initTokenModelFactory",value:function(e){e=e||{},this.tokenModelFactory=this.createTokenModelFactory(e)}},{key:"createTokenComponentFactory",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new At(e)}},{key:"initTokenComponentFactory",value:function(e){this.tokenComponentFactory=this.createTokenComponentFactory(e)}},{key:"createTriggers",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{enterKeyTrigger:new xt(e)}}},{key:"initTriggers",value:function(e){var t=this;e=e||{},t.triggers=t.createTriggers(e),Object.keys(t.triggers).forEach(function(e){t.triggers[e].initialize({component:t.component})})}},{key:"init",value:function(e){var t=this;t._initialized||(e=e||{},t.parentDOM=e.parentDOM,t.initModel(e),t.initTokenModelFactory(e),t.initTokenComponentFactory(e),t.initComponent(e),t.initTriggers(e),t.renderComponent(),t.bindEvents(),t._initialized=!0)}},{key:"destroy",value:function(){var t=this;t._initialized&&(t.unbindEvents(),t.component.destructor(),t.component=null,t.model=null,t.tokenModelFactory=null,t.tokenComponentFactory=null,Object.keys(t.triggers).forEach(function(e){t.triggers[e].destructor()}),t.triggers=null,t.parentDOM=null)}},{key:"renderComponent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.component.render(this.model),yt(this.component,this.parentDOM,{detached:e.detached,nextDOMAnchor:e.nextDOMAnchor})}},{key:"_modelTokenAddHandler",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.renderComponent(),n.type="add",n.model=t,$.events(this).triggerHandler("tokenChange",n)}},{key:"_modelTokenRemoveHandler",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.renderComponent(),n.type="remove",n.model=t,$.events(this).triggerHandler("tokenChange",n)}},{key:"_modelTokenChangeHandler",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.renderComponent(),n.type="change",n.model=t,$.events(this).triggerHandler("tokenChange",n)}},{key:"_modelTokenBulkChangeHandler",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.renderComponent(),t.type=t.type||"change",t.isBulkChange=!0,$.events(this).triggerHandler("tokenChange",t)}},{key:"_modelTokenResetHandler",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.renderComponent(),t.type="reset",t.isBulkChange=!0,$.events(this).triggerHandler("tokenChange",t)}},{key:"_componentTokenEntryHandler",value:function(e,t){var n=this.model,i=n.attributes.tokens,r=this.tokenModelFactory;if(((t=t||{}).text||"").trim()){var s=r.createModel({id:Date.now(),text:t.text});s&&(n.set({text:""}),i.add(s))}}},{key:"_componentRemoveModelHandler",value:function(e,t){var n=this,i=n.model,r=i.attributes.tokens,s=(t=t||{}).event;if(s&&(s.metaKey||s.ctrlKey))return i.removeAllSelected(),void(n.component.focusToken({position:"last"})||n.component.focusInput());var o=n.component.findFocusedTokenIndex();r.remove(t.model),n.component.focusToken({index:o})}},{key:"_selectAllKeyEventHandler",value:function(e){(e.ctrlKey||e.metaKey)&&e.shiftKey&&(this.model.isAllSelected()?this.model.deselectAllTokens():this.model.selectAllTokens(),e.preventDefault(),e.stopPropagation())}},{key:"_componentInputKeyDownHandler",value:function(e,t){var n,i,r=this,s=r.model,o=(t=t||{}).event,l=o.which||o.keyCode;switch(l){case d.DELETE:case d.BACKSPACE:if((o.ctrlKey||o.metaKey)&&o.shiftKey)s.removeAllSelected();else if(l===d.BACKSPACE&&(i=r.component.getText(),n=s.attributes.tokens,!i.length&&n.length)){var a=n.at(n.length-1);n.remove(a)}break;case d.LEFT:i=r.component.getText(),0===r.component.getInputCursorPosition()&&r.component.focusToken({position:"last"}),o.stopPropagation();break;case d.RIGHT:o.stopPropagation();break;case d.A:r._selectAllKeyEventHandler(o)}}},{key:"_componentInputKeyUpHandler",value:function(e,t){}},{key:"_componentKeyDownHandler",value:function(e,t){var n=this,i=(t=t||{}).event;switch(i.which||i.keyCode){case d.LEFT:n.component.focusToken({position:"previous"}),i.stopPropagation();break;case d.RIGHT:n.component.focusToken({position:"next"})||n.component.focusInput(),i.stopPropagation();break;case d.A:n._selectAllKeyEventHandler(i);break;case d.BACKSPACE:case d.DELETE:i.ctrlKey&&i.shiftKey&&n.model.removeAllSelected()}}},{key:"_componentKeyUpHandler",value:function(e,t){}},{key:"bindEvents",value:function(){var e=this;e._modelTokenAddHandler=e._modelTokenAddHandler.bind(e),e._modelTokenRemoveHandler=e._modelTokenRemoveHandler.bind(e),e._modelTokenChangeHandler=e._modelTokenChangeHandler.bind(e),e._modelTokenBulkChangeHandler=e._modelTokenBulkChangeHandler.bind(e),e._modelTokenResetHandler=e._modelTokenResetHandler.bind(e),e._componentTokenEntryHandler=e._componentTokenEntryHandler.bind(e),e._componentRemoveModelHandler=e._componentRemoveModelHandler.bind(e),e._componentInputKeyUpHandler=e._componentInputKeyUpHandler.bind(e),e._componentInputKeyDownHandler=e._componentInputKeyDownHandler.bind(e),e._componentKeyDownHandler=e._componentKeyDownHandler.bind(e),e._componentKeyUpHandler=e._componentKeyUpHandler.bind(e),$.events(e.model).on($t.EVENTS.TOKEN_ADD,e._modelTokenAddHandler),$.events(e.model).on($t.EVENTS.TOKEN_REMOVE,e._modelTokenRemoveHandler),$.events(e.model).on($t.EVENTS.TOKEN_CHANGE,e._modelTokenChangeHandler),$.events(e.model).on($t.EVENTS.TOKEN_BULK_CHANGE,e._modelTokenBulkChangeHandler),$.events(e.model).on($t.EVENTS.TOKEN_RESET,e._modelTokenResetHandler),$.events(e.component).on(It.EVENTS.TOKENENTRY,e._componentTokenEntryHandler),$.events(e.component).on(It.EVENTS.REMOVEMODEL,e._componentRemoveModelHandler),$.events(e.component).on(It.EVENTS.INPUTKEYUP,e._componentInputKeyUpHandler),$.events(e.component).on(It.EVENTS.INPUTKEYDOWN,e._componentInputKeyDownHandler),$.events(e.component).on(It.EVENTS.COMPONENTKEYDOWN,e._componentKeyDownHandler),$.events(e.component).on(It.EVENTS.COMPONENTKEYUP,e._componentKeyUpHandler)}},{key:"unbindEvents",value:function(){var e=this;$.events(e.model).off($t.EVENTS.TOKEN_ADD,e._modelTokenAddHandler),$.events(e.model).off($t.EVENTS.TOKEN_REMOVE,e._modelTokenRemoveHandler),$.events(e.model).off($t.EVENTS.TOKEN_CHANGE,e._modelTokenChangeHandler),$.events(e.model).off($t.EVENTS.TOKEN_BULK_CHANGE,e._modelTokenBulkChangeHandler),$.events(e.model).off($t.EVENTS.TOKEN_RESET,e._modelTokenResetHandler),$.events(e.component).off(It.EVENTS.TOKENENTRY,e._componentTokenEntryHandler),$.events(e.component).off(It.EVENTS.REMOVEMODEL,e._componentRemoveModelHandler),$.events(e.component).off(It.EVENTS.INPUTKEYUP,e._componentInputKeyUpHandler),$.events(e.component).off(It.EVENTS.INPUTKEYDOWN,e._componentInputKeyDownHandler),$.events(e.component).off(It.EVENTS.COMPONENTKEYDOWN,e._componentKeyDownHandler),$.events(e.component).off(It.EVENTS.COMPONENTKEYUP,e._componentKeyUpHandler)}}]),t}(),Kt=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"matchKey",value:function(e){return e===d.SPACE}}]),t}(Nt),zt=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"matchKey",value:function(e){return e===d.TAB}}]),t}(Nt),Rt=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"matchKey",value:function(e){return e===d.COMMA}}]),t}(Nt),Pt=zmail.Core.Namespaces,Ut=Pt.create("zmail.Components.AutoComplete"),Ft=Pt.create("zmail.Components.AutoComplete.System");Object.assign(Ut,{Constants:e,Utils:C}),Object.assign(Ft,{AbstractInput:y,AbstractSearchTokenGetter:le,AbstractTrigger:E,AbstractListItemModel:w,AbstractListItemCollection:T,AbstractListModel:I,AbstractDataProvider:O,AbstractDataAccumulator:D,AbstractListItemComponent:V,AbstractListComponent:G,AbstractListItemComponentFactory:j,AbstractHTMLEditable:se,AbstractHTMLInput:ce,AbstractHTMLTextArea:ae,AbstractHTMLContentEditable:de,AbstractAutoCompleteSystem:Y,BaseHTMLEditableAutoCompleteSystem:oe}),_zm.succErrMsg=function(e,t,n){var i=function(){n.onHide&&n.onHide()};if(t){var r,s,o;o=(s={s:"SC_smsg",e:"SC_emsg",i:"SC_imsg"})[e]||s.i;var l="";if("html"!==(n=n||{}).type&&(l=t),r=zdom("div",{className:"SC_msg"},zdom("span",null,l,n.noHide?zdom("i",{className:"msi-close"}):void 0)),_zm.bind(r,"click",function(e){var t=e.target||e.srcElement;"msi-close"===t.className&&(_zm.remove(t.parentNode.parentNode),i())},[]),"html"===n.type&&("string"==typeof t&&(t=DOM.__dangerouslyParseHTML(t)),$.e(r).find("span").append(t)),(n.appId?zmsuite.getCenter(n.appId)[0].$el[0].parentNode:n.parElem?n.parElem:document.body).appendChild(r),n.top&&(r.style.top=n.top+"px"),_zm.show(r),_zm.addClass(r,o),!n.noHide){var a=3e3;n.hideAfter=n.hideAfter||"auto","auto"===n.hideAfter&&"html"!==n.type&&((a=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=0,i=0,r=0;return!0===t.breakPeriods&&(e=e.replace(/\./g," ")),((e=e.replace(/\s+/g," ")).split(" ")||[]).forEach(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";7<=e.length?r++:3<e.length?i++:n++}),1e3*(Math.round(n/6)+Math.round(i/3)+Math.round(r/1))+1e3}(t))<3e3&&(a=3e3),n.hideAfter=a),setTimeout(function(){_zm.removeClass(r,o),i(),setTimeout(function(){_zm.remove(r)},1e3)},n.hideAfter)}return{$el:r}}},window.zmDropDownMenu=ht,window.zmContextMenu=ft;var Bt=zmail.Core.Namespaces.create("zmail.Components.FolderLabel");Object.assign(Bt,{BaseComponent:Te,FolderComponent:Ie,CheckboxComponent:Me,LabelComponent:Ke,GroupComponent:Re,SubFolderComponent:Ze});var Vt=Pt.create("zmail.Components.TokenInput"),jt=Pt.create("zmail.Components.TokenInput.Model"),Wt=Pt.create("zmail.Components.TokenInput.Component"),Gt=Pt.create("zmail.Components.TokenInput.Trigger"),qt=Pt.create("zmail.Components.TokenInput.Factory"),Yt=Pt.create("zmail.Components.TokenInput.System");Object.assign(Vt,{Utils:bt,Constants:vt}),Object.assign(jt,{BaseTokenModel:Et,BaseTokenCollection:kt,BaseTokenInputModel:$t}),Object.assign(Wt,{BaseTokenComponent:Tt,BaseTokenInputComponent:It}),Object.assign(Gt,{BaseTrigger:Mt,KeyInputTrigger:Nt,EnterKeyInputTrigger:xt,SpaceKeyInputTrigger:Kt,TabKeyInputTrigger:zt,CommaKeyInputTrigger:Rt}),Object.assign(qt,{BaseTokenModelFactory:Ot,BaseTokenComponentFactory:At}),Object.assign(Yt,{BaseTokenInputSystem:Lt})}(),window.__rollupModule=void 0;